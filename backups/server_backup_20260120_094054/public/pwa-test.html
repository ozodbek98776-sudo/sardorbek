<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Test - Sardorbek.Furnetura</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e293b;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #64748b;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: 500;
        }
        .success {
            background: #ecfdf5;
            color: #065f46;
            border: 1px solid #d1fae5;
        }
        .error {
            background: #fef2f2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        .warning {
            background: #fffbeb;
            color: #92400e;
            border: 1px solid #fed7aa;
        }
        button {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            margin: 5px;
            transition: all 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }
        .icon-test {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        .icon-test img {
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¢ PWA Test Dashboard</h1>
        <p class="subtitle">Sardorbek.Furnetura - Progressive Web App Testing</p>

        <div class="test-section">
            <h3>üì± PWA Features Test</h3>
            <div id="pwa-results"></div>
            <button onclick="testPWAFeatures()">Test PWA Features</button>
        </div>

        <div class="test-section">
            <h3>üîß Service Worker Test</h3>
            <div id="sw-results"></div>
            <button onclick="testServiceWorker()">Test Service Worker</button>
        </div>

        <div class="test-section">
            <h3>üìã Manifest Test</h3>
            <div id="manifest-results"></div>
            <button onclick="testManifest()">Test Manifest</button>
        </div>

        <div class="test-section">
            <h3>üé® Icons Test</h3>
            <div id="icons-results"></div>
            <div class="icon-test" id="icon-preview"></div>
            <button onclick="testIcons()">Test Icons</button>
        </div>

        <div class="test-section">
            <h3>üì± iOS Specific Tests</h3>
            <div id="ios-results"></div>
            <button onclick="testIOSFeatures()">Test iOS Features</button>
        </div>

        <div class="test-section">
            <h3>üîî Notifications Test</h3>
            <div id="notification-results"></div>
            <button onclick="testNotifications()">Test Notifications</button>
        </div>
    </div>

    <script>
        function addResult(containerId, message, type = 'success') {
            const container = document.getElementById(containerId);
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.textContent = message;
            container.appendChild(result);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        async function testPWAFeatures() {
            clearResults('pwa-results');
            
            // Test if running as PWA
            if (window.matchMedia('(display-mode: standalone)').matches) {
                addResult('pwa-results', '‚úÖ Running in standalone mode (PWA)', 'success');
            } else {
                addResult('pwa-results', '‚ö†Ô∏è Running in browser mode', 'warning');
            }

            // Test beforeinstallprompt
            if (window.deferredPrompt) {
                addResult('pwa-results', '‚úÖ Install prompt available', 'success');
            } else {
                addResult('pwa-results', '‚ö†Ô∏è Install prompt not available', 'warning');
            }

            // Test if iOS
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            if (isIOS) {
                addResult('pwa-results', 'üì± iOS device detected', 'success');
            } else {
                addResult('pwa-results', 'üíª Non-iOS device', 'warning');
            }

            // Test viewport
            const viewport = document.querySelector('meta[name="viewport"]');
            if (viewport && viewport.content.includes('viewport-fit=cover')) {
                addResult('pwa-results', '‚úÖ iOS safe area viewport configured', 'success');
            } else {
                addResult('pwa-results', '‚ö†Ô∏è iOS safe area viewport not configured', 'warning');
            }
        }

        async function testServiceWorker() {
            clearResults('sw-results');
            
            if ('serviceWorker' in navigator) {
                addResult('sw-results', '‚úÖ Service Worker supported', 'success');
                
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        addResult('sw-results', '‚úÖ Service Worker registered', 'success');
                        addResult('sw-results', `Scope: ${registration.scope}`, 'success');
                        
                        if (registration.active) {
                            addResult('sw-results', '‚úÖ Service Worker active', 'success');
                        } else {
                            addResult('sw-results', '‚ö†Ô∏è Service Worker not active', 'warning');
                        }
                    } else {
                        addResult('sw-results', '‚ùå Service Worker not registered', 'error');
                    }
                } catch (error) {
                    addResult('sw-results', `‚ùå Service Worker error: ${error.message}`, 'error');
                }
            } else {
                addResult('sw-results', '‚ùå Service Worker not supported', 'error');
            }
        }

        async function testManifest() {
            clearResults('manifest-results');
            
            try {
                const response = await fetch('/manifest.json');
                if (response.ok) {
                    const manifest = await response.json();
                    addResult('manifest-results', '‚úÖ Manifest file loaded', 'success');
                    addResult('manifest-results', `Name: ${manifest.name}`, 'success');
                    addResult('manifest-results', `Short name: ${manifest.short_name}`, 'success');
                    addResult('manifest-results', `Display: ${manifest.display}`, 'success');
                    addResult('manifest-results', `Theme color: ${manifest.theme_color}`, 'success');
                    addResult('manifest-results', `Icons: ${manifest.icons.length} defined`, 'success');
                    addResult('manifest-results', `Shortcuts: ${manifest.shortcuts.length} defined`, 'success');
                } else {
                    addResult('manifest-results', '‚ùå Manifest file not found', 'error');
                }
            } catch (error) {
                addResult('manifest-results', `‚ùå Manifest error: ${error.message}`, 'error');
            }
        }

        async function testIcons() {
            clearResults('icons-results');
            const iconPreview = document.getElementById('icon-preview');
            iconPreview.innerHTML = '';
            
            const iconSizes = [72, 96, 128, 144, 152, 192, 384, 512];
            
            for (const size of iconSizes) {
                try {
                    const response = await fetch(`/icon-${size}x${size}.svg`);
                    if (response.ok) {
                        addResult('icons-results', `‚úÖ Icon ${size}x${size} available`, 'success');
                        
                        // Create preview
                        const img = document.createElement('img');
                        img.src = `/icon-${size}x${size}.svg`;
                        img.width = Math.min(size, 48);
                        img.height = Math.min(size, 48);
                        img.title = `${size}x${size}`;
                        iconPreview.appendChild(img);
                    } else {
                        addResult('icons-results', `‚ùå Icon ${size}x${size} not found`, 'error');
                    }
                } catch (error) {
                    addResult('icons-results', `‚ùå Icon ${size}x${size} error: ${error.message}`, 'error');
                }
            }
        }

        function testIOSFeatures() {
            clearResults('ios-results');
            
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isInStandaloneMode = ('standalone' in window.navigator) && (window.navigator.standalone);
            
            if (isIOS) {
                addResult('ios-results', 'üì± iOS device detected', 'success');
                
                if (isInStandaloneMode) {
                    addResult('ios-results', '‚úÖ Running in iOS standalone mode', 'success');
                } else {
                    addResult('ios-results', '‚ö†Ô∏è Not in iOS standalone mode', 'warning');
                    addResult('ios-results', 'üí° Add to Home Screen to test PWA mode', 'warning');
                }
                
                // Test iOS meta tags
                const appleMobileCapable = document.querySelector('meta[name="apple-mobile-web-app-capable"]');
                if (appleMobileCapable) {
                    addResult('ios-results', '‚úÖ Apple mobile web app capable meta tag found', 'success');
                } else {
                    addResult('ios-results', '‚ùå Apple mobile web app capable meta tag missing', 'error');
                }
                
                const appleStatusBar = document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]');
                if (appleStatusBar) {
                    addResult('ios-results', '‚úÖ Apple status bar style configured', 'success');
                } else {
                    addResult('ios-results', '‚ùå Apple status bar style not configured', 'error');
                }
                
                const appleTouchIcons = document.querySelectorAll('link[rel="apple-touch-icon"]');
                if (appleTouchIcons.length > 0) {
                    addResult('ios-results', `‚úÖ ${appleTouchIcons.length} Apple touch icons configured`, 'success');
                } else {
                    addResult('ios-results', '‚ùå No Apple touch icons found', 'error');
                }
                
            } else {
                addResult('ios-results', 'üíª Not an iOS device', 'warning');
                addResult('ios-results', 'üì± Test on iPhone/iPad for full iOS PWA experience', 'warning');
            }
        }

        async function testNotifications() {
            clearResults('notification-results');
            
            if ('Notification' in window) {
                addResult('notification-results', '‚úÖ Notifications API supported', 'success');
                
                const permission = Notification.permission;
                addResult('notification-results', `Permission status: ${permission}`, 
                    permission === 'granted' ? 'success' : 'warning');
                
                if (permission === 'default') {
                    try {
                        const result = await Notification.requestPermission();
                        addResult('notification-results', `Permission result: ${result}`, 
                            result === 'granted' ? 'success' : 'warning');
                    } catch (error) {
                        addResult('notification-results', `‚ùå Permission error: ${error.message}`, 'error');
                    }
                }
                
                if (Notification.permission === 'granted') {
                    try {
                        new Notification('Sardorbek.Furnetura PWA Test', {
                            body: 'Notifications are working correctly!',
                            icon: '/icon-192x192.svg'
                        });
                        addResult('notification-results', '‚úÖ Test notification sent', 'success');
                    } catch (error) {
                        addResult('notification-results', `‚ùå Notification error: ${error.message}`, 'error');
                    }
                }
            } else {
                addResult('notification-results', '‚ùå Notifications not supported', 'error');
            }
        }

        // Auto-run basic tests on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                testPWAFeatures();
                testServiceWorker();
            }, 1000);
        });
    </script>
</body>
</html>