var ha=Object.defineProperty,fa=Object.defineProperties;var pa=Object.getOwnPropertyDescriptors;var Lt=Object.getOwnPropertySymbols;var ga=Object.prototype.hasOwnProperty,ba=Object.prototype.propertyIsEnumerable;var st=(s,o,r)=>o in s?ha(s,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[o]=r,g=(s,o)=>{for(var r in o||(o={}))ga.call(o,r)&&st(s,r,o[r]);if(Lt)for(var r of Lt(o))ba.call(o,r)&&st(s,r,o[r]);return s},v=(s,o)=>fa(s,pa(o));var ja=(s,o)=>()=>(o||s((o={exports:{}}).exports,o),o.exports);var Es=(s,o,r)=>st(s,typeof o!="symbol"?o+"":o,r);var Q=(s,o,r)=>new Promise((h,i)=>{var S=P=>{try{k(r.next(P))}catch(q){i(q)}},j=P=>{try{k(r.throw(P))}catch(q){i(q)}},k=P=>P.done?h(P.value):Promise.resolve(P.value).then(S,j);k((r=r.apply(s,o)).next())});import{r as t,j as e,u as gs,b as Cs,B as dt,U as ns,L as cs,E as Ks,c as bs,d as mt,S as xt,P as ds,X as be,M as Yt,N as Na,e as ps,f as ut,g as Wt,h as os,i as $e,k as Js,C as fs,l as ht,m as ws,F as ft,O as Gs,n as Ht,o as pt,p as Ge,q as Jt,D as Je,T as gt,s as va,t as xs,v as at,w as ya,x as Fs,y as Ss,z as ls,G as Gt,I as wa,W as ka,H as Sa,J as Bs,K as is,Q as Et,V as hs,Y as Vt,Z as Zt,_ as Rs,$ as Ze,a0 as ks,a1 as Ca,a2 as Ms,a3 as Is,a4 as bt,a5 as ea,a6 as sa,a7 as Us,a8 as jt,a9 as js,aa as At,ab as Xs,ac as ms,ad as Pa,ae as qa,af as Bt,ag as ta,ah as rt,ai as za,aj as Os,ak as $a,al as Ma,am as aa,an as nt,ao as Ta,ap as vs,aq as Qa,ar as Ra,as as Da,at as It,au as La,av as Ea,aw as Aa,ax as Ba,ay as Ia,az as Oa,aA as Ie,aB as zs,R as it,aC as _a}from"./react-vendor-DkffYxId.js";import{a as ra}from"./http-vendor-DnTtldoj.js";import{R as Ka,A as Fa,C as Ua,X as Xa,Y as Ya,T as Wa,a as Ha}from"./chart-vendor-8kTW-82J.js";import{H as na,b as Nt}from"./qrcode-vendor-BIk6yrR2.js";import"./vendor-C7NylOHx.js";var Jr=ja(Fe=>{(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))h(i);new MutationObserver(i=>{for(const S of i)if(S.type==="childList")for(const j of S.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&h(j)}).observe(document,{childList:!0,subtree:!0});function r(i){const S={};return i.integrity&&(S.integrity=i.integrity),i.referrerPolicy&&(S.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?S.credentials="include":i.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function h(i){if(i.ep)return;i.ep=!0;const S=r(i);fetch(i.href,S)}})();const ys=class ys{constructor(){Es(this,"isOnline",navigator.onLine);Es(this,"listeners",new Set);this.setupEventListeners()}static getInstance(){return ys.instance||(ys.instance=new ys),ys.instance}setupEventListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.notifyListeners()}),window.addEventListener("offline",()=>{this.isOnline=!1,this.notifyListeners()})}notifyListeners(){this.listeners.forEach(o=>o(this.isOnline))}getOnlineStatus(){return this.isOnline}addListener(o){return this.listeners.add(o),()=>this.listeners.delete(o)}static isServerOfflineError(o){if(!(o!=null&&o.response))return!1;const{status:r,data:h}=o.response;return r===503&&(h==null?void 0:h.offline)===!0}static getOfflineMessage(o){return this.isServerOfflineError(o)?o.response.data.message||"Server is currently offline. Please try again later.":"Network error occurred. Please check your connection."}};Es(ys,"instance");let Ys=ys;Ys.getInstance();const K=ra.create({baseURL:"/api",headers:{"Content-Type":"application/json"},timeout:3e4});K.interceptors.request.use(s=>{var r;const o=localStorage.getItem("token");return o&&(s.headers.Authorization=`Bearer ${o}`),(r=s.url)!=null&&r.includes("/products")&&(s.timeout=6e4),s});K.interceptors.response.use(s=>s,s=>{var o,r;return Ys.isServerOfflineError(s)?(console.warn("Server is offline:",s.response.data.message),Promise.reject(s)):(((o=s.response)==null?void 0:o.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),s.code==="ECONNABORTED"&&console.error("Request timeout:",(r=s.config)==null?void 0:r.url),Promise.reject(s))});const ia=t.createContext(void 0),Ja=({children:s})=>{const[o,r]=t.useState(null),[h,i]=t.useState(!0);t.useEffect(()=>{localStorage.getItem("token")?K.get("/auth/me").then(C=>r(C.data)).catch(()=>localStorage.removeItem("token")).finally(()=>i(!1)):i(!1)},[]);const S=(q,C)=>Q(Fe,null,function*(){const d=yield K.post("/auth/login",{phone:q,password:C});localStorage.setItem("token",d.data.token),r(d.data.user)}),j=(q,C)=>Q(Fe,null,function*(){const d=yield K.post("/auth/login",{login:q,password:C});localStorage.setItem("token",d.data.token),r(d.data.user)}),k=()=>{localStorage.removeItem("token"),r(null)},P=q=>{r(q)};return e.jsx(ia.Provider,{value:{user:o,loading:h,login:S,loginWithCredentials:j,logout:k,updateUser:P},children:s})},Ns=()=>{const s=t.useContext(ia);if(!s)throw new Error("useAuth must be used within AuthProvider");return s},la=t.createContext(void 0),Ga={uz:{"login.title":"Sardorbek.Furnetura","login.subtitle":"Professional Biznes Boshqaruv Tizimi","login.secure":"Xavfsiz va Ishonchli","login.welcome":"Xush kelibsiz","login.description":"Davom etish uchun hisobingizga kiring","login.phone":"Telefon raqam","login.password":"Parol","login.passwordPlaceholder":"Parolingizni kiriting","login.signing":"Kirilmoqda...","login.signin":"Kirish","login.error":"Kirish xatosi","sidebar.statistics":"Statistika","sidebar.products":"Tovarlar","sidebar.warehouses":"Omborlar","sidebar.customers":"Mijozlar","sidebar.debts":"Qarz daftarcha","sidebar.orders":"Buyurtmalar","sidebar.helpers":"Yordamchilar","sidebar.pos":"Kassa (POS)","sidebar.receipts":"Xodimlar cheklari","sidebar.signout":"Chiqish","sidebar.editProfile":"Profilni tahrirlash","sidebar.fullName":"To'liq ism","sidebar.namePlaceholder":"Ismingizni kiriting","sidebar.phoneNumber":"Telefon raqam","sidebar.newPassword":"Yangi parol (Ixtiyoriy)","sidebar.passwordHint":"Joriy parolni saqlash uchun bo'sh qoldiring","sidebar.cancel":"Bekor qilish","sidebar.saveChanges":"O'zgarishlarni saqlash","dashboard.title":"Statistika paneli","dashboard.overview":"Biznes ko'rsatkichlari","dashboard.description":"Biznesingizning ishlashi va asosiy ko'rsatkichlarini kuzating","dashboard.totalRevenue":"Umumiy daromad","dashboard.todaySales":"Bugungi savdo","dashboard.weeklySales":"Haftalik savdo","dashboard.totalOrders":"Jami buyurtmalar","dashboard.peakHour":"Eng yuqori soat","dashboard.today":"Bugun","dashboard.thisWeek":"Bu hafta","dashboard.refresh":"Ma'lumotlarni yangilash","dashboard.totalProducts":"Jami mahsulotlar","dashboard.lowStock":"Kam qolgan","dashboard.outOfStock":"Tugagan","dashboard.inventoryStatus":"Ombor holati","dashboard.currentStock":"Joriy zaxira ko'rinishi","dashboard.liveData":"Jonli ma'lumotlar","header.search":"Qidirish...","header.live":"Jonli","common.loading":"Yuklanmoqda...","common.error":"Xatolik yuz berdi","common.success":"Muvaffaqiyatli","common.save":"Saqlash","common.cancel":"Bekor qilish","common.delete":"O'chirish","common.edit":"Tahrirlash","common.add":"Qo'shish","common.close":"Yopish"}},Va=({children:s})=>{const[o,r]=t.useState("uz");t.useEffect(()=>{document.documentElement.lang="uz"},[]);const h=i=>Ga.uz[i]||i;return e.jsx(la.Provider,{value:{language:o,setLanguage:r,t:h},children:s})},Vs=()=>{const s=t.useContext(la);if(s===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return s};function Za(){var y;const[s,o]=t.useState(""),[r,h]=t.useState(""),[i,S]=t.useState(!1),[j,k]=t.useState(""),[P,q]=t.useState(!1),{loginWithCredentials:C}=Ns(),d=gs(),b=(y=Cs().state)==null?void 0:y.message,f=T=>Q(this,null,function*(){var E,$;T.preventDefault(),k(""),q(!0);try{switch(yield C(s,r),(yield K.get("/auth/me")).data.role){case"admin":d("/admin");break;case"cashier":d("/kassa");break;case"helper":d("/helper");break;default:d("/")}}catch(N){k((($=(E=N.response)==null?void 0:E.data)==null?void 0:$.message)||"Login yoki parol noto'g'ri")}finally{q(!1)}});return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(109, 40, 217, 0.15) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute top-1/4 right-1/4 w-64 h-64 rounded-full blur-2xl",style:{background:"radial-gradient(circle, rgba(6, 182, 212, 0.1) 0%, transparent 70%)"}})]}),e.jsxs("div",{className:"w-full max-w-sm relative z-10",children:[e.jsxs("div",{className:"text-center mb-6 animate-fade-up",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-4",style:{background:"linear-gradient(135deg, #5b21b6 0%, #2e1065 100%)",boxShadow:"0 8px 32px -8px rgba(91, 33, 182, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:e.jsx(dt,{className:"w-10 h-10 text-violet-200"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{background:"linear-gradient(135deg, #2e1065 0%, #5b21b6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Sardor Furnitura"}),e.jsx("p",{className:"font-medium",style:{color:"#71717a"},children:"Admin boshqaruv tizimi"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full animate-pulse",style:{background:"#22c55e"}}),e.jsx("span",{className:"text-sm",style:{color:"#a1a1aa"},children:"Xavfsiz kirish"})]})]}),e.jsxs("div",{className:"rounded-2xl p-6 animate-fade-up",style:{background:"linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 20px 40px -12px rgba(109, 40, 217, 0.2)",backdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center mx-auto mb-4",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 14px -2px rgba(6, 182, 212, 0.4)"},children:e.jsx(ns,{className:"w-7 h-7 text-white"})}),e.jsx("h2",{className:"text-xl font-bold mb-1",style:{color:"#2e1065"},children:"Xush kelibsiz!"}),e.jsx("p",{style:{color:"#71717a"},children:"Login va parolingizni kiriting"})]}),b&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)",border:"1px solid #86efac"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#22c55e"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"âœ“"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#166534"},children:"Muvaffaqiyat"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#15803d"},children:b})]})]})}),j&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)",border:"1px solid #fca5a5"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#ef4444"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#991b1b"},children:"Xatolik"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#b91c1c"},children:j})]})]})}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ns,{className:"w-3.5 h-3.5"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ns,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:"text",placeholder:"Loginingizni kiriting",value:s,onChange:T=>o(T.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl transition-all duration-200 focus:outline-none text-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(cs,{className:"w-3.5 h-3.5"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(cs,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:i?"text":"password",placeholder:"Parolingizni kiriting",value:r,onChange:T=>h(T.target.value),className:"w-full pl-10 pr-10 py-3 rounded-xl transition-all duration-200 focus:outline-none text-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0}),e.jsx("button",{type:"button",onClick:()=>S(!i),className:"absolute inset-y-0 right-0 pr-3 flex items-center transition-colors",style:{color:"#a1a1aa"},children:i?e.jsx(Ks,{className:"w-4 h-4"}):e.jsx(bs,{className:"w-4 h-4"})})]})]}),e.jsx("button",{type:"submit",disabled:P,className:"w-full text-white font-semibold py-3.5 px-4 rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 14px -2px rgba(124, 58, 237, 0.4)"},children:P?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Kirish..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Kirish"}),e.jsx(mt,{className:"w-4 h-4 transition-transform group-hover:translate-x-1"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("div",{className:"p-3 rounded-xl",style:{background:"linear-gradient(135deg, #cffafe 0%, #a5f3fc 100%)",border:"1px solid rgba(6, 182, 212, 0.3)"},children:[e.jsx("p",{className:"text-xs font-medium mb-1",style:{color:"#155e75"},children:"Kassa xodimi uchun:"}),e.jsx("button",{onClick:()=>d("/kassa-login"),className:"text-sm font-semibold underline transition-colors",style:{color:"#0891b2"},children:"Kassa tizimiga kirish â†’"})]})})]}),e.jsxs("div",{className:"text-center mt-6 animate-fade-up",children:[e.jsx("p",{className:"text-sm",style:{color:"#71717a"},children:"Â© 2025 Sardor Furnitura. Barcha huquqlar himoyalangan."}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-2 text-xs",style:{color:"#a1a1aa"},children:[e.jsx("span",{children:"Xavfsiz"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Professional"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Ishonchli"})]})]})]})]})}const u=s=>{const o=typeof s=="string"?parseFloat(s):s;return isNaN(o)?"0":o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},Re=s=>s.replace(/\./g,""),Ue=s=>{const o=s.replace(/\./g,"");if(o===""||o==="-")return o;const r=parseFloat(o);return isNaN(r)?"":u(r)},Ds=s=>{let r=s.replace(/\D/g,"");return!r.startsWith("998")&&r.length>0&&(r="998"+r),r=r.slice(0,12),r.length===0?"":r.length<=3?"+"+r:r.length<=5?"+998 ("+r.slice(3):r.length<=8?"+998 ("+r.slice(3,5)+") "+r.slice(5):r.length<=10?"+998 ("+r.slice(3,5)+") "+r.slice(5,8)+"-"+r.slice(8):"+998 ("+r.slice(3,5)+") "+r.slice(5,8)+"-"+r.slice(8,10)+"-"+r.slice(10)},ca=s=>s.replace(/\D/g,""),lt=s=>{if(!s)return"";const o=s.replace(/\D/g,"");return o.length!==12?s:"+998 ("+o.slice(3,5)+") "+o.slice(5,8)+"-"+o.slice(8,10)+"-"+o.slice(10)};function er(){const[s,o]=t.useState({name:"",phone:"",password:"",confirmPassword:""}),[r,h]=t.useState(!1),[i,S]=t.useState(!1),[j,k]=t.useState(""),[P,q]=t.useState(!1),{t:C}=Vs(),d=gs(),m=f=>{const y=Ds(f.target.value);o(T=>v(g({},T),{phone:y}))},b=f=>Q(this,null,function*(){var y,T;if(f.preventDefault(),k(""),q(!0),s.password!==s.confirmPassword){k("Parollar mos kelmaydi"),q(!1);return}if(s.password.length<6){k("Parol kamida 6 ta belgidan iborat bo'lishi kerak"),q(!1);return}try{const E=ca(s.phone);yield K.post("/auth/register",{name:s.name,phone:E,password:s.password,role:"admin"}),d("/login",{state:{message:"Ro'yxatdan o'tish muvaffaqiyatli! Endi tizimga kirishingiz mumkin."}})}catch(E){k(((T=(y=E.response)==null?void 0:y.data)==null?void 0:T.message)||"Xatolik yuz berdi")}finally{q(!1)}});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 bg-gradient-to-br from-blue-400/20 to-indigo-600/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-indigo-400/20 to-purple-600/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-gradient-to-r from-blue-300/10 to-indigo-400/10 rounded-full blur-2xl"})]}),e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23e2e8f0%22%20fill-opacity%3D%220.3%22%3E%3Ccircle%20cx%3D%2230%22%20cy%3D%2230%22%20r%3D%221.5%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-40"}),e.jsxs("div",{className:"w-full max-w-md relative z-10",children:[e.jsxs("div",{className:"text-center mb-8 animate-fade-up",children:[e.jsxs("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-3xl shadow-2xl shadow-blue-500/25 mb-6 relative",children:[e.jsx(dt,{className:"w-10 h-10 text-white"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center",children:e.jsx(xt,{className:"w-3 h-3 text-white"})})]}),e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-slate-900 via-blue-900 to-indigo-900 bg-clip-text text-transparent mb-3",children:C("login.title")}),e.jsx("p",{className:"text-slate-600 text-lg font-medium",children:C("login.subtitle")}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-slate-500",children:C("login.secure")})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/20 animate-fade-up",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Ro'yxatdan o'tish"}),e.jsx("p",{className:"text-slate-600",children:"Admin hisobini yaratish uchun ma'lumotlarni kiriting"})]}),j&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-4 mb-6 animate-fade-in",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-red-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium text-sm",children:"Xatolik"}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:j})]})]})}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"To'liq ism"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(ns,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"text",placeholder:"Ismingizni kiriting",value:s.name,onChange:f=>o(y=>v(g({},y),{name:f.target.value})),className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ds,{className:"w-4 h-4"}),"Telefon raqam"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(ds,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"tel",placeholder:"+998 (XX) XXX-XX-XX",value:s.phone,onChange:m,className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(cs,{className:"w-4 h-4"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(cs,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:r?"text":"password",placeholder:"Parolingizni kiriting",value:s.password,onChange:f=>o(y=>v(g({},y),{password:f.target.value})),className:"w-full pl-12 pr-12 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!r),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 transition-colors",children:r?e.jsx(Ks,{className:"w-5 h-5"}):e.jsx(bs,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(cs,{className:"w-4 h-4"}),"Parolni tasdiqlash"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(cs,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:i?"text":"password",placeholder:"Parolni qayta kiriting",value:s.confirmPassword,onChange:f=>o(y=>v(g({},y),{confirmPassword:f.target.value})),className:"w-full pl-12 pr-12 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0}),e.jsx("button",{type:"button",onClick:()=>S(!i),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 transition-colors",children:i?e.jsx(Ks,{className:"w-5 h-5"}):e.jsx(bs,{className:"w-5 h-5"})})]})]}),e.jsx("button",{type:"submit",disabled:P,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold py-4 px-6 rounded-2xl shadow-lg shadow-blue-500/25 transition-all duration-200 hover:from-blue-700 hover:to-indigo-700 hover:shadow-xl hover:shadow-blue-500/30 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",children:P?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Ro'yxatdan o'tilmoqda..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{children:"Ro'yxatdan o'tish"}),e.jsx(mt,{className:"w-5 h-5 transition-transform group-hover:translate-x-1"})]})})]})]})]})]})}function vt({variant:s="button",className:o=""}){const[r,h]=t.useState(null),[i,S]=t.useState(!1),[j,k]=t.useState(!1),[P,q]=t.useState(!1),[C,d]=t.useState(!1);t.useEffect(()=>{const y=/iPad|iPhone|iPod/.test(navigator.userAgent),T=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0;q(y),d(T),k(T);const E=N=>{N.preventDefault(),h(N),S(!0)},$=()=>{k(!0),S(!1),h(null)};return window.addEventListener("beforeinstallprompt",E),window.addEventListener("appinstalled",$),()=>{window.removeEventListener("beforeinstallprompt",E),window.removeEventListener("appinstalled",$)}},[]);const m=()=>Q(this,null,function*(){if(r){r.prompt();const{outcome:y}=yield r.userChoice;y==="accepted"&&(h(null),S(!1))}else P&&!C&&S(!0)});if(j)return null;const b=({size:y="md"})=>{const E={sm:{container:"w-8 h-9",apple:"w-7 h-8"},md:{container:"w-10 h-11",apple:"w-9 h-10"},lg:{container:"w-12 h-13",apple:"w-11 h-12"}}[y];return e.jsx("div",{className:`${E.container} relative flex items-center justify-center`,children:e.jsxs("svg",{className:`${E.apple} fill-current drop-shadow-2xl`,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("defs",{children:[e.jsxs("radialGradient",{id:"appleGlow",cx:"50%",cy:"30%",r:"70%",children:[e.jsx("stop",{offset:"0%",stopColor:"#ffffff",stopOpacity:"0.3"}),e.jsx("stop",{offset:"50%",stopColor:"#e5e7eb",stopOpacity:"0.2"}),e.jsx("stop",{offset:"100%",stopColor:"#111827",stopOpacity:"1"})]}),e.jsxs("filter",{id:"glow",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),e.jsx("path",{fill:"url(#appleGlow)",filter:"url(#glow)",d:"M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"}),e.jsx("circle",{cx:"19",cy:"5",r:"4.5",className:"fill-blue-500 animate-pulse drop-shadow-lg"}),e.jsx("circle",{cx:"19",cy:"5",r:"3.8",className:"fill-blue-400"}),e.jsx("path",{d:"M19 2v6M16.5 5h5",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",className:"drop-shadow-sm"}),e.jsx("path",{d:"M17 6.5l2 1.5 2-1.5",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"drop-shadow-sm"})]})})},f=()=>e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 via-gray-800 to-black rounded-3xl p-8 max-w-sm w-full shadow-2xl border border-gray-700/50 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 via-transparent to-transparent rounded-3xl"}),e.jsxs("div",{className:"flex items-center justify-between mb-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-14 h-14 bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl flex items-center justify-center shadow-xl border border-gray-700/50 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-transparent rounded-3xl"}),e.jsx(b,{size:"lg"})]}),e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Ilovani yuklab olish"})]}),e.jsx("button",{onClick:()=>S(!1),className:"p-2 rounded-xl hover:bg-gray-800 transition-colors",children:e.jsx(be,{className:"w-5 h-5 text-gray-400"})})]}),e.jsxs("div",{className:"space-y-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-5 p-5 bg-gradient-to-r from-gray-800/50 to-gray-900/50 rounded-3xl border border-gray-700/30 shadow-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"w-16 h-16 bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl flex items-center justify-center shadow-xl border border-gray-700/50 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-transparent rounded-3xl"}),e.jsx(b,{size:"lg"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white text-lg",children:"iPhone/iPad uchun"}),e.jsx("p",{className:"text-sm text-gray-300 font-medium",children:"Safari brauzeridan foydalaning"})]})]}),e.jsx("div",{className:"space-y-4",children:[{step:1,text:"Safari brauzerida sahifani oching",emoji:"ðŸŒ"},{step:2,text:"Pastdagi 'Ulashish' tugmasini bosing",emoji:"ðŸ“¤"},{step:3,text:"'Bosh ekranga qo'shish' ni tanlang",emoji:"ðŸ“±"},{step:4,text:"'Qo'shish' tugmasini bosing",emoji:"âœ…"}].map(y=>e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-full flex items-center justify-center text-sm font-bold shadow-md",children:y.step}),e.jsx("div",{className:"flex-1 pt-1",children:e.jsxs("p",{className:"text-gray-200 font-medium flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:y.emoji}),y.text]})})]},y.step))})]}),e.jsx("button",{onClick:()=>S(!1),className:"w-full mt-8 bg-gradient-to-r from-blue-600 to-blue-700 text-white py-4 rounded-2xl font-bold text-lg hover:from-blue-700 hover:to-blue-800 shadow-lg shadow-blue-500/25 hover:shadow-xl hover:shadow-blue-500/30 transition-all duration-200 relative z-10",children:"Tushundim ðŸ‘"})]})});return!r&&!P?null:s==="icon"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:m,className:`p-3 rounded-2xl bg-gradient-to-br from-gray-900 via-gray-800 to-black hover:from-gray-800 hover:to-gray-900 border border-gray-700/50 shadow-2xl hover:shadow-3xl transition-all duration-300 text-white hover:scale-110 relative overflow-hidden ${o}`,title:"Ilovani yuklab olish",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-transparent rounded-2xl"}),e.jsx(b,{size:"md"})]}),i&&P&&e.jsx(f,{})]}):s==="navbar"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:m,className:`flex items-center gap-3 px-4 py-3 rounded-2xl bg-gradient-to-r from-gray-900 via-gray-800 to-black hover:from-gray-800 hover:to-gray-900 border border-gray-700/50 shadow-xl hover:shadow-2xl transition-all duration-300 text-white hover:scale-105 relative overflow-hidden ${o}`,title:"Ilovani yuklab olish",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-transparent rounded-2xl"}),e.jsx(b,{size:"sm"}),e.jsx("span",{className:"hidden sm:inline text-sm font-semibold",children:"Yuklab olish"})]}),i&&P&&e.jsx(f,{})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:m,className:`flex items-center gap-4 px-8 py-4 bg-gradient-to-r from-gray-900 via-gray-800 to-black hover:from-gray-800 hover:to-gray-900 text-white rounded-3xl shadow-2xl hover:shadow-3xl border border-gray-700/50 transition-all duration-300 font-semibold text-lg hover:scale-105 relative overflow-hidden ${o}`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-transparent rounded-3xl"}),e.jsx(b,{size:"lg"}),e.jsx("span",{className:"relative z-10",children:"Ilovani yuklab olish"})]}),i&&P&&e.jsx(f,{})]})}function oa({items:s,basePath:o,collapsed:r=!1,setCollapsed:h}){var f;const{user:i,logout:S,updateUser:j}=Ns(),{t:k}=Vs(),[P,q]=t.useState(!1),[C,d]=t.useState({name:"",phone:"",password:""}),m=()=>{d({name:(i==null?void 0:i.name)||"",phone:(i==null?void 0:i.phone)||"",password:""}),q(!0)},b=y=>Q(this,null,function*(){var T,E;y.preventDefault();try{const $={name:C.name,phone:C.phone};C.password&&($.password=C.password);const N=yield K.put("/auth/profile",$);j(N.data),q(!1)}catch($){alert(((E=(T=$.response)==null?void 0:T.data)==null?void 0:E.message)||"Xatolik yuz berdi")}});return e.jsxs("aside",{className:`fixed left-0 top-0 h-full transition-all duration-300 ease-in-out z-50 ${r?"w-16":"w-64"}`,style:{background:"linear-gradient(180deg, #2e1065 0%, #4c1d95 100%)",borderRight:"1px solid rgba(6, 182, 212, 0.2)",boxShadow:"4px 0 24px -4px rgba(46, 16, 101, 0.3)"},children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-4",style:{borderBottom:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, transparent 100%)"},children:[!r&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:e.jsx(dt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-base text-white",children:"Sardor"}),e.jsx("p",{className:"text-xs font-medium",style:{color:"#c4b5fd"},children:"Furnitura"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(vt,{variant:"icon"}),e.jsx("button",{onClick:()=>h==null?void 0:h(!r),className:"p-2 rounded-xl transition-all duration-200",style:{background:"rgba(255, 255, 255, 0.1)",color:"#c4b5fd"},children:r?e.jsx(Yt,{className:"w-4 h-4"}):e.jsx(be,{className:"w-4 h-4"})})]})]}),e.jsx("nav",{className:"p-3 space-y-1.5 overflow-y-auto h-[calc(100vh-180px)]",children:s.map((y,T)=>e.jsxs(Na,{to:`${o}${y.path}`,end:y.path==="",className:({isActive:E})=>`
              flex items-center gap-3 px-3 py-3 rounded-xl font-medium transition-all duration-200 group
              ${r?"justify-center px-2":""}
            `,style:({isActive:E})=>({background:E?"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)":"transparent",color:E?"#ffffff":"#c4b5fd",boxShadow:E?"0 4px 12px -2px rgba(6, 182, 212, 0.4)":"none"}),title:r?y.label:void 0,children:[e.jsx("span",{className:"flex-shrink-0 transition-transform group-hover:scale-110",children:y.icon}),!r&&e.jsx("span",{className:"truncate text-sm",children:k(y.label)})]},T))}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3",style:{borderTop:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.2) 100%)"},children:[!r&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5 mb-2 rounded-xl",style:{background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(6, 182, 212, 0.15)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{background:"linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%)"},children:e.jsx("span",{className:"text-sm font-bold text-white",children:(f=i==null?void 0:i.name)==null?void 0:f.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-white truncate",children:i==null?void 0:i.name}),e.jsx("p",{className:"text-xs capitalize font-medium",style:{color:"#a78bfa"},children:i==null?void 0:i.role})]}),(i==null?void 0:i.role)==="admin"&&e.jsx("button",{onClick:m,className:"p-1.5 rounded-lg transition-all duration-200",style:{background:"rgba(6, 182, 212, 0.2)",color:"#67e8f9"},title:"Profilni tahrirlash",children:e.jsx(ps,{className:"w-3.5 h-3.5"})})]}),e.jsxs("button",{onClick:S,className:`flex items-center gap-2 w-full px-3 py-2.5 rounded-xl transition-all duration-200 font-medium text-sm ${r?"justify-center px-2":""}`,style:{color:"#fca5a5"},title:r?"Sign Out":void 0,children:[e.jsx(ut,{className:"w-4 h-4"}),!r&&e.jsx("span",{children:k("sidebar.signout")})]})]}),P&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 -z-10",style:{background:"rgba(46, 16, 101, 0.7)",backdropFilter:"blur(8px)"},onClick:()=>q(!1)}),e.jsxs("div",{className:"w-full sm:w-auto max-w-md p-4 sm:p-8 relative z-10 rounded-t-3xl sm:rounded-3xl flex flex-col max-h-[90vh] overflow-hidden",style:{background:"linear-gradient(145deg, #ffffff 0%, #faf5ff 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 25px 50px -12px rgba(46, 16, 101, 0.35)"},children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between mb-4 sm:mb-8 pb-4 sm:pb-0 border-b border-surface-100 sm:border-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold truncate",style:{color:"#2e1065"},children:k("sidebar.editProfile")}),e.jsx("button",{onClick:()=>q(!1),className:"flex-shrink-0 p-2 rounded-xl transition-all",style:{background:"#f5f3ff",color:"#7c3aed"},children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:b,className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ns,{className:"w-4 h-4"}),k("sidebar.fullName")]}),e.jsxs("div",{className:"relative",children:[e.jsx(ns,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"text",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:k("sidebar.namePlaceholder"),value:C.name,onChange:y=>d(v(g({},C),{name:y.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ds,{className:"w-4 h-4"}),k("sidebar.phoneNumber")]}),e.jsxs("div",{className:"relative",children:[e.jsx(ds,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"tel",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:"+998 (XX) XXX-XX-XX",value:C.phone,onChange:y=>d(v(g({},C),{phone:Ds(y.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(cs,{className:"w-4 h-4"}),k("sidebar.newPassword")]}),e.jsxs("div",{className:"relative",children:[e.jsx(cs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"password",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:k("sidebar.passwordHint"),value:C.password,onChange:y=>d(v(g({},C),{password:y.target.value}))})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>q(!1),className:"flex-1 px-6 py-3.5 font-semibold rounded-2xl transition-all duration-200",style:{background:"#f5f3ff",color:"#7c3aed"},children:k("sidebar.cancel")}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3.5 text-white font-semibold rounded-2xl transition-all duration-200",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 14px -2px rgba(124, 58, 237, 0.4)"},children:k("sidebar.saveChanges")})]})]})})]})]})]})}const sr=[{icon:e.jsx(Wt,{className:"w-5 h-5"}),label:"sidebar.statistics",path:""},{icon:e.jsx(os,{className:"w-5 h-5"}),label:"sidebar.pos",path:"/kassa"},{icon:e.jsx($e,{className:"w-5 h-5"}),label:"sidebar.products",path:"/products"},{icon:e.jsx(Js,{className:"w-5 h-5"}),label:"sidebar.customers",path:"/customers"},{icon:e.jsx(fs,{className:"w-5 h-5"}),label:"sidebar.debts",path:"/debts"},{icon:e.jsx(ht,{className:"w-5 h-5"}),label:"sidebar.helpers",path:"/helpers"}],tr=[{icon:e.jsx(os,{className:"w-5 h-5"}),label:"sidebar.pos",path:""},{icon:e.jsx(fs,{className:"w-5 h-5"}),label:"sidebar.debts",path:"/debts"},{icon:e.jsx(ws,{className:"w-5 h-5"}),label:"sidebar.receipts",path:"/staff-receipts"}];function ar(){const s=Cs(),o=gs(),r=[{path:"/admin",icon:Wt,label:"Bosh sahifa",exact:!0},{path:"/admin/kassa",icon:os,label:"Kassa"},{path:"/admin/products",icon:$e,label:"Tovarlar"},{path:"/admin/debts",icon:ws,label:"Qarzlar"},{path:"/admin/staff-receipts",icon:ft,label:"Cheklar"}],h=(i,S)=>S?s.pathname===i:s.pathname.startsWith(i);return e.jsxs("nav",{className:"lg:hidden fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-2xl border-t border-slate-200/60 z-50 shadow-[0_-4px_20px_-4px_rgba(0,0,0,0.1)]",children:[e.jsx("div",{className:"grid grid-cols-5 h-[72px] max-w-lg mx-auto",children:r.map(i=>{const S=i.icon,j=h(i.path,i.exact);return e.jsxs("button",{onClick:()=>o(i.path),className:`relative flex flex-col items-center justify-center gap-0.5 transition-all duration-300 ${j?"text-blue-600":"text-slate-400 active:text-slate-600"}`,children:[j&&e.jsx("div",{className:"absolute -top-0.5 left-1/2 -translate-x-1/2 w-8 h-1 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full"}),e.jsx("div",{className:`p-2 rounded-2xl transition-all duration-300 ${j?"bg-gradient-to-br from-blue-50 to-indigo-50 shadow-sm":"hover:bg-slate-50"}`,children:e.jsx(S,{className:`w-5 h-5 transition-all duration-300 ${j?"scale-110 text-blue-600":""}`})}),e.jsx("span",{className:`text-[10px] font-semibold transition-all duration-300 ${j?"text-blue-600":"text-slate-500"}`,children:i.label})]},i.path)})}),e.jsx("div",{className:"h-safe-area-inset-bottom bg-white/95"})]})}function rr(){const[s,o]=t.useState(!1);return e.jsxs("div",{className:"min-h-screen",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(oa,{items:sr,basePath:"/admin",collapsed:s,setCollapsed:o})}),e.jsx("main",{className:`
        transition-all duration-300 ease-smooth
        lg:ml-64
        ${s?"lg:ml-[72px]":"lg:ml-64"}
        
        /* Mobile padding */
        2xs:pb-[88px] xs:pb-[88px] sm:pb-[88px] md:pb-0
        2xs:px-2 xs:px-3 sm:px-4 md:px-6 lg:px-8
        2xs:pt-4 xs:pt-4 sm:pt-4 md:pt-6 lg:pt-8
        
        /* Responsive min-height */
        min-h-screen
      `,children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(Gs,{})})}),e.jsx(ar,{})]})}function nr(){const s=gs(),[o,r]=t.useState(0);t.useEffect(()=>{h();const S=setInterval(h,3e4);return()=>clearInterval(S)},[]);const h=()=>Q(this,null,function*(){try{const S=yield K.get("/debts?status=pending_approval");r(S.data.length)}catch(S){console.error("Error fetching pending debts count:",S)}}),i=()=>{s("/admin/debt-approvals")};return o===0?null:e.jsx("div",{className:"relative",children:e.jsxs("button",{onClick:i,className:"relative p-2 rounded-xl bg-amber-100 text-amber-600 hover:bg-amber-200 transition-colors",title:`${o} ta qarz tasdiqlashni kutmoqda`,children:[e.jsx(Ht,{className:"w-5 h-5"}),o>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold",children:o>9?"9+":o})]})})}function us({title:s,showSearch:o,onSearch:r,actions:h,filterOptions:i,filterValue:S,onFilterChange:j}){const[k,P]=t.useState(""),{t:q}=Vs(),{user:C}=Ns(),d=(C==null?void 0:C.role)==="admin",m=b=>{P(b),r==null||r(b)};return e.jsx("header",{className:"sticky top-0 z-40 bg-white/90 backdrop-blur-xl border-b border-slate-200/60 shadow-sm",children:e.jsxs("div",{className:"px-2 sm:px-3 md:px-4 lg:px-6 h-12 sm:h-14 flex items-center justify-between gap-2 sm:gap-3 md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3 min-w-0 flex-shrink",children:[e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"h-8 w-auto max-h-8"}),e.jsx("h1",{className:"text-sm sm:text-base md:text-lg font-bold text-slate-900 truncate",children:s}),e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs text-slate-500 font-medium",children:q("header.live")})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3 flex-shrink-0",children:[i&&i.length>0&&e.jsxs("div",{className:"relative hidden sm:block",children:[e.jsx("select",{value:S,onChange:b=>j==null?void 0:j(b.target.value),className:"appearance-none pl-2 sm:pl-3 pr-6 sm:pr-8 py-1.5 sm:py-2 bg-slate-50 border border-slate-200 rounded-lg text-xs sm:text-sm font-medium text-slate-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 cursor-pointer transition-all duration-200",children:i.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value))}),e.jsx(pt,{className:"absolute right-1.5 sm:right-2 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-400 pointer-events-none"})]}),o&&e.jsxs("div",{className:"relative group",children:[e.jsx(Ge,{className:"absolute left-2 sm:left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 sm:w-4 sm:h-4 text-slate-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx("input",{type:"text",placeholder:q("header.search"),value:k,onChange:b=>m(b.target.value),className:"w-24 sm:w-32 md:w-48 lg:w-64 pl-7 sm:pl-9 pr-2 sm:pr-3 py-1.5 sm:py-2 bg-slate-50 border border-slate-200 rounded-lg text-xs sm:text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 focus:bg-white transition-all duration-200 placeholder:text-slate-400"})]}),d?e.jsx(nr,{}):e.jsxs("button",{className:"relative p-1.5 sm:p-2 rounded-lg bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-all duration-200",children:[e.jsx(Ht,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),e.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-1.5 sm:w-2 h-1.5 sm:h-2 bg-red-500 rounded-full"})]}),e.jsx("button",{className:"hidden sm:block p-1.5 sm:p-2 rounded-lg bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-all duration-200",children:e.jsx(Jt,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),h]})]})})}function ir(){const[s,o]=t.useState("today"),{t:r}=Vs(),[h,i]=t.useState({totalRevenue:0,todaySales:0,weekSales:0,monthSales:0,totalReceipts:0,totalProducts:0,lowStock:0,outOfStock:0,peakHour:""}),[S,j]=t.useState([]),[k,P]=t.useState(!0);t.useEffect(()=>{q()},[]),t.useEffect(()=>{C()},[s]);const q=()=>Q(this,null,function*(){try{const m=yield K.get("/stats");i(m.data)}catch(m){console.error("Error fetching stats:",m)}finally{P(!1)}}),C=()=>Q(this,null,function*(){try{const m=yield K.get(`/stats/chart?period=${s}`);j(m.data)}catch(m){console.error("Error fetching chart data:",m)}}),d=[{icon:Je,label:"dashboard.totalRevenue",value:u(h.totalRevenue),suffix:"UZS",color:"from-emerald-500 to-emerald-600",bgColor:"bg-emerald-50",textColor:"text-emerald-600",trend:"+12.5%",trendUp:!0},{icon:gt,label:s==="today"?"dashboard.todaySales":"dashboard.weeklySales",value:u(s==="today"?h.todaySales:h.weekSales),suffix:"UZS",color:"from-blue-500 to-blue-600",bgColor:"bg-blue-50",textColor:"text-blue-600",trend:"+8.2%",trendUp:!0},{icon:os,label:"dashboard.totalOrders",value:h.totalReceipts.toString(),color:"from-purple-500 to-purple-600",bgColor:"bg-purple-50",textColor:"text-purple-600",trend:"+15.3%",trendUp:!0},{icon:va,label:"dashboard.peakHour",value:h.peakHour||"-",color:"from-orange-500 to-orange-600",bgColor:"bg-orange-50",textColor:"text-orange-600",trend:"",trendUp:!0}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:[e.jsx(us,{title:r("dashboard.title")}),e.jsxs("div",{className:"p-3 lg:p-6 space-y-6 pb-20 lg:pb-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-2xl lg:text-3xl font-bold bg-gradient-to-r from-slate-900 to-slate-700 bg-clip-text text-transparent",children:r("dashboard.overview")}),e.jsx("p",{className:"text-slate-600",children:r("dashboard.description")})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex p-1 bg-white rounded-xl shadow-md border border-slate-200/50 backdrop-blur-sm",children:[e.jsx("button",{onClick:()=>o("today"),className:`px-4 py-2 rounded-lg text-sm font-semibold transition-all duration-300 ${s==="today"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-md shadow-blue-500/25":"text-slate-600 hover:text-slate-900 hover:bg-slate-50"}`,children:r("dashboard.today")}),e.jsx("button",{onClick:()=>o("week"),className:`px-4 py-2 rounded-lg text-sm font-semibold transition-all duration-300 ${s==="week"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-md shadow-blue-500/25":"text-slate-600 hover:text-slate-900 hover:bg-slate-50"}`,children:r("dashboard.thisWeek")})]}),e.jsx("button",{onClick:q,className:"p-2.5 rounded-xl bg-white border border-slate-200/50 text-slate-600 hover:text-slate-900 hover:bg-slate-50 transition-all duration-300 shadow-md hover:shadow-lg",title:r("dashboard.refresh"),children:e.jsx(xs,{className:`w-4 h-4 ${k?"animate-spin":""}`})})]})]}),k?e.jsx("div",{className:"grid 2xs:grid-cols-1 xs:grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6",children:[1,2,3,4].map(m=>e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-lg sm:rounded-xl md:rounded-2xl p-3 sm:p-4 md:p-6 shadow-md border border-slate-200/50",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-200 rounded-xl mb-4"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded mb-3 w-3/4"}),e.jsx("div",{className:"h-5 bg-slate-200 rounded w-1/2"})]})},m))}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid 2xs:grid-cols-1 xs:grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6",children:d.map((m,b)=>e.jsxs("div",{className:"group relative bg-white/80 backdrop-blur-sm rounded-lg sm:rounded-xl md:rounded-2xl p-3 sm:p-4 md:p-6 shadow-md border border-slate-200/50 hover:shadow-lg hover:border-slate-300/50 transition-all duration-300 hover:-translate-y-1",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${m.color} opacity-0 group-hover:opacity-5 rounded-2xl transition-opacity duration-300`}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${m.bgColor} flex items-center justify-center group-hover:scale-110 transition-all duration-300 shadow-sm`,children:e.jsx(m.icon,{className:`w-6 h-6 ${m.textColor}`})}),m.trend&&e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold ${m.trendUp?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"}`,children:[m.trendUp?e.jsx(at,{className:"w-3 h-3"}):e.jsx(ya,{className:"w-3 h-3"}),m.trend]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-2xl lg:text-3xl font-bold text-slate-900 leading-none",children:[m.value,m.suffix&&e.jsx("span",{className:"text-base font-normal text-slate-500 ml-1",children:m.suffix})]}),e.jsx("p",{className:"text-slate-600 font-medium text-base",children:r(m.label)})]})]})]},b))})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2 bg-white/80 backdrop-blur-sm rounded-2xl p-5 shadow-md border border-slate-200/50",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-5 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center shadow-sm",children:e.jsx(Fs,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:s==="today"?"Bugungi daromad":"Haftalik daromad"}),e.jsx("p",{className:"text-slate-600 text-sm",children:s==="today"?"Soatlik taqsimot":"Kunlik ko'rsatkichlar"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl border border-slate-200/50",children:[e.jsx("div",{className:"w-3 h-3 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full"}),e.jsx("span",{className:"text-xs text-slate-700 font-semibold",children:"Savdo"})]})]}),e.jsx("div",{className:"h-64 rounded-xl overflow-hidden",children:S.length>0?e.jsx(Ka,{width:"100%",height:"100%",children:e.jsxs(Fa,{data:S,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorSales",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.05})]})}),e.jsx(Ua,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1}),e.jsx(Xa,{dataKey:"date",stroke:"#64748b",fontSize:11,tickLine:!1,axisLine:!1,tick:{fill:"#64748b"}}),e.jsx(Ya,{stroke:"#64748b",fontSize:11,tickLine:!1,axisLine:!1,tick:{fill:"#64748b"}}),e.jsx(Wa,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e2e8f0",borderRadius:"12px",boxShadow:"0 10px 25px -5px rgb(0 0 0 / 0.1)",padding:"12px 16px",backdropFilter:"blur(10px)"},labelStyle:{color:"#0f172a",fontWeight:600,marginBottom:"4px",fontSize:"12px"},formatter:m=>[`${u(m)} UZS`,"Daromad"]}),e.jsx(Ha,{type:"monotone",dataKey:"sales",stroke:"#3b82f6",strokeWidth:3,fill:"url(#colorSales)"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-100 to-slate-200 rounded-2xl flex items-center justify-center mb-4 shadow-sm",children:e.jsx(Fs,{className:"w-8 h-8 text-slate-400"})}),e.jsx("p",{className:"font-semibold text-slate-600",children:"Ma'lumot mavjud emas"}),e.jsx("p",{className:"text-slate-400 mt-1 text-center text-sm max-w-xs",children:"Analitikani ko'rish uchun savdo qilishni boshlang"})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-5 shadow-md border border-slate-200/50",children:[e.jsx("div",{className:"flex items-center justify-between mb-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-50 to-purple-100 flex items-center justify-center shadow-sm",children:e.jsx($e,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Top mahsulotlar"}),e.jsx("p",{className:"text-slate-600 text-sm",children:"Eng ko'p sotilganlar"})]})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-slate-400",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-100 to-slate-200 rounded-2xl flex items-center justify-center mb-4 shadow-sm",children:e.jsx(Ss,{className:"w-8 h-8 text-slate-400"})}),e.jsx("p",{className:"font-semibold text-slate-600",children:"Tez orada"}),e.jsx("p",{className:"text-slate-400 mt-1 text-center text-sm",children:"Mahsulot analitikasi bu yerda ko'rinadi"})]})]})]})]})]})}function lr({isOpen:s,onClose:o,onConfirm:r,title:h,message:i,type:S="info",confirmText:j="OK",cancelText:k="Bekor qilish",showCancel:P=!1}){const q=t.useRef(null);if(t.useEffect(()=>{var b;if(s){(b=q.current)==null||b.focus();const f=y=>{y.key==="Enter"&&(y.preventDefault(),r?r():o()),y.key==="Escape"&&o()};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)}},[s,r,o]),!s)return null;const C={info:e.jsx(wa,{className:"w-7 h-7 text-blue-600"}),success:e.jsx(Gt,{className:"w-7 h-7 text-emerald-600"}),warning:e.jsx(ls,{className:"w-7 h-7 text-amber-600"}),danger:e.jsx(ls,{className:"w-7 h-7 text-red-600"})},d={info:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",success:"bg-gradient-to-br from-emerald-50 to-green-50 border-emerald-200",warning:"bg-gradient-to-br from-amber-50 to-orange-50 border-amber-200",danger:"bg-gradient-to-br from-red-50 to-rose-50 border-red-200"},m={info:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/30",success:"bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 text-white shadow-lg shadow-emerald-500/30",warning:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white shadow-lg shadow-amber-500/30",danger:"bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-white shadow-lg shadow-red-500/30"};return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-4 sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm -z-10",onClick:o}),e.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-3xl w-full sm:w-auto max-w-sm p-4 sm:p-6 shadow-2xl relative z-10 border border-slate-200/50 animate-scale-in",children:[e.jsx("button",{onClick:o,className:"absolute top-4 right-4 p-2 rounded-xl text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition-all",children:e.jsx(be,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col items-center text-center mb-6",children:[e.jsx("div",{className:`w-16 h-16 ${d[S]} rounded-2xl flex items-center justify-center mb-4 border shadow-sm`,children:C[S]}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-slate-900 mb-2",children:h}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:i})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3",children:[P&&e.jsx("button",{onClick:o,className:"flex-1 px-4 sm:px-5 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all duration-200",children:k}),e.jsx("button",{ref:q,onClick:r||o,className:`flex-1 px-4 sm:px-5 py-3 font-semibold rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 ${m[S]}`,children:j})]})]})]})}function rs(){const[s,o]=t.useState({isOpen:!1,title:"",message:"",type:"info",showCancel:!1,confirmText:"OK"}),r=t.useCallback((j,k="Xabar",P="info")=>new Promise(q=>{o({isOpen:!0,title:k,message:j,type:P,showCancel:!1,confirmText:"OK",onConfirm:()=>{o(C=>v(g({},C),{isOpen:!1})),q()}})}),[]),h=t.useCallback((j,k="Tasdiqlash",P="warning")=>new Promise(q=>{o({isOpen:!0,title:k,message:j,type:P,showCancel:!0,confirmText:"Ha",onConfirm:()=>{o(d=>v(g({},d),{isOpen:!1})),q(!0)}});const C=()=>{o(d=>v(g({},d),{isOpen:!1})),q(!1)};o(d=>v(g({},d),{onClose:C}))}),[]),i=t.useCallback(()=>{o(j=>v(g({},j),{isOpen:!1}))},[]),S=e.jsx(lr,{isOpen:s.isOpen,onClose:i,onConfirm:s.onConfirm,title:s.title,message:s.message,type:s.type,showCancel:s.showCancel,confirmText:s.confirmText});return{showAlert:r,showConfirm:h,AlertComponent:S}}const cr="pos_offline_db",or=2,Ve={SALES:"offline_sales",PRODUCTS:"cached_products",STAFF_RECEIPTS:"staff_receipts"};let As=null;const Ps=()=>new Promise((s,o)=>{if(As){s(As);return}const r=indexedDB.open(cr,or);r.onerror=()=>{console.error("IndexedDB: Failed to open database"),o(r.error)},r.onsuccess=()=>{As=r.result,console.log("IndexedDB: Database opened successfully"),s(As)},r.onupgradeneeded=h=>{const i=h.target.result;if(!i.objectStoreNames.contains(Ve.SALES)){const S=i.createObjectStore(Ve.SALES,{keyPath:"id"});S.createIndex("synced","synced",{unique:!1}),S.createIndex("createdAt","createdAt",{unique:!1}),console.log("IndexedDB: Created offline_sales store")}if(i.objectStoreNames.contains(Ve.PRODUCTS)||(i.createObjectStore(Ve.PRODUCTS,{keyPath:"_id"}).createIndex("code","code",{unique:!0}),console.log("IndexedDB: Created cached_products store")),!i.objectStoreNames.contains(Ve.STAFF_RECEIPTS)){const S=i.createObjectStore(Ve.STAFF_RECEIPTS,{keyPath:"id"});S.createIndex("syncStatus","syncStatus",{unique:!1}),S.createIndex("createdAt","createdAt",{unique:!1}),S.createIndex("updatedAt","updatedAt",{unique:!1}),S.createIndex("userId","userId",{unique:!1}),console.log("IndexedDB: Created staff_receipts store")}}}),dr=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const o=Math.random()*16|0;return(s==="x"?o:o&3|8).toString(16)}),da=s=>Q(Fe,null,function*(){const o=yield Ps(),r=v(g({},s),{id:dr(),createdAt:new Date().toISOString(),synced:!1});return new Promise((h,i)=>{const k=o.transaction([Ve.SALES],"readwrite").objectStore(Ve.SALES).add(r);k.onsuccess=()=>{console.log("IndexedDB: Sale saved offline",r.id),h(r)},k.onerror=()=>{console.error("IndexedDB: Failed to save sale"),i(k.error)}})}),ma=()=>Q(Fe,null,function*(){const s=yield Ps();return new Promise((o,r)=>{const j=s.transaction([Ve.SALES],"readonly").objectStore(Ve.SALES).index("synced").getAll(!1);j.onsuccess=()=>{o(j.result||[])},j.onerror=()=>{console.error("IndexedDB: Failed to get unsynced sales"),r(j.error)}})}),yt=s=>Q(Fe,null,function*(){const o=yield Ps();return new Promise((r,h)=>{const i=o.transaction([Ve.SALES],"readwrite"),S=i.objectStore(Ve.SALES);i.onerror=()=>h(i.error);let j=0;const k=s.length;if(k===0){r();return}s.forEach(P=>{const q=S.get(P);q.onsuccess=()=>{const C=q.result;C&&(C.synced=!0,S.put(C)),j++,j===k&&(console.log(`IndexedDB: Marked ${k} sales as synced`),r())},q.onerror=()=>{j++,j===k&&r()}})})}),wt=s=>Q(Fe,null,function*(){const o=yield Ps();return new Promise((r,h)=>{const i=o.transaction([Ve.SALES],"readwrite"),S=i.objectStore(Ve.SALES);i.onerror=()=>h(i.error);let j=0;const k=s.length;if(k===0){r();return}s.forEach(P=>{const q=S.delete(P);q.onsuccess=()=>{j++,j===k&&(console.log(`IndexedDB: Deleted ${k} synced sales`),r())},q.onerror=()=>{j++,j===k&&r()}})})}),qs=()=>Q(Fe,null,function*(){return(yield ma()).length}),xa=s=>Q(Fe,null,function*(){const o=yield Ps();return new Promise((r,h)=>{const S=o.transaction([Ve.PRODUCTS],"readwrite").objectStore(Ve.PRODUCTS),j=S.clear();j.onsuccess=()=>{let k=0;const P=s.length;if(P===0){r();return}s.forEach(q=>{const C=S.add(q);C.onsuccess=()=>{k++,k===P&&(console.log(`IndexedDB: Cached ${P} products`),r())},C.onerror=()=>{k++,k===P&&r()}})},j.onerror=()=>{h(j.error)}})}),Ws=()=>Q(Fe,null,function*(){const s=yield Ps();return new Promise((o,r)=>{const S=s.transaction([Ve.PRODUCTS],"readonly").objectStore(Ve.PRODUCTS).getAll();S.onsuccess=()=>{var j;console.log(`IndexedDB: Retrieved ${((j=S.result)==null?void 0:j.length)||0} cached products`),o(S.result||[])},S.onerror=()=>{console.error("IndexedDB: Failed to get cached products"),r(S.error)}})});let _s=[],Ts=!1;const mr=s=>(_s.push(s),()=>{_s=_s.filter(o=>o!==s)}),Qs=s=>Q(Fe,null,function*(){const o=yield qs();_s.forEach(r=>r(s,o))}),$s=()=>navigator.onLine,ct=()=>Q(Fe,null,function*(){if(Ts)return console.log("Sync: Already syncing, skipping..."),{success:!1,synced:0,error:"Sync already in progress"};if(!$s())return console.log("Sync: Device is offline, skipping..."),{success:!1,synced:0,error:"Device is offline"};Ts=!0,yield Qs("syncing");try{const s=yield ma();if(s.length===0)return console.log("Sync: No unsynced sales to sync"),Ts=!1,yield Qs("idle"),{success:!0,synced:0};console.log(`Sync: Found ${s.length} unsynced sales`);const o=s.map(h=>({offlineId:h.id,items:h.items,total:h.total,paymentMethod:h.paymentMethod,customer:h.customer,isReturn:h.isReturn,createdAt:h.createdAt})),r=yield K.post("/receipts/bulk",{sales:o});if(r.data.success){const h=s.map(i=>i.id);return yield yt(h),yield wt(h),console.log(`Sync: Successfully synced ${h.length} sales`),Ts=!1,yield Qs("success"),{success:!0,synced:h.length}}else throw new Error(r.data.message||"Server returned error")}catch(s){return console.error("Sync: Failed to sync sales",s),Ts=!1,yield Qs("error"),{success:!1,synced:0,error:s.message||"Sync failed"}}}),xr=()=>{window.addEventListener("online",()=>Q(Fe,null,function*(){console.log("Sync: Internet connection restored"),setTimeout(()=>Q(Fe,null,function*(){const s=yield ct();s.success&&s.synced>0&&console.log(`Sync: Auto-synced ${s.synced} sales after reconnection`)}),2e3)})),window.addEventListener("offline",()=>{console.log("Sync: Internet connection lost - sales will be saved locally"),Qs("idle")}),$s()&&setTimeout(()=>{ct()},3e3),console.log("Sync: Event listeners initialized")},ur=()=>Q(Fe,null,function*(){return $s()?ct():{success:!1,synced:0,error:"Internet aloqasi yo'q"}}),hr=()=>{const[s,o]=t.useState($s()),[r,h]=t.useState(0),[i,S]=t.useState(!1),[j,k]=t.useState("idle"),[P,q]=t.useState(!1);t.useEffect(()=>{Q(Fe,null,function*(){yield Ps(),P||(xr(),q(!0));const E=yield qs();h(E)});const f=mr((E,$)=>{k(E),h($),S(E==="syncing")}),y=()=>o(!0),T=()=>o(!1);return window.addEventListener("online",y),window.addEventListener("offline",T),()=>{f(),window.removeEventListener("online",y),window.removeEventListener("offline",T)}},[P]);const C=t.useCallback(b=>Q(Fe,null,function*(){if($s())try{const y=(yield K.get(`/products${b?`?${b}`:""}`)).data;return yield xa(y),y}catch(f){return console.log("Failed to fetch from server, using cache"),Ws()}else return console.log("Offline - using cached products"),Ws()}),[]),d=t.useCallback(b=>Q(Fe,null,function*(){try{const f=yield da(b);if(console.log("Sale saved locally:",f.id),$s())try{yield K.post("/receipts",{items:b.items,total:b.total,paymentMethod:b.paymentMethod,customer:b.customer,isReturn:b.isReturn}),yield yt([f.id]),yield wt([f.id]);const y=yield qs();return h(y),{success:!0,offline:!1}}catch(y){console.log("Server sync failed, sale saved offline");const T=yield qs();return h(T),{success:!0,offline:!0}}else{const y=yield qs();return h(y),{success:!0,offline:!0}}}catch(f){return console.error("Failed to save sale:",f),{success:!1,offline:!1}}}),[]),m=t.useCallback(()=>Q(Fe,null,function*(){const b=yield ur(),f=yield qs();return h(f),b}),[]);return{isOnline:s,pendingCount:r,isSyncing:i,syncStatus:j,fetchProductsWithCache:C,createSaleOfflineFirst:d,manualSync:m}};function Ot(){const{showAlert:s,AlertComponent:o}=rs(),{isOnline:r,pendingCount:h,isSyncing:i,manualSync:S}=hr(),[j,k]=t.useState([]),[P,q]=t.useState([]),[C,d]=t.useState(""),[m,b]=t.useState(!1),[f,y]=t.useState(!1),[T,E]=t.useState(""),[$,N]=t.useState([]),[O,_]=t.useState([]),[Y,ae]=t.useState(!1),[V,L]=t.useState(!1),[je,ie]=t.useState(""),[we,Me]=t.useState(null),[p,B]=t.useState(!1),[U,re]=t.useState([]),[le,A]=t.useState(null),[ne,ce]=t.useState(!1),[ve,c]=t.useState(""),[G,Oe]=t.useState(0),[Be,Se]=t.useState(!1),[ye,_e]=t.useState(null),[R,D]=t.useState(!1),[ge,Ye]=t.useState(!1),De=t.useRef(null),fe=t.useRef(null),[Te,I]=t.useState(15),Ne=(x,W)=>{const ee=x.price;let n=15;W>=100?n=11:W>=10?n=13:n=15;const M=ee*(1+n/100);return Math.round(M)},oe=(x,W)=>W!==void 0?{name:"Maxsus",markupPercent:W,discount:W<15,custom:!0}:x>=100?{name:"100+ dona",markupPercent:11,discount:!0,custom:!1}:x>=10?{name:"10-99 dona",markupPercent:13,discount:!0,custom:!1}:{name:"1-9 dona",markupPercent:15,discount:!1,custom:!1},qe=x=>{_e(x);const W=oe(x.cartQuantity,x.customMarkup);I(W.markupPercent),Se(!0)},ze=()=>{if(!ye)return;const x=ye.costPrice||ye.price/1.15,W=Math.round(x*1.15),ee=Math.round(x*(1+Te/100)),n=W-ee;q(M=>M.map(H=>H._id===ye._id?v(g({},H),{price:ee,customMarkup:Te,originalPrice:W}):H)),Se(!1),_e(null),n>0?s(`Narx kelishtirildi: ${u(W)} â†’ ${u(ee)} (${u(n)} so'm chegirma)`,"Muvaffaqiyat","success"):s(`Narx yangilandi: ${Te}% qo'shimcha`,"Muvaffaqiyat","success")},Ce=()=>Q(this,null,function*(){D(!0),Ye(!1),setTimeout(()=>Q(this,null,function*(){try{if(!fe.current)return;const x=new na("admin-qr-reader");De.current=x,yield x.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},W=>Q(this,null,function*(){const ee=W.match(/\/product\/([a-zA-Z0-9]+)/);if(ee&&ee[1]){const n=ee[1];try{const H=(yield K.get(`/products/public/${n}`)).data;H&&(yield Qe(),J(H),s(`"${H.name}" savatchaga qo'shildi!`,"Muvaffaqiyat","success"))}catch(M){s("Mahsulot topilmadi","Xatolik","warning")}}else{const n=j.find(M=>M.code===W);n?(yield Qe(),J(n),s(`"${n.name}" savatchaga qo'shildi!`,"Muvaffaqiyat","success")):s(`"${W}" kodi bo'yicha mahsulot topilmadi`,"Xatolik","warning")}}),()=>{}),Ye(!0)}catch(x){console.error("Skaner xatosi:",x),s("Kameraga ulanib bo'lmadi","Xatolik","danger"),D(!1)}}),100)}),Qe=()=>Q(this,null,function*(){if(De.current)try{yield De.current.stop(),De.current=null}catch(x){console.error("Skanerni to'xtatishda xatolik:",x)}D(!1),Ye(!1)});t.useEffect(()=>{ss(),ts(),Xe()},[]);const ss=()=>Q(this,null,function*(){try{if(navigator.onLine){const x=yield K.get("/products?mainOnly=true");k(x.data),yield xa(x.data)}else{const x=yield Ws();k(x),x.length===0&&s("Offline rejimda keshda tovarlar yo'q","Ogohlantirish","warning")}}catch(x){console.error("Error fetching products:",x);const W=yield Ws();W.length>0&&(k(W),s("Serverga ulanib bo'lmadi, keshdan yuklandi","Ogohlantirish","warning"))}}),ts=()=>Q(this,null,function*(){try{const x=yield K.get("/customers");re(x.data)}catch(x){console.error("Error fetching customers:",x)}}),Xe=()=>{const x=localStorage.getItem("savedReceipts");x&&_(JSON.parse(x))},Ee=P.reduce((x,W)=>x+W.price*W.cartQuantity,0),Ke=x=>{x==="C"?d(""):x==="âŒ«"?d(W=>W.slice(0,-1)):x==="+"?w(C):d(W=>W+x)},es=x=>{Me(x._id)},w=x=>{const W=j.find(ee=>ee.code===x);W?(J(W),d("")):x&&s("Tovar topilmadi","Xatolik","warning")},J=x=>{q(W=>{const ee=W.find(M=>M._id===x._id);if(ee){const M=ee.cartQuantity+1,H=Ne(x,M);return W.map(de=>de._id===x._id?v(g({},de),{cartQuantity:M,price:H}):de)}const n=Ne(x,1);return[...W,v(g({},x),{cartQuantity:1,price:n})]}),y(!1),E("")},te=()=>{Y?(ae(!1),q([])):(q([]),ae(!0),L(!0))},ue=x=>{if(ie(x),x.length>0){const W=j.filter(ee=>ee.name.toLowerCase().includes(x.toLowerCase())||ee.code.toLowerCase().includes(x.toLowerCase()));N(W)}else N([])},We=x=>{J(x),L(!1),ie("")},He=x=>{q(W=>W.filter(ee=>ee._id!==x))},Pe=x=>{if(E(x),x.length>0){const W=j.filter(ee=>ee.name.toLowerCase().includes(x.toLowerCase())||ee.code.toLowerCase().includes(x.toLowerCase()));N(W)}else N(j)},l=x=>Q(this,null,function*(){if(P.length===0)return;const W=Ee-G,ee={items:P.map(n=>({product:n._id,name:n.name,code:n.code,price:n.price,quantity:n.cartQuantity})),total:Ee,paymentMethod:x,isReturn:Y,customer:le==null?void 0:le._id};try{const n=yield da(ee);if(navigator.onLine)try{if(yield K.post("/receipts",ee),yield yt([n.id]),yield wt([n.id]),W>0&&le&&!Y)try{const M={customer:le._id,amount:W,description:"Xarid qoldig'i - Admin kassa",dueDate:new Date(Date.now()+2592e6),type:"receivable"};yield K.post("/debts",M),s(`${Y?"Qaytarish":"Chek saqlandi"}! ${u(W)} so'm qoldiq qarz daftariga qo'shildi`,"Muvaffaqiyat","success")}catch(M){console.error("Qarz yaratishda xatolik:",M),s(`${Y?"Qaytarish":"Chek saqlandi"}! Qarz yaratishda xatolik yuz berdi`,"Ogohlantirish","warning")}else s(Y?"Qaytarish muvaffaqiyatli!":"Chek saqlandi!","Muvaffaqiyat","success")}catch(M){s("Chek offline saqlandi, keyinroq sinxronlanadi","Ogohlantirish","warning")}else s("Offline rejim: Chek saqlandi, internet qaytganda sinxronlanadi","Ogohlantirish","warning");q([]),b(!1),ae(!1),Oe(0),A(null),ss()}catch(n){console.error("Error creating receipt:",n),s("Xatolik yuz berdi","Xatolik","danger")}}),Z=()=>{if(P.length===0){s("Chek bo'sh","Ogohlantirish","warning");return}const x={id:Date.now().toString(),items:[...P],total:Ee,savedAt:new Date().toLocaleString()},W=[...O,x];_(W),localStorage.setItem("savedReceipts",JSON.stringify(W)),q([]),s("Chek saqlandi!","Muvaffaqiyat","success")},xe=x=>{q(x.items);const W=O.filter(ee=>ee.id!==x.id);_(W),localStorage.setItem("savedReceipts",JSON.stringify(W)),B(!1)},Le=x=>{const W=O.filter(ee=>ee.id!==x);_(W),localStorage.setItem("savedReceipts",JSON.stringify(W))};return e.jsxs("div",{className:`min-h-screen flex flex-col ${Y?"bg-warning-50":"bg-surface-50"}`,children:[o,e.jsxs("header",{className:"bg-white border-b border-surface-200 px-4 lg:px-6 h-14 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-lg font-semibold text-surface-900",children:"Kassa (POS)"}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded-lg text-xs font-medium ${r?"bg-success-100 text-success-700":"bg-danger-100 text-danger-700"}`,children:[r?e.jsx(ka,{className:"w-3.5 h-3.5"}):e.jsx(Sa,{className:"w-3.5 h-3.5"}),r?"Online":"Offline"]}),h>0&&e.jsxs("button",{onClick:()=>Q(this,null,function*(){if(r&&!i){const x=yield S();x.success?s(`${x.synced} ta chek sinxronlandi`,"Muvaffaqiyat","success"):s(x.error||"Sinxronlash xatosi","Xatolik","danger")}}),disabled:!r||i,className:`flex items-center gap-1.5 px-2 py-1 rounded-lg text-xs font-medium ${i?"bg-brand-100 text-brand-700":"bg-warning-100 text-warning-700 hover:bg-warning-200"}`,children:[e.jsx(xs,{className:`w-3.5 h-3.5 ${i?"animate-spin":""}`}),i?"Sinxronlanmoqda...":`${h} ta kutmoqda`]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("button",{onClick:()=>B(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-surface-100 rounded-lg text-sm hover:bg-surface-200 transition-colors",children:[e.jsx(Bs,{className:"w-4 h-4 text-surface-500"}),e.jsx("span",{className:"text-surface-700",children:"Saqlangan"}),O.length>0&&e.jsx("span",{className:"px-1.5 py-0.5 bg-danger-500 text-white text-xs rounded-full font-medium",children:O.length})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col p-2 sm:p-4 lg:p-6 order-first lg:order-none max-h-[60vh] lg:max-h-none overflow-y-auto lg:overflow-y-visible",children:[e.jsxs("div",{className:"mb-2 sm:mb-4 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs sm:text-sm text-surface-600",children:["JAMI: ",P.length," ta mahsulot"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>ce(!ne),className:`flex items-center gap-2 px-3 py-2 rounded-xl text-sm font-medium transition-colors ${le?"bg-brand-100 text-brand-700":"bg-surface-100 text-surface-600 hover:bg-surface-200"}`,children:[e.jsx(ns,{className:"w-4 h-4"}),e.jsx("span",{className:"max-w-32 truncate",children:le?le.name:"Oddiy mijoz"}),e.jsx(pt,{className:"w-4 h-4"})]}),ne&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>ce(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-72 bg-white rounded-xl shadow-lg border border-surface-200 z-50 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-surface-100",children:e.jsx("input",{type:"text",placeholder:"Mijoz qidirish...",value:ve,onChange:x=>c(x.target.value),className:"w-full px-3 py-2 text-sm bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500",autoFocus:!0})}),e.jsxs("div",{className:"max-h-64 overflow-auto",children:[e.jsxs("button",{onClick:()=>{A(null),ce(!1),c("")},className:`w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-surface-50 transition-colors ${le?"":"bg-brand-50"}`,children:[e.jsx("div",{className:"w-8 h-8 bg-surface-200 rounded-lg flex items-center justify-center",children:e.jsx(ns,{className:"w-4 h-4 text-surface-500"})}),e.jsx("span",{className:"text-sm font-medium text-surface-700",children:"Oddiy mijoz"})]}),U.filter(x=>ve===""||x.name.toLowerCase().includes(ve.toLowerCase())||x.phone.includes(ve)).map(x=>e.jsxs("button",{onClick:()=>{A(x),ce(!1),c("")},className:`w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-surface-50 transition-colors ${(le==null?void 0:le._id)===x._id?"bg-brand-50":""}`,children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:x.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-surface-900 truncate",children:x.name}),e.jsx("p",{className:"text-xs text-surface-500",children:x.phone})]}),x.debt>0&&e.jsx("span",{className:"text-xs text-danger-600 font-medium",children:u(x.debt)})]},x._id))]})]})]})]})]}),e.jsxs("div",{className:"flex-1 bg-white rounded-xl border border-surface-200 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 px-4 py-3 bg-surface-50 border-b border-surface-200 text-xs font-semibold text-surface-500 uppercase",children:[e.jsx("div",{className:"col-span-1",children:"Kod"}),e.jsx("div",{className:"col-span-3",children:"Mahsulot"}),e.jsx("div",{className:"col-span-2",children:"Ombor"}),e.jsx("div",{className:"col-span-2 text-center",children:"Soni"}),e.jsx("div",{className:"col-span-2 text-right",children:"Narx"}),e.jsx("div",{className:"col-span-1 text-right",children:"Summa"}),e.jsx("div",{className:"col-span-1 text-center",children:"Amallar"})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:P.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-surface-400 py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx($e,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Savat bo'sh"})]})}):e.jsx("div",{className:"divide-y divide-surface-100",children:P.map(x=>e.jsxs("div",{onClick:()=>es(x),className:`grid grid-cols-12 gap-2 px-4 py-3 items-center cursor-pointer transition-colors ${we===x._id?"bg-brand-50 border-l-4 border-brand-500":"hover:bg-surface-50"}`,children:[e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-mono text-surface-600",children:x.code})}),e.jsx("div",{className:"col-span-3",children:e.jsx("span",{className:"text-sm font-medium text-surface-900",children:x.name})}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"text-sm text-surface-500",children:"-"})}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("input",{type:"text",value:x.cartQuantity,onChange:W=>{const ee=W.target.value;if(ee===""||/^\d+$/.test(ee)){const n=ee===""?0:parseInt(ee),M=Ne(x,n);q(H=>H.map(de=>de._id===x._id?v(g({},de),{cartQuantity:n,price:M}):de))}},onBlur:()=>{(x.cartQuantity===0||!x.cartQuantity)&&He(x._id)},className:"w-16 h-9 text-center font-medium border border-surface-200 rounded-xl focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"})}),e.jsx("div",{className:"col-span-2 text-right",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("span",{className:"text-sm text-surface-900",children:u(x.price)}),x.customMarkup!==void 0&&x.originalPrice&&x.originalPrice>x.price&&e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-orange-600 font-bold bg-orange-100 px-1.5 py-0.5 rounded",children:"ðŸ¤ Kelishtirildi"}),e.jsx("span",{className:"text-[10px] text-red-500 line-through",children:u(x.originalPrice)}),e.jsxs("span",{className:"text-[10px] text-green-600 font-semibold",children:["-",u(x.originalPrice-x.price)]})]})]}),(()=>{const W=oe(x.cartQuantity,x.customMarkup);return e.jsxs("div",{onClick:()=>qe(x),className:`text-xs px-2 py-0.5 rounded-full inline-block cursor-pointer hover:opacity-80 transition-opacity ${W.custom?"bg-purple-100 text-purple-700":W.discount?"bg-success-100 text-success-700":"bg-surface-100 text-surface-600"}`,title:"Foizni o'zgartirish uchun bosing",children:[W.name," (",W.markupPercent,"%)"]})})()]})}),e.jsx("div",{className:"col-span-1 text-right",children:e.jsx("span",{className:"text-sm font-semibold text-surface-900",children:u(x.price*x.cartQuantity)})}),e.jsx("div",{className:"col-span-1 flex justify-center",children:e.jsx("button",{onClick:()=>He(x._id),className:"w-7 h-7 flex items-center justify-center rounded-lg text-danger-500 hover:bg-danger-50 transition-colors",children:e.jsx(is,{className:"w-4 h-4"})})})]},x._id))})})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-4",children:[e.jsxs("button",{onClick:Ce,className:"flex items-center gap-2 px-5 py-2.5 bg-purple-500 text-white rounded-xl hover:bg-purple-600 transition-colors",children:[e.jsx(Et,{className:"w-4 h-4"}),"Skaner"]}),!Y&&e.jsxs("button",{onClick:()=>{y(!0),N(j)},className:"flex items-center gap-2 px-5 py-2.5 bg-white border border-surface-200 rounded-xl text-surface-700 hover:bg-surface-50 transition-colors",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Qidirish"]}),e.jsxs("button",{onClick:te,className:`flex items-center gap-2 px-5 py-2.5 rounded-xl transition-colors ${Y?"bg-warning-500 text-white":"bg-warning-100 text-warning-700 hover:bg-warning-200"}`,children:[e.jsx(hs,{className:"w-4 h-4"}),Y?"Qaytarishni bekor qilish":"Qaytarish"]}),Y&&e.jsxs("button",{onClick:()=>L(!0),className:"flex items-center gap-2 px-5 py-2.5 bg-warning-100 text-warning-700 rounded-xl hover:bg-warning-200 transition-colors",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Tovar qo'shish"]}),e.jsxs("button",{onClick:Z,className:"flex items-center gap-2 px-5 py-2.5 bg-white border border-surface-200 rounded-xl text-surface-700 hover:bg-surface-50 transition-colors",children:[e.jsx(Bs,{className:"w-4 h-4"}),"Saqlash"]}),e.jsxs("button",{onClick:()=>{b(!0),Oe(Ee)},disabled:P.length===0,className:"flex items-center gap-2 px-5 py-2.5 bg-success-500 text-white rounded-xl hover:bg-success-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(fs,{className:"w-4 h-4"}),"To'lov"]})]})]}),e.jsxs("div",{className:"w-full lg:w-72 xl:w-80 bg-white border-t lg:border-t-0 lg:border-l border-surface-200 p-1 sm:p-2 lg:p-4 lg:p-6 flex flex-col order-last lg:order-none max-h-[40vh] lg:max-h-none overflow-y-auto lg:overflow-y-visible",children:[e.jsx("div",{className:"text-center lg:text-right mb-2 sm:mb-4 lg:mb-6",children:e.jsxs("p",{className:`text-3xl lg:text-4xl font-bold ${Y?"text-warning-600":"text-surface-900"}`,children:[u(Ee)," so'm"]})}),e.jsx("input",{type:"text",value:C,onChange:x=>d(x.target.value),onKeyDown:x=>x.key==="Enter"&&w(C),placeholder:"Kod kiriting...",className:"w-full px-4 py-3 text-center text-lg font-mono bg-surface-50 border border-surface-200 rounded-xl mb-4 focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"}),e.jsx("div",{className:"grid grid-cols-4 gap-0.5 sm:gap-1 lg:gap-1.5",children:["7","8","9","C","4","5","6","âŒ«","1","2","3","+","0","00","."].map(x=>e.jsx("button",{onClick:()=>Ke(x),className:`
                  flex items-center justify-center rounded-xl text-xs sm:text-lg lg:text-xl font-semibold transition-all active:scale-95
                  ${x==="C"?"bg-danger-500 text-white hover:bg-danger-600":""}
                  ${x==="âŒ«"?"bg-warning-500 text-white hover:bg-warning-600":""}
                  ${x==="+"?"bg-brand-500 text-white hover:bg-brand-600 row-span-2":""}
                  ${["C","âŒ«","+"].includes(x)?"":"bg-surface-100 text-surface-700 hover:bg-surface-200"}
                  ${x==="+"?"h-full":"h-10 sm:h-12 lg:h-16"}
                `,children:x==="âŒ«"?e.jsx(Vt,{className:"w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6"}):x},x))})]})]}),f&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start sm:items-center justify-center pt-4 sm:pt-0 px-4 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm -z-10",onClick:()=>y(!1)}),e.jsxs("div",{className:"bg-white w-full sm:w-auto rounded-t-2xl sm:rounded-2xl shadow-2xl max-w-lg max-h-[90vh] overflow-hidden flex flex-col relative z-10",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 p-4 sm:p-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Nom yoki kod bo'yicha qidiring...",value:T,onChange:x=>Pe(x.target.value),className:"w-full pl-12 pr-4 py-3 bg-surface-50 border border-surface-200 rounded-xl focus:outline-none focus:border-brand-500",autoFocus:!0})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[$.map(x=>e.jsxs("button",{onClick:()=>J(x),className:"w-full flex items-center gap-3 p-4 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx($e,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-surface-900",children:x.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",x.code]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-surface-400",children:["Tan: ",u(x.costPrice||0)]}),e.jsxs("p",{className:"font-semibold text-brand-600",children:["Optom: ",u(x.price)]})]})]},x._id)),T&&$.length===0&&e.jsx("p",{className:"text-center text-surface-500 py-8",children:"Tovar topilmadi"})]})]})]}),m&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm -z-10",onClick:()=>b(!1)}),e.jsxs("div",{className:"bg-white w-full sm:w-auto rounded-t-2xl sm:rounded-2xl shadow-2xl max-w-sm max-h-[90vh] overflow-hidden flex flex-col relative z-10",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 p-4 sm:p-6 text-center",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:Y?"Qaytarish tasdiqlash":"To'lov usuli"}),le&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-brand-600",children:le.name.charAt(0)})}),e.jsx("span",{className:"text-sm text-surface-600 truncate",children:le.name})]}),e.jsxs("p",{className:`text-2xl sm:text-3xl font-bold ${Y?"text-warning-600":"text-surface-900"}`,children:[Y&&"- ",u(Ee)," so'm"]}),Y&&e.jsx("p",{className:"text-sm text-warning-600 mt-2",children:"Bu summa mijozga qaytariladi"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:!Y&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700",children:"To'langan summa"}),e.jsx("input",{type:"number",value:G||"",onChange:x=>Oe(Number(x.target.value)||0),placeholder:"0",className:"w-full px-3 py-2 border border-surface-200 rounded-lg text-center text-lg font-semibold focus:ring-2 focus:ring-brand-500 focus:border-transparent"}),G>0&&G<Ee&&e.jsxs("p",{className:"text-sm text-warning-600",children:["Qoldiq: ",u(Ee-G)," so'm (qarz daftariga qo'shiladi)"]}),G>Ee&&e.jsxs("p",{className:"text-sm text-success-600",children:["Qaytim: ",u(G-Ee)," so'm"]})]})})}),e.jsxs("div",{className:"sticky bottom-0 z-10 bg-white/95 backdrop-blur-sm border-t border-surface-100 p-1.5 sm:p-3 lg:p-4 space-y-1.5 sm:space-y-2",children:[e.jsxs("button",{onClick:()=>l("cash"),className:`w-full flex items-center justify-center gap-0.5 sm:gap-1 py-1.5 sm:py-2 lg:py-3 px-1.5 sm:px-2 text-[10px] sm:text-xs lg:text-sm ${Y?"bg-warning-500 hover:bg-warning-600":"bg-success-500 hover:bg-success-600"} text-white rounded-lg font-semibold transition-colors`,children:[e.jsx(Zt,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Naqd"})]}),e.jsxs("button",{onClick:()=>l("card"),className:"w-full flex items-center justify-center gap-0.5 sm:gap-1 py-1.5 sm:py-2 lg:py-3 px-1.5 sm:px-2 text-[10px] sm:text-xs lg:text-sm bg-brand-500 text-white rounded-lg font-semibold hover:bg-brand-600 transition-colors",children:[e.jsx(fs,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Karta"})]}),e.jsx("button",{onClick:()=>b(!1),className:"w-full py-1 sm:py-1.5 lg:py-2 text-[10px] sm:text-xs text-surface-600 hover:text-surface-900 transition-colors",children:"Bekor"})]})]})]}),V&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start sm:items-center justify-center pt-4 sm:pt-0 px-4 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm -z-10",onClick:()=>{L(!1),P.length===0&&ae(!1)}}),e.jsxs("div",{className:"bg-white w-full sm:w-auto rounded-t-2xl sm:rounded-2xl shadow-2xl max-w-lg max-h-[90vh] overflow-hidden flex flex-col relative z-10",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-warning-50 border-b border-surface-100 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-warning-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(ls,{className:"w-5 h-5 text-warning-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-semibold text-surface-900 truncate",children:"Qaytarish rejimi"}),e.jsx("p",{className:"text-sm text-surface-500 truncate",children:"Qaytariladigan tovarni tanlang"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Tovar nomi yoki kodi...",value:je,onChange:x=>ue(x.target.value),className:"w-full pl-12 pr-4 py-3 bg-white border border-surface-200 rounded-xl focus:outline-none focus:border-warning-500",autoFocus:!0})]})]}),e.jsxs("div",{className:"max-h-80 overflow-auto",children:[$.map(x=>e.jsxs("button",{onClick:()=>We(x),className:"w-full flex items-center gap-3 p-4 hover:bg-warning-50 transition-colors text-left border-b border-surface-50 last:border-0",children:[e.jsx("div",{className:"w-10 h-10 bg-warning-100 rounded-xl flex items-center justify-center",children:e.jsx(hs,{className:"w-5 h-5 text-warning-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-surface-900",children:x.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",x.code]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-surface-400",children:["Tan: ",u(x.costPrice||0)]}),e.jsxs("p",{className:"font-semibold text-warning-600",children:["Optom: ",u(x.price)]})]})]},x._id)),je&&$.length===0&&e.jsx("p",{className:"text-center text-surface-500 py-8",children:"Tovar topilmadi"}),!je&&e.jsx("p",{className:"text-center text-surface-400 py-8",children:"Tovar nomini yoki kodini kiriting"})]}),e.jsx("div",{className:"p-4 border-t border-surface-100 bg-surface-50",children:e.jsx("button",{onClick:()=>{L(!1),P.length===0&&ae(!1)},className:"w-full py-3 text-surface-600 hover:text-surface-900 transition-colors",children:"Bekor qilish"})})]})]}),p&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-20 px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>B(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl relative z-10 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-surface-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-surface-900",children:"Saqlangan cheklar"}),e.jsx("button",{onClick:()=>B(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-surface-100 transition-colors",children:e.jsx(be,{className:"w-5 h-5 text-surface-500"})})]})}),e.jsx("div",{className:"max-h-96 overflow-auto",children:O.length===0?e.jsx("div",{className:"flex items-center justify-center py-12 text-surface-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Bs,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Saqlangan cheklar yo'q"})]})}):e.jsx("div",{className:"divide-y divide-surface-100",children:O.map(x=>e.jsxs("div",{className:"p-4 hover:bg-surface-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-surface-500",children:x.savedAt}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[u(x.total)," so'm"]})]}),e.jsxs("p",{className:"text-sm text-surface-600 mb-3",children:[x.items.length," ta mahsulot"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>xe(x),className:"flex-1 py-1 sm:py-1.5 bg-brand-500 text-white rounded-lg text-[10px] sm:text-xs font-medium hover:bg-brand-600 transition-colors",children:"Yuklash"}),e.jsx("button",{onClick:()=>Le(x.id),className:"px-1.5 sm:px-2 py-1 sm:py-1.5 bg-danger-100 text-danger-600 rounded-lg hover:bg-danger-200 transition-colors",children:e.jsx(is,{className:"w-3 h-3"})})]})]},x.id))})})]})]}),Be&&ye&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{Se(!1),_e(null)}}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"Foizni o'zgartirish"}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-1",children:ye.name}),e.jsxs("p",{className:"text-xs text-surface-500 font-mono mb-2",children:["Kod: ",ye.code]}),e.jsxs("p",{className:"text-sm text-surface-600",children:["Miqdor: ",ye.cartQuantity," ta"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Qo'shimcha foiz (%)"}),e.jsx("input",{type:"number",value:Te,onChange:x=>I(Number(x.target.value)||0),min:"0",max:"100",step:"0.1",className:"w-full px-3 py-2 border border-surface-200 rounded-lg text-center text-lg font-semibold focus:ring-2 focus:ring-brand-500 focus:border-transparent",placeholder:"15"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[5,10,15,20].map(x=>e.jsxs("button",{onClick:()=>I(x),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${Te===x?"bg-brand-500 text-white":"bg-surface-100 text-surface-700 hover:bg-surface-200"}`,children:[x,"%"]},x))}),ye&&e.jsxs("div",{className:"bg-brand-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[e.jsx("span",{className:"text-surface-600",children:"Yangi narx (1 ta):"}),e.jsxs("span",{className:"font-semibold text-brand-600",children:[u(Math.round((ye.costPrice||ye.price/1.15)*(1+Te/100)))," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Jami summa:"}),e.jsxs("span",{className:"font-bold text-brand-700",children:[u(Math.round((ye.costPrice||ye.price/1.15)*(1+Te/100))*ye.cartQuantity)," so'm"]})]})]})]}),e.jsxs("div",{className:"flex gap-1.5 sm:gap-2 mt-3 sm:mt-4",children:[e.jsx("button",{onClick:()=>{Se(!1),_e(null)},className:"flex-1 py-1.5 sm:py-2 px-2 sm:px-3 text-[10px] sm:text-xs bg-surface-100 text-surface-700 rounded-lg font-medium hover:bg-surface-200 transition-colors",children:"Bekor"}),e.jsx("button",{onClick:ze,className:"flex-1 py-1.5 sm:py-2 px-2 sm:px-3 text-[10px] sm:text-xs bg-brand-500 text-white rounded-lg font-medium hover:bg-brand-600 transition-colors",children:"Saqlash"})]})]})]}),R&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Et,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"QR Skaner"})]}),e.jsx("button",{onClick:Qe,className:"w-8 h-8 flex items-center justify-center rounded-lg bg-surface-100 hover:bg-surface-200 transition-colors",children:e.jsx(be,{className:"w-5 h-5 text-surface-600"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{id:"admin-qr-reader",ref:fe,className:"w-full rounded-xl overflow-hidden bg-black",style:{minHeight:"300px"}}),!ge&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{children:"Kamera yuklanmoqda..."})]})})]}),e.jsx("div",{className:"p-4 bg-surface-50 border-t border-surface-200",children:e.jsx("p",{className:"text-sm text-surface-600 text-center",children:"ðŸ“± Mahsulot QR kodini kameraga ko'rsating"})})]})})]})}const fr="/api",pr="https://sardor-furnitura.your-domain.com",gr=fr,Zs=pr;console.log("API Base URL:",gr);console.log("Frontend URL:",Zs);console.log("Environment:","Production");const br=({productId:s,code:o,name:r,price:h,unit:i="dona",dimensions:S="",labelWidth:j=60,labelHeight:k=40,copies:P=1,onPrint:q})=>{const[C,d]=t.useState(""),[m,b]=t.useState(P),f=`${Zs}/product/${s}`,y=$=>new Intl.NumberFormat("uz-UZ").format($);t.useEffect(()=>{T()},[s,o]);const T=()=>Q(Fe,null,function*(){try{const $=yield Nt.toDataURL(f,{width:300,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});d($)}catch($){console.error("QR generation error:",$)}}),E=()=>{const $=window.open("","_blank","width=600,height=400");if(!$){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}let N="";for(let O=0;O<m;O++)N+=`
        <div class="label">
          <div class="top-section">
            <div class="qr-box">
              <img src="${C}" alt="QR" class="qr-code" />
            </div>
            <div class="info-box">
              <div class="product-code">Kod: ${o}</div>
              <div class="product-name">${r}</div>
              ${S?`<div class="product-dimensions">${S}</div>`:""}
            </div>
          </div>
          <div class="bottom-section">
            <div class="price-box">
              <span class="price-value">${y(h)}</span>
              <span class="price-currency">so'm</span>
            </div>
          </div>
        </div>
      `;$.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Label - ${r}</title>
        <style>
          @page {
            size: ${j}mm ${k}mm;
            margin: 0;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, Helvetica, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .label {
            width: ${j}mm;
            height: ${k}mm;
            padding: 2mm;
            background: white;
            display: flex;
            flex-direction: column;
            page-break-after: always;
          }
          .label:last-child {
            page-break-after: auto;
          }
          .top-section {
            display: flex;
            gap: 2mm;
            flex: 1;
          }
          .qr-box {
            width: 22mm;
            height: 22mm;
            flex-shrink: 0;
          }
          .qr-code {
            width: 22mm;
            height: 22mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
          }
          .product-code {
            font-size: 7pt;
            font-weight: 600;
            color: #666;
            margin-bottom: 1mm;
          }
          .product-name {
            font-size: 9pt;
            font-weight: 700;
            color: #000;
            line-height: 1.2;
            text-transform: uppercase;
            word-break: break-word;
          }
          .product-dimensions {
            font-size: 7pt;
            color: #666;
            margin-top: 1mm;
          }
          .bottom-section {
            margin-top: 1.5mm;
          }
          .price-box {
            padding: 1.5mm;
            text-align: center;
            background: #f0f0f0;
            border-radius: 1mm;
          }
          .price-value {
            font-size: 14pt;
            font-weight: 900;
            color: #000;
            letter-spacing: -0.5px;
          }
          .price-currency {
            font-size: 10pt;
            font-weight: 700;
            color: #000;
            margin-left: 1mm;
          }
          @media print {
            body { background: white; }
          }
          @media screen {
            body { background: #e5e7eb; padding: 10mm; }
            .label { 
              margin-bottom: 5mm;
              box-shadow: 0 2px 8px rgba(0,0,0,0.1);
              border: 1px solid #ddd;
            }
          }
        </style>
      </head>
      <body>
        ${N}
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 200);
          }
        <\/script>
      </body>
      </html>
    `),$.document.close(),q==null||q()};return e.jsxs("div",{className:"qr-print-label w-full",children:[e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden mx-auto shadow-md border border-gray-200",style:{width:"280px",padding:"12px"},children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:C?e.jsx("img",{src:C,alt:"QR Code",className:"w-24 h-24",style:{imageRendering:"pixelated"}}):e.jsx("div",{className:"w-24 h-24 bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-gray-400",children:"QR"})})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-500 mb-1",children:["Kod: ",o]}),e.jsx("div",{className:"text-base font-bold text-gray-900 uppercase leading-tight",children:r}),S&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:S})]})]}),e.jsxs("div",{className:"mt-3 bg-gray-100 rounded-lg p-2 text-center",children:[e.jsx("span",{className:"text-2xl font-black text-gray-900",children:y(h)}),e.jsx("span",{className:"text-lg font-bold text-gray-900 ml-1",children:"so'm"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-3",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Nusxa soni:"}),e.jsx("input",{type:"number",min:1,max:100,value:m,onChange:$=>b(parseInt($.target.value)||1),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center"})]}),e.jsxs("button",{onClick:E,className:"mt-4 w-full px-4 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"ðŸ–¨ï¸ Chop etish ",m>1?`(${m} ta)`:""]})]})},jr=({products:s,onClose:o})=>{const[r,h]=t.useState([]),[i,S]=t.useState(!0),[j,k]=t.useState({width:40,height:30,qrSize:18,columns:2,showPrice:!0,showCode:!0}),[P,q]=t.useState(!1),C=$=>new Intl.NumberFormat("uz-UZ").format($);t.useEffect(()=>{d()},[s]);const d=()=>Q(Fe,null,function*(){S(!0);const $=[];for(const N of s){const O=`${Zs}/product/${N._id}`;try{const _=yield Nt.toDataURL(O,{width:200,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});$.push({product:N,copies:1,qrDataUrl:_})}catch(_){console.error("QR error for",N.code,_)}}h($),S(!1)}),m=($,N)=>{h(O=>O.map((_,Y)=>{if(Y===$){const ae=Math.max(1,Math.min(100,_.copies+N));return v(g({},_),{copies:ae})}return _}))},b=($,N)=>{h(O=>O.map((_,Y)=>Y===$?v(g({},_),{copies:Math.max(1,Math.min(100,N))}):_))},f=$=>{h(N=>N.filter((O,_)=>_!==$))},y=$=>{h(N=>N.map(O=>v(g({},O),{copies:$})))},T=()=>r.reduce(($,N)=>$+N.copies,0),E=()=>{const $=window.open("","_blank","width=800,height=600");if(!$){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}let N="";r.forEach(O=>{for(let _=0;_<O.copies;_++)N+=`
          <div class="label">
            <div class="qr-section">
              <img src="${O.qrDataUrl}" alt="QR" class="qr-code" />
            </div>
            <div class="info-section">
              <div class="product-name">${O.product.name.length>18?O.product.name.substring(0,18)+"...":O.product.name}</div>
              ${j.showCode?`<div class="product-code">Kod: ${O.product.code}</div>`:""}
              ${j.showPrice?`<div class="product-price">${C(O.product.price)} so'm</div>`:""}
            </div>
          </div>
        `}),$.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Labels - Batch Print</title>
        <style>
          @page {
            size: ${j.width*j.columns+2}mm auto;
            margin: 1mm;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .labels-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1mm;
          }
          .label {
            width: ${j.width}mm;
            height: ${j.height}mm;
            padding: 1.5mm;
            display: flex;
            align-items: center;
            gap: 1.5mm;
            background: white;
            border: 0.2mm solid #ddd;
            page-break-inside: avoid;
          }
          .qr-section {
            flex-shrink: 0;
          }
          .qr-code {
            width: ${j.qrSize}mm;
            height: ${j.qrSize}mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
          }
          .product-name {
            font-size: 6pt;
            font-weight: 700;
            color: #000;
            line-height: 1.1;
            margin-bottom: 0.3mm;
            text-transform: uppercase;
            word-break: break-word;
          }
          .product-code {
            font-size: 5pt;
            color: #333;
            margin-bottom: 0.3mm;
          }
          .product-price {
            font-size: 7pt;
            font-weight: 900;
            color: #000;
          }
          @media print {
            body { background: white; }
            .label { border: none; }
          }
        </style>
      </head>
      <body>
        <div class="labels-container">
          ${N}
        </div>
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 300);
          }
        <\/script>
      </body>
      </html>
    `),$.document.close()};return i?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-brand-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-surface-600",children:"QR kodlar yaratilmoqda..."})]})}):e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-surface-900",children:"QR Label Chop Etish"}),e.jsxs("p",{className:"text-sm text-surface-500",children:[r.length," ta mahsulot, jami ",T()," ta label"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>q(!P),className:`p-2 rounded-lg transition-colors ${P?"bg-brand-100 text-brand-600":"hover:bg-surface-100"}`,children:e.jsx(Jt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-surface-100 rounded-lg",children:e.jsx(be,{className:"w-5 h-5"})})]})]}),P&&e.jsx("div",{className:"p-4 bg-surface-50 border-b border-surface-200",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Eni (mm)"}),e.jsx("input",{type:"number",value:j.width,onChange:$=>k(N=>v(g({},N),{width:Number($.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"number",value:j.height,onChange:$=>k(N=>v(g({},N),{height:Number($.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"QR (mm)"}),e.jsx("input",{type:"number",value:j.qrSize,onChange:$=>k(N=>v(g({},N),{qrSize:Number($.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Ustunlar"}),e.jsx("input",{type:"number",value:j.columns,onChange:$=>k(N=>v(g({},N),{columns:Number($.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showPrice",checked:j.showPrice,onChange:$=>k(N=>v(g({},N),{showPrice:$.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"showPrice",className:"text-sm",children:"Narx"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showCode",checked:j.showCode,onChange:$=>k(N=>v(g({},N),{showCode:$.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"showCode",className:"text-sm",children:"Kod"})]})]})}),e.jsxs("div",{className:"p-3 border-b border-surface-200 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-surface-500",children:"Barchasi uchun:"}),[1,2,5,10].map($=>e.jsxs("button",{onClick:()=>y($),className:"px-3 py-1 text-sm bg-surface-100 hover:bg-surface-200 rounded-lg transition-colors",children:[$," ta"]},$))]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:r.length===0?e.jsx("div",{className:"text-center py-12 text-surface-500",children:"Mahsulotlar yo'q"}):e.jsx("div",{className:"space-y-2",children:r.map(($,N)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-surface-50 rounded-xl",children:[e.jsx("img",{src:$.qrDataUrl,alt:"QR",className:"w-12 h-12 rounded border border-surface-200"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-surface-900 truncate",children:$.product.name}),e.jsxs("div",{className:"text-sm text-surface-500",children:["Kod: ",$.product.code," â€¢ ",C($.product.price)," so'm"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>m(N,-1),className:"w-8 h-8 flex items-center justify-center bg-surface-200 hover:bg-surface-300 rounded-lg transition-colors",children:e.jsx(Rs,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:$.copies,onChange:O=>b(N,Number(O.target.value)),className:"w-14 text-center px-2 py-1 border border-surface-200 rounded-lg",min:1,max:100}),e.jsx("button",{onClick:()=>m(N,1),className:"w-8 h-8 flex items-center justify-center bg-surface-200 hover:bg-surface-300 rounded-lg transition-colors",children:e.jsx(Ze,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>f(N),className:"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(be,{className:"w-4 h-4"})})]},$.product._id))})}),e.jsxs("div",{className:"p-4 border-t border-surface-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-surface-500",children:["Jami: ",e.jsx("span",{className:"font-bold text-surface-900",children:T()})," ta label"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 text-surface-600 hover:bg-surface-100 rounded-xl transition-colors",children:"Bekor qilish"}),e.jsxs("button",{onClick:E,disabled:r.length===0,className:"px-6 py-2 bg-brand-600 text-white rounded-xl font-medium hover:bg-brand-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(ks,{className:"w-4 h-4"}),"Chop etish"]})]})]})]})})},_t="http://localhost:5000";function Nr(){const{showAlert:s,showConfirm:o,AlertComponent:r}=rs(),[h,i]=t.useState([]),[S,j]=t.useState(null),[k,P]=t.useState(!1),[q,C]=t.useState(!1),[d,m]=t.useState(!1),[b,f]=t.useState(new Set),[y,T]=t.useState(!1),[E,$]=t.useState(!1),[N,O]=t.useState(null),[_,Y]=t.useState(!1),[ae,V]=t.useState("7"),[L,je]=t.useState(null),[ie,we]=t.useState(null),[Me,p]=t.useState(""),[B,U]=t.useState("all"),[re,le]=t.useState(!0),[A,ne]=t.useState(!1),[ce,ve]=t.useState(12500),[c,G]=t.useState({code:"",name:"",description:"",quantity:"",previousPrice:"",currentPrice:"",costPrice:"",costPriceInDollar:"",unitPrice:"",boxPrice:"",pricingTiers:{tier1:{minQuantity:"1",maxQuantity:"5",discountPercent:"15"},tier2:{minQuantity:"6",maxQuantity:"20",discountPercent:"13"},tier3:{minQuantity:"21",maxQuantity:"100",discountPercent:"11"}},unit:"dona",dimensions:{width:"",height:"",length:""},metersPerRoll:"",unitsPerBox:"",meterPriceRanges:[{from:"",to:"",price:""}],pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),[Oe,Be]=t.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[Se,ye]=t.useState([]),[_e,R]=t.useState(""),[D,ge]=t.useState(!1),[Ye,De]=t.useState(!1),[fe,Te]=t.useState("add"),[I,Ne]=t.useState(""),oe=t.useRef(null),qe=()=>{if(!L)return;const n=document.getElementById("qr-code-svg");if(!n)return;const M=new XMLSerializer().serializeToString(n),H=document.createElement("canvas"),de=H.getContext("2d"),ke=document.createElement("img");ke.onload=()=>{H.width=ke.width,H.height=ke.height,de==null||de.drawImage(ke,0,0);const a=H.toDataURL("image/png"),z=document.createElement("a");z.download=`QR-${L.code}-${L.name}.png`,z.href=a,z.click()},ke.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(M)))},ze=n=>Q(this,null,function*(){if(n)try{const M=(ie==null?void 0:ie._id)||"";(yield K.get(`/products/check-code/${n}${M?`?excludeId=${M}`:""}`)).data.exists?R(`Kod "${n}" allaqachon mavjud`):R("")}catch(M){console.error("Error checking code:",M)}});t.useEffect(()=>{Ce()},[]),t.useEffect(()=>{S&&Qe()},[S]);const Ce=()=>Q(this,null,function*(){try{const M=(yield K.get("/warehouses")).data.find(H=>H.name==="Asosiy ombor");if(M)j(M);else{const H=yield K.post("/warehouses",{name:"Asosiy ombor",address:""});j(H.data)}}catch(n){console.error("Error fetching warehouses:",n),le(!1)}}),Qe=()=>Q(this,null,function*(){var n,M,H,de;try{const ke=yield K.get("/products?mainOnly=true");i(ke.data)}catch(ke){console.error("Error fetching products:",ke);const a=((M=(n=ke.response)==null?void 0:n.data)==null?void 0:M.message)||ke.message||"Mahsulotlarni yuklashda xatolik";console.error("Error details:",{status:(H=ke.response)==null?void 0:H.status,message:a,url:(de=ke.config)==null?void 0:de.url}),s(a,"Xatolik","danger")}finally{le(!1)}}),ss=n=>Q(this,null,function*(){const M=n.target.files;if(!M||M.length===0)return;const H=8-Se.length;if(H<=0){s("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const de=Array.from(M).slice(0,H),ke=new FormData;de.forEach(a=>ke.append("images",a)),ne(!0);try{const a=yield K.post("/products/upload-images",ke,{headers:{"Content-Type":"multipart/form-data"}});ye([...Se,...a.data.images])}catch(a){console.error("Error uploading images:",a),s("Rasmlarni yuklashda xatolik","Xatolik","danger")}finally{ne(!1),oe.current&&(oe.current.value="")}}),ts=n=>Q(this,null,function*(){try{yield K.delete("/products/delete-image",{data:{imagePath:n}}),ye(Se.filter(M=>M!==n))}catch(M){console.error("Error deleting image:",M)}}),Xe=n=>Q(this,null,function*(){var a,z;if(n.preventDefault(),_e){s(_e,"Xatolik","danger");return}let M=Number(c.quantity),H=null;if(D&&Oe.packageCount&&Oe.unitsPerPackage){const F=Number(Oe.packageCount)*Number(Oe.unitsPerPackage);M=ie?Number(c.quantity)+F:F,H={packageCount:Number(Oe.packageCount),unitsPerPackage:Number(Oe.unitsPerPackage),totalUnits:F}}let de=0,ke=0;c.unit==="rulon"&&c.metersPerRoll&&(de=M*Number(c.metersPerRoll)),c.unit==="karobka"&&c.unitsPerBox&&(ke=M*Number(c.unitsPerBox));try{const F={code:c.code,name:c.name,description:c.description||"",price:Number(c.unitPrice)||Number(c.currentPrice),costPrice:Number(c.costPrice)||0,unitPrice:Number(c.unitPrice)||Number(c.currentPrice)||0,boxPrice:Number(c.boxPrice)||0,previousPrice:Number(c.previousPrice)||0,currentPrice:Number(c.currentPrice)||0,pricingTiers:{tier1:{minQuantity:Number(c.pricingTiers.tier1.minQuantity)||1,maxQuantity:Number(c.pricingTiers.tier1.maxQuantity)||5,discountPercent:Number(c.pricingTiers.tier1.discountPercent)||15},tier2:{minQuantity:Number(c.pricingTiers.tier2.minQuantity)||6,maxQuantity:Number(c.pricingTiers.tier2.maxQuantity)||20,discountPercent:Number(c.pricingTiers.tier2.discountPercent)||13},tier3:{minQuantity:Number(c.pricingTiers.tier3.minQuantity)||21,maxQuantity:Number(c.pricingTiers.tier3.maxQuantity)||100,discountPercent:Number(c.pricingTiers.tier3.discountPercent)||11}},quantity:M,warehouse:S==null?void 0:S._id,images:Se,packageInfo:H,unit:c.unit,costPriceInDollar:Number(c.costPriceInDollar)||0,dollarRate:ce,dimensions:{width:c.dimensions.width||"",height:c.dimensions.height||"",length:c.dimensions.length||""},metersPerRoll:Number(c.metersPerRoll)||0,unitsPerBox:Number(c.unitsPerBox)||0,totalMeters:de,totalUnits:ke,meterPriceRanges:c.meterPriceRanges.filter(X=>X.from&&X.to&&X.price).map(X=>({from:Number(X.from),to:Number(X.to),price:Number(X.price)})),prices:{perUnit:Number(c.unitPrice)||Number(c.currentPrice),perRoll:Number(c.pricePerRoll)||0,perBox:Number(c.boxPrice)||Number(c.pricePerBox)||0,perKg:Number(c.pricePerKg)||0,perGram:Number(c.pricePerGram)||0}};ie?yield K.put(`/products/${ie._id}`,F):yield K.post("/products",F),Qe(),Pe()}catch(F){s(((z=(a=F.response)==null?void 0:a.data)==null?void 0:z.message)||"Xatolik yuz berdi","Xatolik","danger")}}),Ee=n=>Q(this,null,function*(){if(yield o("Tovarni o'chirishni tasdiqlaysizmi?","O'chirish"))try{yield K.delete(`/products/${n}`),Qe()}catch(H){console.error("Error deleting product:",H)}}),Ke=n=>{var H,de,ke,a,z,F,X,me,he,se,pe,Ae,as,Ls,kt,St,Ct,Pt,qt,zt,$t,Mt,Tt,Qt,Rt,Dt;we(n);const M=n;ve(M.dollarRate||12500),G({code:n.code,name:n.name,description:M.description||"",previousPrice:String(M.previousPrice||0),currentPrice:String(M.currentPrice||n.price),costPrice:String(M.costPrice||0),costPriceInDollar:String(M.costPriceInDollar||0),unitPrice:String(M.unitPrice||M.currentPrice||n.price),boxPrice:String(M.boxPrice||0),pricingTiers:{tier1:{minQuantity:String(((de=(H=M.pricingTiers)==null?void 0:H.tier1)==null?void 0:de.minQuantity)||1),maxQuantity:String(((a=(ke=M.pricingTiers)==null?void 0:ke.tier1)==null?void 0:a.maxQuantity)||5),discountPercent:String(((F=(z=M.pricingTiers)==null?void 0:z.tier1)==null?void 0:F.discountPercent)||15)},tier2:{minQuantity:String(((me=(X=M.pricingTiers)==null?void 0:X.tier2)==null?void 0:me.minQuantity)||6),maxQuantity:String(((se=(he=M.pricingTiers)==null?void 0:he.tier2)==null?void 0:se.maxQuantity)||20),discountPercent:String(((Ae=(pe=M.pricingTiers)==null?void 0:pe.tier2)==null?void 0:Ae.discountPercent)||13)},tier3:{minQuantity:String(((Ls=(as=M.pricingTiers)==null?void 0:as.tier3)==null?void 0:Ls.minQuantity)||21),maxQuantity:String(((St=(kt=M.pricingTiers)==null?void 0:kt.tier3)==null?void 0:St.maxQuantity)||100),discountPercent:String(((Pt=(Ct=M.pricingTiers)==null?void 0:Ct.tier3)==null?void 0:Pt.discountPercent)||11)}},quantity:String(n.quantity),unit:n.unit||"dona",dimensions:{width:((qt=M.dimensions)==null?void 0:qt.width)||"",height:((zt=M.dimensions)==null?void 0:zt.height)||"",length:(($t=M.dimensions)==null?void 0:$t.length)||""},metersPerRoll:String(M.metersPerRoll||""),unitsPerBox:String(M.unitsPerBox||""),meterPriceRanges:((Mt=M.meterPriceRanges)==null?void 0:Mt.length)>0?M.meterPriceRanges.map(et=>({from:String(et.from||""),to:String(et.to||""),price:String(et.price||"")})):[{from:"",to:"",price:""}],pricePerRoll:String(((Tt=n.prices)==null?void 0:Tt.perRoll)||""),pricePerBox:String(((Qt=n.prices)==null?void 0:Qt.perBox)||""),pricePerKg:String(((Rt=n.prices)==null?void 0:Rt.perKg)||""),pricePerGram:String(((Dt=n.prices)==null?void 0:Dt.perGram)||"")}),ye(M.images||[]),Be({packageCount:"",unitsPerPackage:"",totalCost:""}),R(""),ge(!1),P(!0)},es=n=>{je(n),C(!0)},w=n=>{f(M=>{const H=new Set(M);return H.has(n)?H.delete(n):H.add(n),H})},J=()=>{b.size===x.length?f(new Set):f(new Set(x.map(n=>n._id)))},te=()=>{if(b.size===0){s("Kamida bitta mahsulot tanlang","Ogohlantirish","warning");return}m(!0)},ue=()=>{T(!1),f(new Set)},We=(n,M="7")=>Q(this,null,function*(){je(n),$(!0),Y(!0),V(M);try{const H=yield K.get(`/products/stats/${n._id}?period=${M}`);O(H.data)}catch(H){console.error("Error fetching product stats:",H),s("Statistikani yuklashda xatolik","Xatolik","danger")}finally{Y(!1)}}),He=n=>Q(this,null,function*(){if(L){V(n),Y(!0);try{const M=yield K.get(`/products/stats/${L._id}?period=${n}`);O(M.data)}catch(M){console.error("Error fetching product stats:",M)}finally{Y(!1)}}}),Pe=()=>{P(!1),we(null),ve(12500),G({code:"",name:"",description:"",quantity:"",previousPrice:"",currentPrice:"",costPrice:"",costPriceInDollar:"",unitPrice:"",boxPrice:"",pricingTiers:{tier1:{minQuantity:"1",maxQuantity:"5",discountPercent:"15"},tier2:{minQuantity:"6",maxQuantity:"20",discountPercent:"13"},tier3:{minQuantity:"21",maxQuantity:"100",discountPercent:"11"}},unit:"dona",dimensions:{width:"",height:"",length:""},metersPerRoll:"",unitsPerBox:"",meterPriceRanges:[{from:"",to:"",price:""}],pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),Be({packageCount:"",unitsPerPackage:"",totalCost:""}),ye([]),R(""),ge(!1)},l=n=>{Te(n),Ne(""),De(!0)},Z=()=>{const n=Number(I)||0;if(n<=0)return;const M=Number(c.quantity)||0;let H=fe==="add"?M+n:M-n;H<0&&(H=0),G(v(g({},c),{quantity:String(H)})),De(!1),Ne("")},xe=()=>Q(this,null,function*(){try{const n=yield K.get("/products/next-code");G({code:n.data.code,name:"",description:"",quantity:"",previousPrice:"",currentPrice:"",costPrice:"",costPriceInDollar:"",unitPrice:"",boxPrice:"",pricingTiers:{tier1:{minQuantity:"1",maxQuantity:"5",discountPercent:"15"},tier2:{minQuantity:"6",maxQuantity:"20",discountPercent:"13"},tier3:{minQuantity:"21",maxQuantity:"100",discountPercent:"11"}},unit:"dona",dimensions:{width:"",height:"",length:""},metersPerRoll:"",unitsPerBox:"",meterPriceRanges:[{from:"",to:"",price:""}],pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""})}catch(n){console.error("Error getting next code:",n)}Be({packageCount:"",unitsPerPackage:"",totalCost:""}),ye([]),R(""),ge(!1),P(!0)}),Le={total:h.length,lowStock:h.filter(n=>n.quantity<=(n.minStock||50)&&n.quantity>0).length,outOfStock:h.filter(n=>n.quantity===0).length,totalValue:h.reduce((n,M)=>n+M.price*M.quantity,0)},x=h.filter(n=>{const M=n.name.toLowerCase().includes(Me.toLowerCase())||n.code.toLowerCase().includes(Me.toLowerCase()),H=B==="all"||B==="low"&&n.quantity<=(n.minStock||50)&&n.quantity>0||B==="out"&&n.quantity===0;return M&&H}),W=[{label:"Jami tovarlar",value:Le.total,icon:$e,color:"brand",filter:"all"},{label:"Kam qolgan",value:Le.lowStock,icon:ls,color:"warning",filter:"low"},{label:"Tugagan",value:Le.outOfStock,icon:be,color:"danger",filter:"out"},{label:"Jami qiymat",value:`${u(Le.totalValue)} so'm`,icon:Je,color:"success",filter:null}],ee=n=>n.images&&n.images.length>0?`${_t}${n.images[0]}`:null;return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsx(us,{title:"Tovarlar (Asosiy ombor)",showSearch:!0,onSearch:p,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[y?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:J,className:"btn-secondary text-xs",children:b.size===x.length?"Bekor":"Barchasi"}),e.jsxs("button",{onClick:te,className:"btn-primary",disabled:b.size===0,children:[e.jsx(ks,{className:"w-4 h-4"}),e.jsxs("span",{className:"hidden sm:inline",children:["QR (",b.size,")"]}),e.jsx("span",{className:"sm:hidden",children:b.size})]}),e.jsx("button",{onClick:ue,className:"btn-icon-sm bg-surface-200 hover:bg-surface-300",children:e.jsx(be,{className:"w-4 h-4"})})]}):e.jsxs("button",{onClick:()=>T(!0),className:"btn-secondary",title:"Bir nechta QR chiqarish",children:[e.jsx(Ca,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Tanlash"})]}),e.jsxs("button",{onClick:xe,className:"btn-primary",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi tovar"})]})]})}),e.jsxs("div",{className:"p-2 sm:p-3 md:p-4 lg:p-6 space-y-3 sm:space-y-4 md:space-y-6 max-w-[1800px] mx-auto",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-2 sm:gap-3 md:gap-4",children:W.map((n,M)=>e.jsxs("div",{onClick:()=>n.filter&&U(n.filter),className:`stat-card p-2 sm:p-3 md:p-4 lg:p-6 ${n.filter?"cursor-pointer hover:shadow-md transition-shadow":""} ${B===n.filter?"ring-2 ring-brand-500":""}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-1 sm:mb-2 md:mb-3",children:e.jsx("div",{className:`stat-icon w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 lg:w-14 lg:h-14 bg-${n.color}-50`,children:e.jsx(n.icon,{className:`w-4 h-4 sm:w-4 sm:h-4 md:w-5 md:h-5 text-${n.color}-600`})})}),e.jsx("p",{className:"stat-value text-sm sm:text-base md:text-xl lg:text-3xl",children:n.value}),e.jsx("p",{className:"stat-label text-[10px] sm:text-xs md:text-sm lg:text-base",children:n.label})]},M))}),e.jsx("div",{className:"card p-0 overflow-hidden",children:re?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):x.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx($e,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Tovarlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md mb-6",children:Me?"Qidiruv bo'yicha tovarlar topilmadi":"Birinchi tovarni qo'shing"}),e.jsx("button",{onClick:xe,className:"btn-primary",children:"Tovar qo'shish"})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid 2xs:grid-cols-1 xs:grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2 sm:gap-3 md:gap-4 lg:gap-5 p-2 sm:p-3 md:p-4 lg:p-5",children:x.map(n=>{var a,z,F;const M=n.unit||"dona",H=X=>{switch(X){case"metr":return"m";case"rulon":return"rulon";case"karobka":return"quti";case"gram":return"g";case"kg":return"kg";case"litr":return"L";default:return"dona"}},de=n.quantity===0?"danger":n.quantity<=(n.minStock||50)?"warning":"success",ke=b.has(n._id);return e.jsxs("div",{className:`bg-white rounded-xl sm:rounded-2xl border-2 hover:shadow-xl transition-all duration-300 overflow-hidden group cursor-pointer ${ke?"border-brand-500 ring-2 ring-brand-200":"border-surface-200 hover:border-brand-300"}`,onClick:()=>y?w(n._id):We(n),children:[e.jsxs("div",{className:"relative aspect-[4/3] bg-gradient-to-br from-surface-100 to-surface-50 overflow-hidden",children:[y&&e.jsx("div",{className:`absolute top-2 left-2 z-20 w-7 h-7 rounded-lg flex items-center justify-center transition-all ${ke?"bg-brand-500 text-white shadow-lg":"bg-white/90 backdrop-blur border-2 border-surface-300"}`,onClick:X=>{X.stopPropagation(),w(n._id)},children:ke&&e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),ee(n)?e.jsx("img",{src:ee(n),alt:n.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-brand-50 to-indigo-50",children:e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-16 md:h-16 bg-white/80 backdrop-blur rounded-xl sm:rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx($e,{className:"w-5 h-5 sm:w-6 sm:h-6 md:w-8 md:h-8 text-brand-500"})})}),e.jsxs("div",{className:`absolute top-1.5 left-1.5 sm:top-2 sm:left-2 md:top-3 md:left-3 px-1.5 sm:px-2 md:px-3 py-0.5 sm:py-1 md:py-1.5 rounded-full text-[10px] sm:text-xs font-bold shadow-lg ${de==="danger"?"bg-gradient-to-r from-red-500 to-rose-500 text-white":de==="warning"?"bg-gradient-to-r from-amber-400 to-orange-400 text-white":"bg-gradient-to-r from-emerald-400 to-green-500 text-white"}`,children:[e.jsx("span",{className:"hidden sm:inline",children:de==="danger"?"âŒ Tugagan":de==="warning"?"âš ï¸ Kam":"âœ“ Mavjud"}),e.jsx("span",{className:"sm:hidden",children:de==="danger"?"âŒ":de==="warning"?"âš ï¸":"âœ“"})]}),e.jsxs("div",{className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2 md:top-3 md:right-3 px-1.5 sm:px-2 md:px-3 py-0.5 sm:py-1 md:py-1.5 bg-black/70 backdrop-blur-sm rounded-full text-[10px] sm:text-xs font-mono text-white font-bold shadow-lg",children:["#",n.code]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-1.5 sm:p-2 md:p-3 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300",children:e.jsxs("div",{className:"flex justify-center gap-1 sm:gap-1.5 md:gap-2",children:[e.jsx("button",{onClick:X=>{X.stopPropagation(),es(n)},className:"w-7 h-7 sm:w-8 sm:h-8 md:w-9 md:h-9 bg-white/95 backdrop-blur-sm rounded-lg sm:rounded-xl flex items-center justify-center text-surface-700 hover:text-brand-600 hover:bg-white transition-all shadow-lg hover:scale-110",children:e.jsx(Ms,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 md:w-4 md:h-4"})}),e.jsx("button",{onClick:X=>{X.stopPropagation(),Ke(n)},className:"w-7 h-7 sm:w-8 sm:h-8 md:w-9 md:h-9 bg-white/95 backdrop-blur-sm rounded-lg sm:rounded-xl flex items-center justify-center text-surface-700 hover:text-amber-600 hover:bg-white transition-all shadow-lg hover:scale-110",children:e.jsx(ps,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 md:w-4 md:h-4"})}),e.jsx("button",{onClick:X=>{X.stopPropagation(),Ee(n._id)},className:"w-7 h-7 sm:w-8 sm:h-8 md:w-9 md:h-9 bg-white/95 backdrop-blur-sm rounded-lg sm:rounded-xl flex items-center justify-center text-surface-700 hover:text-red-600 hover:bg-white transition-all shadow-lg hover:scale-110",children:e.jsx(is,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 md:w-4 md:h-4"})})]})})]}),e.jsxs("div",{className:"p-2 sm:p-3 md:p-4",children:[e.jsx("h3",{className:"font-bold text-surface-900 text-xs sm:text-sm md:text-base mb-1.5 sm:mb-2 md:mb-3 line-clamp-2 min-h-[2rem] sm:min-h-[2.25rem] md:min-h-[2.5rem] group-hover:text-brand-700 transition-colors",children:n.name}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 md:gap-2 mb-1.5 sm:mb-2 md:mb-3 flex-wrap",children:[e.jsxs("div",{className:`flex items-center gap-1 px-1.5 sm:px-2 md:px-3 py-0.5 sm:py-1 md:py-1.5 rounded-lg sm:rounded-xl text-[10px] sm:text-xs md:text-sm font-semibold ${de==="danger"?"bg-red-50 text-red-700 border border-red-200":de==="warning"?"bg-amber-50 text-amber-700 border border-amber-200":"bg-emerald-50 text-emerald-700 border border-emerald-200"}`,children:[M==="metr"||M==="rulon"?e.jsx(Is,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5"}):M==="karobka"?e.jsx(bt,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5"}):M==="gram"||M==="kg"?e.jsx(ea,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5"}):e.jsx($e,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5"}),e.jsxs("span",{children:[n.quantity," ",H(M)]})]}),M==="rulon"&&n.metersPerRoll>0&&e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1 px-1 sm:px-1.5 md:px-2.5 py-0.5 sm:py-1 md:py-1.5 bg-purple-50 rounded-lg sm:rounded-xl text-[9px] sm:text-[10px] md:text-xs text-purple-700 font-semibold border border-purple-200",children:[e.jsx(hs,{className:"w-2 h-2 sm:w-2.5 sm:h-2.5 md:w-3 md:h-3"}),e.jsxs("span",{children:["= ",u(n.quantity*n.metersPerRoll)," m"]})]}),M==="karobka"&&n.unitsPerBox>0&&e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1 px-1 sm:px-1.5 md:px-2.5 py-0.5 sm:py-1 md:py-1.5 bg-orange-50 rounded-lg sm:rounded-xl text-[9px] sm:text-[10px] md:text-xs text-orange-700 font-semibold border border-orange-200",children:[e.jsx(hs,{className:"w-2 h-2 sm:w-2.5 sm:h-2.5 md:w-3 md:h-3"}),e.jsxs("span",{children:["= ",u(n.quantity*n.unitsPerBox)," dona"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 sm:gap-1.5 md:gap-2 mb-1.5 sm:mb-2 md:mb-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-surface-50 to-surface-100 rounded-lg sm:rounded-xl p-1.5 sm:p-2 md:p-3 border border-surface-200",children:[e.jsx("p",{className:"text-[8px] sm:text-[9px] md:text-[10px] text-surface-500 uppercase tracking-wider font-semibold mb-0.5",children:"Tan narxi"}),e.jsxs("p",{className:"font-bold text-surface-900 text-[10px] sm:text-xs md:text-sm",children:[u(n.costPrice||0),e.jsx("span",{className:"text-[8px] sm:text-[9px] md:text-[10px] text-surface-400 ml-0.5",children:"so'm"})]}),n.costPriceInDollar>0&&e.jsxs("p",{className:"text-[8px] sm:text-[9px] text-surface-500 mt-0.5",children:["â‰ˆ $",u(n.costPriceInDollar)]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-brand-50 to-indigo-50 rounded-lg sm:rounded-xl p-1.5 sm:p-2 md:p-3 border border-brand-200",children:[e.jsx("p",{className:"text-[8px] sm:text-[9px] md:text-[10px] text-brand-600 uppercase tracking-wider font-semibold mb-0.5",children:"Dona narxi"}),e.jsxs("p",{className:"font-bold text-brand-700 text-[10px] sm:text-xs md:text-sm",children:[u(n.unitPrice||n.price),e.jsx("span",{className:"text-[8px] sm:text-[9px] md:text-[10px] text-brand-400 ml-0.5",children:"so'm"})]})]})]}),n.boxPrice>0&&e.jsx("div",{className:"mb-1.5 sm:mb-2 md:mb-3",children:e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 rounded-lg sm:rounded-xl p-1.5 sm:p-2 md:p-3 border border-orange-200",children:[e.jsx("p",{className:"text-[8px] sm:text-[9px] md:text-[10px] text-orange-600 uppercase tracking-wider font-semibold mb-0.5",children:"Karobka narxi"}),e.jsxs("p",{className:"font-bold text-orange-700 text-[10px] sm:text-xs md:text-sm",children:[u(n.boxPrice),e.jsx("span",{className:"text-[8px] sm:text-[9px] md:text-[10px] text-orange-400 ml-0.5",children:"so'm"})]})]})}),n.pricingTiers&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-1.5 sm:mb-2",children:[((a=n.pricingTiers.tier1)==null?void 0:a.discountPercent)>0&&e.jsxs("span",{className:"px-1 sm:px-1.5 py-0.5 bg-emerald-50 text-emerald-700 rounded text-[8px] sm:text-[9px] font-semibold border border-emerald-200",children:[n.pricingTiers.tier1.minQuantity,"-",n.pricingTiers.tier1.maxQuantity,": ",n.pricingTiers.tier1.discountPercent,"%"]}),((z=n.pricingTiers.tier2)==null?void 0:z.discountPercent)>0&&e.jsxs("span",{className:"px-1 sm:px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded text-[8px] sm:text-[9px] font-semibold border border-blue-200",children:[n.pricingTiers.tier2.minQuantity,"-",n.pricingTiers.tier2.maxQuantity,": ",n.pricingTiers.tier2.discountPercent,"%"]}),((F=n.pricingTiers.tier3)==null?void 0:F.discountPercent)>0&&e.jsxs("span",{className:"px-1 sm:px-1.5 py-0.5 bg-purple-50 text-purple-700 rounded text-[8px] sm:text-[9px] font-semibold border border-purple-200",children:[n.pricingTiers.tier3.minQuantity,"+: ",n.pricingTiers.tier3.discountPercent,"%"]})]}),n.prices&&(n.prices.perMeter>0||n.prices.perRoll>0||n.prices.perBox>0||n.prices.perKg>0)&&e.jsxs("div",{className:"flex flex-wrap gap-1 pt-1.5 sm:pt-2 border-t border-surface-100",children:[n.prices.perMeter>0&&e.jsxs("span",{className:"px-1 sm:px-1.5 md:px-2.5 py-0.5 sm:py-1 bg-blue-50 text-blue-700 rounded-md sm:rounded-lg text-[9px] sm:text-[10px] md:text-xs font-semibold border border-blue-200",children:["ðŸ“ ",u(n.prices.perMeter),"/m"]}),n.prices.perRoll>0&&e.jsxs("span",{className:"px-1 sm:px-1.5 md:px-2.5 py-0.5 sm:py-1 bg-purple-50 text-purple-700 rounded-md sm:rounded-lg text-[9px] sm:text-[10px] md:text-xs font-semibold border border-purple-200",children:["ðŸŽžï¸ ",u(n.prices.perRoll),"/rulon"]}),n.prices.perBox>0&&e.jsxs("span",{className:"px-1 sm:px-1.5 md:px-2.5 py-0.5 sm:py-1 bg-orange-50 text-orange-700 rounded-md sm:rounded-lg text-[9px] sm:text-[10px] md:text-xs font-semibold border border-orange-200",children:["ðŸ“¦ ",u(n.prices.perBox),"/quti"]}),n.prices.perKg>0&&e.jsxs("span",{className:"px-1 sm:px-1.5 md:px-2.5 py-0.5 sm:py-1 bg-green-50 text-green-700 rounded-md sm:rounded-lg text-[9px] sm:text-[10px] md:text-xs font-semibold border border-green-200",children:["âš–ï¸ ",u(n.prices.perKg),"/kg"]})]})]})]},n._id)})})})})]}),k&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:Pe}),e.jsxs("div",{className:"modal w-full max-w-lg p-6 relative z-10 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:ie?"Tovarni tahrirlash":"Yangi tovar"}),e.jsx("button",{onClick:Pe,className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:Xe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Rasmlar (max 8)"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-2",children:[Se.map((n,M)=>e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:`${_t}${n}`,alt:"",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>ts(n),className:"absolute -top-1 -right-1 w-5 h-5 bg-danger-500 text-white rounded-full flex items-center justify-center",children:e.jsx(be,{className:"w-3 h-3"})})]},M)),Se.length<8&&e.jsx("button",{type:"button",onClick:()=>{var n;return(n=oe.current)==null?void 0:n.click()},disabled:A,className:"aspect-square border-2 border-dashed border-surface-300 rounded-lg flex flex-col items-center justify-center hover:border-brand-500 hover:bg-brand-50 transition-colors",children:A?e.jsx("div",{className:"spinner w-5 h-5 text-brand-600"}):e.jsxs(e.Fragment,{children:[e.jsx(sa,{className:"w-5 h-5 text-surface-400 mb-1"}),e.jsx("span",{className:"text-xs text-surface-500",children:"Yuklash"})]})})]}),e.jsx("input",{ref:oe,type:"file",accept:"image/*",multiple:!0,onChange:ss,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input ${_e?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"1",value:c.code,onChange:n=>G(v(g({},c),{code:n.target.value})),onBlur:n=>ze(n.target.value),required:!0}),_e&&e.jsx("p",{className:"text-sm text-danger-600 mt-1",children:_e})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input",placeholder:"Tovar nomi",value:c.name,onChange:n=>G(v(g({},c),{name:n.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Qisqacha tavsif (ixtiyoriy)"}),e.jsx("textarea",{className:"input min-h-[80px] resize-none",placeholder:"Mahsulot haqida qisqacha ma'lumot...",value:c.description||"",onChange:n=>G(v(g({},c),{description:n.target.value})),maxLength:500}),e.jsxs("p",{className:"text-xs text-surface-400 mt-1",children:[(c.description||"").length,"/500"]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-3 flex items-center gap-2",children:[e.jsx(Is,{className:"w-4 h-4 text-brand-600"}),"O'lchamlar (ixtiyoriy)"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Eni (sm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"50",value:c.dimensions.width,onChange:n=>G(v(g({},c),{dimensions:v(g({},c.dimensions),{width:n.target.value})}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"30",value:c.dimensions.height,onChange:n=>G(v(g({},c),{dimensions:v(g({},c.dimensions),{height:n.target.value})}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Uzunligi (sm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"100",value:c.dimensions.length,onChange:n=>G(v(g({},c),{dimensions:v(g({},c.dimensions),{length:n.target.value})}))})]})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-3 flex items-center gap-2",children:[e.jsx(Is,{className:"w-4 h-4 text-brand-600"}),"O'lchov birligi va Miqdor"]}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Birlik"}),e.jsxs("select",{className:"input",value:c.unit,onChange:n=>G(v(g({},c),{unit:n.target.value})),children:[e.jsx("option",{value:"dona",children:"Dona"}),e.jsx("option",{value:"metr",children:"Metr"}),e.jsx("option",{value:"rulon",children:"Rulon"}),e.jsx("option",{value:"karobka",children:"Karobka"}),e.jsx("option",{value:"kg",children:"Kilogram"}),e.jsx("option",{value:"gram",children:"Gram"}),e.jsx("option",{value:"litr",children:"Litr"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:["Miqdor (",c.unit==="dona"?"dona":c.unit==="metr"?"metr":c.unit==="rulon"?"rulon":c.unit==="karobka"?"karobka":c.unit==="kg"?"kg":c.unit==="gram"?"gram":"litr",")"]}),ie?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 px-3 py-2 bg-surface-100 rounded-lg text-center font-semibold text-surface-900",children:u(c.quantity||0)}),e.jsx("button",{type:"button",onClick:()=>l("add"),className:"btn-icon-sm bg-success-100 text-success-600 hover:bg-success-200",children:e.jsx(Ze,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>l("subtract"),className:"btn-icon-sm bg-danger-100 text-danger-600 hover:bg-danger-200",children:e.jsx(Rs,{className:"w-4 h-4"})})]}):e.jsx("input",{type:"text",className:"input",placeholder:"0",value:Ue(c.quantity),onChange:n=>G(v(g({},c),{quantity:Re(n.target.value)})),required:!0})]})]}),c.unit==="metr"&&e.jsxs("div",{className:"bg-purple-50 rounded-xl p-3 mb-3 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"ðŸŽžï¸ 1 rulonda necha metr?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:c.metersPerRoll,onChange:n=>G(v(g({},c),{metersPerRoll:Re(n.target.value)}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"Rulon narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:Ue(c.pricePerRoll),onChange:n=>G(v(g({},c),{pricePerRoll:Re(n.target.value)}))})]})]}),c.metersPerRoll&&c.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(hs,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"text-sm font-semibold text-purple-700",children:[c.quantity," metr = ",(Number(c.quantity)/Number(c.metersPerRoll)).toFixed(1)," rulon"]})]})]}),c.unit==="dona"&&e.jsxs("div",{className:"bg-orange-50 rounded-xl p-3 mb-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"ðŸ“¦ 1 karobkada necha dona?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"12",value:c.unitsPerBox,onChange:n=>G(v(g({},c),{unitsPerBox:Re(n.target.value)}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"Karobka narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:Ue(c.pricePerBox),onChange:n=>G(v(g({},c),{pricePerBox:Re(n.target.value)}))})]})]}),c.unitsPerBox&&c.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(hs,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-sm font-semibold text-orange-700",children:[c.quantity," dona = ",(Number(c.quantity)/Number(c.unitsPerBox)).toFixed(1)," karobka"]})]})]}),c.unit==="rulon"&&e.jsxs("div",{className:"bg-purple-50 rounded-xl p-3 mb-3 border border-purple-200",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"1 rulonda necha metr?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:c.metersPerRoll,onChange:n=>G(v(g({},c),{metersPerRoll:Re(n.target.value)}))})]})}),c.metersPerRoll&&c.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(hs,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"text-sm font-semibold text-purple-700",children:[c.quantity," rulon = ",u(Number(c.quantity)*Number(c.metersPerRoll))," metr"]})]})]}),c.unit==="karobka"&&e.jsxs("div",{className:"bg-orange-50 rounded-xl p-3 mb-3 border border-orange-200",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"1 karobkada necha dona?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"12",value:c.unitsPerBox,onChange:n=>G(v(g({},c),{unitsPerBox:Re(n.target.value)}))})]})}),c.unitsPerBox&&c.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(hs,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-sm font-semibold text-orange-700",children:[c.quantity," karobka = ",u(Number(c.quantity)*Number(c.unitsPerBox))," dona"]})]})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-3 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4 text-green-600"}),"Narxlar (5 ta)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"ðŸ’µ Tan narxi (Dollar)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",className:"input flex-1",placeholder:"0",step:"0.1",min:"0",value:c.costPriceInDollar,onChange:n=>{const M=parseFloat(n.target.value)||0;G(v(g({},c),{costPriceInDollar:M.toString(),costPrice:(M*ce).toString()}))}}),e.jsx("span",{className:"text-xs font-bold text-surface-600 flex items-center px-2 bg-surface-100 rounded",children:"$"})]}),e.jsxs("p",{className:"text-[10px] text-surface-500 mt-1",children:["= ",u((parseFloat(c.costPriceInDollar)||0)*ce)," so'm"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"ðŸ·ï¸ Dona narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:Ue(c.unitPrice),onChange:n=>G(v(g({},c),{unitPrice:Re(n.target.value)})),required:!0})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 mb-3 border border-blue-200",children:[e.jsx("label",{className:"text-xs font-medium text-blue-700 mb-1 block",children:"ðŸ’± Dollar kursi (1 $ = ? so'm)"}),e.jsx("input",{type:"number",className:"input",placeholder:"12500",step:"1",min:"0",value:ce,onChange:n=>ve(parseFloat(n.target.value)||12500)}),e.jsxs("p",{className:"text-[10px] text-blue-600 mt-1",children:["Hozirgi kurs: 1 $ = ",u(ce)," so'm"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"ðŸ“¦ Karobka narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:Ue(c.boxPrice),onChange:n=>G(v(g({},c),{boxPrice:Re(n.target.value)}))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-green-50 rounded-xl p-4 border border-emerald-200",children:[e.jsx("h5",{className:"text-xs font-semibold text-emerald-800 mb-3 flex items-center gap-2",children:"ðŸŽ¯ Foizli chegirmalar (miqdorga qarab)"}),e.jsxs("div",{className:"bg-white rounded-lg p-3 mb-2 border border-emerald-100",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-bold text-emerald-700 bg-emerald-100 px-2 py-0.5 rounded",children:"1-daraja"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"input text-sm w-16 text-center",placeholder:"1",value:c.pricingTiers.tier1.minQuantity,onChange:n=>G(v(g({},c),{pricingTiers:v(g({},c.pricingTiers),{tier1:v(g({},c.pricingTiers.tier1),{minQuantity:n.target.value})})}))}),e.jsx("span",{className:"text-xs text-emerald-600",children:"dan"}),e.jsx("input",{type:"text",className:"input text-sm w-16 text-center",placeholder:"5",value:c.pricingTiers.tier1.maxQuantity,onChange:n=>G(v(g({},c),{pricingTiers:v(g({},c.pricingTiers),{tier1:v(g({},c.pricingTiers.tier1),{maxQuantity:n.target.value})})}))}),e.jsx("span",{className:"text-xs text-emerald-600",children:"gacha"}),e.jsx("span",{className:"text-xs text-emerald-600 mx-1",children:"="}),e.jsx("input",{type:"text",className:"input text-sm w-16 text-center font-bold",placeholder:"15",value:c.pricingTiers.tier1.discountPercent,onChange:n=>G(v(g({},c),{pricingTiers:v(g({},c.pricingTiers),{tier1:v(g({},c.pricingTiers.tier1),{discountPercent:n.target.value})})}))}),e.jsx("span",{className:"text-xs font-bold text-emerald-700",children:"%"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 mb-2 border border-emerald-100",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-bold text-blue-700 bg-blue-100 px-2 py-0.5 rounded",children:"2-daraja"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"input text-sm w-16 text-center",placeholder:"6",value:c.pricingTiers.tier2.minQuantity,onChange:n=>G(v(g({},c),{pricingTiers:v(g({},c.pricingTiers),{tier2:v(g({},c.pricingTiers.tier2),{minQuantity:n.target.value})})}))}),e.jsx("span",{className:"text-xs text-blue-600",children:"dan"}),e.jsx("input",{type:"text",className:"input text-sm w-16 text-center",placeholder:"20",value:c.pricingTiers.tier2.maxQuantity,onChange:n=>G(v(g({},c),{pricingTiers:v(g({},c.pricingTiers),{tier2:v(g({},c.pricingTiers.tier2),{maxQuantity:n.target.value})})}))}),e.jsx("span",{className:"text-xs text-blue-600",children:"gacha"}),e.jsx("span",{className:"text-xs text-blue-600 mx-1",children:"="}),e.jsx("input",{type:"text",className:"input text-sm w-16 text-center font-bold",placeholder:"13",value:c.pricingTiers.tier2.discountPercent,onChange:n=>G(v(g({},c),{pricingTiers:v(g({},c.pricingTiers),{tier2:v(g({},c.pricingTiers.tier2),{discountPercent:n.target.value})})}))}),e.jsx("span",{className:"text-xs font-bold text-blue-700",children:"%"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-emerald-100",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-bold text-purple-700 bg-purple-100 px-2 py-0.5 rounded",children:"3-daraja"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"input text-sm w-16 text-center",placeholder:"21",value:c.pricingTiers.tier3.minQuantity,onChange:n=>G(v(g({},c),{pricingTiers:v(g({},c.pricingTiers),{tier3:v(g({},c.pricingTiers.tier3),{minQuantity:n.target.value})})}))}),e.jsx("span",{className:"text-xs text-purple-600",children:"dan"}),e.jsx("input",{type:"text",className:"input text-sm w-16 text-center",placeholder:"100",value:c.pricingTiers.tier3.maxQuantity,onChange:n=>G(v(g({},c),{pricingTiers:v(g({},c.pricingTiers),{tier3:v(g({},c.pricingTiers.tier3),{maxQuantity:n.target.value})})}))}),e.jsx("span",{className:"text-xs text-purple-600",children:"gacha"}),e.jsx("span",{className:"text-xs text-purple-600 mx-1",children:"="}),e.jsx("input",{type:"text",className:"input text-sm w-16 text-center font-bold",placeholder:"11",value:c.pricingTiers.tier3.discountPercent,onChange:n=>G(v(g({},c),{pricingTiers:v(g({},c.pricingTiers),{tier3:v(g({},c.pricingTiers.tier3),{discountPercent:n.target.value})})}))}),e.jsx("span",{className:"text-xs font-bold text-purple-700",children:"%"})]})]}),e.jsx("p",{className:"text-[10px] text-emerald-600 mt-2 italic",children:"* Masalan: 1-5 dona = 15% chegirma, 6-20 dona = 13% chegirma, 21-100 dona = 11% chegirma"})]}),e.jsxs("div",{className:"mt-4 mb-4 hidden",children:[e.jsxs("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:[c.unit==="metr"?"ðŸ“ Metr narxi":c.unit==="rulon"?"ðŸŽžï¸ Rulon narxi":c.unit==="karobka"?"ðŸ“¦ Karobka narxi":c.unit==="kg"?"âš–ï¸ Kg narxi":c.unit==="gram"?"âš–ï¸ Gram narxi":c.unit==="litr"?"ðŸ’§ Litr narxi":"ðŸ’° Dona narxi"," (so'm)"]}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:Ue(c.currentPrice),onChange:n=>G(v(g({},c),{currentPrice:Re(n.target.value)}))})]}),(c.unit==="metr"||c.unit==="rulon")&&e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 mb-3 border border-blue-200",children:[e.jsx("label",{className:"text-xs font-medium text-blue-700 mb-2 block",children:"ðŸ“ Metr narxlari (diapazon bo'yicha)"}),c.meterPriceRanges.map((n,M)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",className:"input text-sm w-16",placeholder:"1",value:n.from,onChange:H=>{const de=[...c.meterPriceRanges];de[M].from=H.target.value,G(v(g({},c),{meterPriceRanges:de}))}}),e.jsx("span",{className:"text-xs text-blue-600",children:"dan"}),e.jsx("input",{type:"text",className:"input text-sm w-16",placeholder:"10",value:n.to,onChange:H=>{const de=[...c.meterPriceRanges];de[M].to=H.target.value,G(v(g({},c),{meterPriceRanges:de}))}}),e.jsx("span",{className:"text-xs text-blue-600",children:"gacha"}),e.jsx("input",{type:"text",className:"input text-sm flex-1",placeholder:"Narx",value:Ue(n.price),onChange:H=>{const de=[...c.meterPriceRanges];de[M].price=Re(H.target.value),G(v(g({},c),{meterPriceRanges:de}))}}),e.jsx("span",{className:"text-xs text-blue-600",children:"so'm"}),c.meterPriceRanges.length>1&&e.jsx("button",{type:"button",onClick:()=>{const H=c.meterPriceRanges.filter((de,ke)=>ke!==M);G(v(g({},c),{meterPriceRanges:H}))},className:"w-6 h-6 bg-red-100 text-red-600 rounded flex items-center justify-center hover:bg-red-200",children:e.jsx(be,{className:"w-3 h-3"})})]},M)),e.jsxs("button",{type:"button",onClick:()=>G(v(g({},c),{meterPriceRanges:[...c.meterPriceRanges,{from:"",to:"",price:""}]})),className:"text-xs text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1",children:[e.jsx(Ze,{className:"w-3 h-3"})," Diapazon qo'shish"]})]}),c.unit==="kg"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"âš–ï¸ Kg narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:Ue(c.pricePerKg),onChange:n=>G(v(g({},c),{pricePerKg:Re(n.target.value)}))})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:Pe,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:!!_e,children:"Saqlash"})]})]})]})]}),q&&L&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>C(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 max-h-[90vh] overflow-y-auto rounded-t-2xl sm:rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 sticky top-0 bg-white pb-2 -mt-2 pt-2 border-b border-surface-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"QR Label - Xprinter"}),e.jsx("button",{onClick:()=>C(!1),className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(br,{productId:L._id,code:L.code,name:L.name,price:L.price,unit:L.unit,dimensions:L.dimensions?[L.dimensions.width,L.dimensions.height,L.dimensions.length].filter(Boolean).join(" Ã— "):"",labelWidth:60,labelHeight:40,copies:1,onPrint:()=>C(!1)}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-surface-200 w-full",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-3 text-center",children:"Katta QR (yuklab olish uchun)"}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-white p-3 rounded-xl border border-surface-200",children:e.jsx(Us,{id:"qr-code-svg",value:`${Zs}/product/${L._id}`,size:150,level:"H",includeMargin:!0})})}),e.jsxs("button",{onClick:qe,className:"btn-secondary w-full",children:[e.jsx(jt,{className:"w-4 h-4"}),"PNG yuklab olish"]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg text-xs text-blue-700 w-full",children:[e.jsx("p",{className:"font-medium mb-1",children:"ðŸ“‹ Xprinter sozlamalari:"}),e.jsxs("ul",{className:"space-y-0.5",children:[e.jsx("li",{children:"â€¢ Label o'lchami: 40mm x 30mm"}),e.jsx("li",{children:"â€¢ QR o'lchami: 20mm x 20mm"}),e.jsx("li",{children:"â€¢ Margins: None"})]})]})]})]})]}),Ye&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>De(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:fe==="add"?"Miqdor qo'shish":"Miqdor ayirish"}),e.jsx("button",{onClick:()=>De(!1),className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${fe==="add"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Hozirgi miqdor"}),e.jsxs("p",{className:`text-2xl font-bold ${fe==="add"?"text-success-600":"text-danger-600"}`,children:[u(c.quantity||0)," dona"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:fe==="add"?"Qo'shiladigan miqdor":"Ayiriladigan miqdor"}),e.jsx("input",{type:"text",className:"input text-center text-lg font-semibold",placeholder:"0",value:Ue(I),onChange:n=>Ne(Re(n.target.value)),autoFocus:!0})]}),I&&Number(I)>0&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Yangi miqdor"}),e.jsxs("p",{className:"text-xl font-bold text-surface-900",children:[u(fe==="add"?(Number(c.quantity)||0)+Number(I):Math.max(0,(Number(c.quantity)||0)-Number(I)))," dona"]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>De(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"button",onClick:Z,className:`flex-1 ${fe==="add"?"btn-success":"btn-danger"}`,disabled:!I||Number(I)<=0,children:fe==="add"?"Qo'shish":"Ayirish"})]})]})]})]}),E&&L&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>$(!1)}),e.jsxs("div",{className:"modal w-full max-w-4xl p-6 relative z-10 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-brand-500 to-indigo-600 rounded-xl flex items-center justify-center",children:e.jsx(Fs,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-surface-900",children:L.name}),e.jsx("p",{className:"text-sm text-surface-500",children:"Sotuv statistikasi va tarixi"})]})]}),e.jsx("button",{onClick:()=>$(!1),className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),_?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-10 h-10 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Statistika yuklanmoqda..."})]}):N?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(os,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-600 uppercase",children:"Jami sotilgan"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:u(N.stats.totalSold)}),e.jsxs("p",{className:"text-xs text-blue-500",children:[N.stats.totalReceipts," ta chekda"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(gt,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-600 uppercase",children:"Jami daromad"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:u(N.stats.totalRevenue)}),e.jsx("p",{className:"text-xs text-green-500",children:"so'm"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(js,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-xs font-medium text-purple-600 uppercase",children:"Eng ko'p kun"})]}),N.stats.bestDay?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-lg font-bold text-purple-700",children:N.stats.bestDay.date}),e.jsxs("p",{className:"text-xs text-purple-500",children:[N.stats.bestDay.count," dona sotilgan"]})]}):e.jsx("p",{className:"text-sm text-purple-500",children:"Ma'lumot yo'q"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-4 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ss,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"text-xs font-medium text-orange-600 uppercase",children:"Eng ko'p soat"})]}),N.stats.bestHour?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-lg font-bold text-orange-700",children:N.stats.bestHour.label}),e.jsxs("p",{className:"text-xs text-orange-500",children:[N.stats.bestHour.count," dona sotilgan"]})]}):e.jsx("p",{className:"text-sm text-orange-500",children:"Ma'lumot yo'q"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-surface-200 p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-4 flex items-center gap-2",children:[e.jsx(Ss,{className:"w-4 h-4 text-brand-600"}),"Soatlik statistika (24 soat)"]}),e.jsx("div",{className:"flex items-end gap-1 h-32",children:N.hourlyStats.map((n,M)=>{var a;const H=Math.max(...N.hourlyStats.map(z=>z.count),1),de=n.count/H*100,ke=((a=N.stats.bestHour)==null?void 0:a.hour)===n.hour;return e.jsxs("div",{className:"flex-1 flex flex-col items-center group relative",children:[e.jsx("div",{className:`w-full rounded-t transition-all ${ke?"bg-gradient-to-t from-orange-500 to-amber-400":"bg-gradient-to-t from-brand-500 to-brand-400"} hover:opacity-80`,style:{height:`${Math.max(de,4)}%`}}),e.jsx("span",{className:"text-[8px] text-surface-400 mt-1",children:n.hour}),e.jsxs("div",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-surface-900 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10",children:[n.label,": ",n.count," dona"]})]},M)})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-surface-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 flex items-center gap-2",children:[e.jsx(js,{className:"w-4 h-4 text-brand-600"}),"Sotuv tarixi"]}),e.jsx("div",{className:"flex gap-1",children:[{value:"7",label:"7 kun"},{value:"30",label:"30 kun"},{value:"90",label:"3 oy"},{value:"365",label:"1 yil"},{value:"all",label:"Hammasi"}].map(n=>e.jsx("button",{onClick:()=>He(n.value),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-all ${ae===n.value?"bg-brand-600 text-white":"bg-surface-100 text-surface-600 hover:bg-surface-200"}`,children:n.label},n.value))})]}),(ae==="365"||ae==="all")&&N.monthlyStats&&N.monthlyStats.length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:N.monthlyStats.map((n,M)=>{const H=Math.max(...N.monthlyStats.map(ke=>ke.count),1),de=n.count/H*100;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-surface-600 w-24 flex-shrink-0",children:n.label}),e.jsx("div",{className:"flex-1 bg-surface-100 rounded-full h-6 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-brand-500 to-indigo-500 rounded-full flex items-center justify-end pr-2 transition-all",style:{width:`${Math.max(de,5)}%`},children:n.count>0&&e.jsx("span",{className:"text-[10px] font-bold text-white",children:n.count})})}),e.jsxs("span",{className:"text-xs text-surface-500 w-28 text-right",children:[u(n.revenue)," so'm"]})]},M)})}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:N.periodStats&&N.periodStats.slice(-30).map((n,M)=>{const H=Math.max(...N.periodStats.map(ke=>ke.count),1),de=n.count/H*100;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-surface-600 w-20 flex-shrink-0",children:new Date(n.date).toLocaleDateString("uz-UZ",{day:"numeric",month:"short"})}),e.jsx("div",{className:"flex-1 bg-surface-100 rounded-full h-6 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-brand-500 to-indigo-500 rounded-full flex items-center justify-end pr-2 transition-all",style:{width:`${Math.max(de,5)}%`},children:n.count>0&&e.jsx("span",{className:"text-[10px] font-bold text-white",children:n.count})})}),e.jsxs("span",{className:"text-xs text-surface-500 w-24 text-right",children:[u(n.revenue)," so'm"]})]},M)})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-surface-200 p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-4 flex items-center gap-2",children:[e.jsx(os,{className:"w-4 h-4 text-brand-600"}),"Oxirgi sotuvlar (50 ta)"]}),N.recentSales.length>0?e.jsx("div",{className:"overflow-x-auto max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white",children:e.jsxs("tr",{className:"border-b border-surface-200",children:[e.jsx("th",{className:"text-left py-2 px-3 text-surface-600 font-medium",children:"Sana"}),e.jsx("th",{className:"text-center py-2 px-3 text-surface-600 font-medium",children:"Miqdor"}),e.jsx("th",{className:"text-right py-2 px-3 text-surface-600 font-medium",children:"Narx"}),e.jsx("th",{className:"text-right py-2 px-3 text-surface-600 font-medium",children:"Jami"}),e.jsx("th",{className:"text-left py-2 px-3 text-surface-600 font-medium",children:"Mijoz"})]})}),e.jsx("tbody",{children:N.recentSales.map((n,M)=>{var H;return e.jsxs("tr",{className:"border-b border-surface-100 hover:bg-surface-50",children:[e.jsx("td",{className:"py-2 px-3 text-surface-700",children:new Date(n.date).toLocaleString("uz-UZ",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"py-2 px-3 text-center",children:e.jsx("span",{className:"px-2 py-0.5 bg-brand-100 text-brand-700 rounded-full text-xs font-semibold",children:n.quantity})}),e.jsx("td",{className:"py-2 px-3 text-right text-surface-600",children:u(n.price)}),e.jsx("td",{className:"py-2 px-3 text-right font-semibold text-surface-900",children:u(n.total)}),e.jsx("td",{className:"py-2 px-3 text-surface-600",children:((H=n.customer)==null?void 0:H.name)||"Noma'lum"})]},M)})})]})}):e.jsxs("div",{className:"text-center py-8 text-surface-500",children:[e.jsx(os,{className:"w-12 h-12 mx-auto mb-2 text-surface-300"}),e.jsx("p",{children:"Hali sotuvlar yo'q"})]})]})]}):e.jsxs("div",{className:"text-center py-12 text-surface-500",children:[e.jsx(Fs,{className:"w-16 h-16 mx-auto mb-4 text-surface-300"}),e.jsx("p",{children:"Statistika ma'lumotlari topilmadi"})]})]})]}),d&&e.jsx(jr,{products:h.filter(n=>b.has(n._id)),onClose:()=>{m(!1),T(!1),f(new Set)}})]})}function vr(){const{showAlert:s,showConfirm:o,AlertComponent:r}=rs(),[h,i]=t.useState([]),[S,j]=t.useState(!1),[k,P]=t.useState(!1),[q,C]=t.useState(!1),[d,m]=t.useState(null),[b,f]=t.useState([]),[y,T]=t.useState(null),[E,$]=t.useState(null),[N,O]=t.useState(!0),[_,Y]=t.useState(!1),[ae,V]=t.useState(""),[L,je]=t.useState(!1),[ie,we]=t.useState(null),[Me,p]=t.useState({name:"",address:""}),[B,U]=t.useState({code:"",name:"",costPrice:"",wholesalePrice:"",quantity:""}),[re,le]=t.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[A,ne]=t.useState("");t.useEffect(()=>{ce()},[]);const ce=()=>Q(this,null,function*(){try{const Ne=(yield K.get("/warehouses")).data.filter(oe=>oe.name!=="Asosiy ombor");i(Ne)}catch(I){console.error("Error fetching warehouses:",I)}finally{O(!1)}}),ve=I=>Q(this,null,function*(){Y(!0);try{const Ne=yield K.get(`/products?warehouse=${I}`);f(Ne.data)}catch(Ne){console.error("Error fetching products:",Ne)}finally{Y(!1)}}),c=I=>Q(this,null,function*(){I.preventDefault();try{y?yield K.put(`/warehouses/${y._id}`,Me):yield K.post("/warehouses",Me),ce(),R()}catch(Ne){console.error("Error saving warehouse:",Ne)}}),G=I=>Q(this,null,function*(){var qe,ze;if(I.preventDefault(),!d)return;if(A){s(A,"Xatolik","danger");return}let Ne=0,oe=Number(B.costPrice)||0;if(re.packageCount&&re.unitsPerPackage){const Ce=Number(re.packageCount)*Number(re.unitsPerPackage);Ne=E?E.quantity+Ce:Ce}else E&&(Ne=E.quantity);try{const Ce={code:B.code,name:B.name,costPrice:oe,price:Number(B.wholesalePrice),quantity:Ne,warehouse:d._id};E?yield K.put(`/products/${E._id}`,Ce):yield K.post("/products",Ce),ve(d._id),ge()}catch(Ce){s(((ze=(qe=Ce.response)==null?void 0:qe.data)==null?void 0:ze.message)||"Xatolik yuz berdi","Xatolik","danger")}}),Oe=I=>Q(this,null,function*(){if((yield o("Tovarni o'chirishni tasdiqlaysizmi?","O'chirish"))&&d)try{yield K.delete(`/products/${I}`),ve(d._id)}catch(oe){console.error("Error deleting product:",oe)}}),Be=I=>Q(this,null,function*(){if(yield o("Omborni o'chirishni tasdiqlaysizmi?","O'chirish"))try{yield K.delete(`/warehouses/${I}`),ce()}catch(oe){console.error("Error deleting warehouse:",oe)}}),Se=I=>{m(I),ve(I._id),P(!0)},ye=I=>{T(I),p({name:I.name,address:I.address||""}),j(!0)},_e=I=>{$(I),U({code:I.code,name:I.name,costPrice:String(I.costPrice||0),wholesalePrice:String(I.price),quantity:String(I.quantity)}),ne(""),C(!0)},R=()=>{j(!1),T(null),p({name:"",address:""})},D=()=>{P(!1),m(null),f([]),V("")},ge=()=>{C(!1),$(null),U({code:"",name:"",costPrice:"",wholesalePrice:"",quantity:""}),le({packageCount:"",unitsPerPackage:"",totalCost:""}),ne("")},Ye=()=>Q(this,null,function*(){try{const I=yield K.get("/products/next-code");U(v(g({},B),{code:I.data.code,name:"",costPrice:"",wholesalePrice:"",quantity:""}))}catch(I){console.error("Error getting next code:",I)}le({packageCount:"",unitsPerPackage:"",totalCost:""}),ne(""),C(!0)}),De=I=>Q(this,null,function*(){if(I)try{const Ne=(E==null?void 0:E._id)||"";(yield K.get(`/products/check-code/${I}${Ne?`?excludeId=${Ne}`:""}`)).data.exists?ne(`Kod "${I}" allaqachon mavjud`):ne("")}catch(Ne){console.error("Error checking code:",Ne)}}),fe=I=>{we(I),je(!0)},Te=()=>{if(!ie)return;const I=document.getElementById("qr-code-svg-warehouse");if(!I)return;const Ne=new XMLSerializer().serializeToString(I),oe=document.createElement("canvas"),qe=oe.getContext("2d"),ze=new Image;ze.onload=()=>{oe.width=ze.width,oe.height=ze.height,qe==null||qe.drawImage(ze,0,0);const Ce=oe.toDataURL("image/png"),Qe=document.createElement("a");Qe.download=`QR-${ie.code}-${ie.name}.png`,Qe.href=Ce,Qe.click()},ze.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(Ne)))};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsx(us,{title:"Omborlar",actions:e.jsxs("button",{onClick:()=>j(!0),className:"btn-primary",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi ombor"})]})}),e.jsx("div",{className:"p-4 lg:p-6",children:N?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):h.length===0?e.jsxs("div",{className:"card flex flex-col items-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(At,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Omborlar yo'q"}),e.jsx("p",{className:"text-surface-500 mb-6",children:"Birinchi omborni qo'shing"}),e.jsx("button",{onClick:()=>j(!0),className:"btn-primary",children:"Ombor qo'shish"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(I=>e.jsxs("div",{className:"card-hover cursor-pointer",onClick:()=>Se(I),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(At,{className:"w-6 h-6 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-surface-900",children:I.name}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-surface-500",children:[e.jsx(Xs,{className:"w-3 h-3"}),e.jsx("span",{children:I.address||"Manzil ko'rsatilmagan"})]})]})]}),e.jsxs("div",{className:"flex gap-1",onClick:Ne=>Ne.stopPropagation(),children:[e.jsx("button",{onClick:()=>ye(I),className:"btn-icon-sm hover:bg-brand-100 hover:text-brand-600",children:e.jsx(ps,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Be(I._id),className:"btn-icon-sm hover:bg-danger-100 hover:text-danger-600",children:e.jsx(is,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500 pt-3 border-t border-surface-100",children:[e.jsx($e,{className:"w-4 h-4"}),e.jsxs("span",{children:[I.productCount||0," ta tovar"]})]})]},I._id))})}),S&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:R}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:y?"Omborni tahrirlash":"Yangi ombor"}),e.jsx("button",{onClick:R,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:c,className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Ombor nomi"}),e.jsx("input",{type:"text",className:"input",placeholder:"Ombor nomi",value:Me.name,onChange:I=>p(v(g({},Me),{name:I.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Manzil"}),e.jsxs("div",{className:"relative",children:[e.jsx(Xs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-12",placeholder:"Manzilni kiriting",value:Me.address,onChange:I=>p(v(g({},Me),{address:I.target.value}))})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:R,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Saqlash"})]})]})})]})]}),k&&d&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-2 lg:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:D}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-[98vw] lg:max-w-[95vw] relative z-10 flex flex-col max-h-[96vh] lg:max-h-[94vh]",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 lg:p-6 gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:d.name}),e.jsx("p",{className:"text-sm text-surface-500 truncate",children:"Ombordagi tovarlar"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Qidirish...",value:ae,onChange:I=>V(I.target.value),className:"w-48 lg:w-64 pl-9 pr-4 py-2 bg-surface-50 border border-surface-200 rounded-xl text-sm focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"})]}),e.jsxs("button",{onClick:Ye,className:"btn-primary",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Tovar qo'shish"]}),e.jsx("button",{onClick:D,className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:_?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx($e,{className:"w-12 h-12 text-surface-300 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Bu omborga tovarlar yo'q"}),e.jsx("button",{onClick:Ye,className:"btn-primary mt-4",children:"Tovar qo'shish"})]}):e.jsx("div",{className:"divide-y divide-surface-100",children:b.filter(I=>ae===""||I.name.toLowerCase().includes(ae.toLowerCase())||I.code.toLowerCase().includes(ae.toLowerCase())).map(I=>e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx($e,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:I.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",I.code]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-surface-500",children:["Tan narxi: ",u(I.costPrice||0)," so'm"]}),e.jsxs("p",{className:"font-semibold text-surface-900",children:["Optom: ",u(I.price)," so'm"]}),e.jsxs("p",{className:`text-sm ${I.quantity===0?"text-danger-600":"text-surface-500"}`,children:[I.quantity," dona"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>fe(I),className:"btn-icon-sm hover:bg-surface-200",title:"QR kod",children:e.jsx(Ms,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_e(I),className:"btn-icon-sm hover:bg-brand-100 hover:text-brand-600",children:e.jsx(ps,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Oe(I._id),className:"btn-icon-sm hover:bg-danger-100 hover:text-danger-600",children:e.jsx(is,{className:"w-4 h-4"})})]})]})]},I._id))})})]})]}),q&&d&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:ge}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-lg relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:E?"Tovarni tahrirlash":"Yangi tovar"}),e.jsxs("p",{className:"text-sm text-surface-500 truncate",children:[d.name," uchun"]})]}),e.jsx("button",{onClick:ge,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:G,className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input ${A?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"000001",value:B.code,onChange:I=>U(v(g({},B),{code:I.target.value})),onBlur:I=>De(I.target.value),required:!0}),A&&e.jsx("p",{className:"text-sm text-danger-600 mt-1",children:A})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input",placeholder:"Tovar nomi",value:B.name,onChange:I=>U(v(g({},B),{name:I.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Tan narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:Ue(B.costPrice),onChange:I=>U(v(g({},B),{costPrice:Re(I.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Optom narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:Ue(B.wholesalePrice),onChange:I=>U(v(g({},B),{wholesalePrice:Re(I.target.value)})),required:!0})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4",children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-3 block",children:"Qop ma'lumotlari"}),e.jsx("div",{className:"space-y-3 bg-surface-50 p-4 rounded-xl",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Qoplar soni"}),e.jsx("input",{type:"number",className:"input text-sm",placeholder:"5",value:re.packageCount,onChange:I=>le(v(g({},re),{packageCount:I.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Har qopda"}),e.jsx("input",{type:"number",className:"input text-sm",placeholder:"20",value:re.unitsPerPackage,onChange:I=>le(v(g({},re),{unitsPerPackage:I.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Jami mahsulot"}),e.jsx("input",{type:"text",className:"input text-sm bg-surface-100",placeholder:"0",value:re.packageCount&&re.unitsPerPackage?u(Number(re.packageCount)*Number(re.unitsPerPackage)):"",readOnly:!0})]})]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:ge,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:!!A,children:"Saqlash"})]})]})})]})]}),L&&ie&&e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>je(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-sm relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900",children:"QR Kod"}),e.jsx("button",{onClick:()=>je(!1),className:"flex-shrink-0 btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 flex flex-col items-center",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border border-surface-200 mb-4",children:e.jsx(Us,{id:"qr-code-svg-warehouse",value:JSON.stringify({id:ie._id,code:ie.code,name:ie.name,price:ie.price}),size:200,level:"H",includeMargin:!0})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-semibold text-surface-900",children:ie.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",ie.code]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Tan narxi: ",u(ie.costPrice||0)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Optom: ",u(ie.price)," so'm"]})]}),e.jsxs("button",{onClick:Te,className:"btn-primary w-full",children:[e.jsx(jt,{className:"w-4 h-4"}),"Yuklab olish"]})]})})]})]})]})}const Hs={"Toshkent shahri":["Bektemir","Chilonzor","Mirobod","Mirzo Ulug'bek","Olmazor","Sergeli","Shayxontohur","Uchtepa","Yakkasaroy","Yunusobod","Yashnobod"],"Toshkent viloyati":["Angren","Bekobod","Bo'ka","Bo'stonliq","Chinoz","Chirchiq","Nurafshon","Ohangaron","Olmaliq","Oqqo'rg'on","Parkent","Piskent","Qibray","Quyi Chirchiq","Toshkent","Yangiyo'l","Yuqori Chirchiq","Zangiota"],"Andijon viloyati":["Andijon","Asaka","Baliqchi","Bo'z","Buloqboshi","Izboskan","Jalaquduq","Xo'jaobod","Qo'rg'ontepa","Marhamat","Oltinko'l","Paxtaobod","Shahrixon","Ulug'nor","Xonobod"],"Buxoro viloyati":["Buxoro","G'ijduvon","Jondor","Kogon","Olot","Peshku","Qorako'l","Qorovulbozor","Romitan","Shofirkon","Vobkent"],"Farg'ona viloyati":["Farg'ona","Bag'dod","Beshariq","Buvayda","Dang'ara","Furqat","Qo'qon","Quva","Marg'ilon","Oltiariq","Qo'shtepa","Rishton","So'x","Toshloq","Uchko'prik","Yozyovon"],"Jizzax viloyati":["Jizzax","Arnasoy","Baxmal","Do'stlik","Forish","G'allaorol","Mirzacho'l","Paxtakor","Yangiobod","Zafarobod","Zarband","Zomin"],"Xorazm viloyati":["Urganch","Bog'ot","Gurlan","Xonqa","Hazorasp","Xiva","Qo'shko'pir","Shovot","Tuproqqal'a","Yangiariq","Yangibozor"],"Namangan viloyati":["Namangan","Chortoq","Chust","Kosonsoy","Mingbuloq","Norin","Pop","To'raqo'rg'on","Uchqo'rg'on","Uychi","Yangiqo'rg'on"],"Navoiy viloyati":["Navoiy","Karmana","Konimex","Navbahor","Nurota","Qiziltepa","Tomdi","Uchquduq","Xatirchi","Zarafshon"],"Qashqadaryo viloyati":["Qarshi","Chiroqchi","Dehqonobod","G'uzor","Kasbi","Kitob","Koson","Mirishkor","Muborak","Nishon","Qamashi","Shahrisabz","Yakkabog'"],"Qoraqalpog'iston":["Nukus","Amudaryo","Beruniy","Chimboy","Ellikqal'a","Kegeyli","Mo'ynoq","Nukus tumani","Qanliko'l","Qo'ng'irot","Shumanay","Taxtako'pir","To'rtko'l","Xo'jayli"],"Samarqand viloyati":["Samarqand","Bulung'ur","Ishtixon","Jomboy","Kattaqo'rg'on","Narpay","Nurobod","Oqdaryo","Past darg'om","Payariq","Paxtachi","Qo'shrabot","Toyloq","Urgut"],"Sirdaryo viloyati":["Guliston","Boyovut","Mirzaobod","Oqoltin","Sardoba","Sayxunobod","Sirdaryo","Xovos","Yangiyer"],"Surxondaryo viloyati":["Termiz","Angor","Bandixon","Boysun","Denov","Jarqo'rg'on","Muzrabot","Oltinsoy","Qiziriq","Qumqo'rg'on","Sariosiyo","Sherobod","Sho'rchi","Uzun"]},ot=Object.keys(Hs);function yr(){var we,Me;const{showConfirm:s,AlertComponent:o}=rs(),[r,h]=t.useState([]),[i,S]=t.useState(!0),[j,k]=t.useState(!1),[P,q]=t.useState(null),[C,d]=t.useState(""),[m,b]=t.useState({name:"",phone:"",region:"",district:""}),[f,y]=t.useState(""),[T,E]=t.useState(""),[$,N]=t.useState(!1);t.useEffect(()=>{O()},[]);const O=()=>Q(this,null,function*(){try{const p=yield K.get("/customers");h(p.data)}catch(p){console.error(p)}finally{S(!1)}}),_=p=>Q(this,null,function*(){p.preventDefault();try{const B={name:m.name,phone:m.phone,address:m.region&&m.district?`${m.region}, ${m.district}`:""};P?yield K.put(`/customers/${P._id}`,B):yield K.post("/customers",B),O(),V()}catch(B){console.error(B)}}),Y=p=>Q(this,null,function*(){if(yield s("Mijozni o'chirishni tasdiqlaysizmi?","O'chirish"))try{yield K.delete(`/customers/${p}`),O()}catch(U){console.error(U)}}),ae=p=>{q(p);const B=(p.address||"").split(", ");b({name:p.name,phone:p.phone,region:B[0]||"",district:B[1]||""}),k(!0)},V=()=>{k(!1),q(null),b({name:"",phone:"",region:"",district:""})},L=r.filter(p=>{const B=C.trim()===""||p.name.toLowerCase().includes(C.toLowerCase())||p.phone.includes(C);let U=!0;if(f){const re=(p.address||"").split(", "),le=re[0]||"",A=re[1]||"";U=le===f,U&&T&&(U=A===T)}return B&&U}),je=()=>f?T?`${f}, ${T}`:f:"Barcha hududlar",ie=()=>{y(""),E("")};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[o,e.jsx(us,{title:"Mijozlar",showSearch:!0,onSearch:d,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>N(!$),className:`flex items-center gap-2 px-3 py-2 rounded-xl text-sm font-medium transition-colors ${f?"bg-brand-100 text-brand-700":"bg-surface-100 text-surface-600 hover:bg-surface-200"}`,children:[e.jsx(Xs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline max-w-32 truncate",children:je()}),e.jsx(pt,{className:"w-4 h-4"})]}),$&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>N(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-72 bg-white rounded-xl shadow-lg border border-surface-200 z-50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-surface-700",children:"Hudud bo'yicha filter"}),f&&e.jsx("button",{onClick:ie,className:"text-xs text-brand-600 hover:text-brand-700",children:"Tozalash"})]}),e.jsxs("select",{className:"select text-sm mb-2",value:f,onChange:p=>{y(p.target.value),E("")},children:[e.jsx("option",{value:"",children:"Barcha viloyatlar"}),ot.map(p=>e.jsx("option",{value:p,children:p},p))]}),f&&e.jsxs("select",{className:"select text-sm",value:T,onChange:p=>E(p.target.value),children:[e.jsx("option",{value:"",children:"Barcha tumanlar"}),(we=Hs[f])==null?void 0:we.map(p=>e.jsx("option",{value:p,children:p},p))]})]})]})]}),e.jsxs("button",{onClick:()=>k(!0),className:"btn-primary",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi mijoz"})]})]})}),e.jsx("div",{className:"p-4 lg:p-6",children:i?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):L.length===0?e.jsxs("div",{className:"card flex flex-col items-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Js,{className:"w-8 h-8 text-surface-400"})}),f?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Bu hududda mijozlar yo'q"}),e.jsxs("p",{className:"text-surface-500 mb-2 text-center",children:[e.jsx("span",{className:"font-medium text-brand-600",children:T?`${f}, ${T}`:f})," da hech qanday mijoz topilmadi"]}),e.jsxs("button",{onClick:ie,className:"btn-primary mt-4",children:[e.jsx(be,{className:"w-4 h-4"}),"Filterni tozalash"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Mijozlar yo'q"}),e.jsx("p",{className:"text-surface-500 mb-6",children:"Birinchi mijozni qo'shing"}),e.jsx("button",{onClick:()=>k(!0),className:"btn-primary",children:"Mijoz qo'shish"})]})]}):e.jsxs("div",{className:"card p-0 overflow-hidden",children:[e.jsxs("div",{className:"hidden lg:block",children:[e.jsx("div",{className:"table-header",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-4",children:[e.jsx("span",{className:"table-header-cell col-span-2",children:"Ism"}),e.jsx("span",{className:"table-header-cell col-span-2",children:"Telefon"}),e.jsx("span",{className:"table-header-cell col-span-3",children:"Manzil"}),e.jsx("span",{className:"table-header-cell col-span-2",children:"Xaridlar"}),e.jsx("span",{className:"table-header-cell col-span-2",children:"Qarz"}),e.jsx("span",{className:"table-header-cell col-span-1 text-center",children:"Amallar"})]})}),e.jsx("div",{className:"divide-y divide-surface-100",children:L.map(p=>e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-4 items-center hover:bg-surface-50 transition-colors",children:[e.jsxs("div",{className:"col-span-2 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600",children:p.name.charAt(0)})}),e.jsx("span",{className:"font-medium text-surface-900 truncate",children:p.name})]}),e.jsx("div",{className:"col-span-2 text-surface-600 text-sm",children:lt(p.phone)}),e.jsx("div",{className:"col-span-3 text-surface-500 text-sm truncate",children:p.address||"-"}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("span",{className:"text-brand-600 font-medium",children:[u(p.totalPurchases||0)," so'm"]}),e.jsxs("p",{className:"text-xs text-surface-400",children:[p.purchaseCount||0," ta xarid"]})]}),e.jsx("div",{className:"col-span-2",children:e.jsxs("span",{className:p.debt>0?"text-danger-600 font-medium":"text-success-600",children:[u(p.debt)," so'm"]})}),e.jsxs("div",{className:"col-span-1 flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>ae(p),className:"btn-icon-sm hover:bg-brand-100 hover:text-brand-600",children:e.jsx(ps,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Y(p._id),className:"btn-icon-sm hover:bg-danger-100 hover:text-danger-600",children:e.jsx(is,{className:"w-4 h-4"})})]})]},p._id))})]}),e.jsx("div",{className:"lg:hidden divide-y divide-surface-100",children:L.map(p=>e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"font-semibold text-brand-600 text-lg",children:p.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900",children:p.name}),e.jsx("p",{className:"text-sm text-surface-500",children:lt(p.phone)}),p.address&&e.jsx("p",{className:"text-xs text-surface-400 mt-1",children:p.address})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>ae(p),className:"btn-icon-sm",children:e.jsx(ps,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Y(p._id),className:"btn-icon-sm text-danger-500",children:e.jsx(is,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[p.totalPurchases>0&&e.jsx("div",{className:"bg-brand-50 rounded-xl p-2 inline-block",children:e.jsxs("span",{className:"text-sm font-semibold text-brand-600",children:["Xarid: ",u(p.totalPurchases)," so'm"]})}),p.debt>0&&e.jsx("div",{className:"bg-danger-50 rounded-xl p-2 inline-block",children:e.jsxs("span",{className:"text-sm font-semibold text-danger-600",children:["Qarz: ",u(p.debt)," so'm"]})})]})]})]})},p._id))})]})}),j&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:V}),e.jsxs("div",{className:"modal w-full max-w-md p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:P?"Mijozni tahrirlash":"Yangi mijoz"}),e.jsx("button",{onClick:V,className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Ism"}),e.jsx("input",{className:"input",placeholder:"Mijoz ismi",value:m.name,onChange:p=>b(v(g({},m),{name:p.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Telefon"}),e.jsxs("div",{className:"relative",children:[e.jsx(ds,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{className:"input pl-12",placeholder:"+998 (XX) XXX-XX-XX",value:m.phone,onChange:p=>b(v(g({},m),{phone:Ds(p.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Viloyat"}),e.jsxs("select",{className:"select",value:m.region,onChange:p=>b(v(g({},m),{region:p.target.value,district:""})),children:[e.jsx("option",{value:"",children:"Viloyatni tanlang"}),ot.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),m.region&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Tuman"}),e.jsxs("select",{className:"select",value:m.district,onChange:p=>b(v(g({},m),{district:p.target.value})),children:[e.jsx("option",{value:"",children:"Tumanni tanlang"}),(Me=Hs[m.region])==null?void 0:Me.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:V,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Saqlash"})]})]})]})]})]})}function Kt(){var R;const{user:s}=Ns(),o=(s==null?void 0:s.role)==="admin",{showConfirm:r,showAlert:h,AlertComponent:i}=rs(),[S,j]=t.useState([]),[k,P]=t.useState([]),[q,C]=t.useState({total:0,approved:0,today:0,overdue:0,paid:0,blacklist:0,totalAmount:0,pendingApproval:0}),[d,m]=t.useState(!1),[b,f]=t.useState(!1),[y,T]=t.useState(null),[E,$]=t.useState(!0),[N,O]=t.useState("receivable"),[_,Y]=t.useState({customer:"",creditorName:"",amount:"",dueDate:"",description:"",collateral:""}),[ae,V]=t.useState(""),[L,je]=t.useState(""),[ie,we]=t.useState("all"),[Me,p]=t.useState(!1),[B,U]=t.useState({name:"",phone:"",region:"",district:""}),[re,le]=t.useState(null);t.useEffect(()=>{A(),ne(),ce()},[N]);const A=()=>Q(this,null,function*(){try{const D=yield K.get(`/debts?type=${N}`);j(D.data)}catch(D){console.error("Error fetching debts:",D)}finally{$(!1)}}),ne=()=>Q(this,null,function*(){try{const D=yield K.get("/customers");P(D.data)}catch(D){console.error("Error fetching customers:",D)}}),ce=()=>Q(this,null,function*(){try{const D=yield K.get(`/debts/stats?type=${N}`);C(D.data)}catch(D){console.error("Error fetching stats:",D)}}),ve=D=>Q(this,null,function*(){D.preventDefault();try{const ge={type:N,customer:N==="receivable"?_.customer:void 0,creditorName:N==="payable"?_.creditorName:void 0,amount:Number(_.amount),dueDate:_.dueDate,description:_.description,collateral:_.collateral};re?yield K.put(`/debts/${re._id}`,ge):(yield K.post("/debts",ge),h("Qarz muvaffaqiyatli qo'shildi","Muvaffaqiyat","success")),A(),ce(),G()}catch(ge){console.error("Error saving debt:",ge),h("Qarz qo'shishda xatolik yuz berdi","Xatolik","danger")}}),c=D=>Q(this,null,function*(){if(D.preventDefault(),!!y)try{yield K.post(`/debts/${y._id}/payment`,{amount:Number(ae),method:"cash"}),A(),ce(),f(!1),T(null),V("")}catch(ge){console.error("Error making payment:",ge)}}),G=()=>{m(!1),le(null),Y({customer:"",creditorName:"",amount:"",dueDate:"",description:"",collateral:""}),p(!1),U({name:"",phone:"",region:"",district:""})},Oe=()=>Q(this,null,function*(){if(!(!B.name||!B.phone))try{const D={name:B.name,phone:B.phone,address:B.region&&B.district?`${B.region}, ${B.district}`:""},ge=yield K.post("/customers",D);yield ne(),Y(v(g({},_),{customer:ge.data._id})),p(!1),U({name:"",phone:"",region:"",district:""})}catch(D){console.error("Error creating customer:",D)}}),Be=S.filter(D=>{var Te,I;const ge=((Te=D.customer)==null?void 0:Te.name)||D.creditorName||"",Ye=((I=D.customer)==null?void 0:I.phone)||"",De=ge.toLowerCase().includes(L.toLowerCase())||Ye.includes(L);let fe=!0;if(ie==="today"){const Ne=new Date;Ne.setHours(0,0,0,0);const oe=new Date(Ne.getTime()+864e5),qe=new Date(D.dueDate);fe=qe>=Ne&&qe<oe&&D.status!=="paid"}else ie!=="all"&&(fe=D.status===ie);return De&&fe}),Se=[{label:"Aktiv qarzlar",value:q.approved,icon:ms,color:"success",filter:"approved"},{label:"To'langan",value:q.paid,icon:ms,color:"success",filter:"paid"},{label:"Muddati o'tgan",value:q.overdue,icon:Pa,color:"danger",filter:"overdue"},{label:"Qora ro'yxat",value:q.blacklist,icon:ls,color:"danger",filter:"blacklist"},{label:"Jami qarz",value:`${u(q.totalAmount)} so'm`,icon:qa,color:"accent",filter:null}],ye=D=>{var ge;return(ge=D.customer)!=null&&ge.name?D.customer.name:D.creditorName||"Noma'lum"},_e=D=>{var ge;return((ge=D.customer)==null?void 0:ge.phone)||""};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[i,e.jsx(us,{title:"Qarz daftarcha",showSearch:!0,onSearch:je,actions:e.jsxs("button",{onClick:()=>m(!0),className:"btn-primary",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi qarz"})]})}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[o&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"inline-flex p-1 bg-surface-100 rounded-xl",children:[e.jsxs("button",{onClick:()=>{O("receivable"),we("all")},className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all ${N==="receivable"?"bg-white text-success-600 shadow-sm":"text-surface-500 hover:text-surface-700"}`,children:[e.jsx(Bt,{className:"w-4 h-4"}),"Menga qarzdor"]}),e.jsxs("button",{onClick:()=>{O("payable"),we("all")},className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all ${N==="payable"?"bg-white text-danger-600 shadow-sm":"text-surface-500 hover:text-surface-700"}`,children:[e.jsx(at,{className:"w-4 h-4"}),"Men qarzdorman"]})]})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4 lg:gap-6",children:Se.map((D,ge)=>e.jsxs("div",{onClick:()=>D.filter&&we(D.filter),className:`stat-card ${D.filter?"cursor-pointer hover:shadow-md transition-shadow":""} ${ie===D.filter?"ring-2 ring-brand-500":""}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:`stat-icon bg-${D.color}-50`,children:e.jsx(D.icon,{className:`w-6 h-6 text-${D.color}-600`})})}),e.jsx("p",{className:"stat-value",children:D.value}),e.jsx("p",{className:"stat-label",children:D.label})]},ge))}),e.jsx("div",{className:"card p-0 overflow-hidden",children:E?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):Be.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(ls,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Qarzlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:L||ie!=="all"?"Filtr bo'yicha qarzlar topilmadi":"Hozircha qarzlar yo'q"})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-5 p-4 sm:p-5",children:Be.map(D=>{const ge=D.status==="paid",Ye=D.status==="overdue",De=D.status==="approved",fe=D.status==="blacklist",Te=D.amount-D.paidAmount,I=Math.round(D.paidAmount/D.amount*100),Ne=new Date(D.dueDate),oe=new Date;oe.setHours(0,0,0,0);const qe=Math.ceil((Ne.getTime()-oe.getTime())/(1e3*60*60*24)),ze=!ge&&(Ye||qe<=0),Ce=!ge&&!ze&&qe<=3,Qe=!ge&&!ze&&!Ce&&qe<=7,ss=ze?"border-red-400 ring-2 ring-red-200":Ce?"border-orange-400 ring-2 ring-orange-200":Qe?"border-amber-400 ring-1 ring-amber-200":fe?"border-slate-700 ring-2 ring-slate-400":"border-surface-200 hover:border-brand-300";return e.jsxs("div",{className:`bg-white rounded-2xl border ${ss} hover:shadow-xl transition-all duration-300 overflow-hidden group ${ze?"animate-pulse-slow":""}`,children:[e.jsxs("div",{className:`relative p-4 ${fe?"bg-gradient-to-br from-slate-800 to-slate-900":ze?"bg-gradient-to-br from-red-100 to-rose-100":Ce?"bg-gradient-to-br from-orange-50 to-amber-50":Qe?"bg-gradient-to-br from-amber-50 to-yellow-50":N==="receivable"?"bg-gradient-to-br from-emerald-50 to-green-50":"bg-gradient-to-br from-red-50 to-rose-50"}`,children:[!ge&&qe<=7&&e.jsx("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-lg text-[10px] font-bold ${ze?"bg-red-500 text-white animate-pulse":Ce?"bg-orange-500 text-white":"bg-amber-500 text-white"}`,children:Ye||qe<0?`${Math.abs(qe)} kun o'tdi!`:qe===0?"Bugun!":`${qe} kun qoldi`}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center shadow-lg ${fe?"bg-gradient-to-br from-slate-900 to-black":ze?"bg-gradient-to-br from-red-500 to-rose-600":Ce?"bg-gradient-to-br from-orange-400 to-amber-500":Qe?"bg-gradient-to-br from-amber-400 to-yellow-500":N==="receivable"?"bg-gradient-to-br from-emerald-400 to-green-500":"bg-gradient-to-br from-red-400 to-rose-500"}`,children:e.jsx(ns,{className:`w-6 h-6 ${fe?"text-amber-300":"text-white"}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-bold text-surface-900 truncate text-sm sm:text-base",children:ye(D)}),_e(D)&&e.jsxs("p",{className:"text-xs sm:text-sm text-surface-500 flex items-center gap-1",children:[e.jsx(ds,{className:"w-3 h-3"}),_e(D)]})]})]}),e.jsxs("div",{className:`px-3 py-1.5 rounded-xl text-[10px] sm:text-xs font-semibold flex items-center gap-1.5 ${fe?"bg-gradient-to-r from-slate-900 to-black text-amber-300 shadow-lg shadow-slate-500":De?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg shadow-green-200":"bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow-lg shadow-blue-200"}`,children:[fe?e.jsx(ls,{className:"w-3 h-3"}):De?e.jsx(ms,{className:"w-3 h-3"}):e.jsx(js,{className:"w-3 h-3"}),e.jsx("span",{children:fe?"Qora ro'yxat":ge?"To'langan":Ye?"Muddati o'tgan":De?"Aktiv":"Jarayonda"})]})]}),!ge&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-[10px] sm:text-xs text-surface-600 mb-1",children:[e.jsxs("span",{children:["To'langan: ",I,"%"]}),e.jsxs("span",{children:[u(D.paidAmount)," / ",u(D.amount)]})]}),e.jsx("div",{className:`h-2 rounded-full overflow-hidden ${ze?"bg-red-200":Ce?"bg-orange-200":Qe?"bg-amber-200":"bg-white/60"}`,children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${ze?"bg-red-500":Ce?"bg-orange-500":Qe?"bg-amber-500":N==="receivable"?"bg-emerald-500":"bg-red-500"}`,style:{width:`${I}%`}})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-surface-50 rounded-xl p-3 border border-surface-100",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-surface-500 uppercase tracking-wide font-semibold mb-1",children:"Jami qarz"}),e.jsx("p",{className:"font-bold text-surface-900 text-sm sm:text-base",children:u(D.amount)}),e.jsx("p",{className:"text-[10px] text-surface-400",children:"so'm"})]}),e.jsxs("div",{className:`rounded-xl p-3 border ${N==="receivable"?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"}`,children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-surface-500 uppercase tracking-wide font-semibold mb-1",children:"Qoldiq"}),e.jsx("p",{className:`font-bold text-sm sm:text-base ${N==="receivable"?"text-emerald-600":"text-red-600"}`,children:u(Te)}),e.jsx("p",{className:"text-[10px] text-surface-400",children:"so'm"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3 text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-surface-600",children:[e.jsx(js,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:new Date(D.dueDate).toLocaleDateString("uz-UZ")})]}),N==="receivable"&&D.collateral&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-amber-50 rounded-lg text-amber-700 text-[10px] sm:text-xs font-medium border border-amber-200",children:["ðŸ”’ ",D.collateral]})]}),e.jsx("div",{className:"flex items-center justify-end gap-2 pt-3 border-t border-surface-100",children:e.jsxs(e.Fragment,{children:[o&&!ge&&e.jsxs(e.Fragment,{children:[D.extensionCount===void 0||D.extensionCount<3?e.jsxs("button",{onClick:()=>Q(this,null,function*(){var Ee,Ke;const ts=prompt("Necha kun muddat berilsin?");if(!ts)return;const Xe=parseInt(ts,10);if(!(Number.isNaN(Xe)||Xe<=0))try{yield K.post(`/debts/${D._id}/extend`,{days:Xe}),A(),ce()}catch(es){console.error("Error extending debt:",es),h(((Ke=(Ee=es.response)==null?void 0:Ee.data)==null?void 0:Ke.message)||"Muddat berishda xatolik","Xatolik","danger")}}),className:"flex items-center gap-1.5 px-3 py-2 bg-amber-100 text-amber-700 rounded-xl text-xs sm:text-sm font-semibold hover:bg-amber-200 transition-all",children:[e.jsx(js,{className:"w-4 h-4"}),"Muddati berish"]}):null,e.jsxs("button",{onClick:()=>Q(this,null,function*(){var Xe,Ee;if(yield r("Bu qarzni to'landi deb belgilaysizmi? Qoldiq summa nol bo'ladi.","Bo'ldi"))try{const Ke=D.amount-D.paidAmount;Ke>0&&(yield K.post(`/debts/${D._id}/payment`,{amount:Ke,method:"cash"})),A(),ce(),h("Qarz to'landi deb belgilandi","Muvaffaqiyat","success")}catch(Ke){console.error("Error marking debt as paid:",Ke),h(((Ee=(Xe=Ke.response)==null?void 0:Xe.data)==null?void 0:Ee.message)||"Qarz to'landi deb belgilashda xatolik","Xatolik","danger")}}),className:"flex items-center gap-1.5 px-3 py-2 bg-emerald-100 text-emerald-700 rounded-xl text-xs sm:text-sm font-semibold hover:bg-emerald-200 transition-all",children:[e.jsx(ms,{className:"w-4 h-4"}),"Bo'ldi"]})]}),!ge&&e.jsxs("button",{onClick:()=>{T(D),f(!0)},className:"flex items-center gap-1.5 px-3 py-2 bg-emerald-100 text-emerald-700 rounded-xl text-xs sm:text-sm font-semibold hover:bg-emerald-200 transition-all",children:[e.jsx(Je,{className:"w-4 h-4"}),"To'lov"]}),o&&fe&&e.jsxs("button",{onClick:()=>Q(this,null,function*(){var Xe,Ee;if(yield r("Ushbu mijozni qora ro'yxatdan chiqarasizmi?","Qora ro'yxatdan chiqarish"))try{yield K.post(`/debts/${D._id}/remove-blacklist`),A(),ce(),h("Mijoz qora ro'yxatdan chiqarildi","Muvaffaqiyat","success")}catch(Ke){console.error("Error removing from blacklist:",Ke),h(((Ee=(Xe=Ke.response)==null?void 0:Xe.data)==null?void 0:Ee.message)||"Qora ro'yxatdan chiqarishda xatolik","Xatolik","danger")}}),className:"flex items-center gap-1.5 px-3 py-2 bg-slate-800 text-amber-300 rounded-xl text-xs sm:text-sm font-semibold hover:bg-slate-900 transition-all",children:[e.jsx(ls,{className:"w-4 h-4"}),"Qora ro'yxatdan chiqarish"]})]})})]})]},D._id)})})})})]}),d&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:G}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:re?"Qarzni tahrirlash":"Yangi qarz"}),e.jsx("button",{onClick:G,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[o&&e.jsxs("div",{className:"flex p-1 bg-surface-100 rounded-xl mb-6",children:[e.jsxs("button",{type:"button",onClick:()=>O("receivable"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg transition-all ${N==="receivable"?"bg-white text-success-600 shadow-sm":"text-surface-500"}`,children:[e.jsx(Bt,{className:"w-4 h-4"}),"Menga qarzdor"]}),e.jsxs("button",{type:"button",onClick:()=>O("payable"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg transition-all ${N==="payable"?"bg-white text-danger-600 shadow-sm":"text-surface-500"}`,children:[e.jsx(at,{className:"w-4 h-4"}),"Men qarzdorman"]})]}),e.jsxs("form",{onSubmit:ve,className:"space-y-4",children:[e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ls,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-amber-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"Diqqat!"}),e.jsx("p",{children:"Qo'shilgan qarz darhol mijozning umumiy qarziga qo'shiladi. Shuning uchun ma'lumotlarni diqqat bilan kiriting."})]})]})}),N==="receivable"?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Mijoz"}),Me?e.jsxs("div",{className:"space-y-3 p-3 bg-surface-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-brand-600",children:"Yangi mijoz"}),e.jsx("button",{type:"button",onClick:()=>p(!1),className:"text-surface-400 hover:text-surface-600",children:e.jsx(be,{className:"w-4 h-4"})})]}),e.jsx("input",{type:"text",className:"input",placeholder:"Mijoz ismi",value:B.name,onChange:D=>U(v(g({},B),{name:D.target.value}))}),e.jsxs("div",{className:"relative",children:[e.jsx(ds,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-12",placeholder:"+998 (XX) XXX-XX-XX",value:B.phone,onChange:D=>U(v(g({},B),{phone:Ds(D.target.value)}))})]}),e.jsxs("select",{className:"select text-sm",value:B.region,onChange:D=>U(v(g({},B),{region:D.target.value,district:""})),children:[e.jsx("option",{value:"",children:"Viloyatni tanlang"}),ot.map(D=>e.jsx("option",{value:D,children:D},D))]}),B.region&&e.jsxs("select",{className:"select text-sm",value:B.district,onChange:D=>U(v(g({},B),{district:D.target.value})),children:[e.jsx("option",{value:"",children:"Tumanni tanlang"}),(R=Hs[B.region])==null?void 0:R.map(D=>e.jsx("option",{value:D,children:D},D))]}),e.jsxs("button",{type:"button",onClick:Oe,disabled:!B.name||!B.phone,className:"btn-primary w-full",children:[e.jsx(ht,{className:"w-4 h-4"}),"Mijozni yaratish"]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"select flex-1",value:_.customer,onChange:D=>Y(v(g({},_),{customer:D.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Tanlang"}),k.map(D=>e.jsxs("option",{value:D._id,children:[D.name," - ",D.phone]},D._id))]}),e.jsx("button",{type:"button",onClick:()=>p(!0),className:"btn-icon bg-brand-100 text-brand-600 hover:bg-brand-200",title:"Yangi mijoz qo'shish",children:e.jsx(Ze,{className:"w-5 h-5"})})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Kimga qarzdorman"}),e.jsx("input",{type:"text",className:"input",placeholder:"Ism yoki kompaniya nomi",value:_.creditorName,onChange:D=>Y(v(g({},_),{creditorName:D.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Summa (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:Ue(_.amount),onChange:D=>Y(v(g({},_),{amount:Re(D.target.value)})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Muddat"}),e.jsx("input",{type:"date",className:"input",value:_.dueDate,onChange:D=>Y(v(g({},_),{dueDate:D.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Izoh (ixtiyoriy)"}),e.jsx("input",{type:"text",className:"input",placeholder:"Qarz haqida izoh",value:_.description,onChange:D=>Y(v(g({},_),{description:D.target.value}))})]}),N==="receivable"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Zalog (ixtiyoriy)"}),e.jsx("input",{type:"text",className:"input",placeholder:"Zalogga nima qoldirdi",value:_.collateral,onChange:D=>Y(v(g({},_),{collateral:D.target.value}))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:G,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Saqlash"})]})]})]})})]})]}),b&&y&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>f(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900",children:"To'lov qilish"}),e.jsx("button",{onClick:()=>f(!1),className:"flex-shrink-0 btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${N==="receivable"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Qoldiq summa"}),e.jsxs("p",{className:`text-2xl font-bold ${N==="receivable"?"text-success-600":"text-danger-600"}`,children:[u(y.amount-y.paidAmount)," so'm"]})]}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"To'lov summasi"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:Ue(ae),onChange:D=>V(Re(D.target.value)),required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-success flex-1",children:"To'lash"})]})]})]})})]})]})]})}function wr(){const{showAlert:s,showConfirm:o,AlertComponent:r}=rs(),h=gs(),[i,S]=t.useState([]),[j,k]=t.useState(!0);t.useEffect(()=>{P()},[]);const P=()=>Q(this,null,function*(){try{const d=yield K.get("/debts?status=pending_approval");S(d.data)}catch(d){console.error("Error fetching pending debts:",d)}finally{k(!1)}}),q=d=>Q(this,null,function*(){var b,f;if(yield o("Bu qarzni tasdiqlaysizmi? Tasdiqlangandan keyin mijozning umumiy qarziga qo'shiladi.","Tasdiqlash"))try{yield K.post(`/debts/${d}/approve`),yield P(),s("Qarz muvaffaqiyatli tasdiqlandi","Muvaffaqiyat","success")}catch(y){console.error("Error approving debt:",y),s(((f=(b=y.response)==null?void 0:b.data)==null?void 0:f.message)||"Xatolik yuz berdi","Xatolik","danger")}}),C=d=>Q(this,null,function*(){var f,y;const m=prompt("Rad etish sababini kiriting (ixtiyoriy):");if(!(m===null||!(yield o("Bu qarzni rad etasizmi? Rad etilgan qarz o'chiriladi.","Rad etish"))))try{yield K.post(`/debts/${d}/reject`,{reason:m}),yield P(),s("Qarz rad etildi","Muvaffaqiyat","success")}catch(T){console.error("Error rejecting debt:",T),s(((y=(f=T.response)==null?void 0:f.data)==null?void 0:y.message)||"Xatolik yuz berdi","Xatolik","danger")}});return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsx(us,{title:"Qarz tasdiqlash",actions:e.jsxs("button",{onClick:()=>h("/admin/debts"),className:"btn-secondary",children:[e.jsx(ta,{className:"w-4 h-4"}),"Orqaga"]})}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-4xl mx-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-6 border border-amber-200",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 rounded-xl flex items-center justify-center",children:e.jsx(ls,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-amber-900",children:"Tasdiqlashni kutayotgan qarzlar"}),e.jsxs("p",{className:"text-sm text-amber-700",children:[i.length," ta qarz kassachi tomonidan qo'shilgan va sizning tasdiqlashingizni kutmoqda"]})]})]})}),j?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(ms,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Barcha qarzlar ko'rib chiqildi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:"Hozirda tasdiqlashni kutayotgan qarzlar yo'q. Yangi qarzlar qo'shilganda bu yerda ko'rinadi."})]}):e.jsx("div",{className:"space-y-4",children:i.map(d=>{var m,b;return e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-amber-200 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center",children:e.jsx(ns,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-lg",children:(m=d.customer)==null?void 0:m.name}),e.jsx("p",{className:"text-surface-500",children:(b=d.customer)==null?void 0:b.phone}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-surface-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(js,{className:"w-4 h-4"}),e.jsxs("span",{children:["Muddat: ",new Date(d.dueDate).toLocaleDateString("uz-UZ")]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium text-lg",children:[u(d.amount)," so'm"]})]})]})]})]}),e.jsxs("span",{className:"badge badge-amber",children:[e.jsx(ls,{className:"w-3 h-3"}),"Kutilmoqda"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[d.description&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("h5",{className:"font-medium text-surface-700 mb-2",children:"Izoh"}),e.jsx("p",{className:"text-surface-600 text-sm",children:d.description})]}),d.collateral&&e.jsxs("div",{className:"bg-amber-50 rounded-xl p-4",children:[e.jsx("h5",{className:"font-medium text-amber-700 mb-2",children:"Zalog"}),e.jsx("p",{className:"text-amber-600 text-sm",children:d.collateral})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>C(d._id),className:"btn-secondary flex-1 text-red-600 hover:bg-red-50 hover:border-red-200",children:[e.jsx(be,{className:"w-4 h-4"}),"Rad etish"]}),e.jsxs("button",{onClick:()=>q(d._id),className:"btn-primary flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(ms,{className:"w-4 h-4"}),"Tasdiqlash"]})]})]},d._id)})})]})]})}function kr(){const[s,o]=t.useState([]),[r,h]=t.useState("all"),[i,S]=t.useState(!0);t.useEffect(()=>{j()},[]);const j=()=>Q(this,null,function*(){try{const d=yield K.get("/orders");o(d.data)}catch(d){console.error("Error fetching orders:",d)}finally{S(!1)}}),k=(d,m)=>Q(this,null,function*(){try{yield K.put(`/orders/${d}/status`,{status:m}),j()}catch(b){console.error("Error updating order:",b)}}),P={new:{color:"brand",label:"Yangi",icon:Ss},processing:{color:"warning",label:"Jarayonda",icon:$e},shipped:{color:"accent",label:"Yo'lda",icon:za},delivered:{color:"success",label:"Yetkazildi",icon:ms},cancelled:{color:"danger",label:"Bekor qilindi",icon:rt}},q=[{value:"all",label:"Barchasi"},...Object.entries(P).map(([d,m])=>({value:d,label:m.label}))],C=s.filter(d=>r==="all"||d.status===r);return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[e.jsx(us,{title:"Buyurtmalar",filterOptions:q,filterValue:r,onFilterChange:h}),e.jsx("div",{className:"p-4 lg:p-6",children:e.jsx("div",{className:"card p-0 overflow-hidden",children:i?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):C.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Os,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Buyurtmalar topilmadi"}),e.jsx("p",{className:"text-surface-500",children:"Hozircha buyurtmalar yo'q"})]}):e.jsx("div",{className:"divide-y divide-surface-100",children:C.map(d=>{var b;const m=P[d.status];return e.jsx("div",{className:"p-4 lg:p-6 hover:bg-surface-50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx($e,{className:"w-6 h-6 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-surface-900",children:["Buyurtma #",d._id.slice(-6)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500 mt-1",children:[e.jsx(ns,{className:"w-4 h-4"}),e.jsx("span",{children:((b=d.customer)==null?void 0:b.name)||"Noma'lum mijoz"})]})]}),e.jsx("select",{value:d.status,onChange:f=>k(d._id,f.target.value),className:`select text-sm py-2 px-3 bg-${m.color}-50 text-${m.color}-700 border-${m.color}-200`,children:Object.entries(P).map(([f,y])=>e.jsx("option",{value:f,children:y.label},f))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-surface-500",children:[e.jsxs("span",{children:[d.items.length," ta mahsulot"]}),e.jsx("span",{children:new Date(d.createdAt).toLocaleDateString("uz-UZ")})]}),e.jsxs("p",{className:"font-bold text-surface-900",children:[d.total.toLocaleString()," so'm"]})]})]})]})},d._id)})})})})]})}function Sr(){const{showConfirm:s,showAlert:o,AlertComponent:r}=rs(),[h,i]=t.useState([]),[S,j]=t.useState([]),[k,P]=t.useState([]),[q,C]=t.useState(!1),[d,m]=t.useState(!1),[b,f]=t.useState(null),[y,T]=t.useState(null),[E,$]=t.useState(!0),[N,O]=t.useState(!1),[_,Y]=t.useState({name:"",phone:"",password:"",role:"helper",bonusPercentage:0});t.useEffect(()=>{ae(),V()},[]);const ae=()=>Q(this,null,function*(){try{const U=yield K.get("/users/helpers");i(U.data)}catch(U){console.error("Error fetching helpers:",U)}finally{$(!1)}}),V=()=>Q(this,null,function*(){try{const U=yield K.get("/receipts/helpers-stats");j(U.data)}catch(U){console.error("Error fetching helpers stats:",U)}}),L=U=>Q(this,null,function*(){O(!0);try{const re=yield K.get(`/receipts/helper/${U}/receipts`);P(re.data.receipts)}catch(re){console.error("Error fetching helper receipts:",re)}finally{O(!1)}}),je=U=>{f(U),m(!0),L(U._id)},ie=U=>{const re=Ds(U.target.value);Y(v(g({},_),{phone:re}))},we=U=>Q(this,null,function*(){var re,le;U.preventDefault();try{const A=g(g({name:_.name,phone:ca(_.phone),role:_.role},_.password&&{password:_.password}),_.role==="cashier"&&{bonusPercentage:_.bonusPercentage});y?yield K.put(`/users/${y._id}`,A):yield K.post("/users",v(g({},A),{password:_.password})),ae(),V(),B()}catch(A){alert(((le=(re=A.response)==null?void 0:re.data)==null?void 0:le.message)||"Xatolik yuz berdi")}}),Me=U=>Q(this,null,function*(){var le,A;if(yield s(`"${U.name}" yordamchisini o'chirishni tasdiqlaysizmi?`,"Yordamchini o'chirish"))try{yield K.delete(`/users/${U._id}`),yield ae(),yield V(),o("Yordamchi muvaffaqiyatli o'chirildi","Muvaffaqiyat","success")}catch(ne){console.error("Error deleting helper:",ne),o(`Yordamchini o'chirishda xatolik: ${((A=(le=ne.response)==null?void 0:le.data)==null?void 0:A.message)||ne.message}`,"Xatolik","danger")}}),p=U=>{T(U),Y({name:U.name,phone:lt(U.phone),password:"",role:U.role,bonusPercentage:U.bonusPercentage||0}),C(!0)},B=()=>{C(!1),T(null),Y({name:"",phone:"",password:"",role:"helper",bonusPercentage:0})};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsx(us,{title:"Yordamchilar",actions:e.jsxs("button",{onClick:()=>C(!0),className:"btn-primary",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi yordamchi"})]})}),e.jsx("div",{className:"p-4 lg:p-6",children:E?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):h.length===0?e.jsxs("div",{className:"card flex flex-col items-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(ht,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Yordamchilar yo'q"}),e.jsx("p",{className:"text-surface-500 mb-6",children:"Birinchi yordamchini qo'shing"}),e.jsx("button",{onClick:()=>C(!0),className:"btn-primary",children:"Yordamchi qo'shish"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-900 mb-4",children:"Kassirlar statistikasi"}),S.length===0?e.jsx("p",{className:"text-surface-500 text-center py-8",children:"Hali cheklar chiqarilmagan"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(U=>e.jsx("div",{className:"bg-white rounded-xl p-4 hover:bg-surface-50 transition-colors shadow-sm border border-surface-200 relative",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center text-white font-bold",children:U.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-surface-900",children:U.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${U.role==="cashier"?"bg-success-100 text-success-700":"bg-brand-100 text-brand-700"}`,children:U.role==="cashier"?"Kassir":"Yordamchi"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:re=>{re.stopPropagation();const le=h.find(A=>A.name===U.name);le&&p(le)},className:"btn-icon-sm hover:bg-brand-100 hover:text-brand-600",children:e.jsx(ps,{className:"w-4 h-4"})}),e.jsx("button",{onClick:re=>{re.stopPropagation(),je(U)},className:"btn-icon-sm hover:bg-blue-100 hover:text-blue-600",children:e.jsx(bs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:re=>{re.stopPropagation(),Me(U)},className:"btn-icon-sm hover:bg-danger-100 hover:text-danger-600",children:e.jsx(is,{className:"w-4 h-4"})})]})]})},U._id))})]})}),q&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:B}),e.jsxs("div",{className:"modal w-full max-w-md p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:y?"Tahrirlash":"Yangi yordamchi"}),e.jsx("button",{onClick:B,className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:we,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Ism"}),e.jsxs("div",{className:"relative",children:[e.jsx(ns,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-12",placeholder:"Yordamchi ismi",value:_.name,onChange:U=>Y(v(g({},_),{name:U.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Telefon raqam"}),e.jsxs("div",{className:"relative",children:[e.jsx(ds,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"tel",className:"input pl-12",placeholder:"+998 (XX) XXX-XX-XX",value:_.phone,onChange:ie,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:y?"Yangi parol (ixtiyoriy)":"Parol"}),e.jsxs("div",{className:"relative",children:[e.jsx(cs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",g({type:"password",className:"input pl-12",placeholder:y?"O'zgartirmaslik uchun bo'sh qoldiring":"Parol",value:_.password,onChange:U=>Y(v(g({},_),{password:U.target.value}))},!y&&{required:!0,minLength:6}))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-3 block",children:"Rol"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>Y(v(g({},_),{role:"cashier"})),className:`p-4 rounded-xl border-2 transition-all ${_.role==="cashier"?"border-success-500 bg-success-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(os,{className:`w-6 h-6 mx-auto mb-2 ${_.role==="cashier"?"text-success-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Kassir"}),e.jsx("p",{className:"text-xs text-surface-500",children:"Kassa, qarzlar"})]}),e.jsxs("button",{type:"button",onClick:()=>Y(v(g({},_),{role:"helper"})),className:`p-4 rounded-xl border-2 transition-all ${_.role==="helper"?"border-brand-500 bg-brand-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(xt,{className:`w-6 h-6 mx-auto mb-2 ${_.role==="helper"?"text-brand-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Yordamchi"}),e.jsx("p",{className:"text-xs text-surface-500",children:"QR skaner"})]})]})]}),_.role==="cashier"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Bonus foizi (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Je,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"number",className:"input pl-12",placeholder:"Masalan: 1 (1% bonus)",value:_.bonusPercentage,min:"0",max:"100",step:"0.1",onChange:U=>Y(v(g({},_),{bonusPercentage:parseFloat(U.target.value)||0}))})]}),e.jsxs("p",{className:"text-xs text-surface-500 mt-1",children:["Kassir har bir savdodan ",_.bonusPercentage,"% bonus oladi"]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:B,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Saqlash"})]})]})]})]}),d&&b&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>m(!1)}),e.jsxs("div",{className:"modal w-full max-w-4xl max-h-[90vh] overflow-hidden relative z-10",children:[e.jsxs("div",{className:"p-6 border-b border-surface-100 bg-gradient-to-r from-brand-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center text-white font-bold text-lg",children:b.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-surface-900",children:b.name}),e.jsx("span",{className:`text-sm px-3 py-1 rounded-full font-medium ${b.role==="cashier"?"bg-success-100 text-success-700":"bg-brand-100 text-brand-700"}`,children:b.role==="cashier"?"Kassir":"Yordamchi"})]})]}),e.jsx("button",{onClick:()=>m(!1),className:"btn-icon-sm hover:bg-white/50",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(ws,{className:"w-5 h-5 text-brand-600"})}),e.jsx("p",{className:"text-2xl font-bold text-surface-900",children:b.receiptCount}),e.jsx("p",{className:"text-xs text-surface-500",children:"Cheklar"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(Je,{className:"w-5 h-5 text-success-600"})}),e.jsx("p",{className:"text-lg font-bold text-success-600",children:u(b.totalAmount)}),e.jsx("p",{className:"text-xs text-surface-500",children:"Savdo"})]}),b.bonusPercentage>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx("span",{className:"text-orange-500 font-bold",children:"%"})}),e.jsxs("p",{className:"text-lg font-bold text-orange-600",children:[b.bonusPercentage,"%"]}),e.jsx("p",{className:"text-xs text-surface-500",children:"Bonus foizi"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(Je,{className:"w-5 h-5 text-green-600"})}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:u(b.totalAmount*b.bonusPercentage/100)}),e.jsx("p",{className:"text-xs text-surface-500",children:"Jami bonus"})]})]})]})]}),e.jsx("div",{className:"p-6 overflow-auto max-h-[calc(90vh-120px)]",children:N?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):k.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(ws,{className:"w-12 h-12 mx-auto mb-4 text-surface-400"}),e.jsx("p",{className:"text-surface-500",children:"Cheklar topilmadi"})]}):e.jsx("div",{className:"space-y-3",children:k.map(U=>e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-surface-100 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(ws,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-surface-900",children:["Chek #",U._id.slice(-6)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500",children:[e.jsx(js,{className:"w-4 h-4"}),new Date(U.createdAt).toLocaleString("uz-UZ")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-brand-600",children:u(U.total)}),e.jsx("p",{className:"text-sm text-surface-500",children:"so'm"})]})]}),e.jsxs("div",{className:"border-t border-surface-100 pt-4",children:[e.jsx("h5",{className:"text-sm font-medium text-surface-700 mb-3",children:"Mahsulotlar:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:U.items.map((re,le)=>e.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-surface-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-surface-700 font-medium",children:re.name}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-sm text-surface-600",children:[re.quantity," Ã— ",u(re.price)]}),e.jsxs("p",{className:"text-sm font-semibold text-surface-900",children:[u(re.price*re.quantity)," so'm"]})]})]},le))})]})]},U._id))})})]})]})]})}function Ft(){const{showConfirm:s,AlertComponent:o}=rs(),[r,h]=t.useState([]),[i,S]=t.useState(!0),[j,k]=t.useState("all");t.useEffect(()=>{P()},[]);const P=()=>Q(this,null,function*(){try{const f=yield K.get("/receipts/staff");h(f.data)}catch(f){console.error("Error fetching staff receipts:",f)}finally{S(!1)}}),q=f=>Q(this,null,function*(){if(yield s("Bu chekni tasdiqlaysizmi?","Tasdiqlash"))try{yield K.put(`/receipts/${f}/approve`),P()}catch(T){console.error("Error approving receipt:",T)}}),C=f=>Q(this,null,function*(){if(yield s("Bu chekni rad etasizmi?","Rad etish"))try{yield K.put(`/receipts/${f}/reject`),P()}catch(T){console.error("Error rejecting receipt:",T)}}),d=r.filter(f=>j==="all"?!0:f.status===j),m={pending:{color:"warning",label:"Kutilmoqda",icon:Ss},approved:{color:"success",label:"Tasdiqlangan",icon:ms},rejected:{color:"danger",label:"Rad etilgan",icon:rt}},b={total:r.length,pending:r.filter(f=>f.status==="pending").length,approved:r.filter(f=>f.status==="approved").length,rejected:r.filter(f=>f.status==="rejected").length};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[o,e.jsx(us,{title:"Xodimlar cheklari",filterOptions:[{value:"all",label:"Barchasi"},{value:"pending",label:"Kutilmoqda"},{value:"approved",label:"Tasdiqlangan"},{value:"rejected",label:"Rad etilgan"}],filterValue:j,onFilterChange:k}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon bg-blue-50",children:e.jsx(ft,{className:"w-5 h-5 text-blue-600"})}),e.jsx("p",{className:"stat-value",children:b.total}),e.jsx("p",{className:"stat-label",children:"Jami cheklar"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon bg-orange-50",children:e.jsx(Ss,{className:"w-5 h-5 text-orange-600"})}),e.jsx("p",{className:"stat-value",children:b.pending}),e.jsx("p",{className:"stat-label",children:"Kutilmoqda"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon bg-green-50",children:e.jsx(ms,{className:"w-5 h-5 text-green-600"})}),e.jsx("p",{className:"stat-value",children:b.approved}),e.jsx("p",{className:"stat-label",children:"Tasdiqlangan"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon bg-red-50",children:e.jsx(rt,{className:"w-5 h-5 text-red-600"})}),e.jsx("p",{className:"stat-value",children:b.rejected}),e.jsx("p",{className:"stat-label",children:"Rad etilgan"})]})]}),e.jsx("div",{className:"card p-0 overflow-hidden",children:i?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):d.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(ws,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Cheklar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:j!=="all"?"Filtr bo'yicha cheklar topilmadi":"Hozircha xodimlar cheklari yo'q"})]}):e.jsx("div",{className:"divide-y divide-surface-100",children:d.map(f=>{const y=m[f.status];return e.jsxs("div",{className:"p-6 hover:bg-surface-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(ws,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h4",{className:"font-semibold text-surface-900",children:["Chek #",f._id.slice(-6)]}),e.jsxs("span",{className:`badge badge-${y.color}`,children:[e.jsx(y.icon,{className:"w-3 h-3"}),y.label]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-surface-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ns,{className:"w-4 h-4"}),e.jsx("span",{children:f.createdBy.name})]}),e.jsx("span",{children:new Date(f.createdAt).toLocaleDateString("uz-UZ")})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-surface-900",children:u(f.total)}),e.jsx("p",{className:"text-sm text-surface-500",children:"so'm"})]})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4 mb-4",children:[e.jsxs("h5",{className:"font-medium text-surface-700 mb-3 flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"}),"Mahsulotlar (",f.items.length,")"]}),e.jsx("div",{className:"space-y-2",children:f.items.map((T,E)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-surface-700",children:T.name}),e.jsxs("div",{className:"flex items-center gap-3 text-surface-500",children:[e.jsxs("span",{children:[T.quantity," x ",u(T.price)]}),e.jsx("span",{className:"font-medium text-surface-900",children:u(T.quantity*T.price)})]})]},E))})]}),f.status==="pending"&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>C(f._id),className:"btn-secondary flex-1 text-red-600 hover:bg-red-50 hover:border-red-200",children:[e.jsx(be,{className:"w-4 h-4"}),"Rad etish"]}),e.jsxs("button",{onClick:()=>q(f._id),className:"btn-primary flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx($a,{className:"w-4 h-4"}),"Tasdiqlash"]})]})]},f._id)})})})]})]})}function Cr(){const[s,o]=t.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-surface-50",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(oa,{items:tr,basePath:"/cashier",collapsed:s,setCollapsed:o})}),e.jsx("main",{className:`transition-all duration-300 ease-smooth ${s?"lg:ml-[72px]":"lg:ml-64"}`,children:e.jsx(Gs,{})})]})}function Pr(){const{user:s,logout:o}=Ns(),[r,h]=t.useState(null),[i,S]=t.useState("idle"),{showAlert:j,AlertComponent:k}=rs(),[P,q]=t.useState({arrived:0,left:0}),[C,d]=t.useState(""),m=()=>{const f=new Date,y=f.getFullYear(),T=String(f.getMonth()+1).padStart(2,"0"),E=String(f.getDate()).padStart(2,"0");return`${y}-${T}-${E}`};t.useEffect(()=>{const f=()=>{const T=m();d(T);const E=`attendance:${(s==null?void 0:s._id)||"guest"}:${T}`,$=localStorage.getItem(E),N=$?JSON.parse($):{arrived:0,left:0};q(N),S(N.arrived>0&&N.left===0?"arrived":"idle")};f();const y=setInterval(()=>{m()!==C&&f()},6e4);return()=>clearInterval(y)},[s==null?void 0:s._id,C]);const b=f=>Q(this,null,function*(){var E,$;if(r)return;const y=`attendance:${(s==null?void 0:s._id)||"guest"}:${C||m()}`,T=P;if(f==="arrived"&&T.arrived>=2||f==="left"&&T.left>=2){yield j("Bugun ushbu amal maksimal 2 marta bajarilishi mumkin","Ogohlantirish","warning");return}try{if(h(f),yield K.post("/telegram/attendance",{type:f}),yield j(f==="arrived"?"Keldingiz xabari yuborildi":"Ketdingiz xabari yuborildi","Muvaffaqiyatli","success"),f==="arrived"){const N=v(g({},T),{arrived:T.arrived+1});localStorage.setItem(y,JSON.stringify(N)),q(N),N.arrived>0&&N.left===0&&S("arrived")}else{const N=v(g({},T),{left:T.left+1});localStorage.setItem(y,JSON.stringify(N)),q(N),o(),window.location.replace("/login")}}catch(N){yield j((($=(E=N==null?void 0:N.response)==null?void 0:E.data)==null?void 0:$.message)||"Xabar yuborishda xatolik","Xatolik","danger")}finally{h(null)}});return e.jsxs("div",{className:"min-h-screen bg-surface-50",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-white/80 backdrop-blur-xl border-b border-surface-200/60",children:e.jsxs("div",{className:"px-4 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center shadow-sm",children:e.jsx(Ma,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"font-bold text-lg text-surface-900",children:"Sardorbek.Furnetura"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[i==="arrived"&&e.jsx(vt,{variant:"icon"}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-surface-100 rounded-xl",children:[e.jsx(ns,{className:"w-4 h-4 text-surface-500"}),e.jsx("span",{className:"text-sm font-medium text-surface-700",children:s==null?void 0:s.name})]}),e.jsx("button",{onClick:o,className:"btn-icon text-surface-500 hover:text-danger-600 hover:bg-danger-50",children:e.jsx(ut,{className:"w-5 h-5"})})]})]})}),e.jsx("main",{className:"p-4",children:e.jsx(Gs,{})}),i==="idle"&&e.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-white/50 backdrop-blur-sm"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:e.jsxs("div",{className:"mx-auto max-w-md flex gap-4",children:[e.jsx("button",{onClick:()=>b("arrived"),disabled:r!==null||P.arrived>=2,className:"pointer-events-auto flex-1 px-6 py-4 rounded-2xl bg-emerald-600 text-white font-bold shadow-lg hover:bg-emerald-700 disabled:opacity-60",children:r==="arrived"?"Yuborilmoqda...":"Keldim"}),e.jsx("button",{onClick:()=>b("left"),disabled:r!==null||P.left>=2,className:"pointer-events-auto flex-1 px-6 py-4 rounded-2xl bg-rose-600 text-white font-bold shadow-lg hover:bg-rose-700 disabled:opacity-60",children:r==="left"?"Yuborilmoqda...":"Ketdim"})]})})]}),i==="arrived"&&e.jsxs("div",{className:"fixed bottom-4 right-4 z-40 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>b("arrived"),disabled:r!==null||P.arrived>=2,className:"px-3 py-2 rounded-xl bg-emerald-600 text-white text-sm font-semibold shadow-md hover:bg-emerald-700 disabled:opacity-60 transition-all",children:r==="arrived"?"...":"Keldim"}),e.jsx("button",{onClick:()=>b("left"),disabled:r!==null||P.left>=2,className:"px-3 py-2 rounded-xl bg-rose-600 text-white text-sm font-semibold shadow-md hover:bg-rose-700 disabled:opacity-60 transition-all",children:r==="left"?"...":"Ketdim"})]}),k]})}function qr(){var je,ie,we,Me,p,B,U,re,le;const{showAlert:s,AlertComponent:o}=rs(),[r,h]=t.useState(!1),[i,S]=t.useState(""),[j,k]=t.useState([]),[P,q]=t.useState([]),[C,d]=t.useState([]),[m,b]=t.useState(null),[f,y]=t.useState(!1),T=t.useRef(null);t.useEffect(()=>(E(),()=>{T.current&&T.current.stop().catch(()=>{})}),[]);const E=()=>Q(this,null,function*(){try{const A=yield K.get("/products");q(A.data)}catch(A){console.error("Error fetching products:",A)}}),$=()=>Q(this,null,function*(){b(null),S(""),d([]);try{const A=new na("qr-reader");T.current=A,yield A.start({facingMode:"environment"},{fps:10,qrbox:{width:200,height:200}},ne=>{let ce=null;try{const G=JSON.parse(ne);G&&typeof G=="object"&&(G.code?ce=String(G.code):(G.id||G._id)&&(ce=String(G.id||G._id)))}catch(G){}const ve=ce||ne,c=P.find(G=>G.code===ve||G._id===ve);c?b(c):s("Tovar topilmadi: "+ne,"Xatolik","warning"),N()},()=>{}),h(!0)}catch(A){console.error("Scanner error:",A),s("Kamerani ishga tushirishda xatolik","Xatolik","danger")}}),N=()=>Q(this,null,function*(){if(T.current){try{yield T.current.stop()}catch(A){}T.current=null}h(!1)}),O=A=>{if(S(A),b(null),A.length>0){const ne=P.filter(ce=>ce.name.toLowerCase().includes(A.toLowerCase())||ce.code.toLowerCase().includes(A.toLowerCase()));d(ne)}else d([])},_=A=>{k(ne=>ne.find(ve=>ve._id===A._id)?ne.map(ve=>ve._id===A._id?v(g({},ve),{cartQuantity:ve.cartQuantity+1}):ve):[...ne,v(g({},A),{cartQuantity:1})]),S(""),d([]),b(null)},Y=(A,ne)=>{k(ce=>ce.map(ve=>ve._id===A?v(g({},ve),{cartQuantity:Math.max(1,ve.cartQuantity+ne)}):ve))},ae=A=>{k(ne=>ne.filter(ce=>ce._id!==A))},V=()=>Q(this,null,function*(){if(j.length!==0){y(!0);try{yield K.post("/receipts",{items:j.map(A=>({product:A._id,name:A.name,code:A.code,price:A.price,quantity:A.cartQuantity})),total:L}),s("Chek kassirga yuborildi!","Muvaffaqiyat","success"),k([])}catch(A){console.error("Error sending receipt:",A),s("Xatolik yuz berdi","Xatolik","danger")}finally{y(!1)}}}),L=j.reduce((A,ne)=>A+ne.price*ne.cartQuantity,0);return e.jsxs("div",{className:"min-h-[calc(100vh-120px)] bg-gradient-to-b from-surface-50 to-surface-100/80 rounded-3xl p-4 sm:p-6 lg:p-8 shadow-sm",children:[o,e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-semibold text-surface-900 flex items-center gap-2",children:[e.jsx(Ms,{className:"w-6 h-6 text-brand-600"}),"Skaner orqali savat to'ldirish"]}),e.jsx("p",{className:"text-sm text-surface-500 mt-1",children:"Tovarlarni QR kod orqali tezda toping, savatga qo'shing va kassaga yuboring."})]})}),e.jsxs("div",{className:"grid lg:grid-cols-[minmax(0,1.3fr)_minmax(320px,0.9fr)] gap-6 xl:gap-8 items-start",children:[e.jsxs("div",{className:"space-y-4 lg:space-y-5",children:[e.jsx("div",{className:"card p-4 sm:p-5 border border-surface-100 shadow-sm",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ge,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",value:i,onChange:A=>O(A.target.value),placeholder:"Nomi yoki kodi bo'yicha qidirish...",className:"input pl-12 h-11 sm:h-12 text-sm sm:text-base"})]}),e.jsxs("button",{onClick:r?N:$,className:`btn-lg flex items-center justify-center gap-2 rounded-xl px-4 sm:px-5 ${r?"btn-secondary":"btn-primary"}`,children:[e.jsx(Ms,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:r?"Skanerni toâ€˜xtatish":"QR skanerni ishga tushirish"}),e.jsx("span",{className:"sm:hidden",children:r?"Stop":"QR"})]})]})}),r&&e.jsx("div",{className:"card border border-brand-100 bg-gradient-to-br from-brand-50/60 to-surface-0 shadow-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 sm:p-5",children:[e.jsx("div",{className:"relative w-full max-w-xs sm:max-w-sm rounded-2xl overflow-hidden ring-2 ring-brand-200/70 ring-offset-2 ring-offset-surface-0",children:e.jsx("div",{id:"qr-reader",className:"w-full aspect-square bg-black/80"})}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-surface-800",children:"QR kodni kameraga toâ€˜gâ€˜ri tuting"}),e.jsx("p",{className:"text-xs text-surface-500",children:"Kamera kodni oâ€˜qigach, tovar ma'lumotlari avtomatik chiqadi."})]})]})}),m&&e.jsxs("div",{className:"card bg-success-50 border-success-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 bg-success-500 rounded-full flex items-center justify-center",children:e.jsx(Gt,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"font-medium text-success-700",children:"Tovar topildi!"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-semibold text-surface-900 text-lg",children:m.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",m.code]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Tan narxi: ",u(m.costPrice||0)," so'm"]}),e.jsxs("p",{className:"text-brand-600 font-bold mt-1",children:["Optom: ",u(m.price)," so'm"]}),(m.unitPrice||m.boxPrice||((je=m.prices)==null?void 0:je.perUnit)||((ie=m.prices)==null?void 0:ie.perBox)||((we=m.prices)==null?void 0:we.perRoll))&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:[(Me=m.prices)!=null&&Me.perUnit||m.unitPrice||m.price?e.jsxs("span",{className:"px-3 py-1 rounded-full bg-surface-0 border border-success-200 text-success-700 font-medium",children:["Dona:"," ",u(((p=m.prices)==null?void 0:p.perUnit)||m.unitPrice||m.price)," ","so'm"]}):null,(B=m.prices)!=null&&B.perBox||m.boxPrice?e.jsxs("span",{className:"px-3 py-1 rounded-full bg-brand-50 border border-brand-200 text-brand-700 font-medium",children:["Karobka:"," ",u(((U=m.prices)==null?void 0:U.perBox)||m.boxPrice||0)," ","so'm"]}):null,(re=m.prices)!=null&&re.perRoll?e.jsxs("span",{className:"px-3 py-1 rounded-full bg-sky-50 border border-sky-200 text-sky-700 font-medium",children:["Rulon:"," ",u(((le=m.prices)==null?void 0:le.perRoll)||0)," ","so'm"]}):null]}),m.pricingTiers&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:[m.pricingTiers.tier1&&e.jsxs("span",{className:"px-3 py-1 rounded-full border border-emerald-200 bg-emerald-50 text-emerald-700 font-medium",children:[m.pricingTiers.tier1.minQuantity,"-",m.pricingTiers.tier1.maxQuantity,": ",m.pricingTiers.tier1.discountPercent,"%"," ","(",u(Math.round(m.price*(1-m.pricingTiers.tier1.discountPercent/100)))," so'm )"]}),m.pricingTiers.tier2&&e.jsxs("span",{className:"px-3 py-1 rounded-full border border-sky-200 bg-sky-50 text-sky-700 font-medium",children:[m.pricingTiers.tier2.minQuantity,"-",m.pricingTiers.tier2.maxQuantity,": ",m.pricingTiers.tier2.discountPercent,"%"," ","(",u(Math.round(m.price*(1-m.pricingTiers.tier2.discountPercent/100)))," so'm )"]}),m.pricingTiers.tier3&&e.jsxs("span",{className:"px-3 py-1 rounded-full border border-violet-200 bg-violet-50 text-violet-700 font-medium",children:[m.pricingTiers.tier3.minQuantity,"+ : ",m.pricingTiers.tier3.discountPercent,"%"," ","(",u(Math.round(m.price*(1-m.pricingTiers.tier3.discountPercent/100)))," so'm )"]})]})]}),e.jsxs("button",{onClick:()=>_(m),className:"btn-success whitespace-nowrap px-5 py-2.5 rounded-xl text-sm sm:text-base",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Qo'shish"]})]})]}),i&&C.length>0&&e.jsxs("div",{className:"card p-0 overflow-hidden border border-surface-100 shadow-sm",children:[e.jsxs("div",{className:"px-4 pt-4 pb-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700",children:"Qidiruv natijalari"}),e.jsxs("span",{className:"text-xs text-surface-400",children:[C.length," ta topildi"]})]}),e.jsx("div",{className:"divide-y divide-surface-100 max-h-72 overflow-auto custom-scrollbar",children:C.map(A=>e.jsxs("button",{onClick:()=>_(A),className:"w-full flex items-center justify-between p-4 hover:bg-surface-50/80 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx($e,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900 line-clamp-1",children:A.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",A.code]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-[11px] text-surface-400",children:["Tan: ",u(A.costPrice||0)]}),e.jsxs("p",{className:"text-sm font-bold text-brand-600",children:["Optom: ",u(A.price)]}),e.jsxs("p",{className:"text-[11px] text-surface-400",children:[A.quantity," dona"]})]})]},A._id))})]}),i&&C.length===0&&e.jsx("div",{className:"card text-center py-10 bg-surface-0/60 border-dashed border-surface-200",children:e.jsx("p",{className:"text-sm text-surface-500",children:"Tovar topilmadi. Nomi yoki kodini tekshirib qayta urinib ko'ring."})})]}),e.jsx("div",{className:"lg:sticky lg:top-4",children:e.jsxs("div",{className:"card border border-surface-100 shadow-md shadow-surface-900/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl bg-brand-50 flex items-center justify-center",children:e.jsx(os,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-surface-900",children:"Savat"}),e.jsx("p",{className:"text-xs text-surface-400",children:"Tanlangan tovarlar ro'yxati"})]})]}),e.jsxs("span",{className:"badge-primary text-xs px-3 py-1 rounded-full",children:[j.length," ta"]})]}),j.length===0?e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mx-auto mb-3",children:e.jsx(os,{className:"w-8 h-8 text-surface-300"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Savat bo'sh. QR skaner yoki qidiruv orqali tovar qo'shing."})]}):e.jsx("div",{className:"space-y-3 max-h-[360px] overflow-auto pr-1 custom-scrollbar",children:j.map(A=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-surface-50 rounded-xl border border-surface-100",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:A.name}),e.jsxs("p",{className:"text-[11px] text-surface-400",children:[u(A.price)," so'm / dona"]}),e.jsxs("p",{className:"text-sm text-brand-600 font-semibold mt-0.5",children:[u(A.price*A.cartQuantity)," so'm"]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-white rounded-lg border border-surface-200 px-1.5 py-1",children:[e.jsx("button",{onClick:()=>Y(A._id,-1),className:"btn-icon-sm",children:e.jsx(Rs,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-8 text-center font-semibold text-sm",children:A.cartQuantity}),e.jsx("button",{onClick:()=>Y(A._id,1),className:"btn-icon-sm",children:e.jsx(Ze,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>ae(A._id),className:"btn-icon-sm text-danger-500 hover:bg-danger-50 rounded-full",children:e.jsx(be,{className:"w-4 h-4"})})]},A._id))}),j.length>0&&e.jsxs("div",{className:"mt-5 pt-4 border-t border-surface-200 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-surface-500 text-sm",children:"Jami summa"}),e.jsxs("span",{className:"text-2xl font-bold text-surface-900",children:[u(L)," so'm"]})]}),e.jsx("button",{onClick:V,disabled:f,className:"btn-primary w-full py-3.5 text-base rounded-xl flex items-center justify-center gap-2",children:f?e.jsx("div",{className:"spinner"}):e.jsxs(e.Fragment,{children:[e.jsx(aa,{className:"w-5 h-5"}),"Kassaga yuborish"]})})]})]})})]})]})}function zr(){const s=gs(),o=Cs(),[r,h]=t.useState(!1),[i,S]=t.useState(null),[j,k]=t.useState("idle"),{showAlert:P,AlertComponent:q}=rs(),[C,d]=t.useState({arrived:0,left:0}),[m,b]=t.useState("");t.useEffect(()=>{window.location.pathname.startsWith("/kassa")||s("/kassa",{replace:!0});const _=()=>{window.history.pushState(null,"",window.location.href)};return window.addEventListener("popstate",_),window.history.pushState(null,"",window.location.href),()=>{window.removeEventListener("popstate",_)}},[s]);const y=(()=>{try{const O=localStorage.getItem("kassaLoggedIn");if(O)return{username:JSON.parse(O).username||"Kassa",isActive:!0}}catch(O){console.error("Error getting user info:",O)}return{username:"Kassa",isActive:!1}})(),T=()=>{const O=new Date,_=O.getFullYear(),Y=String(O.getMonth()+1).padStart(2,"0"),ae=String(O.getDate()).padStart(2,"0");return`${_}-${Y}-${ae}`};t.useEffect(()=>{const O=()=>{const Y=T();b(Y);const ae=`attendance:kassa:${y.username}:${Y}`,V=localStorage.getItem(ae),L=V?JSON.parse(V):{arrived:0,left:0};d(L),k(L.arrived>0&&L.left===0?"arrived":"idle")};O();const _=setInterval(()=>{T()!==m&&O()},6e4);return()=>clearInterval(_)},[y.username,m]);const E=O=>Q(this,null,function*(){var _,Y;if(!i)try{if(S(O),yield K.post("/telegram/attendance/kassa",{type:O,username:y.username}),yield P(O==="arrived"?"Keldingiz xabari yuborildi":"Ketdingiz xabari yuborildi","Muvaffaqiyatli","success"),O==="arrived"){const ae=`attendance:kassa:${y.username}:${m||T()}`,V=C,L=v(g({},V),{arrived:V.arrived+1});localStorage.setItem(ae,JSON.stringify(L)),d(L),L.arrived>0&&L.left===0&&k("arrived")}else{const ae=`attendance:kassa:${y.username}:${m||T()}`,V=C,L=v(g({},V),{left:V.left+1});localStorage.setItem(ae,JSON.stringify(L)),d(L),$(),window.location.replace("/kassa-login")}}catch(ae){yield P(((Y=(_=ae==null?void 0:ae.response)==null?void 0:_.data)==null?void 0:Y.message)||"Xabar yuborishda xatolik","Xatolik","danger")}finally{S(null)}}),$=t.useCallback(()=>{localStorage.removeItem("kassaLoggedIn"),localStorage.removeItem("kassaToken"),window.location.replace("/kassa-login")},[]),N=()=>{const O=o.pathname;return O==="/kassa"||O==="/kassa/"?"Kassa":O==="/kassa/clients"?"Mijozlar":O==="/kassa/products"?"Tovarlar":"Kassa"};return e.jsxs("div",{className:"h-screen flex overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[r&&e.jsx("div",{className:"fixed inset-0 z-40 lg:hidden",style:{background:"rgba(46, 16, 101, 0.6)",backdropFilter:"blur(8px)"},onClick:()=>h(!1)}),e.jsxs("aside",{className:`
        fixed lg:static inset-y-0 left-0 z-50 w-72 flex flex-col
        transform transition-transform duration-300 ease-in-out lg:transform-none
        ${r?"translate-x-0":"-translate-x-full lg:translate-x-0"}
      `,style:{background:"linear-gradient(180deg, #2e1065 0%, #4c1d95 100%)",borderRight:"1px solid rgba(6, 182, 212, 0.2)",boxShadow:"4px 0 24px -4px rgba(46, 16, 101, 0.3)"},children:[e.jsxs("div",{className:"p-5 flex items-center justify-between",style:{borderBottom:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, transparent 100%)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:e.jsx(nt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-base font-bold text-white",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-xs font-medium",style:{color:"#c4b5fd"},children:"Kassa tizimi"})]})]}),e.jsx("button",{onClick:()=>h(!1),className:"lg:hidden p-2 rounded-xl transition-colors",style:{background:"rgba(255, 255, 255, 0.1)",color:"#c4b5fd"},children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"flex-1 p-4 overflow-y-auto",children:e.jsx("div",{className:"space-y-1.5",children:[{path:"/kassa",label:"Kassa",icon:nt},{path:"/kassa/clients",label:"Mijozlar",icon:Js},{path:"/kassa/debts",label:"Qarz daftarcha",icon:ft},{path:"/kassa/products",label:"Tovarlar",icon:$e}].map(({path:O,label:_,icon:Y})=>e.jsxs(Ta,{to:O,onClick:()=>h(!1),className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200",style:{background:o.pathname===O?"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)":"transparent",color:o.pathname===O?"#ffffff":"#c4b5fd",boxShadow:o.pathname===O?"0 4px 12px -2px rgba(6, 182, 212, 0.4)":"none"},children:[e.jsx(Y,{className:"w-5 h-5"}),_]},O))})}),e.jsxs("div",{className:"p-4",style:{borderTop:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.2) 100%)"},children:[e.jsx("div",{className:"rounded-2xl p-4 mb-3",style:{background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(6, 182, 212, 0.15)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 12px -2px rgba(124, 58, 237, 0.4)"},children:e.jsx("span",{className:"text-base font-bold text-white",children:y.username.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-bold text-white truncate",children:y.username==="alisher"?"Namozov Alisher":y.username==="kassa1"?"Kassa Xodimi":y.username==="admin"?"Administrator":y.username}),e.jsxs("p",{className:"text-xs font-medium flex items-center gap-1",style:{color:"#a5b4fc"},children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-400 rounded-full animate-pulse"}),"Kassir â€¢ Faol"]})]})]})}),e.jsxs("button",{onClick:$,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl transition-all duration-200 text-sm font-semibold",style:{border:"1px solid rgba(239, 68, 68, 0.3)",color:"#fca5a5"},title:"Kassa tizimidan chiqish",children:[e.jsx(ut,{className:"w-4 h-4"}),"Chiqish"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:ml-0 h-full",children:[e.jsxs("header",{className:"px-4 lg:px-6 h-14 lg:h-16 flex items-center justify-between flex-shrink-0",style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",borderBottom:"1px solid rgba(91, 33, 182, 0.1)",backdropFilter:"blur(20px)",boxShadow:"0 4px 20px -4px rgba(46, 16, 101, 0.08)"},children:[e.jsx("button",{onClick:()=>h(!0),className:"lg:hidden p-2.5 rounded-xl transition-colors",style:{background:"rgba(91, 33, 182, 0.08)",color:"#5b21b6"},children:e.jsx(Yt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg lg:text-xl font-bold",style:{color:"#2e1065"},children:N()}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium",style:{color:"#6b7280"},children:"Faol"})]})]}),e.jsx(vt,{variant:"navbar"})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Gs,{})})]}),j==="idle"&&e.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0",style:{background:"rgba(250, 245, 255, 0.7)",backdropFilter:"blur(8px)"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:e.jsxs("div",{className:"mx-auto max-w-md flex gap-4",children:[e.jsx("button",{onClick:()=>E("arrived"),disabled:i!==null,className:"pointer-events-auto flex-1 px-6 py-4 rounded-2xl text-white font-bold shadow-lg disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 8px 24px -4px rgba(6, 182, 212, 0.4)"},children:i==="arrived"?"Yuborilmoqda...":"Keldim"}),e.jsx("button",{onClick:()=>E("left"),disabled:i!==null,className:"pointer-events-auto flex-1 px-6 py-4 rounded-2xl text-white font-bold shadow-lg disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",boxShadow:"0 8px 24px -4px rgba(220, 38, 38, 0.4)"},children:i==="left"?"Yuborilmoqda...":"Ketdim"})]})})]}),j==="arrived"&&e.jsxs("div",{className:"fixed bottom-4 right-4 z-40 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>E("arrived"),disabled:i!==null,className:"px-3 py-2 rounded-xl text-white text-sm font-semibold shadow-md disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:i==="arrived"?"...":"Keldim"}),e.jsx("button",{onClick:()=>E("left"),disabled:i!==null,className:"px-3 py-2 rounded-xl text-white text-sm font-semibold shadow-md disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",boxShadow:"0 4px 12px -2px rgba(220, 38, 38, 0.4)"},children:i==="left"?"...":"Ketdim"})]}),q]})}const ua=s=>{const o=s.date||new Date,r=s.receiptNumber||`CHK-${Date.now()}`,h=s.cashier||"Kassa";let i="";i+=`================================
`,i+=`       SARDOR FURNITURA         
`,i+=`================================
`,i+=`
`,i+=`CHK: ${r}
`,i+=`${o.toLocaleDateString("uz-UZ")} ${o.toLocaleTimeString("uz-UZ",{hour:"2-digit",minute:"2-digit"})}
`,i+=`KASSIR: ${h}
`,s.customer&&(i+=`MIJOZ: ${s.customer.name}
`,i+=`TEL: ${s.customer.phone}
`),i+=`--------------------------------
`;let S=0,j=0;if(s.items.forEach((d,m)=>{i+=`${m+1}. ${d.name}
`,i+=`    ${d.code}
`;const b=d.previousPrice,f=d.currentPrice||d.price;if(S+=(b&&b>0?b:f)*d.cartQuantity,j+=f*d.cartQuantity,b&&b>0&&b!==f){const y=Math.round((b-f)/b*100);i+=`    OLDINGI: ${u(b)} so'm
`,i+=`    HOZIRGI: ${u(f)} so'm`,y>0?i+=` (-${y}%)
`:y<0?i+=` (+${Math.abs(y)}%)
`:i+=`
`}else i+=`    NARXI: ${u(d.price)} so'm
`;i+=`    ${d.cartQuantity} x ${u(f)}
`,i+=`    = ${u(f*d.cartQuantity)} so'm
`,i+=`
`}),i+=`--------------------------------
`,i+=`JAMI:     ${u(s.total)} SO'M
`,S>j){const d=S-j,m=Math.round(d/S*100);i+=`CHEGIRMA: ${u(d)} SO'M (${m}%)
`}const k=s.items.reduce((d,m)=>{var b;return d+(((b=m.paymentBreakdown)==null?void 0:b.cash)||0)},0),P=s.items.reduce((d,m)=>{var b;return d+(((b=m.paymentBreakdown)==null?void 0:b.click)||0)},0),q=s.items.reduce((d,m)=>{var b;return d+(((b=m.paymentBreakdown)==null?void 0:b.card)||0)},0);k>0&&(i+=`NAQT:     ${u(k)} SO'M
`),P>0&&(i+=`CLICK:    ${u(P)} SO'M
`),q>0&&(i+=`KARTA:    ${u(q)} SO'M
`),i+=`TO'LOV:   ${s.paymentMethod==="cash"?"NAQD PUL":s.paymentMethod==="click"?"CLICK":"PLASTIK KARTA"}
`;const C=Math.floor(s.total/1e6);return C>0&&(i+=`--------------------------------
`,i+=`BALL:     +${C} BALL YUTDINGIZ!
`),s.customer&&s.customer.totalBalls&&(i+=`JAMI BALL: ${s.customer.totalBalls} BALL
`),i+=`================================
`,i+=`    XARIDINGIZ UCHUN RAHMAT!    
`,i+=`================================
`,i+=`
`,i+=`âš ï¸ VAZVRAT CHEKSIZ QABUL QILINMAYDI
`,i+=`================================
`,i},$r=(s,o)=>Q(Fe,null,function*(){var r;try{const h=ua(s),i=document.createElement("iframe");i.style.position="absolute",i.style.left="-9999px",i.style.top="-9999px",i.style.width="1px",i.style.height="1px",i.style.visibility="hidden",i.style.opacity="0",document.body.appendChild(i);const S=i.contentDocument||((r=i.contentWindow)==null?void 0:r.document);if(!S)throw new Error("Iframe document topilmadi");const j=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>X PRINTER CHEK</title>
          <meta charset="UTF-8">
          <style>
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            
            body {
              font-family: 'Courier New', monospace;
              font-size: 12px;
              font-weight: bold;
              line-height: 1.2;
              color: #000;
              background: white;
              padding: 0;
              margin: 0;
            }
            
            .receipt-text {
              white-space: pre-line;
              font-family: 'Courier New', monospace;
              font-size: 12px;
              font-weight: bold;
              word-break: break-word;
              padding: 5px;
            }
            
            /* X Printer uchun maxsus print sozlamalari */
            @media print {
              @page {
                size: 80mm auto;
                margin: 0;
                padding: 0;
              }
              
              body {
                background: white;
                font-size: 11px;
                font-weight: bold;
                padding: 0;
                margin: 0;
                width: 80mm;
              }
              
              .receipt-text {
                width: 100%;
                font-weight: bold;
                font-size: 11px;
                padding: 2mm;
              }
            }
          </style>
        </head>
        <body>
          <div class="receipt-text">${h}</div>
          
          <script>
            // X Printer uchun print tugagandan keyin callback
            window.addEventListener('afterprint', function() {
              console.log('X Printer: Print tugadi');
              if (window.parent && window.parent.xPrinterCompleted) {
                window.parent.xPrinterCompleted();
              }
            });
            
            // X Printer uchun avtomatik print
            window.addEventListener('load', function() {
              setTimeout(function() {
                console.log('X Printer: Print boshlanmoqda...');
                window.print();
              }, 300);
            });
          <\/script>
        </body>
      </html>
    `;return S.open(),S.write(j),S.close(),o&&(window.xPrinterCompleted=()=>{console.log("X Printer: Callback chaqirildi"),o(),setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i)},1e3),delete window.xPrinterCompleted}),o||setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i)},3e3),console.log("X Printer: Chek tayyorlandi va yuborildi"),!0}catch(h){console.error("X Printer xatosi:",h);try{return Tr(s),!1}catch(i){return console.error("Faylni yuklashda xatolik:",i),!1}}}),Mr=(s,o)=>Q(Fe,null,function*(){return yield $r(s,o)}),Tr=s=>{const o=ua(s),r=new Blob([o],{type:"text/plain;charset=utf-8"}),h=URL.createObjectURL(r),i=document.createElement("a");i.href=h,i.download=`chek-${s.receiptNumber||Date.now()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(h)},Qr=()=>Q(Fe,null,function*(){var s;try{if(navigator.printing&&navigator.printing.getPrinters){const o=yield navigator.printing.getPrinters(),r=o.map(i=>i.name||i.id),h=r.some(i=>i.toLowerCase().includes("x printer")||i.toLowerCase().includes("xprinter")||i.toLowerCase().includes("x-printer"));return{available:o.length>0,printers:r,defaultPrinter:(s=o.find(i=>i.isDefault))==null?void 0:s.name,xPrinterFound:h}}return{available:"print"in window,printers:["Browser Default Printer","X Printer (Auto-detect)"],defaultPrinter:"X Printer (Auto-detect)",xPrinterFound:!0}}catch(o){return console.error("Printer holatini tekshirishda xatolik:",o),{available:!1,printers:[],defaultPrinter:void 0,xPrinterFound:!1}}}),Rr=({isOpen:s,onClose:o,item:r,customer:h,onSave:i})=>{const[S,j]=t.useState([]),[k,P]=t.useState(""),[q,C]=t.useState(""),[d,m]=t.useState(!1),[b,f]=t.useState(""),y=r.price*r.cartQuantity,T=r.paymentBreakdown||{cash:0,click:0,card:0,partner:0},E=T.cash+T.click+T.card+(T.partner||0),$=y-E;t.useEffect(()=>{s&&(N(),C($.toString()))},[s,$]);const N=()=>Q(Fe,null,function*(){try{const je=yield(yield fetch("/api/partners")).json();je.success?j(je.partners):f("Hamkorlar ro'yxatini yuklashda xatolik")}catch(L){console.error("Hamkorlar yuklash xatosi:",L),f("Tarmoq xatoligi")}}),O=L=>{const je=Re(L);(je===""?0:parseFloat(je)||0)>$?C($.toString()):C(je)},_=()=>Q(Fe,null,function*(){if(!k){f("Hamkorni tanlang");return}const L=parseFloat(q)||0;if(L<=0){f("To'lov summasi noto'g'ri");return}if(L>$){f("To'lov summasi qoldiq summadan ko'p bo'lishi mumkin emas");return}m(!0),f("");try{const ie=yield(yield fetch("/api/partners/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({partner:k,amount:L,item:{name:r.name,code:r.code,price:r.price,quantity:r.cartQuantity},customer:h?{name:h.name,phone:h.phone}:null,receiptNumber:`CHK-${Date.now()}`})})).json();if(ie.success){i(k,L),o();const we=S.find(Me=>Me.id===k);alert(`âœ… ${we==null?void 0:we.name} orqali ${u(L)} so'm to'lov muvaffaqiyatli yuborildi!`)}else f(ie.message||"To'lov yuborishda xatolik")}catch(je){console.error("Hamkor to'lovi xatosi:",je),f("Tarmoq xatoligi yuz berdi")}finally{m(!1)}}),Y=L=>{switch(L){case"uzum":return e.jsx(os,{className:"w-6 h-6"});case"ishonch":return e.jsx(fs,{className:"w-6 h-6"});default:return e.jsx(vs,{className:"w-6 h-6"})}},ae=L=>{switch(L){case"uzum":return"from-purple-500 to-purple-600";case"ishonch":return"from-amber-500 to-amber-600";default:return"from-blue-500 to-blue-600"}},V=L=>{switch(L){case"uzum":return"Muddatli to'lov";case"ishonch":return"Kredit tizimi";default:return""}};return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm -z-10",onClick:o}),e.jsxs("div",{className:"bg-white w-full sm:w-auto rounded-t-2xl sm:rounded-2xl shadow-2xl max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-gray-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 truncate",children:"Hamkor to'lovi"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 truncate",children:r.name})]}),e.jsx("button",{onClick:o,className:"flex-shrink-0 w-10 h-10 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Umumiy summa:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[u(y)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"To'langan:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[u(E)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Qoldiq:"}),e.jsxs("span",{className:"font-bold text-blue-600",children:[u($)," so'm"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Hamkorni tanlang"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:S.map(L=>e.jsx("button",{onClick:()=>P(L.id),className:`relative p-4 rounded-xl border-2 transition-all duration-200 ${k===L.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-r ${ae(L.id)} flex items-center justify-center text-white`,children:Y(L.id)}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:L.name}),e.jsx("p",{className:"text-sm text-gray-500",children:V(L.id)})]}),k===L.id&&e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})},L.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To'lov summasi"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:q,onChange:L=>O(L.target.value),placeholder:"0",className:"w-full px-4 py-3 text-lg font-semibold border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:"so'm"})]}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("button",{onClick:()=>C(($/2).toString()),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Yarmini"}),e.jsx("button",{onClick:()=>C($.toString()),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Hammasini"})]})]}),b&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:b})})]})}),e.jsxs("div",{className:"sticky bottom-0 z-10 bg-white/95 backdrop-blur-sm border-t border-gray-100 flex gap-3 p-4 sm:p-6",children:[e.jsx("button",{onClick:o,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:_,disabled:d||!k||!q,className:"flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-xl font-medium transition-colors",children:d?"Yuborilmoqda...":"Yuborish"})]})]})]}):null},Dr=({item:s,selectedCustomer:o,onSave:r,onCancel:h})=>{var y,T,E;const[i,S]=t.useState(((y=s.paymentBreakdown)==null?void 0:y.cash)||0),[j,k]=t.useState(((T=s.paymentBreakdown)==null?void 0:T.click)||0),[P,q]=t.useState(((E=s.paymentBreakdown)==null?void 0:E.card)||0),C=s.price*s.cartQuantity,d=i+j+P,m=C-d,b=()=>{m<-1||r(i,j,P)},f=($,N)=>{const O=Re($),_=O===""?0:parseFloat(O)||0,Y=N==="cash"?j+P:N==="click"?i+P:i+j,ae=C-Y,V=_>ae?ae:_;N==="cash"?S(V):N==="click"?k(V):q(V)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Naqd pul"}),e.jsx("input",{type:"text",value:Ue(i.toString()),onChange:$=>f($.target.value,"cash"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-success-200 rounded-xl focus:outline-none focus:border-success-500 focus:ring-4 focus:ring-success-500/10 bg-success-50",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Click"}),e.jsx("input",{type:"text",value:Ue(j.toString()),onChange:$=>f($.target.value,"click"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-purple-200 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-500/10 bg-purple-50",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Plastik karta"}),e.jsx("input",{type:"text",value:Ue(P.toString()),onChange:$=>f($.target.value,"card"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-brand-200 rounded-xl focus:outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 bg-brand-50",placeholder:"0"})]})]}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Jami to'lov:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[u(d)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Tovar summasi:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[u(d)," so'm"]})]}),e.jsxs("div",{className:`flex justify-between text-sm font-semibold pt-2 border-t border-surface-200 ${m<=1&&m>=-1?"text-success-600":m>1?"text-warning-600":"text-danger-600"}`,children:[e.jsx("span",{children:"Qoldiq:"}),e.jsxs("span",{children:[u(C-d)," so'm"]})]}),m<-1&&e.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-lg p-2 mt-2",children:e.jsxs("p",{className:"text-xs text-warning-700",children:["âš ï¸ Ortiq pul kiritib bo'lmaydi. Maksimal: ",u(C)," so'm"]})}),m>1&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2 mt-2",children:e.jsxs("p",{className:"text-xs text-blue-700",children:["â„¹ï¸ ",u(m)," so'm qoldiq ",o?"qarz daftariga qo'shiladi va botga yuboriladi":"qarz bo'ladi (mijoz tanlanmagan)"]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:h,className:"flex-1 py-3 text-surface-600 hover:text-surface-900 transition-colors rounded-xl border border-surface-200 hover:bg-surface-50",children:"Bekor qilish"}),e.jsx("button",{onClick:b,disabled:m<-1,className:`flex-1 py-3 rounded-xl font-semibold transition-colors ${m<-1?"bg-surface-300 text-surface-500 cursor-not-allowed":"bg-brand-500 hover:bg-brand-600 text-white"}`,children:"Saqlash"})]})]})};function Lr(){const{showAlert:s,AlertComponent:o}=rs(),r=Cs(),[h,i]=t.useState([]),[S,j]=t.useState([]),[k,P]=t.useState([]),[q,C]=t.useState(""),[d,m]=t.useState(!1),[b,f]=t.useState(!1),[y,T]=t.useState(""),[E,$]=t.useState([]),[N,O]=t.useState(null),[_,Y]=t.useState(!1),[ae,V]=t.useState(""),[L,je]=t.useState([]),[ie,we]=t.useState([]),[Me,p]=t.useState(!1),[B,U]=t.useState(!1),[re,le]=t.useState({available:!1,printers:[],xPrinterFound:!1}),[A,ne]=t.useState("kod"),[ce,ve]=t.useState(""),[c,G]=t.useState(null),[Oe,Be]=t.useState(!1),[Se,ye]=t.useState(null),[_e,R]=t.useState(!1),[D,ge]=t.useState(null),[Ye,De]=t.useState(!1),[fe,Te]=t.useState(null),[I,Ne]=t.useState(15),[oe,qe]=t.useState(0),[ze,Ce]=t.useState({cash:0,click:0,card:0}),Qe=(a,z)=>{const F=a.price;let X=15;z>=100?X=11:z>=10?X=13:X=15;const me=F*(1+X/100);return Math.round(me)},ss=(a,z)=>z!==void 0?{name:"Maxsus",markupPercent:z,discount:z<15,custom:!0}:a>=100?{name:"100+ dona",markupPercent:11,discount:!0,custom:!1}:a>=10?{name:"10-99 dona",markupPercent:13,discount:!0,custom:!1}:{name:"1-9 dona",markupPercent:15,discount:!1,custom:!1},ts=a=>{Te(a);const z=ss(a.cartQuantity,a.customMarkup);Ne(z.markupPercent),De(!0)},Xe=()=>{if(!fe)return;const a=fe.costPrice||fe.price/1.15,z=Math.round(a*(1+I/100));P(F=>F.map(X=>X._id===fe._id?v(g({},X),{price:z,customMarkup:I}):X)),De(!1),Te(null),s(`Narx yangilandi: ${I}% qo'shimcha`,"Muvaffaqiyat","success")};t.useEffect(()=>{Ke(),J(),We(),He();const a=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=a}},[]),t.useEffect(()=>{Ke(),J()},[r.pathname]);const Ee=()=>Q(this,null,function*(){console.log("Refresh tugmasi bosildi"),U(!0);try{console.log("Ma'lumotlar yangilanmoqda..."),yield Promise.all([Ke(),J()]),console.log("Ma'lumotlar muvaffaqiyatli yangilandi"),s("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(a){console.error("Refresh xatosi:",a),s("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{U(!1)}}),Ke=()=>Q(this,null,function*(){try{const a=yield K.get("/products/kassa");i(a.data),console.log(`Kassa: ${a.data.length} ta tovar yuklandi`)}catch(a){console.error("Error fetching products:",a),s("Tovarlarni yuklashda xatolik","Xatolik","danger")}}),es=a=>Q(this,null,function*(){if(!a.trim()||a.length===0){we([]),p(!1);return}const z=h.filter(F=>F.code.toLowerCase().includes(a.toLowerCase())).sort((F,X)=>{const me=F.code.toLowerCase().startsWith(a.toLowerCase()),he=X.code.toLowerCase().startsWith(a.toLowerCase());return me&&!he?-1:!me&&he?1:F.code.localeCompare(X.code)});if(we(z.slice(0,8)),p(!0),z.length<5&&a.length>=1)try{const me=((yield K.get(`/products/kassa?search=${encodeURIComponent(a)}`)).data||[]).filter(se=>se.code.toLowerCase().includes(a.toLowerCase())).sort((se,pe)=>{const Ae=se.code.toLowerCase().startsWith(a.toLowerCase()),as=pe.code.toLowerCase().startsWith(a.toLowerCase());return Ae&&!as?-1:!Ae&&as?1:se.code.localeCompare(pe.code)}),he=[...z];me.forEach(se=>{he.find(Ae=>Ae._id===se._id)||he.push(se)}),we(he.slice(0,8)),i(se=>{const pe=[...se];return me.forEach(Ae=>{pe.find(Ls=>Ls._id===Ae._id)||pe.push(Ae)}),pe})}catch(F){console.error("Error searching products by code:",F)}}),w=a=>Q(this,null,function*(){if(!a.trim())return null;try{const z=h.find(X=>X.code===a.trim());if(z)return z;const F=yield K.get(`/products/kassa?search=${encodeURIComponent(a.trim())}`);if(F.data&&F.data.length>0){const X=F.data.find(me=>me.code===a.trim());if(X)return i(me=>me.find(se=>se._id===X._id)?me:[...me,X]),X}return null}catch(z){return console.error("Error searching product:",z),null}}),J=()=>Q(this,null,function*(){try{const a=yield K.get("/customers/kassa");j(a.data)}catch(a){console.error("Error fetching customers:",a)}}),te=a=>{V(a)},ue=S.filter(a=>a.name.toLowerCase().includes(ae.toLowerCase())||a.phone.includes(ae)),We=()=>{const a=localStorage.getItem("savedReceipts");a&&je(JSON.parse(a))},He=()=>Q(this,null,function*(){try{const a=yield Qr();le(a),console.log("Printer holati:",a)}catch(a){console.error("Printer holatini tekshirishda xatolik:",a)}}),Pe=k.reduce((a,z)=>a+z.price*z.cartQuantity,0),l=a=>{if(a==="C")A==="kod"?(C(""),p(!1),we([])):(ve("1"),c&&k.find(F=>F._id===c._id)&&P(F=>F.map(X=>X._id===c._id?v(g({},X),{cartQuantity:1}):X)));else if(a==="âŒ«")if(A==="kod"){const z=q.slice(0,-1);C(z),z.length>0?es(z):(p(!1),we([]))}else{const z=ce.slice(0,-1),F=z===""||parseInt(z)===0?"1":z;if(ve(F),c){const X=parseInt(F);X>0&&X<=c.quantity&&k.find(he=>he._id===c._id)&&P(he=>he.map(se=>se._id===c._id?v(g({},se),{cartQuantity:X}):se))}}else if(a==="+")if(A==="kod")Z(q);else if(c&&ce.trim()){const z=parseInt(ce);if(!isNaN(z)&&z>0){if(z>c.quantity){s(`${c.name} uchun maksimal miqdor: ${c.quantity} ta`,"Ogohlantirish","warning");return}k.find(X=>X._id===c._id)?P(X=>X.map(me=>me._id===c._id?v(g({},me),{cartQuantity:z}):me)):x(c,z),G(null),ve(""),ne("kod")}}else c||s("Mahsulot qo'shing","Ogohlantirish","warning");else if(A==="kod"){const z=q+a;C(z),es(z)}else if(c&&(/^[\d]$/.test(a)||a==="00")){const z=ce+a,F=parseInt(z);if(!isNaN(F)&&F>c.quantity){s(`${c.name} uchun maksimal miqdor: ${c.quantity} ta`,"Ogohlantirish","warning");return}console.log("SON rejimida raqam kiritildi:",a,"Yangi qiymat:",z),ve(z),!isNaN(F)&&F>0&&k.find(me=>me._id===c._id)&&P(me=>me.map(he=>he._id===c._id?v(g({},he),{cartQuantity:F}):he))}else c||(ne("kod"),s("Mahsulot qo'shing","Ogohlantirish","warning"))},Z=a=>Q(this,null,function*(){if(!a.trim())return;const z=yield w(a.trim());if(z){if(z.quantity===0){s(`"${z.name}" tugagan, savatchaga qo'shib bo'lmaydi`,"Ogohlantirish","warning");return}W(z),C(""),p(!1),we([])}else s(`Kod "${a}" bo'yicha tovar topilmadi`,"Xatolik","warning")}),xe=a=>{if(a.quantity===0){s(`"${a.name}" tugagan, savatchaga qo'shib bo'lmaydi`,"Ogohlantirish","warning");return}W(a),C(""),p(!1),we([])},Le=a=>{G(a),ne("son"),ve(a.cartQuantity.toString())},x=(a,z)=>{P(F=>{const X=F.find(he=>he._id===a._id);if(X){const he=X.cartQuantity+z;if(he>a.quantity)return s(`${a.name} uchun maksimal miqdor: ${a.quantity} ta`,"Ogohlantirish","warning"),F;const se=Qe(a,he);return F.map(pe=>pe._id===a._id?v(g({},pe),{cartQuantity:he,price:se}):pe)}const me=Qe(a,z);return[...F,v(g({},a),{cartQuantity:z,price:me})]}),f(!1),T("")},W=a=>{P(z=>{const F=z.find(me=>me._id===a._id);if(F){const me=F.cartQuantity+1;if(me>a.quantity)return s(`${a.name} uchun maksimal miqdor: ${a.quantity} ta`,"Ogohlantirish","warning"),z;const he=Qe(a,me);return z.map(se=>se._id===a._id?v(g({},se),{cartQuantity:me,price:he}):se)}const X=Qe(a,1);return[...z,v(g({},a),{cartQuantity:1,price:X})]}),f(!1),T("")},ee=a=>{P(z=>z.filter(F=>F._id!==a))},n=a=>Q(this,null,function*(){if(T(a),a.length>0){const z=h.filter(F=>F.name.toLowerCase().includes(a.toLowerCase())||F.code.toLowerCase().includes(a.toLowerCase()));if(z.length<5&&a.length>2)try{const X=(yield K.get(`/products/kassa?search=${encodeURIComponent(a)}`)).data||[],me=[...z];X.forEach(he=>{me.find(pe=>pe._id===he._id)||me.push(he)}),$(me),i(he=>{const se=[...he];return X.forEach(pe=>{se.find(as=>as._id===pe._id)||se.push(pe)}),se})}catch(F){console.error("Error searching products:",F),$(z)}else $(z)}else $(h.slice(0,20))}),M=a=>{ye(a),Be(!0)},H=a=>{ge(a),R(!0)},de=(a,z,F)=>Q(this,null,function*(){if(!Se)return;const X=Se.price*Se.cartQuantity,me=a+z+F;if(me>X+1){s(`Ortiq pul kiritib bo'lmaydi. Maksimal: ${u(X)} so'm, Kiritilgan: ${u(me)} so'm`,"Xatolik","danger");return}const he=X-me;if(he>1&&N)try{console.log(`Tovar uchun qoldiq qarz yaratilmoqda: ${he} so'm`);const se={customer:N._id,amount:he,paidAmount:0,description:`${Se.name} uchun qoldiq to'lov - ${new Date().toLocaleDateString("uz-UZ")}`,items:[{product:Se._id,name:Se.name,code:Se.code,price:Se.price,quantity:Se.cartQuantity}]};yield K.post("/debts/kassa",se),console.log("âœ… Tovar uchun qoldiq qarz muvaffaqiyatli qo'shildi va botga yuborildi"),s(`${u(he)} so'm qarz qo'shildi va botga yuborildi`,"Ma'lumot","info")}catch(se){console.error("âŒ Qarz yaratishda xatolik:",se),s("Qarz yaratishda xatolik yuz berdi","Ogohlantirish","warning")}P(se=>se.map(pe=>{var Ae;return pe._id===Se._id?v(g({},pe),{paymentBreakdown:{cash:a,click:z,card:F,partner:((Ae=pe.paymentBreakdown)==null?void 0:Ae.partner)||0}}):pe})),Be(!1),ye(null)}),ke=()=>{if(k.length===0){s("Chek bo'sh","Ogohlantirish","warning");return}const a={id:Date.now().toString(),items:[...k],total:Pe,savedAt:new Date().toLocaleString()},z=[...L,a];je(z),localStorage.setItem("savedReceipts",JSON.stringify(z)),P([]),s("Chek saqlandi!","Muvaffaqiyat","success")};return e.jsxs("div",{className:"h-full flex flex-col lg:flex-row overflow-hidden",children:[o,e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0",children:[e.jsxs("div",{className:"p-2 sm:p-3 lg:p-4 flex flex-col sm:flex-row sm:items-center justify-between gap-2 bg-white border-b border-surface-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-col xs:flex-row xs:items-center gap-2 xs:gap-3",children:[e.jsxs("span",{className:"text-xs sm:text-sm text-surface-600 font-medium",children:["JAMI: ",k.length," ta mahsulot"]}),e.jsxs("button",{onClick:Ee,disabled:B,className:"flex items-center gap-1 px-2 py-1 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50 text-xs w-fit",children:[e.jsx(xs,{className:`w-3 h-3 ${B?"animate-spin":""}`}),e.jsx("span",{className:"hidden xs:inline",children:B?"Yangilanmoqda...":"Yangilash"}),e.jsx("span",{className:"xs:hidden",children:B?"...":"â†»"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:N?e.jsxs("div",{className:"flex items-center gap-2 bg-brand-50 border border-brand-200 rounded-lg px-3 py-2",children:[e.jsx("div",{className:"w-6 h-6 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-brand-600",children:N.name.charAt(0)})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-brand-700",children:N.name}),e.jsx("span",{className:"text-xs text-brand-600",children:N.phone})]}),e.jsx("button",{onClick:()=>O(null),className:"ml-2 w-5 h-5 flex items-center justify-center rounded-full text-brand-500 hover:bg-brand-200 transition-colors",children:"Ã—"})]}):e.jsxs("button",{onClick:()=>Y(!0),className:"flex items-center gap-2 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),e.jsx("span",{children:"Mijoz tanlash"})]})})]}),e.jsxs("div",{className:"flex-1 bg-white overflow-hidden flex flex-col min-h-0",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-2 px-3 sm:px-4 py-3 bg-surface-50 border-b border-surface-200 text-xs font-semibold text-surface-500 uppercase flex-shrink-0",children:[e.jsx("div",{className:"col-span-1",children:"Kod"}),e.jsx("div",{className:"col-span-4",children:"Mahsulot"}),e.jsx("div",{className:"col-span-2 text-center",children:"Soni"}),e.jsx("div",{className:"col-span-2 text-right",children:"Narx"}),e.jsx("div",{className:"col-span-2 text-right",children:"Summa"}),e.jsx("div",{className:"col-span-1 text-center",children:"Amallar"})]}),e.jsx("div",{className:"flex-1 overflow-auto min-h-0",children:k.length===0?Me&&ie.length>0?e.jsxs("div",{className:"p-2 sm:p-3 lg:p-4 h-full flex flex-col",children:[e.jsx("div",{className:"text-center mb-2 sm:mb-3 flex-shrink-0",children:e.jsxs("p",{className:"text-sm text-surface-500",children:['"',q,`" ni o'z ichiga olgan tovarlar`,ie.length>4&&e.jsxs("span",{className:"block text-xs text-surface-400 mt-1",children:["Jami ",ie.length," ta tovar"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-1 sm:space-y-2 min-h-0",children:ie.map((a,z)=>e.jsxs("button",{onClick:()=>xe(a),disabled:a.quantity===0,className:`w-full flex items-center gap-2 sm:gap-3 p-2 sm:p-3 rounded-xl transition-colors text-left relative overflow-hidden ${a.quantity===0?"bg-red-50 border-2 border-red-200 cursor-not-allowed opacity-80":z<4?"bg-brand-50 hover:bg-brand-100 border border-brand-200":"bg-surface-50 hover:bg-surface-100 border border-transparent"}`,children:[a.quantity===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none bg-red-50 bg-opacity-90 rounded-xl",children:e.jsx("div",{className:"bg-red-500 text-white text-xs sm:text-sm font-bold px-2 sm:px-4 py-1 sm:py-2 rounded-full shadow-lg border-2 border-white transform rotate-12 animate-pulse",children:"TUGAGAN"})}),e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-xl flex items-center justify-center ${a.quantity===0?"bg-red-100":"bg-brand-100"}`,children:e.jsx($e,{className:`w-4 h-4 sm:w-5 sm:h-5 ${a.quantity===0?"text-red-600":"text-brand-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0 relative",children:[e.jsx("p",{className:`font-medium text-sm sm:text-base truncate ${a.quantity===0?"text-red-700 opacity-60":"text-surface-900"}`,children:a.name}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 text-xs sm:text-sm text-surface-500",children:[e.jsx("span",{className:`font-mono px-1.5 sm:px-2 py-0.5 rounded border text-xs ${a.quantity===0?"bg-red-100 border-red-300 text-red-700 opacity-60":"bg-white"}`,children:q&&a.code.toLowerCase().includes(q.toLowerCase())?e.jsx(e.Fragment,{children:a.code.split(new RegExp(`(${q})`,"gi")).map((F,X)=>F.toLowerCase()===q.toLowerCase()?e.jsx("span",{className:"bg-yellow-200 text-yellow-800 font-bold",children:F},X):e.jsx("span",{children:F},X))}):a.code}),a.quantity!==void 0&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${a.quantity>10?"bg-success-100 text-success-700":a.quantity>0?"bg-warning-100 text-warning-700":"bg-danger-100 text-danger-700 font-bold animate-pulse"}`,children:a.quantity>0?`${a.quantity} ta`:"TUGAGAN"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`font-semibold text-sm sm:text-base ${a.quantity===0?"text-red-600 opacity-60":"text-brand-600"}`,children:u(a.price)}),e.jsx("p",{className:`text-xs ${a.quantity===0?"text-red-500":"text-surface-500"}`,children:a.quantity===0?"Mavjud emas":"so'm"})]})]},a._id))})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-surface-400 py-8 sm:py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx($e,{className:"w-8 h-8 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 opacity-50"}),e.jsx("p",{className:"text-sm sm:text-base",children:"Savat bo'sh"}),q.length>0&&e.jsx("p",{className:"text-xs sm:text-sm mt-1 sm:mt-2",children:"Kod kiriting yoki qidiring"})]})}):e.jsx("div",{className:"divide-y divide-surface-100",children:k.map(a=>e.jsxs("div",{children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-2 px-4 py-3 items-center hover:bg-surface-50 transition-colors",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-mono text-surface-600",children:a.code})}),e.jsx("div",{className:"col-span-4",children:e.jsx("span",{className:"text-sm font-medium text-surface-900",children:a.name})}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("input",{type:"text",value:a.cartQuantity,onClick:()=>Le(a),onChange:z=>{const F=z.target.value;if(F===""||/^\d+$/.test(F)){const X=F===""?0:parseInt(F);if(X>a.quantity){s(`${a.name} uchun maksimal miqdor: ${a.quantity} ta`,"Ogohlantirish","warning");return}const me=Qe(a,X);P(he=>he.map(se=>se._id===a._id?v(g({},se),{cartQuantity:X,price:me}):se))}},onBlur:()=>{(a.cartQuantity===0||!a.cartQuantity)&&ee(a._id)},className:`w-16 h-9 text-center font-medium border rounded-xl focus:outline-none focus:ring-2 cursor-pointer ${a.cartQuantity>a.quantity?"border-danger-500 bg-danger-50 text-danger-700 focus:border-danger-500 focus:ring-danger-500/20":"border-surface-200 focus:border-brand-500 focus:ring-brand-500/20 hover:bg-surface-50"}`})}),e.jsx("div",{className:"col-span-2 text-right",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm text-surface-900",children:u(a.price)}),(()=>{const z=ss(a.cartQuantity,a.customMarkup);return e.jsxs("div",{onClick:()=>ts(a),className:`text-xs px-2 py-0.5 rounded-full inline-block cursor-pointer hover:opacity-80 transition-opacity ${z.custom?"bg-purple-100 text-purple-700":z.discount?"bg-success-100 text-success-700":"bg-surface-100 text-surface-600"}`,title:"Foizni o'zgartirish uchun bosing",children:[z.name," (",z.markupPercent,"%)"]})})()]})}),e.jsxs("div",{className:"col-span-2 text-right",children:[e.jsx("span",{className:"text-sm font-semibold text-surface-900",children:u(a.price*a.cartQuantity)}),a.paymentBreakdown&&e.jsxs("div",{className:"mt-1 text-xs text-surface-600 space-y-0.5",children:[a.paymentBreakdown.cash>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Je,{className:"w-3 h-3 text-green-600"}),u(a.paymentBreakdown.cash)]}),a.paymentBreakdown.click>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(vs,{className:"w-3 h-3 text-purple-600"}),u(a.paymentBreakdown.click)]}),a.paymentBreakdown.card>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fs,{className:"w-3 h-3 text-blue-600"}),u(a.paymentBreakdown.card)]}),a.paymentBreakdown.partner&&a.paymentBreakdown.partner>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(vs,{className:"w-3 h-3 text-blue-600"}),u(a.paymentBreakdown.partner)]})]}),!a.paymentBreakdown&&e.jsx("button",{onClick:()=>M(a),className:"mt-1 inline-flex items-center px-2 py-1 text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-md transition-colors",children:"To'lov"})]}),e.jsxs("div",{className:"col-span-1 flex justify-center gap-1",children:[e.jsx("button",{onClick:()=>H(a),className:"w-7 h-7 flex items-center justify-center rounded-lg text-purple-500 hover:bg-purple-50 transition-colors",title:"Hamkor orqali to'lash",children:e.jsx(vs,{className:"w-4 h-4"})}),a.paymentBreakdown&&e.jsx("button",{onClick:()=>M(a),className:"w-7 h-7 flex items-center justify-center rounded-lg text-brand-500 hover:bg-brand-50 transition-colors",title:"To'lov turini o'zgartirish",children:e.jsx(fs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ee(a._id),className:"w-7 h-7 flex items-center justify-center rounded-lg text-danger-500 hover:bg-danger-50 transition-colors",children:e.jsx(is,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"md:hidden p-4 hover:bg-surface-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-surface-900 mb-1",children:a.name}),e.jsxs("p",{className:"text-sm text-surface-500 font-mono",children:["Kod: ",a.code]})]}),e.jsx("button",{onClick:()=>ee(a._id),className:"ml-3 w-8 h-8 flex items-center justify-center rounded-lg text-danger-500 hover:bg-danger-50 transition-colors",children:e.jsx(is,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-surface-600",children:"Soni:"}),e.jsx("input",{type:"text",value:a.cartQuantity,onClick:()=>Le(a),onChange:z=>{const F=z.target.value;if(F===""||/^\d+$/.test(F)){const X=F===""?0:parseInt(F);if(X>a.quantity){s(`${a.name} uchun maksimal miqdor: ${a.quantity} ta`,"Ogohlantirish","warning");return}const me=Qe(a,X);P(he=>he.map(se=>se._id===a._id?v(g({},se),{cartQuantity:X,price:me}):se))}},onBlur:()=>{(a.cartQuantity===0||!a.cartQuantity)&&ee(a._id)},className:`w-16 h-8 text-center font-medium border rounded-lg focus:outline-none focus:ring-2 cursor-pointer ${a.cartQuantity>a.quantity?"border-danger-500 bg-danger-50 text-danger-700 focus:border-danger-500 focus:ring-danger-500/20":"border-surface-200 focus:border-brand-500 focus:ring-brand-500/20 hover:bg-surface-50"}`})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-surface-600",children:[u(a.price)," so'm"]}),(()=>{const z=ss(a.cartQuantity,a.customMarkup);return e.jsxs("div",{onClick:()=>ts(a),className:`text-xs px-2 py-0.5 rounded-full inline-block cursor-pointer hover:opacity-80 transition-opacity ${z.custom?"bg-purple-100 text-purple-700":z.discount?"bg-success-100 text-success-700":"bg-surface-100 text-surface-600"}`,title:"Foizni o'zgartirish uchun bosing",children:[z.name," (",z.markupPercent,"%)"]})})(),e.jsxs("p",{className:"font-semibold text-surface-900",children:[u(a.price*a.cartQuantity)," so'm"]})]}),a.paymentBreakdown&&e.jsxs("div",{className:"mt-1 text-xs text-surface-600 space-y-0.5",children:[a.paymentBreakdown.cash>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Je,{className:"w-3 h-3 text-green-600"}),u(a.paymentBreakdown.cash)]}),a.paymentBreakdown.click>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(vs,{className:"w-3 h-3 text-purple-600"}),u(a.paymentBreakdown.click)]}),a.paymentBreakdown.card>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fs,{className:"w-3 h-3 text-blue-600"}),u(a.paymentBreakdown.card)]}),a.paymentBreakdown.partner&&a.paymentBreakdown.partner>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(vs,{className:"w-3 h-3 text-blue-600"}),u(a.paymentBreakdown.partner)]})]}),!a.paymentBreakdown&&e.jsx("button",{onClick:()=>M(a),className:"mt-1 inline-flex items-center px-2 py-1 text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-md transition-colors",children:"To'lov"})]})]})]})]},a._id))})})]}),Me&&ie.length>0&&k.length>0&&e.jsxs("div",{className:"mt-4 bg-white border border-surface-200 rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-surface-100 bg-surface-50",children:e.jsxs("p",{className:"text-sm text-surface-600 text-center",children:['"',q,`" ni o'z ichiga olgan tovarlar (`,ie.length," ta)"]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:ie.map(a=>e.jsxs("button",{onClick:()=>xe(a),disabled:a.quantity===0,className:`w-full flex items-center gap-3 p-3 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0 relative ${a.quantity===0?"opacity-60 cursor-not-allowed":""}`,children:[a.quantity===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none bg-red-50 bg-opacity-80 rounded",children:e.jsx("span",{className:"bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg",children:"TUGAGAN"})}),e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 ${a.quantity===0?"bg-red-100":"bg-brand-100"}`,children:e.jsx($e,{className:`w-5 h-5 ${a.quantity===0?"text-red-600":"text-brand-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium text-base truncate ${a.quantity===0?"text-red-700":"text-surface-900"}`,children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm mt-1",children:[e.jsx("span",{className:`font-mono px-2 py-1 rounded border ${a.quantity===0?"bg-red-100 border-red-300 text-red-700":"bg-white border-surface-200"}`,children:q&&a.code.toLowerCase().includes(q.toLowerCase())?e.jsx(e.Fragment,{children:a.code.split(new RegExp(`(${q})`,"gi")).map((z,F)=>z.toLowerCase()===q.toLowerCase()?e.jsx("span",{className:"bg-yellow-200 text-yellow-800 font-bold",children:z},F):e.jsx("span",{children:z},F))}):a.code}),a.quantity!==void 0&&e.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${a.quantity>10?"bg-success-100 text-success-700":a.quantity>0?"bg-warning-100 text-warning-700":"bg-danger-100 text-danger-700"}`,children:a.quantity>0?`${a.quantity} ta`:"TUGAGAN"})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:`font-semibold text-lg ${a.quantity===0?"text-red-600":"text-brand-600"}`,children:u(a.price)}),e.jsx("p",{className:`text-sm ${a.quantity===0?"text-red-500":"text-surface-500"}`,children:"so'm"})]})]},a._id))})]}),e.jsx("div",{className:"p-2 sm:p-3 lg:p-4 bg-white border-t border-surface-200 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>{f(!0),n("")},className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-white border border-surface-200 rounded-lg text-surface-700 hover:bg-surface-50 transition-colors flex-1 min-w-[100px]",children:[e.jsx(Ge,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"Qidirish"})]}),e.jsxs("button",{onClick:ke,className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-white border border-surface-200 rounded-lg text-surface-700 hover:bg-surface-50 transition-colors flex-1 min-w-[100px]",children:[e.jsx(Bs,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"Saqlash"})]}),k.length>0&&e.jsxs("button",{onClick:()=>{const a=k.reduce((he,se)=>{var pe;return he+(((pe=se.paymentBreakdown)==null?void 0:pe.cash)||0)},0),z=k.reduce((he,se)=>{var pe;return he+(((pe=se.paymentBreakdown)==null?void 0:pe.click)||0)},0),F=k.reduce((he,se)=>{var pe;return he+(((pe=se.paymentBreakdown)==null?void 0:pe.card)||0)},0),X=k.reduce((he,se)=>{var pe;return he+(((pe=se.paymentBreakdown)==null?void 0:pe.partner)||0)},0),me=a+z+F+X;Ce({cash:a,click:z,card:F}),qe(me),m(!0)},className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-success-500 text-white rounded-lg hover:bg-success-600 transition-colors flex-1 min-w-[100px] font-semibold",children:[e.jsx(Zt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"To'lov"})]})]})})]}),e.jsxs("div",{className:"w-full lg:w-72 xl:w-80 bg-white border-t lg:border-t-0 lg:border-l border-surface-200 p-2 sm:p-3 lg:p-4 flex flex-col flex-shrink-0",children:[e.jsx("div",{className:"text-center xl:text-right mb-3 sm:mb-4",children:e.jsxs("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-surface-900",children:[u(Pe)," so'm"]})}),e.jsx("div",{className:"text-center mb-2 bg-surface-50 rounded-lg py-3 px-4 min-h-[60px] flex flex-col items-center justify-center",children:A==="kod"?q?e.jsxs("div",{className:"text-lg font-mono text-surface-900",children:["Kod: ",e.jsx("span",{className:"font-bold text-brand-600",children:q})]}):e.jsx("div",{className:"text-sm text-surface-500",children:"Mahsulot kodini kiriting"}):e.jsxs("div",{className:"text-center w-full",children:[c&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-sm font-medium text-surface-700",children:c.name}),e.jsxs("div",{className:"text-xs text-surface-500",children:["Mavjud: ",c.quantity," ta"]})]}),e.jsx("div",{className:"text-xs text-surface-500 mb-1 uppercase tracking-wider",children:"SONI"}),ce?e.jsx("div",{className:`text-3xl font-bold rounded-lg py-2 px-4 border-2 inline-block min-w-[80px] ${c&&parseInt(ce)>c.quantity?"bg-red-50 border-red-500 text-red-700 animate-pulse":"bg-white border-gray-200 text-gray-800"}`,children:ce}):e.jsx("div",{className:"text-lg text-surface-400 bg-white rounded-lg py-2 px-4 border-2 border-dashed border-gray-300 inline-block min-w-[80px]",children:c?"0":"â€”"})]})}),e.jsxs("div",{className:"relative mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex mb-2 sm:mb-3 bg-surface-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>{ne("kod"),ve("")},className:`flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all ${A==="kod"?"bg-blue-500 text-white shadow-sm":"text-surface-600 hover:text-surface-900"}`,children:"KOD"}),e.jsx("button",{onClick:()=>{ne("son"),C(""),p(!1),we([])},className:`flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all ${A==="son"?"bg-gray-500 text-white shadow-sm":"text-surface-600 hover:text-surface-900"}`,children:"SON"})]}),A==="kod"?e.jsx("input",{type:"text",value:q,onChange:a=>{const z=a.target.value;C(z),z.length>0?es(z):(p(!1),we([]))},onKeyDown:a=>{a.key==="Enter"?(a.preventDefault(),Z(q)):a.key==="Escape"&&(p(!1),we([]))},onFocus:()=>{q.length>0&&es(q)},placeholder:"Kod kiriting...",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-center text-sm sm:text-base font-mono bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"}):e.jsx("input",{type:"text",value:ce,onChange:a=>{const z=a.target.value;/^\d*$/.test(z)&&ve(z)},onKeyDown:a=>{if(a.key==="Enter"&&(a.preventDefault(),c&&ce.trim())){const z=parseInt(ce);if(!isNaN(z)&&z>0){if(z>c.quantity){s(`${c.name} uchun maksimal miqdor: ${c.quantity} ta`,"Ogohlantirish","warning");return}x(c,z),G(null),ve(""),ne("kod"),s(`${c.name} (${z} ta) savatchaga qo'shildi`,"Muvaffaqiyat","success")}}},placeholder:"1",disabled:!c,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-center text-lg sm:text-xl font-bold rounded-lg focus:outline-none focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed ${c&&ce&&parseInt(ce)>c.quantity?"bg-red-50 border-2 border-red-500 text-red-700 focus:border-red-500 focus:ring-red-500/20":"bg-surface-50 border border-surface-200 focus:border-gray-500 focus:ring-gray-500/20"}`})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1 sm:gap-2 mb-3",children:["7","8","9","C","4","5","6","âŒ«","1","2","3","+","0","00","."].map(a=>e.jsx("button",{onClick:()=>l(a),className:`
                flex items-center justify-center rounded-lg text-base sm:text-lg font-semibold transition-all active:scale-95
                ${a==="C"?"bg-red-500 text-white hover:bg-red-600":""}
                ${a==="âŒ«"?"bg-orange-500 text-white hover:bg-orange-600":""}
                ${a==="+"?`${A==="kod"?"bg-green-500 hover:bg-green-600":"bg-blue-500 hover:bg-blue-600"} text-white row-span-2`:""}
                ${["C","âŒ«","+"].includes(a)?"":"bg-surface-100 text-surface-700 hover:bg-surface-200"}
                ${a==="+"?"h-full":"h-10 sm:h-12 lg:h-14"}
              `,children:a==="âŒ«"?e.jsx(Vt,{className:"w-4 h-4 sm:w-5 sm:h-5"}):a==="+"?A==="kod"?"+":"âœ“":a},a))})]}),b&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-4 sm:pt-20 px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>f(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl relative z-10 overflow-hidden max-h-[90vh] sm:max-h-none",children:[e.jsx("div",{className:"p-4 border-b border-surface-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Nom yoki kod bo'yicha qidiring...",value:y,onChange:a=>n(a.target.value),className:"w-full pl-12 pr-4 py-3 bg-surface-50 border border-surface-200 rounded-xl focus:outline-none focus:border-brand-500",autoFocus:!0})]})}),e.jsxs("div",{className:"max-h-80 sm:max-h-96 overflow-auto",children:[E.map(a=>e.jsxs("button",{onClick:()=>W(a),className:"w-full flex items-center gap-3 p-4 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx($e,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500",children:[e.jsxs("span",{children:["Kod: ",a.code]}),a.quantity!==void 0&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${a.quantity>10?"bg-success-100 text-success-700":a.quantity>0?"bg-warning-100 text-warning-700":"bg-danger-100 text-danger-700"}`,children:a.quantity>0?`${a.quantity} ta`:"Tugagan"})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsx("p",{className:"font-semibold text-brand-600",children:u(a.price)})})]},a._id)),y&&E.length===0&&e.jsx("p",{className:"text-center text-surface-500 py-8",children:"Tovar topilmadi"})]})]})]}),_&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-4 sm:pt-20 px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>Y(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl relative z-10 overflow-hidden max-h-[90vh] sm:max-h-none",children:[e.jsxs("div",{className:"p-4 border-b border-surface-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Mijoz tanlash"}),e.jsx("button",{onClick:()=>Y(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:bg-surface-100 transition-colors",children:"Ã—"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz ismi yoki telefon raqami...",value:ae,onChange:a=>te(a.target.value),className:"w-full pl-12 pr-4 py-3 bg-surface-50 border border-surface-200 rounded-xl focus:outline-none focus:border-brand-500",autoFocus:!0})]})]}),e.jsx("div",{className:"max-h-80 sm:max-h-96 overflow-auto",children:ue.length>0?ue.map(a=>e.jsxs("button",{onClick:()=>{O(a),Y(!1),V("")},className:"w-full flex items-center gap-3 p-4 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:a.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500",children:[e.jsx("span",{children:a.phone}),a.debt>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 rounded text-xs font-medium",children:[u(a.debt)," so'm qarz"]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"text-sm text-surface-600",children:[u(a.totalPurchases)," so'm"]}),e.jsx("p",{className:"text-xs text-surface-400",children:"jami xarid"})]})]},a._id)):e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-surface-500",children:ae?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"})})})]})]}),d&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>m(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"To'lov turlarini tanlang"}),N&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-brand-600",children:N.name.charAt(0)})}),e.jsx("span",{className:"text-sm text-surface-600 truncate",children:N.name})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Jami summa:"}),e.jsxs("p",{className:"text-2xl sm:text-3xl font-bold text-surface-900 mb-3",children:[u(Pe)," so'm"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(Je,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Naqd pul:"})]}),e.jsxs("span",{className:"font-semibold",children:[u(ze.cash)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(vs,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Click:"})]}),e.jsxs("span",{className:"font-semibold",children:[u(ze.click)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(fs,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Plastik karta:"})]}),e.jsxs("span",{className:"font-semibold",children:[u(ze.card)," so'm"]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 flex justify-between",children:[e.jsx("span",{className:"text-surface-600",children:"Jami to'lov:"}),e.jsxs("span",{className:"font-bold text-lg",children:[u(oe)," so'm"]})]}),oe<Pe&&e.jsxs("div",{className:"flex justify-between text-warning-600",children:[e.jsx("span",{children:"Qoldiq:"}),e.jsxs("span",{className:"font-bold",children:[u(Pe-oe)," so'm"]})]}),oe>Pe&&e.jsxs("div",{className:"flex justify-between text-success-600",children:[e.jsx("span",{children:"Qaytim:"}),e.jsxs("span",{className:"font-bold",children:[u(oe-Pe)," so'm"]})]})]})]}),oe<Pe&&e.jsx("div",{className:`border rounded-lg p-3 mb-4 ${N?"bg-blue-50 border-blue-200":"bg-warning-50 border-warning-200"}`,children:e.jsx("p",{className:`text-sm ${N?"text-blue-700":"text-warning-700"}`,children:N?e.jsxs(e.Fragment,{children:["â„¹ï¸ ",u(Pe-oe)," so'm qarz daftariga qo'shiladi"]}):e.jsxs(e.Fragment,{children:["âš ï¸ ",u(Pe-oe)," so'm qoldiq - mijoz tanlanmagan"]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs",children:[e.jsx(ks,{className:`w-3 h-3 ${re.xPrinterFound?"text-green-600":re.available?"text-yellow-600":"text-red-600"}`}),e.jsx("span",{className:re.xPrinterFound?"text-green-600":re.available?"text-yellow-600":"text-red-600",children:re.xPrinterFound?"X Printer tayyor":re.available?`Printer mavjud (${re.printers.length} ta)`:"Printer topilmadi"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>Q(this,null,function*(){var a,z;if(k.length===0){s("Savat bo'sh","Ogohlantirish","warning");return}try{console.log("Chek chiqarish uchun tovar miqdorlarini kamaytirish boshlandi...");const F=[];for(const se of k)try{console.log(`${se.name} uchun miqdorni kamaytirish: ${se.cartQuantity} ta`),yield K.put(`/products/${se._id}/reduce-quantity`,{quantity:se.cartQuantity}),console.log(`âœ… ${se.name} muvaffaqiyatli yangilandi`),F.push({success:!0,item:se.name})}catch(pe){console.error(`âŒ ${se.name} miqdorini kamaytirish xatosi:`,pe);const Ae=((z=(a=pe.response)==null?void 0:a.data)==null?void 0:z.message)||"Noma'lum xatolik";F.push({success:!1,item:se.name,error:Ae})}console.log("Tovar miqdorlarini yangilash tugadi. Natijalar:",F);const X=`HELPER-${Date.now()}`,me={items:k,total:Pe,paymentMethod:"cash",customer:N,receiptNumber:X,cashier:"Kassir",date:new Date};try{console.log("Telegram botga chek ma'lumotlarini yuborish...");const se={items:k.map(Ae=>({product:Ae._id,name:Ae.name,code:Ae.code,price:Ae.price,quantity:Ae.cartQuantity,paymentBreakdown:Ae.paymentBreakdown||{cash:0,click:0,card:0}})),total:Pe,paymentMethod:"cash",customer:(N==null?void 0:N._id)||null,receiptNumber:X,paidAmount:oe,remainingAmount:Pe-oe},pe=yield K.post("/receipts/kassa",se);console.log("âœ… Chek ma'lumotlari serverga yuborildi:",pe.data)}catch(se){console.error("âŒ Telegram xabar yuborishda xatolik:",se)}if(!(yield Mr(me,()=>{const se=F.filter(as=>as.success).length,pe=F.filter(as=>!as.success).length;let Ae="Chek muvaffaqiyatli chiqarildi va telegram botga yuborildi";pe===0?s(Ae+", tovar miqdorlari yangilandi!","Muvaffaqiyat","success"):s(`${Ae}. ${se} ta tovar yangilandi, ${pe} ta xatolik`,"Ogohlantirish","warning"),P([]),O(null),m(!1),Ke()}))){const se=F.filter(as=>as.success).length,pe=F.filter(as=>!as.success).length;let Ae="Chek faylga yuklandi va telegram botga yuborildi";pe===0?s(Ae+", tovar miqdorlari yangilandi!","Ma'lumot","info"):s(`${Ae}. ${se} ta tovar yangilandi, ${pe} ta xatolik`,"Ogohlantirish","warning"),P([]),O(null),m(!1),Ke()}}catch(F){console.error("Chek chiqarish xatosi:",F),s("Chek chiqarishda xatolik yuz berdi","Xatolik","danger")}}),className:"w-full flex items-center justify-center gap-2 py-3 sm:py-4 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-semibold transition-colors",children:[e.jsx(ks,{className:"w-5 h-5"}),"Chek chiqarish (to'lovsiz)"]}),oe<Pe&&!N&&e.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-lg p-3",children:e.jsx("p",{className:"text-xs text-warning-700 text-center",children:"ðŸ’¡ Qoldiq summa uchun mijoz tanlashingiz mumkin yoki oddiy mijoz sifatida saqlashingiz mumkin"})}),e.jsx("button",{onClick:()=>m(!1),className:"w-full py-3 text-surface-600 hover:text-surface-900 transition-colors",children:"Bekor qilish"})]})]})]}),Oe&&Se&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{Be(!1),ye(null)}}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"To'lov turlarini tanlang"}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-1",children:Se.name}),e.jsxs("p",{className:"text-xs text-surface-500 font-mono mb-2",children:["Kod: ",Se.code]}),e.jsxs("p",{className:"text-lg font-bold text-surface-900",children:["Jami: ",u(Se.price*Se.cartQuantity)," so'm"]})]})]}),e.jsx(Dr,{item:Se,selectedCustomer:N,onSave:de,onCancel:()=>{Be(!1),ye(null)}})]})]}),_e&&D&&e.jsx(Rr,{isOpen:_e,onClose:()=>{R(!1),ge(null)},item:D,customer:N,onSave:(a,z)=>{P(F=>F.map(X=>{if(X._id!==D._id)return X;const me=X.paymentBreakdown||{cash:0,click:0,card:0,partner:0};return v(g({},X),{paymentBreakdown:v(g({},me),{partner:(me.partner||0)+z})})}))}}),Ye&&fe&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{De(!1),Te(null)}}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"Foizni o'zgartirish"}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-1",children:fe.name}),e.jsxs("p",{className:"text-xs text-surface-500 font-mono mb-2",children:["Kod: ",fe.code]}),e.jsxs("p",{className:"text-sm text-surface-600",children:["Miqdor: ",fe.cartQuantity," ta"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Qo'shimcha foiz (%)"}),e.jsx("input",{type:"number",value:I,onChange:a=>Ne(Number(a.target.value)||0),min:"0",max:"100",step:"0.1",className:"w-full px-3 py-2 border border-surface-200 rounded-lg text-center text-lg font-semibold focus:ring-2 focus:ring-brand-500 focus:border-transparent",placeholder:"15"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[5,10,15,20].map(a=>e.jsxs("button",{onClick:()=>Ne(a),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${I===a?"bg-brand-500 text-white":"bg-surface-100 text-surface-700 hover:bg-surface-200"}`,children:[a,"%"]},a))}),fe&&e.jsxs("div",{className:"bg-brand-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[e.jsx("span",{className:"text-surface-600",children:"Yangi narx (1 ta):"}),e.jsxs("span",{className:"font-semibold text-brand-600",children:[u(Math.round((fe.costPrice||fe.price/1.15)*(1+I/100)))," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Jami summa:"}),e.jsxs("span",{className:"font-bold text-brand-700",children:[u(Math.round((fe.costPrice||fe.price/1.15)*(1+I/100))*fe.cartQuantity)," so'm"]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{De(!1),Te(null)},className:"flex-1 py-3 px-4 bg-surface-100 text-surface-700 rounded-xl font-medium hover:bg-surface-200 transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:Xe,className:"flex-1 py-3 px-4 bg-brand-500 text-white rounded-xl font-medium hover:bg-brand-600 transition-colors",children:"Saqlash"})]})]})]})]})}function Er(){const{showAlert:s,AlertComponent:o}=rs(),r=Cs(),[h,i]=t.useState([]),[S,j]=t.useState(""),[k,P]=t.useState([]),[q,C]=t.useState(!1),[d,m]=t.useState(!1),[b,f]=t.useState("");t.useEffect(()=>{T(!0);const E=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=E}},[]),t.useEffect(()=>{T(!0)},[r.pathname]);const y=()=>Q(this,null,function*(){C(!0);try{yield T(!1),s("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(E){console.error("Refresh xatosi:",E),s("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{C(!1)}});t.useEffect(()=>{if(S.trim()==="")P(h);else{const E=h.filter($=>$.name.toLowerCase().includes(S.toLowerCase())||$.phone.includes(S));P(E)}},[h,S]);const T=(E=!0)=>Q(this,null,function*(){try{E&&m(!0),f("");const N=(yield K.get("/customers/kassa")).data.filter(O=>{const _=O.name&&O.name.trim().length>0,Y=O.phone&&O.phone.trim().length>0;return _&&Y}).map(O=>v(g({},O),{name:O.name.trim(),phone:O.phone.trim(),totalPurchases:Number(O.totalPurchases)||0,debt:Number(O.debt)||0}));i(N)}catch($){console.error("Error fetching customers:",$),f("Mijozlarni yuklashda xatolik yuz berdi")}finally{E&&m(!1)}});return e.jsxs("div",{className:"p-6",children:[o,e.jsxs("div",{className:"bg-white rounded-xl border border-surface-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz qidirish...",value:S,onChange:E=>j(E.target.value),className:"w-full pl-10 pr-4 py-2 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500"})]}),e.jsxs("button",{onClick:y,disabled:q,className:"flex items-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50",children:[e.jsx(xs,{className:`w-4 h-4 ${q?"animate-spin":""}`}),q?"Yangilanmoqda...":"Yangilash"]})]})}),e.jsx("div",{className:"divide-y divide-surface-100",children:d?e.jsx("div",{className:"p-8 text-center text-surface-500",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(xs,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Mijozlar yuklanmoqda..."})]})}):b?e.jsxs("div",{className:"p-8 text-center text-danger-500",children:[e.jsx("p",{children:b}),e.jsx("button",{onClick:y,className:"mt-2 px-4 py-2 bg-danger-100 text-danger-700 rounded-lg hover:bg-danger-200 transition-colors",children:"Qayta urinish"})]}):k.length===0?e.jsx("div",{className:"p-8 text-center text-surface-500",children:S?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"}):k.map(E=>e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-surface-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600",children:E.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:E.name}),e.jsx("p",{className:"text-sm text-surface-500",children:E.phone}),E.email&&e.jsx("p",{className:"text-xs text-surface-400",children:E.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-surface-500",children:"Jami xaridlar"}),e.jsx("p",{className:"font-semibold text-surface-900",children:u(E.totalPurchases||0)}),E.debt>0&&e.jsxs("p",{className:"text-xs text-danger-600 font-medium",children:["Qarz: ",u(E.debt)]})]})]},E._id))})]})]})}function Ar(){var ss,ts,Xe,Ee,Ke,es;const{showAlert:s,AlertComponent:o}=rs(),r=Cs(),[h,i]=t.useState([]),[S,j]=t.useState([]),[k,P]=t.useState([]),[q,C]=t.useState(!1),[d,m]=t.useState(""),[b,f]=t.useState(""),[y,T]=t.useState(""),[E,$]=t.useState(null),[N,O]=t.useState([]),[_,Y]=t.useState(!1),[ae,V]=t.useState(!1),[L,je]=t.useState({paidAmount:"",dueDate:"",description:""}),[ie,we]=t.useState(!1),[Me,p]=t.useState(!1),[B,U]=t.useState(null),[re,le]=t.useState(!1),[A,ne]=t.useState({name:"",phone:"",email:"",address:""});t.useEffect(()=>{G(),Oe(),Be();const w=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=w}},[]),t.useEffect(()=>{G(),Oe(),Be()},[r.pathname]);const ce=()=>Q(this,null,function*(){var w,J;if(!A.name.trim()||!A.phone.trim()){s("Mijoz ismi va telefon raqami majburiy","Xatolik","warning");return}try{const te=yield K.post("/customers/kassa",{name:A.name.trim(),phone:A.phone.trim(),email:A.email.trim(),address:A.address.trim()});te.data.success&&(s("Mijoz muvaffaqiyatli qo'shildi","Muvaffaqiyat","success"),Oe(),$(te.data.customer),ne({name:"",phone:"",email:"",address:""}),le(!1))}catch(te){console.error("Error creating customer:",te);const ue=((J=(w=te.response)==null?void 0:w.data)==null?void 0:J.message)||"Mijoz qo'shishda xatolik yuz berdi";s(ue,"Xatolik","danger")}}),ve=()=>{ne({name:"",phone:"",email:"",address:""}),le(!1)},c=()=>Q(this,null,function*(){V(!0);try{yield Promise.all([G(),Oe(),Be()]),s("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(w){console.error("Refresh xatosi:",w),s("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{V(!1)}}),G=()=>Q(this,null,function*(){try{const w=yield K.get("/debts/kassa");i(w.data)}catch(w){console.error("Error fetching debts:",w)}}),Oe=()=>Q(this,null,function*(){try{const w=yield K.get("/customers/kassa");j(w.data)}catch(w){console.error("Error fetching customers:",w)}}),Be=()=>Q(this,null,function*(){try{const w=yield K.get("/products/kassa");P(w.data)}catch(w){console.error("Error fetching products:",w)}}),Se=w=>{$(w);const J=h.find(te=>{var ue;return((ue=te.customer)==null?void 0:ue._id)===w._id&&te.status==="approved"});J&&s(`${w.name} mijozining ${u(J.amount-J.paidAmount)} so'm tasdiqlangan qarzi mavjud. Yangi qarz to'g'ridan-to'g'ri mavjud qarzga qo'shiladi.`,"Ma'lumot","info")},ye=()=>{C(!1),$(null),O([]),f(""),T(""),Y(!1),le(!1),je({paidAmount:"",dueDate:"",description:""}),ne({name:"",phone:"",email:"",address:""})},_e=w=>{const J=N.find(te=>te.product._id===w._id);O(J?te=>te.map(ue=>ue.product._id===w._id?v(g({},ue),{quantity:ue.quantity+1}):ue):te=>[...te,{product:w,quantity:1,price:w.price}]),T(""),Y(!1)},R=(w,J)=>{if(J<=0){O(te=>te.filter(ue=>ue.product._id!==w));return}O(te=>te.map(ue=>ue.product._id===w?v(g({},ue),{quantity:J}):ue))},D=w=>{O(J=>J.filter(te=>te.product._id!==w))},ge=w=>{U(w),we(!0)},Ye=w=>{U(w),p(!0)},De=()=>Q(this,null,function*(){var w,J;if(B)try{yield K.delete(`/debts/kassa/${B._id}`),s("Qarz muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),p(!1),U(null),G()}catch(te){console.error("Error deleting debt:",te);const ue=((J=(w=te.response)==null?void 0:w.data)==null?void 0:J.message)||"Qarzni o'chirishda xatolik yuz berdi";s(ue,"Xatolik","danger")}}),fe=()=>{we(!1),U(null)},Te=()=>{p(!1),U(null)},I=()=>Q(this,null,function*(){if(!E||N.length===0||!L.dueDate){s("Barcha majburiy maydonlarni to'ldiring","Xatolik","warning");return}try{const w=N.reduce((Pe,l)=>Pe+l.price*l.quantity,0),J=parseFloat(Re(L.paidAmount))||0;if(J>w){s(`To'langan summa (${u(J)} so'm) jami summadan (${u(w)} so'm) ko'p bo'lishi mumkin emas!`,"Xatolik","danger");return}const te={customer:E._id,amount:w,paidAmount:J,dueDate:L.dueDate,description:L.description,items:N.map(Pe=>({product:Pe.product._id,quantity:Pe.quantity,price:Pe.price}))},He=(yield K.post("/debts/kassa",te)).status===200?"Qarz mavjud qarzga muvaffaqiyatli qo'shildi! Bitta qarz sifatida ko'rinadi.":"Yangi qarz yaratildi va admin tasdiqlashini kutmoqda.";s(He,"Muvaffaqiyat","success"),ye(),G()}catch(w){console.error("Error creating debt:",w),s("Qarz qo'shishda xatolik yuz berdi","Xatolik","danger")}}),Ne=S.filter(w=>b===""||w.name.toLowerCase().includes(b.toLowerCase())||w.phone.includes(b)),oe=k.filter(w=>{if(!y.trim())return!1;const J=y.toLowerCase().trim(),te=w.name.toLowerCase(),ue=w.code.toLowerCase();return!!(ue===J||ue.startsWith(J)||ue.includes(J)||te.includes(J))}).sort((w,J)=>{const te=y.toLowerCase().trim(),ue=w.code.toLowerCase(),We=J.code.toLowerCase(),He=w.name.toLowerCase(),Pe=J.name.toLowerCase();return ue===te&&We!==te?-1:We===te&&ue!==te?1:ue.startsWith(te)&&!We.startsWith(te)?-1:We.startsWith(te)&&!ue.startsWith(te)?1:He.startsWith(te)&&!Pe.startsWith(te)?-1:Pe.startsWith(te)&&!He.startsWith(te)?1:w.name.localeCompare(J.name)}),qe=N.reduce((w,J)=>w+J.price*J.quantity,0),ze=parseFloat(Re(L.paidAmount))||0,Ce=qe-ze,Qe=h.filter(w=>{var We,He,Pe;if(!d.trim())return!0;const J=d.toLowerCase(),te=((He=(We=w.customer)==null?void 0:We.name)==null?void 0:He.toLowerCase())||"",ue=((Pe=w.customer)==null?void 0:Pe.phone)||"";return te.includes(J)||ue.includes(J)});return e.jsxs("div",{className:"p-3 sm:p-6 h-full flex flex-col overflow-hidden",children:[o,e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-6 flex-shrink-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center justify-center gap-2 px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors w-full sm:w-auto",children:[e.jsx(Je,{className:"w-4 h-4"}),"Yangi qarz"]}),e.jsxs("button",{onClick:c,disabled:ae,className:"flex items-center justify-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50 w-full sm:w-auto",children:[e.jsx(xs,{className:`w-4 h-4 ${ae?"animate-spin":""}`}),ae?"Yangilanmoqda...":"Yangilash"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 mb-6 flex-shrink-0",children:[e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl border border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx(Je,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Jami qarz"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-surface-900 truncate",children:u(h.reduce((w,J)=>w+(J.amount-J.paidAmount),0))})]})]})}),e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl border border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-success-100 rounded-lg flex items-center justify-center",children:e.jsx(gt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-success-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Jami qarzlar soni"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-surface-900",children:h.length})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-surface-200 overflow-hidden flex flex-col h-[calc(100vh-400px)] min-h-[400px]",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-surface-200 flex-shrink-0",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz qidirish...",value:d,onChange:w=>m(w.target.value),className:"w-full pl-9 sm:pl-10 pr-4 py-2 sm:py-3 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:Qe.length===0?e.jsxs("div",{className:"p-8 text-center text-surface-500",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Je,{className:"w-8 h-8 text-surface-400"})}),e.jsx("p",{className:"font-medium text-lg mb-2",children:d?"Qarz topilmadi":"Qarzlar ro'yxati bo'sh"}),e.jsx("p",{className:"text-sm",children:d?`"${d}" bo'yicha hech qanday qarz topilmadi`:"Hozircha hech qanday qarz qo'shilmagan"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block sm:hidden",children:Qe.map(w=>{var J,te,ue;return e.jsxs("div",{className:"p-4 border-b border-surface-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:(J=w.customer)==null?void 0:J.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:(te=w.customer)==null?void 0:te.name}),e.jsx("p",{className:"text-sm text-surface-500",children:(ue=w.customer)==null?void 0:ue.phone})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Qarz summasi"}),e.jsx("p",{className:"font-medium text-surface-900",children:u(w.amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Qoldiq"}),e.jsx("p",{className:"font-medium text-danger-600",children:u(w.amount-w.paidAmount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Muddat"}),e.jsx("p",{className:"text-surface-900",children:new Date(w.dueDate).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>ge(w),className:"p-2 text-brand-600 hover:text-brand-700 hover:bg-brand-50 rounded-lg transition-colors",title:"Qarz ma'lumotlarini ko'rish",children:e.jsx(bs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ye(w),className:"p-2 text-danger-600 hover:text-danger-700 hover:bg-danger-50 rounded-lg transition-colors",title:"Qarzni o'chirish",children:e.jsx(is,{className:"w-4 h-4"})})]})]})]},w._id)})}),e.jsx("div",{className:"hidden sm:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surface-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Mijoz"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Qarz"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Qoldiq"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Muddat"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Amallar"})]})}),e.jsx("tbody",{className:"divide-y divide-surface-100",children:Qe.map(w=>{var J,te,ue;return e.jsxs("tr",{className:"hover:bg-surface-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:(J=w.customer)==null?void 0:J.name.charAt(0)})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:(te=w.customer)==null?void 0:te.name}),e.jsx("p",{className:"text-sm text-surface-500 truncate",children:(ue=w.customer)==null?void 0:ue.phone})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-surface-900",children:u(w.amount)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-danger-600",children:u(w.amount-w.paidAmount)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-surface-500",children:new Date(w.dueDate).toLocaleDateString()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ge(w),className:"p-2 text-brand-600 hover:text-brand-700 hover:bg-brand-50 rounded-lg transition-colors",title:"Qarz ma'lumotlarini ko'rish",children:e.jsx(bs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ye(w),className:"p-2 text-danger-600 hover:text-danger-700 hover:bg-danger-50 rounded-lg transition-colors",title:"Qarzni o'chirish",children:e.jsx(is,{className:"w-4 h-4"})})]})})]},w._id)})})]})})]})})]}),q&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>ye()}),e.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl w-full max-w-6xl shadow-2xl relative z-10 max-h-[95vh] sm:max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 lg:p-6 border-b border-surface-200 bg-gradient-to-r from-brand-50 to-blue-50 rounded-t-2xl sm:rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-lg flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(Je,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold text-surface-900 truncate",children:E?`${E.name} uchun qarz qo'shish`:"Mijoz tanlash"}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-600 truncate",children:E?"Mahsulotlarni tanlang va to'lov ma'lumotlarini kiriting":"Qarz berish uchun mijozni tanlang"})]})]}),e.jsx("button",{onClick:()=>ye(),className:"w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors flex-shrink-0",children:e.jsx(be,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),E?e.jsxs("div",{className:"flex-1 p-3 sm:p-4 lg:p-6 overflow-y-auto min-h-0",children:[e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"bg-surface-50 p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600 text-sm sm:text-lg",children:E.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:E.name}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-500",children:E.phone})]})]})}),e.jsxs("div",{className:"bg-white border border-surface-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Mahsulotlar"}),e.jsxs("button",{onClick:()=>Y(!0),className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 lg:px-4 py-1.5 sm:py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors shadow-sm text-xs sm:text-sm",children:[e.jsx(Ze,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Mahsulot qidirish"}),e.jsx("span",{className:"sm:hidden",children:"Qo'shish"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Tez qidirish: mahsulot nomi yoki kodi...",value:y,onChange:w=>T(w.target.value),onFocus:()=>Y(!0),onKeyDown:w=>{w.key==="Enter"&&oe.length>0&&_e(oe[0]),w.key==="Escape"&&T("")},className:"w-full pl-10 pr-10 py-2 text-xs sm:text-sm bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"}),y&&e.jsx("button",{onClick:()=>T(""),className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 flex items-center justify-center text-surface-400 hover:text-surface-600 rounded-full hover:bg-surface-100",children:e.jsx(be,{className:"w-3 h-3"})})]}),y&&oe.length>0&&!_&&e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-surface-500",children:[e.jsxs("span",{children:[oe.length," ta mahsulot topildi"]}),e.jsx("span",{className:"text-brand-600",children:"Enter - birinchisini tanlash"})]})]}),y&&oe.length>0&&!_&&e.jsxs("div",{className:"mb-4 max-h-40 overflow-y-auto border border-surface-200 rounded-lg",children:[oe.slice(0,5).map(w=>e.jsxs("button",{onClick:()=>_e(w),className:"w-full flex items-center gap-3 p-2 hover:bg-surface-50 transition-colors text-left border-b border-surface-100 last:border-b-0",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded flex items-center justify-center",children:e.jsx($e,{className:"w-4 h-4 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 text-sm truncate",children:w.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-surface-500 bg-surface-100 px-2 py-0.5 rounded",children:w.code}),e.jsxs("span",{className:"text-xs text-surface-500",children:["Omborda: ",w.quantity," ta"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold text-brand-600 text-sm",children:u(w.price)})})]},w._id)),oe.length>5&&e.jsxs("button",{onClick:()=>Y(!0),className:"w-full p-2 text-center text-sm text-brand-600 hover:bg-brand-50 transition-colors",children:["Yana ",oe.length-5," ta ko'rish..."]})]}),e.jsx("div",{className:"space-y-2",children:N.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center text-surface-500 border-2 border-dashed border-surface-200 rounded-lg",children:[e.jsx($e,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Mahsulot tanlanmagan"})]}):N.map(w=>e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 bg-surface-50 rounded-lg border border-surface-200",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 text-xs sm:text-sm truncate",children:w.product.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",w.product.code]})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>R(w.product._id,w.quantity-1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded bg-surface-200 hover:bg-surface-300 transition-colors",children:e.jsx(Rs,{className:"w-3 h-3"})}),e.jsx("span",{className:"w-8 sm:w-10 text-center font-medium bg-white px-1 sm:px-2 py-1 rounded border text-xs sm:text-sm",children:w.quantity}),e.jsx("button",{onClick:()=>R(w.product._id,w.quantity+1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded bg-surface-200 hover:bg-surface-300 transition-colors",children:e.jsx(Ze,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"text-right min-w-0",children:[e.jsxs("p",{className:"font-bold text-surface-900 text-xs sm:text-sm",children:[u(w.price*w.quantity)," so'm"]}),e.jsxs("p",{className:"text-xs text-surface-500",children:[u(w.price)," Ã— ",w.quantity]})]}),e.jsx("button",{onClick:()=>D(w.product._id),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded text-danger-500 hover:bg-danger-50 transition-colors flex-shrink-0",children:e.jsx(be,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]},w.product._id))})]}),e.jsxs("div",{className:"bg-surface-50 p-3 sm:p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"Jami summa:"}),e.jsxs("span",{className:"font-semibold text-surface-900 text-xs sm:text-sm",children:[u(qe)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"To'langan:"}),e.jsxs("span",{className:"font-semibold text-success-600 text-xs sm:text-sm",children:[u(ze)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between border-t border-surface-200 pt-2",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"Qarz qoldi:"}),e.jsxs("span",{className:`font-bold text-sm sm:text-base ${Ce<0,"text-danger-600"}`,children:[Ce<0?"-":"",u(Math.abs(Ce))," so'm"]})]}),Ce<0&&e.jsx("div",{className:"bg-danger-50 border border-danger-200 rounded-lg p-2 mt-2",children:e.jsx("p",{className:"text-danger-700 text-xs font-medium",children:"âš ï¸ To'langan summa jami summadan ko'p! Qarz minus bo'ldi."})})]}),e.jsxs("div",{className:"bg-white border border-surface-200 rounded-xl p-4 space-y-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"To'lov ma'lumotlari"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-surface-700 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(Je,{className:"w-3 h-3 sm:w-4 sm:h-4 text-success-600"}),"To'langan summa"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"0",value:L.paidAmount,onChange:w=>{const J=Ue(w.target.value);if((parseFloat(Re(J))||0)>qe&&qe>0){s(`To'langan summa jami summadan (${u(qe)} so'm) ko'p bo'lishi mumkin emas!`,"Ogohlantirish","warning");return}je(ue=>v(g({},ue),{paidAmount:J}))},className:`w-full pl-3 sm:pl-4 pr-12 sm:pr-16 py-3 sm:py-4 text-base sm:text-lg font-semibold border-2 rounded-xl focus:outline-none focus:ring-4 transition-all ${Ce<0?"border-danger-500 bg-gradient-to-r from-danger-50 to-red-50 focus:border-danger-500 focus:ring-danger-500/10":ze<qe&&ze>0?"border-orange-400 bg-gradient-to-r from-yellow-100 to-orange-100 focus:border-orange-400 focus:ring-orange-400/10":"border-surface-200 bg-gradient-to-r from-white to-success-50 focus:border-success-500 focus:ring-success-500/10"}`}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 sm:pr-4 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-surface-500 font-medium text-xs sm:text-sm",children:"so'm"})})]}),L.paidAmount&&e.jsxs("div",{className:`mt-2 text-xs sm:text-sm font-medium ${Ce<0?"text-danger-600":"text-success-600"}`,children:[L.paidAmount," so'm",Ce<0&&e.jsx("span",{className:"block text-danger-600 font-bold mt-1",children:"âš ï¸ Jami summadan ko'p!"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-surface-700 mb-2",children:[e.jsx(js,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"Qaytarish muddati *"]}),e.jsx("input",{type:"date",value:L.dueDate,onChange:w=>je(J=>v(g({},J),{dueDate:w.target.value})),className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"})]})]})]}),_&&e.jsxs("div",{className:"fixed inset-0 z-60 flex items-center justify-center p-2 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>Y(!1)}),e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-4xl shadow-2xl relative z-10 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-3 sm:p-4 border-b border-surface-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h5",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Mahsulot tanlash"}),e.jsx("button",{onClick:()=>Y(!1),className:"text-surface-400 hover:text-surface-600",children:e.jsx(be,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mahsulot nomi yoki kodi bilan qidiring...",value:y,onChange:w=>T(w.target.value),className:"w-full pl-10 pr-4 py-2 sm:py-3 text-xs sm:text-sm bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",autoFocus:!0})]}),y&&e.jsxs("div",{className:"mt-2 text-xs text-surface-500",children:['"',y,`" bo'yicha `,oe.length," ta natija topildi"]})]}),e.jsx("div",{className:"max-h-80 sm:max-h-96 overflow-y-auto p-3 sm:p-4",children:oe.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center text-surface-500",children:[e.jsx($e,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium mb-1 text-sm",children:y?"Mahsulot topilmadi":"Qidirish uchun mahsulot nomini yoki kodini kiriting"}),y&&e.jsxs("p",{className:"text-xs",children:['"',y,`" bo'yicha hech narsa topilmadi`]})]}):e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[oe.slice(0,100).map(w=>e.jsxs("button",{onClick:()=>_e(w),className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 hover:bg-surface-50 transition-colors text-left border border-surface-200 rounded-lg group",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-lg flex items-center justify-center group-hover:bg-brand-200 transition-colors flex-shrink-0",children:e.jsx($e,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate text-xs sm:text-sm",children:w.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-surface-500 bg-surface-100 px-2 py-1 rounded",children:["Kod: ",w.code]}),e.jsxs("span",{className:"text-xs text-surface-500",children:["Omborda: ",w.quantity," ta"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-brand-600 text-sm sm:text-base",children:[u(w.price)," so'm"]}),e.jsx("p",{className:"text-xs text-surface-500",children:"Narxi"})]})]},w._id)),oe.length>100&&e.jsx("div",{className:"p-3 text-center text-surface-500 text-xs border-t border-surface-200",children:"Faqat birinchi 100 ta natija ko'rsatildi. Aniqroq qidiring."})]})}),e.jsx("div",{className:"p-3 sm:p-4 border-t border-surface-200 bg-surface-50",children:e.jsx("div",{className:"flex items-center gap-2 text-xs text-surface-500",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-3 h-3"}),e.jsx("span",{children:"Maslahat: Mahsulot nomini yoki kodini to'liq kiriting"})]})})})]})]})]}):e.jsxs("div",{className:"flex-1 p-3 sm:p-4 lg:p-6 overflow-y-auto min-h-0",children:[e.jsx("div",{className:"relative mb-3 sm:mb-4 lg:mb-6",children:e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ge,{className:"w-4 h-4 sm:w-5 sm:h-5 text-surface-400"})}),e.jsx("input",{type:"text",placeholder:"Mijoz ismi yoki telefon raqami bilan qidiring...",value:b,onChange:w=>f(w.target.value),className:"w-full pl-9 sm:pl-10 pr-4 py-2 sm:py-3 text-sm bg-white border-2 border-surface-200 rounded-xl focus:outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 transition-all"}),b&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("button",{onClick:()=>f(""),className:"w-5 h-5 flex items-center justify-center text-surface-400 hover:text-surface-600 rounded-full hover:bg-surface-100",children:e.jsx(be,{className:"w-3 h-3"})})})]}),e.jsxs("button",{onClick:()=>le(!0),className:"flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-3 bg-success-500 text-white rounded-xl hover:bg-success-600 transition-colors flex-shrink-0",title:"Yangi mijoz qo'shish",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi mijoz"})]})]})}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:Ne.length===0?e.jsxs("div",{className:"p-6 sm:p-8 lg:p-12 text-center text-surface-500",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-surface-100 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4",children:e.jsx(Ge,{className:"w-6 h-6 sm:w-8 sm:h-8 text-surface-400"})}),e.jsx("p",{className:"font-medium text-sm sm:text-base lg:text-lg mb-2",children:b?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"}),e.jsx("p",{className:"text-xs sm:text-sm",children:b?`"${b}" bo'yicha hech kim topilmadi`:"Hozircha mijozlar qo'shilmagan"})]}):Ne.map(w=>{const J=h.find(te=>{var ue;return((ue=te.customer)==null?void 0:ue._id)===w._id&&te.status==="pending_approval"});return e.jsx("button",{onClick:()=>Se(w),className:"w-full p-3 sm:p-4 hover:bg-gradient-to-r hover:from-brand-50 hover:to-blue-50 transition-all duration-200 text-left border-2 border-surface-200 hover:border-brand-300 rounded-xl group",children:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center shadow-lg group-hover:shadow-xl transition-shadow flex-shrink-0",children:e.jsx("span",{className:"text-sm sm:text-base lg:text-lg font-bold text-white",children:w.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-surface-900 text-sm sm:text-base lg:text-lg truncate",children:w.name}),J&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-warning-100 text-warning-700 flex-shrink-0",children:"Qarz mavjud"})]}),e.jsxs("p",{className:"text-surface-600 flex items-center gap-1 text-xs sm:text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{className:"truncate",children:w.phone})]}),J&&e.jsxs("p",{className:"text-xs text-warning-600 font-medium mt-1",children:["Mavjud qarz: ",u(J.amount-J.paidAmount)," so'm"]}),w.email&&e.jsxs("p",{className:"text-xs text-surface-500 flex items-center gap-1 mt-1",children:[e.jsx("svg",{className:"w-3 h-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("span",{className:"truncate",children:w.email})]})]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-brand-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})},w._id)})})]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row items-center justify-between gap-3 p-3 sm:p-4 lg:p-6 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-surface-600 order-2 sm:order-1",children:E&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-success-500 rounded-full"}),e.jsxs("span",{children:["Mijoz tanlandi: ",E.name]})]})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto order-1 sm:order-2",children:[E&&e.jsxs("button",{onClick:()=>$(null),className:"flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors text-xs sm:text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Orqaga"]}),e.jsx("button",{onClick:()=>ye(),className:"px-3 sm:px-4 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors text-xs sm:text-sm",children:"Bekor qilish"}),E&&e.jsxs("button",{onClick:I,disabled:N.length===0||!L.dueDate,className:"flex items-center gap-1 sm:gap-2 px-4 sm:px-6 py-2 bg-gradient-to-r from-brand-500 to-brand-600 text-white rounded-lg hover:from-brand-600 hover:to-brand-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-xs sm:text-sm flex-1 sm:flex-none justify-center",children:[e.jsx(Je,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Qarz qo'shish",qe>0&&e.jsxs("span",{className:"ml-2 px-2 py-1 bg-white/20 rounded text-xs hidden sm:inline",children:[u(Ce)," so'm"]})]})]})]})]})]}),ie&&B&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:fe}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl shadow-2xl relative z-10 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-surface-200 bg-gradient-to-r from-brand-50 to-blue-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(bs,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-surface-900",children:"Qarz ma'lumotlari"}),e.jsxs("p",{className:"text-sm text-surface-600",children:["#",B._id.slice(-6)]})]})]}),e.jsx("button",{onClick:fe,className:"w-10 h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-3",children:"Mijoz ma'lumotlari"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600 text-lg",children:(ss=B.customer)==null?void 0:ss.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-surface-900",children:(ts=B.customer)==null?void 0:ts.name}),e.jsx("p",{className:"text-surface-600",children:(Xe=B.customer)==null?void 0:Xe.phone}),((Ee=B.customer)==null?void 0:Ee.email)&&e.jsx("p",{className:"text-sm text-surface-500",children:(Ke=B.customer)==null?void 0:Ke.email})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Qarz summasi"}),e.jsxs("p",{className:"text-2xl font-bold text-surface-900",children:[u(B.amount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"To'langan"}),e.jsxs("p",{className:"text-2xl font-bold text-success-600",children:[u(B.paidAmount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Qoldiq"}),e.jsxs("p",{className:"text-2xl font-bold text-danger-600",children:[u(B.amount-B.paidAmount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Muddat"}),e.jsx("p",{className:"text-lg font-semibold text-surface-900",children:new Date(B.dueDate).toLocaleDateString()})]})]}),B.description&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-2",children:"Izoh"}),e.jsx("p",{className:"text-surface-700",children:B.description})]}),B.items&&B.items.length>0&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-3",children:"Mahsulotlar"}),e.jsx("div",{className:"space-y-2",children:B.items.map((w,J)=>{var te;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-surface-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded flex items-center justify-center",children:e.jsx($e,{className:"w-4 h-4 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:((te=w.product)==null?void 0:te.name)||"Mahsulot"}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Miqdor: ",w.quantity]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[u(w.price*w.quantity)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:[u(w.price)," Ã— ",w.quantity]})]})]},J)})})]}),e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Yaratilgan"}),e.jsx("p",{className:"font-semibold text-surface-900",children:new Date(B.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:"flex justify-end gap-3 p-6 border-t border-surface-200 bg-surface-50/50",children:e.jsx("button",{onClick:fe,className:"px-6 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Yopish"})})]})]}),Me&&B&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:Te}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-surface-200 bg-gradient-to-r from-danger-50 to-red-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-danger-500 to-danger-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(is,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-surface-900",children:"Qarzni o'chirish"}),e.jsx("p",{className:"text-sm text-surface-600",children:"Bu amalni bekor qilib bo'lmaydi"})]})]}),e.jsx("button",{onClick:Te,className:"w-10 h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-danger-50 p-4 rounded-xl border border-danger-200 mb-4",children:[e.jsx("p",{className:"text-danger-800 font-medium mb-2",children:"Diqqat!"}),e.jsxs("p",{className:"text-danger-700 text-sm",children:["Siz ",e.jsx("strong",{children:(es=B.customer)==null?void 0:es.name})," mijozining ",e.jsxs("strong",{children:[u(B.amount)," so'm"]})," qarzini o'chirmoqchisiz. Bu amal bekor qilinmaydi va barcha ma'lumotlar yo'qoladi."]}),B.status==="approved"&&e.jsxs("p",{className:"text-danger-600 text-xs mt-2",children:[e.jsx("strong",{children:"Eslatma:"})," Bu tasdiqlangan qarz. O'chirilganda mijozning umumiy qarzidan ham ayriladi."]})]}),e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Qarz summasi:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[u(B.amount)," so'm"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-surface-600",children:"Qoldiq:"}),e.jsxs("span",{className:"font-semibold text-danger-600",children:[u(B.amount-B.paidAmount)," so'm"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("button",{onClick:Te,className:"px-6 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:De,className:"px-6 py-2 bg-gradient-to-r from-danger-500 to-danger-600 text-white rounded-lg hover:from-danger-600 hover:to-danger-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:"O'chirish"})]})]})]}),re&&e.jsxs("div",{className:"fixed inset-0 z-60 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:ve}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-surface-200 bg-gradient-to-r from-success-50 to-green-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-success-500 to-success-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(Ze,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-surface-900",children:"Yangi mijoz qo'shish"}),e.jsx("p",{className:"text-sm text-surface-600",children:"Mijoz ma'lumotlarini kiriting"})]})]}),e.jsx("button",{onClick:ve,className:"w-10 h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Mijoz ismi *"}),e.jsx("input",{type:"text",value:A.name,onChange:w=>ne(J=>v(g({},J),{name:w.target.value})),className:"w-full px-4 py-3 border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20",placeholder:"Mijoz ismini kiriting"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Telefon raqami *"}),e.jsx("input",{type:"tel",value:A.phone,onChange:w=>ne(J=>v(g({},J),{phone:w.target.value})),className:"w-full px-4 py-3 border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20",placeholder:"+998 90 123 45 67"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Email (ixtiyoriy)"}),e.jsx("input",{type:"email",value:A.email,onChange:w=>ne(J=>v(g({},J),{email:w.target.value})),className:"w-full px-4 py-3 border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20",placeholder:"mijoz@email.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Manzil (ixtiyoriy)"}),e.jsx("textarea",{value:A.address,onChange:w=>ne(J=>v(g({},J),{address:w.target.value})),className:"w-full px-4 py-3 border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20 resize-none",rows:3,placeholder:"Mijoz manzilini kiriting"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("button",{onClick:ve,className:"px-6 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:ce,disabled:!A.name.trim()||!A.phone.trim(),className:"px-6 py-2 bg-gradient-to-r from-success-500 to-success-600 text-white rounded-lg hover:from-success-600 hover:to-success-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:"Mijoz qo'shish"})]})]})]})]})}const Ut="http://localhost:5000";function Br(){const{showAlert:s,showConfirm:o,AlertComponent:r}=rs(),h=Cs(),[i,S]=t.useState([]),[j,k]=t.useState(null),[P,q]=t.useState([]),[C,d]=t.useState(""),[m,b]=t.useState("all"),[f,y]=t.useState(!1),[T,E]=t.useState(!1),[$,N]=t.useState(!1),[O,_]=t.useState(!1),[Y,ae]=t.useState(!1),[V,L]=t.useState(null),[je,ie]=t.useState(null),[we,Me]=t.useState(!1),[p,B]=t.useState({code:"",name:"",quantity:"",previousPrice:"",currentPrice:"",unit:"dona",conversionEnabled:!1,baseUnit:"dona",conversionRate:"",packageCount:"",pricePerMeter:"",pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),[U,re]=t.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[le,A]=t.useState([]),[ne,ce]=t.useState(""),[ve,c]=t.useState(!1),[G,Oe]=t.useState(!1),[Be,Se]=t.useState("add"),[ye,_e]=t.useState(""),[R,D]=t.useState({printer:"",copies:1,size:"card",layout:"standard",customWidth:"",customHeight:""}),[ge,Ye]=t.useState([]),De=t.useRef(null);t.useEffect(()=>{fe()},[]),t.useEffect(()=>{j&&Te()},[j]),t.useEffect(()=>{j&&Te()},[h.pathname]),t.useEffect(()=>{let l=i;C.trim()!==""&&(l=l.filter(Z=>Z.name.toLowerCase().includes(C.toLowerCase())||Z.code.toLowerCase().includes(C.toLowerCase()))),m!=="all"&&(m==="low"?l=l.filter(Z=>Z.quantity<=(Z.minStock||50)&&Z.quantity>0):m==="out"&&(l=l.filter(Z=>Z.quantity===0))),q(l)},[i,C,m]);const fe=()=>Q(this,null,function*(){try{const Z=(yield K.get("/warehouses")).data.find(xe=>xe.name==="Asosiy ombor");if(Z)k(Z);else{const xe=yield K.post("/warehouses",{name:"Asosiy ombor",address:""});k(xe.data)}}catch(l){console.error("Error fetching warehouses:",l),y(!1)}}),Te=()=>Q(this,null,function*(){try{y(!0);const l=yield K.get("/products?mainOnly=true");S(l.data)}catch(l){console.error("Error fetching products:",l),s("Tovarlarni yuklashda xatolik yuz berdi","Xatolik","danger")}finally{y(!1)}}),I=()=>Q(this,null,function*(){E(!0);try{yield Te(),s("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(l){console.error("Refresh xatosi:",l),s("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{E(!1)}}),Ne=l=>Q(this,null,function*(){const Z=l.target.files;if(!Z||Z.length===0)return;const xe=8-le.length;if(xe<=0){s("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const Le=Array.from(Z).slice(0,xe),x=new FormData;Le.forEach(W=>x.append("images",W)),Me(!0);try{const W=yield K.post("/products/upload-images",x,{headers:{"Content-Type":"multipart/form-data"}});A([...le,...W.data.images])}catch(W){console.error("Error uploading images:",W),s("Rasmlarni yuklashda xatolik","Xatolik","danger")}finally{Me(!1),De.current&&(De.current.value="")}}),oe=l=>Q(this,null,function*(){try{yield K.delete("/products/delete-image",{data:{imagePath:l}}),A(le.filter(Z=>Z!==l))}catch(Z){console.error("Error deleting image:",Z)}}),qe=l=>Q(this,null,function*(){var x,W;if(l.preventDefault(),ne){s(ne,"Xatolik","danger");return}let Z=Number(p.quantity),xe=null;if(ve&&U.packageCount&&U.unitsPerPackage){const ee=Number(U.packageCount)*Number(U.unitsPerPackage);Z=je?Number(p.quantity)+ee:ee,xe={packageCount:Number(U.packageCount),unitsPerPackage:Number(U.unitsPerPackage),totalUnits:ee}}let Le=Z;p.conversionEnabled&&p.conversionRate&&(Le=Z*Number(p.conversionRate));try{const ee={code:p.code,name:p.name,price:Number(p.currentPrice),previousPrice:Number(p.previousPrice)||0,currentPrice:Number(p.currentPrice)||0,quantity:Z,warehouse:j==null?void 0:j._id,images:le,packageInfo:xe,unit:p.unit,unitConversion:{enabled:p.conversionEnabled,baseUnit:p.baseUnit,conversionRate:Number(p.conversionRate)||1,packageCount:Z,totalBaseUnits:Le},prices:{perUnit:Number(p.currentPrice),perMeter:Number(p.pricePerMeter)||0,perRoll:Number(p.pricePerRoll)||0,perBox:Number(p.pricePerBox)||0,perKg:Number(p.pricePerKg)||0,perGram:Number(p.pricePerGram)||0}};je?yield K.put(`/products/${je._id}`,ee):yield K.post("/products",ee),Te(),Xe()}catch(ee){s(((W=(x=ee.response)==null?void 0:x.data)==null?void 0:W.message)||"Xatolik yuz berdi","Xatolik","danger")}}),ze=l=>Q(this,null,function*(){if(yield o("Tovarni o'chirishni tasdiqlaysizmi?","O'chirish"))try{yield K.delete(`/products/${l}`),Te()}catch(xe){console.error("Error deleting product:",xe)}}),Ce=l=>{var Z,xe,Le,x,W,ee,n,M,H;ie(l),B({code:l.code,name:l.name,previousPrice:String(l.previousPrice||0),currentPrice:String(l.currentPrice||l.price),quantity:String(l.quantity),unit:l.unit||"dona",conversionEnabled:((Z=l.unitConversion)==null?void 0:Z.enabled)||!1,baseUnit:((xe=l.unitConversion)==null?void 0:xe.baseUnit)||"dona",conversionRate:String(((Le=l.unitConversion)==null?void 0:Le.conversionRate)||""),packageCount:String(((x=l.unitConversion)==null?void 0:x.packageCount)||""),pricePerMeter:String(((W=l.prices)==null?void 0:W.perMeter)||""),pricePerRoll:String(((ee=l.prices)==null?void 0:ee.perRoll)||""),pricePerBox:String(((n=l.prices)==null?void 0:n.perBox)||""),pricePerKg:String(((M=l.prices)==null?void 0:M.perKg)||""),pricePerGram:String(((H=l.prices)==null?void 0:H.perGram)||"")}),A(l.images||[]),re({packageCount:"",unitsPerPackage:"",totalCost:""}),ce(""),c(!1),N(!0)},Qe=l=>{L(l),_(!0)},ss=l=>{L(l),ae(!0),ts()},ts=()=>Q(this,null,function*(){try{const l=["EPSON L132 Series (Copy 1)","EPSON L132 Series","X printer"];Ye(l),D(Z=>v(g({},Z),{printer:l[0]}))}catch(l){console.error("Error loading printers:",l),Ye(["EPSON L132 Series","X printer"])}}),Xe=()=>{N(!1),ie(null),B({code:"",name:"",quantity:"",previousPrice:"",currentPrice:"",unit:"dona",conversionEnabled:!1,baseUnit:"dona",conversionRate:"",packageCount:"",pricePerMeter:"",pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),re({packageCount:"",unitsPerPackage:"",totalCost:""}),A([]),ce(""),c(!1)},Ee=l=>{Se(l),_e(""),Oe(!0)},Ke=()=>{const l=Number(ye)||0;if(l<=0)return;const Z=Number(p.quantity)||0;let xe=Be==="add"?Z+l:Z-l;xe<0&&(xe=0),B(v(g({},p),{quantity:String(xe)})),Oe(!1),_e("")},es=()=>Q(this,null,function*(){try{const l=yield K.get("/products/next-code");B({code:l.data.code,name:"",quantity:"",previousPrice:"",currentPrice:"",unit:"dona",conversionEnabled:!1,baseUnit:"dona",conversionRate:"",packageCount:"",pricePerMeter:"",pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""})}catch(l){console.error("Error getting next code:",l)}re({packageCount:"",unitsPerPackage:"",totalCost:""}),A([]),ce(""),c(!1),N(!0)}),w=l=>Q(this,null,function*(){if(l)try{const Z=(je==null?void 0:je._id)||"";(yield K.get(`/products/check-code/${l}${Z?`?excludeId=${Z}`:""}`)).data.exists?ce(`Kod "${l}" allaqachon mavjud`):ce("")}catch(Z){console.error("Error checking code:",Z)}}),J=()=>{if(!V)return;const l=document.getElementById("qr-code-svg");if(!l)return;const Z=new XMLSerializer().serializeToString(l),xe=document.createElement("canvas"),Le=xe.getContext("2d"),x=document.createElement("img");x.onload=()=>{xe.width=x.width,xe.height=x.height,Le==null||Le.drawImage(x,0,0);const W=xe.toDataURL("image/png"),ee=document.createElement("a");ee.download=`QR-${V.code}-${V.name}.png`,ee.href=W,ee.click()},x.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(Z)))},te=(l,Z)=>Q(this,null,function*(){try{const xe=JSON.stringify({id:l._id,code:l.code,name:l.name,price:l.price});return yield Nt.toDataURL(xe,{width:Z*10,margin:1,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"H",type:"image/png"})}catch(xe){return console.error("Error generating QR code:",xe),""}}),ue=()=>Q(this,null,function*(){if(V)try{const l=R.customWidth&&R.customHeight,Z=l?`${R.customWidth}mm`:null,xe=l?`${R.customHeight}mm`:null,Le=R.size==="card"?65:R.size==="thermal"?125:145,x=yield te(V,Le),W=`
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="utf-8">
          <title>Label - ${V.name}</title>
          <style>
            @page {
              size: ${l?`${Z} ${xe}`:R.size==="card"?"28mm 18mm":R.size==="A4"?"A4":R.size==="A5"?"A5":"50mm 70mm"};
              margin: 0;
            }
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            html, body {
              width: 100%;
              height: 100%;
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              background: white;
              overflow: hidden;
            }
            .page-container {
              width: 100%;
              height: 100vh;
              display: flex;
              justify-content: center;
              align-items: center;
              page-break-after: avoid;
            }
            .label-container {
              border: 2px solid #333;
              padding: ${R.size==="card"?"1mm":R.size==="thermal"?"6px":"12px"};
              background: white;
              width: ${l?Z:R.size==="card"?"26mm":R.size==="thermal"?"44mm":R.size==="A4"?"80mm":(R.size==="A5","120mm")};
              height: ${l?xe:R.size==="card"?"16mm":R.size==="thermal"?"60mm":R.size==="A4"?"100mm":(R.size==="A5","140mm")};
              display: flex;
              flex-direction: column;
              justify-content: space-between;
              gap: 2px;
              overflow: hidden;
              border-radius: 2px;
              page-break-inside: avoid;
            }
            .product-info {
              flex: 1;
              width: 100%;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              text-align: center;
              height: auto;
            }
            .product-name {
              font-size: ${R.size==="card"?"8px":R.size==="thermal"?"16px":"20px"};
              font-weight: 600;
              color: #1a1a1a;
              line-height: 1.1;
              margin-bottom: ${R.size==="card"?"1px":"2px"};
              word-wrap: break-word;
              overflow: hidden;
              text-overflow: ellipsis;
              display: -webkit-box;
              -webkit-line-clamp: ${R.size==="card"?"1":"2"};
              -webkit-box-orient: vertical;
            }
            .product-code {
              font-size: ${R.size==="card"?"7px":R.size==="thermal"?"14px":"18px"};
              color: #666;
              line-height: 1.0;
              margin-bottom: ${R.size==="card"?"1px":"2px"};
              font-weight: 500;
            }
            .product-price {
              font-size: ${R.size==="card"?"12px":R.size==="thermal"?"20px":"24px"};
              font-weight: 800;
              color: #d32f2f;
              line-height: 1.0;
              margin-bottom: ${R.size==="card"?"0px":"1px"};
            }
            .qr-code-section {
              flex-shrink: 0;
              display: flex;
              align-items: center;
              justify-content: center;
              width: 100%;
              height: auto;
              padding: 2px 0;
              overflow: hidden;
              box-sizing: border-box;
            }
            .qr-code-img {
              width: ${R.size==="card"?"60px":R.size==="thermal"?"120px":"140px"};
              height: ${R.size==="card"?"60px":R.size==="thermal"?"120px":"140px"};
              max-width: 95%;
              max-height: 95%;
              border: 1px solid #e0e0e0;
              border-radius: 2px;
              background: white;
              object-fit: contain;
              image-rendering: -webkit-optimize-contrast;
              image-rendering: crisp-edges;
              image-rendering: pixelated;
            }
            .additional-info {
              margin: 0;
              font-size: ${R.size==="card"?"4px":R.size==="thermal"?"10px":"12px"};
              color: #888;
              line-height: 1.0;
              font-weight: 400;
            }
            ${R.layout==="minimal"?".additional-info { display: none; }":""}
            
            @media print {
              html, body {
                background: white !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                margin: 0 !important;
                padding: 0 !important;
              }
              .page-container {
                height: 100vh !important;
                page-break-after: avoid !important;
              }
              .label-container {
                page-break-inside: avoid !important;
                width: ${l?Z:R.size==="card"?"28mm":R.size==="thermal"?"48mm":R.size==="A4"?"85mm":(R.size==="A5","130mm")} !important;
                height: ${l?xe:R.size==="card"?"18mm":R.size==="thermal"?"65mm":R.size==="A4"?"105mm":(R.size==="A5","145mm")} !important;
                padding: ${R.size==="card"?"1.5mm":R.size==="thermal"?"8px":"15px"} !important;
                flex-direction: column !important;
                justify-content: space-between !important;
              }
              .qr-code-section {
                width: 100% !important;
                height: auto !important;
                overflow: hidden !important;
                box-sizing: border-box !important;
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
              }
              .qr-code-img {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                width: ${R.size==="card"?"65px":R.size==="thermal"?"125px":"145px"} !important;
                height: ${R.size==="card"?"65px":R.size==="thermal"?"125px":"145px"} !important;
                max-width: 95% !important;
                max-height: 95% !important;
                object-fit: contain !important;
              }
            }
          </style>
        </head>
        <body>
          <div class="page-container">
            <div class="label-container">
              <div class="product-info">
                <div class="product-price">${u(V.currentPrice||V.price)} so'm</div>
                <div class="product-code">Kod: ${V.code}</div>
                <div class="product-name">${V.name}</div>
                
                ${R.layout==="standard"?`
                  <div class="additional-info">
                    Miqdor: ${V.quantity} | ${new Date().toLocaleDateString("uz-UZ")}
                  </div>
                `:""}
              </div>
              
              <div class="qr-code-section">
                <img src="${x}" alt="QR Code" class="qr-code-img" />
              </div>
            </div>
          </div>
        </body>
        </html>
      `,ee=window.open("","_blank","width=1024,height=768");if(!ee){alert("Popup blocker tomonidan to'sib qo'yildi. Popup'larni yoqing.");return}ee.document.open(),ee.document.write(W),ee.document.close(),ee.onload=()=>{setTimeout(()=>{ee.focus(),ee.print(),setTimeout(()=>{ee.close()},1e3)},500)},ae(!1)}catch(l){console.error("Error generating print content:",l),alert("Chop uchun tayyorlashda xatolik yuz berdi")}}),We={total:i.length,lowStock:i.filter(l=>l.quantity<=(l.minStock||50)&&l.quantity>0).length,outOfStock:i.filter(l=>l.quantity===0).length,totalValue:i.reduce((l,Z)=>l+Z.price*Z.quantity,0)},He=l=>l.images&&l.images.length>0?`${Ut}${l.images[0]}`:null,Pe=[{label:"Jami tovarlar",value:We.total,icon:$e,color:"brand",filter:"all"},{label:"Kam qolgan",value:We.lowStock,icon:ls,color:"warning",filter:"low"},{label:"Tugagan",value:We.outOfStock,icon:be,color:"danger",filter:"out"},{label:"Jami qiymat",value:`${u(We.totalValue)} so'm`,icon:Je,color:"success",filter:null}];return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5 text-brand-600"}),e.jsx("h2",{className:"text-lg font-semibold text-surface-900",children:"Tovarlar (Asosiy ombor)"})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:es,className:"btn-primary",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi tovar"})]}),e.jsxs("button",{onClick:I,disabled:T,className:"flex items-center justify-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50",title:"Tovarlar ro'yxatini yangilash (F5)",children:[e.jsx(xs,{className:`w-4 h-4 ${T?"animate-spin":""}`}),e.jsx("span",{className:"sm:inline",children:T?"Yangilanmoqda...":"Yangilash"})]})]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:Pe.map((l,Z)=>e.jsxs("div",{onClick:()=>l.filter&&b(l.filter),className:`stat-card ${l.filter?"cursor-pointer hover:shadow-md transition-shadow":""} ${m===l.filter?"ring-2 ring-brand-500":""}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("div",{className:`stat-icon bg-${l.color}-50`,children:e.jsx(l.icon,{className:`w-5 h-5 text-${l.color}-600`})})}),e.jsx("p",{className:"stat-value",children:l.value}),e.jsx("p",{className:"stat-label",children:l.label})]},Z))}),e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Tovar nomi yoki kodi bo'yicha qidirish...",value:C,onChange:l=>d(l.target.value),className:"w-full pl-10 pr-4 py-2 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-100"})]}),e.jsx("div",{className:"card p-0 overflow-hidden",children:f?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):P.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx($e,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Tovarlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md mb-6",children:C?"Qidiruv bo'yicha tovarlar topilmadi":"Birinchi tovarni qo'shing"}),e.jsx("button",{onClick:es,className:"btn-primary",children:"Tovar qo'shish"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden lg:block",children:[e.jsx("div",{className:"table-header",children:e.jsxs("div",{className:"grid grid-cols-16 gap-2 px-4 py-4",children:[e.jsx("span",{className:"table-header-cell col-span-1",children:"Rasm"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Kod"}),e.jsx("span",{className:"table-header-cell col-span-2",children:"Nomi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Tan narxi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Dona narxi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Karobka"}),e.jsx("span",{className:"table-header-cell col-span-3",children:"Chegirmalar"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Oldingi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Hozirgi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Miqdori"}),e.jsx("span",{className:"table-header-cell col-span-2 text-center",children:"Amallar"})]})}),e.jsx("div",{className:"divide-y divide-surface-100",children:P.map(l=>{var Z,xe,Le,x,W,ee,n,M,H,de,ke,a;return e.jsxs("div",{className:"grid grid-cols-16 gap-2 px-4 py-3 items-center hover:bg-surface-50 transition-colors",children:[e.jsx("div",{className:"col-span-1",children:He(l)?e.jsx("img",{src:He(l),alt:l.name,className:"w-10 h-10 rounded-lg object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-lg flex items-center justify-center",children:e.jsx(Qa,{className:"w-5 h-5 text-surface-400"})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"font-mono text-xs bg-surface-100 px-1.5 py-0.5 rounded",children:l.code})}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"font-medium text-surface-900 text-sm truncate",children:l.name})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-surface-700 text-sm",children:u(l.costPrice||0)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-brand-600 text-sm",children:u(l.unitPrice||l.price)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-orange-600 text-sm",children:l.boxPrice>0?u(l.boxPrice):"-"})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[((xe=(Z=l.pricingTiers)==null?void 0:Z.tier1)==null?void 0:xe.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-emerald-50 text-emerald-700 rounded text-[10px] font-bold",children:[l.pricingTiers.tier1.minQuantity,"-",l.pricingTiers.tier1.maxQuantity,": ",l.pricingTiers.tier1.discountPercent,"%"]}),((x=(Le=l.pricingTiers)==null?void 0:Le.tier2)==null?void 0:x.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded text-[10px] font-bold",children:[l.pricingTiers.tier2.minQuantity,"-",l.pricingTiers.tier2.maxQuantity,": ",l.pricingTiers.tier2.discountPercent,"%"]}),((ee=(W=l.pricingTiers)==null?void 0:W.tier3)==null?void 0:ee.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-purple-50 text-purple-700 rounded text-[10px] font-bold",children:[l.pricingTiers.tier3.minQuantity,"+: ",l.pricingTiers.tier3.discountPercent,"%"]}),!((M=(n=l.pricingTiers)==null?void 0:n.tier1)!=null&&M.discountPercent)&&!((de=(H=l.pricingTiers)==null?void 0:H.tier2)!=null&&de.discountPercent)&&!((a=(ke=l.pricingTiers)==null?void 0:ke.tier3)!=null&&a.discountPercent)&&e.jsx("span",{className:"text-surface-400 text-xs",children:"-"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:`font-semibold text-sm ${(()=>{const z=l.previousPrice||0,F=l.currentPrice||l.price;return z>0&&F>0&&z!==F?"line-through text-red-500":"text-surface-900"})()}`,children:u(l.previousPrice||0)})}),e.jsxs("div",{className:"col-span-1 relative",children:[(()=>{const z=l.previousPrice||0,F=l.currentPrice||l.price;if(z>0&&F>0&&z!==F){const X=Math.round((z-F)/z*100);if(X>0)return e.jsxs("div",{className:"absolute -top-2 -right-1 px-1 py-0.5 bg-red-500 text-white rounded text-[9px] font-bold",children:["-",X,"%"]});if(X<0)return e.jsxs("div",{className:"absolute -top-2 -right-1 px-1 py-0.5 bg-green-500 text-white rounded text-[9px] font-bold",children:["+",Math.abs(X),"%"]})}return null})(),e.jsx("p",{className:"font-semibold text-surface-900 text-sm",children:u(l.currentPrice||l.price)})]}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`font-semibold text-sm ${l.quantity===0?"text-danger-600":l.quantity<=(l.minStock||100)?"text-warning-600":"text-success-600"}`,children:l.quantity})}),e.jsxs("div",{className:"col-span-2 flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>Qe(l),className:"btn-icon-sm hover:bg-surface-200",title:"QR kod",children:e.jsx(Ms,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ss(l),className:"btn-icon-sm hover:bg-blue-100 hover:text-blue-600",title:"Print",children:e.jsx(ks,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ce(l),className:"btn-icon-sm hover:bg-brand-100 hover:text-brand-600",children:e.jsx(ps,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ze(l._id),className:"btn-icon-sm hover:bg-danger-100 hover:text-danger-600",children:e.jsx(is,{className:"w-4 h-4"})})]})]},l._id)})})]}),e.jsx("div",{className:"lg:hidden grid grid-cols-1 sm:grid-cols-2 gap-4 p-4",children:P.map(l=>{var W,ee,n,M;const Z=l.unit||"dona",xe=(W=l.unitConversion)==null?void 0:W.enabled,Le=H=>{switch(H){case"metr":return"m";case"rulon":return"rulon";case"karobka":return"quti";case"gram":return"g";case"kg":return"kg";case"litr":return"L";default:return"dona"}},x=l.quantity===0?"danger":l.quantity<=(l.minStock||50)?"warning":"success";return e.jsxs("div",{className:"bg-white rounded-2xl border border-surface-200 hover:border-brand-300 hover:shadow-lg transition-all duration-300 overflow-hidden group",children:[e.jsxs("div",{className:"relative aspect-[4/3] bg-gradient-to-br from-surface-100 to-surface-50 overflow-hidden",children:[He(l)?e.jsx("img",{src:He(l),alt:l.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"w-16 h-16 bg-brand-100 rounded-2xl flex items-center justify-center",children:e.jsx($e,{className:"w-8 h-8 text-brand-500"})})}),e.jsx("div",{className:`absolute top-3 left-3 px-2.5 py-1 rounded-full text-xs font-semibold ${x==="danger"?"bg-red-500 text-white":x==="warning"?"bg-amber-500 text-white":"bg-emerald-500 text-white"}`,children:x==="danger"?"Tugagan":x==="warning"?"Kam qoldi":"Mavjud"}),e.jsxs("div",{className:"absolute top-3 right-3 px-2.5 py-1 bg-black/60 backdrop-blur-sm rounded-full text-xs font-mono text-white",children:["#",l.code]}),e.jsxs("div",{className:"absolute bottom-3 right-3 flex gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>Qe(l),className:"w-8 h-8 bg-white/90 backdrop-blur-sm rounded-lg flex items-center justify-center text-surface-600 hover:text-brand-600 hover:bg-white transition-colors shadow-sm",children:e.jsx(Ms,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ss(l),className:"w-8 h-8 bg-white/90 backdrop-blur-sm rounded-lg flex items-center justify-center text-surface-600 hover:text-blue-600 hover:bg-white transition-colors shadow-sm",children:e.jsx(ks,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ce(l),className:"w-8 h-8 bg-white/90 backdrop-blur-sm rounded-lg flex items-center justify-center text-surface-600 hover:text-amber-600 hover:bg-white transition-colors shadow-sm",children:e.jsx(ps,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ze(l._id),className:"w-8 h-8 bg-white/90 backdrop-blur-sm rounded-lg flex items-center justify-center text-surface-600 hover:text-red-600 hover:bg-white transition-colors shadow-sm",children:e.jsx(is,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-surface-900 text-base mb-3 line-clamp-2 min-h-[2.5rem]",children:l.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm font-medium ${x==="danger"?"bg-red-50 text-red-700":x==="warning"?"bg-amber-50 text-amber-700":"bg-emerald-50 text-emerald-700"}`,children:[Z==="metr"||Z==="rulon"?e.jsx(Is,{className:"w-3.5 h-3.5"}):Z==="karobka"?e.jsx(bt,{className:"w-3.5 h-3.5"}):Z==="gram"||Z==="kg"?e.jsx(ea,{className:"w-3.5 h-3.5"}):e.jsx($e,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:[u(l.quantity)," ",Le(Z)]})]}),xe&&l.unitConversion&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-purple-50 rounded-lg text-xs text-purple-700",children:[e.jsx(hs,{className:"w-3 h-3"}),e.jsxs("span",{children:["= ",u(l.unitConversion.totalBaseUnits)," ",Le(l.unitConversion.baseUnit)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-surface-50 rounded-xl p-2.5",children:[e.jsx("p",{className:"text-[10px] text-surface-500 uppercase tracking-wide mb-0.5",children:"Tan narxi"}),e.jsxs("p",{className:"font-bold text-sm text-surface-900",children:[u(l.costPrice||0),e.jsx("span",{className:"text-[10px] text-surface-400 ml-0.5",children:"so'm"})]})]}),e.jsxs("div",{className:"bg-brand-50 rounded-xl p-2.5",children:[e.jsx("p",{className:"text-[10px] text-brand-600 uppercase tracking-wide mb-0.5",children:"Dona narxi"}),e.jsxs("p",{className:"font-bold text-brand-700 text-sm",children:[u(l.unitPrice||l.price),e.jsx("span",{className:"text-[10px] text-brand-400 ml-0.5",children:"so'm"})]})]})]}),l.boxPrice>0&&e.jsxs("div",{className:"bg-orange-50 rounded-xl p-2.5 mb-3",children:[e.jsx("p",{className:"text-[10px] text-orange-600 uppercase tracking-wide mb-0.5",children:"ðŸ“¦ Karobka narxi"}),e.jsxs("p",{className:"font-bold text-orange-700 text-sm",children:[u(l.boxPrice),e.jsx("span",{className:"text-[10px] text-orange-400 ml-0.5",children:"so'm"})]})]}),l.pricingTiers&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-3",children:[((ee=l.pricingTiers.tier1)==null?void 0:ee.discountPercent)>0&&e.jsxs("span",{className:"px-2 py-1 bg-emerald-50 text-emerald-700 rounded-lg text-[10px] font-bold border border-emerald-200",children:[l.pricingTiers.tier1.minQuantity,"-",l.pricingTiers.tier1.maxQuantity," dona: ",l.pricingTiers.tier1.discountPercent,"%"]}),((n=l.pricingTiers.tier2)==null?void 0:n.discountPercent)>0&&e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded-lg text-[10px] font-bold border border-blue-200",children:[l.pricingTiers.tier2.minQuantity,"-",l.pricingTiers.tier2.maxQuantity," dona: ",l.pricingTiers.tier2.discountPercent,"%"]}),((M=l.pricingTiers.tier3)==null?void 0:M.discountPercent)>0&&e.jsxs("span",{className:"px-2 py-1 bg-purple-50 text-purple-700 rounded-lg text-[10px] font-bold border border-purple-200",children:[l.pricingTiers.tier3.minQuantity,"+ dona: ",l.pricingTiers.tier3.discountPercent,"%"]})]}),l.prices&&e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[l.prices.perMeter>0&&e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded-md text-xs font-medium",children:[u(l.prices.perMeter),"/m"]}),l.prices.perRoll>0&&e.jsxs("span",{className:"px-2 py-1 bg-purple-50 text-purple-700 rounded-md text-xs font-medium",children:[u(l.prices.perRoll),"/rulon"]}),l.prices.perBox>0&&e.jsxs("span",{className:"px-2 py-1 bg-orange-50 text-orange-700 rounded-md text-xs font-medium",children:[u(l.prices.perBox),"/quti"]}),l.prices.perKg>0&&e.jsxs("span",{className:"px-2 py-1 bg-green-50 text-green-700 rounded-md text-xs font-medium",children:[u(l.prices.perKg),"/kg"]})]})]})]},l._id)})})]})})]}),$&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:Xe}),e.jsxs("div",{className:"modal w-full max-w-lg p-6 relative z-10 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:je?"Tovarni tahrirlash":"Yangi tovar"}),e.jsx("button",{onClick:Xe,className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:qe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Rasmlar (max 8)"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-2",children:[le.map((l,Z)=>e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:`${Ut}${l}`,alt:"",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>oe(l),className:"absolute -top-1 -right-1 w-5 h-5 bg-danger-500 text-white rounded-full flex items-center justify-center",children:e.jsx(be,{className:"w-3 h-3"})})]},Z)),le.length<8&&e.jsx("button",{type:"button",onClick:()=>{var l;return(l=De.current)==null?void 0:l.click()},disabled:we,className:"aspect-square border-2 border-dashed border-surface-300 rounded-lg flex flex-col items-center justify-center hover:border-brand-500 hover:bg-brand-50 transition-colors",children:we?e.jsx("div",{className:"spinner w-5 h-5 text-brand-600"}):e.jsxs(e.Fragment,{children:[e.jsx(sa,{className:"w-5 h-5 text-surface-400 mb-1"}),e.jsx("span",{className:"text-xs text-surface-500",children:"Yuklash"})]})})]}),e.jsx("input",{ref:De,type:"file",accept:"image/*",multiple:!0,onChange:Ne,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input ${ne?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"1",value:p.code,onChange:l=>B(v(g({},p),{code:l.target.value})),onBlur:l=>w(l.target.value),required:!0}),ne&&e.jsx("p",{className:"text-sm text-danger-600 mt-1",children:ne})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Miqdori"}),je?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 px-4 py-3 bg-surface-100 rounded-xl text-center font-semibold text-surface-900",children:u(p.quantity||0)}),e.jsx("button",{type:"button",onClick:()=>Ee("add"),className:"btn-icon bg-success-100 text-success-600 hover:bg-success-200",children:e.jsx(Ze,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:()=>Ee("subtract"),className:"btn-icon bg-danger-100 text-danger-600 hover:bg-danger-200",children:e.jsx(Rs,{className:"w-5 h-5"})})]}):e.jsx("input",{type:"text",className:"input",placeholder:"0",value:Ue(p.quantity),onChange:l=>B(v(g({},p),{quantity:Re(l.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input",placeholder:"Tovar nomi",value:p.name,onChange:l=>B(v(g({},p),{name:l.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Oldingi narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:Ue(p.previousPrice),onChange:l=>B(v(g({},p),{previousPrice:Re(l.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Hozirgi narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:Ue(p.currentPrice),onChange:l=>B(v(g({},p),{currentPrice:Re(l.target.value)})),required:!0}),p.previousPrice&&p.currentPrice&&Number(p.previousPrice)>0&&Number(p.currentPrice)>0&&e.jsx("div",{className:"mt-2",children:(()=>{const l=Number(p.previousPrice),Z=Number(p.currentPrice),xe=Math.round((l-Z)/l*100);return xe>0?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsxs("span",{className:"text-sm font-medium text-green-700",children:[xe,"% chegirma"]})]}):xe<0?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsxs("span",{className:"text-sm font-medium text-red-700",children:[Math.abs(xe),"% qimmatroq"]})]}):null})()})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-3 flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-brand-600"}),"O'lchov birligi"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Birlik"}),e.jsxs("select",{className:"input",value:p.unit,onChange:l=>B(v(g({},p),{unit:l.target.value})),children:[e.jsx("option",{value:"dona",children:"Dona"}),e.jsx("option",{value:"metr",children:"Metr"}),e.jsx("option",{value:"rulon",children:"Rulon"}),e.jsx("option",{value:"karobka",children:"Karobka/Quti"}),e.jsx("option",{value:"gram",children:"Gram"}),e.jsx("option",{value:"kg",children:"Kilogram"}),e.jsx("option",{value:"litr",children:"Litr"})]})]}),(p.unit==="rulon"||p.unit==="karobka")&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:["1 ",p.unit==="rulon"?"rulon":"karobka"," = ?"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"input flex-1",placeholder:"30",value:p.conversionRate,onChange:l=>B(v(g({},p),{conversionRate:Re(l.target.value),conversionEnabled:!0}))}),e.jsxs("select",{className:"input w-24",value:p.baseUnit,onChange:l=>B(v(g({},p),{baseUnit:l.target.value})),children:[e.jsx("option",{value:"metr",children:"metr"}),e.jsx("option",{value:"dona",children:"dona"})]})]})]})]}),p.conversionEnabled&&p.conversionRate&&p.quantity&&e.jsx("div",{className:"mt-3 p-3 bg-purple-50 rounded-xl",children:e.jsxs("p",{className:"text-sm text-purple-700",children:[e.jsx("span",{className:"font-semibold",children:u(p.quantity)})," ",p.unit==="rulon"?"rulon":"karobka"," =",e.jsx("span",{className:"font-semibold ml-1",children:u(Number(p.quantity)*Number(p.conversionRate))})," ",p.baseUnit]})})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-3 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4 text-green-600"}),"Qo'shimcha narxlar (ixtiyoriy)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Metr narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:Ue(p.pricePerMeter),onChange:l=>B(v(g({},p),{pricePerMeter:Re(l.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Rulon narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:Ue(p.pricePerRoll),onChange:l=>B(v(g({},p),{pricePerRoll:Re(l.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Karobka narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:Ue(p.pricePerBox),onChange:l=>B(v(g({},p),{pricePerBox:Re(l.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Kg narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:Ue(p.pricePerKg),onChange:l=>B(v(g({},p),{pricePerKg:Re(l.target.value)}))})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:Xe,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:!!ne,children:"Saqlash"})]})]})]})]}),O&&V&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>_(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"QR Kod"}),e.jsx("button",{onClick:()=>_(!1),className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border border-surface-200 mb-4",children:e.jsx(Us,{id:"qr-code-svg",value:JSON.stringify({id:V._id,code:V.code,name:V.name,price:V.price}),size:200,level:"H",includeMargin:!0})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-semibold text-surface-900",children:V.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",V.code]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Oldingi narxi: ",u(V.previousPrice||0)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Hozirgi narxi: ",u(V.currentPrice||V.price)," so'm"]})]}),e.jsxs("button",{onClick:J,className:"btn-primary w-full",children:[e.jsx(jt,{className:"w-4 h-4"}),"Yuklab olish"]})]})]})]}),Y&&V&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>ae(!1)}),e.jsxs("div",{className:"modal w-full max-w-4xl p-6 relative z-10 max-h-[92vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Print sozlamalari"}),e.jsx("button",{onClick:()=>ae(!1),className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Printer tanlash"}),e.jsxs("select",{className:"input",value:R.printer,onChange:l=>D(v(g({},R),{printer:l.target.value})),children:[e.jsx("option",{value:"",children:"Printer tanlang"}),ge.map(l=>e.jsx("option",{value:l,children:l},l))]}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Print tugmasini bosganda Windows print dialog ochiladi va barcha mavjud printerlarni ko'rsatadi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Qog'oz o'lchami"}),e.jsxs("select",{className:"input",value:R.size,onChange:l=>D(v(g({},R),{size:l.target.value})),children:[e.jsx("option",{value:"card",children:"Kichik yorliq (50Ã—25mm)"}),e.jsx("option",{value:"A4",children:"A4 (210Ã—297mm)"}),e.jsx("option",{value:"A5",children:"A5 (148Ã—210mm)"}),e.jsx("option",{value:"thermal",children:"Thermal (80Ã—120mm)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Shablon"}),e.jsxs("select",{className:"input",value:R.layout,onChange:l=>D(v(g({},R),{layout:l.target.value})),children:[e.jsx("option",{value:"standard",children:"Standart (barcha ma'lumotlar)"}),e.jsx("option",{value:"minimal",children:"Minimal (faqat asosiy ma'lumotlar)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Nusxalar soni"}),e.jsx("input",{type:"number",min:"1",max:"10",className:"input",value:R.copies,onChange:l=>D(v(g({},R),{copies:parseInt(l.target.value)||1}))})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4",children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Maxsus o'lcham (ixtiyoriy)"}),e.jsx("p",{className:"text-xs text-surface-500 mb-3",children:"Agar maxsus o'lcham belgilasangiz, u qog'oz o'lchamidan ustun bo'ladi"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-600 mb-1 block",children:"Eni (mm)"}),e.jsx("input",{type:"number",min:"1",className:"input",placeholder:"Masalan: 50",value:R.customWidth,onChange:l=>D(v(g({},R),{customWidth:l.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-600 mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"number",min:"1",className:"input",placeholder:"Masalan: 25",value:R.customHeight,onChange:l=>D(v(g({},R),{customHeight:l.target.value}))})]})]})]})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-surface-700 mb-3",children:"Ko'rinish"}),e.jsx("div",{className:"bg-white shadow-md rounded-xl p-6 flex justify-center items-start min-h-[420px]",children:e.jsx("div",{className:"bg-white border border-gray-200 shadow-lg rounded-xl",style:{width:R.customWidth&&R.customHeight?`${R.customWidth}mm`:R.size==="card"?"26mm":R.size==="thermal"?"48mm":R.size==="A4"?"80mm":R.size==="A5"?"140mm":"120mm",height:R.customWidth&&R.customHeight?`${R.customHeight}mm`:R.size==="card"?"17mm":R.size==="thermal"?"65mm":R.size==="A4"?"105mm":R.size==="A5"?"145mm":"140mm",fontSize:R.size==="card"?"5px":R.size==="thermal"?"9px":"11px",transform:R.size==="card"?"scale(4.2)":R.size==="thermal"?"scale(2.1)":"scale(1.8)",transformOrigin:"center center",overflow:"hidden",padding:R.size==="card"?"1.2mm":R.size==="thermal"?"7px":"12px",borderRadius:"8px",background:"#ffffff",marginTop:"80px"},children:e.jsxs("div",{className:"flex flex-col justify-between h-full",style:{gap:R.size==="card"?"2px":"4px"},children:[e.jsxs("div",{className:"flex flex-col justify-center items-center text-center",style:{flex:1},children:[e.jsxs("div",{className:"font-bold",style:{fontSize:R.size==="card"?"10px":R.size==="thermal"?"18px":"22px",lineHeight:"1.0",marginBottom:R.size==="card"?"0px":"1px",fontWeight:"800",color:"#d32f2f"},children:[u(V.currentPrice||V.price)," so'm"]}),e.jsxs("div",{className:"text-gray-600",style:{fontSize:R.size==="card"?"6px":R.size==="thermal"?"12px":"16px",lineHeight:"1.0",marginBottom:R.size==="card"?"0.5px":"1px",fontWeight:"500",color:"#666"},children:["Kod: ",V.code]}),e.jsx("div",{className:"font-bold text-black",style:{fontSize:R.size==="card"?"7px":R.size==="thermal"?"14px":"18px",lineHeight:"1.1",marginBottom:R.size==="card"?"0.5px":"1px",fontWeight:"600",color:"#1a1a1a",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:R.size==="card"?1:2,WebkitBoxOrient:"vertical"},children:V.name}),R.layout==="standard"&&e.jsxs("div",{className:"text-gray-500",style:{fontSize:R.size==="card"?"4px":R.size==="thermal"?"10px":"12px",lineHeight:"1.0",margin:0,color:"#888",fontWeight:"400"},children:["Miqdor: ",V.quantity," | ",new Date().toLocaleDateString("uz-UZ")]})]}),e.jsx("div",{className:"flex justify-center items-center",style:{width:"100%",height:"auto",padding:"2px 0"},children:e.jsx("div",{style:{border:"1px solid #e2e8f0",borderRadius:"4px",background:"#ffffff",padding:"2px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Us,{value:JSON.stringify({id:V._id,code:V.code,name:V.name,price:V.price}),size:R.size==="card"?60:R.size==="thermal"?120:140,level:"H",includeMargin:!1,style:{width:"100%",height:"100%",maxWidth:R.size==="card"?"60px":R.size==="thermal"?"120px":"140px",maxHeight:R.size==="card"?"60px":R.size==="thermal"?"120px":"140px",objectFit:"contain"}})})})]})})}),R.copies>1&&e.jsxs("p",{className:"text-xs text-surface-500 mt-2 text-center",children:[R.copies," nusxa chop etiladi"]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>ae(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsxs("button",{type:"button",onClick:ue,className:"btn-primary flex-1",disabled:!R.printer,children:[e.jsx(ks,{className:"w-4 h-4"}),"Print"]})]})]})]}),G&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>Oe(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:Be==="add"?"Miqdor qo'shish":"Miqdor ayirish"}),e.jsx("button",{onClick:()=>Oe(!1),className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${Be==="add"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Hozirgi miqdor"}),e.jsxs("p",{className:`text-2xl font-bold ${Be==="add"?"text-success-600":"text-danger-600"}`,children:[u(p.quantity||0)," dona"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:Be==="add"?"Qo'shiladigan miqdor":"Ayiriladigan miqdor"}),e.jsx("input",{type:"text",className:"input text-center text-lg font-semibold",placeholder:"0",value:Ue(ye),onChange:l=>_e(Re(l.target.value)),autoFocus:!0})]}),ye&&Number(ye)>0&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Yangi miqdor"}),e.jsxs("p",{className:"text-xl font-bold text-surface-900",children:[u(Be==="add"?(Number(p.quantity)||0)+Number(ye):Math.max(0,(Number(p.quantity)||0)-Number(ye)))," dona"]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>Oe(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"button",onClick:Ke,className:`flex-1 ${Be==="add"?"btn-success":"btn-danger"}`,disabled:!ye||Number(ye)<=0,children:Be==="add"?"Qo'shish":"Ayirish"})]})]})]})]})]})}function Ir(){const{showAlert:s,AlertComponent:o}=rs(),[r,h]=t.useState({botToken:"",chatId:"",isEnabled:!1}),[i,S]=t.useState(null),[j,k]=t.useState(null),[P,q]=t.useState(""),[C,d]=t.useState(""),[m,b]=t.useState(!1),[f,y]=t.useState(!1),[T,E]=t.useState(!1);t.useEffect(()=>{$();const L=window.location.origin.replace("5175","3002");d(`${L}/api/telegram/webhook`)},[]);const $=()=>Q(this,null,function*(){try{const L=yield K.get("/telegram/settings");h(L.data),L.data.botToken&&(N(),O())}catch(L){console.error("Error fetching telegram settings:",L)}}),N=()=>Q(this,null,function*(){try{const L=yield K.get("/telegram/bot-info");S(L.data)}catch(L){console.error("Error fetching bot info:",L)}}),O=()=>Q(this,null,function*(){try{const L=yield K.get("/telegram/webhook-info");k(L.data)}catch(L){console.error("Error fetching webhook info:",L)}}),_=()=>Q(this,null,function*(){if(!C.trim()){s("Webhook URL ni kiriting","Xatolik","warning");return}E(!0);try{yield K.post("/telegram/set-webhook",{webhookUrl:C}),s("Webhook muvaffaqiyatli o'rnatildi","Muvaffaqiyat","success"),O()}catch(L){s("Webhook o'rnatishda xatolik","Xatolik","danger")}finally{E(!1)}}),Y=()=>Q(this,null,function*(){b(!0);try{yield K.post("/telegram/settings",r),s("Sozlamalar saqlandi","Muvaffaqiyat","success"),r.botToken&&N()}catch(L){s("Sozlamalarni saqlashda xatolik","Xatolik","danger")}finally{b(!1)}}),ae=()=>Q(this,null,function*(){if(!P.trim()){s("Test xabarini kiriting","Xatolik","warning");return}y(!0);try{yield K.post("/telegram/test",{message:P}),s("Test xabari yuborildi","Muvaffaqiyat","success"),q("")}catch(L){s("Xabar yuborishda xatolik","Xatolik","danger")}finally{y(!1)}}),V=()=>{i!=null&&i.username&&(navigator.clipboard.writeText(`@${i.username}`),s("Bot username nusxalandi","Muvaffaqiyat","success"))};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[o,e.jsx(us,{title:"Telegram Sozlamalari"}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-4xl mx-auto",children:[i&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(Ra,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Bot Ma'lumotlari"}),e.jsx("p",{className:"text-surface-500",children:"Telegram bot holati"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-surface-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Bot nomi"}),e.jsx("p",{className:"font-medium text-surface-900",children:i.first_name})]}),e.jsx("div",{className:"bg-surface-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Username"}),e.jsxs("p",{className:"font-medium text-surface-900",children:["@",i.username]})]}),e.jsx("button",{onClick:V,className:"btn-icon-sm hover:bg-surface-200",title:"Nusxalash",children:e.jsx(Da,{className:"w-4 h-4"})})]})})]}),e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-green-700 font-medium",children:"Bot faol"})]})})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-6",children:"Telegram Sozlamalari"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Bot Token"}),e.jsx("input",{type:"password",className:"input",placeholder:"Bot tokenini kiriting",value:r.botToken,onChange:L=>h(v(g({},r),{botToken:L.target.value}))}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"@BotFather dan olingan bot token"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Chat ID yoki Kanal Username"}),e.jsx("input",{type:"text",className:"input",placeholder:"@channel_name yoki -100xxxxxxxxx",value:r.chatId,onChange:L=>h(v(g({},r),{chatId:L.target.value}))}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Xabarlar yuboriladigan kanal yoki guruh"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"telegram-enabled",className:"w-4 h-4 text-brand-600 border-surface-300 rounded focus:ring-brand-500",checked:r.isEnabled,onChange:L=>h(v(g({},r),{isEnabled:L.target.checked}))}),e.jsx("label",{htmlFor:"telegram-enabled",className:"text-sm font-medium text-surface-700",children:"Telegram xabarlarini yoqish"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:Y,disabled:m,className:"btn-primary",children:m?e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"w-4 h-4 animate-spin"}),"Saqlanmoqda..."]}):"Saqlash"})})]})]}),i&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(It,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Webhook Sozlamalari"}),e.jsx("p",{className:"text-surface-500",children:"Mijozlarga chek yuborish uchun"})]})]}),j&&e.jsxs("div",{className:"mb-4 p-3 bg-surface-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-surface-700",children:"Joriy webhook:"}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${j.url?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:j.url?"Faol":"O'rnatilmagan"})]}),j.url&&e.jsx("p",{className:"text-xs text-surface-500 break-all",children:j.url})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Webhook URL"}),e.jsx("input",{type:"text",className:"input",placeholder:"https://your-domain.com/api/telegram/webhook",value:C,onChange:L=>d(L.target.value)}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Server webhook URL manzili"})]}),e.jsx("button",{onClick:_,disabled:T||!C.trim(),className:"btn-secondary",children:T?e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"w-4 h-4 animate-spin"}),"O'rnatilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(It,{className:"w-4 h-4"}),"Webhook O'rnatish"]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(Js,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Mijozlar uchun yo'riqnoma"}),e.jsx("p",{className:"text-surface-500",children:"Cheklar olish uchun"})]})]}),e.jsxs("div",{className:"space-y-4 text-sm text-surface-600",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Mijozlar qanday qilib chek oladi:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-4 text-blue-800",children:[e.jsxs("li",{children:["Telegram da ",e.jsxs("strong",{children:["@",(i==null?void 0:i.username)||"your_bot"]})," botini topish"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"/start"})," buyrug'ini yuborish"]}),e.jsx("li",{children:"Telefon raqamini yuborish (masalan: +998901234567)"}),e.jsx("li",{children:"Ro'yxatdan o'tgandan keyin barcha cheklar avtomatik keladi"})]})]}),e.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[e.jsx("h4",{className:"font-medium text-amber-900 mb-2",children:"Muhim:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4 text-amber-800",children:[e.jsx("li",{children:"Mijoz avval botga /start berishi kerak"}),e.jsx("li",{children:"Telefon raqam bazada mavjud bo'lishi kerak"}),e.jsx("li",{children:"Webhook to'g'ri sozlangan bo'lishi kerak"})]})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-6",children:"Test Xabar"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Test xabari"}),e.jsx("textarea",{className:"input",rows:3,placeholder:"Test xabarini kiriting...",value:P,onChange:L=>q(L.target.value)})]}),e.jsx("button",{onClick:ae,disabled:f||!r.botToken||!r.chatId,className:"btn-secondary",children:f?e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"w-4 h-4 animate-spin"}),"Yuborilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(aa,{className:"w-4 h-4"}),"Test Xabar Yuborish"]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-4",children:"Sozlash Yo'riqnomasi"}),e.jsxs("div",{className:"space-y-4 text-sm text-surface-600",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"1. Bot yaratish:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Telegram da @BotFather ga murojaat qiling"}),e.jsx("li",{children:"/newbot buyrug'ini yuboring"}),e.jsx("li",{children:"Bot nomini va username ni kiriting"}),e.jsx("li",{children:"Olingan tokenni yuqoridagi maydonga kiriting"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"2. Kanal/Guruh sozlash:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Telegram da kanal yoki guruh yarating"}),e.jsx("li",{children:"Botni kanalga admin qilib qo'shing"}),e.jsx("li",{children:"Kanal username ini (@channel_name) yoki Chat ID ni kiriting"}),e.jsx("li",{children:"Barcha xodimlar kanalga obuna bo'lsin"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"3. Mijozlarga chek yuborish:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Webhook URL ni to'g'ri o'rnating"}),e.jsx("li",{children:"Mijozlar botga /start berib ro'yxatdan o'tsin"}),e.jsx("li",{children:"Kassa panelida mijoz tanlanganda chek avtomatik yuboriladi"}),e.jsx("li",{children:"Faqat ro'yxatdan o'tgan mijozlarga chek boradi"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"4. Xabar turlari:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Xarid cheklari (mijozlarga shaxsiy)"}),e.jsx("li",{children:"Yangi qarz qo'shilganda (admin kanaliga)"}),e.jsx("li",{children:"Qarz tasdiqlanganda (admin kanaliga)"}),e.jsx("li",{children:"To'lov qilinganida (admin kanaliga)"}),e.jsx("li",{children:"Kam qolgan mahsulotlar haqida (admin kanaliga)"})]})]})]})]})]})]})}function Or(){const[s,o]=t.useState(""),[r,h]=t.useState(""),[i,S]=t.useState(!1),[j,k]=t.useState(""),[P,q]=t.useState(!1),C=gs(),d=m=>Q(this,null,function*(){m.preventDefault(),k(""),q(!0);try{try{const b=yield K.post("/kassa-auth/login",{username:s.trim(),password:r});if(b.data.success){const f={loggedIn:!0,timestamp:Date.now(),user:"kassa",username:b.data.data.username,sessionToken:b.data.data.sessionToken,expiresAt:b.data.data.expiresAt,locked:!0};localStorage.setItem("kassaLoggedIn",JSON.stringify(f)),window.history.replaceState(null,"","/kassa"),C("/kassa",{replace:!0});return}else{k(b.data.message||"Login xatosi");return}}catch(b){const y=[{username:"alisher",password:"2011"},{username:"kassa1",password:"kassa123"},{username:"admin",password:"admin123"}].find(T=>T.username===s.trim()&&T.password===r);if(y){const T={loggedIn:!0,timestamp:Date.now(),user:"kassa",username:y.username,offline:!0,locked:!0};localStorage.setItem("kassaLoggedIn",JSON.stringify(T)),window.history.replaceState(null,"","/kassa"),C("/kassa",{replace:!0});return}else{k("Noto'g'ri login yoki parol");return}}}catch(b){console.error("Login error:",b),k("Xatolik yuz berdi")}finally{q(!1)}});return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(109, 40, 217, 0.15) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute top-1/4 right-1/4 w-64 h-64 rounded-full blur-2xl",style:{background:"radial-gradient(circle, rgba(6, 182, 212, 0.1) 0%, transparent 70%)"}})]}),e.jsxs("div",{className:"w-full max-w-sm relative z-10",children:[e.jsxs("div",{className:"text-center mb-6 animate-fade-up",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-4",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 8px 32px -8px rgba(6, 182, 212, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:e.jsx(nt,{className:"w-10 h-10 text-white"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-7 h-7 rounded-full flex items-center justify-center",style:{background:"linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",boxShadow:"0 2px 8px -2px rgba(34, 197, 94, 0.5)"},children:e.jsx(xt,{className:"w-3.5 h-3.5 text-white"})})]}),e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{background:"linear-gradient(135deg, #2e1065 0%, #5b21b6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Kassa Tizimi"}),e.jsx("p",{className:"font-medium",style:{color:"#71717a"},children:"Sardor Furnitura - Kassa Paneli"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full animate-pulse",style:{background:"#22c55e"}}),e.jsx("span",{className:"text-sm",style:{color:"#a1a1aa"},children:"Xavfsiz tizim"})]})]}),e.jsxs("div",{className:"rounded-2xl p-6 animate-fade-up",style:{background:"linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 20px 40px -12px rgba(109, 40, 217, 0.2)",backdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-1",style:{color:"#2e1065"},children:"Kassa tizimiga kirish"}),e.jsx("p",{style:{color:"#71717a"},children:"Hisobingiz bilan tizimga kiring"})]}),j&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)",border:"1px solid #fca5a5"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#ef4444"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#991b1b"},children:"Xatolik"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#b91c1c"},children:j})]})]})}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ds,{className:"w-3.5 h-3.5"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ds,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:"text",placeholder:"alisher",value:s,onChange:m=>o(m.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(cs,{className:"w-3.5 h-3.5"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(cs,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:i?"text":"password",placeholder:"2011",value:r,onChange:m=>h(m.target.value),className:"w-full pl-10 pr-10 py-3 rounded-xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0}),e.jsx("button",{type:"button",onClick:()=>S(!i),className:"absolute inset-y-0 right-0 pr-3 flex items-center transition-colors",style:{color:"#a1a1aa"},children:i?e.jsx(Ks,{className:"w-4 h-4"}):e.jsx(bs,{className:"w-4 h-4"})})]})]}),e.jsx("button",{type:"submit",disabled:P,className:"w-full text-white font-semibold py-3.5 px-4 rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 14px -2px rgba(6, 182, 212, 0.4)"},children:P?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Kirish..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Kirish"}),e.jsx(mt,{className:"w-4 h-4 transition-transform group-hover:translate-x-1"})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"pt-4",style:{borderTop:"1px solid #ede9fe"},children:e.jsxs("div",{className:"rounded-xl p-4 mb-4",style:{background:"linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%)"},children:[e.jsx("p",{className:"font-medium text-sm mb-3",style:{color:"#5b21b6"},children:"Admin uchun:"}),e.jsx("a",{href:"/login",className:"inline-flex items-center justify-center gap-2 font-semibold transition-colors text-base underline decoration-2 underline-offset-4",style:{color:"#7c3aed"},children:e.jsx("span",{children:"Admin panel â†’"})})]})})})})]}),e.jsxs("div",{className:"text-center mt-6 animate-fade-up",children:[e.jsx("p",{className:"text-sm",style:{color:"#71717a"},children:"Â© 2025 Sardor Furnitura. Barcha huquqlar himoyalangan."}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-2 text-xs",style:{color:"#a1a1aa"},children:[e.jsx("span",{children:"Xavfsiz"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Professional"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Ishonchli"})]})]})]})]})}const _r="/api",Kr="",Fr=(s,o)=>{const r={dona:{single:"dona",plural:"dona"},metr:{single:"metr",plural:"metr"},rulon:{single:"rulon",plural:"rulon"},karobka:{single:"quti",plural:"quti"},gram:{single:"gram",plural:"gram"},kg:{single:"kg",plural:"kg"},litr:{single:"litr",plural:"litr"}};return(r[s||"dona"]||r.dona).single};function Ur(){var d,m,b;const{id:s}=La(),o=gs(),[r,h]=t.useState(null),[i,S]=t.useState(!0),[j,k]=t.useState("");t.useEffect(()=>{s&&P()},[s]);const P=()=>Q(this,null,function*(){var f,y;try{const T=yield ra.get(`${_r}/products/public/${s}`);h(T.data)}catch(T){console.error("Error fetching product:",T),k(((y=(f=T.response)==null?void 0:f.data)==null?void 0:y.message)||"Mahsulot topilmadi")}finally{S(!1)}});if(i)return e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-brand-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-surface-600",children:"Yuklanmoqda..."})]})});if(j||!r)return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-surface-100 to-surface-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-red-100 to-red-200 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx($e,{className:"w-12 h-12 text-red-500"})}),e.jsx("h1",{className:"text-2xl font-bold text-surface-900 mb-3",children:"Mahsulot topilmadi"}),e.jsx("p",{className:"text-surface-500 mb-8",children:j||"Bu mahsulot mavjud emas yoki o'chirilgan"}),e.jsx("button",{onClick:()=>o("/"),className:"px-8 py-3.5 bg-gradient-to-r from-brand-500 to-brand-600 text-white rounded-2xl font-semibold hover:from-brand-600 hover:to-brand-700 transition-all shadow-lg shadow-brand-500/30",children:"Bosh sahifaga qaytish"})]})});const q=r.tierPrices&&(r.tierPrices.tier1||r.tierPrices.tier2||r.tierPrices.tier3),C=Fr(r.unit);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-surface-100 to-white",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-lg border-b border-surface-200/50 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-3 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>o(-1),className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center hover:bg-surface-200 transition-colors active:scale-95",children:e.jsx(ta,{className:"w-5 h-5 text-surface-700"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-base font-semibold text-surface-900 truncate",children:r.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",r.code]})]})]})}),e.jsxs("div",{className:"max-w-lg mx-auto pb-8",children:[e.jsxs("div",{className:"relative",children:[r.images&&r.images.length>0?e.jsx("div",{className:"aspect-square bg-white",children:e.jsx("img",{src:`${Kr}${r.images[0]}`,alt:r.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-square bg-gradient-to-br from-brand-50 via-brand-100 to-indigo-100 flex items-center justify-center",children:e.jsx("div",{className:"w-24 h-24 bg-white/60 backdrop-blur rounded-3xl flex items-center justify-center shadow-xl",children:e.jsx($e,{className:"w-12 h-12 text-brand-500"})})}),e.jsx("div",{className:`absolute top-4 right-4 px-4 py-2 rounded-full text-sm font-bold shadow-lg ${r.quantity>10?"bg-gradient-to-r from-emerald-400 to-green-500 text-white":r.quantity>0?"bg-gradient-to-r from-amber-400 to-orange-400 text-white":"bg-gradient-to-r from-red-500 to-rose-500 text-white"}`,children:r.quantity>0?`âœ“ ${r.quantity} ${C} mavjud`:"âœ• Tugagan"})]}),e.jsxs("div",{className:"px-4 -mt-6 relative z-10 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-xl shadow-surface-200/50",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-surface-900 mb-1",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"px-2.5 py-1 bg-surface-100 rounded-lg text-xs font-mono text-surface-600",children:["#",r.code]}),e.jsx("span",{className:"px-2.5 py-1 bg-brand-50 text-brand-600 rounded-lg text-xs font-medium",children:C}),r.dimensions&&(r.dimensions.width||r.dimensions.height||r.dimensions.length)&&e.jsxs("span",{className:"px-2.5 py-1 bg-purple-50 text-purple-600 rounded-lg text-xs font-medium",children:["ðŸ“ ",[r.dimensions.width,r.dimensions.height,r.dimensions.length].filter(Boolean).join(" Ã— ")]})]}),r.description&&e.jsx("p",{className:"mt-3 text-sm text-surface-600 leading-relaxed",children:r.description})]}),e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 rounded-2xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-brand-100 text-sm mb-1",children:"Narxi"}),e.jsx("p",{className:"text-3xl font-black text-white",children:u(r.price)})]}),e.jsxs("span",{className:"text-brand-100 text-lg font-medium",children:["so'm/",C]})]})}),q&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center",children:e.jsx(Ea,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"font-bold text-surface-900",children:"Chegirmali narxlar"})]}),e.jsxs("div",{className:"space-y-2",children:[((d=r.tierPrices)==null?void 0:d.tier1)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-emerald-50 to-green-50 rounded-xl border border-emerald-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center",children:e.jsx(Os,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[r.tierPrices.tier1.minQuantity,"â€“",r.tierPrices.tier1.maxQuantity," ",C]}),e.jsxs("p",{className:"text-xs text-emerald-600 font-medium",children:[r.tierPrices.tier1.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-emerald-600",children:u(r.tierPrices.tier1.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",C]})]})]}),((m=r.tierPrices)==null?void 0:m.tier2)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(Os,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[r.tierPrices.tier2.minQuantity,"â€“",r.tierPrices.tier2.maxQuantity," ",C]}),e.jsxs("p",{className:"text-xs text-blue-600 font-medium",children:[r.tierPrices.tier2.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-blue-600",children:u(r.tierPrices.tier2.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",C]})]})]}),((b=r.tierPrices)==null?void 0:b.tier3)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-violet-50 rounded-xl border border-purple-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(Os,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[r.tierPrices.tier3.minQuantity,"+ ",C]}),e.jsxs("p",{className:"text-xs text-purple-600 font-medium",children:[r.tierPrices.tier3.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-purple-600",children:u(r.tierPrices.tier3.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",C]})]})]})]}),e.jsx("p",{className:"mt-3 text-xs text-surface-400 text-center",children:"ðŸ’¡ Ko'proq olsangiz, arzonroq!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-surface-50 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-400 mb-1",children:[e.jsx(bt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"O'lchov"})]}),e.jsx("p",{className:"font-bold text-surface-900",children:C})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-400 mb-1",children:[e.jsx(Aa,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Kod"})]}),e.jsx("p",{className:"font-bold text-surface-900 font-mono",children:r.code})]})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-lg shadow-surface-200/30",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand-500 to-brand-600 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-500/30",children:e.jsx("span",{className:"text-2xl font-black text-white",children:"SF"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-surface-900 text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-sm text-surface-500",children:"Mebel furniturasi do'koni"})]}),e.jsx(Ba,{className:"w-5 h-5 text-surface-300"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-surface-100 space-y-3",children:[e.jsxs("a",{href:"tel:+998901234567",className:"flex items-center gap-3 text-surface-600 hover:text-brand-600 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(ds,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"+998 90 123 45 67"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-surface-600",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(Xs,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"Toshkent shahri"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-surface-600",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(Ss,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"09:00 - 18:00"})]})]})]}),e.jsxs("p",{className:"text-center text-xs text-surface-400 pt-4",children:["QR kod orqali ko'rilmoqda â€¢ ",new Date().toLocaleDateString("uz-UZ")]})]})]})]})}const Xt=["â„","â…","â†","âœ»","âœ¼","â‰","âœ¿","â‹"];function Xr(){const[s,o]=t.useState([]);return t.useEffect(()=>{const r=[];for(let h=0;h<40;h++){const i=["small","medium","large"],S=["slow","normal","fast"];r.push({id:h,left:Math.random()*100,size:i[Math.floor(Math.random()*i.length)],speed:S[Math.floor(Math.random()*S.length)],delay:Math.random()*10,symbol:Xt[Math.floor(Math.random()*Xt.length)]})}o(r)},[]),e.jsx("div",{className:"snowfall-container",children:s.map(r=>e.jsx("span",{className:`snowflake ${r.size} ${r.speed}`,style:{left:`${r.left}%`,animationDelay:`${r.delay}s`},children:r.symbol},r.id))})}const tt=({children:s,roles:o})=>{const{user:r,loading:h}=Ns();return h?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Yuklanmoqda..."})]})}):r?o&&!o.includes(r.role)?e.jsx(zs,{to:"/"}):e.jsx(e.Fragment,{children:s}):e.jsx(zs,{to:"/login"})},Yr=({children:s})=>{const o=gs(),{user:r}=Ns(),[h,i]=it.useState(null);return it.useEffect(()=>{document.body.classList.add("kassa-locked","kassa-protected"),(()=>{try{const d=localStorage.getItem("kassaLoggedIn");if(d){const m=JSON.parse(d);if(m.loggedIn&&m.user==="kassa"){const b=v(g({},m),{timestamp:Date.now()});localStorage.setItem("kassaLoggedIn",JSON.stringify(b)),i(!0),window.history.pushState(null,"",window.location.href);return}}if(r&&r.role==="cashier"){const m={loggedIn:!0,user:"kassa",username:r.name,timestamp:Date.now(),locked:!0};localStorage.setItem("kassaLoggedIn",JSON.stringify(m)),i(!0),window.history.pushState(null,"",window.location.href);return}i(!1),o("/kassa-login",{replace:!0})}catch(d){console.error("Kassa login check error:",d),i(!1),o("/kassa-login",{replace:!0})}})();const j=()=>{window.location.pathname.startsWith("/kassa")&&window.history.pushState(null,"",window.location.href)},k=d=>{if(window.location.pathname.startsWith("/kassa")&&!(d.key==="F5"||d.ctrlKey&&(d.key==="r"||d.key==="R"))&&d.key!=="F12"&&(d.altKey&&d.key==="F4"||d.ctrlKey&&d.key==="w"||d.ctrlKey&&d.key==="W"||d.ctrlKey&&d.key==="t"||d.ctrlKey&&d.key==="T"||d.ctrlKey&&d.shiftKey&&d.key==="I"||d.ctrlKey&&d.shiftKey&&d.key==="J"||d.ctrlKey&&d.key==="u"||d.ctrlKey&&d.key==="U"||d.ctrlKey&&d.key==="s"||d.ctrlKey&&d.key==="S"||d.ctrlKey&&d.key==="p"||d.ctrlKey&&d.key==="P"))return d.preventDefault(),d.stopPropagation(),alert("âš ï¸ Bu amal kassa tizimida taqiqlanadi!"),!1},P=d=>{if(window.location.pathname.startsWith("/kassa"))return d.preventDefault(),alert("âš ï¸ O'ng tugma kassa tizimida taqiqlanadi!"),!1},q=()=>{window.location.pathname.startsWith("/kassa")},C=()=>{document.hidden&&setTimeout(()=>{window.focus()},100)};return window.addEventListener("popstate",j),window.addEventListener("keydown",k,!0),window.addEventListener("contextmenu",P),window.addEventListener("beforeunload",q),document.addEventListener("visibilitychange",C),window.focus(),()=>{document.body.classList.remove("kassa-locked","kassa-protected"),window.removeEventListener("popstate",j),window.removeEventListener("keydown",k,!0),window.removeEventListener("contextmenu",P),window.removeEventListener("beforeunload",q),document.removeEventListener("visibilitychange",C)}},[o,r]),h===null?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Tekshirilmoqda..."})]})}):h?e.jsx(e.Fragment,{children:s}):null},Wr=()=>{const{user:s,loading:o}=Ns();return o?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Yuklanmoqda..."})]})}):s?s.role==="admin"?e.jsx(zs,{to:"/admin"}):s.role==="cashier"?e.jsx(zs,{to:"/kassa"}):e.jsx(zs,{to:"/helper"}):e.jsx(zs,{to:"/login"})};function Hr(){return e.jsx(Va,{children:e.jsx(Ja,{children:e.jsxs(Ia,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:[e.jsx(Xr,{}),e.jsxs(Oa,{children:[e.jsx(Ie,{path:"/login",element:e.jsx(Za,{})}),e.jsx(Ie,{path:"/register",element:e.jsx(er,{})}),e.jsx(Ie,{path:"/kassa-login",element:e.jsx(Or,{})}),e.jsx(Ie,{path:"/product/:id",element:e.jsx(Ur,{})}),e.jsx(Ie,{path:"/",element:e.jsx(Wr,{})}),e.jsxs(Ie,{path:"/kassa",element:e.jsx(Yr,{children:e.jsx(zr,{})}),children:[e.jsx(Ie,{index:!0,element:e.jsx(Lr,{})}),e.jsx(Ie,{path:"clients",element:e.jsx(Er,{})}),e.jsx(Ie,{path:"debts",element:e.jsx(Ar,{})}),e.jsx(Ie,{path:"products",element:e.jsx(Br,{})})]}),e.jsxs(Ie,{path:"/admin",element:e.jsx(tt,{roles:["admin"],children:e.jsx(rr,{})}),children:[e.jsx(Ie,{index:!0,element:e.jsx(ir,{})}),e.jsx(Ie,{path:"kassa",element:e.jsx(Ot,{})}),e.jsx(Ie,{path:"products",element:e.jsx(Nr,{})}),e.jsx(Ie,{path:"warehouses",element:e.jsx(vr,{})}),e.jsx(Ie,{path:"customers",element:e.jsx(yr,{})}),e.jsx(Ie,{path:"debts",element:e.jsx(Kt,{})}),e.jsx(Ie,{path:"debt-approvals",element:e.jsx(wr,{})}),e.jsx(Ie,{path:"orders",element:e.jsx(kr,{})}),e.jsx(Ie,{path:"helpers",element:e.jsx(Sr,{})}),e.jsx(Ie,{path:"staff-receipts",element:e.jsx(Ft,{})}),e.jsx(Ie,{path:"telegram-settings",element:e.jsx(Ir,{})})]}),e.jsxs(Ie,{path:"/cashier",element:e.jsx(tt,{roles:["cashier"],children:e.jsx(Cr,{})}),children:[e.jsx(Ie,{index:!0,element:e.jsx(Ot,{})}),e.jsx(Ie,{path:"debts",element:e.jsx(Kt,{})}),e.jsx(Ie,{path:"staff-receipts",element:e.jsx(Ft,{})})]}),e.jsx(Ie,{path:"/helper",element:e.jsx(tt,{roles:["helper"],children:e.jsx(Pr,{})}),children:e.jsx(Ie,{index:!0,element:e.jsx(qr,{})})})]})]})})})}_a.createRoot(document.getElementById("root")).render(e.jsx(it.StrictMode,{children:e.jsx(Hr,{})}))});export default Jr();
