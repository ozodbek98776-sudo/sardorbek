const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/qrcode-vendor-DPnJAP0X.js","assets/vendor-B7oWd0tj.js"])))=>i.map(i=>d[i]);
var Ba=Object.defineProperty,_a=Object.defineProperties;var Oa=Object.getOwnPropertyDescriptors;var xa=Object.getOwnPropertySymbols;var Fa=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable;var Ht=(a,n,r)=>n in a?Ba(a,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[n]=r,g=(a,n)=>{for(var r in n||(n={}))Fa.call(n,r)&&Ht(a,r,n[r]);if(xa)for(var r of xa(n))Ka.call(n,r)&&Ht(a,r,n[r]);return a},j=(a,n)=>_a(a,Oa(n));var Xa=(a,n)=>()=>(n||a((n={exports:{}}).exports,n),n.exports);var Mt=(a,n,r)=>Ht(a,typeof n!="symbol"?n+"":n,r);var E=(a,n,r)=>new Promise((u,l)=>{var h=z=>{try{p(r.next(z))}catch($){l($)}},k=z=>{try{p(r.throw(z))}catch($){l($)}},p=z=>z.done?u(z.value):Promise.resolve(z.value).then(h,k);p((r=r.apply(a,n)).next())});import{r as t,j as e,u as As,b as at,U as ls,L as ws,E as st,c as Qs,d as ta,B as Ua,S as Js,P as Es,X as fe,M as qt,N as Ha,e as tt,f as _t,g as ja,h as hs,i as Ie,k as Ds,C as Rs,l as _s,m as aa,n as Pt,O as Ot,o as va,p as zt,q as gs,H as ra,s as it,F as Hs,t as la,v as Jt,D as is,T as na,w as Ya,x as Os,y as Gt,z as Wa,G as Et,I as dt,J as Ms,K as ia,Q as Ja,V as Vt,W as oa,Y as Ga,Z as mt,_ as ht,$ as ds,a0 as Ps,a1 as wa,a2 as Gs,a3 as yt,a4 as Va,a5 as Na,a6 as xt,a7 as St,a8 as ua,a9 as Dt,aa as ca,ab as Xs,ac as Zt,ad as At,ae as Ws,af as Za,ag as ha,ah as ya,ai as er,aj as sr,ak as Tt,al as tr,am as ka,an as ar,ao as Sa,ap as Ca,aq as rr,ar as Ys,as as lr,at as nr,au as ir,av as pa,aw as or,ax as cr,ay as dr,az as mr,aA as xr,aB as ur,aC as hr,aD as pr,aE as He,R as ot,aF as Zs,aG as fr}from"./react-vendor-CslNiP3l.js";import{a as qa}from"./http-vendor-DnTtldoj.js";import{R as gr,A as br,C as jr,X as vr,Y as wr,T as Nr,a as yr}from"./chart-vendor-DJpi7lHo.js";import{t as Ft,H as kr}from"./qrcode-vendor-DPnJAP0X.js";import"./vendor-B7oWd0tj.js";var zl=Xa(es=>{(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))u(l);new MutationObserver(l=>{for(const h of l)if(h.type==="childList")for(const k of h.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&u(k)}).observe(document,{childList:!0,subtree:!0});function r(l){const h={};return l.integrity&&(h.integrity=l.integrity),l.referrerPolicy&&(h.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?h.credentials="include":l.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function u(l){if(l.ep)return;l.ep=!0;const h=r(l);fetch(l.href,h)}})();const et=class et{constructor(){Mt(this,"isOnline",navigator.onLine);Mt(this,"listeners",new Set);this.setupEventListeners()}static getInstance(){return et.instance||(et.instance=new et),et.instance}setupEventListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.notifyListeners()}),window.addEventListener("offline",()=>{this.isOnline=!1,this.notifyListeners()})}notifyListeners(){this.listeners.forEach(n=>n(this.isOnline))}getOnlineStatus(){return this.isOnline}addListener(n){return this.listeners.add(n),()=>this.listeners.delete(n)}static isServerOfflineError(n){if(!(n!=null&&n.response))return!1;const{status:r,data:u}=n.response;return r===503&&(u==null?void 0:u.offline)===!0}static getOfflineMessage(n){return this.isServerOfflineError(n)?n.response.data.message||"Server is currently offline. Please try again later.":"Network error occurred. Please check your connection."}};Mt(et,"instance");let Lt=et;Lt.getInstance();const da="http://localhost:8000/api",Sr="http://localhost:5173",Pa=da,Bs=da.replace("/api",""),Kt=Sr;console.log("API Base URL:",Pa);console.log("Uploads URL:",Bs);console.log("Environment:","Production");console.log("envApiUrl:",da);const _=qa.create({baseURL:Pa,headers:{"Content-Type":"application/json"},timeout:6e4});_.interceptors.request.use(a=>{var r;const n=localStorage.getItem("token");return n&&(a.headers.Authorization=`Bearer ${n}`),(r=a.url)!=null&&r.includes("/products")&&(a.timeout=12e4),a.headers["Cache-Control"]="no-cache, no-store, must-revalidate",a.headers.Pragma="no-cache",a.headers.Expires="0",a});_.interceptors.response.use(a=>a,a=>{var n,r,u;return((n=a.response)==null?void 0:n.status)===304?(console.warn("304 Not Modified - cache muammosi, qayta urinish kerak"),Promise.reject(new Error("Cache error - please refresh"))):a.code==="ERR_NETWORK"||a.message==="Network Error"?(console.error("ðŸ”´ Server bilan aloqa yo'q - localhost:8000 ishlamayapti"),Promise.reject(new Error("Server bilan aloqa yo'q. Iltimos, serverni ishga tushiring."))):a.code==="ECONNREFUSED"?(console.error("ðŸ”´ Connection refused - server port 8000 da ishlamayapti"),Promise.reject(new Error("Server ishlamayapti. Iltimos, serverni ishga tushiring."))):Lt.isServerOfflineError(a)?(console.warn("Server is offline:",a.response.data.message),Promise.reject(a)):(((r=a.response)==null?void 0:r.status)===401&&(console.warn("401 Unauthorized - token yaroqsiz"),localStorage.removeItem("token"),window.location.pathname.includes("/login")||(window.location.href="/login")),a.code==="ECONNABORTED"&&console.error("â±ï¸ Request timeout:",(u=a.config)==null?void 0:u.url),Promise.reject(a))});const za=t.createContext(void 0),Cr=({children:a})=>{const[n,r]=t.useState(null),[u,l]=t.useState(!0);t.useEffect(()=>{localStorage.getItem("token")?((f=3,y=1e3)=>E(es,null,function*(){var N,D;for(let i=0;i<f;i++)try{const T=yield _.get("/auth/me",{timeout:5e3});r(T.data),l(!1);return}catch(T){if(console.warn(`User fetch attempt ${i+1}/${f} failed:`,T.message),i===f-1||((N=T.response)==null?void 0:N.status)===401||((D=T.response)==null?void 0:D.status)===403){console.error("Failed to fetch user after retries, clearing token"),localStorage.removeItem("token"),l(!1);return}yield new Promise(M=>setTimeout(M,y*(i+1)))}}))():l(!1)},[]);const h=($,b)=>E(es,null,function*(){const f=yield _.post("/auth/login",{phone:$,password:b});localStorage.setItem("token",f.data.token),r(f.data.user)}),k=($,b)=>E(es,null,function*(){const f=yield _.post("/auth/login",{login:$,password:b});localStorage.setItem("token",f.data.token),r(f.data.user)}),p=()=>{localStorage.removeItem("token"),r(null)},z=$=>{r($)};return e.jsx(za.Provider,{value:{user:n,loading:u,login:h,loginWithCredentials:k,logout:p,updateUser:z},children:a})},Vs=()=>{const a=t.useContext(za);if(!a)throw new Error("useAuth must be used within AuthProvider");return a},Ma=t.createContext(void 0),qr={uz:{"login.title":"Sardorbek.Furnetura","login.subtitle":"Professional Biznes Boshqaruv Tizimi","login.secure":"Xavfsiz va Ishonchli","login.welcome":"Xush kelibsiz","login.description":"Davom etish uchun hisobingizga kiring","login.phone":"Telefon raqam","login.password":"Parol","login.passwordPlaceholder":"Parolingizni kiriting","login.signing":"Kirilmoqda...","login.signin":"Kirish","login.error":"Kirish xatosi","sidebar.statistics":"Statistika","sidebar.products":"Tovarlar","sidebar.warehouses":"Omborlar","sidebar.customers":"Mijozlar","sidebar.debts":"Qarz daftarcha","sidebar.orders":"Buyurtmalar","sidebar.helpers":"Yordamchilar","sidebar.settings":"Sozlamalar","sidebar.pos":"Kassa (POS)","sidebar.receipts":"Xodimlar cheklari","sidebar.aiAssistant":"AI Yordamchi","sidebar.signout":"Chiqish","sidebar.editProfile":"Profilni tahrirlash","sidebar.fullName":"To'liq ism","sidebar.namePlaceholder":"Ismingizni kiriting","sidebar.phoneNumber":"Telefon raqam","sidebar.newPassword":"Yangi parol (Ixtiyoriy)","sidebar.passwordHint":"Joriy parolni saqlash uchun bo'sh qoldiring","sidebar.cancel":"Bekor qilish","sidebar.saveChanges":"O'zgarishlarni saqlash","dashboard.title":"Statistika paneli","dashboard.overview":"Biznes ko'rsatkichlari","dashboard.description":"Biznesingizning ishlashi va asosiy ko'rsatkichlarini kuzating","dashboard.totalRevenue":"Umumiy daromad","dashboard.todaySales":"Bugungi savdo","dashboard.weeklySales":"Haftalik savdo","dashboard.totalOrders":"Jami buyurtmalar","dashboard.peakHour":"Eng yuqori soat","dashboard.today":"Bugun","dashboard.thisWeek":"Bu hafta","dashboard.refresh":"Ma'lumotlarni yangilash","dashboard.totalProducts":"Jami mahsulotlar","dashboard.lowStock":"Kam qolgan","dashboard.outOfStock":"Tugagan","dashboard.inventoryStatus":"Ombor holati","dashboard.currentStock":"Joriy zaxira ko'rinishi","dashboard.liveData":"Jonli ma'lumotlar","header.search":"Qidirish...","header.live":"Jonli","common.loading":"Yuklanmoqda...","common.error":"Xatolik yuz berdi","common.success":"Muvaffaqiyatli","common.save":"Saqlash","common.cancel":"Bekor qilish","common.delete":"O'chirish","common.edit":"Tahrirlash","common.add":"Qo'shish","common.close":"Yopish"}},Pr=({children:a})=>{const[n,r]=t.useState("uz");t.useEffect(()=>{document.documentElement.lang="uz"},[]);const u=l=>qr.uz[l]||l;return e.jsx(Ma.Provider,{value:{language:n,setLanguage:r,t:u},children:a})},Xt=()=>{const a=t.useContext(Ma);if(a===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return a};function zr(){var i;const[a,n]=t.useState(""),[r,u]=t.useState(""),[l,h]=t.useState(!1),[k,p]=t.useState(""),[z,$]=t.useState(!1),{loginWithCredentials:b}=Vs(),f=As(),N=(i=at().state)==null?void 0:i.message,D=T=>E(this,null,function*(){var M,q;T.preventDefault(),p(""),$(!0);try{yield b(a,r);const Q=(yield _.get("/auth/me")).data;Q.role==="admin"?f("/admin",{replace:!0}):Q.role==="cashier"?f("/kassa",{replace:!0}):Q.role==="helper"?f("/helper",{replace:!0}):f("/",{replace:!0})}catch(v){p(((q=(M=v.response)==null?void 0:M.data)==null?void 0:q.message)||"Login yoki parol noto'g'ri"),$(!1)}});return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(109, 40, 217, 0.15) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute top-1/4 right-1/4 w-64 h-64 rounded-full blur-2xl",style:{background:"radial-gradient(circle, rgba(6, 182, 212, 0.1) 0%, transparent 70%)"}})]}),e.jsxs("div",{className:"w-full max-w-sm relative z-10",children:[e.jsxs("div",{className:"text-center mb-6 animate-fade-up",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{background:"linear-gradient(135deg, #2e1065 0%, #5b21b6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Sardor Furnitura"}),e.jsx("p",{className:"font-medium",style:{color:"#71717a"},children:"Admin boshqaruv tizimi"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full animate-pulse",style:{background:"#22c55e"}}),e.jsx("span",{className:"text-sm",style:{color:"#a1a1aa"},children:"Xavfsiz kirish"})]})]}),e.jsxs("div",{className:"rounded-2xl p-6 animate-fade-up",style:{background:"linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 20px 40px -12px rgba(109, 40, 217, 0.2)",backdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-1",style:{color:"#2e1065"},children:"Xush kelibsiz!"}),e.jsx("p",{style:{color:"#71717a"},children:"Login va parolingizni kiriting"})]}),N&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)",border:"1px solid #86efac"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#22c55e"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"âœ“"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#166534"},children:"Muvaffaqiyat"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#15803d"},children:N})]})]})}),k&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)",border:"1px solid #fca5a5"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#ef4444"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#991b1b"},children:"Xatolik"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#b91c1c"},children:k})]})]})}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ls,{className:"w-3.5 h-3.5"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ls,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:"text",placeholder:"Loginingizni kiriting",value:a,onChange:T=>n(T.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl transition-all duration-200 focus:outline-none text-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ws,{className:"w-3.5 h-3.5"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ws,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:l?"text":"password",placeholder:"Parolingizni kiriting",value:r,onChange:T=>u(T.target.value),className:"w-full pl-10 pr-10 py-3 rounded-xl transition-all duration-200 focus:outline-none text-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!l),className:"absolute inset-y-0 right-0 pr-3 flex items-center transition-colors",style:{color:"#a1a1aa"},children:l?e.jsx(st,{className:"w-4 h-4"}):e.jsx(Qs,{className:"w-4 h-4"})})]})]}),e.jsx("button",{type:"submit",disabled:z,className:"w-full text-white font-semibold py-3.5 px-4 rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 14px -2px rgba(124, 58, 237, 0.4)"},children:z?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Kirish..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Kirish"}),e.jsx(ta,{className:"w-4 h-4 transition-transform group-hover:translate-x-1"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("div",{className:"p-3 rounded-xl",style:{background:"linear-gradient(135deg, #cffafe 0%, #a5f3fc 100%)",border:"1px solid rgba(6, 182, 212, 0.3)"},children:[e.jsx("p",{className:"text-xs font-medium mb-1",style:{color:"#155e75"},children:"Kassa paneli:"}),e.jsx("button",{onClick:()=>f("/kassa-login"),className:"text-sm font-semibold underline transition-colors",style:{color:"#0891b2"},children:"Kassa tizimiga kirish â†’"})]})})]}),e.jsxs("div",{className:"text-center mt-6 animate-fade-up",children:[e.jsx("p",{className:"text-sm",style:{color:"#71717a"},children:"Â© 2025 Sardor Furnitura. Barcha huquqlar himoyalangan."}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-2 text-xs",style:{color:"#a1a1aa"},children:[e.jsx("span",{children:"Xavfsiz"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Professional"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Ishonchli"})]})]})]})]})}const w=a=>{const n=typeof a=="string"?parseFloat(a):a;return isNaN(n)?"0":n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},Ye=a=>a.replace(/\./g,""),rs=a=>{const n=a.replace(/\./g,"");if(n===""||n==="-")return n;const r=parseFloat(n);return isNaN(r)?"":w(r)},ut=a=>{let r=a.replace(/\D/g,"");return!r.startsWith("998")&&r.length>0&&(r="998"+r),r=r.slice(0,12),r.length===0?"":r.length<=3?"+"+r:r.length<=5?"+998 ("+r.slice(3):r.length<=8?"+998 ("+r.slice(3,5)+") "+r.slice(5):r.length<=10?"+998 ("+r.slice(3,5)+") "+r.slice(5,8)+"-"+r.slice(8):"+998 ("+r.slice(3,5)+") "+r.slice(5,8)+"-"+r.slice(8,10)+"-"+r.slice(10)},Rt=a=>a.replace(/\D/g,""),$a=a=>{if(!a)return"";const n=a.replace(/\D/g,"");return n.length!==12?a:"+998 ("+n.slice(3,5)+") "+n.slice(5,8)+"-"+n.slice(8,10)+"-"+n.slice(10)};function Mr(){const[a,n]=t.useState({name:"",login:"",phone:"",password:"",confirmPassword:""}),[r,u]=t.useState(!1),[l,h]=t.useState(!1),[k,p]=t.useState(""),[z,$]=t.useState(!1),{t:b}=Xt(),f=As(),y=D=>{const i=ut(D.target.value);n(T=>j(g({},T),{phone:i}))},N=D=>E(this,null,function*(){var i,T;if(D.preventDefault(),p(""),$(!0),a.password!==a.confirmPassword){p("Parollar mos kelmaydi"),$(!1);return}if(a.password.length<6){p("Parol kamida 6 ta belgidan iborat bo'lishi kerak"),$(!1);return}try{const M=Rt(a.phone);yield _.post("/auth/register",{name:a.name,login:a.login,phone:M,password:a.password}),f("/login",{state:{message:"Admin muvaffaqiyatli yaratildi! Endi tizimga kirishingiz mumkin."}})}catch(M){p(((T=(i=M.response)==null?void 0:i.data)==null?void 0:T.message)||"Xatolik yuz berdi")}finally{$(!1)}});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 bg-gradient-to-br from-blue-400/20 to-indigo-600/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-indigo-400/20 to-purple-600/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-gradient-to-r from-blue-300/10 to-indigo-400/10 rounded-full blur-2xl"})]}),e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23e2e8f0%22%20fill-opacity%3D%220.3%22%3E%3Ccircle%20cx%3D%2230%22%20cy%3D%2230%22%20r%3D%221.5%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-40"}),e.jsxs("div",{className:"w-full max-w-md relative z-10",children:[e.jsxs("div",{className:"text-center mb-8 animate-fade-up",children:[e.jsxs("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-3xl shadow-2xl shadow-blue-500/25 mb-6 relative",children:[e.jsx(Ua,{className:"w-10 h-10 text-white"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center",children:e.jsx(Js,{className:"w-3 h-3 text-white"})})]}),e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-slate-900 via-blue-900 to-indigo-900 bg-clip-text text-transparent mb-3",children:b("login.title")}),e.jsx("p",{className:"text-slate-600 text-lg font-medium",children:b("login.subtitle")}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-slate-500",children:b("login.secure")})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/20 animate-fade-up",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Ro'yxatdan o'tish"}),e.jsx("p",{className:"text-slate-600",children:"Admin hisobini yaratish uchun ma'lumotlarni kiriting"})]}),k&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-4 mb-6 animate-fade-in",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-red-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium text-sm",children:"Xatolik"}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:k})]})]})}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4"}),"To'liq ism"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(ls,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"text",placeholder:"Ismingizni kiriting",value:a.name,onChange:D=>n(i=>j(g({},i),{name:D.target.value})),className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(ls,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"text",placeholder:"Login kiriting (masalan: admin123)",value:a.login,onChange:D=>n(i=>j(g({},i),{login:D.target.value})),className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4"}),"Telefon raqam"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(Es,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"tel",placeholder:"+998 (XX) XXX-XX-XX",value:a.phone,onChange:y,className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(ws,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:r?"text":"password",placeholder:"Parolingizni kiriting",value:a.password,onChange:D=>n(i=>j(g({},i),{password:D.target.value})),className:"w-full pl-12 pr-12 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0}),e.jsx("button",{type:"button",onClick:()=>u(!r),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 transition-colors",children:r?e.jsx(st,{className:"w-5 h-5"}):e.jsx(Qs,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4"}),"Parolni tasdiqlash"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(ws,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:l?"text":"password",placeholder:"Parolni qayta kiriting",value:a.confirmPassword,onChange:D=>n(i=>j(g({},i),{confirmPassword:D.target.value})),className:"w-full pl-12 pr-12 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!l),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 transition-colors",children:l?e.jsx(st,{className:"w-5 h-5"}):e.jsx(Qs,{className:"w-5 h-5"})})]})]}),e.jsx("button",{type:"submit",disabled:z,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold py-4 px-6 rounded-2xl shadow-lg shadow-blue-500/25 transition-all duration-200 hover:from-blue-700 hover:to-indigo-700 hover:shadow-xl hover:shadow-blue-500/30 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",children:z?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Ro'yxatdan o'tilmoqda..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{children:"Ro'yxatdan o'tish"}),e.jsx(ta,{className:"w-5 h-5 transition-transform group-hover:translate-x-1"})]})})]})]})]})]})}function ma({variant:a="button",className:n=""}){const[r,u]=t.useState(null),[l,h]=t.useState(!1),[k,p]=t.useState(!1),[z,$]=t.useState(!1),[b,f]=t.useState(!1);t.useEffect(()=>{const i=/iPad|iPhone|iPod/.test(navigator.userAgent),T=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0;$(i),f(T),p(T);const M=v=>{v.preventDefault(),u(v),h(!0)},q=()=>{p(!0),h(!1),u(null)};return window.addEventListener("beforeinstallprompt",M),window.addEventListener("appinstalled",q),()=>{window.removeEventListener("beforeinstallprompt",M),window.removeEventListener("appinstalled",q)}},[]);const y=()=>E(this,null,function*(){if(r){r.prompt();const{outcome:i}=yield r.userChoice;i==="accepted"&&(u(null),h(!1))}else z&&!b&&h(!0)});if(k)return null;const N=({size:i="md"})=>{const M={sm:{container:"w-8 h-9",apple:"w-7 h-8"},md:{container:"w-10 h-11",apple:"w-9 h-10"},lg:{container:"w-12 h-13",apple:"w-11 h-12"}}[i];return e.jsx("div",{className:`${M.container} relative flex items-center justify-center`,children:e.jsxs("svg",{className:`${M.apple} fill-current drop-shadow-2xl`,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("defs",{children:[e.jsxs("radialGradient",{id:"appleGlow",cx:"50%",cy:"30%",r:"70%",children:[e.jsx("stop",{offset:"0%",stopColor:"#ffffff",stopOpacity:"0.3"}),e.jsx("stop",{offset:"50%",stopColor:"#e5e7eb",stopOpacity:"0.2"}),e.jsx("stop",{offset:"100%",stopColor:"#111827",stopOpacity:"1"})]}),e.jsxs("filter",{id:"glow",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),e.jsx("path",{fill:"url(#appleGlow)",filter:"url(#glow)",d:"M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"}),e.jsx("circle",{cx:"19",cy:"5",r:"4.5",className:"fill-blue-500 animate-pulse drop-shadow-lg"}),e.jsx("circle",{cx:"19",cy:"5",r:"3.8",className:"fill-blue-400"}),e.jsx("path",{d:"M19 2v6M16.5 5h5",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",className:"drop-shadow-sm"}),e.jsx("path",{d:"M17 6.5l2 1.5 2-1.5",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"drop-shadow-sm"})]})})},D=()=>e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 via-gray-800 to-black rounded-3xl p-8 max-w-sm w-full shadow-2xl border border-gray-700/50 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 via-transparent to-transparent rounded-3xl"}),e.jsxs("div",{className:"flex items-center justify-between mb-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-14 h-14 bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl flex items-center justify-center shadow-xl border border-gray-700/50 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-transparent rounded-3xl"}),e.jsx(N,{size:"lg"})]}),e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Ilovani yuklab olish"})]}),e.jsx("button",{onClick:()=>h(!1),className:"p-2 rounded-xl hover:bg-gray-800 transition-colors",children:e.jsx(fe,{className:"w-5 h-5 text-gray-400"})})]}),e.jsxs("div",{className:"space-y-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-5 p-5 bg-gradient-to-r from-gray-800/50 to-gray-900/50 rounded-3xl border border-gray-700/30 shadow-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"w-16 h-16 bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl flex items-center justify-center shadow-xl border border-gray-700/50 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-transparent rounded-3xl"}),e.jsx(N,{size:"lg"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white text-lg",children:"iPhone/iPad uchun"}),e.jsx("p",{className:"text-sm text-gray-300 font-medium",children:"Safari brauzeridan foydalaning"})]})]}),e.jsx("div",{className:"space-y-4",children:[{step:1,text:"Safari brauzerida sahifani oching",emoji:"ðŸŒ"},{step:2,text:"Pastdagi 'Ulashish' tugmasini bosing",emoji:"ðŸ“¤"},{step:3,text:"'Bosh ekranga qo'shish' ni tanlang",emoji:"ðŸ“±"},{step:4,text:"'Qo'shish' tugmasini bosing",emoji:"âœ…"}].map(i=>e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-full flex items-center justify-center text-sm font-bold shadow-md",children:i.step}),e.jsx("div",{className:"flex-1 pt-1",children:e.jsxs("p",{className:"text-gray-200 font-medium flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:i.emoji}),i.text]})})]},i.step))})]}),e.jsx("button",{onClick:()=>h(!1),className:"w-full mt-8 bg-gradient-to-r from-blue-600 to-blue-700 text-white py-4 rounded-2xl font-bold text-lg hover:from-blue-700 hover:to-blue-800 shadow-lg shadow-blue-500/25 hover:shadow-xl hover:shadow-blue-500/30 transition-all duration-200 relative z-10",children:"Tushundim ðŸ‘"})]})});return!r&&!z?null:a==="icon"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:y,className:`p-3 rounded-2xl bg-gradient-to-br from-gray-900 via-gray-800 to-black hover:from-gray-800 hover:to-gray-900 border border-gray-700/50 shadow-2xl hover:shadow-3xl transition-all duration-300 text-white hover:scale-110 relative overflow-hidden ${n}`,title:"Ilovani yuklab olish",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-transparent rounded-2xl"}),e.jsx(N,{size:"md"})]}),l&&z&&e.jsx(D,{})]}):a==="navbar"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:y,className:`flex items-center gap-3 px-4 py-3 rounded-2xl bg-gradient-to-r from-gray-900 via-gray-800 to-black hover:from-gray-800 hover:to-gray-900 border border-gray-700/50 shadow-xl hover:shadow-2xl transition-all duration-300 text-white hover:scale-105 relative overflow-hidden ${n}`,title:"Ilovani yuklab olish",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-transparent rounded-2xl"}),e.jsx(N,{size:"sm"}),e.jsx("span",{className:"hidden sm:inline text-sm font-semibold",children:"Yuklab olish"})]}),l&&z&&e.jsx(D,{})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:y,className:`flex items-center gap-4 px-8 py-4 bg-gradient-to-r from-gray-900 via-gray-800 to-black hover:from-gray-800 hover:to-gray-900 text-white rounded-3xl shadow-2xl hover:shadow-3xl border border-gray-700/50 transition-all duration-300 font-semibold text-lg hover:scale-105 relative overflow-hidden ${n}`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-transparent rounded-3xl"}),e.jsx(N,{size:"lg"}),e.jsx("span",{className:"relative z-10",children:"Ilovani yuklab olish"})]}),l&&z&&e.jsx(D,{})]})}function Ta({items:a,basePath:n,collapsed:r=!1,setCollapsed:u}){var D;const{user:l,logout:h,updateUser:k}=Vs(),{t:p}=Xt(),[z,$]=t.useState(!1),[b,f]=t.useState({name:"",phone:"",password:""}),y=()=>{f({name:(l==null?void 0:l.name)||"",phone:(l==null?void 0:l.phone)||"",password:""}),$(!0)},N=i=>E(this,null,function*(){var T,M;i.preventDefault();try{const q={name:b.name,phone:b.phone};b.password&&(q.password=b.password);const v=yield _.put("/auth/profile",q);k(v.data),$(!1)}catch(q){alert(((M=(T=q.response)==null?void 0:T.data)==null?void 0:M.message)||"Xatolik yuz berdi")}});return e.jsxs("aside",{className:`fixed left-0 top-0 h-full transition-all duration-300 ease-in-out z-50 ${r?"w-16":"w-64"}`,style:{background:"linear-gradient(180deg, #2e1065 0%, #4c1d95 100%)",borderRight:"1px solid rgba(6, 182, 212, 0.2)",boxShadow:"4px 0 24px -4px rgba(46, 16, 101, 0.3)"},children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-4",style:{borderBottom:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, transparent 100%)"},children:[!r&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center overflow-hidden",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-lg text-white tracking-wide",style:{fontFamily:"'Playfair Display', serif",letterSpacing:"0.5px"},children:"Sardor"}),e.jsx("p",{className:"text-sm font-semibold tracking-wider",style:{color:"#c4b5fd",fontFamily:"'Montserrat', sans-serif",letterSpacing:"1.5px"},children:"FURNITURA"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ma,{variant:"icon"}),e.jsx("button",{onClick:()=>u==null?void 0:u(!r),className:"p-2 rounded-xl transition-all duration-200",style:{background:"rgba(255, 255, 255, 0.1)",color:"#c4b5fd"},children:r?e.jsx(qt,{className:"w-4 h-4"}):e.jsx(fe,{className:"w-4 h-4"})})]})]}),e.jsx("nav",{className:"p-3 space-y-1.5 overflow-y-auto h-[calc(100vh-180px)]",children:a.map((i,T)=>e.jsxs(Ha,{to:`${n}${i.path}`,end:i.path==="",className:({isActive:M})=>`
              flex items-center gap-3 px-3 py-3 rounded-xl font-medium transition-all duration-200 group
              ${r?"justify-center px-2":""}
            `,style:({isActive:M})=>({background:M?"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)":"transparent",color:M?"#ffffff":"#c4b5fd",boxShadow:M?"0 4px 12px -2px rgba(6, 182, 212, 0.4)":"none"}),title:r?i.label:void 0,children:[e.jsx("span",{className:"flex-shrink-0 transition-transform group-hover:scale-110",children:i.icon}),!r&&e.jsx("span",{className:"truncate text-sm",children:p(i.label)})]},T))}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3",style:{borderTop:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.2) 100%)"},children:[!r&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5 mb-2 rounded-xl",style:{background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(6, 182, 212, 0.15)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{background:"linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%)"},children:e.jsx("span",{className:"text-sm font-bold text-white",children:(D=l==null?void 0:l.name)==null?void 0:D.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-white truncate",children:l==null?void 0:l.name}),e.jsx("p",{className:"text-xs capitalize font-medium",style:{color:"#a78bfa"},children:l==null?void 0:l.role})]}),(l==null?void 0:l.role)==="admin"&&e.jsx("button",{onClick:y,className:"p-1.5 rounded-lg transition-all duration-200",style:{background:"rgba(6, 182, 212, 0.2)",color:"#67e8f9"},title:"Profilni tahrirlash",children:e.jsx(tt,{className:"w-3.5 h-3.5"})})]}),e.jsxs("button",{onClick:h,className:`flex items-center gap-2 w-full px-3 py-2.5 rounded-xl transition-all duration-200 font-medium text-sm ${r?"justify-center px-2":""}`,style:{color:"#fca5a5"},title:r?"Sign Out":void 0,children:[e.jsx(_t,{className:"w-4 h-4"}),!r&&e.jsx("span",{children:p("sidebar.signout")})]})]}),z&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 -z-10",style:{background:"rgba(46, 16, 101, 0.7)",backdropFilter:"blur(8px)"},onClick:()=>$(!1)}),e.jsxs("div",{className:"w-full sm:w-auto max-w-md p-4 sm:p-8 relative z-10 rounded-t-3xl sm:rounded-3xl flex flex-col max-h-[90vh] overflow-hidden",style:{background:"linear-gradient(145deg, #ffffff 0%, #faf5ff 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 25px 50px -12px rgba(46, 16, 101, 0.35)"},children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between mb-4 sm:mb-8 pb-4 sm:pb-0 border-b border-surface-100 sm:border-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold truncate",style:{color:"#2e1065"},children:p("sidebar.editProfile")}),e.jsx("button",{onClick:()=>$(!1),className:"flex-shrink-0 p-2 rounded-xl transition-all",style:{background:"#f5f3ff",color:"#7c3aed"},children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:N,className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ls,{className:"w-4 h-4"}),p("sidebar.fullName")]}),e.jsxs("div",{className:"relative",children:[e.jsx(ls,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"text",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:p("sidebar.namePlaceholder"),value:b.name,onChange:i=>f(j(g({},b),{name:i.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(Es,{className:"w-4 h-4"}),p("sidebar.phoneNumber")]}),e.jsxs("div",{className:"relative",children:[e.jsx(Es,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"tel",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:"+998 (XX) XXX-XX-XX",value:b.phone,onChange:i=>f(j(g({},b),{phone:ut(i.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ws,{className:"w-4 h-4"}),p("sidebar.newPassword")]}),e.jsxs("div",{className:"relative",children:[e.jsx(ws,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"password",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:p("sidebar.passwordHint"),value:b.password,onChange:i=>f(j(g({},b),{password:i.target.value}))})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>$(!1),className:"flex-1 px-6 py-3.5 font-semibold rounded-2xl transition-all duration-200",style:{background:"#f5f3ff",color:"#7c3aed"},children:p("sidebar.cancel")}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3.5 text-white font-semibold rounded-2xl transition-all duration-200",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 14px -2px rgba(124, 58, 237, 0.4)"},children:p("sidebar.saveChanges")})]})]})})]})]})]})}const $r=[{icon:e.jsx(ja,{className:"w-5 h-5"}),label:"sidebar.statistics",path:""},{icon:e.jsx(hs,{className:"w-5 h-5"}),label:"sidebar.pos",path:"/kassa"},{icon:e.jsx(Ie,{className:"w-5 h-5"}),label:"sidebar.products",path:"/products"},{icon:e.jsx(Ds,{className:"w-5 h-5"}),label:"sidebar.customers",path:"/customers"},{icon:e.jsx(Rs,{className:"w-5 h-5"}),label:"sidebar.debts",path:"/debts"},{icon:e.jsx(_s,{className:"w-5 h-5"}),label:"sidebar.receipts",path:"/staff-receipts"},{icon:e.jsx(aa,{className:"w-5 h-5"}),label:"sidebar.helpers",path:"/helpers"},{icon:e.jsx(Pt,{className:"w-5 h-5"}),label:"sidebar.settings",path:"/settings"}],Tr=[{icon:e.jsx(hs,{className:"w-5 h-5"}),label:"sidebar.pos",path:""},{icon:e.jsx(Rs,{className:"w-5 h-5"}),label:"sidebar.debts",path:"/debts"},{icon:e.jsx(_s,{className:"w-5 h-5"}),label:"sidebar.receipts",path:"/staff-receipts"}];function Rr(){const a=at(),n=As(),r=[{path:"/admin",icon:ja,label:"Bosh sahifa",exact:!0},{path:"/admin/kassa",icon:hs,label:"Kassa"},{path:"/admin/products",icon:Ie,label:"Tovarlar"},{path:"/admin/debts",icon:_s,label:"Qarzlar"},{path:"/admin/settings",icon:Pt,label:"Sozlamalar"}],u=(l,h)=>h?a.pathname===l:a.pathname.startsWith(l);return e.jsxs("nav",{className:"lg:hidden fixed bottom-0 left-0 right-0 bg-slate-100/80 backdrop-blur-2xl border-t border-slate-200/60 z-50 shadow-[0_-4px_20px_-4px_rgba(0,0,0,0.1)]",children:[e.jsx("div",{className:"grid grid-cols-5 h-[72px] max-w-lg mx-auto",children:r.map(l=>{const h=l.icon,k=u(l.path,l.exact);return e.jsxs("button",{onClick:()=>n(l.path),className:`relative flex flex-col items-center justify-center gap-0.5 transition-all duration-300 ${k?"text-blue-600":"text-slate-400 active:text-slate-600"}`,children:[k&&e.jsx("div",{className:"absolute -top-0.5 left-1/2 -translate-x-1/2 w-8 h-1 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full"}),e.jsx("div",{className:`p-2 rounded-2xl transition-all duration-300 ${k?"bg-gradient-to-br from-blue-50 to-indigo-50 shadow-sm":"hover:bg-slate-50"}`,children:e.jsx(h,{className:`w-5 h-5 transition-all duration-300 ${k?"scale-110 text-blue-600":""}`})}),e.jsx("span",{className:`text-[10px] font-semibold transition-all duration-300 ${k?"text-blue-600":"text-slate-500"}`,children:l.label})]},l.path)})}),e.jsx("div",{className:"h-safe-area-inset-bottom bg-slate-100/80"})]})}function Qr(){const[a,n]=t.useState(!1);return e.jsxs("div",{className:"min-h-screen",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(Ta,{items:$r,basePath:"/admin",collapsed:a,setCollapsed:n})}),e.jsx("main",{className:`
        transition-all duration-300 ease-smooth
        lg:ml-64
        ${a?"lg:ml-[72px]":"lg:ml-64"}
        
        /* Mobile bottom navigation space */
        2xs:pb-[88px] xs:pb-[88px] sm:pb-[88px] md:pb-0
        
        /* Responsive min-height */
        min-h-screen
      `,children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(Ot,{})})}),e.jsx(Rr,{})]})}function Er(){const a=As(),[n,r]=t.useState(0);t.useEffect(()=>{u();const h=setInterval(u,3e4);return()=>clearInterval(h)},[]);const u=()=>E(this,null,function*(){try{const h=yield _.get("/debts?status=pending_approval");r(h.data.length)}catch(h){console.error("Error fetching pending debts count:",h)}}),l=()=>{a("/admin/debt-approvals")};return n===0?null:e.jsx("div",{className:"relative",children:e.jsxs("button",{onClick:l,className:"relative p-2 rounded-xl bg-amber-100 text-amber-600 hover:bg-amber-200 transition-colors",title:`${n} ta qarz tasdiqlashni kutmoqda`,children:[e.jsx(va,{className:"w-5 h-5"}),n>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold",children:n>9?"9+":n})]})})}function Fs({title:a,showSearch:n,onSearch:r,actions:u,filterOptions:l,filterValue:h,onFilterChange:k}){const[p,z]=t.useState(""),[$,b]=t.useState(!1),[f,y]=t.useState(!1),N=t.useRef(null),{t:D}=Xt(),{user:i,logout:T}=Vs(),M=As(),q=(i==null?void 0:i.role)==="admin",v=()=>{window.confirm("Tizimdan chiqmoqchimisiz?")&&(T(),M("/login"))};t.useEffect(()=>($?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[$]),t.useEffect(()=>{f&&N.current&&N.current.focus()},[f]);const Q=K=>{z(K),r==null||r(K)},V=[{icon:ra,label:"Bosh sahifa",path:"/"},{icon:it,label:"Mahsulotlar",path:"/admin/products"},{icon:hs,label:"Kassa",path:"/admin/kassa"},{icon:Ds,label:"Mijozlar",path:"/admin/customers"},{icon:Hs,label:"Qarzlar",path:"/admin/debts"},{icon:_s,label:"Cheklar",path:"/admin/staff-receipts"},{icon:la,label:"Hodimlar",path:"/admin/helpers"}];return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"sticky top-0 z-50 bg-slate-100 border-b border-slate-200/60 shadow-sm",children:e.jsxs("div",{className:"px-1.5 sm:px-3 md:px-4 lg:px-6 h-10 sm:h-12 md:h-14 flex items-center justify-between gap-1 sm:gap-2 md:gap-3 lg:gap-4",children:[e.jsx("button",{onClick:()=>b(!0),className:"lg:hidden p-0.5 rounded bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-colors active:scale-95 flex-shrink-0 flex items-center justify-center",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Menyuni ochish",children:e.jsx(qt,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1.5 md:gap-2 lg:gap-3 flex-shrink-0",children:[l&&l.length>0&&e.jsxs("div",{className:"relative hidden sm:block",children:[e.jsx("select",{value:h,onChange:K=>k==null?void 0:k(K.target.value),className:"appearance-none pl-2 sm:pl-3 pr-6 sm:pr-8 py-1.5 sm:py-2 bg-slate-50 border border-slate-200 rounded-lg text-xs sm:text-sm font-medium text-slate-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 cursor-pointer transition-all duration-200",children:l.map(K=>e.jsx("option",{value:K.value,children:K.label},K.value))}),e.jsx(zt,{className:"absolute right-1.5 sm:right-2 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-400 pointer-events-none"})]}),n&&e.jsx("button",{onClick:()=>y(!f),className:"flex items-center justify-center p-0.5 rounded bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Qidirish",children:e.jsx(gs,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),q?e.jsx(Er,{}):e.jsxs("button",{className:"relative p-0.5 sm:p-1.5 md:p-2 rounded-md sm:rounded-lg bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-all duration-200 flex-shrink-0 flex items-center justify-center",children:[e.jsx(va,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-1.5 sm:w-2 h-1.5 sm:h-2 bg-red-500 rounded-full"})]}),e.jsx("button",{onClick:()=>M("/admin/settings"),className:"hidden sm:flex items-center justify-center p-1.5 md:p-2 rounded-lg bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-all duration-200 flex-shrink-0",children:e.jsx(Pt,{className:"w-4 h-4"})}),u]})]})}),n&&f&&e.jsx("div",{className:"sticky top-10 sm:top-12 md:top-14 z-30 bg-slate-100 border-b border-slate-200 shadow-lg animate-fade-in",children:e.jsx("div",{className:"px-3 sm:px-4 md:px-6 py-3",children:e.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[e.jsx(gs,{className:"absolute left-3 sm:left-3.5 top-1/2 -translate-y-1/2 w-4 sm:w-5 h-4 sm:h-5 text-brand-400"}),e.jsx("input",{ref:N,type:"text",placeholder:"Qidirish...",value:p,onChange:K=>Q(K.target.value),className:"w-full h-11 sm:h-12 pl-10 sm:pl-11 pr-10 sm:pr-11 rounded-xl border-2 border-slate-200 focus:border-brand-400 focus:ring-4 focus:ring-brand-100 focus:bg-white transition-all duration-200 text-sm sm:text-base text-slate-900 placeholder:text-slate-400 bg-white shadow-sm hover:border-brand-300"}),e.jsx("button",{onClick:()=>{y(!1),z(""),r==null||r("")},className:"absolute right-3 sm:right-3.5 top-1/2 -translate-y-1/2 w-7 h-7 flex items-center justify-center rounded-full bg-slate-100 hover:bg-slate-200 transition-colors",children:e.jsx(fe,{className:"w-4 h-4 text-slate-500"})})]})})}),$&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>b(!1)}),e.jsxs("div",{className:"fixed top-0 left-0 bottom-0 w-80 max-w-[85vw] bg-white z-[80] shadow-2xl animate-slide-in-left",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-8 h-8 rounded-lg border-2 border-white/30"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-brand-100 text-xs",children:"Mebel furniturasi"})]})]}),e.jsx("button",{onClick:()=>b(!1),className:"w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center hover:bg-white/30 transition-colors",children:e.jsx(fe,{className:"w-5 h-5 text-white"})})]})}),e.jsxs("div",{className:"overflow-y-auto h-[calc(100vh-140px)] p-4",children:[e.jsx("div",{className:"space-y-1",children:V.map((K,le)=>{const oe=K.icon;return e.jsxs("button",{onClick:()=>{M(K.path),b(!1)},className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-surface-50 transition-colors group",children:[e.jsx("div",{className:"w-11 h-11 bg-surface-100 rounded-xl flex items-center justify-center group-hover:bg-brand-50 group-hover:scale-110 transition-all",children:e.jsx(oe,{className:"w-5 h-5 text-surface-600 group-hover:text-brand-600"})}),e.jsx("span",{className:"font-medium text-surface-900 group-hover:text-brand-600 transition-colors",children:K.label}),e.jsx(Jt,{className:"w-4 h-4 text-surface-300 ml-auto group-hover:text-brand-600 group-hover:translate-x-1 transition-all"})]},le)})}),e.jsxs("div",{className:"mt-6 p-4 bg-surface-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-surface-500 text-center mb-2",children:(i==null?void 0:i.name)||"Foydalanuvchi"}),e.jsx("p",{className:"text-xs text-surface-400 text-center mb-4",children:new Date().toLocaleDateString("uz-UZ",{year:"numeric",month:"long",day:"numeric"})}),e.jsxs("button",{onClick:v,className:"w-full flex items-center justify-center gap-2 p-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-xl transition-colors",children:[e.jsx(_t,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Chiqish"})]})]})]})]})]})]})}function Dr(){const[a,n]=t.useState("today"),{t:r}=Xt(),[u,l]=t.useState({totalRevenue:0,todaySales:0,weekSales:0,monthSales:0,totalReceipts:0,totalProducts:0,lowStock:0,outOfStock:0,peakHour:""}),[h,k]=t.useState([]),[p,z]=t.useState([]),[$,b]=t.useState(!0);t.useEffect(()=>{f(),y()},[]),t.useEffect(()=>{N()},[a]);const f=()=>E(this,null,function*(){try{const i=yield _.get("/stats");l(i.data)}catch(i){console.error("Error fetching stats:",i)}finally{b(!1)}}),y=()=>E(this,null,function*(){try{const T=(yield _.get("/stats/top-products")).data.slice(0,3);z(T)}catch(i){console.error("Error fetching top products:",i)}}),N=()=>E(this,null,function*(){try{const i=yield _.get(`/stats/chart?period=${a}`);k(i.data)}catch(i){console.error("Error fetching chart data:",i)}}),D=[{icon:is,label:"Umumiy daromad",value:w(u.totalRevenue||0),suffix:"UZS",color:"from-emerald-500 to-emerald-600",accentColor:"bg-emerald-500",iconBg:"bg-emerald-100",iconColor:"text-emerald-600",textColor:"text-emerald-600",trend:"+12.5%",trendUp:!0},{icon:na,label:a==="today"?"Bugungi savdo":"Haftalik savdo",value:w(a==="today"?u.todaySales||0:u.weekSales||0),suffix:"UZS",color:"from-blue-500 to-blue-600",accentColor:"bg-blue-500",iconBg:"bg-blue-100",iconColor:"text-blue-600",textColor:"text-blue-600",trend:"+8.2%",trendUp:!0},{icon:hs,label:"Jami buyurtmalar",value:(u.totalReceipts||0).toString(),color:"from-purple-500 to-purple-600",accentColor:"bg-purple-500",iconBg:"bg-purple-100",iconColor:"text-purple-600",textColor:"text-purple-600",trend:"+15.3%",trendUp:!0},{icon:Ya,label:"Eng yuqori soat",value:u.peakHour||"-",color:"from-orange-500 to-orange-600",accentColor:"bg-orange-500",iconBg:"bg-orange-100",iconColor:"text-orange-600",textColor:"text-orange-600",trend:"",trendUp:!0}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100",children:[e.jsx(Fs,{title:r("dashboard.title")}),e.jsxs("div",{className:"py-4 sm:py-5 md:py-6 space-y-4 sm:space-y-5 md:space-y-6 pb-24 lg:pb-8",children:[e.jsxs("div",{className:"px-4 sm:px-6 md:px-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 animate-fade-in",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-extrabold bg-gradient-to-r from-purple-900 via-purple-700 to-purple-600 bg-clip-text text-transparent leading-tight",children:r("dashboard.overview")}),e.jsx("p",{className:"text-slate-600 text-xs sm:text-sm font-medium",children:r("dashboard.description")})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex p-1 bg-white/90 backdrop-blur-xl rounded-xl shadow-lg border border-white/20",children:[e.jsx("button",{onClick:()=>n("today"),className:`px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all duration-300 ${a==="today"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/30":"text-slate-600 hover:text-slate-900 hover:bg-slate-50/50"}`,children:r("dashboard.today")}),e.jsx("button",{onClick:()=>n("week"),className:`px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all duration-300 ${a==="week"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/30":"text-slate-600 hover:text-slate-900 hover:bg-slate-50/50"}`,children:r("dashboard.thisWeek")})]}),e.jsx("button",{onClick:f,className:"p-2.5 sm:p-3 rounded-xl bg-white/90 backdrop-blur-xl border border-white/20 text-slate-600 hover:text-slate-900 hover:bg-white transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 active:scale-95",title:r("dashboard.refresh"),children:e.jsx(Os,{className:`w-4 h-4 sm:w-5 sm:h-5 ${$?"animate-spin":""}`})})]})]}),$?e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:[1,2,3,4].map(i=>e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-xl sm:rounded-2xl p-3 sm:p-4 md:p-5 shadow-xl border border-slate-200/50 overflow-hidden min-h-[140px] sm:min-h-[160px] md:min-h-[180px]",children:[e.jsxs("div",{className:"animate-pulse space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 bg-gradient-to-br from-slate-200 to-slate-300 rounded-lg sm:rounded-xl"}),e.jsx("div",{className:"w-10 sm:w-12 h-4 sm:h-5 bg-gradient-to-br from-slate-200 to-slate-300 rounded-lg"})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx("div",{className:"h-6 sm:h-8 bg-gradient-to-br from-slate-200 to-slate-300 rounded-lg w-3/4"}),e.jsx("div",{className:"h-3 sm:h-4 bg-gradient-to-br from-slate-200 to-slate-300 rounded w-1/2"})]})]}),e.jsx("div",{className:"absolute inset-0 -translate-x-full animate-[shimmer_2s_infinite] bg-gradient-to-r from-transparent via-white/20 to-transparent"})]},i))})}):e.jsx("div",{children:e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:D.map((i,T)=>e.jsx("div",{className:"group relative animate-slide-up",style:{animationDelay:`${T*100}ms`},children:e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-xl sm:rounded-2xl p-3 sm:p-4 md:p-5 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] overflow-hidden min-h-[140px] sm:min-h-[160px] md:min-h-[180px] flex flex-col border border-slate-200/50",children:[e.jsx("div",{className:`absolute top-0 left-0 right-0 h-0.5 sm:h-1 ${i.accentColor}`}),e.jsxs("div",{className:"flex items-start justify-between mb-auto",children:[e.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 rounded-lg sm:rounded-xl md:rounded-2xl ${i.iconBg} flex items-center justify-center flex-shrink-0`,children:e.jsx(i.icon,{className:`w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7 ${i.iconColor}`})}),i.trend&&e.jsxs("div",{className:`flex items-center gap-0.5 px-1.5 sm:px-2 py-0.5 rounded-md sm:rounded-lg text-[9px] sm:text-[10px] md:text-xs font-bold ${i.trendUp?"bg-emerald-50 text-emerald-700":"bg-red-50 text-red-700"}`,children:[i.trendUp?e.jsx(Gt,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"}):e.jsx(Wa,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"}),e.jsx("span",{children:i.trend})]})]}),e.jsxs("div",{className:"mt-auto space-y-0.5 sm:space-y-1",children:[e.jsxs("div",{className:"flex items-baseline gap-0.5 sm:gap-1 flex-wrap",children:[e.jsx("h3",{className:`text-base sm:text-xl md:text-2xl lg:text-3xl font-bold ${i.textColor} leading-none tracking-tight`,children:i.value}),i.suffix&&e.jsx("span",{className:"text-[7px] sm:text-[8px] md:text-[9px] font-semibold text-slate-400 uppercase",children:i.suffix})]}),e.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs font-medium text-slate-600 leading-tight line-clamp-2",children:i.label})]})]})},T))})})}),e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 sm:gap-5 md:gap-6",children:[e.jsx("div",{className:"xl:col-span-2 relative group animate-slide-up",style:{animationDelay:"400ms"},children:e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 shadow-xl border border-slate-200/50 hover:shadow-2xl transition-all duration-500 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/40 via-transparent to-slate-50/40 opacity-60"}),e.jsxs("div",{className:"relative z-10 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-500 rounded-2xl blur-lg opacity-30"}),e.jsx("div",{className:"relative w-14 h-14 sm:w-16 sm:h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg",children:e.jsx(Et,{className:"w-7 h-7 sm:w-8 sm:h-8 text-white"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-slate-900 mb-1",children:a==="today"?"Bugungi daromad":"Haftalik daromad"}),e.jsx("p",{className:"text-sm sm:text-base text-slate-500 font-medium",children:a==="today"?"Soatlik taqsimot":"Kunlik ko'rsatkichlar"})]})]}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-50 rounded-xl border border-blue-100",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-bold text-blue-700",children:"Savdo"})]})]}),e.jsx("div",{className:"relative z-10 h-64 sm:h-72 md:h-80 rounded-2xl overflow-hidden bg-gradient-to-br from-slate-50/50 to-white/50 p-4",children:h.length>0?e.jsx(gr,{width:"100%",height:"100%",children:e.jsxs(br,{data:h,margin:{top:10,right:10,left:-20,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorSales",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.4}),e.jsx("stop",{offset:"50%",stopColor:"#3b82f6",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.05})]})}),e.jsx(jr,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1,strokeOpacity:.5}),e.jsx(vr,{dataKey:"date",stroke:"#94a3b8",fontSize:12,tickLine:!1,axisLine:{stroke:"#cbd5e1",strokeWidth:2},tick:{fill:"#64748b",fontWeight:600},dy:8}),e.jsx(wr,{stroke:"#94a3b8",fontSize:12,tickLine:!1,axisLine:{stroke:"#cbd5e1",strokeWidth:2},tick:{fill:"#64748b",fontWeight:600},dx:-5,tickFormatter:i=>`${(i/1e3).toFixed(0)}k`}),e.jsx(Nr,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.98)",border:"none",borderRadius:"16px",boxShadow:"0 20px 40px -12px rgba(0, 0, 0, 0.2)",padding:"12px 16px",backdropFilter:"blur(10px)"},labelStyle:{color:"#0f172a",fontWeight:700,marginBottom:"6px",fontSize:"13px"},itemStyle:{color:"#3b82f6",fontWeight:600,fontSize:"14px"},formatter:i=>[`${w(i)} so'm`,"Daromad"],cursor:{stroke:"#3b82f6",strokeWidth:2,strokeDasharray:"5 5",strokeOpacity:.5}}),e.jsx(yr,{type:"monotone",dataKey:"sales",stroke:"#3b82f6",strokeWidth:3,fill:"url(#colorSales)",dot:{fill:"#3b82f6",strokeWidth:2,stroke:"#fff",r:4},activeDot:{r:6,fill:"#3b82f6",stroke:"#fff",strokeWidth:3,filter:"drop-shadow(0 4px 6px rgba(59, 130, 246, 0.4))"},animationDuration:1200,animationEasing:"ease-in-out"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-200 rounded-3xl blur-2xl opacity-40"}),e.jsx("div",{className:"relative w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-slate-100 to-slate-200 rounded-3xl flex items-center justify-center shadow-lg",children:e.jsx(Et,{className:"w-10 h-10 sm:w-12 sm:h-12 text-slate-400"})})]}),e.jsx("p",{className:"font-bold text-slate-700 text-lg mb-2",children:"Ma'lumot mavjud emas"}),e.jsx("p",{className:"text-slate-500 text-sm text-center max-w-xs",children:"Analitikani ko'rish uchun savdo qilishni boshlang"})]})})]})}),e.jsx("div",{className:"relative group animate-slide-up",style:{animationDelay:"500ms"},children:e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 shadow-xl border border-slate-200/50 hover:shadow-2xl transition-all duration-500 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-50/40 via-transparent to-pink-50/40 opacity-60"}),e.jsx("div",{className:"relative z-10 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-purple-500 rounded-2xl blur-lg opacity-30"}),e.jsx("div",{className:"relative w-14 h-14 sm:w-16 sm:h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg",children:e.jsx(Ie,{className:"w-7 h-7 sm:w-8 sm:h-8 text-white"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-slate-900 mb-1",children:"Top mahsulotlar"}),e.jsx("p",{className:"text-sm sm:text-base text-slate-500 font-medium",children:"Eng ko'p sotilganlar"})]})]})}),e.jsx("div",{className:"relative z-10",children:p.length>0?e.jsx("div",{className:"space-y-3 sm:space-y-4",children:p.map((i,T)=>e.jsxs("div",{className:"group/item flex items-center gap-3 sm:gap-4 p-4 sm:p-5 bg-gradient-to-r from-slate-50 to-white rounded-xl sm:rounded-2xl border border-slate-200 hover:border-purple-200 hover:shadow-lg transition-all duration-300 cursor-pointer",children:[e.jsx("div",{className:`flex-shrink-0 w-11 h-11 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center font-bold text-base sm:text-lg shadow-lg transition-transform group-hover/item:scale-110 ${T===0?"bg-gradient-to-br from-yellow-400 to-yellow-500 text-white":T===1?"bg-gradient-to-br from-slate-300 to-slate-400 text-white":"bg-gradient-to-br from-orange-300 to-orange-400 text-white"}`,children:T+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-slate-900 text-sm sm:text-base truncate mb-1",children:i._id}),e.jsxs("p",{className:"text-xs sm:text-sm text-slate-500 font-medium",children:[i.totalSold," ta sotildi"]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"font-bold text-purple-600 text-base sm:text-lg",children:w(i.revenue)}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-400 font-semibold",children:"so'm"})]})]},i._id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-56 sm:h-64",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-200 rounded-3xl blur-2xl opacity-40"}),e.jsx("div",{className:"relative w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-slate-100 to-slate-200 rounded-3xl flex items-center justify-center shadow-lg",children:e.jsx(dt,{className:"w-10 h-10 sm:w-12 sm:h-12 text-slate-400"})})]}),e.jsx("p",{className:"font-bold text-slate-700 text-lg mb-2",children:"Ma'lumot yo'q"}),e.jsx("p",{className:"text-slate-500 text-sm text-center max-w-xs",children:"Hali sotuvlar amalga oshirilmagan"})]})})]})})]})})]})]})}const Ar="modulepreload",Lr=function(a){return"/"+a},fa={},Ir=function(n,r,u){let l=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const k=document.querySelector("meta[property=csp-nonce]"),p=(k==null?void 0:k.nonce)||(k==null?void 0:k.getAttribute("nonce"));l=Promise.allSettled(r.map(z=>{if(z=Lr(z),z in fa)return;fa[z]=!0;const $=z.endsWith(".css"),b=$?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${z}"]${b}`))return;const f=document.createElement("link");if(f.rel=$?"stylesheet":Ar,$||(f.as="script"),f.crossOrigin="",f.href=z,p&&f.setAttribute("nonce",p),document.head.appendChild(f),$)return new Promise((y,N)=>{f.addEventListener("load",y),f.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${z}`)))})}))}function h(k){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=k,window.dispatchEvent(p),!p.defaultPrevented)throw k}return l.then(k=>{for(const p of k||[])p.status==="rejected"&&h(p.reason);return n().catch(h)})};function Br({isOpen:a,onClose:n,onConfirm:r,title:u,message:l,type:h="info",confirmText:k="OK",cancelText:p="Bekor qilish",showCancel:z=!1,autoClose:$=!1,autoCloseDelay:b=2e3}){const f=t.useRef(null);if(t.useEffect(()=>{if(a&&$&&(h==="success"||h==="info")){const i=setTimeout(()=>{r?r():n()},b);return()=>clearTimeout(i)}},[a,$,b,h,r,n]),t.useEffect(()=>{var i;if(a){(i=f.current)==null||i.focus();const T=M=>{M.key==="Enter"&&(M.preventDefault(),r?r():n()),M.key==="Escape"&&n()};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)}},[a,r,n]),!a)return null;const y={info:e.jsx(Ja,{className:"w-10 h-10 text-blue-600"}),success:e.jsx(ia,{className:"w-10 h-10 text-emerald-600"}),warning:e.jsx(Ms,{className:"w-10 h-10 text-amber-600"}),danger:e.jsx(Ms,{className:"w-10 h-10 text-red-600"})},N={info:"bg-gradient-to-br from-blue-50 via-blue-50 to-indigo-50 border-blue-200",success:"bg-gradient-to-br from-emerald-50 via-green-50 to-teal-50 border-emerald-300",warning:"bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 border-amber-200",danger:"bg-gradient-to-br from-red-50 via-rose-50 to-pink-50 border-red-200"},D={info:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/30 hover:shadow-xl hover:shadow-blue-500/40",success:"bg-gradient-to-r from-emerald-500 via-green-500 to-teal-500 hover:from-emerald-600 hover:via-green-600 hover:to-teal-600 text-white shadow-lg shadow-emerald-500/30 hover:shadow-xl hover:shadow-emerald-500/40",warning:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white shadow-lg shadow-amber-500/30 hover:shadow-xl hover:shadow-amber-500/40",danger:"bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-white shadow-lg shadow-red-500/30 hover:shadow-xl hover:shadow-red-500/40"};return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-4 sm:p-6",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm -z-10 transition-opacity duration-100",onClick:n,style:{animation:"fadeIn 0.1s ease-out"}}),e.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-3xl w-full sm:w-auto sm:min-w-[480px] sm:max-w-xl md:max-w-2xl p-6 sm:p-8 md:p-10 shadow-2xl relative z-10 border border-slate-200/50",style:{animation:"modalSlideUp 0.1s ease-out",willChange:"transform, opacity"},children:[e.jsx("button",{onClick:n,className:"absolute top-4 right-4 sm:top-5 sm:right-5 p-2 sm:p-2.5 rounded-xl text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition-all",children:e.jsx(fe,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsxs("div",{className:"flex flex-col items-center text-center mb-6 sm:mb-8",children:[e.jsx("div",{className:`w-16 h-16 sm:w-20 sm:h-20 ${N[h]} rounded-2xl flex items-center justify-center mb-4 sm:mb-6 border shadow-sm`,children:y[h]}),e.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-bold text-slate-900 mb-2 sm:mb-3 px-2",children:u}),e.jsx("p",{className:"text-sm sm:text-base md:text-lg text-slate-600 leading-relaxed max-w-md px-2",children:l})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3 sm:gap-4",children:[z&&e.jsx("button",{onClick:n,className:"flex-1 px-4 sm:px-5 md:px-6 py-3 sm:py-3.5 md:py-4 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all duration-200 text-sm sm:text-base",children:p}),e.jsx("button",{ref:f,onClick:r||n,className:`flex-1 px-4 sm:px-5 md:px-6 py-3 sm:py-3.5 md:py-4 font-semibold rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 text-sm sm:text-base ${D[h]}`,children:k})]})]})]})}function Ns(){const[a,n]=t.useState({isOpen:!1,title:"",message:"",type:"info",showCancel:!1,confirmText:"OK",autoClose:!1,onClose:void 0}),r=t.useCallback((k,p="Xabar",z="info")=>new Promise($=>{if(z==="success"||z==="info"){$();return}n({isOpen:!0,title:p,message:k,type:z,showCancel:!1,confirmText:"OK",autoClose:!1,onConfirm:()=>{n(b=>j(g({},b),{isOpen:!1})),$()}})}),[]),u=t.useCallback((k,p="Tasdiqlash",z="warning")=>new Promise($=>{n({isOpen:!0,title:p,message:k,type:z,showCancel:!0,confirmText:"Ha",autoClose:!1,onConfirm:()=>{n(y=>j(g({},y),{isOpen:!1})),$(!0)},onClose:()=>{n(y=>j(g({},y),{isOpen:!1})),$(!1)}})}),[]),l=t.useCallback(()=>{a.onClose?a.onClose():n(k=>j(g({},k),{isOpen:!1}))},[a.onClose]),h=e.jsx(Br,{isOpen:a.isOpen,onClose:a.onClose||l,onConfirm:a.onConfirm,title:a.title,message:a.message,type:a.type,showCancel:a.showCancel,confirmText:a.confirmText,autoClose:a.autoClose});return{showAlert:r,showConfirm:u,AlertComponent:h}}const _r="pos_offline_db",Or=2,bs={SALES:"offline_sales",PRODUCTS:"cached_products",STAFF_RECEIPTS:"staff_receipts"};let $t=null;const rt=()=>new Promise((a,n)=>{if($t){a($t);return}const r=indexedDB.open(_r,Or);r.onerror=()=>{console.error("IndexedDB: Failed to open database"),n(r.error)},r.onsuccess=()=>{$t=r.result,console.log("IndexedDB: Database opened successfully"),a($t)},r.onupgradeneeded=u=>{const l=u.target.result;if(!l.objectStoreNames.contains(bs.SALES)){const h=l.createObjectStore(bs.SALES,{keyPath:"id"});h.createIndex("synced","synced",{unique:!1}),h.createIndex("createdAt","createdAt",{unique:!1}),console.log("IndexedDB: Created offline_sales store")}if(l.objectStoreNames.contains(bs.PRODUCTS)||(l.createObjectStore(bs.PRODUCTS,{keyPath:"_id"}).createIndex("code","code",{unique:!0}),console.log("IndexedDB: Created cached_products store")),!l.objectStoreNames.contains(bs.STAFF_RECEIPTS)){const h=l.createObjectStore(bs.STAFF_RECEIPTS,{keyPath:"id"});h.createIndex("syncStatus","syncStatus",{unique:!1}),h.createIndex("createdAt","createdAt",{unique:!1}),h.createIndex("updatedAt","updatedAt",{unique:!1}),h.createIndex("userId","userId",{unique:!1}),console.log("IndexedDB: Created staff_receipts store")}}}),Fr=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>{const n=Math.random()*16|0;return(a==="x"?n:n&3|8).toString(16)}),Kr=a=>E(es,null,function*(){const n=yield rt(),r=j(g({},a),{id:Fr(),createdAt:new Date().toISOString(),synced:!1});return new Promise((u,l)=>{const p=n.transaction([bs.SALES],"readwrite").objectStore(bs.SALES).add(r);p.onsuccess=()=>{console.log("IndexedDB: Sale saved offline",r.id),u(r)},p.onerror=()=>{console.error("IndexedDB: Failed to save sale"),l(p.error)}})}),Ra=()=>E(es,null,function*(){const a=yield rt();return new Promise((n,r)=>{const l=a.transaction([bs.SALES],"readonly").objectStore(bs.SALES),h=[],k=l.openCursor();k.onsuccess=p=>{const z=p.target.result;if(z){const $=z.value;($.synced===!1||$.synced===void 0)&&h.push($),z.continue()}else n(h)},k.onerror=()=>{console.error("IndexedDB: Failed to get unsynced sales"),r(k.error)}})}),Qa=a=>E(es,null,function*(){const n=yield rt();return new Promise((r,u)=>{const l=n.transaction([bs.SALES],"readwrite"),h=l.objectStore(bs.SALES);l.onerror=()=>u(l.error);let k=0;const p=a.length;if(p===0){r();return}a.forEach(z=>{const $=h.get(z);$.onsuccess=()=>{const b=$.result;b&&(b.synced=!0,h.put(b)),k++,k===p&&(console.log(`IndexedDB: Marked ${p} sales as synced`),r())},$.onerror=()=>{k++,k===p&&r()}})})}),Ea=a=>E(es,null,function*(){const n=yield rt();return new Promise((r,u)=>{const l=n.transaction([bs.SALES],"readwrite"),h=l.objectStore(bs.SALES);l.onerror=()=>u(l.error);let k=0;const p=a.length;if(p===0){r();return}a.forEach(z=>{const $=h.delete(z);$.onsuccess=()=>{k++,k===p&&(console.log(`IndexedDB: Deleted ${p} synced sales`),r())},$.onerror=()=>{k++,k===p&&r()}})})}),nt=()=>E(es,null,function*(){return(yield Ra()).length}),Da=a=>E(es,null,function*(){const n=yield rt();return new Promise((r,u)=>{const h=n.transaction([bs.PRODUCTS],"readwrite").objectStore(bs.PRODUCTS),k=h.clear();k.onsuccess=()=>{let p=0;const z=a.length;if(z===0){r();return}a.forEach($=>{const b=h.add($);b.onsuccess=()=>{p++,p===z&&(console.log(`IndexedDB: Cached ${z} products`),r())},b.onerror=()=>{p++,p===z&&r()}})},k.onerror=()=>{u(k.error)}})}),It=()=>E(es,null,function*(){const a=yield rt();return new Promise((n,r)=>{const h=a.transaction([bs.PRODUCTS],"readonly").objectStore(bs.PRODUCTS).getAll();h.onsuccess=()=>{var k;console.log(`IndexedDB: Retrieved ${((k=h.result)==null?void 0:k.length)||0} cached products`),n(h.result||[])},h.onerror=()=>{console.error("IndexedDB: Failed to get cached products"),r(h.error)}})});let Qt=[],kt=!1;const Xr=a=>(Qt.push(a),()=>{Qt=Qt.filter(n=>n!==a)}),Ct=a=>E(es,null,function*(){const n=yield nt();Qt.forEach(r=>r(a,n))}),ct=()=>navigator.onLine,ea=()=>E(es,null,function*(){if(kt)return console.log("Sync: Already syncing, skipping..."),{success:!1,synced:0,error:"Sync already in progress"};if(!ct())return console.log("Sync: Device is offline, skipping..."),{success:!1,synced:0,error:"Device is offline"};kt=!0,yield Ct("syncing");try{const a=yield Ra();if(a.length===0)return console.log("Sync: No unsynced sales to sync"),kt=!1,yield Ct("idle"),{success:!0,synced:0};console.log(`Sync: Found ${a.length} unsynced sales`);const n=a.map(u=>({offlineId:u.id,items:u.items,total:u.total,paymentMethod:u.paymentMethod,customer:u.customer,isReturn:u.isReturn,createdAt:u.createdAt})),r=yield _.post("/receipts/bulk",{sales:n});if(r.data.success){const u=a.map(l=>l.id);return yield Qa(u),yield Ea(u),console.log(`Sync: Successfully synced ${u.length} sales`),kt=!1,yield Ct("success"),{success:!0,synced:u.length}}else throw new Error(r.data.message||"Server returned error")}catch(a){return console.error("Sync: Failed to sync sales",a),kt=!1,yield Ct("error"),{success:!1,synced:0,error:a.message||"Sync failed"}}}),Ur=()=>{window.addEventListener("online",()=>E(es,null,function*(){console.log("Sync: Internet connection restored"),setTimeout(()=>E(es,null,function*(){const a=yield ea();a.success&&a.synced>0&&console.log(`Sync: Auto-synced ${a.synced} sales after reconnection`)}),2e3)})),window.addEventListener("offline",()=>{console.log("Sync: Internet connection lost - sales will be saved locally"),Ct("idle")}),ct()&&setTimeout(()=>{ea()},3e3),console.log("Sync: Event listeners initialized")},Hr=()=>E(es,null,function*(){return ct()?ea():{success:!1,synced:0,error:"Internet aloqasi yo'q"}}),Yr=()=>{const[a,n]=t.useState(ct()),[r,u]=t.useState(0),[l,h]=t.useState(!1),[k,p]=t.useState("idle"),[z,$]=t.useState(!1);t.useEffect(()=>{E(es,null,function*(){yield rt(),z||(Ur(),$(!0));const M=yield nt();u(M)});const D=Xr((M,q)=>{p(M),u(q),h(M==="syncing")}),i=()=>n(!0),T=()=>n(!1);return window.addEventListener("online",i),window.addEventListener("offline",T),()=>{D(),window.removeEventListener("online",i),window.removeEventListener("offline",T)}},[z]);const b=t.useCallback(N=>E(es,null,function*(){if(ct())try{const i=(yield _.get(`/products${N?`?${N}`:""}`)).data;return yield Da(i),i}catch(D){return console.log("Failed to fetch from server, using cache"),It()}else return console.log("Offline - using cached products"),It()}),[]),f=t.useCallback(N=>E(es,null,function*(){try{const D=yield Kr(N);if(console.log("Sale saved locally:",D.id),ct())try{yield _.post("/receipts",{items:N.items,total:N.total,paymentMethod:N.paymentMethod,customer:N.customer,isReturn:N.isReturn}),yield Qa([D.id]),yield Ea([D.id]);const i=yield nt();return u(i),{success:!0,offline:!1}}catch(i){console.log("Server sync failed, sale saved offline");const T=yield nt();return u(T),{success:!0,offline:!0}}else{const i=yield nt();return u(i),{success:!0,offline:!0}}}catch(D){return console.error("Failed to save sale:",D),{success:!1,offline:!1}}}),[]),y=t.useCallback(()=>E(es,null,function*(){const N=yield Hr(),D=yield nt();return u(D),N}),[]);return{isOnline:a,pendingCount:r,isSyncing:l,syncStatus:k,fetchProductsWithCache:b,createSaleOfflineFirst:f,manualSync:y}};function Wr({onScan:a,onClose:n}){const[r,u]=t.useState(!1),[l,h]=t.useState(""),[k,p]=t.useState(!1),[z,$]=t.useState(""),[b,f]=t.useState(""),y=t.useRef(null);t.useEffect(()=>{y.current&&y.current.focus()},[]);const N=T=>E(this,null,function*(){var M,q;if(!T||T.trim()===""){$("Kod kiriting");return}try{p(!0),$(""),f(""),console.log("ðŸ” QR Scanner: Mahsulot qidirilmoqda...",T);const v=yield _.get(`/products/scan-qr/${T.trim()}`);if(v.data.success&&v.data.product){console.log("âœ… QR Scanner: Mahsulot topildi",v.data.product);const Q=v.data.product;f(`${Q.name} topildi! Mavjud: ${Q.quantity} ta`),setTimeout(()=>{a(Q),h(""),f(""),y.current&&y.current.focus()},500)}else $("Mahsulot topilmadi")}catch(v){console.error("âŒ QR Scanner xatosi:",v),$(((q=(M=v.response)==null?void 0:M.data)==null?void 0:q.message)||"Mahsulot topilmadi")}finally{p(!1)}}),D=T=>{T.key==="Enter"&&N(l)},i=()=>{N(l)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-scale-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(Vt,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"QR Scanner"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Mahsulot kodini kiriting"})]})]}),e.jsx("button",{onClick:n,className:"w-10 h-10 rounded-full hover:bg-slate-100 flex items-center justify-center transition-colors",children:e.jsx(fe,{className:"w-5 h-5 text-slate-600"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mahsulot Kodi"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:y,type:"text",value:l,onChange:T=>h(T.target.value),onKeyPress:D,placeholder:"Kodni kiriting yoki skanerlang...",className:"flex-1 px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",disabled:k,autoFocus:!0}),e.jsx("button",{onClick:i,disabled:k||!l,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Qidirilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Vt,{className:"w-5 h-5"}),"Qidirish"]})})]})]}),z&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-xl text-red-700",children:[e.jsx(oa,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium",children:z})]}),b&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-xl text-green-700",children:[e.jsx(ia,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium",children:b})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Qanday ishlatish?"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Mahsulot kodini kiriting"}),e.jsx("li",{children:"â€¢ Yoki QR kod skanerdan foydalaning"}),e.jsx("li",{children:"â€¢ Enter tugmasini bosing"}),e.jsx("li",{children:"â€¢ Mahsulot avtomatik kassaga qo'shiladi"})]})]}),r&&e.jsxs("div",{className:"bg-slate-100 rounded-xl p-8 text-center",children:[e.jsx(Ga,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Kamera skaneri tez orada..."})]})]}),e.jsx("div",{className:"mt-6 flex gap-3",children:e.jsx("button",{onClick:n,className:"flex-1 px-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-all",children:"Yopish"})})]})})}function Yt(){const a=As(),{showAlert:n,AlertComponent:r}=Ns();Yr();const[u,l]=t.useState(!1),[h,k]=t.useState([]),[p,z]=t.useState([]),[$,b]=t.useState(20),[f,y]=t.useState([]),[N,D]=t.useState(""),[i,T]=t.useState(!1),[M,q]=t.useState(!1),[v,Q]=t.useState(""),[V,K]=t.useState([]),[le,oe]=t.useState([]),[O,ke]=t.useState(!1),[ee,ve]=t.useState([]),[X,Z]=t.useState(null),[L,xe]=t.useState(!1),[I,de]=t.useState(""),[ue,F]=t.useState(0),[S,be]=t.useState(0),[W,Se]=t.useState(0),[Be,We]=t.useState(null),[Qe,Ge]=t.useState(!1),[Fe,Ve]=t.useState(!1),[m,te]=t.useState(""),[Ce,ze]=t.useState(""),[ne,Ze]=t.useState(null),[x,ce]=t.useState(!1),[$e,Ee]=t.useState(!1),Ne=t.useRef(null);t.useEffect(()=>{De(),B(),c();const R=localStorage.getItem("pendingReceipt");if(R)try{const ae=JSON.parse(R);if(ae.customer&&Z(ae.customer),ae.items&&ae.items.length>0){const je=ae.items.map(Te=>({_id:Te.product||Te._id,name:Te.name,code:Te.code||"",price:Te.price,cartQuantity:Te.quantity,quantity:999}));y(je)}localStorage.removeItem("pendingReceipt"),setTimeout(()=>{T(!0)},500),n("Chek yuklandi! To'lov qilishingiz mumkin.","Muvaffaqiyat","success")}catch(ae){console.error("Error loading pending receipt:",ae),localStorage.removeItem("pendingReceipt")}},[]),t.useEffect(()=>{z(h.slice(0,$))},[h,$]),t.useEffect(()=>{const R=Ne.current;if(!R)return;const ae=()=>{const{scrollTop:je,scrollHeight:Te,clientHeight:Je}=R;Te-je<=Je*1.5&&$<h.length&&b(Oe=>Math.min(Oe+20,h.length))};return R.addEventListener("scroll",ae),()=>R.removeEventListener("scroll",ae)},[$,h.length]);const De=()=>E(this,null,function*(){try{if(navigator.onLine){const R=yield _.get("/products?mainOnly=true&limit=1000"),ae=R.data.data||R.data,je=Array.isArray(ae)?ae:[];k(je),yield Da(je)}else{const R=yield It();k(R)}}catch(R){console.error("Error fetching products:",R);const ae=yield It();ae.length>0&&k(ae)}}),B=()=>E(this,null,function*(){try{const R=yield _.get("/customers/kassa");ve(R.data)}catch(R){console.error("Error fetching customers:",R)}}),c=()=>{const R=localStorage.getItem("savedReceipts");R&&oe(JSON.parse(R))},H=()=>E(this,null,function*(){var R,ae,je,Te,Je,Oe;if(!m.trim()||!Ce.trim()){n("Ism va telefon raqamini kiriting!","Ogohlantirish","warning");return}try{console.log("ðŸ“¤ Yangi mijoz yaratish so'rovi:",{name:m.trim(),phone:Ce.trim()});const o=yield _.post("/customers/kassa",{name:m.trim(),phone:Ce.trim()});if(console.log("âœ… Mijoz yaratish javobi:",o.data),o.data.success){const J=o.data.customer;ve(me=>[...me,J]),Z(J),Ve(!1),te(""),ze(""),n("Yangi mijoz qo'shildi!","Muvaffaqiyat","success"),console.log("âœ… Mijoz muvaffaqiyatli qo'shildi:",J)}}catch(o){if(console.error("âŒ Mijoz yaratishda xatolik:",o),console.error("Xato tafsilotlari:",(R=o.response)==null?void 0:R.data),((ae=o.response)==null?void 0:ae.status)===400&&((Te=(je=o.response)==null?void 0:je.data)!=null&&Te.existingCustomer)){const J=o.response.data.existingCustomer;Z(J),Ve(!1),te(""),ze(""),n("Bu mijoz allaqachon mavjud. Tanlandi.","Ma'lumot","info"),console.log("â„¹ï¸ Mavjud mijoz tanlandi:",J)}else n(((Oe=(Je=o.response)==null?void 0:Je.data)==null?void 0:Oe.message)||"Mijoz qo'shishda xatolik","Xatolik","danger")}}),he=f.reduce((R,ae)=>R+ae.price*ae.cartQuantity,0),we=f.reduce((R,ae)=>R+ae.cartQuantity,0),ye=R=>{if(R.quantity<=0){n(`${R.name} tugagan! Mavjud emas.`,"Ogohlantirish","warning");return}const ae=f.find(Te=>Te._id===R._id);if((ae?ae.cartQuantity:0)>=R.quantity){n(`${R.name} - maksimal miqdor: ${R.quantity}`,"Ogohlantirish","warning");return}y(Te=>Te.find(Oe=>Oe._id===R._id)?Te.map(Oe=>Oe._id===R._id?j(g({},Oe),{cartQuantity:Oe.cartQuantity+1}):Oe):[...Te,j(g({},R),{cartQuantity:1})]),q(!1),Q("")},C=R=>{ye(R),n(`${R.name} savatga qo'shildi`,"Muvaffaqiyat","success"),Ee(!1)},Y=R=>{y(ae=>ae.filter(je=>je._id!==R))},re=(R,ae)=>{if(ae<=0)Y(R);else{const je=h.find(Te=>Te._id===R);if(je&&ae>je.quantity){n(`${je.name} - maksimal miqdor: ${je.quantity}`,"Ogohlantirish","warning");return}y(Te=>Te.map(Je=>Je._id===R?j(g({},Je),{cartQuantity:ae}):Je))}},ge=R=>{if(Q(R),R.length>0){const ae=h.filter(je=>je.name.toLowerCase().includes(R.toLowerCase())||je.code.toLowerCase().includes(R.toLowerCase()));K(ae)}else K(h.slice(0,20))},ss=()=>E(this,null,function*(){var Je,Oe,o;if(f.length===0)return;const R=S+W,ae=he-R;if(ae>0&&!X){n("Qarzga sotish uchun mijozni tanlang yoki yangi mijoz qo'shing!","Ogohlantirish","warning");return}let je;S>0&&W>0?je="mixed":S>0?je="cash":je="card";const Te={items:f.map(J=>({product:J._id,name:J.name,code:J.code,price:J.price,quantity:J.cartQuantity})),total:he,paidAmount:R,cashAmount:S,cardAmount:W,paymentMethod:je,isReturn:O,customer:X==null?void 0:X._id};try{if(navigator.onLine){console.log("ðŸ“¤ Chek yuborish boshlandi:",Te);const J=yield _.post("/receipts",Te);console.log("âœ… Server javobi:",J.data),ae>0&&X?n(`To'lov qabul qilindi! Qarz: ${w(ae)} so'm`,"Muvaffaqiyat","success"):n(O?"Qaytarish muvaffaqiyatli!":"Chek saqlandi!","Muvaffaqiyat","success"),ps(J.data,je,R,ae,S,W),y([]),T(!1),Ge(!1),We(null),ke(!1),be(0),Se(0),F(0),Z(null),De()}else n("Internet aloqasi yo'q. Iltimos, internetni yoqing.","Xatolik","danger")}catch(J){console.error("âŒ Xatolik:",J),console.error("Xato tafsilotlari:",(Je=J.response)==null?void 0:Je.data);const me=((o=(Oe=J.response)==null?void 0:Oe.data)==null?void 0:o.message)||J.message||"Xatolik yuz berdi";n(me,"Xatolik","danger")}}),ps=(R,ae,je,Te,Je,Oe)=>{const o=window.open("","","height=600,width=400");if(!o)return;const J=je||R.total,me=Te||0,Me=Je||0,Ke=Oe||0;let Ae="";ae==="mixed"?Ae=`Naqd: ${w(Me)} so'm, Karta: ${w(Ke)} so'm`:ae==="cash"?Ae="Naqd pul":Ae="Karta";const Le=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Chek</title>
        <style>
          body { font-family: monospace; margin: 0; padding: 10px; font-size: 12px; }
          .header { text-align: center; margin-bottom: 10px; border-bottom: 1px dashed #000; padding-bottom: 10px; }
          .title { font-weight: bold; font-size: 14px; }
          .items { margin: 10px 0; border-bottom: 1px dashed #000; padding-bottom: 10px; }
          .item { display: flex; justify-content: space-between; margin: 5px 0; }
          .total { font-weight: bold; font-size: 14px; text-align: right; margin: 10px 0; }
          .payment-info { margin: 10px 0; border-top: 1px dashed #000; padding-top: 10px; }
          .footer { text-align: center; margin-top: 10px; font-size: 10px; }
          .debt-warning { color: #d00; font-weight: bold; text-align: center; margin: 10px 0; }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="title">CHEK</div>
          <div>${new Date().toLocaleString("uz-UZ")}</div>
        </div>
        
        <div class="items">
          ${R.items.map(os=>`
            <div class="item">
              <span>${os.name}</span>
              <span>${w(os.price*os.quantity)} so'm</span>
            </div>
            <div style="font-size: 10px; color: #666;">
              ${os.quantity} x ${w(os.price)} so'm
            </div>
          `).join("")}
        </div>
        
        <div class="total">
          Jami: ${w(R.total)} so'm
        </div>
        
        <div class="payment-info">
          ${ae==="mixed"?`
            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
              <span>Naqd:</span>
              <span>${w(Me)} so'm</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
              <span>Karta:</span>
              <span>${w(Ke)} so'm</span>
            </div>
          `:""}
          <div style="display: flex; justify-content: space-between; margin: 5px 0; font-weight: bold;">
            <span>To'landi:</span>
            <span>${w(J)} so'm</span>
          </div>
          ${me>0?`
            <div class="debt-warning">
              Qarz: ${w(me)} so'm
            </div>
          `:""}
        </div>
        
        <div class="footer">
          To'lov: ${Ae}
          <br>
          Raxmat!
        </div>
      </body>
      </html>
    `;o.document.write(Le),o.document.close(),setTimeout(()=>{o.print()},250)},_e=R=>E(this,null,function*(){const ae=window.open("","_blank","width=600,height=400");if(!ae){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}const je=R.map(Oe=>E(this,null,function*(){try{const o=yield Ir(()=>import("./qrcode-vendor-DPnJAP0X.js").then(Ke=>Ke.b),__vite__mapDeps([0,1])),J=o.default||o,me=`${window.location.origin}/product/${Oe._id}`,Me=yield J.toDataURL(me,{width:300,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});return{product:Oe,qrDataUrl:Me}}catch(o){return console.error("QR generation error:",o),{product:Oe,qrDataUrl:""}}})),Te=yield Promise.all(je);let Je="";Te.forEach(({product:Oe,qrDataUrl:o})=>{Je+=`
        <div class="label">
          <div class="top-section">
            <div class="qr-box">
              <img src="${o}" alt="QR" class="qr-code" />
            </div>
            <div class="info-box">
              <div class="product-code">Kod: ${Oe.code}</div>
              <div class="product-name">${Oe.name}</div>
            </div>
          </div>
          <div class="bottom-section">
            <div class="price-box">
              <span class="price-value">${w(Oe.price)}</span>
              <span class="price-currency">so'm</span>
            </div>
          </div>
        </div>
      `}),ae.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Label</title>
        <style>
          @page {
            size: 60mm 40mm;
            margin: 0;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, Helvetica, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .label {
            width: 60mm;
            height: 40mm;
            padding: 2mm;
            background: white;
            display: flex;
            flex-direction: column;
            page-break-after: always;
          }
          .label:last-child {
            page-break-after: auto;
          }
          .top-section {
            display: flex;
            gap: 2mm;
            flex: 1;
          }
          .qr-box {
            width: 22mm;
            height: 22mm;
            flex-shrink: 0;
          }
          .qr-code {
            width: 22mm;
            height: 22mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
          }
          .product-code {
            font-size: 7pt;
            font-weight: 600;
            color: #666;
            margin-bottom: 1mm;
          }
          .product-name {
            font-size: 9pt;
            font-weight: 700;
            color: #000;
            line-height: 1.2;
            text-transform: uppercase;
            word-break: break-word;
          }
          .bottom-section {
            margin-top: 1.5mm;
          }
          .price-box {
            padding: 1.5mm;
            text-align: center;
            background: #f0f0f0;
            border-radius: 1mm;
          }
          .price-value {
            font-size: 14pt;
            font-weight: 900;
            color: #000;
            letter-spacing: -0.5px;
          }
          .price-currency {
            font-size: 10pt;
            font-weight: 700;
            color: #000;
            margin-left: 1mm;
          }
          @media print {
            body { background: white; }
          }
          @media screen {
            body { background: #e5e7eb; padding: 10mm; }
            .label { 
              margin-bottom: 5mm;
              box-shadow: 0 2px 8px rgba(0,0,0,0.1);
              border: 1px solid #ddd;
            }
          }
        </style>
      </head>
      <body>
        ${Je}
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 200);
          }
        <\/script>
      </body>
      </html>
    `),ae.document.close()}),ms=()=>{if(f.length===0){n("Chek bo'sh","Ogohlantirish","warning");return}const R={id:Date.now().toString(),items:[...f],total:he,savedAt:new Date().toLocaleString()},ae=[...le,R];oe(ae),localStorage.setItem("savedReceipts",JSON.stringify(ae)),y([]),n("Chek saqlandi!","Muvaffaqiyat","success")},Ls=R=>{y(R.items);const ae=le.filter(je=>je.id!==R.id);oe(ae),localStorage.setItem("savedReceipts",JSON.stringify(ae)),ce(!1)},Ks=R=>{const ae=le.filter(je=>je.id!==R);oe(ae),localStorage.setItem("savedReceipts",JSON.stringify(ae))};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100 pb-20 lg:pb-0",children:[r,e.jsx("header",{className:"bg-white border-b border-slate-200 sticky top-0 z-40 shadow-sm",children:e.jsxs("div",{className:"max-w-[1800px] mx-auto px-3 sm:px-4 lg:px-6 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>l(!0),className:"p-2 rounded-lg bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-colors active:scale-95 flex-shrink-0 flex sm:hidden",title:"Menyuni ochish",children:e.jsx(qt,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-gradient-to-br from-purple-500 via-purple-600 to-blue-600 flex items-center justify-center shadow-xl",children:e.jsx(hs,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white drop-shadow-lg"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-extrabold bg-gradient-to-r from-purple-600 via-blue-600 to-purple-600 bg-clip-text text-transparent leading-tight",children:"Kassa (POS)"}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500 font-medium mt-0.5",children:"Professional Sotish Tizimi"})]})]}),e.jsxs("button",{onClick:()=>ce(!0),className:"flex items-center gap-2 px-3 sm:px-4 py-2 bg-gradient-to-r from-purple-100 to-blue-100 hover:from-purple-200 hover:to-blue-200 rounded-xl text-sm font-bold text-purple-700 transition-all shadow-md hover:shadow-lg",children:[e.jsx(mt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Saqlangan"}),le.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-red-500 text-white text-xs rounded-full font-bold shadow-md",children:le.length})]})]})}),e.jsx("div",{className:"max-w-[1800px] mx-auto p-2 sm:p-4 lg:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3 sm:gap-4 lg:gap-6",children:[e.jsx("div",{className:"lg:col-span-1 order-1",children:e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-2xl border-2 border-slate-200 shadow-xl overflow-hidden sticky top-20 sm:top-24",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-3 sm:px-6 py-3 sm:py-4 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-1 sm:mb-2",children:[e.jsx(hs,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("h2",{className:"text-base sm:text-lg font-bold",children:"Savat"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-brand-100",children:[we," ta mahsulot"]})]}),e.jsx("div",{className:"max-h-48 sm:max-h-64 overflow-y-auto divide-y divide-slate-100",children:f.length===0?e.jsxs("div",{className:"p-4 sm:p-8 text-center text-slate-400",children:[e.jsx(hs,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 opacity-30"}),e.jsx("p",{className:"text-xs sm:text-sm",children:"Savat bo'sh"})]}):f.map(R=>e.jsxs("div",{className:"p-2 sm:p-4 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1 sm:mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-slate-900 text-xs sm:text-sm truncate",children:R.name}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500",children:R.code})]}),e.jsx("button",{onClick:()=>Y(R._id),className:"text-slate-400 hover:text-red-500 transition-colors flex-shrink-0 ml-2",children:e.jsx(fe,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-slate-100 rounded-lg p-0.5 sm:p-1",children:[e.jsx("button",{onClick:()=>re(R._id,R.cartQuantity-1),className:"w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center hover:bg-slate-200 rounded transition-colors",children:e.jsx(ht,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})}),e.jsx("span",{className:"w-5 text-center text-xs sm:text-sm font-semibold",children:R.cartQuantity}),e.jsx("button",{onClick:()=>re(R._id,R.cartQuantity+1),className:"w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center hover:bg-slate-200 rounded transition-colors",children:e.jsx(ds,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})})]}),e.jsxs("p",{className:"font-bold text-brand-600 text-xs sm:text-sm",children:[w(R.price*R.cartQuantity)," so'm"]})]})]},R._id))}),f.length>0&&e.jsxs("div",{className:"border-t border-slate-200 p-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-600 mb-2 block",children:"Mijoz"}),e.jsxs("button",{onClick:()=>xe(!L),className:"w-full flex items-center gap-2 px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-medium text-slate-700 transition-colors",children:[e.jsx(ls,{className:"w-4 h-4"}),e.jsx("span",{className:"flex-1 text-left truncate",children:X?X.name:"Oddiy mijoz"}),e.jsx(zt,{className:"w-4 h-4"})]}),L&&e.jsxs("div",{className:"absolute right-0 left-0 mx-4 mt-2 bg-white rounded-lg shadow-xl border border-slate-200 z-50 max-h-48 overflow-y-auto",children:[e.jsx("button",{onClick:()=>{Z(null),xe(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 border-b border-slate-100",children:"Oddiy mijoz"}),ee.map(R=>e.jsxs("button",{onClick:()=>{Z(R),xe(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 border-b border-slate-100 last:border-b-0",children:[e.jsx("p",{className:"font-medium text-slate-900",children:R.name}),e.jsx("p",{className:"text-xs text-slate-500",children:R.phone})]},R._id))]})]}),f.length>0&&e.jsxs("div",{className:"border-t border-slate-200 p-3 sm:p-6 space-y-2 sm:space-y-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-50 to-blue-50 rounded-xl p-3 sm:p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm sm:text-base font-semibold text-slate-700",children:"Jami:"}),e.jsxs("span",{className:"text-xl sm:text-2xl font-bold text-brand-600",children:[w(he)," so'm"]})]})}),e.jsxs("button",{onClick:()=>T(!0),className:"w-full bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white font-bold py-2 sm:py-3 rounded-lg sm:rounded-xl transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2 text-xs sm:text-sm",children:[e.jsx(Rs,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"To'lash"]}),e.jsxs("button",{onClick:ms,className:"w-full bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold py-1.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors flex items-center justify-center gap-2 text-xs sm:text-sm",children:[e.jsx(mt,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Saqlash"]}),e.jsxs("button",{onClick:()=>y([]),className:"w-full bg-red-50 hover:bg-red-100 text-red-600 font-semibold py-1.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors flex items-center justify-center gap-2 text-xs sm:text-sm",children:[e.jsx(Ps,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Tozalash"]})]})]})}),e.jsxs("div",{className:"lg:col-span-2 space-y-2 sm:space-y-3 lg:space-y-4 order-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(gs,{className:"absolute left-3 sm:left-4 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Mahsulot qidirish...",value:v,onChange:R=>ge(R.target.value),onFocus:()=>q(!0),className:"w-full pl-9 sm:pl-12 pr-3 sm:pr-4 py-2 sm:py-3 bg-white border-2 border-slate-200 rounded-lg sm:rounded-xl focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 text-xs sm:text-sm"})]}),M&&v?e.jsx("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 overflow-hidden shadow-lg",children:e.jsx("div",{className:"max-h-64 sm:max-h-96 overflow-y-auto",children:V.length>0?e.jsx("div",{className:"divide-y divide-slate-100",children:V.map(R=>e.jsxs("button",{onClick:()=>{ye(R),q(!1),Q("")},disabled:R.quantity<=0,className:`w-full flex items-center gap-2 sm:gap-4 p-2 sm:p-4 hover:bg-slate-50 transition-colors text-left ${R.quantity<=0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-brand-100 to-brand-50 rounded-xl border-2 border-brand-200 flex items-center justify-center flex-shrink-0 overflow-hidden relative",children:[R.quantity<=0&&e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center z-10",children:e.jsx("span",{className:"text-white text-[8px] font-bold",children:"TUGAGAN"})}),R.images&&R.images.length>0?e.jsx("img",{src:`${Bs}${R.images[0]}`,alt:R.name,className:"w-full h-full object-cover",onError:ae=>{ae.currentTarget.style.display="none";const je=ae.currentTarget.parentElement;je&&(je.innerHTML='<svg class="w-5 h-5 sm:w-6 sm:h-6 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>')}}):e.jsx(it,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-slate-900 truncate text-xs sm:text-sm",children:R.name}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-slate-500",children:["Kod: ",R.code]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"font-bold text-brand-600 text-xs sm:text-sm",children:[w(R.price)," so'm"]}),e.jsxs("p",{className:`text-[10px] sm:text-xs font-semibold ${R.quantity<=0?"text-red-600":R.quantity<=10?"text-orange-600":"text-green-600"}`,children:[R.quantity," ta"]})]})]},R._id))}):e.jsxs("div",{className:"p-6 sm:p-8 text-center text-slate-500",children:[e.jsx(it,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 opacity-30"}),e.jsx("p",{className:"text-xs sm:text-sm",children:"Mahsulot topilmadi"})]})})}):e.jsx("div",{ref:Ne,className:"max-h-[calc(100vh-250px)] overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-2 sm:gap-3",children:p.map(R=>e.jsxs("div",{className:"group bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 hover:border-brand-300 hover:shadow-lg transition-all p-2 sm:p-4 relative",children:[e.jsxs("button",{onClick:ae=>{ae.stopPropagation(),_e([R])},className:"absolute top-2 right-2 w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 z-10 group/qr",title:"QR code chiqarish",children:[e.jsx(Vt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white drop-shadow-lg"}),e.jsx("span",{className:"absolute -bottom-8 right-0 bg-slate-900 text-white text-[10px] px-2 py-1 rounded-lg opacity-0 group-hover/qr:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:"QR Print"})]}),e.jsxs("button",{onClick:()=>ye(R),disabled:R.quantity<=0,className:`w-full text-left ${R.quantity<=0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"w-full aspect-square bg-gradient-to-br from-brand-100 to-brand-50 rounded-xl border-2 border-brand-200 flex items-center justify-center mb-2 sm:mb-3 group-hover:scale-105 transition-transform overflow-hidden relative",children:[R.quantity<=0&&e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center z-10",children:e.jsx("div",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold",children:"TUGAGAN"})}),R.images&&R.images.length>0?e.jsx("img",{src:`${Bs}${R.images[0]}`,alt:R.name,className:"w-full h-full object-cover",onError:ae=>{ae.currentTarget.style.display="none";const je=ae.currentTarget.parentElement;je&&(je.innerHTML='<svg class="w-6 h-6 sm:w-8 sm:h-8 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>')}}):e.jsx(it,{className:"w-6 h-6 sm:w-8 sm:h-8 text-brand-600"})]}),e.jsx("p",{className:"font-semibold text-slate-900 text-[10px] sm:text-sm truncate",children:R.name}),e.jsx("p",{className:"text-[9px] sm:text-xs text-slate-500 mb-1 sm:mb-2",children:R.code}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"font-bold text-brand-600 text-[10px] sm:text-sm",children:[w(R.price)," so'm"]}),R.quantity<=0?e.jsx("span",{className:"text-[9px] sm:text-xs text-red-600 font-semibold",children:"0 ta"}):R.quantity<=10?e.jsxs("span",{className:"text-[9px] sm:text-xs text-orange-600 font-semibold",children:[R.quantity," ta"]}):e.jsxs("span",{className:"text-[9px] sm:text-xs text-green-600 font-semibold",children:[R.quantity," ta"]})]})]})]},R._id))})})]})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full my-8 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-6 py-4 text-white",children:e.jsx("h3",{className:"text-xl font-bold",children:"To'lov"})}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[calc(100vh-200px)] overflow-y-auto",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Jami summa"}),e.jsxs("p",{className:"text-3xl font-bold text-brand-600",children:[w(he)," so'm"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700 block",children:"Mijoz"}),Fe?e.jsxs("div",{className:"space-y-3 p-4 bg-blue-50 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1 block",children:"Ism"}),e.jsx("input",{type:"text",value:m,onChange:R=>te(R.target.value),placeholder:"Mijoz ismi...",className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1 block",children:"Telefon"}),e.jsx("input",{type:"tel",value:Ce,onChange:R=>ze(R.target.value),placeholder:"+998 90 123 45 67",className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:H,className:"flex-1 bg-brand-500 hover:bg-brand-600 text-white font-semibold py-2 rounded-lg transition-colors text-sm",children:"Saqlash"}),e.jsx("button",{onClick:()=>{Ve(!1),te(""),ze("")},className:"px-4 bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold rounded-lg transition-colors text-sm",children:"Bekor"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:(X==null?void 0:X._id)||"",onChange:R=>{const ae=ee.find(je=>je._id===R.target.value);Z(ae||null)},className:"w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",children:[e.jsx("option",{value:"",children:"Oddiy mijoz"}),ee.map(R=>e.jsxs("option",{value:R._id,children:[R.name," - ",R.phone]},R._id))]}),e.jsx("button",{onClick:()=>Ve(!0),className:"w-full px-4 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 font-semibold rounded-lg transition-colors text-sm",children:"+ Yangi mijoz qo'shish"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2",children:[e.jsx(wa,{className:"w-4 h-4 text-emerald-600"}),"Naqd pul"]}),e.jsx("input",{type:"number",value:S||"",onChange:R=>be(Number(R.target.value)),placeholder:"0",className:"w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 text-lg font-semibold"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2",children:[e.jsx(Rs,{className:"w-4 h-4 text-blue-600"}),"Karta"]}),e.jsx("input",{type:"number",value:W||"",onChange:R=>Se(Number(R.target.value)),placeholder:"0",className:"w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 text-lg font-semibold"})]})]}),(S>0||W>0)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Jami to'lanadi:"}),e.jsxs("span",{className:"font-bold text-slate-900",children:[w(S+W)," so'm"]})]}),S+W<he&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-amber-600",children:"Qarz:"}),e.jsxs("span",{className:"font-bold text-amber-600",children:[w(he-(S+W))," so'm"]})]}),S+W>he&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-600",children:"Qaytim:"}),e.jsxs("span",{className:"font-bold text-green-600",children:[w(S+W-he)," so'm"]})]})]}),S+W<he&&!X&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-3 flex items-start gap-2",children:[e.jsx(Ms,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-900 text-sm",children:"Mijoz tanlanmagan!"}),e.jsx("p",{className:"text-xs text-red-700 mt-1",children:"Qarzga sotish uchun mijozni tanlang yoki yangi mijoz qo'shing"})]})]}),S+W<he&&X&&e.jsxs("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-3 flex items-start gap-2",children:[e.jsx(Ms,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-amber-900 text-sm",children:"Qisman to'lov"}),e.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:[w(he-(S+W))," so'm ",e.jsx("span",{className:"font-bold",children:X.name})," nomiga qarzga yoziladi"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:ss,disabled:S+W<=0||S+W<he&&!X,className:"flex-1 bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white font-bold py-3 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:"Tasdiqlash"}),e.jsx("button",{onClick:()=>{T(!1),be(0),Se(0),Ve(!1),te(""),ze("")},className:"px-6 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold rounded-xl transition-colors",children:"Bekor"})]})]})]})}),$e&&e.jsx(Wr,{onScan:C,onClose:()=>Ee(!1)}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-96 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-6 py-4 text-white flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Saqlangan Cheklar"}),e.jsx("button",{onClick:()=>ce(!1),className:"hover:bg-brand-600 p-2 rounded-lg transition-colors",children:e.jsx(fe,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto divide-y divide-slate-200",children:le.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx(_s,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"Saqlangan cheklar yo'q"})]}):le.map(R=>e.jsxs("div",{className:"p-4 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-slate-900",children:[R.items.length," ta mahsulot"]}),e.jsx("p",{className:"text-xs text-slate-500",children:R.savedAt})]}),e.jsxs("p",{className:"font-bold text-brand-600",children:[w(R.total)," so'm"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Ls(R),className:"flex-1 bg-brand-100 hover:bg-brand-200 text-brand-700 font-semibold py-2 rounded-lg transition-colors text-sm",children:"Yuklash"}),e.jsx("button",{onClick:()=>Ks(R.id),className:"flex-1 bg-red-100 hover:bg-red-200 text-red-700 font-semibold py-2 rounded-lg transition-colors text-sm",children:"O'chirish"})]})]},R.id))})]})}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] sm:hidden",onClick:()=>l(!1)}),e.jsxs("div",{className:"fixed top-0 left-0 bottom-0 w-80 max-w-[85vw] bg-white z-[70] shadow-2xl animate-slide-in-left sm:hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center",children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-8 h-8 rounded-lg border-2 border-white/30"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-brand-100 text-xs",children:"Mebel furniturasi"})]})]}),e.jsx("button",{onClick:()=>l(!1),className:"p-2 rounded-lg bg-white/20 hover:bg-white/30 text-white transition-colors",children:e.jsx(fe,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("button",{onClick:()=>{a("/"),l(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(ra,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Bosh sahifa"})]}),e.jsxs("button",{onClick:()=>{a("/admin/products"),l(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(it,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Mahsulotlar"})]}),e.jsxs("button",{onClick:()=>{l(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-brand-50 text-brand-700 transition-colors text-left",children:[e.jsx(hs,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Kassa (POS)"})]}),e.jsxs("button",{onClick:()=>{a("/admin/customers"),l(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(Ds,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Mijozlar"})]}),e.jsxs("button",{onClick:()=>{a("/admin/debts"),l(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(Hs,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Qarzlar"})]}),e.jsxs("button",{onClick:()=>{a("/admin/staff-receipts"),l(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(_s,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Cheklar"})]}),e.jsxs("button",{onClick:()=>{a("/admin/helpers"),l(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(la,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Hodimlar"})]})]})]})]})]})}const Jr=({productId:a,code:n,name:r,price:u,unit:l="dona",dimensions:h="",labelWidth:k=60,labelHeight:p=40,copies:z=1,onPrint:$})=>{const[b,f]=t.useState(""),[y,N]=t.useState(z),D=`${Kt}/product/${a}`,i=q=>new Intl.NumberFormat("uz-UZ").format(q);t.useEffect(()=>{T()},[a,n]);const T=()=>E(es,null,function*(){try{const q=yield Ft(D,{width:300,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});f(q)}catch(q){console.error("QR generation error:",q)}}),M=()=>{const q=window.open("","_blank","width=600,height=400");if(!q){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}let v="";for(let Q=0;Q<y;Q++)v+=`
        <div class="label">
          <div class="top-section">
            <div class="qr-box">
              <img src="${b}" alt="QR" class="qr-code" />
            </div>
            <div class="info-box">
              <div class="product-code">Kod: ${n}</div>
              <div class="product-name">${r}</div>
              ${h?`<div class="product-dimensions">${h}</div>`:""}
            </div>
          </div>
          <div class="bottom-section">
            <div class="price-box">
              <span class="price-value">${i(u)}</span>
              <span class="price-currency">so'm</span>
            </div>
          </div>
        </div>
      `;q.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Label - ${r}</title>
        <style>
          @page {
            size: ${k}mm ${p}mm;
            margin: 0;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, Helvetica, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .label {
            width: ${k}mm;
            height: ${p}mm;
            padding: 2mm;
            background: white;
            display: flex;
            flex-direction: column;
            page-break-after: always;
          }
          .label:last-child {
            page-break-after: auto;
          }
          .top-section {
            display: flex;
            gap: 2mm;
            flex: 1;
          }
          .qr-box {
            width: 22mm;
            height: 22mm;
            flex-shrink: 0;
          }
          .qr-code {
            width: 22mm;
            height: 22mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
          }
          .product-code {
            font-size: 7pt;
            font-weight: 600;
            color: #666;
            margin-bottom: 1mm;
          }
          .product-name {
            font-size: 9pt;
            font-weight: 700;
            color: #000;
            line-height: 1.2;
            text-transform: uppercase;
            word-break: break-word;
          }
          .product-dimensions {
            font-size: 7pt;
            color: #666;
            margin-top: 1mm;
          }
          .bottom-section {
            margin-top: 1.5mm;
          }
          .price-box {
            padding: 1.5mm;
            text-align: center;
            background: #f0f0f0;
            border-radius: 1mm;
          }
          .price-value {
            font-size: 14pt;
            font-weight: 900;
            color: #000;
            letter-spacing: -0.5px;
          }
          .price-currency {
            font-size: 10pt;
            font-weight: 700;
            color: #000;
            margin-left: 1mm;
          }
          @media print {
            body { background: white; }
          }
          @media screen {
            body { background: #e5e7eb; padding: 10mm; }
            .label { 
              margin-bottom: 5mm;
              box-shadow: 0 2px 8px rgba(0,0,0,0.1);
              border: 1px solid #ddd;
            }
          }
        </style>
      </head>
      <body>
        ${v}
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 200);
          }
        <\/script>
      </body>
      </html>
    `),q.document.close(),$==null||$()};return e.jsxs("div",{className:"qr-print-label w-full",children:[e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden mx-auto shadow-md border border-gray-200",style:{width:"280px",padding:"12px"},children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:b?e.jsx("img",{src:b,alt:"QR Code",className:"w-24 h-24",style:{imageRendering:"pixelated"}}):e.jsx("div",{className:"w-24 h-24 bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-gray-400",children:"QR"})})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-500 mb-1",children:["Kod: ",n]}),e.jsx("div",{className:"text-base font-bold text-gray-900 uppercase leading-tight",children:r}),h&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:h})]})]}),e.jsxs("div",{className:"mt-3 bg-gray-100 rounded-lg p-2 text-center",children:[e.jsx("span",{className:"text-2xl font-black text-gray-900",children:i(u)}),e.jsx("span",{className:"text-lg font-bold text-gray-900 ml-1",children:"so'm"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-3",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Nusxa soni:"}),e.jsx("input",{type:"number",min:1,max:100,value:y,onChange:q=>N(parseInt(q.target.value)||1),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center"})]}),e.jsxs("button",{onClick:M,className:"mt-4 w-full px-4 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"ðŸ–¨ï¸ Chop etish ",y>1?`(${y} ta)`:""]})]})},Gr=({products:a,onClose:n})=>{const[r,u]=t.useState([]),[l,h]=t.useState(!0),[k,p]=t.useState({width:40,height:30,qrSize:18,columns:2,showPrice:!0,showCode:!0}),[z,$]=t.useState(!1),b=q=>new Intl.NumberFormat("uz-UZ").format(q);t.useEffect(()=>{f()},[a]);const f=()=>E(es,null,function*(){h(!0);const q=[];for(const v of a){const Q=`${Kt}/product/${v._id}`;try{const V=yield Ft(Q,{width:200,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});q.push({product:v,copies:1,qrDataUrl:V})}catch(V){console.error("QR error for",v.code,V)}}u(q),h(!1)}),y=(q,v)=>{u(Q=>Q.map((V,K)=>{if(K===q){const le=Math.max(1,Math.min(100,V.copies+v));return j(g({},V),{copies:le})}return V}))},N=(q,v)=>{u(Q=>Q.map((V,K)=>K===q?j(g({},V),{copies:Math.max(1,Math.min(100,v))}):V))},D=q=>{u(v=>v.filter((Q,V)=>V!==q))},i=q=>{u(v=>v.map(Q=>j(g({},Q),{copies:q})))},T=()=>r.reduce((q,v)=>q+v.copies,0),M=()=>{const q=window.open("","_blank","width=800,height=600");if(!q){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}let v="";r.forEach(Q=>{for(let V=0;V<Q.copies;V++)v+=`
          <div class="label">
            <div class="qr-section">
              <img src="${Q.qrDataUrl}" alt="QR" class="qr-code" />
            </div>
            <div class="info-section">
              <div class="product-name">${Q.product.name.length>18?Q.product.name.substring(0,18)+"...":Q.product.name}</div>
              ${k.showCode?`<div class="product-code">Kod: ${Q.product.code}</div>`:""}
              ${k.showPrice?`<div class="product-price">${b(Q.product.price)} so'm</div>`:""}
            </div>
          </div>
        `}),q.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Labels - Batch Print</title>
        <style>
          @page {
            size: ${k.width*k.columns+2}mm auto;
            margin: 1mm;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .labels-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1mm;
          }
          .label {
            width: ${k.width}mm;
            height: ${k.height}mm;
            padding: 1.5mm;
            display: flex;
            align-items: center;
            gap: 1.5mm;
            background: white;
            border: 0.2mm solid #ddd;
            page-break-inside: avoid;
          }
          .qr-section {
            flex-shrink: 0;
          }
          .qr-code {
            width: ${k.qrSize}mm;
            height: ${k.qrSize}mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
          }
          .product-name {
            font-size: 6pt;
            font-weight: 700;
            color: #000;
            line-height: 1.1;
            margin-bottom: 0.3mm;
            text-transform: uppercase;
            word-break: break-word;
          }
          .product-code {
            font-size: 5pt;
            color: #333;
            margin-bottom: 0.3mm;
          }
          .product-price {
            font-size: 7pt;
            font-weight: 900;
            color: #000;
          }
          @media print {
            body { background: white; }
            .label { border: none; }
          }
        </style>
      </head>
      <body>
        <div class="labels-container">
          ${v}
        </div>
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 300);
          }
        <\/script>
      </body>
      </html>
    `),q.document.close()};return l?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100]",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-brand-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-surface-600",children:"QR kodlar yaratilmoqda..."})]})}):e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-surface-900",children:"QR Label Chop Etish"}),e.jsxs("p",{className:"text-sm text-surface-500",children:[r.length," ta mahsulot, jami ",T()," ta label"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>$(!z),className:`p-2 rounded-lg transition-colors ${z?"bg-brand-100 text-brand-600":"hover:bg-surface-100"}`,children:e.jsx(Pt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-surface-100 rounded-lg",children:e.jsx(fe,{className:"w-5 h-5"})})]})]}),z&&e.jsx("div",{className:"p-4 bg-surface-50 border-b border-surface-200",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Eni (mm)"}),e.jsx("input",{type:"number",value:k.width,onChange:q=>p(v=>j(g({},v),{width:Number(q.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"number",value:k.height,onChange:q=>p(v=>j(g({},v),{height:Number(q.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"QR (mm)"}),e.jsx("input",{type:"number",value:k.qrSize,onChange:q=>p(v=>j(g({},v),{qrSize:Number(q.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Ustunlar"}),e.jsx("input",{type:"number",value:k.columns,onChange:q=>p(v=>j(g({},v),{columns:Number(q.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showPrice",checked:k.showPrice,onChange:q=>p(v=>j(g({},v),{showPrice:q.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"showPrice",className:"text-sm",children:"Narx"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showCode",checked:k.showCode,onChange:q=>p(v=>j(g({},v),{showCode:q.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"showCode",className:"text-sm",children:"Kod"})]})]})}),e.jsxs("div",{className:"p-3 border-b border-surface-200 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-surface-500",children:"Barchasi uchun:"}),[1,2,5,10].map(q=>e.jsxs("button",{onClick:()=>i(q),className:"px-3 py-1 text-sm bg-surface-100 hover:bg-surface-200 rounded-lg transition-colors",children:[q," ta"]},q))]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:r.length===0?e.jsx("div",{className:"text-center py-12 text-surface-500",children:"Mahsulotlar yo'q"}):e.jsx("div",{className:"space-y-2",children:r.map((q,v)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-surface-50 rounded-xl",children:[e.jsx("img",{src:q.qrDataUrl,alt:"QR",className:"w-12 h-12 rounded border border-surface-200"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-surface-900 truncate",children:q.product.name}),e.jsxs("div",{className:"text-sm text-surface-500",children:["Kod: ",q.product.code," â€¢ ",b(q.product.price)," so'm"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>y(v,-1),className:"w-8 h-8 flex items-center justify-center bg-surface-200 hover:bg-surface-300 rounded-lg transition-colors",children:e.jsx(ht,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:q.copies,onChange:Q=>N(v,Number(Q.target.value)),className:"w-14 text-center px-2 py-1 border border-surface-200 rounded-lg",min:1,max:100}),e.jsx("button",{onClick:()=>y(v,1),className:"w-8 h-8 flex items-center justify-center bg-surface-200 hover:bg-surface-300 rounded-lg transition-colors",children:e.jsx(ds,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>D(v),className:"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(fe,{className:"w-4 h-4"})})]},q.product._id))})}),e.jsxs("div",{className:"p-4 border-t border-surface-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-surface-500",children:["Jami: ",e.jsx("span",{className:"font-bold text-surface-900",children:T()})," ta label"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 text-surface-600 hover:bg-surface-100 rounded-xl transition-colors",children:"Bekor qilish"}),e.jsxs("button",{onClick:M,disabled:r.length===0,className:"px-6 py-2 bg-brand-600 text-white rounded-xl font-medium hover:bg-brand-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(Gs,{className:"w-4 h-4"}),"Chop etish"]})]})]})]})})},as={log:(...a)=>{},error:(...a)=>{console.error(...a)},warn:(...a)=>{},info:(...a)=>{},debug:(...a)=>{}};function Vr(){const{showAlert:a,showConfirm:n,AlertComponent:r}=Ns(),[u,l]=t.useState([]),[h,k]=t.useState(1),[p,z]=t.useState(1),[$,b]=t.useState(0),[f,y]=t.useState(!1),[N,D]=t.useState(null),[i,T]=t.useState(!1),[M,q]=t.useState(!1),[v,Q]=t.useState(!1),[V,K]=t.useState(!1),[le,oe]=t.useState(new Set),[O,ke]=t.useState(!1),[ee,ve]=t.useState(!1),[X,Z]=t.useState(null),[L,xe]=t.useState(!1),[I,de]=t.useState("7"),[ue,F]=t.useState({total:0,lowStock:0,outOfStock:0,totalValue:0}),[S,be]=t.useState(null),[W,Se]=t.useState(null),[Be,We]=t.useState(""),[Qe,Ge]=t.useState(""),[Fe,Ve]=t.useState("all"),[m,te]=t.useState(!0),[Ce,ze]=t.useState(!1),[ne,Ze]=t.useState(12500),[x,ce]=t.useState(!1),[$e,Ee]=t.useState("add"),[Ne,De]=t.useState(""),B=t.useRef(null);t.useEffect(()=>{const s=setTimeout(()=>{Ge(Be)},300);return()=>clearTimeout(s)},[Be]),t.useEffect(()=>(i||M||v||ee||x||V?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[i,M,v,ee,x,V]);const[c,H]=t.useState({code:"",name:"",description:"",quantity:"",previousPrice:"",currentPrice:"",costPrice:"",costPriceInDollar:"",unitPrice:"",boxPrice:"",pricingTiers:{tier1:{minQuantity:"1",maxQuantity:"5",discountPercent:"15"},tier2:{minQuantity:"6",maxQuantity:"20",discountPercent:"13"},tier3:{minQuantity:"21",maxQuantity:"100",discountPercent:"11"}},unit:"dona",dimensions:{width:"",height:"",length:""},metersPerRoll:"",unitsPerBox:"",meterPriceRanges:[{from:"",to:"",price:""}],pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),[he,we]=t.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[ye,C]=t.useState([]),[Y,re]=t.useState([]),[ge,ss]=t.useState(""),[ps,_e]=t.useState(!1),ms=t.useRef(null),Ls=()=>{if(!S)return;const s=document.getElementById("qr-code-svg");if(!s)return;const d=new XMLSerializer().serializeToString(s),P=document.createElement("canvas"),A=P.getContext("2d"),G=document.createElement("img");G.onload=()=>{P.width=G.width,P.height=G.height,A==null||A.drawImage(G,0,0);const se=P.toDataURL("image/png"),U=document.createElement("a");U.download=`QR-${S.code}-${S.name}.png`,U.href=se,U.click()},G.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(d)))},Ks=s=>E(this,null,function*(){if(s)try{const d=(W==null?void 0:W._id)||"";(yield _.get(`/products/check-code/${s}${d?`?excludeId=${d}`:""}`)).data.exists?ss(`Kod "${s}" allaqachon mavjud`):ss("")}catch(d){as.error("Error checking code:",d),a("Kod tekshirishda xatolik","Xatolik","danger")}}),R=t.useMemo(()=>!Qe&&Fe==="all"?u:u.filter(s=>{const d=!Qe||s.name.toLowerCase().includes(Qe.toLowerCase())||s.code.toLowerCase().includes(Qe.toLowerCase()),P=Fe==="all"||Fe==="low"&&s.quantity<=(s.minStock||50)&&s.quantity>0||Fe==="out"&&s.quantity===0;return d&&P}),[u,Qe,Fe]),ae=t.useCallback((s=1)=>E(this,null,function*(){var A,G,se,U,ie;const d=performance.now();/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&console.log("ðŸŽ Safari browser aniqlandi - maxsus optimizatsiyalar faol");try{s===1?te(!0):y(!0);const pe=Date.now(),qe=yield _.get(`/products?page=${s}&limit=20&t=${pe}`),Re=qe.data.data||[],Pe=qe.data.pagination||{};console.log(`ðŸ“¦ Sahifa ${s}: ${Re.length} ta mahsulot keldi`);const cs=Re.filter(ts=>!ts||!ts._id?(console.warn("âš ï¸ Mahsulot ID yo'q:",ts),!1):!ts.name||ts.name.trim()===""?(console.warn("âš ï¸ Mahsulot nomi yo'q:",ts._id),!1):!0),$s=Re.length-cs.length;$s>0&&console.warn(`âš ï¸ Sahifa ${s}: ${$s} ta invalid mahsulot o'tkazib yuborildi`);const zs=performance.now()-d;if(console.log(`âš¡ Sahifa ${s}: ${cs.length}/${Re.length} ta maxsulot ${Math.round(zs)}ms da yuklandi`),console.log(`ðŸ“Š Pagination: Sahifa ${Pe.page}/${Pe.pages}, Jami: ${Pe.total}`),l(s===1?cs:ts=>[...ts,...cs]),k(Pe.page||1),z(Pe.pages||1),b(Pe.total||0),s===1){const ts=()=>{const qs={total:Pe.total||0,lowStock:cs.filter(us=>us.quantity<=(us.minStock||50)&&us.quantity>0).length,outOfStock:cs.filter(us=>us.quantity===0).length,totalValue:cs.reduce((us,Xe)=>{let Ts=0;return Xe.currentPrice&&Xe.currentPrice>0?Ts=Xe.currentPrice:Xe.unitPrice&&Xe.unitPrice>0?Ts=Xe.unitPrice:Xe.price&&Xe.price>0?Ts=Xe.price:Xe.boxPrice&&Xe.boxPrice>0&&Xe.unitsPerBox&&Xe.unitsPerBox>0?Ts=Xe.boxPrice/Xe.unitsPerBox:Xe.previousPrice&&Xe.previousPrice>0&&(Ts=Xe.previousPrice),us+Ts*(Xe.quantity||0)},0)};console.log("ðŸ’° Client-side jami qiymat:",qs.totalValue),F(qs)};typeof requestIdleCallback!="undefined"?requestIdleCallback(ts,{timeout:2e3}):setTimeout(ts,100)}}catch(pe){console.error("âŒ Mahsulotlarni yuklashda xatolik:",pe),console.error("Error details:",{message:pe.message,response:(A=pe.response)==null?void 0:A.data,status:(G=pe.response)==null?void 0:G.status,stack:pe.stack});const qe=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let Re=((U=(se=pe.response)==null?void 0:se.data)==null?void 0:U.message)||pe.message||"Maxsulotlarni yuklashda xatolik";qe&&((ie=pe.message)!=null&&ie.includes("Network"))&&(Re="Internet aloqasini tekshiring. Safari'da ba'zan aloqa muammolari bo'lishi mumkin."),a(Re,"Xatolik","danger"),s===1&&(l([]),F({total:0,lowStock:0,outOfStock:0,totalValue:0}))}finally{te(!1),y(!1)}}),[a]);t.useEffect(()=>{Je(),ae(1);const s=setTimeout(()=>{je()},1e3);return()=>clearTimeout(s)},[ae]);const je=()=>E(this,null,function*(){if(!L){xe(!0);try{console.log("ðŸ“Š Statistika yuklanmoqda...");const s=yield _.get("/products/overall-stats");console.log("ðŸ“Š Server statistikasi:",s.data),console.log("ðŸ’° Jami qiymat:",s.data.totalValue),F(s.data)}catch(s){console.error("Statistikani yuklashda xatolik:",s),s.code==="ECONNABORTED"&&console.warn("âš ï¸ Statistika yuklash juda uzoq davom etdi, keyinroq qayta uriniladi")}finally{xe(!1)}}});t.useEffect(()=>{if(h===1&&p>1&&!f){console.log(`ðŸ”„ Background: Qolgan ${p-1} ta sahifa yuklanmoqda...`);const s=setTimeout(()=>E(this,null,function*(){y(!0);for(let d=2;d<=p;d++){console.log(`ðŸ“¥ Sahifa ${d}/${p} yuklanmoqda...`);try{const G=((yield _.get(`/products?page=${d}&limit=20&t=${Date.now()}`)).data.data||[]).filter(se=>!(!se||!se._id||!se.name||se.name.trim()===""));l(se=>{const U=new Set(se.map(pe=>pe._id)),ie=G.filter(pe=>!U.has(pe._id));return[...se,...ie]}),k(d),yield new Promise(se=>setTimeout(se,200))}catch(P){console.error(`âŒ Sahifa ${d} yuklashda xatolik:`,P)}}y(!1),console.log(`âœ… Barcha ${p} ta sahifa yuklandi!`)}),500);return()=>clearTimeout(s)}},[h,p,f]);const Te=t.useCallback(()=>{},[]);t.useEffect(()=>{(Qe||Fe!=="all")&&(l([]),k(1),ae(1))},[Qe,Fe,ae]),t.useEffect(()=>{const s=B.current;if(s)return s.addEventListener("scroll",Te),()=>s.removeEventListener("scroll",Te)},[Te]),t.useEffect(()=>{as.log("Products state updated:",{count:u.length,firstProduct:u.length>0?{_id:u[0]._id,name:u[0].name,code:u[0].code}:null})},[u]);const Je=()=>E(this,null,function*(){try{const s=Date.now(),d=yield _.get(`/warehouses?t=${s}`),A=(Array.isArray(d.data)?d.data:[]).find(G=>G.name==="Asosiy ombor");if(A)D(A);else{const G=yield _.post("/warehouses",{name:"Asosiy ombor",address:""});D(G.data)}}catch(s){as.error("Error fetching warehouses:",s),a("Omborlarni yuklashda xatolik","Xatolik","danger"),te(!1)}}),Oe=s=>new Promise((d,P)=>{const A=new FileReader;A.readAsDataURL(s),A.onload=G=>{var U;const se=new Image;se.src=(U=G.target)==null?void 0:U.result,se.onload=()=>{const ie=document.createElement("canvas");let pe=se.width,qe=se.height;if(pe>1920||qe>1920){const Pe=Math.min(1920/pe,1920/qe);pe=Math.round(pe*Pe),qe=Math.round(qe*Pe)}ie.width=pe,ie.height=qe;const Re=ie.getContext("2d");if(!Re){P(new Error("Canvas context not available"));return}Re.drawImage(se,0,0,pe,qe),ie.toBlob(Pe=>{Pe?d(Pe):P(new Error("Canvas to blob failed"))},"image/jpeg",.8)},se.onerror=()=>P(new Error("Image load failed"))},A.onerror=()=>P(new Error("File read failed"))}),o=s=>E(this,null,function*(){const d=s.target.files;if(!d||d.length===0)return;const P=8-ye.length;if(P<=0){a("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const A=["image/jpeg","image/jpg","image/png","image/webp"],G=Array.from(d).filter(ie=>A.includes(ie.type)?!0:(a(`${ie.name} - noto'g'ri format. Faqat JPG, PNG, WebP qabul qilinadi`,"Xatolik","warning"),!1));if(G.length===0)return;const se=G.slice(0,P),U=new FormData;ze(!0);try{for(const qe of se)try{const Re=yield Oe(qe);U.append("images",Re,qe.name)}catch(Re){as.warn(`Image compression failed for ${qe.name}, uploading original:`,Re),U.append("images",qe)}const ie=yield _.post("/products/upload-images",U,{headers:{"Content-Type":"multipart/form-data"}}),pe=(ie.data.images||[]).map(qe=>typeof qe=="string"?qe:qe.path);re([...Y,...pe]),C([...ye.map(qe=>typeof qe=="string"?qe:qe.path),...pe]),a(`${ie.data.images.length} ta rasm muvaffaqiyatli yuklandi`,"Muvaffaqiyat","success")}catch(ie){as.error("Error uploading images:",ie),a("Rasmlarni yuklashda xatolik","Xatolik","danger")}finally{ze(!1),ms.current&&(ms.current.value="")}}),J=s=>E(this,null,function*(){var d,P,A;try{console.log("ðŸ—‘ï¸ Removing image:",{imagePath:s,isNewlyUploaded:Y.includes(s)});const G=ye.map(U=>typeof U=="string"?U:U.path).filter(U=>U!==s);if(C(G),Y.includes(s)){re(Y.filter(U=>U!==s)),a("Rasm o'chirildi (hali saqlanmagan)","Ma'lumot","info");try{yield _.delete("/products/delete-image",{data:{imagePath:s,productId:void 0}}),console.log("âœ… Yangi yuklangan rasm serverdan ham o'chirildi")}catch(U){console.warn("Yangi yuklangan rasmni serverdan o'chirishda xatolik:",U)}return}const se=W==null?void 0:W._id;if(se)try{yield _.delete("/products/delete-image",{data:{imagePath:s,productId:se}}),a("Rasm o'chirildi","Muvaffaqiyat","success")}catch(U){console.warn("Server xatosi:",U),((d=U.response)==null?void 0:d.status)===404?a("Rasm local state dan o'chirildi","Ma'lumot","info"):a("Rasm local state dan o'chirildi, lekin serverda xatolik","Ogohlantirish","warning")}else a("Rasm o'chirildi","Muvaffaqiyat","success")}catch(G){as.error("Error deleting image:",G);const se=((A=(P=G.response)==null?void 0:P.data)==null?void 0:A.message)||G.message||"Rasmni o'chirishda xatolik";a(se,"Xatolik","danger")}}),me=s=>{if(s.images&&s.images.length>0){let d=typeof s.images[0]=="string"?s.images[0]:s.images[0].path;if(d.startsWith("http://")||d.startsWith("https://"))try{d=new URL(d).pathname}catch(P){console.warn("Invalid image URL:",d)}return d.startsWith("/")||(d="/"+d),`${Bs}${d}`}return null},Me=s=>E(this,null,function*(){var se,U,ie,pe,qe;if(s.preventDefault(),as.log("Form submit boshlandi. Ma'lumotlar:",{code:c.code,name:c.name,unitPrice:c.unitPrice,currentPrice:c.currentPrice,codeError:ge}),ge){as.error("Kod xatosi:",ge),a(ge,"Xatolik","danger");return}if(!c.name||!c.name.trim()){as.error("Tovar nomi bo'sh"),a("Tovar nomi majburiy","Xatolik","danger");return}if(!c.unitPrice&&!c.currentPrice){as.error("Narx bo'sh"),a("Tovar narxi majburiy","Xatolik","danger");return}let d=Number(c.quantity),P=null;if(ps&&he.packageCount&&he.unitsPerPackage){const Re=Number(he.packageCount)*Number(he.unitsPerPackage);d=W?Number(c.quantity)+Re:Re,P={packageCount:Number(he.packageCount),unitsPerPackage:Number(he.unitsPerPackage),totalUnits:Re}}let A=0,G=0;c.unit==="rulon"&&c.metersPerRoll&&(A=d*Number(c.metersPerRoll)),c.unit==="karobka"&&c.unitsPerBox&&(G=d*Number(c.unitsPerBox));try{const Re={code:c.code,name:c.name,description:c.description||"",price:Number(c.unitPrice)||Number(c.currentPrice),costPrice:Number(c.costPrice)||0,unitPrice:Number(c.unitPrice)||Number(c.currentPrice)||0,boxPrice:Number(c.boxPrice)||0,previousPrice:Number(c.previousPrice)||0,currentPrice:Number(c.currentPrice)||0,pricingTiers:{tier1:{minQuantity:Number(c.pricingTiers.tier1.minQuantity)||1,maxQuantity:Number(c.pricingTiers.tier1.maxQuantity)||5,discountPercent:Number(c.pricingTiers.tier1.discountPercent)||15},tier2:{minQuantity:Number(c.pricingTiers.tier2.minQuantity)||6,maxQuantity:Number(c.pricingTiers.tier2.maxQuantity)||20,discountPercent:Number(c.pricingTiers.tier2.discountPercent)||13},tier3:{minQuantity:Number(c.pricingTiers.tier3.minQuantity)||21,maxQuantity:Number(c.pricingTiers.tier3.maxQuantity)||100,discountPercent:Number(c.pricingTiers.tier3.discountPercent)||11}},quantity:d,warehouse:N==null?void 0:N._id,images:ye,packageInfo:P,unit:c.unit,costPriceInDollar:Number(c.costPriceInDollar)||0,dollarRate:ne,dimensions:{width:c.dimensions.width||"",height:c.dimensions.height||"",length:c.dimensions.length||""},metersPerRoll:Number(c.metersPerRoll)||0,unitsPerBox:Number(c.unitsPerBox)||0,totalMeters:A,totalUnits:G,meterPriceRanges:c.meterPriceRanges.filter(Pe=>Pe.from&&Pe.to&&Pe.price).map(Pe=>({from:Number(Pe.from),to:Number(Pe.to),price:Number(Pe.price)})),prices:{perUnit:Number(c.unitPrice)||Number(c.currentPrice),perRoll:Number(c.pricePerRoll)||0,perBox:Number(c.boxPrice)||Number(c.pricePerBox)||0,perKg:Number(c.pricePerKg)||0,perGram:Number(c.pricePerGram)||0}};if(as.log("Tovar serverga yuborilmoqda:",{code:Re.code,name:Re.name,warehouse:Re.warehouse,quantity:Re.quantity,price:Re.price}),W){const Pe=yield _.put(`/products/${W._id}`,Re);if(as.log("Tovar yangilandi:",W._id),Pe.data&&Pe.data._id){const cs=j(g({},Pe.data),{warehouse:Pe.data.warehouse||N,images:Pe.data.images||ye||[]});l($s=>{const zs=$s.map(ts=>ts._id===W._id?cs:ts);return zs.sort((ts,qs)=>{const us=parseInt(ts.code)||0,Xe=parseInt(qs.code)||0;return us===0&&Xe===0?String(ts.code).localeCompare(String(qs.code)):us-Xe}),zs}),as.log("Tovar darhol UI da yangilandi:",Pe.data.name)}}else{const Pe=yield _.post("/products",Re);if(as.log("Tovar serverdan qaytdi:",Pe.data),as.log("Tovar rasmlar:",Pe.data.images),Pe.data&&Pe.data._id){const cs=j(g({},Pe.data),{warehouse:Pe.data.warehouse||N,images:Pe.data.images||ye||[]});as.log("UI ga qo'shilayotgan tovar:",{_id:cs._id,name:cs.name,images:cs.images,imagesCount:((se=cs.images)==null?void 0:se.length)||0}),l($s=>{const zs=[...$s,cs];return zs.sort((ts,qs)=>{const us=parseInt(ts.code)||0,Xe=parseInt(qs.code)||0;return us===0&&Xe===0?String(ts.code).localeCompare(String(qs.code)):us-Xe}),zs}),as.log("Yangi tovar darhol UI ga qo'shildi:",Pe.data.name),We(""),Ve("all")}}ns(),fs(),a(W?"Tovar yangilandi":"Tovar qo'shildi","Muvaffaqiyat","success"),je()}catch(Re){as.error("Error adding/updating product:",Re);const Pe=((ie=(U=Re.response)==null?void 0:U.data)==null?void 0:ie.message)||Re.message||"Xatolik yuz berdi";as.error("Error details:",{status:(pe=Re.response)==null?void 0:pe.status,message:Pe,data:(qe=Re.response)==null?void 0:qe.data}),a(Pe,"Xatolik","danger")}}),Ke=s=>E(this,null,function*(){if(yield n("Tovarni o'chirishni tasdiqlaysizmi?","O'chirish"))try{yield _.delete(`/products/${s}`),l(P=>P.filter(A=>A._id!==s)),as.log("Tovar UI dan o'chirildi:",s),a("Tovar o'chirildi","Muvaffaqiyat","success"),je()}catch(P){as.error("Error deleting product:",P),a("Tovarni o'chirishda xatolik","Xatolik","danger")}}),Ae=s=>{var P,A,G,se,U,ie,pe,qe,Re,Pe,cs,$s,zs,ts,qs,us,Xe,Ts,ft,gt,bt,jt,vt,wt,Nt,Ue;Se(s);const d=s;Ze(d.dollarRate||12500),H({code:s.code,name:s.name,description:d.description||"",previousPrice:String(d.previousPrice||0),currentPrice:String(d.currentPrice||s.price),costPrice:String(d.costPrice||0),costPriceInDollar:String(d.costPriceInDollar||0),unitPrice:String(d.unitPrice||d.currentPrice||s.price),boxPrice:String(d.boxPrice||0),pricingTiers:{tier1:{minQuantity:String(((A=(P=d.pricingTiers)==null?void 0:P.tier1)==null?void 0:A.minQuantity)||1),maxQuantity:String(((se=(G=d.pricingTiers)==null?void 0:G.tier1)==null?void 0:se.maxQuantity)||5),discountPercent:String(((ie=(U=d.pricingTiers)==null?void 0:U.tier1)==null?void 0:ie.discountPercent)||15)},tier2:{minQuantity:String(((qe=(pe=d.pricingTiers)==null?void 0:pe.tier2)==null?void 0:qe.minQuantity)||6),maxQuantity:String(((Pe=(Re=d.pricingTiers)==null?void 0:Re.tier2)==null?void 0:Pe.maxQuantity)||20),discountPercent:String((($s=(cs=d.pricingTiers)==null?void 0:cs.tier2)==null?void 0:$s.discountPercent)||13)},tier3:{minQuantity:String(((ts=(zs=d.pricingTiers)==null?void 0:zs.tier3)==null?void 0:ts.minQuantity)||21),maxQuantity:String(((us=(qs=d.pricingTiers)==null?void 0:qs.tier3)==null?void 0:us.maxQuantity)||100),discountPercent:String(((Ts=(Xe=d.pricingTiers)==null?void 0:Xe.tier3)==null?void 0:Ts.discountPercent)||11)}},quantity:String(s.quantity),unit:s.unit||"dona",dimensions:{width:((ft=d.dimensions)==null?void 0:ft.width)||"",height:((gt=d.dimensions)==null?void 0:gt.height)||"",length:((bt=d.dimensions)==null?void 0:bt.length)||""},metersPerRoll:String(d.metersPerRoll||""),unitsPerBox:String(d.unitsPerBox||""),meterPriceRanges:((jt=d.meterPriceRanges)==null?void 0:jt.length)>0?d.meterPriceRanges.map(Us=>({from:String(Us.from||""),to:String(Us.to||""),price:String(Us.price||"")})):[{from:"",to:"",price:""}],pricePerRoll:String(((vt=s.prices)==null?void 0:vt.perRoll)||""),pricePerBox:String(((wt=s.prices)==null?void 0:wt.perBox)||""),pricePerKg:String(((Nt=s.prices)==null?void 0:Nt.perKg)||""),pricePerGram:String(((Ue=s.prices)==null?void 0:Ue.perGram)||"")}),C((d.images||[]).map(Us=>typeof Us=="string"?Us:Us.path)),we({packageCount:"",unitsPerPackage:"",totalCost:""}),ss(""),_e(!1),T(!0)},Le=s=>{be(s),q(!0)},os=s=>{oe(d=>{const P=new Set(d);return P.has(s)?P.delete(s):P.add(s),P})},ys=()=>{le.size===R.length?oe(new Set):oe(new Set(R.map(s=>s._id)))},xs=()=>{if(le.size===0){a("Kamida bitta mahsulot tanlang","Ogohlantirish","warning");return}Q(!0)},ks=()=>{ke(!1),oe(new Set)},Ss=s=>E(this,null,function*(){var d,P,A,G,se,U,ie,pe,qe,Re,Pe,cs,$s,zs,ts,qs,us,Xe,Ts,ft,gt,bt,jt,vt,wt,Nt;try{T(!0),Se(null);const Ue=s;Ze(Ue.dollarRate||12500);const Us=_.get("/products/next-code");H({code:"",name:s.name,description:Ue.description||"",previousPrice:String(Ue.previousPrice||0),currentPrice:String(Ue.currentPrice||s.price),costPrice:String(Ue.costPrice||0),costPriceInDollar:String(Ue.costPriceInDollar||0),unitPrice:String(Ue.unitPrice||Ue.currentPrice||s.price),boxPrice:String(Ue.boxPrice||0),pricingTiers:{tier1:{minQuantity:String(((P=(d=Ue.pricingTiers)==null?void 0:d.tier1)==null?void 0:P.minQuantity)||1),maxQuantity:String(((G=(A=Ue.pricingTiers)==null?void 0:A.tier1)==null?void 0:G.maxQuantity)||5),discountPercent:String(((U=(se=Ue.pricingTiers)==null?void 0:se.tier1)==null?void 0:U.discountPercent)||15)},tier2:{minQuantity:String(((pe=(ie=Ue.pricingTiers)==null?void 0:ie.tier2)==null?void 0:pe.minQuantity)||6),maxQuantity:String(((Re=(qe=Ue.pricingTiers)==null?void 0:qe.tier2)==null?void 0:Re.maxQuantity)||20),discountPercent:String(((cs=(Pe=Ue.pricingTiers)==null?void 0:Pe.tier2)==null?void 0:cs.discountPercent)||13)},tier3:{minQuantity:String(((zs=($s=Ue.pricingTiers)==null?void 0:$s.tier3)==null?void 0:zs.minQuantity)||21),maxQuantity:String(((qs=(ts=Ue.pricingTiers)==null?void 0:ts.tier3)==null?void 0:qs.maxQuantity)||100),discountPercent:String(((Xe=(us=Ue.pricingTiers)==null?void 0:us.tier3)==null?void 0:Xe.discountPercent)||11)}},quantity:"0",unit:s.unit||"dona",dimensions:{width:((Ts=Ue.dimensions)==null?void 0:Ts.width)||"",height:((ft=Ue.dimensions)==null?void 0:ft.height)||"",length:((gt=Ue.dimensions)==null?void 0:gt.length)||""},metersPerRoll:String(Ue.metersPerRoll||""),unitsPerBox:String(Ue.unitsPerBox||""),meterPriceRanges:((bt=Ue.meterPriceRanges)==null?void 0:bt.length)>0?Ue.meterPriceRanges.map(Is=>({from:String(Is.from||""),to:String(Is.to||""),price:String(Is.price||"")})):[{from:"",to:"",price:""}],pricePerRoll:String(((jt=s.prices)==null?void 0:jt.perRoll)||""),pricePerBox:String(((vt=s.prices)==null?void 0:vt.perBox)||""),pricePerKg:String(((wt=s.prices)==null?void 0:wt.perKg)||""),pricePerGram:String(((Nt=s.prices)==null?void 0:Nt.perGram)||"")}),C((Ue.images||[]).map(Is=>typeof Is=="string"?Is:Is.path)),we({packageCount:"",unitsPerPackage:"",totalCost:""}),ss(""),_e(!1);try{const Is=yield Us;H(Ia=>j(g({},Ia),{code:Is.data.code}))}catch(Is){as.error("Error getting next code:",Is),a("Keyingi kodni olishda xatolik","Xatolik","danger")}a("Mahsulot nusxalandi. Kerakli o'zgarishlarni kiriting va saqlang.","Muvaffaqiyat","success")}catch(Ue){as.error("Error copying product:",Ue),a("Mahsulotni nusxalashda xatolik","Xatolik","danger")}}),js=s=>E(this,null,function*(){if(S){de(s),xe(!0);try{const d=yield _.get(`/products/stats/${S._id}?period=${s}`);Z(d.data)}catch(d){as.error("Error fetching product stats:",d),a("Statistikani yuklashda xatolik","Xatolik","danger")}finally{xe(!1)}}}),ns=()=>{T(!1)},fs=()=>{Se(null),Ze(12500),C([]),ss(""),_e(!1),H({code:"",name:"",description:"",quantity:"",previousPrice:"",currentPrice:"",costPrice:"",costPriceInDollar:"",unitPrice:"",boxPrice:"",pricingTiers:{tier1:{minQuantity:"1",maxQuantity:"5",discountPercent:"15"},tier2:{minQuantity:"6",maxQuantity:"20",discountPercent:"13"},tier3:{minQuantity:"21",maxQuantity:"100",discountPercent:"11"}},unit:"dona",dimensions:{width:"",height:"",length:""},metersPerRoll:"",unitsPerBox:"",meterPriceRanges:[{from:"",to:"",price:""}],pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),we({packageCount:"",unitsPerPackage:"",totalCost:""}),C([]),re([]),ss(""),_e(!1)},vs=s=>{Ee(s),De(""),ce(!0)},Cs=()=>{const s=Number(Ne)||0;if(s<=0)return;const d=Number(c.quantity)||0;let P=$e==="add"?d+s:d-s;P<0&&(P=0),H(j(g({},c),{quantity:String(P)})),ce(!1),De("")},pt=()=>E(this,null,function*(){fs(),T(!0),C([]),ss(""),_e(!1);try{const s=yield _.get("/products/next-code");H(d=>j(g({},d),{code:s.data.code}))}catch(s){as.error("Error getting next code:",s),a("Keyingi kodni olishda xatolik","Xatolik","danger")}}),lt=t.useMemo(()=>({total:ue.total||u.length||0,lowStock:ue.lowStock||0,outOfStock:ue.outOfStock||0,totalValue:ue.totalValue||0}),[ue,u.length]),Ut=[{label:"Jami tovarlar",value:lt.total,icon:Ie,color:"brand",filter:"all"},{label:"Kam qolgan",value:lt.lowStock,icon:Ms,color:"warning",filter:"low"},{label:"Tugagan",value:lt.outOfStock,icon:fe,color:"danger",filter:"out"},{label:"Jami qiymat",value:`${w(lt.totalValue)} so'm`,icon:is,color:"success",filter:null}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100 pb-20 lg:pb-0",children:[r,e.jsx(Fs,{title:"Tovarlar",showSearch:!0,onSearch:We,actions:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>ae(),className:"flex items-center justify-center p-0.5 rounded bg-purple-50 hover:bg-purple-100 text-purple-600 hover:text-purple-700 transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Tovarlarni qayta yuklash",children:e.jsx(yt,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),O?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ys,className:"flex items-center justify-center px-2 py-0.5 rounded text-xs bg-purple-50 hover:bg-purple-100 text-purple-600 hover:text-purple-700 transition-all duration-200 flex-shrink-0 font-medium",style:{height:"24px",minHeight:"24px"},children:le.size===R.length?"Bekor":"Barchasi"}),e.jsxs("button",{onClick:xs,className:"flex items-center justify-center gap-1 px-2 py-0.5 rounded text-xs bg-brand-500 hover:bg-brand-600 text-white transition-all duration-200 flex-shrink-0 font-medium disabled:opacity-50 disabled:cursor-not-allowed",style:{height:"24px",minHeight:"24px"},disabled:le.size===0,children:[e.jsx(Gs,{className:"w-3 h-3",style:{width:"12px",height:"12px"}}),e.jsx("span",{children:le.size})]}),e.jsx("button",{onClick:ks,className:"flex items-center justify-center p-0.5 rounded bg-surface-200 hover:bg-surface-300 transition-all duration-200 flex-shrink-0",style:{width:"24px",height:"24px",minWidth:"24px",minHeight:"24px"},children:e.jsx(fe,{className:"w-3 h-3",style:{width:"12px",height:"12px"}})})]}):e.jsx("button",{onClick:()=>ke(!0),className:"flex items-center justify-center p-0.5 rounded bg-blue-50 hover:bg-blue-100 text-blue-600 hover:text-blue-700 transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Bir nechta QR chiqarish",children:e.jsx(Va,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),e.jsx("button",{onClick:pt,className:"flex items-center justify-center p-0.5 rounded bg-brand-500 hover:bg-brand-600 text-white transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},children:e.jsx(ds,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})})]})}),e.jsxs("div",{className:"p-2 sm:p-3 md:p-4 lg:p-6 space-y-3 sm:space-y-4 md:space-y-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-2 sm:gap-2.5 md:gap-3",children:Ut.map((s,d)=>e.jsx("div",{onClick:()=>s.filter&&Ve(s.filter),className:`bg-white rounded-lg sm:rounded-xl border-2 transition-all ${s.filter?"cursor-pointer hover:shadow-lg hover:scale-[1.02]":""} ${Fe===s.filter?"border-brand-500 shadow-md":"border-surface-200"}`,children:e.jsxs("div",{className:"p-2 sm:p-2.5 md:p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-1.5 sm:mb-2",children:[e.jsx("div",{className:`w-7 h-7 sm:w-8 sm:h-8 md:w-9 md:h-9 rounded-lg flex items-center justify-center bg-${s.color}-50`,children:e.jsx(s.icon,{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-4.5 md:h-4.5 text-${s.color}-600`})}),e.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs text-surface-500 font-medium",children:s.label})]}),e.jsx("p",{className:"text-sm sm:text-base md:text-lg lg:text-xl font-bold text-surface-900",children:s.value})]})},d))}),m?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):R.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Ie,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Tovarlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md mb-6",children:Be?"Qidiruv bo'yicha tovarlar topilmadi":"Birinchi tovarni qo'shing"}),e.jsx("button",{onClick:pt,className:"btn-primary",children:"Tovar qo'shish"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:B,className:"space-y-2 sm:space-y-2.5 md:space-y-3",children:R.map(s=>{const d=le.has(s._id),P=me(s);return e.jsxs("div",{className:`group relative bg-white rounded-lg sm:rounded-xl transition-all duration-200 hover:shadow-lg ${d?"shadow-md ring-2 ring-brand-500":"shadow-sm hover:shadow-md"}`,children:[e.jsxs("div",{className:"absolute top-1.5 right-1.5 flex items-center gap-1 z-10",children:[e.jsx("button",{onClick:A=>{A.stopPropagation(),Ss(s)},className:"w-7 h-7 sm:w-8 sm:h-8 bg-blue-50 hover:bg-blue-100 rounded-lg transition-none text-blue-600 flex items-center justify-center hover:scale-110 shadow-sm hover:shadow-md",title:"Mahsulotni nusxalash",children:e.jsx(Na,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),Le(s)},className:"w-7 h-7 sm:w-8 sm:h-8 bg-purple-50 hover:bg-purple-100 rounded-lg transition-none text-purple-600 flex items-center justify-center hover:scale-110 shadow-sm hover:shadow-md",title:"QR kod",children:e.jsx(xt,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),Ae(s)},className:"w-7 h-7 sm:w-8 sm:h-8 bg-amber-50 hover:bg-amber-100 rounded-lg transition-none text-amber-600 flex items-center justify-center hover:scale-110 shadow-sm hover:shadow-md",title:"Tahrirlash",children:e.jsx(tt,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),Ke(s._id)},className:"w-7 h-7 sm:w-8 sm:h-8 bg-red-50 hover:bg-red-100 rounded-lg transition-none text-red-600 flex items-center justify-center hover:scale-110 shadow-sm hover:shadow-md",title:"O'chirish",children:e.jsx(Ps,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5"})})]}),O&&e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx("input",{type:"checkbox",checked:d,onChange:()=>os(s._id),className:"w-4 h-4 sm:w-5 sm:h-5 rounded border-2 cursor-pointer"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 md:gap-4 p-2 sm:p-3 md:p-4",children:[e.jsx("div",{className:"relative w-full sm:w-24 md:w-28 h-28 sm:h-24 md:h-28 rounded-lg sm:rounded-xl overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100 cursor-pointer flex-shrink-0 shadow-sm",onClick:()=>{P&&(be(s),K(!0))},children:P?e.jsx("img",{src:P,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Ie,{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 text-slate-300"})})}),e.jsxs("div",{className:"flex-1 min-w-0 px-2 pb-2 sm:p-0",children:[e.jsxs("div",{className:"text-xs sm:text-sm font-mono text-slate-500 mb-1 sm:mb-1.5",children:["#",s.code]}),e.jsxs("h3",{className:"font-semibold text-base sm:text-lg md:text-xl text-slate-900 mb-1.5 sm:mb-2 line-clamp-2",children:[s.name,s.description&&s.description.trim()&&e.jsx("span",{className:"text-base sm:text-lg md:text-xl font-semibold text-slate-900 ml-1.5",children:s.description})]}),e.jsxs("div",{className:"flex items-baseline gap-1 sm:gap-1.5",children:[e.jsx("span",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-brand-600",children:w(s.unitPrice||s.price)}),e.jsx("span",{className:"text-sm sm:text-base text-slate-500",children:"so'm"})]})]})]})]},s._id)})}),h>=p&&!f&&R.length>0&&e.jsx("div",{className:"flex justify-center items-center py-6 mt-4",children:e.jsxs("div",{className:"text-slate-400 text-sm",children:["âœ… Barcha maxsulotlar yuklandi (",$," ta)"]})})]})]}),i&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-3 sm:p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/70 via-purple-900/30 to-black/70 backdrop-blur-sm transition-opacity duration-100",onClick:ns,style:{animation:"fadeIn 0.1s ease-out"}}),e.jsxs("form",{onSubmit:Me,className:"relative z-10 bg-white rounded-3xl w-full max-w-xs sm:max-w-sm md:max-w-2xl max-h-[90vh] overflow-hidden shadow-[0_20px_60px_-15px_rgba(0,0,0,0.4)] border border-white/20 transform",style:{animation:"modalSlideUp 0.1s ease-out",willChange:"transform, opacity"},children:[e.jsx("div",{className:"sticky top-0 z-10 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 px-4 sm:px-6 py-4 sm:py-5 border-b border-white/20 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white flex items-center gap-2 mb-1",children:W?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(tt,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),"Tovarni tahrirlash"]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(ds,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),"Yangi tovar qo'shish"]})}),e.jsx("p",{className:"text-xs sm:text-sm text-white/90 font-medium",children:W?"Tovar ma'lumotlarini yangilang":"Yangi tovar ma'lumotlarini kiriting"})]}),e.jsx("button",{type:"button",onClick:ns,className:"p-2 sm:p-2.5 hover:bg-white/20 rounded-xl transition-all duration-300 hover:rotate-90 hover:scale-110 active:scale-95 group ml-3",children:e.jsx(fe,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white group-hover:text-white/90"})})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-180px)] p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Rasmlar (max 8 ta - JPG, PNG, WebP)"}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-1 sm:gap-2 mb-1 sm:mb-2",children:[ye.map((s,d)=>{let P=typeof s=="string"?s:s.path;if(P.startsWith("http://")||P.startsWith("https://"))try{P=new URL(P).pathname}catch(A){console.warn("Invalid image URL:",P)}return P.startsWith("/")||(P="/"+P),e.jsxs("div",{className:"relative aspect-square group bg-surface-100 rounded-lg overflow-hidden",children:[e.jsx("img",{src:`${Bs}${P}`,alt:`Rasm ${d+1}`,loading:"lazy",decoding:"async",className:"w-full h-full object-cover",style:{contentVisibility:"auto"}}),e.jsx("button",{type:"button",onClick:()=>J(P),className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2 w-7 h-7 sm:w-8 sm:h-8 bg-red-500 hover:bg-red-600 text-white rounded-lg sm:rounded-xl flex items-center justify-center shadow-lg hover:shadow-xl transition-all hover:scale-110 z-10 opacity-90 hover:opacity-100",title:"Rasmni o'chirish",children:e.jsx(fe,{className:"w-4 h-4 sm:w-5 sm:h-5",strokeWidth:2.5})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors pointer-events-none"})]},d)}),ye.length<8&&e.jsx("button",{type:"button",onClick:()=>{var s;return(s=ms.current)==null?void 0:s.click()},disabled:Ce,className:"aspect-square border-2 border-dashed border-surface-300 rounded-lg flex flex-col items-center justify-center hover:border-brand-500 hover:bg-brand-50 transition-colors cursor-pointer group disabled:opacity-50 disabled:cursor-not-allowed",children:Ce?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"spinner w-4 h-4 sm:w-5 sm:h-5 text-brand-600"}),e.jsx("span",{className:"text-[8px] sm:text-[9px] text-brand-600 font-semibold",children:"Yuklash..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-4 h-4 sm:w-5 sm:h-5 text-surface-400 mb-0.5 sm:mb-1 group-hover:text-brand-500 transition-colors"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-surface-500 text-center px-0.5 group-hover:text-brand-600 transition-colors",children:"Rasm"})]})})]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-surface-500 mb-2 sm:mb-3",children:"ðŸ’¡ Telefondan rasm olib qo'ysangiz, avtomatik sifati yaxshi bo'lib qo'yiladi. Bir vaqtning o'zida bir nechta rasmni yuklash mumkin."}),e.jsx("input",{ref:ms,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",multiple:!0,capture:"environment",onChange:o,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input text-sm ${ge?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"1",value:c.code,onChange:s=>H(j(g({},c),{code:s.target.value})),onBlur:s=>Ks(s.target.value),required:!0}),ge&&e.jsx("p",{className:"text-xs text-danger-600 mt-0.5 sm:mt-1",children:ge})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"Tovar nomi",value:c.name,onChange:s=>H(j(g({},c),{name:s.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Qisqacha izoh (ixtiyoriy)"}),e.jsx("textarea",{className:"input min-h-[60px] sm:min-h-[80px] resize-none text-sm",placeholder:"Mahsulot haqida qisqacha ma'lumot...",value:c.description||"",onChange:s=>H(j(g({},c),{description:s.target.value})),maxLength:500}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-surface-400 mt-0.5 sm:mt-1",children:[(c.description||"").length,"/500"]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 sm:pt-3 md:pt-4 mt-2 sm:mt-3 md:mt-4",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-semibold text-surface-900 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(ua,{className:"w-3 h-3 sm:w-4 sm:h-4 text-brand-600"}),"O'lchamlar (ixtiyoriy)"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Eni (sm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"50",value:c.dimensions.width,onChange:s=>H(j(g({},c),{dimensions:j(g({},c.dimensions),{width:s.target.value})}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:c.dimensions.height,onChange:s=>H(j(g({},c),{dimensions:j(g({},c.dimensions),{height:s.target.value})}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Uzunligi (sm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"100",value:c.dimensions.length,onChange:s=>H(j(g({},c),{dimensions:j(g({},c.dimensions),{length:s.target.value})}))})]})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 sm:pt-3 md:pt-4 mt-2 sm:mt-3 md:mt-4",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-semibold text-surface-900 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(ua,{className:"w-3 h-3 sm:w-4 sm:h-4 text-brand-600"}),"O'lchov birligi va Miqdor"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 mb-2 sm:mb-4",children:[e.jsxs("div",{className:"w-full sm:w-1/3",children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Birlik"}),e.jsxs("select",{className:"input text-sm",value:c.unit,onChange:s=>H(j(g({},c),{unit:s.target.value})),children:[e.jsx("option",{value:"dona",children:"Dona"}),e.jsx("option",{value:"metr",children:"Metr"}),e.jsx("option",{value:"rulon",children:"Rulon"}),e.jsx("option",{value:"karobka",children:"Karobka"}),e.jsx("option",{value:"kg",children:"Kilogram"}),e.jsx("option",{value:"gram",children:"Gram"}),e.jsx("option",{value:"litr",children:"Litr"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:["Miqdor (",c.unit==="dona"?"dona":c.unit==="metr"?"metr":c.unit==="rulon"?"rulon":c.unit==="karobka"?"karobka":c.unit==="kg"?"kg":c.unit==="gram"?"gram":"litr",")"]}),W?e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("div",{className:"flex-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-surface-100 rounded-lg text-center font-semibold text-surface-900 text-sm",children:w(c.quantity||0)}),e.jsx("button",{type:"button",onClick:()=>vs("add"),className:"btn-icon-sm bg-success-100 text-success-600 hover:bg-success-200",children:e.jsx(ds,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{type:"button",onClick:()=>vs("subtract"),className:"btn-icon-sm bg-danger-100 text-danger-600 hover:bg-danger-200",children:e.jsx(ht,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}):e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:rs(c.quantity),onChange:s=>H(j(g({},c),{quantity:Ye(s.target.value)})),required:!0})]})]}),c.unit==="metr"&&e.jsxs("div",{className:"bg-purple-50 rounded-xl p-3 mb-3 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"ðŸŽžï¸ 1 rulonda necha metr?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:c.metersPerRoll,onChange:s=>H(j(g({},c),{metersPerRoll:Ye(s.target.value)}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"Rulon narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:rs(c.pricePerRoll),onChange:s=>H(j(g({},c),{pricePerRoll:Ye(s.target.value)}))})]})]}),c.metersPerRoll&&c.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(yt,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"text-sm font-semibold text-purple-700",children:[c.quantity," metr = ",(Number(c.quantity)/Number(c.metersPerRoll)).toFixed(1)," rulon"]})]})]}),c.unit==="dona"&&e.jsxs("div",{className:"bg-orange-50 rounded-xl p-3 mb-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"ðŸ“¦ 1 karobkada necha dona?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"12",value:c.unitsPerBox,onChange:s=>H(j(g({},c),{unitsPerBox:Ye(s.target.value)}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"Karobka narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:rs(c.pricePerBox),onChange:s=>H(j(g({},c),{pricePerBox:Ye(s.target.value)}))})]})]}),c.unitsPerBox&&c.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(yt,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-sm font-semibold text-orange-700",children:[c.quantity," dona = ",(Number(c.quantity)/Number(c.unitsPerBox)).toFixed(1)," karobka"]})]})]}),c.unit==="rulon"&&e.jsxs("div",{className:"bg-purple-50 rounded-xl p-3 mb-3 border border-purple-200",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"1 rulonda necha metr?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:c.metersPerRoll,onChange:s=>H(j(g({},c),{metersPerRoll:Ye(s.target.value)}))})]})}),c.metersPerRoll&&c.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(yt,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"text-sm font-semibold text-purple-700",children:[c.quantity," rulon = ",w(Number(c.quantity)*Number(c.metersPerRoll))," metr"]})]})]}),c.unit==="karobka"&&e.jsxs("div",{className:"bg-orange-50 rounded-xl p-3 mb-3 border border-orange-200",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"1 karobkada necha dona?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"12",value:c.unitsPerBox,onChange:s=>H(j(g({},c),{unitsPerBox:Ye(s.target.value)}))})]})}),c.unitsPerBox&&c.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(yt,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-sm font-semibold text-orange-700",children:[c.quantity," karobka = ",w(Number(c.quantity)*Number(c.unitsPerBox))," dona"]})]})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 sm:pt-3 md:pt-4 mt-2 sm:mt-3 md:mt-4",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-semibold text-surface-900 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(is,{className:"w-3 h-3 sm:w-4 sm:h-4 text-green-600"}),"Narxlar (5 ta)"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 mb-2 sm:mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"ðŸ’µ Tan narxi (Dollar)"}),e.jsxs("div",{className:"flex gap-1 sm:gap-2",children:[e.jsx("input",{type:"text",className:"input flex-1 text-sm",placeholder:"0.00",value:c.costPriceInDollar,onChange:s=>{const d=s.target.value.replace(/[^0-9.]/g,""),P=d.split("."),A=P.length>2?P[0]+"."+P.slice(1).join(""):d,G=parseFloat(A)||0;H(j(g({},c),{costPriceInDollar:A,costPrice:(G*ne).toString()}))}}),e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-surface-600 flex items-center px-1.5 sm:px-2 bg-surface-100 rounded",children:"$"})]}),e.jsxs("p",{className:"text-[9px] sm:text-[10px] text-surface-500 mt-0.5 sm:mt-1",children:["= ",w((parseFloat(c.costPriceInDollar)||0)*ne)," so'm"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"ðŸ·ï¸ Dona narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:rs(c.unitPrice),onChange:s=>H(j(g({},c),{unitPrice:Ye(s.target.value)})),required:!0})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 mb-3 border border-blue-200",children:[e.jsx("label",{className:"text-xs font-medium text-blue-700 mb-1 block",children:"ðŸ’± Dollar kursi (1 $ = ? so'm)"}),e.jsx("input",{type:"number",className:"input",placeholder:"12500",step:"1",min:"0",value:ne,onChange:s=>Ze(parseFloat(s.target.value)||12500)}),e.jsxs("p",{className:"text-[10px] text-blue-600 mt-1",children:["Hozirgi kurs: 1 $ = ",w(ne)," so'm"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"ðŸ“¦ Karobka narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:rs(c.boxPrice),onChange:s=>H(j(g({},c),{boxPrice:Ye(s.target.value)}))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-green-50 rounded-xl p-2.5 border border-emerald-200 shadow-sm",children:[e.jsx("h5",{className:"text-[11px] font-semibold text-emerald-800 mb-2 flex items-center gap-1",children:"ðŸŽ¯ Chegirmalar"}),e.jsxs("div",{className:"bg-white rounded-2xl p-2 mb-1.5 border border-emerald-100 flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[9px] font-bold text-emerald-700 bg-emerald-100 px-2 py-0.5 rounded-full",children:"1"}),e.jsx("span",{className:"text-[9px] text-emerald-500 font-medium",children:"Birinci daraja"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] justify-center",children:[e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"1",value:c.pricingTiers.tier1.minQuantity,onChange:s=>H(j(g({},c),{pricingTiers:j(g({},c.pricingTiers),{tier1:j(g({},c.pricingTiers.tier1),{minQuantity:s.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"-"}),e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"5",value:c.pricingTiers.tier1.maxQuantity,onChange:s=>H(j(g({},c),{pricingTiers:j(g({},c.pricingTiers),{tier1:j(g({},c.pricingTiers.tier1),{maxQuantity:s.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"="}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center font-bold rounded-2xl border-indigo-300 bg-indigo-50/60 text-indigo-700 focus:border-indigo-500 focus:ring-indigo-200",placeholder:"15",value:c.pricingTiers.tier1.discountPercent,onChange:s=>H(j(g({},c),{pricingTiers:j(g({},c.pricingTiers),{tier1:j(g({},c.pricingTiers.tier1),{discountPercent:s.target.value})})}))}),e.jsx("span",{className:"text-[11px] font-bold text-indigo-600",children:"%"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-2 mb-1.5 border border-blue-100 flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[9px] font-bold text-blue-700 bg-blue-100 px-2 py-0.5 rounded-full",children:"2"}),e.jsx("span",{className:"text-[9px] text-blue-500 font-medium",children:"Ikkinchi daraja"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] justify-center",children:[e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"6",value:c.pricingTiers.tier2.minQuantity,onChange:s=>H(j(g({},c),{pricingTiers:j(g({},c.pricingTiers),{tier2:j(g({},c.pricingTiers.tier2),{minQuantity:s.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"-"}),e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"20",value:c.pricingTiers.tier2.maxQuantity,onChange:s=>H(j(g({},c),{pricingTiers:j(g({},c.pricingTiers),{tier2:j(g({},c.pricingTiers.tier2),{maxQuantity:s.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"="}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center font-bold rounded-2xl border-indigo-300 bg-indigo-50/60 text-indigo-700 focus:border-indigo-500 focus:ring-indigo-200",placeholder:"13",value:c.pricingTiers.tier2.discountPercent,onChange:s=>H(j(g({},c),{pricingTiers:j(g({},c.pricingTiers),{tier2:j(g({},c.pricingTiers.tier2),{discountPercent:s.target.value})})}))}),e.jsx("span",{className:"text-[11px] font-bold text-indigo-600",children:"%"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-2 border border-purple-100 flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[9px] font-bold text-purple-700 bg-purple-100 px-2 py-0.5 rounded-full",children:"3"}),e.jsx("span",{className:"text-[9px] text-purple-500 font-medium",children:"Uchinchi daraja"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] justify-center",children:[e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"21",value:c.pricingTiers.tier3.minQuantity,onChange:s=>H(j(g({},c),{pricingTiers:j(g({},c.pricingTiers),{tier3:j(g({},c.pricingTiers.tier3),{minQuantity:s.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"-"}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"100",value:c.pricingTiers.tier3.maxQuantity,onChange:s=>H(j(g({},c),{pricingTiers:j(g({},c.pricingTiers),{tier3:j(g({},c.pricingTiers.tier3),{maxQuantity:s.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"="}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center font-bold rounded-2xl border-indigo-300 bg-indigo-50/60 text-indigo-700 focus:border-indigo-500 focus:ring-indigo-200",placeholder:"11",value:c.pricingTiers.tier3.discountPercent,onChange:s=>H(j(g({},c),{pricingTiers:j(g({},c.pricingTiers),{tier3:j(g({},c.pricingTiers.tier3),{discountPercent:s.target.value})})}))}),e.jsx("span",{className:"text-[11px] font-bold text-indigo-600",children:"%"})]})]}),e.jsx("p",{className:"text-[10px] text-emerald-600 mt-2 italic",children:"* Masalan: 1-5 dona = 15% chegirma, 6-20 dona = 13% chegirma, 21-100 dona = 11% chegirma"})]}),e.jsxs("div",{className:"mt-4 mb-4 hidden",children:[e.jsxs("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:[c.unit==="metr"?"ðŸ“ Metr narxi":c.unit==="rulon"?"ðŸŽžï¸ Rulon narxi":c.unit==="karobka"?"ðŸ“¦ Karobka narxi":c.unit==="kg"?"âš–ï¸ Kg narxi":c.unit==="gram"?"âš–ï¸ Gram narxi":c.unit==="litr"?"ðŸ’§ Litr narxi":"ðŸ’° Dona narxi"," (so'm)"]}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:rs(c.currentPrice),onChange:s=>H(j(g({},c),{currentPrice:Ye(s.target.value)}))})]}),(c.unit==="metr"||c.unit==="rulon")&&e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 mb-3 border border-blue-200",children:[e.jsx("label",{className:"text-xs font-medium text-blue-700 mb-2 block",children:"ðŸ“ Metr narxlari (diapazon bo'yicha)"}),c.meterPriceRanges.map((s,d)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",className:"input text-sm w-16",placeholder:"1",value:s.from,onChange:P=>{const A=[...c.meterPriceRanges];A[d].from=P.target.value,H(j(g({},c),{meterPriceRanges:A}))}}),e.jsx("input",{type:"text",className:"input text-sm w-16",placeholder:"10",value:s.to,onChange:P=>{const A=[...c.meterPriceRanges];A[d].to=P.target.value,H(j(g({},c),{meterPriceRanges:A}))}}),e.jsx("input",{type:"text",className:"input text-sm flex-1",placeholder:"Narx",value:rs(s.price),onChange:P=>{const A=[...c.meterPriceRanges];A[d].price=Ye(P.target.value),H(j(g({},c),{meterPriceRanges:A}))}}),e.jsx("span",{className:"text-xs text-blue-600",children:"so'm"}),c.meterPriceRanges.length>1&&e.jsx("button",{type:"button",onClick:()=>{const P=c.meterPriceRanges.filter((A,G)=>G!==d);H(j(g({},c),{meterPriceRanges:P}))},className:"w-6 h-6 bg-red-100 text-red-600 rounded flex items-center justify-center hover:bg-red-200",children:e.jsx(fe,{className:"w-3 h-3"})})]},d)),e.jsxs("button",{type:"button",onClick:()=>H(j(g({},c),{meterPriceRanges:[...c.meterPriceRanges,{from:"",to:"",price:""}]})),className:"text-xs text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1",children:[e.jsx(ds,{className:"w-3 h-3"})," Diapazon qo'shish"]})]}),c.unit==="kg"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"âš–ï¸ Kg narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:rs(c.pricePerKg),onChange:s=>H(j(g({},c),{pricePerKg:Ye(s.target.value)}))})]})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-gradient-to-r from-slate-50 via-blue-50 to-purple-50 px-4 sm:px-6 py-4 sm:py-5 border-t border-slate-200/50 shadow-[0_-10px_30px_-10px_rgba(0,0,0,0.1)] backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsxs("button",{type:"button",onClick:ns,className:"px-5 sm:px-7 py-2.5 sm:py-3 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-semibold hover:bg-slate-50 hover:border-slate-400 hover:shadow-md transition-all duration-300 hover:scale-105 active:scale-95 flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Bekor qilish"}),e.jsx("span",{className:"sm:hidden",children:"Bekor"})]}),e.jsxs("button",{type:"submit",disabled:!!ge||Ce,className:"px-6 sm:px-10 py-2.5 sm:py-3 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 text-white rounded-xl font-bold hover:from-blue-700 hover:via-purple-700 hover:to-blue-700 transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg hover:shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center gap-2 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"}),e.jsx(mt,{className:"w-4 h-4 sm:w-5 sm:h-5 relative z-10"}),e.jsx("span",{className:"relative z-10",children:W?"Yangilash":"Saqlash"})]})]})})]})]}),M&&S&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>q(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 max-h-[90vh] overflow-y-auto rounded-t-2xl sm:rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 sticky top-0 bg-white pb-2 -mt-2 pt-2 border-b border-surface-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"QR Label - Xprinter"}),e.jsx("button",{onClick:()=>q(!1),className:"btn-icon-sm",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Jr,{productId:S._id,code:S.code,name:S.name,price:S.price,unit:S.unit,dimensions:S.dimensions?[S.dimensions.width,S.dimensions.height,S.dimensions.length].filter(Boolean).join(" Ã— "):"",labelWidth:60,labelHeight:40,copies:1,onPrint:()=>q(!1)}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-surface-200 w-full",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-3 text-center",children:"Katta QR (yuklab olish uchun)"}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-white p-3 rounded-xl border border-surface-200",children:e.jsx(Dt,{id:"qr-code-svg",value:`${Kt}/product/${S._id}`,size:150,level:"H",includeMargin:!0})})}),e.jsxs("button",{onClick:Ls,className:"btn-secondary w-full",children:[e.jsx(ca,{className:"w-4 h-4"}),"PNG yuklab olish"]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg text-xs text-blue-700 w-full",children:[e.jsx("p",{className:"font-medium mb-1",children:"ðŸ“‹ Xprinter sozlamalari:"}),e.jsxs("ul",{className:"space-y-0.5",children:[e.jsx("li",{children:"â€¢ Label o'lchami: 40mm x 30mm"}),e.jsx("li",{children:"â€¢ QR o'lchami: 20mm x 20mm"}),e.jsx("li",{children:"â€¢ Margins: None"})]})]})]})]})]}),x&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>ce(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-[71]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:$e==="add"?"Miqdor qo'shish":"Miqdor ayirish"}),e.jsx("button",{onClick:()=>ce(!1),className:"btn-icon-sm",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${$e==="add"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Hozirgi miqdor"}),e.jsxs("p",{className:`text-2xl font-bold ${$e==="add"?"text-success-600":"text-danger-600"}`,children:[w(c.quantity||0)," dona"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:$e==="add"?"Qo'shiladigan miqdor":"Ayiriladigan miqdor"}),e.jsx("input",{type:"text",className:"input text-center text-lg font-semibold",placeholder:"0",value:rs(Ne),onChange:s=>De(Ye(s.target.value)),autoFocus:!0})]}),Ne&&Number(Ne)>0&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Yangi miqdor"}),e.jsxs("p",{className:"text-xl font-bold text-surface-900",children:[w($e==="add"?(Number(c.quantity)||0)+Number(Ne):Math.max(0,(Number(c.quantity)||0)-Number(Ne)))," dona"]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>ce(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"button",onClick:Cs,className:`flex-1 ${$e==="add"?"btn-success":"btn-danger"}`,disabled:!Ne||Number(Ne)<=0,children:$e==="add"?"Qo'shish":"Ayirish"})]})]})]})]}),ee&&S&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-3 sm:p-4 bg-black/50 backdrop-blur-sm",children:[e.jsx("div",{className:"overlay",onClick:()=>ve(!1)}),e.jsxs("div",{className:"modal w-full max-w-3xl p-4 sm:p-5 relative z-50 max-h-[90vh] overflow-y-auto bg-white rounded-xl shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-surface-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[me(S)?e.jsx("img",{src:me(S),alt:S.name,className:"w-20 h-20 sm:w-24 sm:h-24 rounded-xl object-cover border-2 border-brand-200 shadow-lg"}):e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-brand-500 to-indigo-600 rounded-xl flex items-center justify-center",children:e.jsx(Ie,{className:"w-10 h-10 sm:w-12 sm:h-12 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-surface-900",children:S.name}),e.jsx("p",{className:"text-sm sm:text-base text-surface-500",children:"Sotuv statistikasi"})]})]}),e.jsx("button",{onClick:()=>ve(!1),className:"btn-icon-sm",children:e.jsx(fe,{className:"w-4 h-4"})})]}),L?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-3"}),e.jsx("p",{className:"text-sm text-surface-500",children:"Yuklanmoqda..."})]}):X?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-3 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-md flex items-center justify-center",children:e.jsx(hs,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 uppercase tracking-wide",children:"Sotilgan"})]}),e.jsx("p",{className:"text-xl font-bold text-blue-700 mb-0.5",children:w(X.stats.totalSold)}),e.jsxs("p",{className:"text-[10px] text-blue-500",children:[X.stats.totalReceipts," ta chek"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-3 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-md flex items-center justify-center",children:e.jsx(na,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-green-600 uppercase tracking-wide",children:"Daromad"})]}),e.jsx("p",{className:"text-xl font-bold text-green-700 mb-0.5",children:w(X.stats.totalRevenue)}),e.jsx("p",{className:"text-[10px] text-green-500",children:"so'm"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-3 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-purple-500 rounded-md flex items-center justify-center",children:e.jsx(Xs,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 uppercase tracking-wide",children:"Top kun"})]}),X.stats.bestDay?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-base font-bold text-purple-700 mb-0.5",children:X.stats.bestDay.date}),e.jsxs("p",{className:"text-[10px] text-purple-500",children:[X.stats.bestDay.count," dona"]})]}):e.jsx("p",{className:"text-xs text-purple-500",children:"Ma'lumot yo'q"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-orange-500 rounded-md flex items-center justify-center",children:e.jsx(dt,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-orange-600 uppercase tracking-wide",children:"Top soat"})]}),X.stats.bestHour?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-base font-bold text-orange-700 mb-0.5",children:X.stats.bestHour.label}),e.jsxs("p",{className:"text-[10px] text-orange-500",children:[X.stats.bestHour.count," dona"]})]}):e.jsx("p",{className:"text-xs text-orange-500",children:"Ma'lumot yo'q"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-surface-200 p-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-surface-900 mb-3 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(dt,{className:"w-3 h-3 text-brand-600"})}),"Soatlik statistika"]}),e.jsx("div",{className:"flex items-end gap-0.5 h-24",children:X.hourlyStats.map((s,d)=>{var se;const P=Math.max(...X.hourlyStats.map(U=>U.count),1),A=s.count/P*100,G=((se=X.stats.bestHour)==null?void 0:se.hour)===s.hour;return e.jsxs("div",{className:"flex-1 flex flex-col items-center group relative",children:[e.jsx("div",{className:`w-full rounded-t transition-all ${G?"bg-gradient-to-t from-orange-500 to-amber-400":"bg-gradient-to-t from-brand-500 to-brand-400"} hover:opacity-80`,style:{height:`${Math.max(A,3)}%`}}),e.jsx("span",{className:"text-[7px] text-surface-400 mt-0.5",children:s.hour}),e.jsxs("div",{className:"absolute bottom-full mb-1 hidden group-hover:block bg-surface-900 text-white text-[10px] px-1.5 py-0.5 rounded whitespace-nowrap z-10",children:[s.label,": ",s.count]})]},d)})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-surface-200 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-surface-900 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(Xs,{className:"w-3 h-3 text-brand-600"})}),"Sotuv tarixi"]}),e.jsx("div",{className:"flex gap-1",children:[{value:"7",label:"7"},{value:"30",label:"30"},{value:"90",label:"90"},{value:"365",label:"1y"},{value:"all",label:"All"}].map(s=>e.jsx("button",{onClick:()=>js(s.value),className:`px-2 py-1 text-[10px] font-semibold rounded transition-all ${I===s.value?"bg-brand-600 text-white shadow-sm":"bg-surface-100 text-surface-600 hover:bg-surface-200"}`,children:s.label},s.value))})]}),(I==="365"||I==="all")&&X.monthlyStats&&X.monthlyStats.length>0?e.jsx("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:X.monthlyStats.map((s,d)=>{const P=Math.max(...X.monthlyStats.map(G=>G.count),1),A=s.count/P*100;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-surface-600 w-16 flex-shrink-0 font-medium",children:s.label}),e.jsx("div",{className:"flex-1 bg-surface-100 rounded-full h-5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-brand-500 to-indigo-500 rounded-full flex items-center justify-end pr-1.5 transition-all",style:{width:`${Math.max(A,4)}%`},children:s.count>0&&e.jsx("span",{className:"text-[9px] font-bold text-white",children:s.count})})}),e.jsx("span",{className:"text-[10px] text-surface-500 w-20 text-right",children:w(s.revenue)})]},d)})}):e.jsx("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:X.periodStats&&X.periodStats.slice(-30).map((s,d)=>{const P=Math.max(...X.periodStats.map(G=>G.count),1),A=s.count/P*100;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-surface-600 w-14 flex-shrink-0 font-medium",children:new Date(s.date).toLocaleDateString("uz-UZ",{day:"numeric",month:"short"})}),e.jsx("div",{className:"flex-1 bg-surface-100 rounded-full h-5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-brand-500 to-indigo-500 rounded-full flex items-center justify-end pr-1.5 transition-all",style:{width:`${Math.max(A,4)}%`},children:s.count>0&&e.jsx("span",{className:"text-[9px] font-bold text-white",children:s.count})})}),e.jsx("span",{className:"text-[10px] text-surface-500 w-20 text-right",children:w(s.revenue)})]},d)})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-surface-200 p-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-surface-900 mb-3 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(hs,{className:"w-3 h-3 text-brand-600"})}),"Oxirgi sotuvlar"]}),X.recentSales.length>0?e.jsx("div",{className:"overflow-x-auto max-h-48 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"sticky top-0 bg-white",children:e.jsxs("tr",{className:"border-b border-surface-200",children:[e.jsx("th",{className:"text-left py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Sana"}),e.jsx("th",{className:"text-center py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Miqdor"}),e.jsx("th",{className:"text-right py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Narx"}),e.jsx("th",{className:"text-right py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Jami"}),e.jsx("th",{className:"text-left py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Mijoz"})]})}),e.jsx("tbody",{children:X.recentSales.map((s,d)=>{var P;return e.jsxs("tr",{className:"border-b border-surface-100 hover:bg-surface-50",children:[e.jsx("td",{className:"py-1.5 px-2 text-surface-700 text-[10px]",children:new Date(s.date).toLocaleString("uz-UZ",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"py-1.5 px-2 text-center",children:e.jsx("span",{className:"px-1.5 py-0.5 bg-brand-100 text-brand-700 rounded-full text-[10px] font-semibold",children:s.quantity})}),e.jsx("td",{className:"py-1.5 px-2 text-right text-surface-600 text-[10px]",children:w(s.price)}),e.jsx("td",{className:"py-1.5 px-2 text-right font-semibold text-surface-900 text-[10px]",children:w(s.total)}),e.jsx("td",{className:"py-1.5 px-2 text-surface-600 text-[10px]",children:((P=s.customer)==null?void 0:P.name)||"Noma'lum"})]},d)})})]})}):e.jsxs("div",{className:"text-center py-6 text-surface-500",children:[e.jsx(hs,{className:"w-8 h-8 mx-auto mb-1.5 text-surface-300"}),e.jsx("p",{className:"text-xs",children:"Hali sotuvlar yo'q"})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-surface-500",children:[e.jsx(Et,{className:"w-12 h-12 mx-auto mb-2 text-surface-300"}),e.jsx("p",{className:"text-sm",children:"Statistika topilmadi"})]})]})]}),V&&S&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 animate-fade-in",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm transition-all duration-300",onClick:()=>K(!1)}),e.jsxs("div",{className:"relative z-10 max-w-4xl w-full max-h-[90vh] animate-scale-in",children:[e.jsx("button",{onClick:()=>K(!1),className:"absolute -top-12 right-0 w-10 h-10 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center transition-all hover:rotate-90 group",children:e.jsx(fe,{className:"w-6 h-6 text-white group-hover:scale-110 transition-transform"})}),e.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-brand-600 to-purple-600",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:S.name}),e.jsxs("p",{className:"text-sm text-white/80",children:["#",S.code]})]}),e.jsx("div",{className:"p-4 max-h-[70vh] overflow-y-auto",children:S.images&&S.images.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:S.images.map((s,d)=>{const P=typeof s=="string"?s:s.path;return e.jsx("img",{src:`${Bs}${P}`,alt:`${S.name} - ${d+1}`,className:"w-full h-auto rounded-lg shadow-lg"},d)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-surface-400",children:[e.jsx(Ie,{className:"w-16 h-16 mb-4"}),e.jsx("p",{children:"Rasm mavjud emas"})]})})]})]})]}),v&&e.jsx(Gr,{products:u.filter(s=>le.has(s._id)),onClose:()=>{Q(!1),ke(!1),oe(new Set)}})]})}function Zr(){const{showAlert:a,showConfirm:n,AlertComponent:r}=Ns(),[u,l]=t.useState([]),[h,k]=t.useState(!1),[p,z]=t.useState(!1),[$,b]=t.useState(!1),[f,y]=t.useState(null),[N,D]=t.useState([]),[i,T]=t.useState(null),[M,q]=t.useState(null),[v,Q]=t.useState(!0),[V,K]=t.useState(!1),[le,oe]=t.useState(""),[O,ke]=t.useState(!1),[ee,ve]=t.useState(null),[X,Z]=t.useState({name:"",address:""}),[L,xe]=t.useState({code:"",name:"",costPrice:"",wholesalePrice:"",quantity:""}),[I,de]=t.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[ue,F]=t.useState("");t.useEffect(()=>{S()},[]);const S=()=>E(this,null,function*(){try{const ce=(yield _.get("/warehouses")).data.filter($e=>$e.name!=="Asosiy ombor");l(ce)}catch(x){console.error("Error fetching warehouses:",x)}finally{Q(!1)}}),be=x=>E(this,null,function*(){K(!0);try{const ce=yield _.get(`/products?warehouse=${x}`);D(ce.data)}catch(ce){console.error("Error fetching products:",ce)}finally{K(!1)}}),W=x=>E(this,null,function*(){x.preventDefault();try{i?yield _.put(`/warehouses/${i._id}`,X):yield _.post("/warehouses",X),S(),Ve()}catch(ce){console.error("Error saving warehouse:",ce)}}),Se=x=>E(this,null,function*(){var Ee,Ne;if(x.preventDefault(),!f)return;if(ue){a(ue,"Xatolik","danger");return}let ce=0,$e=Number(L.costPrice)||0;if(I.packageCount&&I.unitsPerPackage){const De=Number(I.packageCount)*Number(I.unitsPerPackage);ce=M?M.quantity+De:De}else M&&(ce=M.quantity);try{const De={code:L.code,name:L.name,costPrice:$e,price:Number(L.wholesalePrice),quantity:ce,warehouse:f._id};M?yield _.put(`/products/${M._id}`,De):yield _.post("/products",De),be(f._id),te()}catch(De){a(((Ne=(Ee=De.response)==null?void 0:Ee.data)==null?void 0:Ne.message)||"Xatolik yuz berdi","Xatolik","danger")}}),Be=x=>E(this,null,function*(){if((yield n("Tovarni o'chirishni tasdiqlaysizmi?","O'chirish"))&&f)try{yield _.delete(`/products/${x}`),be(f._id)}catch($e){console.error("Error deleting product:",$e)}}),We=x=>E(this,null,function*(){if(yield n("Omborni o'chirishni tasdiqlaysizmi?","O'chirish"))try{yield _.delete(`/warehouses/${x}`),S()}catch($e){console.error("Error deleting warehouse:",$e)}}),Qe=x=>{y(x),be(x._id),z(!0)},Ge=x=>{T(x),Z({name:x.name,address:x.address||""}),k(!0)},Fe=x=>{q(x),xe({code:x.code,name:x.name,costPrice:String(x.costPrice||0),wholesalePrice:String(x.price),quantity:String(x.quantity)}),F(""),b(!0)},Ve=()=>{k(!1),T(null),Z({name:"",address:""})},m=()=>{z(!1),y(null),D([]),oe("")},te=()=>{b(!1),q(null),xe({code:"",name:"",costPrice:"",wholesalePrice:"",quantity:""}),de({packageCount:"",unitsPerPackage:"",totalCost:""}),F("")},Ce=()=>E(this,null,function*(){try{const x=yield _.get("/products/next-code");xe(j(g({},L),{code:x.data.code,name:"",costPrice:"",wholesalePrice:"",quantity:""}))}catch(x){console.error("Error getting next code:",x)}de({packageCount:"",unitsPerPackage:"",totalCost:""}),F(""),b(!0)}),ze=x=>E(this,null,function*(){if(x)try{const ce=(M==null?void 0:M._id)||"";(yield _.get(`/products/check-code/${x}${ce?`?excludeId=${ce}`:""}`)).data.exists?F(`Kod "${x}" allaqachon mavjud`):F("")}catch(ce){console.error("Error checking code:",ce)}}),ne=x=>{ve(x),ke(!0)},Ze=()=>{if(!ee)return;const x=document.getElementById("qr-code-svg-warehouse");if(!x)return;const ce=new XMLSerializer().serializeToString(x),$e=document.createElement("canvas"),Ee=$e.getContext("2d"),Ne=new Image;Ne.onload=()=>{$e.width=Ne.width,$e.height=Ne.height,Ee==null||Ee.drawImage(Ne,0,0);const De=$e.toDataURL("image/png"),B=document.createElement("a");B.download=`QR-${ee.code}-${ee.name}.png`,B.href=De,B.click()},Ne.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(ce)))};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsx(Fs,{title:"Omborlar",actions:e.jsxs("button",{onClick:()=>k(!0),className:"btn-primary",children:[e.jsx(ds,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi ombor"})]})}),e.jsx("div",{className:"p-4 lg:p-6",children:v?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):u.length===0?e.jsxs("div",{className:"card flex flex-col items-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Zt,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Omborlar yo'q"}),e.jsx("p",{className:"text-surface-500 mb-6",children:"Birinchi omborni qo'shing"}),e.jsx("button",{onClick:()=>k(!0),className:"btn-primary",children:"Ombor qo'shish"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(x=>e.jsxs("div",{className:"card-hover cursor-pointer",onClick:()=>Qe(x),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(Zt,{className:"w-6 h-6 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-surface-900",children:x.name}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-surface-500",children:[e.jsx(At,{className:"w-3 h-3"}),e.jsx("span",{children:x.address||"Manzil ko'rsatilmagan"})]})]})]}),e.jsxs("div",{className:"flex gap-1",onClick:ce=>ce.stopPropagation(),children:[e.jsx("button",{onClick:()=>Ge(x),className:"btn-icon-sm hover:bg-brand-100 hover:text-brand-600",children:e.jsx(tt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>We(x._id),className:"btn-icon-sm hover:bg-danger-100 hover:text-danger-600",children:e.jsx(Ps,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500 pt-3 border-t border-surface-100",children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsxs("span",{children:[x.productCount||0," ta tovar"]})]})]},x._id))})}),h&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:Ve}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:i?"Omborni tahrirlash":"Yangi ombor"}),e.jsx("button",{onClick:Ve,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:W,className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Ombor nomi"}),e.jsx("input",{type:"text",className:"input",placeholder:"Ombor nomi",value:X.name,onChange:x=>Z(j(g({},X),{name:x.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Manzil"}),e.jsxs("div",{className:"relative",children:[e.jsx(At,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-12",placeholder:"Manzilni kiriting",value:X.address,onChange:x=>Z(j(g({},X),{address:x.target.value}))})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:Ve,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Saqlash"})]})]})})]})]}),p&&f&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-2 lg:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:m}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-[98vw] lg:max-w-[95vw] relative z-10 flex flex-col max-h-[96vh] lg:max-h-[94vh]",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 lg:p-6 gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:f.name}),e.jsx("p",{className:"text-sm text-surface-500 truncate",children:"Ombordagi tovarlar"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(gs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Qidirish...",value:le,onChange:x=>oe(x.target.value),className:"w-48 lg:w-64 pl-9 pr-4 py-2 bg-surface-50 border border-surface-200 rounded-xl text-sm focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"})]}),e.jsxs("button",{onClick:Ce,className:"btn-primary",children:[e.jsx(ds,{className:"w-4 h-4"}),"Tovar qo'shish"]}),e.jsx("button",{onClick:m,className:"btn-icon-sm",children:e.jsx(fe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:V?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):N.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Ie,{className:"w-12 h-12 text-surface-300 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Bu omborga tovarlar yo'q"}),e.jsx("button",{onClick:Ce,className:"btn-primary mt-4",children:"Tovar qo'shish"})]}):e.jsx("div",{className:"divide-y divide-surface-100",children:N.filter(x=>le===""||x.name.toLowerCase().includes(le.toLowerCase())||x.code.toLowerCase().includes(le.toLowerCase())).map(x=>e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:x.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",x.code]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-surface-500",children:["Tan narxi: ",w(x.costPrice||0)," so'm"]}),e.jsxs("p",{className:"font-semibold text-surface-900",children:["Optom: ",w(x.price)," so'm"]}),e.jsxs("p",{className:`text-sm ${x.quantity===0?"text-danger-600":"text-surface-500"}`,children:[x.quantity," dona"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>ne(x),className:"btn-icon-sm hover:bg-surface-200",title:"QR kod",children:e.jsx(xt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Fe(x),className:"btn-icon-sm hover:bg-brand-100 hover:text-brand-600",children:e.jsx(tt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Be(x._id),className:"btn-icon-sm hover:bg-danger-100 hover:text-danger-600",children:e.jsx(Ps,{className:"w-4 h-4"})})]})]})]},x._id))})})]})]}),$&&f&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:te}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-lg relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:M?"Tovarni tahrirlash":"Yangi tovar"}),e.jsxs("p",{className:"text-sm text-surface-500 truncate",children:[f.name," uchun"]})]}),e.jsx("button",{onClick:te,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:Se,className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input ${ue?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"000001",value:L.code,onChange:x=>xe(j(g({},L),{code:x.target.value})),onBlur:x=>ze(x.target.value),required:!0}),ue&&e.jsx("p",{className:"text-sm text-danger-600 mt-1",children:ue})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input",placeholder:"Tovar nomi",value:L.name,onChange:x=>xe(j(g({},L),{name:x.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Tan narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:rs(L.costPrice),onChange:x=>xe(j(g({},L),{costPrice:Ye(x.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Optom narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:rs(L.wholesalePrice),onChange:x=>xe(j(g({},L),{wholesalePrice:Ye(x.target.value)})),required:!0})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4",children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-3 block",children:"Qop ma'lumotlari"}),e.jsx("div",{className:"space-y-3 bg-surface-50 p-4 rounded-xl",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Qoplar soni"}),e.jsx("input",{type:"number",className:"input text-sm",placeholder:"5",value:I.packageCount,onChange:x=>de(j(g({},I),{packageCount:x.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Har qopda"}),e.jsx("input",{type:"number",className:"input text-sm",placeholder:"20",value:I.unitsPerPackage,onChange:x=>de(j(g({},I),{unitsPerPackage:x.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Jami mahsulot"}),e.jsx("input",{type:"text",className:"input text-sm bg-surface-100",placeholder:"0",value:I.packageCount&&I.unitsPerPackage?w(Number(I.packageCount)*Number(I.unitsPerPackage)):"",readOnly:!0})]})]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:te,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:!!ue,children:"Saqlash"})]})]})})]})]}),O&&ee&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>ke(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-sm relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900",children:"QR Kod"}),e.jsx("button",{onClick:()=>ke(!1),className:"flex-shrink-0 btn-icon-sm",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 flex flex-col items-center",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border border-surface-200 mb-4",children:e.jsx(Dt,{id:"qr-code-svg-warehouse",value:JSON.stringify({id:ee._id,code:ee.code,name:ee.name,price:ee.price}),size:200,level:"H",includeMargin:!0})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-semibold text-surface-900",children:ee.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",ee.code]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Tan narxi: ",w(ee.costPrice||0)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Optom: ",w(ee.price)," so'm"]})]}),e.jsxs("button",{onClick:Ze,className:"btn-primary w-full",children:[e.jsx(ca,{className:"w-4 h-4"}),"Yuklab olish"]})]})})]})]})]})}const Bt={"Toshkent shahri":["Bektemir","Chilonzor","Mirobod","Mirzo Ulug'bek","Olmazor","Sergeli","Shayxontohur","Uchtepa","Yakkasaroy","Yunusobod","Yashnobod"],"Toshkent viloyati":["Angren","Bekobod","Bo'ka","Bo'stonliq","Chinoz","Chirchiq","Nurafshon","Ohangaron","Olmaliq","Oqqo'rg'on","Parkent","Piskent","Qibray","Quyi Chirchiq","Toshkent","Yangiyo'l","Yuqori Chirchiq","Zangiota"],"Andijon viloyati":["Andijon","Asaka","Baliqchi","Bo'z","Buloqboshi","Izboskan","Jalaquduq","Xo'jaobod","Qo'rg'ontepa","Marhamat","Oltinko'l","Paxtaobod","Shahrixon","Ulug'nor","Xonobod"],"Buxoro viloyati":["Buxoro","G'ijduvon","Jondor","Kogon","Olot","Peshku","Qorako'l","Qorovulbozor","Romitan","Shofirkon","Vobkent"],"Farg'ona viloyati":["Farg'ona","Bag'dod","Beshariq","Buvayda","Dang'ara","Furqat","Qo'qon","Quva","Marg'ilon","Oltiariq","Qo'shtepa","Rishton","So'x","Toshloq","Uchko'prik","Yozyovon"],"Jizzax viloyati":["Jizzax","Arnasoy","Baxmal","Do'stlik","Forish","G'allaorol","Mirzacho'l","Paxtakor","Yangiobod","Zafarobod","Zarband","Zomin"],"Xorazm viloyati":["Urganch","Bog'ot","Gurlan","Xonqa","Hazorasp","Xiva","Qo'shko'pir","Shovot","Tuproqqal'a","Yangiariq","Yangibozor"],"Namangan viloyati":["Namangan","Chortoq","Chust","Kosonsoy","Mingbuloq","Norin","Pop","To'raqo'rg'on","Uchqo'rg'on","Uychi","Yangiqo'rg'on"],"Navoiy viloyati":["Navoiy","Karmana","Konimex","Navbahor","Nurota","Qiziltepa","Tomdi","Uchquduq","Xatirchi","Zarafshon"],"Qashqadaryo viloyati":["Qarshi","Chiroqchi","Dehqonobod","G'uzor","Kasbi","Kitob","Koson","Mirishkor","Muborak","Nishon","Qamashi","Shahrisabz","Yakkabog'"],"Qoraqalpog'iston":["Nukus","Amudaryo","Beruniy","Chimboy","Ellikqal'a","Kegeyli","Mo'ynoq","Nukus tumani","Qanliko'l","Qo'ng'irot","Shumanay","Taxtako'pir","To'rtko'l","Xo'jayli"],"Samarqand viloyati":["Samarqand","Bulung'ur","Ishtixon","Jomboy","Kattaqo'rg'on","Narpay","Nurobod","Oqdaryo","Past darg'om","Payariq","Paxtachi","Qo'shrabot","Toyloq","Urgut"],"Sirdaryo viloyati":["Guliston","Boyovut","Mirzaobod","Oqoltin","Sardoba","Sayxunobod","Sirdaryo","Xovos","Yangiyer"],"Surxondaryo viloyati":["Termiz","Angor","Bandixon","Boysun","Denov","Jarqo'rg'on","Muzrabot","Oltinsoy","Qiziriq","Qumqo'rg'on","Sariosiyo","Sherobod","Sho'rchi","Uzun"]},sa=Object.keys(Bt);function el(){var de,ue;const{showConfirm:a,showAlert:n,AlertComponent:r}=Ns(),[u,l]=t.useState([]),[h,k]=t.useState(!0),[p,z]=t.useState(!1),[$,b]=t.useState(null),[f,y]=t.useState(""),[N,D]=t.useState(null),[i,T]=t.useState({name:"",phone:"",region:"",district:""}),[M,q]=t.useState(""),[v,Q]=t.useState(""),[V,K]=t.useState(!1),[le,oe]=t.useState("name");t.useEffect(()=>{O()},[]);const O=()=>E(this,null,function*(){try{const F=yield _.get("/customers");l(F.data)}catch(F){console.error(F),n("Mijozlarni yuklashda xatolik","Xatolik","danger")}finally{k(!1)}}),ke=F=>E(this,null,function*(){F.preventDefault();try{const S={name:i.name,phone:i.phone,address:i.region&&i.district?`${i.region}, ${i.district}`:""};$?(yield _.put(`/customers/${$._id}`,S),n("Mijoz yangilandi","Muvaffaqiyat","success")):(yield _.post("/customers",S),n("Mijoz qo'shildi","Muvaffaqiyat","success")),O(),X()}catch(S){console.error(S),n("Xatolik yuz berdi","Xatolik","danger")}}),ee=F=>E(this,null,function*(){if(yield a("Mijozni o'chirishni tasdiqlaysizmi?","O'chirish")){D(F);try{yield _.delete(`/customers/${F}`),l(u.filter(be=>be._id!==F)),n("Mijoz o'chirildi","Muvaffaqiyat","success"),setTimeout(()=>{D(null)},2e3)}catch(be){D(null),console.error(be),n("Xatolik yuz berdi","Xatolik","danger")}}}),ve=F=>{b(F);const S=(F.address||"").split(", ");T({name:F.name,phone:F.phone,region:S[0]||"",district:S[1]||""}),z(!0)},X=()=>{z(!1),b(null),T({name:"",phone:"",region:"",district:""})},Z=u.filter(F=>{const S=f.trim()===""||F.name.toLowerCase().includes(f.toLowerCase())||F.phone.includes(f);let be=!0;if(M){const W=(F.address||"").split(", "),Se=W[0]||"",Be=W[1]||"";be=Se===M,be&&v&&(be=Be===v)}return S&&be}).sort((F,S)=>le==="debt"?(S.debt||0)-(F.debt||0):le==="purchases"?(S.totalPurchases||0)-(F.totalPurchases||0):F.name.localeCompare(S.name)),L={total:u.length,withDebt:u.filter(F=>F.debt>0).length,totalDebt:u.reduce((F,S)=>F+(S.debt||0),0),totalPurchases:u.reduce((F,S)=>F+(S.totalPurchases||0),0)},xe=()=>M?v?`${M}, ${v}`:M:"Barcha hududlar",I=()=>{q(""),Q("")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100 pb-20 lg:pb-0",children:[r,e.jsx(Fs,{title:"Mijozlar",showSearch:!0,onSearch:y,actions:e.jsxs("button",{onClick:()=>z(!0),className:"btn-primary",children:[e.jsx(ds,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi mijoz"})]})}),e.jsxs("div",{className:"max-w-[1800px] mx-auto p-4 lg:p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-3 lg:gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Jami"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Ds,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-blue-600"})})]}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-slate-900",children:L.total}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"mijozlar"})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Qarzli"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(oa,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-red-600"})})]}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-slate-900",children:L.withDebt}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"ta"})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Qarz"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(is,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-red-600"})})]}),e.jsx("p",{className:"text-base sm:text-xl lg:text-2xl font-bold text-red-600",children:w(L.totalDebt)}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"so'm"})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Xarid"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(hs,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-green-600"})})]}),e.jsx("p",{className:"text-base sm:text-xl lg:text-2xl font-bold text-green-600",children:w(L.totalPurchases)}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"so'm"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 flex flex-col sm:flex-row gap-2 sm:gap-3 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs("button",{onClick:()=>K(!V),className:`flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors whitespace-nowrap ${M?"bg-brand-100 text-brand-700":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:[e.jsx(At,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),e.jsx("span",{className:"max-w-[120px] sm:max-w-none truncate",children:xe()}),e.jsx(zt,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})]}),V&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>K(!1)}),e.jsxs("div",{className:"absolute left-0 sm:left-auto sm:right-0 top-full mt-2 w-[calc(100vw-2rem)] sm:w-72 bg-white rounded-xl shadow-xl border border-slate-200 z-50 p-3 sm:p-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-slate-700",children:"Hudud filtri"}),M&&e.jsx("button",{onClick:I,className:"text-xs text-brand-600 hover:text-brand-700 font-medium",children:"Tozalash"})]}),e.jsxs("select",{className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 text-xs sm:text-sm mb-2",value:M,onChange:F=>{q(F.target.value),Q("")},children:[e.jsx("option",{value:"",children:"Barcha viloyatlar"}),sa.map(F=>e.jsx("option",{value:F,children:F},F))]}),M&&e.jsxs("select",{className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 text-xs sm:text-sm",value:v,onChange:F=>Q(F.target.value),children:[e.jsx("option",{value:"",children:"Barcha tumanlar"}),(de=Bt[M])==null?void 0:de.map(F=>e.jsx("option",{value:F,children:F},F))]})]})]})]}),e.jsxs("select",{value:le,onChange:F=>oe(F.target.value),className:"px-3 sm:px-4 py-2 border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 text-xs sm:text-sm font-medium bg-white flex-shrink-0",children:[e.jsx("option",{value:"name",children:"Ism"}),e.jsx("option",{value:"debt",children:"Qarz"}),e.jsx("option",{value:"purchases",children:"Xarid"})]})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-slate-500 whitespace-nowrap",children:[Z.length," ta"]})]}),h?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):Z.length===0?e.jsxs("div",{className:"bg-white rounded-xl border-2 border-slate-200 flex flex-col items-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Ds,{className:"w-8 h-8 text-slate-400"})}),M?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Bu hududda mijozlar yo'q"}),e.jsxs("p",{className:"text-slate-500 mb-6 text-center",children:[e.jsx("span",{className:"font-medium text-brand-600",children:v?`${M}, ${v}`:M})," da hech qanday mijoz topilmadi"]}),e.jsxs("button",{onClick:I,className:"px-6 py-2 bg-brand-500 hover:bg-brand-600 text-white font-semibold rounded-lg transition-colors",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-2"}),"Filterni tozalash"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Mijozlar yo'q"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Birinchi mijozni qo'shing"}),e.jsx("button",{onClick:()=>z(!0),className:"px-6 py-2 bg-brand-500 hover:bg-brand-600 text-white font-semibold rounded-lg transition-colors",children:"Mijoz qo'shish"})]})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 lg:gap-6",children:Z.map(F=>e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 hover:border-brand-300 hover:shadow-lg transition-all p-4 sm:p-5 lg:p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 lg:w-14 lg:h-14 bg-gradient-to-br from-brand-100 to-brand-50 rounded-lg sm:rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"font-bold text-sm sm:text-base lg:text-lg text-brand-600",children:F.name.charAt(0)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-bold text-slate-900 text-sm sm:text-base lg:text-lg truncate",children:F.name}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500 truncate",children:$a(F.phone)})]})]}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-shrink-0 ml-2",children:[e.jsx("button",{onClick:()=>ve(F),className:"p-1.5 sm:p-2 hover:bg-blue-100 text-blue-600 rounded-lg transition-colors",title:"Tahrirlash",children:e.jsx(tt,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:()=>ee(F._id),disabled:N===F._id,className:"p-1.5 sm:p-2 hover:bg-red-100 text-red-600 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"O'chirish",children:N===F._id?e.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):e.jsx(Ps,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),F.address&&e.jsxs("div",{className:"mb-3 sm:mb-4 pb-3 sm:pb-4 border-b border-slate-100",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mb-1",children:"Manzil"}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-700 font-medium truncate",children:F.address})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-2.5 sm:p-3 border border-green-200",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-green-600 font-semibold mb-0.5 sm:mb-1",children:"Xaridlar"}),e.jsx("p",{className:"text-base sm:text-lg font-bold text-green-700 truncate",children:w(F.totalPurchases||0)}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-green-600 mt-0.5 sm:mt-1",children:[F.purchaseCount||0," ta"]})]}),e.jsxs("div",{className:`rounded-lg p-2.5 sm:p-3 border ${F.debt>0?"bg-gradient-to-br from-red-50 to-rose-50 border-red-200":"bg-gradient-to-br from-emerald-50 to-green-50 border-emerald-200"}`,children:[e.jsx("p",{className:`text-[10px] sm:text-xs font-semibold mb-0.5 sm:mb-1 ${F.debt>0?"text-red-600":"text-emerald-600"}`,children:F.debt>0?"Qarz":"Qarz yo'q"}),e.jsx("p",{className:`text-base sm:text-lg font-bold truncate ${F.debt>0?"text-red-700":"text-emerald-700"}`,children:w(F.debt)})]})]})]},F._id))})]}),p&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-4 py-3 text-white flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-bold",children:$?"Mijozni tahrirlash":"Yangi mijoz"}),e.jsx("button",{onClick:X,className:"hover:bg-brand-600 p-1 rounded-lg transition-colors",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:ke,className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Ism"}),e.jsx("input",{className:"w-full px-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",placeholder:"Mijoz ismi",value:i.name,onChange:F=>T(j(g({},i),{name:F.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Telefon"}),e.jsxs("div",{className:"relative",children:[e.jsx(Es,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{className:"w-full pl-10 pr-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",placeholder:"+998 (XX) XXX-XX-XX",value:i.phone,onChange:F=>T(j(g({},i),{phone:ut(F.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Viloyat"}),e.jsxs("select",{className:"w-full px-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",value:i.region,onChange:F=>T(j(g({},i),{region:F.target.value,district:""})),children:[e.jsx("option",{value:"",children:"Viloyatni tanlang"}),sa.map(F=>e.jsx("option",{value:F,children:F},F))]})]}),i.region&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Tuman"}),e.jsxs("select",{className:"w-full px-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",value:i.district,onChange:F=>T(j(g({},i),{district:F.target.value})),children:[e.jsx("option",{value:"",children:"Tumanni tanlang"}),(ue=Bt[i.region])==null?void 0:ue.map(F=>e.jsx("option",{value:F,children:F},F))]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:X,className:"flex-1 px-3 py-2 text-xs font-semibold bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"flex-1 px-3 py-2 text-xs font-semibold bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white rounded-lg transition-all shadow-lg",children:"Saqlash"})]})]})]})})]})}function ga(){var Ve;const{user:a}=Vs(),n=(a==null?void 0:a.role)==="admin",{showConfirm:r,showAlert:u,AlertComponent:l}=Ns(),[h,k]=t.useState([]),[p,z]=t.useState([]),[$,b]=t.useState({total:0,approved:0,today:0,overdue:0,paid:0,blacklist:0,totalAmount:0,pendingApproval:0}),[f,y]=t.useState(!1),[N,D]=t.useState(!1),[i,T]=t.useState(null),[M,q]=t.useState(!0),[v,Q]=t.useState("receivable"),[V,K]=t.useState({customer:"",creditorName:"",amount:"",dueDate:"",description:"",collateral:""}),[le,oe]=t.useState(""),[O,ke]=t.useState(""),[ee,ve]=t.useState("all"),[X,Z]=t.useState(!1),[L,xe]=t.useState({name:"",phone:"",region:"",district:""}),[I,de]=t.useState(null);t.useEffect(()=>{ue(),F(),S()},[v]);const ue=()=>E(this,null,function*(){try{const m=yield _.get(`/debts?type=${v}`);k(m.data)}catch(m){console.error("Error fetching debts:",m)}finally{q(!1)}}),F=()=>E(this,null,function*(){try{const m=yield _.get("/customers");z(m.data)}catch(m){console.error("Error fetching customers:",m)}}),S=()=>E(this,null,function*(){try{const m=yield _.get(`/debts/stats?type=${v}`);b(m.data)}catch(m){console.error("Error fetching stats:",m)}}),be=m=>E(this,null,function*(){m.preventDefault();try{const te={type:v,customer:v==="receivable"?V.customer:void 0,creditorName:v==="payable"?V.creditorName:void 0,amount:Number(V.amount),dueDate:V.dueDate,description:V.description,collateral:V.collateral};I?yield _.put(`/debts/${I._id}`,te):(yield _.post("/debts",te),u("Qarz muvaffaqiyatli qo'shildi","Muvaffaqiyat","success")),ue(),S(),Se()}catch(te){console.error("Error saving debt:",te),u("Qarz qo'shishda xatolik yuz berdi","Xatolik","danger")}}),W=m=>E(this,null,function*(){if(m.preventDefault(),!!i)try{yield _.post(`/debts/${i._id}/payment`,{amount:Number(le),method:"cash"}),ue(),S(),D(!1),T(null),oe("")}catch(te){console.error("Error making payment:",te)}}),Se=()=>{y(!1),de(null),K({customer:"",creditorName:"",amount:"",dueDate:"",description:"",collateral:""}),Z(!1),xe({name:"",phone:"",region:"",district:""})},Be=()=>E(this,null,function*(){if(!(!L.name||!L.phone))try{const m={name:L.name,phone:L.phone,address:L.region&&L.district?`${L.region}, ${L.district}`:""},te=yield _.post("/customers",m);yield F(),K(j(g({},V),{customer:te.data._id})),Z(!1),xe({name:"",phone:"",region:"",district:""})}catch(m){console.error("Error creating customer:",m)}}),We=h.filter(m=>{var Ze,x;const te=((Ze=m.customer)==null?void 0:Ze.name)||m.creditorName||"",Ce=((x=m.customer)==null?void 0:x.phone)||"",ze=te.toLowerCase().includes(O.toLowerCase())||Ce.includes(O);let ne=!0;if(ee==="today"){const ce=new Date;ce.setHours(0,0,0,0);const $e=new Date(ce.getTime()+864e5),Ee=new Date(m.dueDate);ne=Ee>=ce&&Ee<$e&&m.status!=="paid"}else ee!=="all"&&(ne=m.status===ee);return ze&&ne}),Qe=[{label:"AKTIV",value:$.approved,icon:Ws,color:"success",filter:"approved"},{label:"TO'LANGAN",value:$.paid,icon:Ws,color:"success",filter:"paid"},{label:"MUDDATI O'TGAN",value:$.overdue,icon:oa,color:"danger",filter:"overdue"},{label:"QORA RO'YXAT",value:$.blacklist,icon:Ms,color:"danger",filter:"blacklist"},{label:"JAMI QARZ",value:`${w($.totalAmount)} so'm`,icon:Za,color:"accent",filter:null}],Ge=m=>{var te;return(te=m.customer)!=null&&te.name?m.customer.name:m.creditorName||"Noma'lum"},Fe=m=>{var te;return((te=m.customer)==null?void 0:te.phone)||""};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[l,e.jsx(Fs,{title:"Qarz daftarcha",showSearch:!0,onSearch:ke,actions:e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:()=>y(!0),className:"w-5 h-5 md:w-9 md:h-9 rounded-full bg-brand-500 hover:bg-brand-600 text-white flex items-center justify-center shadow-sm hover:shadow-md transition-all active:scale-95",title:"Yangi qarz qo'shish",children:e.jsx(ds,{className:"w-2.5 h-2.5 md:w-4.5 md:h-4.5"})})})}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[n&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"inline-flex p-1 bg-surface-100 rounded-xl",children:[e.jsxs("button",{onClick:()=>{Q("receivable"),ve("all")},className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all ${v==="receivable"?"bg-white text-success-600 shadow-sm":"text-surface-500 hover:text-surface-700"}`,children:[e.jsx(ha,{className:"w-4 h-4"}),"Menga qarzdor"]}),e.jsxs("button",{onClick:()=>{Q("payable"),ve("all")},className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all ${v==="payable"?"bg-white text-danger-600 shadow-sm":"text-surface-500 hover:text-surface-700"}`,children:[e.jsx(Gt,{className:"w-4 h-4"}),"Men qarzdorman"]})]})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4",children:Qe.map((m,te)=>e.jsx("div",{onClick:()=>m.filter&&ve(m.filter),className:`group relative ${m.filter?"cursor-pointer":""}`,children:e.jsxs("div",{className:`relative bg-white/90 backdrop-blur-xl rounded-2xl p-4 sm:p-5 shadow-xl border border-white/20 hover:shadow-2xl transition-all duration-500 hover:scale-[1.02] overflow-hidden h-[140px] sm:h-[160px] flex flex-col ${ee===m.filter?"ring-2 ring-brand-500":""}`,children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${m.color==="success"?"from-emerald-500 to-emerald-600":m.color==="danger"?"from-red-500 to-red-600":"from-purple-500 to-purple-600"} opacity-[0.03] group-hover:opacity-[0.08] transition-all duration-700`}),e.jsx("div",{className:`absolute -right-8 -top-8 w-32 h-32 bg-gradient-to-br ${m.color==="success"?"from-emerald-500 to-emerald-600":m.color==="danger"?"from-red-500 to-red-600":"from-purple-500 to-purple-600"} opacity-[0.08] rounded-full blur-3xl group-hover:opacity-[0.15] group-hover:scale-125 transition-all duration-700`}),e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 bg-gradient-to-r ${m.color==="success"?"from-emerald-500 to-emerald-600":m.color==="danger"?"from-red-500 to-red-600":"from-purple-500 to-purple-600"} opacity-60 group-hover:opacity-100 transition-all duration-500`}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center shadow-lg transition-all duration-500 group-hover:scale-110 group-hover:rotate-3 ${m.color==="success"?"bg-gradient-to-br from-emerald-100 to-emerald-50":m.color==="danger"?"bg-gradient-to-br from-red-100 to-red-50":"bg-gradient-to-br from-purple-100 to-purple-50"}`,children:e.jsx(m.icon,{className:`w-5 h-5 sm:w-6 sm:h-6 ${m.color==="success"?"text-emerald-600":m.color==="danger"?"text-red-600":"text-purple-600"}`})})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-end",children:[e.jsx("p",{className:`text-lg sm:text-xl lg:text-2xl font-extrabold mb-0.5 transition-all duration-500 group-hover:scale-105 ${m.color==="success"?"text-emerald-600":m.color==="danger"?"text-red-600":"text-purple-600"}`,children:m.value}),e.jsx("p",{className:"text-[9px] sm:text-[10px] font-bold text-slate-600 uppercase tracking-wider leading-tight",children:m.label})]})]}),e.jsx("div",{className:"absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 bg-gradient-to-r from-transparent via-white/10 to-transparent"})]})},te))}),e.jsx("div",{className:"card p-0 overflow-hidden",children:M?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):We.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Ms,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Qarzlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:O||ee!=="all"?"Filtr bo'yicha qarzlar topilmadi":"Hozircha qarzlar yo'q"})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-3 sm:gap-4 md:gap-5 p-3 sm:p-4 md:p-5",children:We.map(m=>{const te=m.status==="paid",Ce=m.status==="overdue",ze=m.status==="approved",ne=m.status==="blacklist",Ze=m.amount-m.paidAmount,x=Math.round(m.paidAmount/m.amount*100),ce=new Date(m.dueDate),$e=new Date;$e.setHours(0,0,0,0);const Ee=Math.ceil((ce.getTime()-$e.getTime())/(1e3*60*60*24)),Ne=!te&&(Ce||Ee<=0),De=!te&&!Ne&&Ee<=3,B=!te&&!Ne&&!De&&Ee<=7,c=Ne?"border-red-400 ring-2 ring-red-200":De?"border-orange-400 ring-2 ring-orange-200":B?"border-amber-400 ring-1 ring-amber-200":ne?"border-slate-700 ring-2 ring-slate-400":"border-surface-200 hover:border-brand-300";return e.jsxs("div",{className:`bg-white rounded-xl sm:rounded-2xl border ${c} hover:shadow-xl transition-all duration-300 overflow-hidden group ${Ne?"animate-pulse-slow":""}`,children:[e.jsxs("div",{className:`relative p-3 sm:p-4 ${ne?"bg-gradient-to-br from-slate-800 to-slate-900":Ne?"bg-gradient-to-br from-red-100 to-rose-100":De?"bg-gradient-to-br from-orange-50 to-amber-50":B?"bg-gradient-to-br from-amber-50 to-yellow-50":v==="receivable"?"bg-gradient-to-br from-emerald-50 to-green-50":"bg-gradient-to-br from-red-50 to-rose-50"}`,children:[!te&&Ee<=7&&e.jsx("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-lg text-[10px] font-bold ${Ne?"bg-red-500 text-white animate-pulse":De?"bg-orange-500 text-white":"bg-amber-500 text-white"}`,children:Ce||Ee<0?`${Math.abs(Ee)} kun o'tdi!`:Ee===0?"Bugun!":`${Ee} kun qoldi`}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center shadow-lg ${ne?"bg-gradient-to-br from-slate-900 to-black":Ne?"bg-gradient-to-br from-red-500 to-rose-600":De?"bg-gradient-to-br from-orange-400 to-amber-500":B?"bg-gradient-to-br from-amber-400 to-yellow-500":v==="receivable"?"bg-gradient-to-br from-emerald-400 to-green-500":"bg-gradient-to-br from-red-400 to-rose-500"}`,children:e.jsx(ls,{className:`w-6 h-6 ${ne?"text-amber-300":"text-white"}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-bold text-surface-900 truncate text-sm sm:text-base",children:Ge(m)}),Fe(m)&&e.jsxs("p",{className:"text-xs sm:text-sm text-surface-500 flex items-center gap-1",children:[e.jsx(Es,{className:"w-3 h-3"}),Fe(m)]})]})]}),e.jsxs("div",{className:`px-3 py-1.5 rounded-xl text-[10px] sm:text-xs font-semibold flex items-center gap-1.5 ${ne?"bg-gradient-to-r from-slate-900 to-black text-amber-300 shadow-lg shadow-slate-500":ze?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg shadow-green-200":"bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow-lg shadow-blue-200"}`,children:[ne?e.jsx(Ms,{className:"w-3 h-3"}):ze?e.jsx(Ws,{className:"w-3 h-3"}):e.jsx(Xs,{className:"w-3 h-3"}),e.jsx("span",{children:ne?"Qora ro'yxat":te?"To'langan":Ce?"Muddati o'tgan":ze?"Aktiv":"Jarayonda"})]})]}),!te&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-[10px] sm:text-xs text-surface-600 mb-1",children:[e.jsxs("span",{children:["To'langan: ",x,"%"]}),e.jsxs("span",{children:[w(m.paidAmount)," / ",w(m.amount)]})]}),e.jsx("div",{className:`h-2 rounded-full overflow-hidden ${Ne?"bg-red-200":De?"bg-orange-200":B?"bg-amber-200":"bg-white/60"}`,children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${Ne?"bg-red-500":De?"bg-orange-500":B?"bg-amber-500":v==="receivable"?"bg-emerald-500":"bg-red-500"}`,style:{width:`${x}%`}})})]})]}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[e.jsxs("div",{className:"bg-surface-50 rounded-xl p-1.5 sm:p-3 border border-surface-100",children:[e.jsx("p",{className:"text-[9px] sm:text-xs text-surface-500 uppercase tracking-wide font-semibold mb-0.5 sm:mb-1",children:"Jami qarz"}),e.jsx("p",{className:"font-bold text-surface-900 text-xs sm:text-base",children:w(m.amount)}),e.jsx("p",{className:"text-[9px] text-surface-400",children:"so'm"})]}),e.jsxs("div",{className:`rounded-xl p-1.5 sm:p-3 border ${v==="receivable"?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"}`,children:[e.jsx("p",{className:"text-[9px] sm:text-xs text-surface-500 uppercase tracking-wide font-semibold mb-0.5 sm:mb-1",children:"Qoldiq"}),e.jsx("p",{className:`font-bold text-xs sm:text-base ${v==="receivable"?"text-emerald-600":"text-red-600"}`,children:w(Ze)}),e.jsx("p",{className:"text-[9px] text-surface-400",children:"so'm"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3 text-[10px] sm:text-sm",children:[e.jsxs("div",{className:"flex flex-col gap-0.5 sm:gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 text-surface-600",children:[e.jsx(Xs,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),e.jsx("span",{children:new Date(m.dueDate).toLocaleDateString("uz-UZ")})]}),m.extensionDays>0&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-blue-50 rounded-md text-blue-700 text-[9px] sm:text-[10px] font-medium border border-blue-200",children:["ðŸ“… ",m.extensionDays," kun muddat"]})]}),v==="receivable"&&m.collateral&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-amber-50 rounded-lg text-amber-700 text-[9px] sm:text-[10px] font-medium border border-amber-200 max-w-[100px] truncate",children:["ðŸ”’ ",m.collateral]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-1.5 sm:gap-2 pt-2 sm:pt-3 border-t border-surface-100 flex-wrap",children:[n&&e.jsxs("button",{onClick:()=>E(this,null,function*(){try{yield _.delete(`/debts/${m._id}`),ue(),S()}catch(H){console.error("Error deleting debt:",H)}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-red-100 text-red-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-red-200 transition-all whitespace-nowrap",title:"Qarzni o'chirish",children:[e.jsx(Ps,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"O'chirish"})]}),n&&!te&&e.jsxs(e.Fragment,{children:[m.extensionCount===void 0||m.extensionCount<3?e.jsxs("button",{onClick:()=>E(this,null,function*(){var we,ye;const H=prompt("Necha kun muddat berilsin?");if(!H)return;const he=parseInt(H,10);if(!(Number.isNaN(he)||he<=0))try{yield _.post(`/debts/${m._id}/extend`,{days:he}),ue(),S()}catch(C){console.error("Error extending debt:",C),u(((ye=(we=C.response)==null?void 0:we.data)==null?void 0:ye.message)||"Muddat berishda xatolik","Xatolik","danger")}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-amber-100 text-amber-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-amber-200 transition-all whitespace-nowrap",children:[e.jsx(Xs,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{children:"Muddat"})]}):null,e.jsxs("button",{onClick:()=>E(this,null,function*(){var he,we;if(yield r("Bu qarzni to'landi deb belgilaysizmi? Qoldiq summa nol bo'ladi.","Bo'ldi"))try{const ye=m.amount-m.paidAmount;ye>0&&(yield _.post(`/debts/${m._id}/payment`,{amount:ye,method:"cash"})),ue(),S(),u("Qarz to'landi deb belgilandi","Muvaffaqiyat","success")}catch(ye){console.error("Error marking debt as paid:",ye),u(((we=(he=ye.response)==null?void 0:he.data)==null?void 0:we.message)||"Qarz to'landi deb belgilashda xatolik","Xatolik","danger")}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-emerald-100 text-emerald-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-emerald-200 transition-all whitespace-nowrap",children:[e.jsx(Ws,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{children:"Bo'ldi"})]})]}),!te&&e.jsxs("button",{onClick:()=>{T(m),D(!0)},className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-emerald-100 text-emerald-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-emerald-200 transition-all whitespace-nowrap",children:[e.jsx(is,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{children:"To'lov"})]}),n&&ne&&e.jsxs("button",{onClick:()=>E(this,null,function*(){var he,we;if(yield r("Ushbu mijozni qora ro'yxatdan chiqarasizmi?","Qora ro'yxatdan chiqarish"))try{yield _.post(`/debts/${m._id}/remove-blacklist`),ue(),S(),u("Mijoz qora ro'yxatdan chiqarildi","Muvaffaqiyat","success")}catch(ye){console.error("Error removing from blacklist:",ye),u(((we=(he=ye.response)==null?void 0:he.data)==null?void 0:we.message)||"Qora ro'yxatdan chiqarishda xatolik","Xatolik","danger")}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-slate-800 text-amber-300 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-slate-900 transition-all whitespace-nowrap",children:[e.jsx(Ms,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Qora ro'yxatdan chiqarish"}),e.jsx("span",{className:"sm:hidden",children:"Chiqarish"})]})]})]})]},m._id)})})})})]}),f&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:Se}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:I?"Qarzni tahrirlash":"Yangi qarz"}),e.jsx("button",{onClick:Se,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[n&&e.jsxs("div",{className:"flex p-1 bg-surface-100 rounded-xl mb-6",children:[e.jsxs("button",{type:"button",onClick:()=>Q("receivable"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg transition-all ${v==="receivable"?"bg-white text-success-600 shadow-sm":"text-surface-500"}`,children:[e.jsx(ha,{className:"w-4 h-4"}),"Menga qarzdor"]}),e.jsxs("button",{type:"button",onClick:()=>Q("payable"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg transition-all ${v==="payable"?"bg-white text-danger-600 shadow-sm":"text-surface-500"}`,children:[e.jsx(Gt,{className:"w-4 h-4"}),"Men qarzdorman"]})]}),e.jsxs("form",{onSubmit:be,className:"space-y-4",children:[e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ms,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-amber-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"Diqqat!"}),e.jsx("p",{children:"Qo'shilgan qarz darhol mijozning umumiy qarziga qo'shiladi. Shuning uchun ma'lumotlarni diqqat bilan kiriting."})]})]})}),v==="receivable"?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Mijoz"}),X?e.jsxs("div",{className:"space-y-3 p-3 bg-surface-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-brand-600",children:"Yangi mijoz"}),e.jsx("button",{type:"button",onClick:()=>Z(!1),className:"text-surface-400 hover:text-surface-600",children:e.jsx(fe,{className:"w-4 h-4"})})]}),e.jsx("input",{type:"text",className:"input",placeholder:"Mijoz ismi",value:L.name,onChange:m=>xe(j(g({},L),{name:m.target.value}))}),e.jsxs("div",{className:"relative",children:[e.jsx(Es,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-12",placeholder:"+998 (XX) XXX-XX-XX",value:L.phone,onChange:m=>xe(j(g({},L),{phone:ut(m.target.value)}))})]}),e.jsxs("select",{className:"select text-sm",value:L.region,onChange:m=>xe(j(g({},L),{region:m.target.value,district:""})),children:[e.jsx("option",{value:"",children:"Viloyatni tanlang"}),sa.map(m=>e.jsx("option",{value:m,children:m},m))]}),L.region&&e.jsxs("select",{className:"select text-sm",value:L.district,onChange:m=>xe(j(g({},L),{district:m.target.value})),children:[e.jsx("option",{value:"",children:"Tumanni tanlang"}),(Ve=Bt[L.region])==null?void 0:Ve.map(m=>e.jsx("option",{value:m,children:m},m))]}),e.jsxs("button",{type:"button",onClick:Be,disabled:!L.name||!L.phone,className:"btn-primary w-full",children:[e.jsx(aa,{className:"w-4 h-4"}),"Mijozni yaratish"]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"select flex-1",value:V.customer,onChange:m=>K(j(g({},V),{customer:m.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Tanlang"}),p.map(m=>e.jsxs("option",{value:m._id,children:[m.name," - ",m.phone]},m._id))]}),e.jsx("button",{type:"button",onClick:()=>Z(!0),className:"btn-icon bg-brand-100 text-brand-600 hover:bg-brand-200",title:"Yangi mijoz qo'shish",children:e.jsx(ds,{className:"w-5 h-5"})})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Kimga qarzdorman"}),e.jsx("input",{type:"text",className:"input",placeholder:"Ism yoki kompaniya nomi",value:V.creditorName,onChange:m=>K(j(g({},V),{creditorName:m.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Summa (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:rs(V.amount),onChange:m=>K(j(g({},V),{amount:Ye(m.target.value)})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Muddat"}),e.jsx("input",{type:"date",className:"input",value:V.dueDate,onChange:m=>K(j(g({},V),{dueDate:m.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Izoh (ixtiyoriy)"}),e.jsx("input",{type:"text",className:"input",placeholder:"Qarz haqida izoh",value:V.description,onChange:m=>K(j(g({},V),{description:m.target.value}))})]}),v==="receivable"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Zalog (ixtiyoriy)"}),e.jsx("input",{type:"text",className:"input",placeholder:"Zalogga nima qoldirdi",value:V.collateral,onChange:m=>K(j(g({},V),{collateral:m.target.value}))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:Se,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Saqlash"})]})]})]})})]})]}),N&&i&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>D(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900",children:"To'lov qilish"}),e.jsx("button",{onClick:()=>D(!1),className:"flex-shrink-0 btn-icon-sm",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${v==="receivable"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Qoldiq summa"}),e.jsxs("p",{className:`text-2xl font-bold ${v==="receivable"?"text-success-600":"text-danger-600"}`,children:[w(i.amount-i.paidAmount)," so'm"]})]}),e.jsxs("form",{onSubmit:W,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"To'lov summasi"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:rs(le),onChange:m=>oe(Ye(m.target.value)),required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>D(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-success flex-1",children:"To'lash"})]})]})]})})]})]})]})}function sl(){const{showAlert:a,showConfirm:n,AlertComponent:r}=Ns(),u=As(),[l,h]=t.useState([]),[k,p]=t.useState(!0),[z,$]=t.useState(null),[b,f]=t.useState(null);t.useEffect(()=>{y()},[]);const y=()=>E(this,null,function*(){try{const i=yield _.get("/debts?status=pending_approval");h(i.data)}catch(i){console.error("Error fetching pending debts:",i)}finally{p(!1)}}),N=i=>E(this,null,function*(){var T,M;$(i);try{yield _.post(`/debts/${i}/approve`),h(l.filter(q=>q._id!==i)),a("Qarz muvaffaqiyatli tasdiqlandi","Muvaffaqiyat","success")}catch(q){$(null),console.error("Error approving debt:",q),a(((M=(T=q.response)==null?void 0:T.data)==null?void 0:M.message)||"Xatolik yuz berdi","Xatolik","danger")}}),D=i=>E(this,null,function*(){var M,q;if(yield n("Bu qarzni rad etasizmi?","Rad etish")){f(i);try{yield _.post(`/debts/${i}/reject`),h(l.filter(v=>v._id!==i)),a("Qarz rad etildi","Muvaffaqiyat","success")}catch(v){f(null),console.error("Error rejecting debt:",v),a(((q=(M=v.response)==null?void 0:M.data)==null?void 0:q.message)||"Xatolik yuz berdi","Xatolik","danger")}}});return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsx(Fs,{title:"Qarz tasdiqlash",actions:e.jsxs("button",{onClick:()=>u("/admin/debts"),className:"btn-secondary",children:[e.jsx(ya,{className:"w-4 h-4"}),"Orqaga"]})}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-4xl mx-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-6 border border-amber-200",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 rounded-xl flex items-center justify-center",children:e.jsx(Ms,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-amber-900",children:"Tasdiqlashni kutayotgan qarzlar"}),e.jsxs("p",{className:"text-sm text-amber-700",children:[l.length," ta qarz kassachi tomonidan qo'shilgan va sizning tasdiqlashingizni kutmoqda"]})]})]})}),k?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Ws,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Barcha qarzlar ko'rib chiqildi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:"Hozirda tasdiqlashni kutayotgan qarzlar yo'q. Yangi qarzlar qo'shilganda bu yerda ko'rinadi."})]}):e.jsx("div",{className:"space-y-4",children:l.map(i=>{var T,M;return e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-amber-200 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center",children:e.jsx(ls,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-lg",children:(T=i.customer)==null?void 0:T.name}),e.jsx("p",{className:"text-surface-500",children:(M=i.customer)==null?void 0:M.phone}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-surface-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Muddat: ",new Date(i.dueDate).toLocaleDateString("uz-UZ")]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(is,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium text-lg",children:[w(i.amount)," so'm"]})]})]})]})]}),e.jsxs("span",{className:"badge badge-amber",children:[e.jsx(Ms,{className:"w-3 h-3"}),"Kutilmoqda"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[i.description&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("h5",{className:"font-medium text-surface-700 mb-2",children:"Izoh"}),e.jsx("p",{className:"text-surface-600 text-sm",children:i.description})]}),i.collateral&&e.jsxs("div",{className:"bg-amber-50 rounded-xl p-4",children:[e.jsx("h5",{className:"font-medium text-amber-700 mb-2",children:"Zalog"}),e.jsx("p",{className:"text-amber-600 text-sm",children:i.collateral})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>D(i._id),disabled:b===i._id||z===i._id,className:"btn-secondary flex-1 text-red-600 hover:bg-red-50 hover:border-red-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:b===i._id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Rad etilmoqda..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4"}),"Rad etish"]})}),e.jsx("button",{onClick:()=>N(i._id),disabled:z===i._id||b===i._id,className:"btn-primary flex-1 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:z===i._id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Tasdiqlanamoqda..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ws,{className:"w-4 h-4"}),"Tasdiqlash"]})})]})]},i._id)})})]})]})}function tl(){const[a,n]=t.useState([]),[r,u]=t.useState("all"),[l,h]=t.useState(!0);t.useEffect(()=>{k()},[]);const k=()=>E(this,null,function*(){try{const f=yield _.get("/orders");n(f.data)}catch(f){console.error("Error fetching orders:",f)}finally{h(!1)}}),p=(f,y)=>E(this,null,function*(){try{yield _.put(`/orders/${f}/status`,{status:y}),k()}catch(N){console.error("Error updating order:",N)}}),z={new:{color:"brand",label:"Yangi",icon:dt},processing:{color:"warning",label:"Jarayonda",icon:Ie},shipped:{color:"accent",label:"Yo'lda",icon:sr},delivered:{color:"success",label:"Yetkazildi",icon:Ws},cancelled:{color:"danger",label:"Bekor qilindi",icon:er}},$=[{value:"all",label:"Barchasi"},...Object.entries(z).map(([f,y])=>({value:f,label:y.label}))],b=a.filter(f=>r==="all"||f.status===r);return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[e.jsx(Fs,{title:"Buyurtmalar",filterOptions:$,filterValue:r,onFilterChange:u}),e.jsx("div",{className:"p-4 lg:p-6",children:e.jsx("div",{className:"card p-0 overflow-hidden",children:l?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Tt,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Buyurtmalar topilmadi"}),e.jsx("p",{className:"text-surface-500",children:"Hozircha buyurtmalar yo'q"})]}):e.jsx("div",{className:"divide-y divide-surface-100",children:b.map(f=>{var N;const y=z[f.status];return e.jsx("div",{className:"p-4 lg:p-6 hover:bg-surface-50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(Ie,{className:"w-6 h-6 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-surface-900",children:["Buyurtma #",f._id.slice(-6)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500 mt-1",children:[e.jsx(ls,{className:"w-4 h-4"}),e.jsx("span",{children:((N=f.customer)==null?void 0:N.name)||"Noma'lum mijoz"})]})]}),e.jsx("select",{value:f.status,onChange:D=>p(f._id,D.target.value),className:`select text-sm py-2 px-3 bg-${y.color}-50 text-${y.color}-700 border-${y.color}-200`,children:Object.entries(z).map(([D,i])=>e.jsx("option",{value:D,children:i.label},D))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-surface-500",children:[e.jsxs("span",{children:[f.items.length," ta mahsulot"]}),e.jsx("span",{children:new Date(f.createdAt).toLocaleDateString("uz-UZ")})]}),e.jsxs("p",{className:"font-bold text-surface-900",children:[f.total.toLocaleString()," so'm"]})]})]})]})},f._id)})})})})]})}function al(){const{showConfirm:a,showAlert:n,AlertComponent:r}=Ns(),[u,l]=t.useState([]),[h,k]=t.useState([]),[p,z]=t.useState(null),[$,b]=t.useState([]),[f,y]=t.useState(!1),[N,D]=t.useState(!1),[i,T]=t.useState(!1),[M,q]=t.useState(null),[v,Q]=t.useState(null),[V,K]=t.useState(!0),[le,oe]=t.useState(!1),[O,ke]=t.useState(!1),[ee,ve]=t.useState(null),[X,Z]=t.useState({name:"",phone:"",password:"",role:"helper",bonusPercentage:0}),[L,xe]=t.useState({name:"",login:"",phone:"",password:"",confirmPassword:"",role:"helper",bonusPercentage:0}),[I,de]=t.useState(!1);t.useEffect(()=>{F(),S(),ue()},[]);const ue=()=>E(this,null,function*(){try{const m=yield _.get("/auth/admin/kassa-users");if(m.data.success&&m.data.users.length>0){const te=m.data.users[0];z({login:te.login,name:te.name})}}catch(m){console.error("Error fetching kassa user:",m)}}),F=()=>E(this,null,function*(){try{const m=yield _.get("/auth/admin/helpers");l(m.data.users||m.data)}catch(m){console.error("Error fetching helpers:",m)}finally{K(!1)}}),S=()=>E(this,null,function*(){try{const m=yield _.get("/receipts/helpers-stats");k(m.data)}catch(m){console.error("Error fetching helpers stats:",m)}}),be=m=>E(this,null,function*(){oe(!0);try{const te=yield _.get(`/receipts/helper/${m}/receipts`);b(te.data.receipts)}catch(te){console.error("Error fetching helper receipts:",te)}finally{oe(!1)}}),W=m=>{q(m),T(!0),be(m._id)},Se=m=>{const te=ut(m.target.value);Z(j(g({},X),{phone:te}))},Be=m=>E(this,null,function*(){var te,Ce;m.preventDefault(),ke(!0);try{const ze=g(g({name:X.name,phone:Rt(X.phone),role:X.role},X.password&&{password:X.password}),X.role==="cashier"&&{bonusPercentage:X.bonusPercentage});if(v)yield _.put(`/auth/admin/helpers/${v._id}`,ze),k(h.map(ne=>ne._id===v._id?j(g({},ne),{name:X.name,role:X.role,bonusPercentage:X.bonusPercentage}):ne)),l(u.map(ne=>ne._id===v._id?j(g({},ne),{name:X.name,role:X.role,phone:Rt(X.phone)}):ne));else{yield _.post("/users",j(g({},ze),{password:X.password}));const ne={_id:Math.random().toString(),name:X.name,role:X.role,receiptCount:0,totalAmount:0,bonusPercentage:X.bonusPercentage||0,totalEarnings:0,totalBonus:0};k([...h,ne])}setTimeout(()=>{Ge(),ke(!1)},2e3)}catch(ze){ke(!1),alert(((Ce=(te=ze.response)==null?void 0:te.data)==null?void 0:Ce.message)||"Xatolik yuz berdi")}}),We=m=>E(this,null,function*(){var Ce,ze;if(yield a(`"${m.name}" yordamchisini o'chirishni tasdiqlaysizmi?`,"Yordamchini o'chirish")){ve(m._id);try{yield _.delete(`/auth/admin/helpers/${m._id}`),k(h.filter(ne=>ne._id!==m._id)),l(u.filter(ne=>ne._id!==m._id)),n("Yordamchi muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),setTimeout(()=>{ve(null)},2e3)}catch(ne){ve(null),console.error("Error deleting helper:",ne),n(`Yordamchini o'chirishda xatolik: ${((ze=(Ce=ne.response)==null?void 0:Ce.data)==null?void 0:ze.message)||ne.message}`,"Xatolik","danger")}}}),Qe=m=>{Q(m),Z({name:m.name,phone:$a(m.phone),password:"",role:m.role,bonusPercentage:m.bonusPercentage||0}),y(!0)},Ge=()=>{y(!1),Q(null),Z({name:"",phone:"",password:"",role:"helper",bonusPercentage:0})},Fe=()=>{D(!1),xe({name:"",login:"",phone:"",password:"",confirmPassword:"",role:"helper",bonusPercentage:0})},Ve=m=>E(this,null,function*(){var te,Ce;if(m.preventDefault(),L.password!==L.confirmPassword){n("Parollar mos kelmadi","Xatolik","danger");return}if(L.password.length<6){n("Parol kamida 6 ta belgidan iborat bo'lishi kerak","Xatolik","danger");return}de(!0);try{const ze={name:L.name,login:L.login,phone:Rt(L.phone),password:L.password};console.log("ðŸ“¤ Xodim yaratish so'rovi:",ze);const ne=yield _.post("/auth/admin/helpers",ze);console.log("âœ… Server javobi:",ne.data);const Ze={_id:ne.data.user._id,name:ne.data.user.name,login:ne.data.user.login,phone:ne.data.user.phone,role:ne.data.user.role,receiptCount:0,totalAmount:0,totalEarnings:0,totalBonus:0};k([...h,Ze]),n("Xodim muvaffaqiyatli qo'shildi","Muvaffaqiyat","success"),setTimeout(()=>{Fe(),de(!1)},2e3)}catch(ze){de(!1),n(((Ce=(te=ze.response)==null?void 0:te.data)==null?void 0:Ce.message)||"Xatolik yuz berdi","Xatolik","danger")}});return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsx(Fs,{title:"Yordamchilar",actions:e.jsxs("button",{onClick:()=>D(!0),className:"btn-primary",children:[e.jsx(ds,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yordamchi qo'shish"})]})}),e.jsx("div",{className:"p-4 lg:p-6",children:V?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):u.length===0?e.jsxs("div",{className:"card flex flex-col items-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(aa,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Yordamchilar yo'q"}),e.jsx("p",{className:"text-surface-500 mb-6",children:"Birinchi yordamchini qo'shing"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-6 shadow-lg border-2 border-purple-400",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(Js,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white text-lg",children:"Kassa Paneli Kodi"}),e.jsx("p",{className:"text-purple-100 text-sm",children:"Admin tomonidan belgilangan login va parol"})]})]}),e.jsx("div",{className:"bg-white/20 backdrop-blur-sm px-3 py-1 rounded-lg",children:e.jsx("span",{className:"text-white text-xs font-semibold",children:"Maxsus"})})]}),p?e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Ism:"}),e.jsx("span",{className:"text-white font-bold",children:p.name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Login:"}),e.jsx("span",{className:"text-white font-bold",children:p.login})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Parol:"}),e.jsx("span",{className:"text-white font-bold",children:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-white/20",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Rol:"}),e.jsx("span",{className:"bg-white/20 text-white px-3 py-1 rounded-lg text-xs font-semibold",children:"Kassir"})]}),e.jsx("div",{className:"pt-3 border-t border-white/20",children:e.jsxs("a",{href:"/admin/settings",className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white rounded-lg font-semibold transition-all duration-300 hover:shadow-lg",children:[e.jsx(ws,{className:"w-4 h-4"}),"Parolni o'zgartirish"]})})]}):e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-white text-sm",children:"Kassa foydalanuvchisi topilmadi"}),e.jsx("p",{className:"text-purple-100 text-xs mt-2",children:"Admin sozlamalarida kassa yarating"})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-purple-100 text-xs",children:[e.jsx(ws,{className:"w-4 h-4"}),e.jsx("span",{children:"Bu karta o'chirib bo'lmaydi. Faqat Admin Sozlamalari â†’ Kassa Foydalanuvchilari bo'limida o'zgartirish mumkin."})]})]}),e.jsx("h2",{className:"text-lg font-semibold text-surface-900 mb-4",children:"Kassirlar statistikasi"}),h.length===0?e.jsx("p",{className:"text-surface-500 text-center py-8",children:"Hali cheklar chiqarilmagan"}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 max-w-4xl",children:h.map(m=>e.jsxs("div",{className:"group bg-white rounded-xl p-3 shadow-sm border border-surface-200 hover:shadow-lg hover:border-brand-300 transition-all duration-300 hover:-translate-y-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center text-white font-bold text-base flex-shrink-0",children:m.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm text-surface-900 truncate",title:m.name,children:m.name}),e.jsx("span",{className:`inline-block text-[10px] px-1.5 py-0.5 rounded-full font-semibold mt-0.5 ${m.role==="cashier"?"bg-success-100 text-success-700":"bg-brand-100 text-brand-700"}`,children:m.role==="cashier"?"Kassir":"Yordamchi"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 pt-4 border-t border-surface-100 flex-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-bold text-brand-600",children:m.receiptCount}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Cheklar"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-success-600",children:w(m.totalAmount)}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Savdo"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xl font-bold text-orange-600",children:[m.bonusPercentage,"%"]}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Bonus"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6 pt-4 border-t border-surface-100",children:[e.jsx("button",{onClick:te=>{te.stopPropagation();const Ce=u.find(ze=>ze.name===m.name);Ce&&Qe(Ce)},className:"p-2.5 hover:bg-brand-100 hover:text-brand-600 text-surface-400 rounded-lg transition-all hover:shadow-md hover:-translate-y-0.5",title:"Tahrirlash",children:e.jsx(tt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:te=>{te.stopPropagation(),W(m)},className:"p-2.5 hover:bg-blue-100 hover:text-blue-600 text-surface-400 rounded-lg transition-all hover:shadow-md hover:-translate-y-0.5",title:"Cheklar",children:e.jsx(Qs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:te=>{te.stopPropagation(),We(m)},disabled:ee===m._id,className:"p-2.5 hover:bg-danger-100 hover:text-danger-600 text-surface-400 rounded-lg transition-all hover:shadow-md hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed",title:"O'chirish",children:ee===m._id?e.jsx("div",{className:"w-4 h-4 border-2 border-danger-600 border-t-transparent rounded-full animate-spin"}):e.jsx(Ps,{className:"w-4 h-4"})})]})]},m._id))})]})}),N&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-3 md:p-4 bg-black/50",children:[e.jsx("div",{className:"overlay",onClick:Fe}),e.jsxs("div",{className:"modal w-full max-w-[95%] xs:max-w-sm sm:max-w-md p-3 sm:p-4 md:p-5 relative z-50 max-h-[85vh] overflow-y-auto bg-white rounded-xl sm:rounded-2xl shadow-2xl my-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3 pb-2 sm:pb-3 border-b border-surface-200",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-surface-900",children:"Yordamchi qo'shish"}),e.jsx("button",{onClick:Fe,className:"btn-icon-sm",children:e.jsx(fe,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("form",{onSubmit:Ve,className:"space-y-2 sm:space-y-3 flex flex-col h-full",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Ism"}),e.jsxs("div",{className:"relative",children:[e.jsx(ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Yordamchi ismi",value:L.name,onChange:m=>xe(j(g({},L),{name:m.target.value})),disabled:I,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Login"}),e.jsxs("div",{className:"relative",children:[e.jsx(ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Login (foydalanuvchi nomi)",value:L.login,onChange:m=>xe(j(g({},L),{login:m.target.value})),disabled:I,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Telefon raqam"}),e.jsxs("div",{className:"relative",children:[e.jsx(Es,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"tel",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"+998 (XX) XXX-XX-XX",value:L.phone,onChange:m=>xe(j(g({},L),{phone:ut(m.target.value)})),disabled:I,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Parol"}),e.jsxs("div",{className:"relative",children:[e.jsx(ws,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"password",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Kamida 6 ta belgi",value:L.password,onChange:m=>xe(j(g({},L),{password:m.target.value})),disabled:I,required:!0,minLength:6})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Parolni tasdiqlash"}),e.jsxs("div",{className:"relative",children:[e.jsx(ws,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"password",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Parolni qayta kiriting",value:L.confirmPassword,onChange:m=>xe(j(g({},L),{confirmPassword:m.target.value})),disabled:I,required:!0,minLength:6})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-2 block",children:"Rol"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>xe(j(g({},L),{role:"cashier"})),disabled:I,className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed ${L.role==="cashier"?"border-success-500 bg-success-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(hs,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${L.role==="cashier"?"text-success-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Kassir"})]}),e.jsxs("button",{type:"button",onClick:()=>xe(j(g({},L),{role:"helper"})),disabled:I,className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed ${L.role==="helper"?"border-brand-500 bg-brand-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(Js,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${L.role==="helper"?"text-brand-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Yordamchi"})]})]})]}),L.role==="cashier"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Bonus foizi (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx(is,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"number",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Masalan: 1",value:L.bonusPercentage,min:"0",max:"100",step:"0.1",disabled:I,onChange:m=>xe(j(g({},L),{bonusPercentage:parseFloat(m.target.value)||0}))})]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-surface-500 mt-0.5 sm:mt-1",children:[L.bonusPercentage,"% bonus"]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 mt-auto border-t border-surface-100",children:[e.jsx("button",{type:"button",onClick:Fe,disabled:I,className:"btn-secondary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Bekor"}),e.jsx("button",{type:"submit",disabled:I,className:"btn-primary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Qo'shilmoqda..."})]}):"Qo'shish"})]})]})]})]}),f&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-3 md:p-4 bg-black/50",children:[e.jsx("div",{className:"overlay",onClick:Ge}),e.jsxs("div",{className:"modal w-full max-w-[95%] xs:max-w-sm sm:max-w-md p-3 sm:p-4 md:p-5 relative z-50 max-h-[85vh] overflow-y-auto bg-white rounded-xl sm:rounded-2xl shadow-2xl my-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3 pb-2 sm:pb-3 border-b border-surface-200",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-surface-900",children:v?"Tahrirlash":"Yangi yordamchi"}),e.jsx("button",{onClick:Ge,className:"btn-icon-sm",children:e.jsx(fe,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("form",{onSubmit:Be,className:"space-y-2 sm:space-y-3 flex flex-col h-full",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Ism"}),e.jsxs("div",{className:"relative",children:[e.jsx(ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-9 text-sm",placeholder:"Yordamchi ismi",value:X.name,onChange:m=>Z(j(g({},X),{name:m.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Telefon raqam"}),e.jsxs("div",{className:"relative",children:[e.jsx(Es,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"tel",className:"input pl-9 text-sm",placeholder:"+998 (XX) XXX-XX-XX",value:X.phone,onChange:Se,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:v?"Yangi parol (ixtiyoriy)":"Parol"}),e.jsxs("div",{className:"relative",children:[e.jsx(ws,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",g({type:"password",className:"input pl-9 text-sm",placeholder:v?"O'zgartirmaslik uchun bo'sh qoldiring":"Parol",value:X.password,onChange:m=>Z(j(g({},X),{password:m.target.value}))},!v&&{required:!0,minLength:6}))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-2 block",children:"Rol"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>Z(j(g({},X),{role:"cashier"})),className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm ${X.role==="cashier"?"border-success-500 bg-success-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(hs,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${X.role==="cashier"?"text-success-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Kassir"})]}),e.jsxs("button",{type:"button",onClick:()=>Z(j(g({},X),{role:"helper"})),className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm ${X.role==="helper"?"border-brand-500 bg-brand-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(Js,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${X.role==="helper"?"text-brand-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Yordamchi"})]})]})]}),X.role==="cashier"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Bonus foizi (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx(is,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"number",className:"input pl-9 text-sm",placeholder:"Masalan: 1",value:X.bonusPercentage,min:"0",max:"100",step:"0.1",onChange:m=>Z(j(g({},X),{bonusPercentage:parseFloat(m.target.value)||0}))})]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-surface-500 mt-0.5 sm:mt-1",children:[X.bonusPercentage,"% bonus"]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 mt-auto border-t border-surface-100",children:[e.jsx("button",{type:"button",onClick:Ge,disabled:O,className:"btn-secondary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Bekor"}),e.jsx("button",{type:"submit",disabled:O,className:"btn-primary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:O?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Saqlanmoqda..."})]}):"Saqlash"})]})]})]})]}),i&&M&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-2 sm:p-3 md:p-4 bg-black/50",children:["`n          ",e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>T(!1)}),e.jsxs("div",{className:"modal w-full max-w-[98%] sm:max-w-[95%] md:max-w-4xl max-h-[90vh] overflow-hidden relative z-50 bg-white rounded-2xl shadow-2xl",children:[e.jsxs("div",{className:"p-6 border-b border-surface-100 bg-gradient-to-r from-brand-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center text-white font-bold text-lg",children:M.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-surface-900",children:M.name}),e.jsx("span",{className:`text-sm px-3 py-1 rounded-full font-medium ${M.role==="cashier"?"bg-success-100 text-success-700":"bg-brand-100 text-brand-700"}`,children:M.role==="cashier"?"Kassir":"Yordamchi"})]})]}),e.jsx("button",{onClick:()=>T(!1),className:"btn-icon-sm hover:bg-white/50",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(_s,{className:"w-5 h-5 text-brand-600"})}),e.jsx("p",{className:"text-2xl font-bold text-surface-900",children:M.receiptCount}),e.jsx("p",{className:"text-xs text-surface-500",children:"Cheklar"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(is,{className:"w-5 h-5 text-success-600"})}),e.jsx("p",{className:"text-lg font-bold text-success-600",children:w(M.totalAmount)}),e.jsx("p",{className:"text-xs text-surface-500",children:"Savdo"})]}),M.bonusPercentage>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx("span",{className:"text-orange-500 font-bold",children:"%"})}),e.jsxs("p",{className:"text-lg font-bold text-orange-600",children:[M.bonusPercentage,"%"]}),e.jsx("p",{className:"text-xs text-surface-500",children:"Bonus foizi"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(is,{className:"w-5 h-5 text-green-600"})}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:w(M.totalAmount*M.bonusPercentage/100)}),e.jsx("p",{className:"text-xs text-surface-500",children:"Jami bonus"})]})]})]})]}),e.jsx("div",{className:"p-6 overflow-auto max-h-[calc(90vh-120px)]",children:le?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):$.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(_s,{className:"w-12 h-12 mx-auto mb-4 text-surface-400"}),e.jsx("p",{className:"text-surface-500",children:"Cheklar topilmadi"})]}):e.jsx("div",{className:"space-y-3",children:$.map(m=>e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-surface-100 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(_s,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-surface-900",children:["Chek #",m._id.slice(-6)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500",children:[e.jsx(Xs,{className:"w-4 h-4"}),new Date(m.createdAt).toLocaleString("uz-UZ")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-brand-600",children:w(m.total)}),e.jsx("p",{className:"text-sm text-surface-500",children:"so'm"})]})]}),e.jsxs("div",{className:"border-t border-surface-100 pt-4",children:[e.jsx("h5",{className:"text-sm font-medium text-surface-700 mb-3",children:"Mahsulotlar:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:m.items.map((te,Ce)=>e.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-surface-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-surface-700 font-medium",children:te.name}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-sm text-surface-600",children:[te.quantity," Ã— ",w(te.price)]}),e.jsxs("p",{className:"text-sm font-semibold text-surface-900",children:[w(te.price*te.quantity)," so'm"]})]})]},Ce))})]})]},m._id))})})]})]})]})}const Aa=a=>{const n=a.date||new Date,r=a.receiptNumber||`CHK-${Date.now()}`,u=a.cashier||"Kassa";let l="";l+=`========================
`,l+=`SARDOR FURNITURA
`,l+=`========================
`,l+=`
`,l+=`CHK: ${r}
`,l+=`${n.toLocaleDateString("uz-UZ")} ${n.toLocaleTimeString("uz-UZ",{hour:"2-digit",minute:"2-digit"})}
`,l+=`KASSIR: ${u}
`,a.customer&&(l+=`MIJOZ: ${a.customer.name}
`,l+=`TEL: ${a.customer.phone}
`),l+=`------------------------
`;let h=0,k=0;if(a.items.forEach((f,y)=>{l+=`${y+1}. ${f.name}
`,l+=`   ${f.code}
`;const N=f.previousPrice,D=f.currentPrice||f.price;if(h+=(N&&N>0?N:D)*f.cartQuantity,k+=D*f.cartQuantity,N&&N>0&&N!==D){const i=Math.round((N-D)/N*100);l+=`   OLDINGI: ${w(N)}
`,l+=`   HOZIRGI: ${w(D)}`,i>0?l+=` (-${i}%)
`:i<0?l+=` (+${Math.abs(i)}%)
`:l+=`
`}else l+=`   NARXI: ${w(f.price)}
`;l+=`   ${f.cartQuantity} x ${w(D)}
`,l+=`   = ${w(D*f.cartQuantity)}
`,l+=`
`}),l+=`------------------------
`,l+=`JAMI: ${w(a.total)}
`,h>k){const f=h-k,y=Math.round(f/h*100);l+=`CHEGIRMA: ${w(f)}
`,l+=`(${y}%)
`}const p=a.items.reduce((f,y)=>{var N;return f+(((N=y.paymentBreakdown)==null?void 0:N.cash)||0)},0),z=a.items.reduce((f,y)=>{var N;return f+(((N=y.paymentBreakdown)==null?void 0:N.click)||0)},0),$=a.items.reduce((f,y)=>{var N;return f+(((N=y.paymentBreakdown)==null?void 0:N.card)||0)},0);p>0&&(l+=`NAQT: ${w(p)}
`),z>0&&(l+=`CLICK: ${w(z)}
`),$>0&&(l+=`KARTA: ${w($)}
`),l+=`TO'LOV: ${a.paymentMethod==="cash"?"NAQD":a.paymentMethod==="click"?"CLICK":"KARTA"}
`;const b=Math.floor(a.total/1e6);return b>0&&(l+=`------------------------
`,l+=`BALL: +${b} BALL!
`),a.customer&&a.customer.totalBalls&&(l+=`JAMI: ${a.customer.totalBalls} BALL
`),l+=`========================
`,l+=`XARIDINGIZ UCHUN
`,l+=`RAHMAT!
`,l+=`========================
`,l+=`
`,l+=`âš ï¸ VAZVRAT CHEKSIZ âš ï¸
`,l+=`QABUL QILINMAYDI
`,l+=`========================
`,l},rl=(a,n)=>E(es,null,function*(){var r;try{const u=Aa(a),l=document.createElement("iframe");l.style.position="absolute",l.style.left="-9999px",l.style.top="-9999px",l.style.width="1px",l.style.height="1px",l.style.visibility="hidden",l.style.opacity="0",document.body.appendChild(l);const h=l.contentDocument||((r=l.contentWindow)==null?void 0:r.document);if(!h)throw new Error("Iframe document topilmadi");const k=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>X PRINTER CHEK</title>
          <meta charset="UTF-8">
          <style>
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            
            body {
              font-family: 'Courier New', monospace;
              font-size: 12px;
              font-weight: bold;
              line-height: 1.2;
              color: #000;
              background: white;
              padding: 0;
              margin: 0 auto;
              display: flex;
              justify-content: center;
              align-items: flex-start;
              width: 100%;
            }
            
            .receipt-text {
              white-space: pre-line;
              font-family: 'Courier New', monospace;
              font-size: 12px;
              font-weight: bold;
              word-break: break-word;
              padding: 5px;
              text-align: center;
              width: 58mm;
              margin: 0 auto;
            }
            
            /* X Printer uchun maxsus print sozlamalari */
            @media print {
              @page {
                size: 58mm auto;
                margin: 0;
                padding: 0;
              }
              
              body {
                background: white;
                font-size: 10px;
                font-weight: bold;
                padding: 0;
                margin: 0 auto;
                width: 58mm;
                display: flex;
                justify-content: center;
                align-items: flex-start;
              }
              
              .receipt-text {
                width: 58mm;
                font-weight: bold;
                font-size: 10px;
                padding: 2mm;
                text-align: center;
                margin: 0 auto;
              }
            }
          </style>
        </head>
        <body>
          <div class="receipt-text">${u}</div>
          
          <script>
            // X Printer uchun print tugagandan keyin callback
            window.addEventListener('afterprint', function() {
              console.log('X Printer: Print tugadi');
              if (window.parent && window.parent.xPrinterCompleted) {
                window.parent.xPrinterCompleted();
              }
            });
            
            // X Printer uchun avtomatik print
            window.addEventListener('load', function() {
              setTimeout(function() {
                console.log('X Printer: Print boshlanmoqda...');
                window.print();
              }, 300);
            });
          <\/script>
        </body>
      </html>
    `;return h.open(),h.write(k),h.close(),n&&(window.xPrinterCompleted=()=>{console.log("X Printer: Callback chaqirildi"),n(),setTimeout(()=>{document.body.contains(l)&&document.body.removeChild(l)},1e3),delete window.xPrinterCompleted}),n||setTimeout(()=>{document.body.contains(l)&&document.body.removeChild(l)},3e3),console.log("X Printer: Chek tayyorlandi va yuborildi"),!0}catch(u){console.error("X Printer xatosi:",u);try{return ll(a),!1}catch(l){return console.error("Faylni yuklashda xatolik:",l),!1}}}),La=(a,n)=>E(es,null,function*(){return yield rl(a,n)}),ll=a=>{const n=Aa(a),r=new Blob([n],{type:"text/plain;charset=utf-8"}),u=URL.createObjectURL(r),l=document.createElement("a");l.href=u,l.download=`chek-${a.receiptNumber||Date.now()}.txt`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(u)},nl=()=>E(es,null,function*(){var a;try{if(navigator.printing&&navigator.printing.getPrinters){const n=yield navigator.printing.getPrinters(),r=n.map(l=>l.name||l.id),u=r.some(l=>l.toLowerCase().includes("x printer")||l.toLowerCase().includes("xprinter")||l.toLowerCase().includes("x-printer"));return{available:n.length>0,printers:r,defaultPrinter:(a=n.find(l=>l.isDefault))==null?void 0:a.name,xPrinterFound:u}}return{available:"print"in window,printers:["Browser Default Printer","X Printer (Auto-detect)"],defaultPrinter:"X Printer (Auto-detect)",xPrinterFound:!0}}catch(n){return console.error("Printer holatini tekshirishda xatolik:",n),{available:!1,printers:[],defaultPrinter:void 0,xPrinterFound:!1}}});function ba(){const{showAlert:a,AlertComponent:n}=Ns(),[r,u]=t.useState([]),[l,h]=t.useState([]),[k,p]=t.useState(!0),[z,$]=t.useState(""),[b,f]=t.useState(""),[y,N]=t.useState(""),[D,i]=t.useState(""),[T,M]=t.useState(null),[q,v]=t.useState(1),[Q,V]=t.useState(1),[K,le]=t.useState(null),[oe,O]=t.useState(null),[ke,ee]=t.useState(null),[ve,X]=t.useState({totalReceipts:0,totalAmount:0,totalItems:0});t.useEffect(()=>{Z(),L()},[]),t.useEffect(()=>{L()},[z,b,y,D,q]);const Z=()=>E(this,null,function*(){try{const S=yield _.get("/receipts/helpers-stats");h(S.data)}catch(S){console.error("Error fetching helpers:",S)}}),L=()=>E(this,null,function*(){try{p(!0);const S=new URLSearchParams({page:q.toString(),limit:"20"});z&&S.append("helperId",z),b&&S.append("startDate",b),y&&S.append("endDate",y),D&&S.append("search",D);const be=yield _.get(`/receipts/all-helper-receipts?${S}`);u(be.data.receipts),V(be.data.pagination.totalPages),X(be.data.summary)}catch(S){console.error("Error fetching receipts:",S),a("Cheklar yuklanmadi","Xatolik","danger")}finally{p(!1)}}),xe=S=>{M(T===S?null:S)},I=S=>new Date(S).toLocaleDateString("uz-UZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),de=()=>{$(""),f(""),N(""),i(""),v(1)},ue=S=>E(this,null,function*(){var be;try{le(S._id);const W={items:S.items.map(Be=>({_id:Be._id,name:Be.name,code:Be.code,price:Be.price,cartQuantity:Be.quantity,quantity:Be.quantity,warehouse:"main",category:"",image:Be.image||void 0})),total:S.total,paymentMethod:S.paymentMethod,receiptNumber:S.receiptNumber,cashier:((be=S.helper)==null?void 0:be.name)||"Xodim",date:new Date(S.createdAt)};(yield La(W,()=>{console.log("Chek chiqarildi:",S.receiptNumber)}))?a("Chek muvaffaqiyatli chiqarildi","Muvaffaqiyat","success"):a("Chek chiqarishda xatolik yuz berdi","Xatolik","warning")}catch(W){console.error("Print error:",W),a("Chek chiqarishda xatolik yuz berdi","Xatolik","danger")}finally{le(null)}}),F=S=>E(this,null,function*(){var be,W;try{O(S);const Se=yield _.delete(`/receipts/helper-receipt/${S}`);Se.data.success?(a("Chek muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),L(),Z()):a(Se.data.message||"Chekni o'chirishda xatolik","Xatolik","danger")}catch(Se){console.error("Delete error:",Se),a(((W=(be=Se.response)==null?void 0:be.data)==null?void 0:W.message)||"Chekni o'chirishda xatolik yuz berdi","Xatolik","danger")}finally{O(null),ee(null)}});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-blue-100/30 to-slate-100 pb-20 lg:pb-0",children:[n,e.jsx(Fs,{title:"Xodimlar cheklari"}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Jami cheklar"}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:ve.totalReceipts})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg",children:e.jsx(_s,{className:"w-7 h-7 text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Jami summa"}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:w(ve.totalAmount)}),e.jsx("p",{className:"text-slate-500 text-xs mt-1",children:"UZS"})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center shadow-lg",children:e.jsx(is,{className:"w-7 h-7 text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Jami mahsulotlar"}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:ve.totalItems})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg",children:e.jsx(Ie,{className:"w-7 h-7 text-white"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(tr,{className:"w-5 h-5 text-slate-600"}),e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Filtrlar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(ls,{className:"w-4 h-4 inline mr-1"}),"Xodim"]}),e.jsxs("select",{value:z,onChange:S=>{$(S.target.value),v(1)},className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",children:[e.jsx("option",{value:"",children:"Barchasi"}),l.map(S=>e.jsxs("option",{value:S._id,children:[S.name," (",S.receiptCount," ta chek)"]},S._id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(Xs,{className:"w-4 h-4 inline mr-1"}),"Boshlanish"]}),e.jsx("input",{type:"date",value:b,onChange:S=>{f(S.target.value),v(1)},className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(Xs,{className:"w-4 h-4 inline mr-1"}),"Tugash"]}),e.jsx("input",{type:"date",value:y,onChange:S=>{N(S.target.value),v(1)},className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(gs,{className:"w-4 h-4 inline mr-1"}),"Qidiruv"]}),e.jsx("input",{type:"text",value:D,onChange:S=>{i(S.target.value),v(1)},placeholder:"Chek raqami yoki mahsulot",className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),(z||b||y||D)&&e.jsx("button",{onClick:de,className:"mt-4 px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-lg transition-all",children:"Filtrlarni tozalash"})]}),k?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(S=>e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-slate-200 rounded mb-4 w-1/2"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded w-3/4"})]},S))}):r.length===0?e.jsxs("div",{className:"bg-white rounded-2xl p-12 shadow-lg border border-slate-200/60 text-center",children:[e.jsx(Hs,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:"Cheklar topilmadi"}),e.jsx("p",{className:"text-slate-600",children:"Tanlangan filtrlar bo'yicha cheklar mavjud emas"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(S=>{var be,W;return e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200/60 overflow-hidden hover:shadow-xl transition-all duration-300",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-3 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(_s,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-sm truncate",children:S.receiptNumber}),e.jsxs("span",{className:"px-2 py-0.5 bg-white/20 rounded text-xs font-medium flex-shrink-0",children:[S.itemsCount," ta"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("button",{onClick:()=>ue(S),disabled:K===S._id,className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Chekni chiqarish",children:K===S._id?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Gs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ee(S._id),disabled:oe===S._id,className:"p-1.5 bg-red-500/80 hover:bg-red-600 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Chekni o'chirish",children:oe===S._id?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Ps,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-50 text-xs",children:[e.jsx(ls,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"Mijoz:"}),e.jsx("span",{className:"truncate",children:S.customer?S.customer.name:"Oddiy mijoz"})]}),(S.helper||S.createdBy)&&e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-50 text-xs",children:[e.jsx(ls,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"Hodim:"}),e.jsx("span",{className:"truncate",children:((be=S.helper)==null?void 0:be.name)||((W=S.createdBy)==null?void 0:W.name)||"Noma'lum"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-100 text-xs mt-1.5",children:[e.jsx(dt,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:I(S.createdAt)})]})]}),e.jsxs("div",{className:"p-3 space-y-3",children:[S.helper&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-white font-bold text-xs flex-shrink-0",children:S.helper.name.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-slate-900 text-xs truncate",children:S.helper.name}),e.jsx("p",{className:"text-[10px] text-slate-600 capitalize truncate",children:S.helper.role})]}),S.helper.bonusPercentage>0&&e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"text-[10px] text-slate-600",children:"Bonus"}),e.jsxs("p",{className:"font-bold text-emerald-600 text-xs",children:[S.helper.bonusPercentage,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-emerald-50 to-emerald-100 rounded-xl",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-emerald-700 font-medium mb-0.5",children:"Jami summa"}),e.jsx("p",{className:"text-xl font-bold text-emerald-900 truncate",children:w(S.total)}),e.jsx("p",{className:"text-[10px] text-emerald-600",children:"UZS"})]}),S.bonusAmount>0&&e.jsxs("div",{className:"text-right flex-shrink-0 ml-2",children:[e.jsx("p",{className:"text-[10px] text-emerald-700 font-medium mb-0.5",children:"Bonus"}),e.jsx("p",{className:"text-base font-bold text-emerald-900",children:w(S.bonusAmount)})]})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>xe(S._id),className:"w-full flex items-center justify-between p-2 bg-slate-50 hover:bg-slate-100 rounded-xl transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(Ie,{className:"w-3.5 h-3.5 text-slate-600 flex-shrink-0"}),e.jsxs("span",{className:"font-medium text-slate-900 text-xs truncate",children:["Mahsulotlar (",S.totalQuantity," dona)"]})]}),T===S._id?e.jsx(ka,{className:"w-4 h-4 text-slate-600 flex-shrink-0"}):e.jsx(zt,{className:"w-4 h-4 text-slate-600 flex-shrink-0"})]}),T===S._id&&e.jsx("div",{className:"mt-2 space-y-1.5 max-h-64 overflow-y-auto",children:S.items.map(Se=>e.jsx("div",{className:"flex items-center gap-2 p-2 bg-white border border-slate-200 rounded-xl hover:border-blue-300 transition-all",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-slate-900 text-xs truncate",children:Se.name}),e.jsxs("p",{className:"text-[10px] text-slate-600 truncate",children:["Kod: ",Se.code]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5",children:[e.jsxs("span",{className:"text-xs text-slate-600 truncate",children:[Se.quantity," x ",w(Se.price)]}),e.jsxs("span",{className:"text-xs font-bold text-blue-600 flex-shrink-0",children:["= ",w(Se.total)]})]})]})},Se._id))})]})]})]},S._id)})}),Q>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6",children:[e.jsx("button",{onClick:()=>v(S=>Math.max(1,S-1)),disabled:q===1,className:"px-4 py-2 rounded-xl bg-white border border-slate-300 text-slate-700 font-medium hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Oldingi"}),e.jsxs("span",{className:"px-4 py-2 text-slate-700 font-medium",children:[q," / ",Q]}),e.jsx("button",{onClick:()=>v(S=>Math.min(Q,S+1)),disabled:q===Q,className:"px-4 py-2 rounded-xl bg-white border border-slate-300 text-slate-700 font-medium hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Keyingi"})]})]})]}),ke&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-scale-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx(Ps,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"Chekni o'chirish"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Bu amalni qaytarib bo'lmaydi"})]})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:[e.jsxs("p",{className:"text-sm text-red-800 mb-2",children:[e.jsx("strong",{children:"Diqqat!"})," Chekni o'chirsangiz:"]}),e.jsxs("ul",{className:"text-sm text-red-700 space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ Mahsulot miqdorlari qaytariladi"}),e.jsx("li",{children:"â€¢ Xodim bonusi ayriladi"}),e.jsx("li",{children:"â€¢ Statistika yangilanadi"}),e.jsx("li",{children:"â€¢ Bu amalni bekor qilib bo'lmaydi"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>ee(null),disabled:oe===ke,className:"flex-1 px-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-all disabled:opacity-50",children:"Bekor qilish"}),e.jsx("button",{onClick:()=>F(ke),disabled:oe===ke,className:"flex-1 px-4 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-xl transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:oe===ke?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"O'chirilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ps,{className:"w-5 h-5"}),"O'chirish"]})})]})]})})]})}function il(){const[a,n]=t.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-surface-50",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(Ta,{items:Tr,basePath:"/cashier",collapsed:a,setCollapsed:n})}),e.jsx("main",{className:`transition-all duration-300 ease-smooth ${a?"lg:ml-[72px]":"lg:ml-64"}`,children:e.jsx(Ot,{})})]})}function ol(){const{user:a,logout:n}=Vs();return e.jsxs("div",{className:"min-h-screen bg-surface-50",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-white/80 backdrop-blur-xl border-b border-surface-200/60",children:e.jsxs("div",{className:"px-3 sm:px-4 h-14 sm:h-16 flex items-center justify-between max-w-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-shrink",children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center shadow-sm flex-shrink-0",children:e.jsx(ar,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),e.jsx("span",{className:"font-bold text-base sm:text-lg text-surface-900 hidden sm:inline truncate",children:"Sardorbek.Furnetura"}),e.jsx("span",{className:"font-bold text-sm text-surface-900 sm:hidden truncate",children:"Sardorbek"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[e.jsx(ma,{variant:"icon"}),e.jsxs("div",{className:"hidden md:flex items-center gap-2 px-3 py-2 bg-surface-100 rounded-xl max-w-[150px]",children:[e.jsx(ls,{className:"w-4 h-4 text-surface-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-surface-700 truncate",children:a==null?void 0:a.name})]}),e.jsx("div",{className:"md:hidden flex items-center justify-center w-8 h-8 bg-surface-100 rounded-lg flex-shrink-0",children:e.jsx(ls,{className:"w-4 h-4 text-surface-500"})}),e.jsx("button",{onClick:n,className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg text-surface-500 hover:text-danger-600 hover:bg-danger-50 transition-colors flex-shrink-0",title:"Chiqish",children:e.jsx(_t,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]})}),e.jsx("main",{className:"p-3 sm:p-4",children:e.jsx(Ot,{})})]})}function cl(){var ze,ne,Ze,x,ce,$e,Ee,Ne,De;const{showAlert:a,AlertComponent:n}=Ns(),[r,u]=t.useState(!1),[l,h]=t.useState(""),[k,p]=t.useState([]),[z,$]=t.useState([]),[b,f]=t.useState([]),[y,N]=t.useState(null),[D,i]=t.useState(null),[T,M]=t.useState(!1),[q,v]=t.useState([]),[Q,V]=t.useState(null),[K,le]=t.useState(""),[oe,O]=t.useState(!1),[ke,ee]=t.useState(!1),[ve,X]=t.useState({name:"",phone:""}),[Z,L]=t.useState(!1),[xe,I]=t.useState("environment"),de=t.useRef(null);t.useEffect(()=>(ue(),F(),()=>{de.current&&de.current.stop().catch(()=>{})}),[]);const ue=()=>E(this,null,function*(){try{const B=yield _.get("/products"),c=B.data.data||B.data;$(Array.isArray(c)?c:[])}catch(B){console.error("Error fetching products:",B)}}),F=()=>E(this,null,function*(){try{const B=yield _.get("/customers");v(B.data.data||B.data||[])}catch(B){console.error("Error fetching customers:",B)}}),S=()=>E(this,null,function*(){var B,c;if(!ve.name.trim()||!ve.phone.trim()){a("Iltimos, ism va telefon raqamni kiriting!","Ogohlantirish","warning");return}L(!0);try{const he=(yield _.post("/customers",{name:ve.name.trim(),phone:ve.phone.trim()})).data;v(we=>[he,...we]),V(he),ee(!1),O(!1),X({name:"",phone:""}),a(`Mijoz ${he.name} qo'shildi!`,"Muvaffaqiyat","success")}catch(H){a(((c=(B=H==null?void 0:H.response)==null?void 0:B.data)==null?void 0:c.message)||"Mijoz qo'shishda xatolik","Xatolik","danger")}finally{L(!1)}}),be=()=>E(this,null,function*(){N(null),h(""),f([]),u(!0),yield new Promise(B=>setTimeout(B,100));try{if(!document.getElementById("qr-reader"))throw new Error("QR reader element topilmadi. Iltimos, qayta urinib ko'ring.");const c=new kr("qr-reader");de.current=c,yield c.start({facingMode:xe},{fps:30,qrbox:{width:250,height:250},aspectRatio:1,disableFlip:!1,videoConstraints:{facingMode:xe,width:{ideal:1280},height:{ideal:720}}},H=>E(this,null,function*(){var C;console.log("QR kod o'qildi:",H);let he=null;try{const Y=JSON.parse(H);Y&&typeof Y=="object"&&(Y.code?he=String(Y.code):(Y.id||Y._id)&&(he=String(Y.id||Y._id)))}catch(Y){}let we=he||H;if(we.includes("/product/")){const Y=we.split("/product/");Y.length>1&&(we=Y[1].split("?")[0].split("#")[0])}console.log("Qidiruv kaliti:",we);let ye=z.find(Y=>Y.code===we||Y._id===we);if(console.log("Local'da topildi:",!!ye),!ye)try{console.log("Serverdan qidirilmoqda:",we),ye=(yield _.get(`/products/scan-qr/${encodeURIComponent(we)}`)).data,console.log("Serverdan topildi:",!!ye)}catch(Y){console.error("Server qidiruv xatosi:",(C=Y.response)==null?void 0:C.status,Y.message)}ye?(N(ye),z.find(Y=>Y._id===ye._id)||$(Y=>[...Y,ye])):a("Tovar topilmadi: "+we,"Xatolik","warning"),W()}),()=>{})}catch(B){console.error("Scanner error:",B),u(!1);let c="Kamerani ishga tushirishda xatolik";B.name==="NotAllowedError"?c="Kamera ruxsati berilmadi. Brauzer sozlamalarida kamera ruxsatini yoqing.":B.name==="NotFoundError"?c="Kamera topilmadi. Qurilmangizda kamera borligini tekshiring.":B.name==="NotReadableError"?c="Kamera band. Boshqa ilova kamerani ishlatayotgan bo'lishi mumkin.":B.name==="NotSupportedError"?c="HTTPS kerak. Xavfsiz ulanish orqali kirish kerak.":B.message&&(c=B.message),a(c,"Xatolik","danger")}}),W=()=>E(this,null,function*(){if(de.current){try{yield de.current.stop()}catch(B){}de.current=null}u(!1)}),Se=()=>E(this,null,function*(){r?(yield W(),I(B=>B==="environment"?"user":"environment"),setTimeout(()=>{be()},300)):I(B=>B==="environment"?"user":"environment")}),Be=B=>{if(h(B),N(null),B.length>0){const c=z.filter(H=>H.name.toLowerCase().includes(B.toLowerCase())||H.code.toLowerCase().includes(B.toLowerCase()));f(c)}else f([])},We=(B,c)=>{let H=15;c>=100?H=11:c>=10?H=13:H=15;const he=B*(1+H/100);return Math.round(he)},Qe=B=>B>=100?{name:"100+ dona",markupPercent:11,discount:!0}:B>=10?{name:"10-99 dona",markupPercent:13,discount:!0}:{name:"1-9 dona",markupPercent:15,discount:!1},Ge=B=>{p(c=>{const H=c.find(we=>we._id===B._id);if(H){const we=H.cartQuantity+1,ye=We(B.price,we);return c.map(C=>C._id===B._id?j(g({},C),{cartQuantity:we,price:ye}):C)}const he=We(B.price,1);return[...c,j(g({},B),{cartQuantity:1,price:he})]}),h(""),f([]),N(null)},Fe=(B,c)=>{p(H=>H.map(he=>{if(he._id===B){const we=Math.max(1,he.cartQuantity+c),ye=z.find(C=>C._id===B);if(ye){const C=We(ye.price,we);return j(g({},he),{cartQuantity:we,price:C})}return j(g({},he),{cartQuantity:we})}return he}))},Ve=B=>{p(c=>c.filter(H=>H._id!==B))},m=()=>E(this,null,function*(){if(k.length===0){a("Savat bo'sh!","Ogohlantirish","warning");return}if(!Q){a("Iltimos, mijozni tanlang!","Ogohlantirish","warning"),O(!0);return}M(!0);try{const B={customer:Q._id==="default"?null:Q._id,items:k.map(H=>({product:H._id,name:H.name,code:H.code,price:H.price,quantity:H.cartQuantity})),total:Ce,paymentMethod:"cash",paidAmount:Ce,status:Q._id==="default"?"completed":"pending"};yield _.post("/receipts",B);const c=Q._id==="default"?"Oddiy mijoz":Q.name;a(`Chek ${c} uchun saqlandi!`,"Muvaffaqiyat","success"),p([]),V(null)}catch(B){console.error("Error sending receipt:",B),a("Xatolik yuz berdi","Xatolik","danger")}finally{M(!1)}}),te=q.filter(B=>B.name.toLowerCase().includes(K.toLowerCase())||B.phone.includes(K)),Ce=k.reduce((B,c)=>B+c.price*c.cartQuantity,0);return e.jsxs("div",{className:"min-h-[calc(100vh-120px)] bg-gradient-to-b from-surface-50 to-surface-100/80 rounded-3xl p-4 sm:p-6 lg:p-8 shadow-sm overflow-x-hidden",children:[n,e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-semibold text-surface-900 flex items-center gap-2",children:[e.jsx(xt,{className:"w-6 h-6 text-brand-600"}),"Skaner orqali savat to'ldirish"]}),e.jsx("p",{className:"text-sm text-surface-500 mt-1",children:"Tovarlarni QR kod orqali tezda toping, savatga qo'shing va kassaga yuboring."})]}),e.jsxs("button",{onClick:()=>O(!0),className:`flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-xl transition-all shadow-sm text-sm sm:text-base w-full sm:w-auto ${Q?"bg-green-50 border-2 border-green-500 text-green-700 hover:bg-green-100":"bg-brand-500 text-white hover:bg-brand-600"}`,children:[e.jsx(ls,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("div",{className:"text-xs font-medium",children:Q?"Mijoz tanlandi":"Mijoz tanlash"}),Q&&e.jsx("div",{className:"text-sm font-semibold truncate",children:Q.name})]})]})]}),oe&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-surface-200 flex items-center justify-between bg-gradient-to-r from-brand-500 to-brand-600",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(Ds,{className:"w-5 h-5"}),"Mijoz tanlash"]}),e.jsx("button",{onClick:()=>O(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/20 transition-colors text-white",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:ke?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900",children:"Yangi mijoz qo'shish"}),e.jsx("button",{onClick:()=>{ee(!1),X({name:"",phone:""})},className:"text-surface-500 hover:text-surface-700",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Ism"}),e.jsx("input",{type:"text",value:ve.name,onChange:B=>X(j(g({},ve),{name:B.target.value})),placeholder:"Alisher Karimov",className:"w-full px-4 py-2.5 border border-surface-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Telefon raqam"}),e.jsx("input",{type:"tel",value:ve.phone,onChange:B=>X(j(g({},ve),{phone:B.target.value})),placeholder:"+998901234567",className:"w-full px-4 py-2.5 border border-surface-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>{ee(!1),X({name:"",phone:""})},className:"flex-1 px-4 py-2.5 border border-surface-200 text-surface-700 rounded-xl hover:bg-surface-50 transition-colors font-medium",disabled:Z,children:"Bekor qilish"}),e.jsx("button",{onClick:S,disabled:Z,className:"flex-1 px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-xl transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:Z?"Qo'shilmoqda...":"Qo'shish"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(gs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",value:K,onChange:B=>le(B.target.value),placeholder:"Ism yoki telefon raqam...",className:"w-full pl-10 pr-4 py-2.5 border border-surface-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500",autoFocus:!0})]}),e.jsxs("button",{onClick:()=>ee(!0),className:"px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-xl transition-colors flex items-center gap-2 font-medium whitespace-nowrap",children:[e.jsx(ds,{className:"w-4 h-4"}),"Yangi"]})]}),e.jsxs("div",{className:"max-h-96 overflow-y-auto space-y-2",children:[e.jsxs("button",{onClick:()=>{V({_id:"default",name:"Oddiy mijoz",phone:"",debt:0}),O(!1),le("")},className:`w-full p-3 rounded-xl text-left transition-all ${(Q==null?void 0:Q._id)==="default"?"bg-blue-50 border-2 border-blue-500":"bg-blue-50/50 hover:bg-blue-100 border-2 border-blue-200"}`,children:[e.jsxs("div",{className:"font-medium text-blue-900 flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4"}),"Oddiy mijoz"]}),e.jsx("div",{className:"text-xs text-blue-600",children:"Faqat to'liq to'lov"})]}),te.length===0?e.jsxs("div",{className:"text-center py-8 text-surface-500",children:[e.jsx(Ds,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Mijoz topilmadi"})]}):te.map(B=>e.jsxs("button",{onClick:()=>{V(B),O(!1),le("")},className:`w-full p-3 rounded-xl text-left transition-all ${(Q==null?void 0:Q._id)===B._id?"bg-green-50 border-2 border-green-500":"bg-surface-50 hover:bg-surface-100 border-2 border-transparent"}`,children:[e.jsx("div",{className:"font-medium text-surface-900",children:B.name}),e.jsx("div",{className:"text-sm text-surface-500",children:B.phone})]},B._id))]})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_400px] gap-4 lg:gap-6 items-start w-full",children:[e.jsxs("div",{className:"space-y-4 lg:space-y-5 min-w-0",children:[e.jsx("div",{className:"card p-3 sm:p-4 border border-surface-100 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-3 items-stretch",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(gs,{className:"absolute left-3 sm:left-3.5 top-1/2 -translate-y-1/2 w-4 sm:w-5 h-4 sm:h-5 text-brand-400 z-10 pointer-events-none"}),e.jsx("input",{type:"text",value:l,onChange:B=>Be(B.target.value),placeholder:"Qidirish...",className:"w-full h-12 pl-10 sm:pl-11 pr-10 rounded-xl border-2 border-surface-200 focus:border-brand-400 focus:ring-4 focus:ring-brand-100 transition-all text-sm sm:text-base text-surface-900 placeholder:text-surface-400 bg-white shadow-sm hover:border-brand-300 relative z-0"}),l&&e.jsx("button",{onClick:()=>Be(""),className:"absolute right-3 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full bg-surface-100 hover:bg-surface-200 flex items-center justify-center transition-colors z-10",children:e.jsx(fe,{className:"w-4 h-4 text-surface-500"})})]}),e.jsxs("button",{onClick:r?W:be,className:`h-12 flex items-center justify-center gap-2 rounded-xl px-4 font-medium ${r?"btn-secondary":"btn-primary"} shadow-md hover:shadow-lg transition-all`,children:[e.jsx(xt,{className:"w-5 h-5"}),e.jsx("span",{children:r?"Skanerni to'xtatish":"QR skaner"})]})]})}),r&&e.jsx("div",{className:"card border border-brand-100 bg-gradient-to-br from-brand-50/60 to-surface-0 shadow-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 sm:p-5",children:[e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl overflow-hidden ring-4 ring-brand-300/50 ring-offset-4 ring-offset-surface-0 shadow-lg",children:[e.jsx("div",{id:"qr-reader",className:"w-full aspect-square bg-black"}),e.jsx("button",{onClick:Se,className:"absolute bottom-3 right-3 w-9 h-9 bg-white/95 hover:bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-all hover:scale-105 z-10 backdrop-blur-sm border border-white/20",title:xe==="environment"?"Old kameraga o'tish":"Orqa kameraga o'tish",children:e.jsx(Os,{className:"w-4 h-4 text-surface-600"})})]}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-surface-800",children:"QR kodni kameraga toâ€˜gâ€˜ri tuting"}),e.jsx("p",{className:"text-xs text-surface-500",children:"Kamera kodni oâ€˜qigach, tovar ma'lumotlari avtomatik chiqadi."})]})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-success-500 to-success-600 p-4 flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(ia,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Tovar topildi!"})]}),e.jsx("button",{onClick:()=>N(null),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/20 transition-colors text-white",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide",children:"Mahsulot nomi"}),e.jsx("p",{className:"text-xl font-bold text-surface-900 mt-1",children:y.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide",children:"Mahsulot kodi"}),e.jsx("p",{className:"text-lg font-semibold text-surface-700 mt-1",children:y.code})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide",children:"Mavjud miqdor"}),e.jsxs("p",{className:"text-lg font-semibold text-brand-600 mt-1",children:[y.quantity," dona"]})]}),e.jsxs("div",{className:"bg-brand-50 border border-brand-200 rounded-xl p-4",children:[e.jsx("label",{className:"text-xs font-medium text-brand-700 uppercase tracking-wide",children:"Optom narxi"}),e.jsxs("p",{className:"text-2xl font-bold text-brand-600 mt-1",children:[w(y.price)," so'm"]})]}),(y.unitPrice||y.boxPrice||((ze=y.prices)==null?void 0:ze.perUnit)||((ne=y.prices)==null?void 0:ne.perBox)||((Ze=y.prices)==null?void 0:Ze.perRoll))&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide mb-2 block",children:"Boshqa narxlar"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(x=y.prices)!=null&&x.perUnit||y.unitPrice||y.price?e.jsxs("div",{className:"flex-1 min-w-[140px] px-4 py-3 rounded-xl bg-success-50 border border-success-200",children:[e.jsx("p",{className:"text-xs text-success-600 font-medium",children:"Dona narxi"}),e.jsxs("p",{className:"text-lg font-bold text-success-700 mt-0.5",children:[w(((ce=y.prices)==null?void 0:ce.perUnit)||y.unitPrice||y.price)," so'm"]})]}):null,($e=y.prices)!=null&&$e.perBox||y.boxPrice?e.jsxs("div",{className:"flex-1 min-w-[140px] px-4 py-3 rounded-xl bg-brand-50 border border-brand-200",children:[e.jsx("p",{className:"text-xs text-brand-600 font-medium",children:"Karobka narxi"}),e.jsxs("p",{className:"text-lg font-bold text-brand-700 mt-0.5",children:[w(((Ee=y.prices)==null?void 0:Ee.perBox)||y.boxPrice||0)," so'm"]})]}):null,(Ne=y.prices)!=null&&Ne.perRoll?e.jsxs("div",{className:"flex-1 min-w-[140px] px-4 py-3 rounded-xl bg-sky-50 border border-sky-200",children:[e.jsx("p",{className:"text-xs text-sky-600 font-medium",children:"Rulon narxi"}),e.jsxs("p",{className:"text-lg font-bold text-sky-700 mt-0.5",children:[w(((De=y.prices)==null?void 0:De.perRoll)||0)," so'm"]})]}):null]})]}),y.pricingTiers&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide mb-2 block",children:"Miqdorga qarab chegirmalar"}),e.jsxs("div",{className:"space-y-2",children:[y.pricingTiers.tier1&&e.jsxs("div",{className:"px-4 py-3 rounded-xl border border-emerald-200 bg-emerald-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-emerald-700",children:[y.pricingTiers.tier1.minQuantity,"-",y.pricingTiers.tier1.maxQuantity," dona"]}),e.jsxs("span",{className:"text-lg font-bold text-emerald-700",children:[y.pricingTiers.tier1.discountPercent,"% chegirma"]})]}),e.jsxs("p",{className:"text-sm text-emerald-600 mt-1",children:["Narx: ",w(Math.round(y.price*(1-y.pricingTiers.tier1.discountPercent/100)))," so'm"]})]}),y.pricingTiers.tier2&&e.jsxs("div",{className:"px-4 py-3 rounded-xl border border-sky-200 bg-sky-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-sky-700",children:[y.pricingTiers.tier2.minQuantity,"-",y.pricingTiers.tier2.maxQuantity," dona"]}),e.jsxs("span",{className:"text-lg font-bold text-sky-700",children:[y.pricingTiers.tier2.discountPercent,"% chegirma"]})]}),e.jsxs("p",{className:"text-sm text-sky-600 mt-1",children:["Narx: ",w(Math.round(y.price*(1-y.pricingTiers.tier2.discountPercent/100)))," so'm"]})]}),y.pricingTiers.tier3&&e.jsxs("div",{className:"px-4 py-3 rounded-xl border border-violet-200 bg-violet-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-violet-700",children:[y.pricingTiers.tier3.minQuantity,"+ dona"]}),e.jsxs("span",{className:"text-lg font-bold text-violet-700",children:[y.pricingTiers.tier3.discountPercent,"% chegirma"]})]}),e.jsxs("p",{className:"text-sm text-violet-600 mt-1",children:["Narx: ",w(Math.round(y.price*(1-y.pricingTiers.tier3.discountPercent/100)))," so'm"]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>N(null),className:"flex-1 px-4 py-3 border border-surface-200 text-surface-700 rounded-xl hover:bg-surface-50 transition-colors font-medium",children:"Yopish"}),e.jsxs("button",{onClick:()=>{Ge(y),N(null)},className:"flex-1 px-4 py-3 bg-success-500 hover:bg-success-600 text-white rounded-xl transition-colors font-medium flex items-center justify-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5"}),"Savatga qo'shish"]})]})]})]})}),l&&b.length>0&&e.jsxs("div",{className:"card p-0 overflow-hidden border border-surface-100 shadow-sm",children:[e.jsxs("div",{className:"px-4 pt-4 pb-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700",children:"Qidiruv natijalari"}),e.jsxs("span",{className:"text-xs text-surface-400",children:[b.length," ta topildi"]})]}),e.jsx("div",{className:"divide-y divide-surface-100 max-h-72 overflow-auto custom-scrollbar",children:b.map(B=>e.jsxs("button",{onClick:()=>Ge(B),className:"w-full flex items-center justify-between p-4 hover:bg-surface-50/80 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900 line-clamp-1",children:B.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",B.code]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-brand-600",children:[w(B.price)," so'm"]}),e.jsxs("p",{className:"text-[11px] text-surface-400",children:[B.quantity," dona"]})]})]},B._id))})]}),l&&b.length===0&&e.jsx("div",{className:"card text-center py-10 bg-surface-0/60 border-dashed border-surface-200",children:e.jsx("p",{className:"text-sm text-surface-500",children:"Tovar topilmadi. Nomi yoki kodini tekshirib qayta urinib ko'ring."})})]}),e.jsx("div",{className:"lg:sticky lg:top-4 min-w-0 w-full",children:e.jsxs("div",{className:"card border border-surface-100 shadow-md shadow-surface-900/5 p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 rounded-xl bg-brand-50 flex items-center justify-center flex-shrink-0",children:e.jsx(hs,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Savat"}),e.jsx("p",{className:"text-xs text-surface-400 truncate",children:"Tanlangan tovarlar"})]})]}),e.jsxs("span",{className:"badge-primary text-xs px-2 sm:px-3 py-1 rounded-full flex-shrink-0",children:[k.length," ta"]})]}),k.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-10",children:[e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 bg-surface-100 rounded-2xl flex items-center justify-center mx-auto mb-3",children:e.jsx(hs,{className:"w-7 h-7 sm:w-8 sm:h-8 text-surface-300"})}),e.jsx("p",{className:"text-surface-500 text-xs sm:text-sm px-2",children:"Savat bo'sh. QR skaner yoki qidiruv orqali tovar qo'shing."})]}):e.jsx("div",{className:"space-y-2 sm:space-y-3 max-h-[360px] overflow-auto pr-1 custom-scrollbar",children:k.map(B=>{var we,ye,C,Y,re,ge,ss,ps,_e,ms,Ls,Ks,R,ae,je,Te,Je;const c=Qe(B.cartQuantity);(we=z.find(Oe=>Oe._id===B._id))!=null&&we.price||B.price;const H=z.find(Oe=>Oe._id===B._id),he=D===B._id;return e.jsxs("div",{className:"bg-surface-50 rounded-xl border border-surface-100",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 sm:p-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate text-sm",children:B.name}),e.jsxs("button",{onClick:()=>i(he?null:B._id),className:"flex items-center gap-1.5 mt-1 hover:opacity-80 transition-opacity",children:[e.jsxs("span",{className:`text-[9px] sm:text-[10px] font-bold px-1.5 py-0.5 rounded ${c.discount?"bg-success-100 text-success-700":"bg-surface-200 text-surface-600"}`,children:[c.name," â€¢ ",c.markupPercent,"%"]}),he?e.jsx(ka,{className:"w-3 h-3 text-surface-500"}):e.jsx(zt,{className:"w-3 h-3 text-surface-500"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-brand-600 font-semibold mt-1",children:[w(B.price*B.cartQuantity)," so'm"]})]}),e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1 bg-white rounded-lg border border-surface-200 px-1 sm:px-1.5 py-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>Fe(B._id,-1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded hover:bg-surface-100 transition-colors",children:e.jsx(ht,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("span",{className:"w-6 sm:w-8 text-center font-semibold text-xs sm:text-sm",children:B.cartQuantity}),e.jsx("button",{onClick:()=>Fe(B._id,1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded hover:bg-surface-100 transition-colors",children:e.jsx(ds,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsx("button",{onClick:()=>Ve(B._id),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded-lg hover:bg-red-50 text-red-500 transition-colors flex-shrink-0",children:e.jsx(fe,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]}),he&&H&&e.jsxs("div",{className:"px-2 sm:px-3 pb-2 sm:pb-3 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-[10px] font-medium text-green-900",children:[((C=(ye=H.pricingTiers)==null?void 0:ye.tier1)==null?void 0:C.minQuantity)||1,"-",((re=(Y=H.pricingTiers)==null?void 0:Y.tier1)==null?void 0:re.maxQuantity)||9," dona"]})}),e.jsxs("span",{className:"text-xs font-bold text-green-700",children:[((ss=(ge=H.pricingTiers)==null?void 0:ge.tier1)==null?void 0:ss.discountPercent)||15,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-[10px] font-medium text-blue-900",children:[((_e=(ps=H.pricingTiers)==null?void 0:ps.tier2)==null?void 0:_e.minQuantity)||10,"-",((Ls=(ms=H.pricingTiers)==null?void 0:ms.tier2)==null?void 0:Ls.maxQuantity)||99," dona"]})}),e.jsxs("span",{className:"text-xs font-bold text-blue-700",children:[((R=(Ks=H.pricingTiers)==null?void 0:Ks.tier2)==null?void 0:R.discountPercent)||13,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-[10px] font-medium text-purple-900",children:[((je=(ae=H.pricingTiers)==null?void 0:ae.tier3)==null?void 0:je.minQuantity)||100,"+ dona"]})}),e.jsxs("span",{className:"text-xs font-bold text-purple-700",children:[((Je=(Te=H.pricingTiers)==null?void 0:Te.tier3)==null?void 0:Je.discountPercent)||11,"%"]})]})]})]},B._id)})}),k.length>0&&e.jsxs("div",{className:"mt-4 pt-3 sm:pt-4 border-t border-surface-200 space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-surface-500 text-xs sm:text-sm",children:"Jami summa"}),e.jsxs("span",{className:"text-xl sm:text-2xl font-bold text-surface-900",children:[w(Ce)," so'm"]})]}),e.jsx("button",{onClick:m,disabled:T,className:"btn-primary w-full py-3 sm:py-3.5 text-sm sm:text-base rounded-xl flex items-center justify-center gap-2",children:T?e.jsx("div",{className:"spinner"}):e.jsxs(e.Fragment,{children:[e.jsx(Sa,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Kassaga yuborish"]})})]})]})})]})]})}function dl(){const a=As(),n=at(),[r,u]=t.useState(!1),[l,h]=t.useState(null),[k,p]=t.useState("idle"),{showAlert:z,AlertComponent:$}=Ns(),[b,f]=t.useState({arrived:0,left:0}),[y,N]=t.useState("");t.useEffect(()=>{window.location.pathname.startsWith("/kassa")||a("/kassa",{replace:!0});const V=()=>{window.history.pushState(null,"",window.location.href)};return window.addEventListener("popstate",V),window.history.pushState(null,"",window.location.href),()=>{window.removeEventListener("popstate",V)}},[a]);const i=(()=>{try{const Q=localStorage.getItem("kassaLoggedIn");if(Q)return{username:JSON.parse(Q).username||"Kassa",isActive:!0}}catch(Q){console.error("Error getting user info:",Q)}return{username:"Kassa",isActive:!1}})(),T=()=>{const Q=new Date,V=Q.getFullYear(),K=String(Q.getMonth()+1).padStart(2,"0"),le=String(Q.getDate()).padStart(2,"0");return`${V}-${K}-${le}`};t.useEffect(()=>{const Q=()=>{const K=T();N(K);const le=`attendance:kassa:${i.username}:${K}`,oe=localStorage.getItem(le),O=oe?JSON.parse(oe):{arrived:0,left:0};f(O),p(O.arrived>0&&O.left===0?"arrived":"idle")};Q();const V=setInterval(()=>{T()!==y&&Q()},6e4);return()=>clearInterval(V)},[i.username,y]);const M=Q=>E(this,null,function*(){var V,K;if(!l)try{if(h(Q),yield _.post("/telegram/attendance/kassa",{type:Q,username:i.username}),yield z(Q==="arrived"?"Keldingiz xabari yuborildi":"Ketdingiz xabari yuborildi","Muvaffaqiyatli","success"),Q==="arrived"){const le=`attendance:kassa:${i.username}:${y||T()}`,oe=b,O=j(g({},oe),{arrived:oe.arrived+1});localStorage.setItem(le,JSON.stringify(O)),f(O),O.arrived>0&&O.left===0&&p("arrived")}else{const le=`attendance:kassa:${i.username}:${y||T()}`,oe=b,O=j(g({},oe),{left:oe.left+1});localStorage.setItem(le,JSON.stringify(O)),f(O),q(),window.location.replace("/kassa-login")}}catch(le){yield z(((K=(V=le==null?void 0:le.response)==null?void 0:V.data)==null?void 0:K.message)||"Xabar yuborishda xatolik","Xatolik","danger")}finally{h(null)}}),q=t.useCallback(()=>{localStorage.removeItem("kassaLoggedIn"),localStorage.removeItem("kassaToken"),window.location.replace("/kassa-login")},[]),v=()=>{const Q=n.pathname;return Q==="/kassa"||Q==="/kassa/"?"Kassa":Q==="/kassa/receipts"?"Cheklar":Q==="/kassa/clients"?"Mijozlar":Q==="/kassa/products"?"Tovarlar":"Kassa"};return e.jsxs("div",{className:"h-screen flex overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[r&&e.jsx("div",{className:"fixed inset-0 z-40 lg:hidden",style:{background:"rgba(46, 16, 101, 0.6)",backdropFilter:"blur(8px)"},onClick:()=>u(!1)}),e.jsxs("aside",{className:`
        fixed lg:static inset-y-0 left-0 z-50 w-72 flex flex-col
        transform transition-transform duration-300 ease-in-out lg:transform-none
        ${r?"translate-x-0":"-translate-x-full lg:translate-x-0"}
      `,style:{background:"linear-gradient(180deg, #2e1065 0%, #4c1d95 100%)",borderRight:"1px solid rgba(6, 182, 212, 0.2)",boxShadow:"4px 0 24px -4px rgba(46, 16, 101, 0.3)"},children:[e.jsxs("div",{className:"p-5 flex items-center justify-between",style:{borderBottom:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, transparent 100%)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center overflow-hidden",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-lg text-white tracking-wide",style:{fontFamily:"'Playfair Display', serif",letterSpacing:"0.5px"},children:"Sardor"}),e.jsx("p",{className:"text-sm font-semibold tracking-wider",style:{color:"#c4b5fd",fontFamily:"'Montserrat', sans-serif",letterSpacing:"1.5px"},children:"FURNITURA"})]})]}),e.jsx("button",{onClick:()=>u(!1),className:"lg:hidden p-2 rounded-xl transition-colors",style:{background:"rgba(255, 255, 255, 0.1)",color:"#c4b5fd"},children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"flex-1 p-4 overflow-y-auto",children:e.jsx("div",{className:"space-y-1.5",children:[{path:"/kassa",label:"Kassa",icon:Ca},{path:"/kassa/receipts",label:"Cheklar",icon:Hs},{path:"/kassa/clients",label:"Mijozlar",icon:Ds},{path:"/kassa/debts",label:"Qarz daftarcha",icon:Hs},{path:"/kassa/products",label:"Tovarlar",icon:Ie}].map(({path:Q,label:V,icon:K})=>e.jsxs(rr,{to:Q,onClick:()=>u(!1),className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200",style:{background:n.pathname===Q?"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)":"transparent",color:n.pathname===Q?"#ffffff":"#c4b5fd",boxShadow:n.pathname===Q?"0 4px 12px -2px rgba(6, 182, 212, 0.4)":"none"},children:[e.jsx(K,{className:"w-5 h-5"}),V]},Q))})}),e.jsxs("div",{className:"p-4",style:{borderTop:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.2) 100%)"},children:[e.jsx("div",{className:"rounded-2xl p-4 mb-3",style:{background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(6, 182, 212, 0.15)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 12px -2px rgba(124, 58, 237, 0.4)"},children:e.jsx("span",{className:"text-base font-bold text-white",children:i.username.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-bold text-white truncate",children:i.username==="alisher"?"Namozov Alisher":i.username==="kassa1"?"Kassa Xodimi":i.username==="admin"?"Administrator":i.username}),e.jsxs("p",{className:"text-xs font-medium flex items-center gap-1",style:{color:"#a5b4fc"},children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-400 rounded-full animate-pulse"}),"Kassir â€¢ Faol"]})]})]})}),e.jsxs("button",{onClick:q,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl transition-all duration-200 text-sm font-semibold",style:{border:"1px solid rgba(239, 68, 68, 0.3)",color:"#fca5a5"},title:"Kassa tizimidan chiqish",children:[e.jsx(_t,{className:"w-4 h-4"}),"Chiqish"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:ml-0 h-full",children:[e.jsxs("header",{className:"px-4 lg:px-6 h-14 lg:h-16 flex items-center justify-between flex-shrink-0",style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",borderBottom:"1px solid rgba(91, 33, 182, 0.1)",backdropFilter:"blur(20px)",boxShadow:"0 4px 20px -4px rgba(46, 16, 101, 0.08)"},children:[e.jsx("button",{onClick:()=>u(!0),className:"lg:hidden p-2.5 rounded-xl transition-colors",style:{background:"rgba(91, 33, 182, 0.08)",color:"#5b21b6"},children:e.jsx(qt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg lg:text-xl font-bold",style:{color:"#2e1065"},children:v()}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium",style:{color:"#6b7280"},children:"Faol"})]})]}),e.jsx(ma,{variant:"navbar"})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Ot,{})})]}),k==="idle"&&e.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0",style:{background:"rgba(250, 245, 255, 0.7)",backdropFilter:"blur(8px)"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:e.jsxs("div",{className:"mx-auto max-w-md flex gap-4",children:[e.jsx("button",{onClick:()=>M("arrived"),disabled:l!==null,className:"pointer-events-auto flex-1 px-6 py-4 rounded-2xl text-white font-bold shadow-lg disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 8px 24px -4px rgba(6, 182, 212, 0.4)"},children:l==="arrived"?"Yuborilmoqda...":"Keldim"}),e.jsx("button",{onClick:()=>M("left"),disabled:l!==null,className:"pointer-events-auto flex-1 px-6 py-4 rounded-2xl text-white font-bold shadow-lg disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",boxShadow:"0 8px 24px -4px rgba(220, 38, 38, 0.4)"},children:l==="left"?"Yuborilmoqda...":"Ketdim"})]})})]}),k==="arrived"&&e.jsxs("div",{className:"fixed bottom-4 right-4 z-40 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>M("arrived"),disabled:l!==null,className:"px-3 py-2 rounded-xl text-white text-sm font-semibold shadow-md disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:l==="arrived"?"...":"Keldim"}),e.jsx("button",{onClick:()=>M("left"),disabled:l!==null,className:"px-3 py-2 rounded-xl text-white text-sm font-semibold shadow-md disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",boxShadow:"0 4px 12px -2px rgba(220, 38, 38, 0.4)"},children:l==="left"?"...":"Ketdim"})]}),$]})}const ml=({isOpen:a,onClose:n,item:r,customer:u,onSave:l})=>{const[h,k]=t.useState([]),[p,z]=t.useState(""),[$,b]=t.useState(""),[f,y]=t.useState(!1),[N,D]=t.useState(""),i=r.price*r.cartQuantity,T=r.paymentBreakdown||{cash:0,click:0,card:0,partner:0},M=T.cash+T.click+T.card+(T.partner||0),q=i-M;t.useEffect(()=>{a&&(v(),b(q.toString()))},[a,q]);const v=()=>E(es,null,function*(){try{const ke=yield(yield fetch("/api/partners")).json();ke.success?k(ke.partners):D("Hamkorlar ro'yxatini yuklashda xatolik")}catch(O){console.error("Hamkorlar yuklash xatosi:",O),D("Tarmoq xatoligi")}}),Q=O=>{const ke=Ye(O);(ke===""?0:parseFloat(ke)||0)>q?b(q.toString()):b(ke)},V=()=>E(es,null,function*(){if(!p){D("Hamkorni tanlang");return}const O=parseFloat($)||0;if(O<=0){D("To'lov summasi noto'g'ri");return}if(O>q){D("To'lov summasi qoldiq summadan ko'p bo'lishi mumkin emas");return}y(!0),D("");try{const ee=yield(yield fetch("/api/partners/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({partner:p,amount:O,item:{name:r.name,code:r.code,price:r.price,quantity:r.cartQuantity},customer:u?{name:u.name,phone:u.phone}:null,receiptNumber:`CHK-${Date.now()}`})})).json();if(ee.success){l(p,O),n();const ve=h.find(X=>X.id===p);alert(`âœ… ${ve==null?void 0:ve.name} orqali ${w(O)} so'm to'lov muvaffaqiyatli yuborildi!`)}else D(ee.message||"To'lov yuborishda xatolik")}catch(ke){console.error("Hamkor to'lovi xatosi:",ke),D("Tarmoq xatoligi yuz berdi")}finally{y(!1)}}),K=O=>{switch(O){case"uzum":return e.jsx(hs,{className:"w-6 h-6"});case"ishonch":return e.jsx(Rs,{className:"w-6 h-6"});default:return e.jsx(Ys,{className:"w-6 h-6"})}},le=O=>{switch(O){case"uzum":return"from-purple-500 to-purple-600";case"ishonch":return"from-amber-500 to-amber-600";default:return"from-blue-500 to-blue-600"}},oe=O=>{switch(O){case"uzum":return"Muddatli to'lov";case"ishonch":return"Kredit tizimi";default:return""}};return a?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm -z-10",onClick:n}),e.jsxs("div",{className:"bg-white w-full sm:w-auto rounded-t-2xl sm:rounded-2xl shadow-2xl max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-gray-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 truncate",children:"Hamkor to'lovi"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 truncate",children:r.name})]}),e.jsx("button",{onClick:n,className:"flex-shrink-0 w-10 h-10 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Umumiy summa:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[w(i)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"To'langan:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[w(M)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Qoldiq:"}),e.jsxs("span",{className:"font-bold text-blue-600",children:[w(q)," so'm"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Hamkorni tanlang"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:h.map(O=>e.jsx("button",{onClick:()=>z(O.id),className:`relative p-4 rounded-xl border-2 transition-all duration-200 ${p===O.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-r ${le(O.id)} flex items-center justify-center text-white`,children:K(O.id)}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:O.name}),e.jsx("p",{className:"text-sm text-gray-500",children:oe(O.id)})]}),p===O.id&&e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})},O.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To'lov summasi"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:$,onChange:O=>Q(O.target.value),placeholder:"0",className:"w-full px-4 py-3 text-lg font-semibold border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:"so'm"})]}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("button",{onClick:()=>b((q/2).toString()),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Yarmini"}),e.jsx("button",{onClick:()=>b(q.toString()),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Hammasini"})]})]}),N&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:N})})]})}),e.jsxs("div",{className:"sticky bottom-0 z-10 bg-white/95 backdrop-blur-sm border-t border-gray-100 flex gap-3 p-4 sm:p-6",children:[e.jsx("button",{onClick:n,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:V,disabled:f||!p||!$,className:"flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-xl font-medium transition-colors",children:f?"Yuborilmoqda...":"Yuborish"})]})]})]}):null},xl=({item:a,selectedCustomer:n,onSave:r,onCancel:u})=>{var i,T,M;const[l,h]=t.useState(((i=a.paymentBreakdown)==null?void 0:i.cash)||0),[k,p]=t.useState(((T=a.paymentBreakdown)==null?void 0:T.click)||0),[z,$]=t.useState(((M=a.paymentBreakdown)==null?void 0:M.card)||0),b=a.price*a.cartQuantity,f=l+k+z,y=b-f,N=()=>{y<-1||r(l,k,z)},D=(q,v)=>{const Q=Ye(q),V=Q===""?0:parseFloat(Q)||0,K=v==="cash"?k+z:v==="click"?l+z:l+k,le=b-K,oe=V>le?le:V;v==="cash"?h(oe):v==="click"?p(oe):$(oe)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Naqd pul"}),e.jsx("input",{type:"text",value:rs(l.toString()),onChange:q=>D(q.target.value,"cash"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-success-200 rounded-xl focus:outline-none focus:border-success-500 focus:ring-4 focus:ring-success-500/10 bg-success-50",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Click"}),e.jsx("input",{type:"text",value:rs(k.toString()),onChange:q=>D(q.target.value,"click"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-purple-200 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-500/10 bg-purple-50",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Plastik karta"}),e.jsx("input",{type:"text",value:rs(z.toString()),onChange:q=>D(q.target.value,"card"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-brand-200 rounded-xl focus:outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 bg-brand-50",placeholder:"0"})]})]}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Jami to'lov:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[w(f)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Tovar summasi:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[w(f)," so'm"]})]}),e.jsxs("div",{className:`flex justify-between text-sm font-semibold pt-2 border-t border-surface-200 ${y<=1&&y>=-1?"text-success-600":y>1?"text-warning-600":"text-danger-600"}`,children:[e.jsx("span",{children:"Qoldiq:"}),e.jsxs("span",{children:[w(b-f)," so'm"]})]}),y<-1&&e.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-lg p-2 mt-2",children:e.jsxs("p",{className:"text-xs text-warning-700",children:["âš ï¸ Ortiq pul kiritib bo'lmaydi. Maksimal: ",w(b)," so'm"]})}),y>1&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2 mt-2",children:e.jsxs("p",{className:"text-xs text-blue-700",children:["â„¹ï¸ ",w(y)," so'm qoldiq ",n?"qarz daftariga qo'shiladi va botga yuboriladi":"qarz bo'ladi (mijoz tanlanmagan)"]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:u,className:"flex-1 py-3 text-surface-600 hover:text-surface-900 transition-colors rounded-xl border border-surface-200 hover:bg-surface-50",children:"Bekor qilish"}),e.jsx("button",{onClick:N,disabled:y<-1,className:`flex-1 py-3 rounded-xl font-semibold transition-colors ${y<-1?"bg-surface-300 text-surface-500 cursor-not-allowed":"bg-brand-500 hover:bg-brand-600 text-white"}`,children:"Saqlash"})]})]})};function ul(){const{showAlert:a,AlertComponent:n}=Ns(),r=at(),[u,l]=t.useState([]),[h,k]=t.useState([]),[p,z]=t.useState([]),[$,b]=t.useState(""),[f,y]=t.useState(!1),[N,D]=t.useState(!1),[i,T]=t.useState(""),[M,q]=t.useState([]),[v,Q]=t.useState(null),[V,K]=t.useState(!1),[le,oe]=t.useState(""),[O,ke]=t.useState([]),[ee,ve]=t.useState([]),[X,Z]=t.useState(!1),[L,xe]=t.useState(!1),[I,de]=t.useState({available:!1,printers:[],xPrinterFound:!1}),[ue,F]=t.useState("kod"),[S,be]=t.useState(""),[W,Se]=t.useState(null),[Be,We]=t.useState(!1),[Qe,Ge]=t.useState(null),[Fe,Ve]=t.useState(!1),[m,te]=t.useState(null),[Ce,ze]=t.useState(!1),[ne,Ze]=t.useState(null),[x,ce]=t.useState(15),[$e,Ee]=t.useState(!1),[Ne,De]=t.useState(null),[B,c]=t.useState(""),[H,he]=t.useState(!1),[we,ye]=t.useState(null),[C,Y]=t.useState(""),[re,ge]=t.useState(0),[ss,ps]=t.useState({cash:0,click:0,card:0}),_e=(s,d)=>{const P=s.price;let A=15;d>=100?A=11:d>=10?A=13:A=15;const G=P*(1+A/100);return Math.round(G)},ms=(s,d)=>d!==void 0?{name:"Maxsus",markupPercent:d,discount:d<15,custom:!0}:s>=100?{name:"100+ dona",markupPercent:11,discount:!0,custom:!1}:s>=10?{name:"10-99 dona",markupPercent:13,discount:!0,custom:!1}:{name:"1-9 dona",markupPercent:15,discount:!1,custom:!1},Ls=s=>{Ze(s);const d=ms(s.cartQuantity,s.customMarkup);ce(d.markupPercent),ze(!0)},Ks=()=>{if(!ne)return;const s=ne.costPrice||ne.price/1.15,d=Math.round(s*(1+x/100));z(P=>P.map(A=>A._id===ne._id?j(g({},A),{price:d,customMarkup:x}):A)),ze(!1),Ze(null),a(`Narx yangilandi: ${x}% qo'shimcha`,"Muvaffaqiyat","success")};t.useEffect(()=>{ae(),Je(),J(),me();const s=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=s}},[]),t.useEffect(()=>{ae(),Je()},[r.pathname]);const R=()=>E(this,null,function*(){console.log("Refresh tugmasi bosildi"),xe(!0);try{console.log("Ma'lumotlar yangilanmoqda..."),yield Promise.all([ae(),Je()]),console.log("Ma'lumotlar muvaffaqiyatli yangilandi"),a("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(s){console.error("Refresh xatosi:",s),a("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{xe(!1)}}),ae=()=>E(this,null,function*(){try{const s=yield _.get("/products/kassa");l(s.data),console.log(`Kassa: ${s.data.length} ta tovar yuklandi`)}catch(s){console.error("Error fetching products:",s),a("Tovarlarni yuklashda xatolik","Xatolik","danger")}}),je=s=>E(this,null,function*(){if(!s.trim()||s.length===0){ve([]),Z(!1);return}const d=u.filter(P=>P.code.toLowerCase().includes(s.toLowerCase())).sort((P,A)=>{const G=P.code.toLowerCase().startsWith(s.toLowerCase()),se=A.code.toLowerCase().startsWith(s.toLowerCase());return G&&!se?-1:!G&&se?1:P.code.localeCompare(A.code)});if(ve(d.slice(0,8)),Z(!0),d.length<5&&s.length>=1)try{const G=((yield _.get(`/products/kassa?search=${encodeURIComponent(s)}`)).data||[]).filter(U=>U.code.toLowerCase().includes(s.toLowerCase())).sort((U,ie)=>{const pe=U.code.toLowerCase().startsWith(s.toLowerCase()),qe=ie.code.toLowerCase().startsWith(s.toLowerCase());return pe&&!qe?-1:!pe&&qe?1:U.code.localeCompare(ie.code)}),se=[...d];G.forEach(U=>{se.find(pe=>pe._id===U._id)||se.push(U)}),ve(se.slice(0,8)),l(U=>{const ie=[...U];return G.forEach(pe=>{ie.find(Re=>Re._id===pe._id)||ie.push(pe)}),ie})}catch(P){console.error("Error searching products by code:",P)}}),Te=s=>E(this,null,function*(){if(!s.trim())return null;try{const d=u.find(A=>A.code===s.trim());if(d)return d;const P=yield _.get(`/products/kassa?search=${encodeURIComponent(s.trim())}`);if(P.data&&P.data.length>0){const A=P.data.find(G=>G.code===s.trim());if(A)return l(G=>G.find(U=>U._id===A._id)?G:[...G,A]),A}return null}catch(d){return console.error("Error searching product:",d),null}}),Je=()=>E(this,null,function*(){try{const s=yield _.get("/customers/kassa");k(s.data)}catch(s){console.error("Error fetching customers:",s)}}),Oe=s=>{oe(s)},o=h.filter(s=>s.name.toLowerCase().includes(le.toLowerCase())||s.phone.includes(le)),J=()=>{const s=localStorage.getItem("savedReceipts");s&&ke(JSON.parse(s))},me=()=>E(this,null,function*(){try{const s=yield nl();de(s),console.log("Printer holati:",s)}catch(s){console.error("Printer holatini tekshirishda xatolik:",s)}}),Me=p.reduce((s,d)=>s+d.price*d.cartQuantity,0),Ke=s=>{if(s==="C")ue==="kod"?(b(""),Z(!1),ve([])):(be("1"),W&&p.find(P=>P._id===W._id)&&z(P=>P.map(A=>A._id===W._id?j(g({},A),{cartQuantity:1}):A)));else if(s==="âŒ«")if(ue==="kod"){const d=$.slice(0,-1);b(d),d.length>0?je(d):(Z(!1),ve([]))}else{const d=S.slice(0,-1),P=d===""||parseInt(d)===0?"1":d;if(be(P),W){const A=parseInt(P);A>0&&A<=W.quantity&&p.find(se=>se._id===W._id)&&z(se=>se.map(U=>U._id===W._id?j(g({},U),{cartQuantity:A}):U))}}else if(s==="+")if(ue==="kod")Ae($);else if(W&&S.trim()){const d=parseInt(S);if(!isNaN(d)&&d>0){if(d>W.quantity){a(`${W.name} uchun maksimal miqdor: ${W.quantity} ta`,"Ogohlantirish","warning");return}p.find(A=>A._id===W._id)?z(A=>A.map(G=>G._id===W._id?j(g({},G),{cartQuantity:d}):G)):ys(W,d),Se(null),be(""),F("kod")}}else W||a("Mahsulot qo'shing","Ogohlantirish","warning");else if(ue==="kod"){const d=$+s;b(d),je(d)}else if(W&&(/^[\d]$/.test(s)||s==="00")){const d=S+s,P=parseInt(d);if(!isNaN(P)&&P>W.quantity){a(`${W.name} uchun maksimal miqdor: ${W.quantity} ta`,"Ogohlantirish","warning");return}console.log("SON rejimida raqam kiritildi:",s,"Yangi qiymat:",d),be(d),!isNaN(P)&&P>0&&p.find(G=>G._id===W._id)&&z(G=>G.map(se=>se._id===W._id?j(g({},se),{cartQuantity:P}):se))}else W||(F("kod"),a("Mahsulot qo'shing","Ogohlantirish","warning"))},Ae=s=>E(this,null,function*(){if(!s.trim())return;const d=yield Te(s.trim());if(d){if(d.quantity===0){a(`"${d.name}" tugagan, savatchaga qo'shib bo'lmaydi`,"Ogohlantirish","warning");return}xs(d),b(""),Z(!1),ve([])}else a(`Kod "${s}" bo'yicha tovar topilmadi`,"Xatolik","warning")}),Le=s=>{if(s.quantity===0){a(`"${s.name}" tugagan, savatchaga qo'shib bo'lmaydi`,"Ogohlantirish","warning");return}xs(s),b(""),Z(!1),ve([])},os=s=>{Se(s),F("son"),be(s.cartQuantity.toString())},ys=(s,d)=>{z(P=>{const A=P.find(se=>se._id===s._id);if(A){const se=A.cartQuantity+d;if(se>s.quantity)return a(`${s.name} uchun maksimal miqdor: ${s.quantity} ta`,"Ogohlantirish","warning"),P;const U=_e(s,se);return P.map(ie=>ie._id===s._id?j(g({},ie),{cartQuantity:se,price:U}):ie)}const G=_e(s,d);return[...P,j(g({},s),{cartQuantity:d,price:G})]}),D(!1),T("")},xs=s=>{z(d=>{const P=d.find(G=>G._id===s._id);if(P){const G=P.cartQuantity+1;if(G>s.quantity)return a(`${s.name} uchun maksimal miqdor: ${s.quantity} ta`,"Ogohlantirish","warning"),d;const se=_e(s,G);return d.map(U=>U._id===s._id?j(g({},U),{cartQuantity:G,price:se}):U)}const A=_e(s,1);return[...d,j(g({},s),{cartQuantity:1,price:A})]}),D(!1),T("")},ks=s=>{z(d=>d.filter(P=>P._id!==s))},Ss=s=>{De(s),c(s.quantity.toString()),Ee(!0)},js=s=>E(this,null,function*(){ye(s),he(!0);try{const d=`${Kt}/product/${s._id}`,P=yield Ft(d,{width:300,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});Y(P)}catch(d){console.error("QR generation error:",d),a("QR kod yaratishda xatolik","Xatolik","danger")}}),ns=()=>{if(!we||!C)return;const s=window.open("","_blank","width=600,height=400");if(!s){a("Popup bloklangan. Iltimos, popup ga ruxsat bering.","Ogohlantirish","warning");return}s.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Label - ${we.name}</title>
        <style>
          @page {
            size: 60mm 40mm;
            margin: 0;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, Helvetica, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .label {
            width: 60mm;
            height: 40mm;
            padding: 2mm;
            background: white;
            display: flex;
            flex-direction: column;
          }
          .top-section {
            display: flex;
            gap: 2mm;
            flex: 1;
          }
          .qr-box {
            width: 22mm;
            height: 22mm;
            flex-shrink: 0;
          }
          .qr-code {
            width: 22mm;
            height: 22mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
          }
          .product-code {
            font-size: 7pt;
            font-weight: 600;
            color: #666;
            margin-bottom: 1mm;
          }
          .product-name {
            font-size: 9pt;
            font-weight: 700;
            color: #000;
            line-height: 1.2;
            text-transform: uppercase;
            word-break: break-word;
          }
          .bottom-section {
            margin-top: 1.5mm;
          }
          .price-box {
            padding: 1.5mm;
            text-align: center;
            background: #f0f0f0;
            border-radius: 1mm;
          }
          .price-value {
            font-size: 14pt;
            font-weight: 900;
            color: #000;
            letter-spacing: -0.5px;
          }
          .price-currency {
            font-size: 10pt;
            font-weight: 700;
            color: #000;
            margin-left: 1mm;
          }
          @media print {
            body { background: white; }
          }
        </style>
      </head>
      <body>
        <div class="label">
          <div class="top-section">
            <div class="qr-box">
              <img src="${C}" alt="QR" class="qr-code" />
            </div>
            <div class="info-box">
              <div class="product-code">Kod: ${we.code}</div>
              <div class="product-name">${we.name}</div>
            </div>
          </div>
          <div class="bottom-section">
            <div class="price-box">
              <span class="price-value">${w(we.price)}</span>
              <span class="price-currency">so'm</span>
            </div>
          </div>
        </div>
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 200);
          }
        <\/script>
      </body>
      </html>
    `),s.document.close()},fs=()=>E(this,null,function*(){var d,P;if(!Ne)return;const s=parseInt(B);if(isNaN(s)||s<0){a("Noto'g'ri miqdor kiritildi","Xatolik","danger");return}try{yield _.put(`/products/${Ne._id}`,{quantity:s}),l(A=>A.map(G=>G._id===Ne._id?j(g({},G),{quantity:s}):G)),z(A=>A.map(G=>G._id===Ne._id&&G.cartQuantity>s?j(g({},G),{cartQuantity:s}):G)),a("Mahsulot qadi yangilandi","Muvaffaqiyat","success"),Ee(!1),De(null),c("")}catch(A){console.error("Error updating quantity:",A),a(((P=(d=A.response)==null?void 0:d.data)==null?void 0:P.message)||"Qadni yangilashda xatolik","Xatolik","danger")}}),vs=s=>E(this,null,function*(){if(T(s),s.length>0){const d=u.filter(P=>P.name.toLowerCase().includes(s.toLowerCase())||P.code.toLowerCase().includes(s.toLowerCase()));if(d.length<5&&s.length>2)try{const A=(yield _.get(`/products/kassa?search=${encodeURIComponent(s)}`)).data||[],G=[...d];A.forEach(se=>{G.find(ie=>ie._id===se._id)||G.push(se)}),q(G),l(se=>{const U=[...se];return A.forEach(ie=>{U.find(qe=>qe._id===ie._id)||U.push(ie)}),U})}catch(P){console.error("Error searching products:",P),q(d)}else q(d)}else q(u.slice(0,20))}),Cs=s=>{Ge(s),We(!0)},pt=s=>{te(s),Ve(!0)},lt=(s,d,P)=>E(this,null,function*(){if(!Qe)return;const A=Qe.price*Qe.cartQuantity,G=s+d+P;if(G>A+1){a(`Ortiq pul kiritib bo'lmaydi. Maksimal: ${w(A)} so'm, Kiritilgan: ${w(G)} so'm`,"Xatolik","danger");return}const se=A-G;if(se>1&&v)try{console.log(`Tovar uchun qoldiq qarz yaratilmoqda: ${se} so'm`);const U={customer:v._id,amount:se,paidAmount:0,description:`${Qe.name} uchun qoldiq to'lov - ${new Date().toLocaleDateString("uz-UZ")}`,items:[{product:Qe._id,name:Qe.name,code:Qe.code,price:Qe.price,quantity:Qe.cartQuantity}]};yield _.post("/debts/kassa",U),console.log("âœ… Tovar uchun qoldiq qarz muvaffaqiyatli qo'shildi va botga yuborildi"),a(`${w(se)} so'm qarz qo'shildi va botga yuborildi`,"Ma'lumot","info")}catch(U){console.error("âŒ Qarz yaratishda xatolik:",U),a("Qarz yaratishda xatolik yuz berdi","Ogohlantirish","warning")}z(U=>U.map(ie=>{var pe;return ie._id===Qe._id?j(g({},ie),{paymentBreakdown:{cash:s,click:d,card:P,partner:((pe=ie.paymentBreakdown)==null?void 0:pe.partner)||0}}):ie})),We(!1),Ge(null)}),Ut=()=>{if(p.length===0){a("Chek bo'sh","Ogohlantirish","warning");return}const s={id:Date.now().toString(),items:[...p],total:Me,savedAt:new Date().toLocaleString()},d=[...O,s];ke(d),localStorage.setItem("savedReceipts",JSON.stringify(d)),z([]),a("Chek saqlandi!","Muvaffaqiyat","success")};return e.jsxs("div",{className:"h-full flex flex-col lg:flex-row overflow-hidden",children:[n,e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0",children:[e.jsxs("div",{className:"p-2 sm:p-3 lg:p-4 flex flex-col sm:flex-row sm:items-center justify-between gap-2 bg-white border-b border-surface-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-col xs:flex-row xs:items-center gap-2 xs:gap-3",children:[e.jsxs("span",{className:"text-xs sm:text-sm text-surface-600 font-medium",children:["JAMI: ",p.length," ta mahsulot"]}),e.jsxs("button",{onClick:R,disabled:L,className:"flex items-center gap-1 px-2 py-1 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50 text-xs w-fit",children:[e.jsx(Os,{className:`w-3 h-3 ${L?"animate-spin":""}`}),e.jsx("span",{className:"hidden xs:inline",children:L?"Yangilanmoqda...":"Yangilash"}),e.jsx("span",{className:"xs:hidden",children:L?"...":"â†»"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:v?e.jsxs("div",{className:"flex items-center gap-2 bg-brand-50 border border-brand-200 rounded-lg px-3 py-2",children:[e.jsx("div",{className:"w-6 h-6 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-brand-600",children:v.name.charAt(0)})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-brand-700",children:v.name}),e.jsx("span",{className:"text-xs text-brand-600",children:v.phone})]}),e.jsx("button",{onClick:()=>Q(null),className:"ml-2 w-5 h-5 flex items-center justify-center rounded-full text-brand-500 hover:bg-brand-200 transition-colors",children:"Ã—"})]}):e.jsxs("button",{onClick:()=>K(!0),className:"flex items-center gap-2 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),e.jsx("span",{children:"Mijoz tanlash"})]})})]}),e.jsxs("div",{className:"flex-1 bg-white overflow-hidden flex flex-col min-h-0",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-2 px-3 sm:px-4 py-3 bg-surface-50 border-b border-surface-200 text-xs font-semibold text-surface-500 uppercase flex-shrink-0",children:[e.jsx("div",{className:"col-span-1",children:"Kod"}),e.jsx("div",{className:"col-span-4",children:"Mahsulot"}),e.jsx("div",{className:"col-span-2 text-center",children:"Soni"}),e.jsx("div",{className:"col-span-2 text-right",children:"Narx"}),e.jsx("div",{className:"col-span-2 text-right",children:"Summa"}),e.jsx("div",{className:"col-span-1 text-center",children:"Amallar"})]}),e.jsx("div",{className:"flex-1 overflow-auto min-h-0",children:p.length===0?X&&ee.length>0?e.jsxs("div",{className:"p-2 sm:p-3 lg:p-4 h-full flex flex-col",children:[e.jsx("div",{className:"text-center mb-2 sm:mb-3 flex-shrink-0",children:e.jsxs("p",{className:"text-sm text-surface-500",children:['"',$,`" ni o'z ichiga olgan tovarlar`,ee.length>4&&e.jsxs("span",{className:"block text-xs text-surface-400 mt-1",children:["Jami ",ee.length," ta tovar"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-1 sm:space-y-2 min-h-0",children:ee.map((s,d)=>e.jsxs("button",{onClick:()=>Le(s),disabled:s.quantity===0,className:`w-full flex items-center gap-2 sm:gap-3 p-2 sm:p-3 rounded-xl transition-colors text-left relative overflow-hidden ${s.quantity===0?"bg-red-50 border-2 border-red-200 cursor-not-allowed opacity-80":d<4?"bg-brand-50 hover:bg-brand-100 border border-brand-200":"bg-surface-50 hover:bg-surface-100 border border-transparent"}`,children:[s.quantity===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none bg-red-50 bg-opacity-90 rounded-xl",children:e.jsx("div",{className:"bg-red-500 text-white text-xs sm:text-sm font-bold px-2 sm:px-4 py-1 sm:py-2 rounded-full shadow-lg border-2 border-white transform rotate-12 animate-pulse",children:"TUGAGAN"})}),s.images&&s.images.length>0?e.jsx("img",{src:`http://localhost:8000${typeof s.images[0]=="string"?s.images[0]:s.images[0].path}`,alt:s.name,className:`w-12 h-12 sm:w-14 sm:h-14 rounded-xl object-cover ${s.quantity===0?"opacity-50 grayscale":""}`,onError:P=>{var A;P.currentTarget.style.display="none",(A=P.currentTarget.nextElementSibling)==null||A.classList.remove("hidden")}}):null,e.jsx("div",{className:`${s.images&&s.images.length>0?"hidden":""} w-8 h-8 sm:w-10 sm:h-10 rounded-xl flex items-center justify-center ${s.quantity===0?"bg-red-100":"bg-brand-100"}`,children:e.jsx(Ie,{className:`w-4 h-4 sm:w-5 sm:h-5 ${s.quantity===0?"text-red-600":"text-brand-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0 relative",children:[e.jsx("p",{className:`font-medium text-sm sm:text-base truncate ${s.quantity===0?"text-red-700 opacity-60":"text-surface-900"}`,children:s.name}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 text-xs sm:text-sm text-surface-500",children:[e.jsx("span",{className:`font-mono px-1.5 sm:px-2 py-0.5 rounded border text-xs ${s.quantity===0?"bg-red-100 border-red-300 text-red-700 opacity-60":"bg-white"}`,children:$&&s.code.toLowerCase().includes($.toLowerCase())?e.jsx(e.Fragment,{children:s.code.split(new RegExp(`(${$})`,"gi")).map((P,A)=>P.toLowerCase()===$.toLowerCase()?e.jsx("span",{className:"bg-yellow-200 text-yellow-800 font-bold",children:P},A):e.jsx("span",{children:P},A))}):s.code}),s.quantity!==void 0&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${s.quantity>10?"bg-success-100 text-success-700":s.quantity>0?"bg-warning-100 text-warning-700":"bg-danger-100 text-danger-700 font-bold animate-pulse"}`,children:s.quantity>0?`${s.quantity} ta`:"TUGAGAN"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`font-semibold text-sm sm:text-base ${s.quantity===0?"text-red-600 opacity-60":"text-brand-600"}`,children:w(s.price)}),e.jsx("p",{className:`text-xs ${s.quantity===0?"text-red-500":"text-surface-500"}`,children:s.quantity===0?"Mavjud emas":"so'm"})]})]},s._id))})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-surface-400 py-8 sm:py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ie,{className:"w-8 h-8 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 opacity-50"}),e.jsx("p",{className:"text-sm sm:text-base",children:"Savat bo'sh"}),$.length>0&&e.jsx("p",{className:"text-xs sm:text-sm mt-1 sm:mt-2",children:"Kod kiriting yoki qidiring"})]})}):e.jsx("div",{className:"space-y-3 p-4",children:p.map(s=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 border border-surface-100 overflow-hidden",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-3 p-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"px-2 py-1 bg-surface-50 rounded-lg",children:e.jsx("span",{className:"text-xs font-mono font-semibold text-surface-700",children:s.code})})}),e.jsx("div",{className:"col-span-4",children:e.jsx("span",{className:"text-sm font-semibold text-surface-900",children:s.name})}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("input",{type:"text",value:s.cartQuantity,onClick:()=>os(s),onChange:d=>{const P=d.target.value;if(P===""||/^\d+$/.test(P)){const A=P===""?0:parseInt(P);if(A>s.quantity){a(`${s.name} uchun maksimal miqdor: ${s.quantity} ta`,"Ogohlantirish","warning");return}const G=_e(s,A);z(se=>se.map(U=>U._id===s._id?j(g({},U),{cartQuantity:A,price:G}):U))}},onBlur:()=>{(s.cartQuantity===0||!s.cartQuantity)&&ks(s._id)},className:`w-20 h-10 text-center font-bold text-lg border-2 rounded-xl focus:outline-none focus:ring-2 cursor-pointer transition-all ${s.cartQuantity>s.quantity?"border-danger-500 bg-danger-50 text-danger-700 focus:border-danger-500 focus:ring-danger-500/20":"border-brand-200 bg-brand-50/50 text-brand-700 focus:border-brand-500 focus:ring-brand-500/20 hover:bg-brand-50"}`})}),e.jsx("div",{className:"col-span-2 text-right",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-base font-bold text-surface-900",children:w(s.price)}),(()=>{const d=ms(s.cartQuantity,s.customMarkup);return e.jsxs("div",{onClick:()=>Ls(s),className:`text-xs px-2.5 py-1 rounded-full inline-block cursor-pointer hover:scale-105 transition-all font-medium shadow-sm ${d.custom?"bg-gradient-to-r from-purple-500 to-purple-600 text-white":d.discount?"bg-gradient-to-r from-success-500 to-success-600 text-white":"bg-gradient-to-r from-surface-100 to-surface-200 text-surface-700"}`,title:"Foizni o'zgartirish uchun bosing",children:[d.name," (",d.markupPercent,"%)"]})})()]})}),e.jsxs("div",{className:"col-span-2 text-right",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 text-white px-3 py-2 rounded-xl inline-block shadow-lg",children:e.jsx("span",{className:"text-base font-black",children:w(s.price*s.cartQuantity)})}),s.paymentBreakdown&&e.jsxs("div",{className:"mt-2 space-y-1",children:[s.paymentBreakdown.cash>0&&e.jsxs("div",{className:"flex items-center justify-end gap-1.5 text-xs",children:[e.jsx("div",{className:"w-5 h-5 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(is,{className:"w-3 h-3 text-green-600"})}),e.jsx("span",{className:"font-medium text-green-700",children:w(s.paymentBreakdown.cash)})]}),s.paymentBreakdown.click>0&&e.jsxs("div",{className:"flex items-center justify-end gap-1.5 text-xs",children:[e.jsx("div",{className:"w-5 h-5 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Ys,{className:"w-3 h-3 text-purple-600"})}),e.jsx("span",{className:"font-medium text-purple-700",children:w(s.paymentBreakdown.click)})]}),s.paymentBreakdown.card>0&&e.jsxs("div",{className:"flex items-center justify-end gap-1.5 text-xs",children:[e.jsx("div",{className:"w-5 h-5 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Rs,{className:"w-3 h-3 text-blue-600"})}),e.jsx("span",{className:"font-medium text-blue-700",children:w(s.paymentBreakdown.card)})]}),s.paymentBreakdown.partner&&s.paymentBreakdown.partner>0&&e.jsxs("div",{className:"flex items-center justify-end gap-1.5 text-xs",children:[e.jsx("div",{className:"w-5 h-5 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Ys,{className:"w-3 h-3 text-blue-600"})}),e.jsx("span",{className:"font-medium text-blue-700",children:w(s.paymentBreakdown.partner)})]})]}),!s.paymentBreakdown&&e.jsxs("button",{onClick:()=>Cs(s),className:"mt-2 inline-flex items-center gap-1.5 px-3 py-1.5 text-xs bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg transition-all shadow-md hover:shadow-lg font-medium",children:[e.jsx(Rs,{className:"w-3 h-3"}),"To'lov"]})]}),e.jsxs("div",{className:"col-span-1 flex justify-center gap-1.5",children:[e.jsx("button",{onClick:()=>pt(s),className:"w-9 h-9 flex items-center justify-center rounded-xl text-purple-600 bg-purple-50 hover:bg-purple-100 transition-all shadow-sm hover:shadow-md",title:"Hamkor orqali to'lash",children:e.jsx(Ys,{className:"w-4 h-4"})}),s.paymentBreakdown&&e.jsx("button",{onClick:()=>Cs(s),className:"w-7 h-7 flex items-center justify-center rounded-lg text-brand-500 hover:bg-brand-50 transition-colors",title:"To'lov turini o'zgartirish",children:e.jsx(Rs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ks(s._id),className:"w-7 h-7 flex items-center justify-center rounded-lg text-danger-500 hover:bg-danger-50 transition-colors",children:e.jsx(Ps,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"md:hidden p-4 bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 border border-gray-100",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-1.5 text-base",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500 font-mono bg-gray-100 px-2 py-1 rounded-md",children:["Kod: ",s.code]}),e.jsxs("span",{className:`text-xs px-2 py-1 rounded-md font-medium ${s.quantity>10?"bg-green-100 text-green-700":s.quantity>0?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[s.quantity," ta"]})]})]}),e.jsx("button",{onClick:()=>ks(s._id),className:"ml-3 w-10 h-10 flex items-center justify-center rounded-xl bg-gradient-to-br from-red-50 to-red-100 text-red-600 hover:from-red-100 hover:to-red-200 transition-all shadow-sm hover:shadow-md",children:e.jsx(Ps,{className:"w-4.5 h-4.5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-white p-3 rounded-xl shadow-sm",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Soni:"}),e.jsx("input",{type:"text",value:s.cartQuantity,onClick:()=>os(s),onChange:d=>{const P=d.target.value;if(P===""||/^\d+$/.test(P)){const A=P===""?0:parseInt(P);if(A>s.quantity){a(`${s.name} uchun maksimal miqdor: ${s.quantity} ta`,"Ogohlantirish","warning");return}const G=_e(s,A);z(se=>se.map(U=>U._id===s._id?j(g({},U),{cartQuantity:A,price:G}):U))}},onBlur:()=>{(s.cartQuantity===0||!s.cartQuantity)&&ks(s._id)},className:`w-20 h-10 text-center font-semibold border-2 rounded-xl focus:outline-none focus:ring-2 cursor-pointer transition-all ${s.cartQuantity>s.quantity?"border-red-400 bg-red-50 text-red-700 focus:border-red-500 focus:ring-red-500/20":"border-blue-300 bg-blue-50 text-blue-700 focus:border-blue-500 focus:ring-blue-500/20 hover:bg-blue-100"}`})]}),e.jsxs("div",{className:"bg-white p-3 rounded-xl shadow-sm space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Narxi:"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[w(s.price)," so'm"]})]}),(()=>{const d=ms(s.cartQuantity,s.customMarkup);return e.jsxs("div",{onClick:()=>Ls(s),className:`text-xs px-3 py-1.5 rounded-lg inline-flex items-center gap-1.5 cursor-pointer transition-all shadow-sm hover:shadow-md font-medium ${d.custom?"bg-gradient-to-r from-purple-500 to-pink-500 text-white":d.discount?"bg-gradient-to-r from-green-500 to-emerald-500 text-white":"bg-gradient-to-r from-gray-400 to-gray-500 text-white"}`,title:"Foizni o'zgartirish uchun bosing",children:[e.jsx("span",{children:d.name}),e.jsxs("span",{className:"font-bold",children:["(",d.markupPercent,"%)"]})]})})(),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 p-3 rounded-xl shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:"Jami:"}),e.jsxs("span",{className:"text-lg font-bold text-white",children:[w(s.price*s.cartQuantity)," so'm"]})]})})]}),s.paymentBreakdown&&e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-purple-50 p-3 rounded-xl shadow-sm space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:"To'lov turlari:"}),s.paymentBreakdown.cash>0&&e.jsxs("div",{className:"flex items-center justify-between bg-white px-3 py-2 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center shadow-md",children:e.jsx(is,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Naqd"})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[w(s.paymentBreakdown.cash)," so'm"]})]}),s.paymentBreakdown.click>0&&e.jsxs("div",{className:"flex items-center justify-between bg-white px-3 py-2 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-400 to-purple-600 flex items-center justify-center shadow-md",children:e.jsx(Ys,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Click"})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[w(s.paymentBreakdown.click)," so'm"]})]}),s.paymentBreakdown.card>0&&e.jsxs("div",{className:"flex items-center justify-between bg-white px-3 py-2 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center shadow-md",children:e.jsx(Rs,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Karta"})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[w(s.paymentBreakdown.card)," so'm"]})]}),s.paymentBreakdown.partner&&s.paymentBreakdown.partner>0&&e.jsxs("div",{className:"flex items-center justify-between bg-white px-3 py-2 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-400 to-indigo-600 flex items-center justify-center shadow-md",children:e.jsx(Ys,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Hamkor"})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[w(s.paymentBreakdown.partner)," so'm"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>pt(s),className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-xl transition-all shadow-md hover:shadow-lg font-medium",children:[e.jsx(Ys,{className:"w-4 h-4"}),"Hamkor"]}),!s.paymentBreakdown&&e.jsxs("button",{onClick:()=>Cs(s),className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl transition-all shadow-md hover:shadow-lg font-medium",children:[e.jsx(Rs,{className:"w-4 h-4"}),"To'lov"]}),s.paymentBreakdown&&e.jsx("button",{onClick:()=>Cs(s),className:"px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl transition-all shadow-md hover:shadow-lg",title:"To'lov turini o'zgartirish",children:e.jsx(Rs,{className:"w-5 h-5"})})]})]})]})]},s._id))})})]}),X&&ee.length>0&&p.length>0&&e.jsxs("div",{className:"mt-4 bg-white border border-surface-200 rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-surface-100 bg-surface-50",children:e.jsxs("p",{className:"text-sm text-surface-600 text-center",children:['"',$,`" ni o'z ichiga olgan tovarlar (`,ee.length," ta)"]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:ee.map(s=>e.jsxs("button",{onClick:()=>Le(s),disabled:s.quantity===0,className:`w-full flex items-center gap-3 p-3 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0 relative ${s.quantity===0?"opacity-60 cursor-not-allowed":""}`,children:[s.quantity===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none bg-red-50 bg-opacity-80 rounded",children:e.jsx("span",{className:"bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg",children:"TUGAGAN"})}),s.images&&s.images.length>0?e.jsx("img",{src:`http://localhost:8000${typeof s.images[0]=="string"?s.images[0]:s.images[0].path}`,alt:s.name,className:`w-12 h-12 rounded-xl object-cover flex-shrink-0 ${s.quantity===0?"opacity-50 grayscale":""}`,onError:d=>{var P;d.currentTarget.style.display="none",(P=d.currentTarget.nextElementSibling)==null||P.classList.remove("hidden")}}):null,e.jsx("div",{className:`${s.images&&s.images.length>0?"hidden":""} w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 ${s.quantity===0?"bg-red-100":"bg-brand-100"}`,children:e.jsx(Ie,{className:`w-5 h-5 ${s.quantity===0?"text-red-600":"text-brand-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium text-base truncate ${s.quantity===0?"text-red-700":"text-surface-900"}`,children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm mt-1",children:[e.jsx("span",{className:`font-mono px-2 py-1 rounded border ${s.quantity===0?"bg-red-100 border-red-300 text-red-700":"bg-white border-surface-200"}`,children:$&&s.code.toLowerCase().includes($.toLowerCase())?e.jsx(e.Fragment,{children:s.code.split(new RegExp(`(${$})`,"gi")).map((d,P)=>d.toLowerCase()===$.toLowerCase()?e.jsx("span",{className:"bg-yellow-200 text-yellow-800 font-bold",children:d},P):e.jsx("span",{children:d},P))}):s.code}),s.quantity!==void 0&&e.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${s.quantity>10?"bg-success-100 text-success-700":s.quantity>0?"bg-warning-100 text-warning-700":"bg-danger-100 text-danger-700"}`,children:s.quantity>0?`${s.quantity} ta`:"TUGAGAN"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),Ss(s)},className:"px-1.5 py-0.5 rounded text-[10px] font-medium bg-brand-100 text-brand-700 hover:bg-brand-200 transition-colors",title:"Qadni o'zgartirish",children:"âœï¸"})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:`font-semibold text-lg ${s.quantity===0?"text-red-600":"text-brand-600"}`,children:w(s.price)}),e.jsx("p",{className:`text-sm ${s.quantity===0?"text-red-500":"text-surface-500"}`,children:"so'm"})]})]},s._id))})]}),e.jsx("div",{className:"p-2 sm:p-3 lg:p-4 bg-white border-t border-surface-200 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>{D(!0),vs("")},className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-white border border-surface-200 rounded-lg text-surface-700 hover:bg-surface-50 transition-colors flex-1 min-w-[100px]",children:[e.jsx(gs,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"Qidirish"})]}),e.jsxs("button",{onClick:Ut,className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-white border border-surface-200 rounded-lg text-surface-700 hover:bg-surface-50 transition-colors flex-1 min-w-[100px]",children:[e.jsx(mt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"Saqlash"})]}),p.length>0&&e.jsxs("button",{onClick:()=>{const s=p.reduce((se,U)=>{var ie;return se+(((ie=U.paymentBreakdown)==null?void 0:ie.cash)||0)},0),d=p.reduce((se,U)=>{var ie;return se+(((ie=U.paymentBreakdown)==null?void 0:ie.click)||0)},0),P=p.reduce((se,U)=>{var ie;return se+(((ie=U.paymentBreakdown)==null?void 0:ie.card)||0)},0),A=p.reduce((se,U)=>{var ie;return se+(((ie=U.paymentBreakdown)==null?void 0:ie.partner)||0)},0),G=s+d+P+A;ps({cash:s,click:d,card:P}),ge(G),y(!0)},className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-success-500 text-white rounded-lg hover:bg-success-600 transition-colors flex-1 min-w-[100px] font-semibold",children:[e.jsx(wa,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"To'lov"})]})]})})]}),e.jsxs("div",{className:"w-full lg:w-72 xl:w-80 bg-white border-t lg:border-t-0 lg:border-l border-surface-200 p-2 sm:p-3 lg:p-4 flex flex-col flex-shrink-0",children:[e.jsx("div",{className:"text-center xl:text-right mb-3 sm:mb-4",children:e.jsxs("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-surface-900",children:[w(Me)," so'm"]})}),e.jsx("div",{className:"text-center mb-2 bg-surface-50 rounded-lg py-3 px-4 min-h-[60px] flex flex-col items-center justify-center",children:ue==="kod"?$?e.jsxs("div",{className:"text-lg font-mono text-surface-900",children:["Kod: ",e.jsx("span",{className:"font-bold text-brand-600",children:$})]}):e.jsx("div",{className:"text-sm text-surface-500",children:"Mahsulot kodini kiriting"}):e.jsxs("div",{className:"text-center w-full",children:[W&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-sm font-medium text-surface-700",children:W.name}),e.jsxs("div",{className:"text-xs text-surface-500",children:["Mavjud: ",W.quantity," ta"]})]}),e.jsx("div",{className:"text-xs text-surface-500 mb-1 uppercase tracking-wider",children:"SONI"}),S?e.jsx("div",{className:`text-3xl font-bold rounded-lg py-2 px-4 border-2 inline-block min-w-[80px] ${W&&parseInt(S)>W.quantity?"bg-red-50 border-red-500 text-red-700 animate-pulse":"bg-white border-gray-200 text-gray-800"}`,children:S}):e.jsx("div",{className:"text-lg text-surface-400 bg-white rounded-lg py-2 px-4 border-2 border-dashed border-gray-300 inline-block min-w-[80px]",children:W?"0":"â€”"})]})}),e.jsxs("div",{className:"relative mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex mb-2 sm:mb-3 bg-surface-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>{F("kod"),be("")},className:`flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all ${ue==="kod"?"bg-blue-500 text-white shadow-sm":"text-surface-600 hover:text-surface-900"}`,children:"KOD"}),e.jsx("button",{onClick:()=>{F("son"),b(""),Z(!1),ve([])},className:`flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all ${ue==="son"?"bg-gray-500 text-white shadow-sm":"text-surface-600 hover:text-surface-900"}`,children:"SON"})]}),ue==="kod"?e.jsx("input",{type:"text",value:$,onChange:s=>{const d=s.target.value;b(d),d.length>0?je(d):(Z(!1),ve([]))},onKeyDown:s=>{s.key==="Enter"?(s.preventDefault(),Ae($)):s.key==="Escape"&&(Z(!1),ve([]))},onFocus:()=>{$.length>0&&je($)},placeholder:"Kod kiriting...",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-center text-sm sm:text-base font-mono bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"}):e.jsx("input",{type:"text",value:S,onChange:s=>{const d=s.target.value;/^\d*$/.test(d)&&be(d)},onKeyDown:s=>{if(s.key==="Enter"&&(s.preventDefault(),W&&S.trim())){const d=parseInt(S);if(!isNaN(d)&&d>0){if(d>W.quantity){a(`${W.name} uchun maksimal miqdor: ${W.quantity} ta`,"Ogohlantirish","warning");return}ys(W,d),Se(null),be(""),F("kod"),a(`${W.name} (${d} ta) savatchaga qo'shildi`,"Muvaffaqiyat","success")}}},placeholder:"1",disabled:!W,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-center text-lg sm:text-xl font-bold rounded-lg focus:outline-none focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed ${W&&S&&parseInt(S)>W.quantity?"bg-red-50 border-2 border-red-500 text-red-700 focus:border-red-500 focus:ring-red-500/20":"bg-surface-50 border border-surface-200 focus:border-gray-500 focus:ring-gray-500/20"}`})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1 sm:gap-2 mb-3",children:["7","8","9","C","4","5","6","âŒ«","1","2","3","+","0","00","."].map(s=>e.jsx("button",{onClick:()=>Ke(s),className:`
                flex items-center justify-center rounded-lg text-base sm:text-lg font-semibold transition-all active:scale-95
                ${s==="C"?"bg-red-500 text-white hover:bg-red-600":""}
                ${s==="âŒ«"?"bg-orange-500 text-white hover:bg-orange-600":""}
                ${s==="+"?`${ue==="kod"?"bg-green-500 hover:bg-green-600":"bg-blue-500 hover:bg-blue-600"} text-white row-span-2`:""}
                ${["C","âŒ«","+"].includes(s)?"":"bg-surface-100 text-surface-700 hover:bg-surface-200"}
                ${s==="+"?"h-full":"h-10 sm:h-12 lg:h-14"}
              `,children:s==="âŒ«"?e.jsx(lr,{className:"w-4 h-4 sm:w-5 sm:h-5"}):s==="+"?ue==="kod"?"+":"âœ“":s},s))})]}),N&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start justify-center pt-4 sm:pt-20 px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>D(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl relative z-10 overflow-hidden max-h-[90vh] sm:max-h-none",children:[e.jsx("div",{className:"p-4 border-b border-surface-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(gs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Nom yoki kod bo'yicha qidiring...",value:i,onChange:s=>vs(s.target.value),className:"w-full pl-12 pr-4 py-3 bg-surface-50 border border-surface-200 rounded-xl focus:outline-none focus:border-brand-500",autoFocus:!0})]})}),e.jsxs("div",{className:"max-h-[500px] sm:max-h-[600px] overflow-auto p-4",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-4",children:M.map(s=>e.jsxs("button",{onClick:()=>xs(s),className:"flex flex-col bg-white border border-surface-200 rounded-xl hover:shadow-lg hover:border-brand-300 transition-all p-3 text-left group relative",children:[e.jsx("button",{onClick:d=>{d.stopPropagation(),js(s)},className:"absolute top-2 right-2 z-10 w-8 h-8 flex items-center justify-center bg-white/90 backdrop-blur-sm hover:bg-brand-500 hover:text-white rounded-lg shadow-md transition-all duration-200 group/qr",title:"QR kod",children:e.jsx(xt,{className:"w-4 h-4"})}),e.jsxs("div",{className:"relative w-full aspect-square mb-3 rounded-lg overflow-hidden bg-surface-50",children:[s.images&&s.images.length>0?e.jsx("img",{src:`http://localhost:8000${typeof s.images[0]=="string"?s.images[0]:s.images[0].path}`,alt:s.name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300",onError:d=>{const P=d.currentTarget;P.style.display="none";const A=P.nextElementSibling;A&&A.classList.remove("hidden")}}):null,e.jsx("div",{className:`${s.images&&s.images.length>0?"hidden":""} absolute inset-0 flex items-center justify-center bg-gradient-to-br from-brand-50 to-brand-100`,children:e.jsx(Ie,{className:"w-12 h-12 text-brand-400"})}),s.quantity!==void 0&&e.jsx("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-lg text-xs font-bold shadow-lg ${s.quantity>10?"bg-success-500 text-white":s.quantity>0?"bg-warning-500 text-white":"bg-danger-500 text-white"}`,children:s.quantity>0?`${s.quantity}`:"Tugagan"})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("p",{className:"font-semibold text-surface-900 text-sm line-clamp-2 mb-2 min-h-[2.5rem]",children:s.name}),e.jsxs("p",{className:"text-xs text-surface-500 mb-2 font-mono",children:["#",s.code]}),e.jsxs("div",{className:"mt-auto",children:[e.jsx("p",{className:"text-lg font-bold text-brand-600",children:w(s.price)}),e.jsx("p",{className:"text-xs text-surface-400",children:"so'm"})]})]})]},s._id))}),i&&M.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Ie,{className:"w-8 h-8 text-surface-400"})}),e.jsx("p",{className:"text-center text-surface-500 font-medium",children:"Tovar topilmadi"}),e.jsx("p",{className:"text-center text-surface-400 text-sm mt-1",children:"Boshqa nom yoki kod bilan qidiring"})]})]})]})]}),V&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start justify-center pt-4 sm:pt-20 px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>K(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl relative z-10 overflow-hidden max-h-[90vh] sm:max-h-none",children:[e.jsxs("div",{className:"p-4 border-b border-surface-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Mijoz tanlash"}),e.jsx("button",{onClick:()=>K(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:bg-surface-100 transition-colors",children:"Ã—"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(gs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz ismi yoki telefon raqami...",value:le,onChange:s=>Oe(s.target.value),className:"w-full pl-12 pr-4 py-3 bg-surface-50 border border-surface-200 rounded-xl focus:outline-none focus:border-brand-500",autoFocus:!0})]})]}),e.jsx("div",{className:"max-h-80 sm:max-h-96 overflow-auto",children:o.length>0?o.map(s=>e.jsxs("button",{onClick:()=>{Q(s),K(!1),oe("")},className:"w-full flex items-center gap-3 p-4 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:s.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500",children:[e.jsx("span",{children:s.phone}),s.debt>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 rounded text-xs font-medium",children:[w(s.debt)," so'm qarz"]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"text-sm text-surface-600",children:[w(s.totalPurchases)," so'm"]}),e.jsx("p",{className:"text-xs text-surface-400",children:"jami xarid"})]})]},s._id)):e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-surface-500",children:le?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"})})})]})]}),f&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>y(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"To'lov turlarini tanlang"}),v&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-brand-600",children:v.name.charAt(0)})}),e.jsx("span",{className:"text-sm text-surface-600 truncate",children:v.name})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Jami summa:"}),e.jsxs("p",{className:"text-2xl sm:text-3xl font-bold text-surface-900 mb-3",children:[w(Me)," so'm"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(is,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Naqd pul:"})]}),e.jsxs("span",{className:"font-semibold",children:[w(ss.cash)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(Ys,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Click:"})]}),e.jsxs("span",{className:"font-semibold",children:[w(ss.click)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(Rs,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Plastik karta:"})]}),e.jsxs("span",{className:"font-semibold",children:[w(ss.card)," so'm"]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 flex justify-between",children:[e.jsx("span",{className:"text-surface-600",children:"Jami to'lov:"}),e.jsxs("span",{className:"font-bold text-lg",children:[w(re)," so'm"]})]}),re<Me&&e.jsxs("div",{className:"flex justify-between text-warning-600",children:[e.jsx("span",{children:"Qoldiq:"}),e.jsxs("span",{className:"font-bold",children:[w(Me-re)," so'm"]})]}),re>Me&&e.jsxs("div",{className:"flex justify-between text-success-600",children:[e.jsx("span",{children:"Qaytim:"}),e.jsxs("span",{className:"font-bold",children:[w(re-Me)," so'm"]})]})]})]}),re<Me&&e.jsx("div",{className:`border rounded-lg p-3 mb-4 ${v?"bg-blue-50 border-blue-200":"bg-warning-50 border-warning-200"}`,children:e.jsx("p",{className:`text-sm ${v?"text-blue-700":"text-warning-700"}`,children:v?e.jsxs(e.Fragment,{children:["â„¹ï¸ ",w(Me-re)," so'm qarz daftariga qo'shiladi"]}):e.jsxs(e.Fragment,{children:["âš ï¸ ",w(Me-re)," so'm qoldiq - mijoz tanlanmagan"]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs",children:[e.jsx(Gs,{className:`w-3 h-3 ${I.xPrinterFound?"text-green-600":I.available?"text-yellow-600":"text-red-600"}`}),e.jsx("span",{className:I.xPrinterFound?"text-green-600":I.available?"text-yellow-600":"text-red-600",children:I.xPrinterFound?"X Printer tayyor":I.available?`Printer mavjud (${I.printers.length} ta)`:"Printer topilmadi"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>E(this,null,function*(){var s,d;if(p.length===0){a("Savat bo'sh","Ogohlantirish","warning");return}try{console.log("Chek chiqarish uchun tovar miqdorlarini kamaytirish boshlandi...");const P=[];for(const U of p)try{console.log(`${U.name} uchun miqdorni kamaytirish: ${U.cartQuantity} ta`),yield _.put(`/products/${U._id}/reduce-quantity`,{quantity:U.cartQuantity}),console.log(`âœ… ${U.name} muvaffaqiyatli yangilandi`),P.push({success:!0,item:U.name})}catch(ie){console.error(`âŒ ${U.name} miqdorini kamaytirish xatosi:`,ie);const pe=((d=(s=ie.response)==null?void 0:s.data)==null?void 0:d.message)||"Noma'lum xatolik";P.push({success:!1,item:U.name,error:pe})}console.log("Tovar miqdorlarini yangilash tugadi. Natijalar:",P);const A=`HELPER-${Date.now()}`,G={items:p,total:Me,paymentMethod:"cash",customer:v,receiptNumber:A,cashier:"Kassir",date:new Date};try{console.log("Telegram botga chek ma'lumotlarini yuborish...");const U={items:p.map(pe=>({product:pe._id,name:pe.name,code:pe.code,price:pe.price,quantity:pe.cartQuantity,paymentBreakdown:pe.paymentBreakdown||{cash:0,click:0,card:0}})),total:Me,paymentMethod:"cash",customer:(v==null?void 0:v._id)||null,receiptNumber:A,paidAmount:re,remainingAmount:Me-re},ie=yield _.post("/receipts/kassa",U);console.log("âœ… Chek ma'lumotlari serverga yuborildi:",ie.data)}catch(U){console.error("âŒ Telegram xabar yuborishda xatolik:",U)}if(!(yield La(G,()=>{const U=P.filter(qe=>qe.success).length,ie=P.filter(qe=>!qe.success).length;let pe="Chek muvaffaqiyatli chiqarildi va telegram botga yuborildi";ie===0?a(pe+", tovar miqdorlari yangilandi!","Muvaffaqiyat","success"):a(`${pe}. ${U} ta tovar yangilandi, ${ie} ta xatolik`,"Ogohlantirish","warning"),z([]),Q(null),y(!1),ae()}))){const U=P.filter(qe=>qe.success).length,ie=P.filter(qe=>!qe.success).length;let pe="Chek faylga yuklandi va telegram botga yuborildi";ie===0?a(pe+", tovar miqdorlari yangilandi!","Ma'lumot","info"):a(`${pe}. ${U} ta tovar yangilandi, ${ie} ta xatolik`,"Ogohlantirish","warning"),z([]),Q(null),y(!1),ae()}}catch(P){console.error("Chek chiqarish xatosi:",P),a("Chek chiqarishda xatolik yuz berdi","Xatolik","danger")}}),className:"w-full flex items-center justify-center gap-2 py-3 sm:py-4 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-semibold transition-colors",children:[e.jsx(Gs,{className:"w-5 h-5"}),"Chek chiqarish (to'lovsiz)"]}),re<Me&&!v&&e.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-lg p-3",children:e.jsx("p",{className:"text-xs text-warning-700 text-center",children:"ðŸ’¡ Qoldiq summa uchun mijoz tanlashingiz mumkin yoki oddiy mijoz sifatida saqlashingiz mumkin"})}),e.jsx("button",{onClick:()=>y(!1),className:"w-full py-3 text-surface-600 hover:text-surface-900 transition-colors",children:"Bekor qilish"})]})]})]}),Be&&Qe&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{We(!1),Ge(null)}}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"To'lov turlarini tanlang"}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-1",children:Qe.name}),e.jsxs("p",{className:"text-xs text-surface-500 font-mono mb-2",children:["Kod: ",Qe.code]}),e.jsxs("p",{className:"text-lg font-bold text-surface-900",children:["Jami: ",w(Qe.price*Qe.cartQuantity)," so'm"]})]})]}),e.jsx(xl,{item:Qe,selectedCustomer:v,onSave:lt,onCancel:()=>{We(!1),Ge(null)}})]})]}),Fe&&m&&e.jsx(ml,{isOpen:Fe,onClose:()=>{Ve(!1),te(null)},item:m,customer:v,onSave:(s,d)=>{z(P=>P.map(A=>{if(A._id!==m._id)return A;const G=A.paymentBreakdown||{cash:0,click:0,card:0,partner:0};return j(g({},A),{paymentBreakdown:j(g({},G),{partner:(G.partner||0)+d})})}))}}),Ce&&ne&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{ze(!1),Ze(null)}}),e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-sm p-4 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-surface-900 mb-2",children:"Foizni o'zgartirish"}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-2.5 mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-surface-700 mb-1",children:ne.name}),e.jsxs("p",{className:"text-[10px] text-surface-500 font-mono mb-1.5",children:["Kod: ",ne.code]}),e.jsxs("p",{className:"text-xs text-surface-600",children:["Miqdor: ",ne.cartQuantity," ta"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Qo'shimcha foiz (%)"}),e.jsx("input",{type:"number",value:x,onChange:s=>ce(Number(s.target.value)||0),min:"0",max:"100",step:"0.1",className:"w-full px-3 py-2 border border-surface-200 rounded-lg text-center text-base font-semibold focus:ring-2 focus:ring-brand-500 focus:border-transparent",placeholder:"15"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1.5",children:[5,10,15,20].map(s=>e.jsxs("button",{onClick:()=>ce(s),className:`py-1.5 px-2 rounded-lg text-xs font-medium transition-colors ${x===s?"bg-brand-500 text-white":"bg-surface-100 text-surface-700 hover:bg-surface-200"}`,children:[s,"%"]},s))}),ne&&e.jsxs("div",{className:"bg-brand-50 rounded-lg p-2.5",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs mb-1",children:[e.jsx("span",{className:"text-surface-600",children:"Yangi narx (1 ta):"}),e.jsxs("span",{className:"font-semibold text-brand-600",children:[w(Math.round((ne.costPrice||ne.price/1.15)*(1+x/100)))," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-surface-600",children:"Jami summa:"}),e.jsxs("span",{className:"font-bold text-brand-700",children:[w(Math.round((ne.costPrice||ne.price/1.15)*(1+x/100))*ne.cartQuantity)," so'm"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{ze(!1),Ze(null)},className:"flex-1 py-2 px-3 bg-surface-100 text-surface-700 rounded-lg font-medium hover:bg-surface-200 transition-colors text-sm",children:"Bekor qilish"}),e.jsx("button",{onClick:Ks,className:"flex-1 py-2 px-3 bg-brand-500 text-white rounded-lg font-medium hover:bg-brand-600 transition-colors text-sm",children:"Saqlash"})]})]})]}),H&&we&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>he(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl relative z-10 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-surface-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold text-surface-900",children:"QR Kod"}),e.jsx("button",{onClick:()=>he(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:bg-surface-100 transition-colors",children:"Ã—"})]}),e.jsxs("div",{className:"p-6 flex flex-col items-center",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border-2 border-surface-200 mb-4",children:C?e.jsx("img",{src:C,alt:"QR Code",className:"w-48 h-48",style:{imageRendering:"pixelated"}}):e.jsx("div",{className:"w-48 h-48 bg-surface-100 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-brand-500 border-t-transparent rounded-full animate-spin"})})}),e.jsxs("div",{className:"text-center mb-4 w-full",children:[e.jsx("p",{className:"font-bold text-surface-900 text-lg mb-1",children:we.name}),e.jsxs("p",{className:"text-sm text-surface-500 mb-2",children:["Kod: ",we.code]}),e.jsxs("p",{className:"text-2xl font-bold text-brand-600",children:[w(we.price)," ",e.jsx("span",{className:"text-sm",children:"so'm"})]})]}),e.jsxs("button",{onClick:ns,disabled:!C,className:"w-full px-6 py-3 bg-brand-600 text-white rounded-xl font-semibold hover:bg-brand-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(Gs,{className:"w-5 h-5"}),"Chop etish"]})]})]})]}),$e&&Ne&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{Ee(!1),De(null),c("")}}),e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-sm p-4 shadow-2xl relative z-10",children:[e.jsx("h3",{className:"text-base font-bold text-surface-900 mb-3",children:"Mahsulot qadini o'zgartirish"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-surface-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-surface-600 mb-1",children:"Mahsulot:"}),e.jsx("p",{className:"font-semibold text-sm text-surface-900",children:Ne.name}),e.jsxs("p",{className:"text-[10px] text-surface-500 mt-1",children:["Kod: ",Ne.code]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Hozirgi qad:"}),e.jsxs("p",{className:"text-xl font-bold text-blue-700",children:[Ne.quantity," ta"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Yangi qad:"}),e.jsx("input",{type:"number",value:B,onChange:s=>c(s.target.value),className:"w-full px-3 py-2 text-base font-semibold border-2 border-brand-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/10",placeholder:"Yangi qadni kiriting",min:"0",autoFocus:!0})]}),e.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-lg p-2",children:e.jsx("p",{className:"text-[10px] text-warning-700",children:"âš ï¸ Diqqat: Mahsulot qadi o'zgartirilganda, agar savatchada bu mahsulot bo'lsa va yangi qad savatchadagi miqdordan kam bo'lsa, savatchadagi miqdor ham kamaytiriladi."})})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{Ee(!1),De(null),c("")},className:"flex-1 py-2 px-3 bg-surface-100 text-surface-700 rounded-lg font-medium hover:bg-surface-200 transition-colors text-sm",children:"Bekor qilish"}),e.jsx("button",{onClick:fs,className:"flex-1 py-2 px-3 bg-brand-500 text-white rounded-lg font-medium hover:bg-brand-600 transition-colors text-sm",children:"Saqlash"})]})]})]})]})}function hl(){const[a,n]=t.useState([]),[r,u]=t.useState(!0),[l,h]=t.useState(null),[k,p]=t.useState(!1),{showAlert:z,AlertComponent:$}=Ns();t.useEffect(()=>{b()},[]);const b=()=>E(this,null,function*(){var N,D;try{u(!0),console.log("Fetching receipts from /receipts/kassa...");const i=yield _.get("/receipts/kassa");console.log("Receipts response:",i.data),console.log("Total receipts:",i.data.length),n(i.data)}catch(i){console.error("Cheklar yuklashda xatolik:",i),console.error("Error response:",i.response),z(((D=(N=i.response)==null?void 0:N.data)==null?void 0:D.message)||"Cheklar yuklashda xatolik","Xatolik","danger")}finally{u(!1)}}),f=N=>{const D=window.open("","_blank","width=600,height=800");if(!D){z("Popup bloklangan. Iltimos, popup ga ruxsat bering.","Ogohlantirish","warning");return}const i=N.items.map((T,M)=>`
      <tr>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: center; font-size: 14px;">${M+1}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; font-size: 14px;">${T.product.name}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: center; font-size: 14px;">${T.quantity}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: right; font-size: 14px;">${w(T.price)}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: right; font-weight: bold; font-size: 14px;">${w(T.price*T.quantity)}</td>
      </tr>
    `).join("");D.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Chek #${N.receiptNumber}</title>
        <style>
          @page { size: 80mm auto; margin: 0; }
          @media print {
            body { width: 80mm; margin: 0; }
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body { 
            font-family: 'Courier New', monospace;
            width: 80mm;
            padding: 10mm 5mm;
            background: white;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
          }
          .header { 
            text-align: center; 
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px dashed #000;
          }
          .header h1 { 
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
          }
          .header .subtitle { 
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
          }
          .header .receipt-number { 
            font-size: 14px;
            font-weight: bold;
            margin-top: 8px;
          }
          table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 15px 0;
          }
          th { 
            padding: 8px 4px;
            text-align: left; 
            border-bottom: 2px solid #000;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
          }
          th.center { text-align: center; }
          th.right { text-align: right; }
          .total-section { 
            margin-top: 15px;
            padding-top: 10px;
            border-top: 2px dashed #000;
          }
          .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
          }
          .total-label {
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
          }
          .total-amount {
            font-size: 20px;
            font-weight: bold;
          }
          .footer { 
            margin-top: 20px;
            padding-top: 15px;
            text-align: center;
            border-top: 2px dashed #000;
          }
          .footer p {
            font-size: 11px;
            color: #666;
            margin: 3px 0;
          }
          .thank-you {
            font-size: 13px;
            font-weight: bold;
            margin-top: 10px;
          }
        </style>
      </head>
      <body>
        <div class="header">
          <!-- Logo -->
          <div style="margin-bottom: 8px;">
            <img src="/o5sk1awh.png" alt="Logo" style="width: 40px; height: 40px; display: block; margin: 0 auto; border-radius: 6px;" />
          </div>
          <h1>SARDOR FURNITURA</h1>
          <div class="subtitle">Mebel furniturasi</div>
          <div class="receipt-number">Chek #${N.receiptNumber}</div>
        </div>

        <table>
          <thead>
            <tr>
              <th style="width: 25px;" class="center">â„–</th>
              <th>Mahsulot</th>
              <th style="width: 35px;" class="center">Soni</th>
              <th style="width: 60px;" class="right">Narxi</th>
              <th style="width: 70px;" class="right">Jami</th>
            </tr>
          </thead>
          <tbody>
            ${i}
          </tbody>
        </table>

        <div class="total-section">
          <div class="total-row">
            <span class="total-label">JAMI:</span>
            <span class="total-amount">${w(N.totalAmount)} so'm</span>
          </div>
        </div>

        <div class="footer">
          <p class="thank-you">Xaridingiz uchun rahmat!</p>
          <p>Sardor Furnitura - Sifatli mebel furniturasi</p>
        </div>
      </body>
      </html>
    `),D.document.close(),D.print()},y=N=>{h(N),p(!0)};return r?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-brand-500 border-t-transparent"})}):e.jsxs("div",{className:"min-h-screen bg-surface-50 p-2 sm:p-4 pb-20",children:[$,e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-3 sm:p-4 mb-3 sm:mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(Hs,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-base sm:text-xl font-bold text-surface-900 truncate",children:"Cheklar"}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Hodimlar cheklari"})]})]}),e.jsxs("button",{onClick:b,className:"btn-secondary flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-2 text-sm flex-shrink-0",children:[e.jsx(Os,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangilash"})]})]})}),a.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-8 sm:p-12 text-center",children:[e.jsx(Hs,{className:"w-12 h-12 sm:w-16 sm:h-16 text-surface-300 mx-auto mb-3 sm:mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-surface-900 mb-2",children:"Cheklar yo'q"}),e.jsx("p",{className:"text-sm sm:text-base text-surface-500",children:"Hali hech qanday chek yaratilmagan"})]}):e.jsx("div",{className:"max-h-[calc(100vh-180px)] overflow-y-auto",children:e.jsx("div",{className:"grid gap-3 sm:gap-4 pr-1",children:a.map(N=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-3 sm:p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-brand-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Hs,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"font-bold text-sm sm:text-base text-surface-900 truncate",children:["Chek #",N.receiptNumber]}),e.jsx("p",{className:"text-xs text-surface-500",children:new Date(N.createdAt).toLocaleString("uz-UZ",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(ls,{className:"w-3 h-3 sm:w-4 sm:h-4 text-surface-400 flex-shrink-0"}),e.jsx("span",{className:"text-surface-600",children:"Sotuvchi:"}),e.jsx("span",{className:"font-medium text-surface-900 truncate",children:N.createdBy.name})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(Ie,{className:"w-3 h-3 sm:w-4 sm:h-4 text-surface-400 flex-shrink-0"}),e.jsx("span",{className:"text-surface-600",children:"Mahsulotlar:"}),e.jsxs("span",{className:"font-medium text-surface-900",children:[N.items.length," ta"]})]}),N.customer&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(ls,{className:"w-3 h-3 sm:w-4 sm:h-4 text-surface-400 flex-shrink-0"}),e.jsx("span",{className:"text-surface-600",children:"Mijoz:"}),e.jsx("span",{className:"font-medium text-surface-900 truncate",children:N.customer.name})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Tel:"}),e.jsx("span",{className:"font-medium text-surface-900",children:N.customer.phone})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 sm:p-3 bg-brand-50 rounded-lg mb-3",children:[e.jsx(is,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600 flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm text-surface-600",children:"Jami:"}),e.jsxs("span",{className:"text-base sm:text-lg font-bold text-brand-700",children:[w(N.totalAmount)," so'm"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>y(N),className:"flex-1 flex items-center justify-center gap-1 sm:gap-2 p-2 bg-blue-50 hover:bg-blue-100 text-blue-600 rounded-lg transition-colors text-xs sm:text-sm",children:[e.jsx(Qs,{className:"w-4 h-4"}),e.jsx("span",{children:"Ko'rish"})]}),e.jsxs("button",{onClick:()=>f(N),className:"flex-1 flex items-center justify-center gap-1 sm:gap-2 p-2 bg-green-50 hover:bg-green-100 text-green-600 rounded-lg transition-colors text-xs sm:text-sm",children:[e.jsx(Gs,{className:"w-4 h-4"}),e.jsx("span",{children:"Print"})]})]})]},N._id))})}),k&&l&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-2 sm:p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-white border-b border-surface-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-base sm:text-xl font-bold text-surface-900",children:["Chek #",l.receiptNumber]}),e.jsx("button",{onClick:()=>p(!1),className:"p-2 hover:bg-surface-100 rounded-lg transition-colors",children:"âœ•"})]})}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3 mb-4 sm:mb-6",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-surface-900 mb-2 sm:mb-3",children:"Mahsulotlar:"}),l.items.map((N,D)=>e.jsxs("div",{className:"flex items-start justify-between p-2 sm:p-3 bg-surface-50 rounded-lg gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm sm:text-base text-surface-900 break-words",children:N.product.name}),e.jsxs("p",{className:"text-xs sm:text-sm text-surface-500",children:["Kod: ",N.product.code]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"font-semibold text-xs sm:text-sm text-surface-900 whitespace-nowrap",children:[N.quantity," x ",w(N.price)]}),e.jsxs("p",{className:"text-xs sm:text-sm text-brand-600 font-bold",children:[w(N.quantity*N.price)," so'm"]})]})]},D))]}),e.jsx("div",{className:"border-t border-surface-200 pt-3 sm:pt-4",children:e.jsxs("div",{className:"flex items-center justify-between text-base sm:text-lg font-bold",children:[e.jsx("span",{className:"text-surface-900",children:"JAMI:"}),e.jsxs("span",{className:"text-brand-700",children:[w(l.totalAmount)," so'm"]})]})})]})]})})]})}function pl(){const{showAlert:a,AlertComponent:n}=Ns(),r=at(),[u,l]=t.useState([]),[h,k]=t.useState(""),[p,z]=t.useState([]),[$,b]=t.useState(!1),[f,y]=t.useState(!1),[N,D]=t.useState("");t.useEffect(()=>{T(!0);const M=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=M}},[]),t.useEffect(()=>{T(!0)},[r.pathname]);const i=()=>E(this,null,function*(){b(!0);try{yield T(!1),a("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(M){console.error("Refresh xatosi:",M),a("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{b(!1)}});t.useEffect(()=>{if(h.trim()==="")z(u);else{const M=u.filter(q=>q.name.toLowerCase().includes(h.toLowerCase())||q.phone.includes(h));z(M)}},[u,h]);const T=(M=!0)=>E(this,null,function*(){try{M&&y(!0),D("");const v=(yield _.get("/customers/kassa")).data.filter(Q=>{const V=Q.name&&Q.name.trim().length>0,K=Q.phone&&Q.phone.trim().length>0;return V&&K}).map(Q=>j(g({},Q),{name:Q.name.trim(),phone:Q.phone.trim(),totalPurchases:Number(Q.totalPurchases)||0,debt:Number(Q.debt)||0}));l(v)}catch(q){console.error("Error fetching customers:",q),D("Mijozlarni yuklashda xatolik yuz berdi")}finally{M&&y(!1)}});return e.jsxs("div",{className:"p-6",children:[n,e.jsxs("div",{className:"bg-white rounded-xl border border-surface-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(gs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz qidirish...",value:h,onChange:M=>k(M.target.value),className:"w-full pl-10 pr-4 py-2 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500"})]}),e.jsxs("button",{onClick:i,disabled:$,className:"flex items-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50",children:[e.jsx(Os,{className:`w-4 h-4 ${$?"animate-spin":""}`}),$?"Yangilanmoqda...":"Yangilash"]})]})}),e.jsx("div",{className:"divide-y divide-surface-100",children:f?e.jsx("div",{className:"p-8 text-center text-surface-500",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Os,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Mijozlar yuklanmoqda..."})]})}):N?e.jsxs("div",{className:"p-8 text-center text-danger-500",children:[e.jsx("p",{children:N}),e.jsx("button",{onClick:i,className:"mt-2 px-4 py-2 bg-danger-100 text-danger-700 rounded-lg hover:bg-danger-200 transition-colors",children:"Qayta urinish"})]}):p.length===0?e.jsx("div",{className:"p-8 text-center text-surface-500",children:h?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"}):p.map(M=>e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-surface-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600",children:M.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:M.name}),e.jsx("p",{className:"text-sm text-surface-500",children:M.phone}),M.email&&e.jsx("p",{className:"text-xs text-surface-400",children:M.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-surface-500",children:"Jami xaridlar"}),e.jsx("p",{className:"font-semibold text-surface-900",children:w(M.totalPurchases||0)}),M.debt>0&&e.jsxs("p",{className:"text-xs text-danger-600 font-medium",children:["Qarz: ",w(M.debt)]})]})]},M._id))})]})]})}function fl(){var B,c,H,he,we,ye;const{showAlert:a,AlertComponent:n}=Ns(),r=at(),[u,l]=t.useState([]),[h,k]=t.useState([]),[p,z]=t.useState([]),[$,b]=t.useState(!1),[f,y]=t.useState(""),[N,D]=t.useState(""),[i,T]=t.useState(""),[M,q]=t.useState(null),[v,Q]=t.useState([]),[V,K]=t.useState(!1),[le,oe]=t.useState(!1),[O,ke]=t.useState({paidAmount:"",dueDate:"",description:""}),[ee,ve]=t.useState(!1),[X,Z]=t.useState(!1),[L,xe]=t.useState(null),[I,de]=t.useState(!1),[ue,F]=t.useState({name:"",phone:"",email:"",address:""});t.useEffect(()=>{Se(),Be(),We();const C=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=C}},[]),t.useEffect(()=>{Se(),Be(),We()},[r.pathname]);const S=()=>E(this,null,function*(){var C,Y;if(!ue.name.trim()||!ue.phone.trim()){a("Mijoz ismi va telefon raqami majburiy","Xatolik","warning");return}try{const re=yield _.post("/customers/kassa",{name:ue.name.trim(),phone:ue.phone.trim(),email:ue.email.trim(),address:ue.address.trim()});re.data.success&&(a("Mijoz muvaffaqiyatli qo'shildi","Muvaffaqiyat","success"),Be(),q(re.data.customer),F({name:"",phone:"",email:"",address:""}),de(!1))}catch(re){console.error("Error creating customer:",re);const ge=((Y=(C=re.response)==null?void 0:C.data)==null?void 0:Y.message)||"Mijoz qo'shishda xatolik yuz berdi";a(ge,"Xatolik","danger")}}),be=()=>{F({name:"",phone:"",email:"",address:""}),de(!1)},W=()=>E(this,null,function*(){oe(!0);try{yield Promise.all([Se(),Be(),We()]),a("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(C){console.error("Refresh xatosi:",C),a("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{oe(!1)}}),Se=()=>E(this,null,function*(){try{const C=yield _.get("/debts/kassa");l(C.data)}catch(C){console.error("Error fetching debts:",C)}}),Be=()=>E(this,null,function*(){try{const C=yield _.get("/customers/kassa");k(C.data)}catch(C){console.error("Error fetching customers:",C)}}),We=()=>E(this,null,function*(){try{const C=yield _.get("/products/kassa"),Y=C.data.data||C.data;z(Array.isArray(Y)?Y:[])}catch(C){console.error("Error fetching products:",C)}}),Qe=C=>{q(C);const Y=u.find(re=>{var ge;return((ge=re.customer)==null?void 0:ge._id)===C._id&&re.status==="approved"});Y&&a(`${C.name} mijozining ${w(Y.amount-Y.paidAmount)} so'm tasdiqlangan qarzi mavjud. Yangi qarz to'g'ridan-to'g'ri mavjud qarzga qo'shiladi.`,"Ma'lumot","info")},Ge=()=>{b(!1),q(null),Q([]),D(""),T(""),K(!1),de(!1),ke({paidAmount:"",dueDate:"",description:""}),F({name:"",phone:"",email:"",address:""})},Fe=C=>{const Y=v.find(re=>re.product._id===C._id);Q(Y?re=>re.map(ge=>ge.product._id===C._id?j(g({},ge),{quantity:ge.quantity+1}):ge):re=>[...re,{product:C,quantity:1,price:C.price}]),T(""),K(!1)},Ve=(C,Y)=>{if(Y<=0){Q(re=>re.filter(ge=>ge.product._id!==C));return}Q(re=>re.map(ge=>ge.product._id===C?j(g({},ge),{quantity:Y}):ge))},m=C=>{Q(Y=>Y.filter(re=>re.product._id!==C))},te=C=>{xe(C),ve(!0)},Ce=()=>E(this,null,function*(){var C,Y;if(L)try{yield _.delete(`/debts/kassa/${L._id}`),a("Qarz muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),Z(!1),xe(null),Se()}catch(re){console.error("Error deleting debt:",re);const ge=((Y=(C=re.response)==null?void 0:C.data)==null?void 0:Y.message)||"Qarzni o'chirishda xatolik yuz berdi";a(ge,"Xatolik","danger")}}),ze=()=>{ve(!1),xe(null)},ne=()=>{Z(!1),xe(null)},Ze=()=>E(this,null,function*(){if(!M||v.length===0||!O.dueDate){a("Barcha majburiy maydonlarni to'ldiring","Xatolik","warning");return}try{const C=v.reduce((_e,ms)=>_e+ms.price*ms.quantity,0),Y=parseFloat(Ye(O.paidAmount))||0;if(Y>C){a(`To'langan summa (${w(Y)} so'm) jami summadan (${w(C)} so'm) ko'p bo'lishi mumkin emas!`,"Xatolik","danger");return}const re={customer:M._id,amount:C,paidAmount:Y,dueDate:O.dueDate,description:O.description,items:v.map(_e=>({product:_e.product._id,quantity:_e.quantity,price:_e.price}))},ps=(yield _.post("/debts/kassa",re)).status===200?"Qarz mavjud qarzga muvaffaqiyatli qo'shildi! Bitta qarz sifatida ko'rinadi.":"Yangi qarz yaratildi va admin tasdiqlashini kutmoqda.";a(ps,"Muvaffaqiyat","success"),Ge(),Se()}catch(C){console.error("Error creating debt:",C),a("Qarz qo'shishda xatolik yuz berdi","Xatolik","danger")}}),x=h.filter(C=>N===""||C.name.toLowerCase().includes(N.toLowerCase())||C.phone.includes(N)),ce=p.filter(C=>{if(!i.trim())return!1;const Y=i.toLowerCase().trim(),re=C.name.toLowerCase(),ge=C.code.toLowerCase();return!!(ge===Y||ge.startsWith(Y)||ge.includes(Y)||re.includes(Y))}).sort((C,Y)=>{const re=i.toLowerCase().trim(),ge=C.code.toLowerCase(),ss=Y.code.toLowerCase(),ps=C.name.toLowerCase(),_e=Y.name.toLowerCase();return ge===re&&ss!==re?-1:ss===re&&ge!==re?1:ge.startsWith(re)&&!ss.startsWith(re)?-1:ss.startsWith(re)&&!ge.startsWith(re)?1:ps.startsWith(re)&&!_e.startsWith(re)?-1:_e.startsWith(re)&&!ps.startsWith(re)?1:C.name.localeCompare(Y.name)}),$e=v.reduce((C,Y)=>C+Y.price*Y.quantity,0),Ee=parseFloat(Ye(O.paidAmount))||0,Ne=$e-Ee,De=u.filter(C=>{var ss,ps,_e;if(!f.trim())return!0;const Y=f.toLowerCase(),re=((ps=(ss=C.customer)==null?void 0:ss.name)==null?void 0:ps.toLowerCase())||"",ge=((_e=C.customer)==null?void 0:_e.phone)||"";return re.includes(Y)||ge.includes(Y)});return e.jsxs("div",{className:"p-3 sm:p-6 h-full flex flex-col overflow-hidden",children:[n,e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-6 flex-shrink-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center justify-center gap-2 px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors w-full sm:w-auto",children:[e.jsx(is,{className:"w-4 h-4"}),"Yangi qarz"]}),e.jsxs("button",{onClick:W,disabled:le,className:"flex items-center justify-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50 w-full sm:w-auto",children:[e.jsx(Os,{className:`w-4 h-4 ${le?"animate-spin":""}`}),le?"Yangilanmoqda...":"Yangilash"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 mb-6 flex-shrink-0",children:[e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl border border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx(is,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Jami qarz"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-surface-900 truncate",children:w(u.reduce((C,Y)=>C+(Y.amount-Y.paidAmount),0))})]})]})}),e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl border border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-success-100 rounded-lg flex items-center justify-center",children:e.jsx(na,{className:"w-4 h-4 sm:w-5 sm:h-5 text-success-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Jami qarzlar soni"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-surface-900",children:u.length})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-surface-200 overflow-hidden flex flex-col h-[calc(100vh-400px)] min-h-[400px]",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-surface-200 flex-shrink-0",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(gs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz qidirish...",value:f,onChange:C=>y(C.target.value),className:"w-full pl-9 sm:pl-10 pr-4 py-2 sm:py-3 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:De.length===0?e.jsxs("div",{className:"p-8 text-center text-surface-500",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(is,{className:"w-8 h-8 text-surface-400"})}),e.jsx("p",{className:"font-medium text-lg mb-2",children:f?"Qarz topilmadi":"Qarzlar ro'yxati bo'sh"}),e.jsx("p",{className:"text-sm",children:f?`"${f}" bo'yicha hech qanday qarz topilmadi`:"Hozircha hech qanday qarz qo'shilmagan"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block sm:hidden",children:De.map(C=>{var Y,re,ge;return e.jsxs("div",{className:"p-4 border-b border-surface-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:(Y=C.customer)==null?void 0:Y.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:(re=C.customer)==null?void 0:re.name}),e.jsx("p",{className:"text-sm text-surface-500",children:(ge=C.customer)==null?void 0:ge.phone})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Qarz summasi"}),e.jsx("p",{className:"font-medium text-surface-900",children:w(C.amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Qoldiq"}),e.jsx("p",{className:"font-medium text-danger-600",children:w(C.amount-C.paidAmount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Muddat"}),e.jsx("p",{className:"text-surface-900",children:new Date(C.dueDate).toLocaleDateString()})]}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx("button",{onClick:()=>te(C),className:"p-2 text-brand-600 hover:text-brand-700 hover:bg-brand-50 rounded-lg transition-colors",title:"Qarz ma'lumotlarini ko'rish",children:e.jsx(Qs,{className:"w-4 h-4"})})})]})]},C._id)})}),e.jsx("div",{className:"hidden sm:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surface-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Mijoz"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Qarz"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Qoldiq"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Muddat"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Amallar"})]})}),e.jsx("tbody",{className:"divide-y divide-surface-100",children:De.map(C=>{var Y,re,ge;return e.jsxs("tr",{className:"hover:bg-surface-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:(Y=C.customer)==null?void 0:Y.name.charAt(0)})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:(re=C.customer)==null?void 0:re.name}),e.jsx("p",{className:"text-sm text-surface-500 truncate",children:(ge=C.customer)==null?void 0:ge.phone})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-surface-900",children:w(C.amount)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-danger-600",children:w(C.amount-C.paidAmount)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-surface-500",children:new Date(C.dueDate).toLocaleDateString()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>te(C),className:"p-2 text-brand-600 hover:text-brand-700 hover:bg-brand-50 rounded-lg transition-colors",title:"Qarz ma'lumotlarini ko'rish",children:e.jsx(Qs,{className:"w-4 h-4"})})})})]},C._id)})})]})})]})})]}),$&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>Ge()}),e.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl w-full max-w-6xl shadow-2xl relative z-10 max-h-[95vh] sm:max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 lg:p-6 border-b border-surface-200 bg-gradient-to-r from-brand-50 to-blue-50 rounded-t-2xl sm:rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-lg flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(is,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold text-surface-900 truncate",children:M?`${M.name} uchun qarz qo'shish`:"Mijoz tanlash"}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-600 truncate",children:M?"Mahsulotlarni tanlang va to'lov ma'lumotlarini kiriting":"Qarz berish uchun mijozni tanlang"})]})]}),e.jsx("button",{onClick:()=>Ge(),className:"w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors flex-shrink-0",children:e.jsx(fe,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),M?e.jsxs("div",{className:"flex-1 p-3 sm:p-4 lg:p-6 overflow-y-auto min-h-0",children:[e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"bg-surface-50 p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600 text-sm sm:text-lg",children:M.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:M.name}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-500",children:M.phone})]})]})}),e.jsxs("div",{className:"bg-white border border-surface-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Mahsulotlar"}),e.jsxs("button",{onClick:()=>K(!0),className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 lg:px-4 py-1.5 sm:py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors shadow-sm text-xs sm:text-sm",children:[e.jsx(ds,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Mahsulot qidirish"}),e.jsx("span",{className:"sm:hidden",children:"Qo'shish"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(gs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Tez qidirish: mahsulot nomi yoki kodi...",value:i,onChange:C=>T(C.target.value),onFocus:()=>K(!0),onKeyDown:C=>{C.key==="Enter"&&ce.length>0&&Fe(ce[0]),C.key==="Escape"&&T("")},className:"w-full pl-10 pr-10 py-2 text-xs sm:text-sm bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"}),i&&e.jsx("button",{onClick:()=>T(""),className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 flex items-center justify-center text-surface-400 hover:text-surface-600 rounded-full hover:bg-surface-100",children:e.jsx(fe,{className:"w-3 h-3"})})]}),i&&ce.length>0&&!V&&e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-surface-500",children:[e.jsxs("span",{children:[ce.length," ta mahsulot topildi"]}),e.jsx("span",{className:"text-brand-600",children:"Enter - birinchisini tanlash"})]})]}),i&&ce.length>0&&!V&&e.jsxs("div",{className:"mb-4 max-h-40 overflow-y-auto border border-surface-200 rounded-lg",children:[ce.slice(0,5).map(C=>e.jsxs("button",{onClick:()=>Fe(C),className:"w-full flex items-center gap-3 p-2 hover:bg-surface-50 transition-colors text-left border-b border-surface-100 last:border-b-0",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(Ie,{className:"w-4 h-4 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 text-sm truncate",children:C.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-surface-500 bg-surface-100 px-2 py-0.5 rounded",children:C.code}),e.jsxs("span",{className:"text-xs text-surface-500",children:["Omborda: ",C.quantity," ta"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold text-brand-600 text-sm",children:w(C.price)})})]},C._id)),ce.length>5&&e.jsxs("button",{onClick:()=>K(!0),className:"w-full p-2 text-center text-sm text-brand-600 hover:bg-brand-50 transition-colors",children:["Yana ",ce.length-5," ta ko'rish..."]})]}),e.jsx("div",{className:"space-y-2",children:v.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center text-surface-500 border-2 border-dashed border-surface-200 rounded-lg",children:[e.jsx(Ie,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Mahsulot tanlanmagan"})]}):v.map(C=>e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 bg-surface-50 rounded-lg border border-surface-200",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 text-xs sm:text-sm truncate",children:C.product.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",C.product.code]})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>Ve(C.product._id,C.quantity-1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded bg-surface-200 hover:bg-surface-300 transition-colors",children:e.jsx(ht,{className:"w-3 h-3"})}),e.jsx("span",{className:"w-8 sm:w-10 text-center font-medium bg-white px-1 sm:px-2 py-1 rounded border text-xs sm:text-sm",children:C.quantity}),e.jsx("button",{onClick:()=>Ve(C.product._id,C.quantity+1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded bg-surface-200 hover:bg-surface-300 transition-colors",children:e.jsx(ds,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"text-right min-w-0",children:[e.jsxs("p",{className:"font-bold text-surface-900 text-xs sm:text-sm",children:[w(C.price*C.quantity)," so'm"]}),e.jsxs("p",{className:"text-xs text-surface-500",children:[w(C.price)," Ã— ",C.quantity]})]}),e.jsx("button",{onClick:()=>m(C.product._id),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded text-danger-500 hover:bg-danger-50 transition-colors flex-shrink-0",children:e.jsx(fe,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]},C.product._id))})]}),e.jsxs("div",{className:"bg-surface-50 p-3 sm:p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"Jami summa:"}),e.jsxs("span",{className:"font-semibold text-surface-900 text-xs sm:text-sm",children:[w($e)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"To'langan:"}),e.jsxs("span",{className:"font-semibold text-success-600 text-xs sm:text-sm",children:[w(Ee)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between border-t border-surface-200 pt-2",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"Qarz qoldi:"}),e.jsxs("span",{className:`font-bold text-sm sm:text-base ${Ne<0,"text-danger-600"}`,children:[Ne<0?"-":"",w(Math.abs(Ne))," so'm"]})]}),Ne<0&&e.jsx("div",{className:"bg-danger-50 border border-danger-200 rounded-lg p-2 mt-2",children:e.jsx("p",{className:"text-danger-700 text-xs font-medium",children:"âš ï¸ To'langan summa jami summadan ko'p! Qarz minus bo'ldi."})})]}),e.jsxs("div",{className:"bg-white border border-surface-200 rounded-xl p-4 space-y-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"To'lov ma'lumotlari"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-surface-700 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(is,{className:"w-3 h-3 sm:w-4 sm:h-4 text-success-600"}),"To'langan summa"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"0",value:O.paidAmount,onChange:C=>{const Y=rs(C.target.value);if((parseFloat(Ye(Y))||0)>$e&&$e>0){a(`To'langan summa jami summadan (${w($e)} so'm) ko'p bo'lishi mumkin emas!`,"Ogohlantirish","warning");return}ke(ge=>j(g({},ge),{paidAmount:Y}))},className:`w-full pl-3 sm:pl-4 pr-12 sm:pr-16 py-3 sm:py-4 text-base sm:text-lg font-semibold border-2 rounded-xl focus:outline-none focus:ring-4 transition-all ${Ne<0?"border-danger-500 bg-gradient-to-r from-danger-50 to-red-50 focus:border-danger-500 focus:ring-danger-500/10":Ee<$e&&Ee>0?"border-orange-400 bg-gradient-to-r from-yellow-100 to-orange-100 focus:border-orange-400 focus:ring-orange-400/10":"border-surface-200 bg-gradient-to-r from-white to-success-50 focus:border-success-500 focus:ring-success-500/10"}`}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 sm:pr-4 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-surface-500 font-medium text-xs sm:text-sm",children:"so'm"})})]}),O.paidAmount&&e.jsxs("div",{className:`mt-2 text-xs sm:text-sm font-medium ${Ne<0?"text-danger-600":"text-success-600"}`,children:[O.paidAmount," so'm",Ne<0&&e.jsx("span",{className:"block text-danger-600 font-bold mt-1",children:"âš ï¸ Jami summadan ko'p!"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-surface-700 mb-2",children:[e.jsx(Xs,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"Qaytarish muddati *"]}),e.jsx("input",{type:"date",value:O.dueDate,onChange:C=>ke(Y=>j(g({},Y),{dueDate:C.target.value})),className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"})]})]})]}),V&&e.jsxs("div",{className:"fixed inset-0 z-60 flex items-center justify-center p-2 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>K(!1)}),e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-4xl shadow-2xl relative z-10 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-3 sm:p-4 border-b border-surface-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h5",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Mahsulot tanlash"}),e.jsx("button",{onClick:()=>K(!1),className:"text-surface-400 hover:text-surface-600",children:e.jsx(fe,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(gs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mahsulot nomi yoki kodi bilan qidiring...",value:i,onChange:C=>T(C.target.value),className:"w-full pl-10 pr-4 py-2 sm:py-3 text-xs sm:text-sm bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",autoFocus:!0})]}),i&&e.jsxs("div",{className:"mt-2 text-xs text-surface-500",children:['"',i,`" bo'yicha `,ce.length," ta natija topildi"]})]}),e.jsx("div",{className:"max-h-80 sm:max-h-96 overflow-y-auto p-3 sm:p-4",children:ce.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center text-surface-500",children:[e.jsx(Ie,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium mb-1 text-sm",children:i?"Mahsulot topilmadi":"Qidirish uchun mahsulot nomini yoki kodini kiriting"}),i&&e.jsxs("p",{className:"text-xs",children:['"',i,`" bo'yicha hech narsa topilmadi`]})]}):e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[ce.slice(0,100).map(C=>e.jsxs("button",{onClick:()=>Fe(C),className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 hover:bg-surface-50 transition-colors text-left border border-surface-200 rounded-lg group",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-lg flex items-center justify-center group-hover:bg-brand-200 transition-colors flex-shrink-0",children:e.jsx(Ie,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate text-xs sm:text-sm",children:C.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-surface-500 bg-surface-100 px-2 py-1 rounded",children:["Kod: ",C.code]}),e.jsxs("span",{className:"text-xs text-surface-500",children:["Omborda: ",C.quantity," ta"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-brand-600 text-sm sm:text-base",children:[w(C.price)," so'm"]}),e.jsx("p",{className:"text-xs text-surface-500",children:"Narxi"})]})]},C._id)),ce.length>100&&e.jsx("div",{className:"p-3 text-center text-surface-500 text-xs border-t border-surface-200",children:"Faqat birinchi 100 ta natija ko'rsatildi. Aniqroq qidiring."})]})}),e.jsx("div",{className:"p-3 sm:p-4 border-t border-surface-200 bg-surface-50",children:e.jsx("div",{className:"flex items-center gap-2 text-xs text-surface-500",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(gs,{className:"w-3 h-3"}),e.jsx("span",{children:"Maslahat: Mahsulot nomini yoki kodini to'liq kiriting"})]})})})]})]})]}):e.jsxs("div",{className:"flex-1 p-3 sm:p-4 lg:p-6 overflow-y-auto min-h-0",children:[e.jsx("div",{className:"relative mb-3 sm:mb-4 lg:mb-6",children:e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(gs,{className:"w-4 h-4 sm:w-5 sm:h-5 text-surface-400"})}),e.jsx("input",{type:"text",placeholder:"Mijoz ismi yoki telefon raqami bilan qidiring...",value:N,onChange:C=>D(C.target.value),className:"w-full pl-9 sm:pl-10 pr-4 py-2 sm:py-3 text-sm bg-white border-2 border-surface-200 rounded-xl focus:outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 transition-all"}),N&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("button",{onClick:()=>D(""),className:"w-5 h-5 flex items-center justify-center text-surface-400 hover:text-surface-600 rounded-full hover:bg-surface-100",children:e.jsx(fe,{className:"w-3 h-3"})})})]}),e.jsxs("button",{onClick:()=>de(!0),className:"flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-3 bg-success-500 text-white rounded-xl hover:bg-success-600 transition-colors flex-shrink-0",title:"Yangi mijoz qo'shish",children:[e.jsx(ds,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi mijoz"})]})]})}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:x.length===0?e.jsxs("div",{className:"p-6 sm:p-8 lg:p-12 text-center text-surface-500",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-surface-100 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4",children:e.jsx(gs,{className:"w-6 h-6 sm:w-8 sm:h-8 text-surface-400"})}),e.jsx("p",{className:"font-medium text-sm sm:text-base lg:text-lg mb-2",children:N?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"}),e.jsx("p",{className:"text-xs sm:text-sm",children:N?`"${N}" bo'yicha hech kim topilmadi`:"Hozircha mijozlar qo'shilmagan"})]}):x.map(C=>{const Y=u.find(re=>{var ge;return((ge=re.customer)==null?void 0:ge._id)===C._id&&re.status==="pending_approval"});return e.jsx("button",{onClick:()=>Qe(C),className:"w-full p-3 sm:p-4 hover:bg-gradient-to-r hover:from-brand-50 hover:to-blue-50 transition-all duration-200 text-left border-2 border-surface-200 hover:border-brand-300 rounded-xl group",children:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center shadow-lg group-hover:shadow-xl transition-shadow flex-shrink-0",children:e.jsx("span",{className:"text-sm sm:text-base lg:text-lg font-bold text-white",children:C.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-surface-900 text-sm sm:text-base lg:text-lg truncate",children:C.name}),Y&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-warning-100 text-warning-700 flex-shrink-0",children:"Qarz mavjud"})]}),e.jsxs("p",{className:"text-surface-600 flex items-center gap-1 text-xs sm:text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{className:"truncate",children:C.phone})]}),Y&&e.jsxs("p",{className:"text-xs text-warning-600 font-medium mt-1",children:["Mavjud qarz: ",w(Y.amount-Y.paidAmount)," so'm"]}),C.email&&e.jsxs("p",{className:"text-xs text-surface-500 flex items-center gap-1 mt-1",children:[e.jsx("svg",{className:"w-3 h-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("span",{className:"truncate",children:C.email})]})]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-brand-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})},C._id)})})]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row items-center justify-between gap-3 p-3 sm:p-4 lg:p-6 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-surface-600 order-2 sm:order-1",children:M&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-success-500 rounded-full"}),e.jsxs("span",{children:["Mijoz tanlandi: ",M.name]})]})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto order-1 sm:order-2",children:[M&&e.jsxs("button",{onClick:()=>q(null),className:"flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors text-xs sm:text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Orqaga"]}),e.jsx("button",{onClick:()=>Ge(),className:"px-3 sm:px-4 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors text-xs sm:text-sm",children:"Bekor qilish"}),M&&e.jsxs("button",{onClick:Ze,disabled:v.length===0||!O.dueDate,className:"flex items-center gap-1 sm:gap-2 px-4 sm:px-6 py-2 bg-gradient-to-r from-brand-500 to-brand-600 text-white rounded-lg hover:from-brand-600 hover:to-brand-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-xs sm:text-sm flex-1 sm:flex-none justify-center",children:[e.jsx(is,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Qarz qo'shish",$e>0&&e.jsxs("span",{className:"ml-2 px-2 py-1 bg-white/20 rounded text-xs hidden sm:inline",children:[w(Ne)," so'm"]})]})]})]})]})]}),ee&&L&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:ze}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl shadow-2xl relative z-10 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-surface-200 bg-gradient-to-r from-brand-50 to-blue-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(Qs,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-surface-900",children:"Qarz ma'lumotlari"}),e.jsxs("p",{className:"text-sm text-surface-600",children:["#",L._id.slice(-6)]})]})]}),e.jsx("button",{onClick:ze,className:"w-10 h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-3",children:"Mijoz ma'lumotlari"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600 text-lg",children:(B=L.customer)==null?void 0:B.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-surface-900",children:(c=L.customer)==null?void 0:c.name}),e.jsx("p",{className:"text-surface-600",children:(H=L.customer)==null?void 0:H.phone}),((he=L.customer)==null?void 0:he.email)&&e.jsx("p",{className:"text-sm text-surface-500",children:(we=L.customer)==null?void 0:we.email})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Qarz summasi"}),e.jsxs("p",{className:"text-2xl font-bold text-surface-900",children:[w(L.amount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"To'langan"}),e.jsxs("p",{className:"text-2xl font-bold text-success-600",children:[w(L.paidAmount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Qoldiq"}),e.jsxs("p",{className:"text-2xl font-bold text-danger-600",children:[w(L.amount-L.paidAmount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Muddat"}),e.jsx("p",{className:"text-lg font-semibold text-surface-900",children:new Date(L.dueDate).toLocaleDateString()})]})]}),L.description&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-2",children:"Izoh"}),e.jsx("p",{className:"text-surface-700",children:L.description})]}),L.items&&L.items.length>0&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-3",children:"Mahsulotlar"}),e.jsx("div",{className:"space-y-2",children:L.items.map((C,Y)=>{var re;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-surface-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(Ie,{className:"w-4 h-4 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:((re=C.product)==null?void 0:re.name)||"Mahsulot"}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Miqdor: ",C.quantity]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[w(C.price*C.quantity)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:[w(C.price)," Ã— ",C.quantity]})]})]},Y)})})]}),e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Yaratilgan"}),e.jsx("p",{className:"font-semibold text-surface-900",children:new Date(L.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:"flex justify-end gap-3 p-6 border-t border-surface-200 bg-surface-50/50",children:e.jsx("button",{onClick:ze,className:"px-6 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Yopish"})})]})]}),X&&L&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:ne}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-surface-200 bg-gradient-to-r from-danger-50 to-red-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-danger-500 to-danger-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(Ps,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-surface-900",children:"Qarzni o'chirish"}),e.jsx("p",{className:"text-sm text-surface-600",children:"Bu amalni bekor qilib bo'lmaydi"})]})]}),e.jsx("button",{onClick:ne,className:"w-10 h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-danger-50 p-4 rounded-xl border border-danger-200 mb-4",children:[e.jsx("p",{className:"text-danger-800 font-medium mb-2",children:"Diqqat!"}),e.jsxs("p",{className:"text-danger-700 text-sm",children:["Siz ",e.jsx("strong",{children:(ye=L.customer)==null?void 0:ye.name})," mijozining ",e.jsxs("strong",{children:[w(L.amount)," so'm"]})," qarzini o'chirmoqchisiz. Bu amal bekor qilinmaydi va barcha ma'lumotlar yo'qoladi."]}),L.status==="approved"&&e.jsxs("p",{className:"text-danger-600 text-xs mt-2",children:[e.jsx("strong",{children:"Eslatma:"})," Bu tasdiqlangan qarz. O'chirilganda mijozning umumiy qarzidan ham ayriladi."]})]}),e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Qarz summasi:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[w(L.amount)," so'm"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-surface-600",children:"Qoldiq:"}),e.jsxs("span",{className:"font-semibold text-danger-600",children:[w(L.amount-L.paidAmount)," so'm"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("button",{onClick:ne,className:"px-6 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:Ce,className:"px-6 py-2 bg-gradient-to-r from-danger-500 to-danger-600 text-white rounded-lg hover:from-danger-600 hover:to-danger-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:"O'chirish"})]})]})]}),I&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:be}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-200 bg-gradient-to-r from-success-50 to-green-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-success-500 to-success-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(ds,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-surface-900",children:"Yangi mijoz"}),e.jsx("p",{className:"text-xs text-surface-600",children:"Mijoz ma'lumotlari"})]})]}),e.jsx("button",{onClick:be,className:"w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(fe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Ism *"}),e.jsx("input",{type:"text",value:ue.name,onChange:C=>F(Y=>j(g({},Y),{name:C.target.value})),className:"w-full px-3 py-2 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20",placeholder:"Mijoz ismi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Telefon *"}),e.jsx("input",{type:"tel",value:ue.phone,onChange:C=>F(Y=>j(g({},Y),{phone:C.target.value})),className:"w-full px-3 py-2 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20",placeholder:"+998 (XX) XXX-XX-XX"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Viloyat"}),e.jsx("textarea",{value:ue.address,onChange:C=>F(Y=>j(g({},Y),{address:C.target.value})),className:"w-full px-3 py-2 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20 resize-none",rows:2,placeholder:"Viloyatni tanlang"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("button",{onClick:be,className:"px-4 py-2 text-xs font-medium text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:S,disabled:!ue.name.trim()||!ue.phone.trim(),className:"px-4 py-2 text-xs font-medium bg-gradient-to-r from-success-500 to-success-600 text-white rounded-lg hover:from-success-600 hover:to-success-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:"Saqlash"})]})]})]})]})}function gl(){const{showAlert:a,AlertComponent:n}=Ns(),r=at(),[u,l]=t.useState([]),[h,k]=t.useState(null),[p,z]=t.useState([]),[$,b]=t.useState([]),[f,y]=t.useState(20),[N,D]=t.useState(""),[i,T]=t.useState("all"),[M,q]=t.useState(!1),[v,Q]=t.useState(!1),[V,K]=t.useState(!1),[le,oe]=t.useState(!1),[O,ke]=t.useState(!1),[ee,ve]=t.useState(null),[X,Z]=t.useState(null),[L,xe]=t.useState(!1),[I,de]=t.useState({code:"",name:"",quantity:"",previousPrice:"",currentPrice:"",unit:"dona",conversionEnabled:!1,baseUnit:"dona",conversionRate:"",packageCount:"",pricePerMeter:"",pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),[ue,F]=t.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[S,be]=t.useState([]),[W,Se]=t.useState(""),[Be,We]=t.useState(!1),[Qe,Ge]=t.useState(null),[Fe,Ve]=t.useState(!1),[m,te]=t.useState(!1),[Ce,ze]=t.useState("add"),[ne,Ze]=t.useState(""),[x,ce]=t.useState({printer:"",copies:1,size:"card",layout:"standard",customWidth:"",customHeight:""}),[$e,Ee]=t.useState([]),[Ne,De]=t.useState(!1),[B,c]=t.useState(null),H=t.useRef(null),he=t.useRef(null);t.useEffect(()=>{we()},[]),t.useEffect(()=>{h&&ye()},[h]),t.useEffect(()=>{b(p.slice(0,f))},[p,f]),t.useEffect(()=>{const o=he.current;if(!o)return;const J=()=>{const{scrollTop:me,scrollHeight:Me,clientHeight:Ke}=o;Me-me<=Ke*1.5&&f<p.length&&y(Ae=>Math.min(Ae+20,p.length))};return o.addEventListener("scroll",J),()=>o.removeEventListener("scroll",J)},[f,p.length]),t.useEffect(()=>{h&&ye()},[r.pathname]),t.useEffect(()=>{const o=J=>{J.key==="Escape"&&Be&&We(!1)};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[Be]),t.useEffect(()=>{let o=u;N.trim()!==""&&(o=o.filter(J=>J.name.toLowerCase().includes(N.toLowerCase())||J.code.toLowerCase().includes(N.toLowerCase()))),i!=="all"&&(i==="low"?o=o.filter(J=>J.quantity<=(J.minStock||50)&&J.quantity>0):i==="out"&&(o=o.filter(J=>J.quantity===0))),z(o),y(20)},[u,N,i]);const we=()=>E(this,null,function*(){try{const J=(yield _.get("/warehouses")).data.find(me=>me.name==="Asosiy ombor");if(J)k(J);else{const me=yield _.post("/warehouses",{name:"Asosiy ombor",address:""});k(me.data)}}catch(o){console.error("Error fetching warehouses:",o),q(!1)}}),ye=()=>E(this,null,function*(){try{q(!0);const o=yield _.get("/products?mainOnly=true&limit=10000"),J=o.data.data||o.data;l(Array.isArray(J)?J:[])}catch(o){console.error("Error fetching products:",o),a("Tovarlarni yuklashda xatolik yuz berdi","Xatolik","danger")}finally{q(!1)}}),C=o=>new Promise((J,me)=>{const Me=new FileReader;Me.readAsDataURL(o),Me.onload=Ke=>{var Le;const Ae=document.createElement("img");Ae.src=(Le=Ke.target)==null?void 0:Le.result,Ae.onload=()=>{const os=document.createElement("canvas");let ys=Ae.width,xs=Ae.height;if(ys>1920||xs>1920){const Ss=Math.min(1920/ys,1920/xs);ys=Math.round(ys*Ss),xs=Math.round(xs*Ss)}os.width=ys,os.height=xs;const ks=os.getContext("2d");if(!ks){me(new Error("Canvas context not available"));return}ks.drawImage(Ae,0,0,ys,xs),os.toBlob(Ss=>{Ss?J(Ss):me(new Error("Canvas to blob failed"))},"image/jpeg",.8)},Ae.onerror=()=>me(new Error("Image load failed"))},Me.onerror=()=>me(new Error("File read failed"))}),Y=(o,J)=>E(this,null,function*(){var ks,Ss;const me=J.target.files;if(!me||me.length===0)return;const Me=u.find(js=>js._id===o);if(!Me)return;const Ke=Me.images||[],Ae=8-Ke.length;if(Ae<=0){a("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const Le=["image/jpeg","image/jpg","image/png","image/webp"],os=Array.from(me).filter(js=>Le.includes(js.type)?!0:(a(`${js.name} - noto'g'ri format. Faqat JPG, PNG, WebP qabul qilinadi`,"Xatolik","warning"),!1));if(os.length===0)return;const ys=os.slice(0,Ae),xs=new FormData;xe(!0),c(o);try{for(const vs of ys)try{const Cs=yield C(vs);xs.append("images",Cs,vs.name)}catch(Cs){console.warn(`Image compression failed for ${vs.name}, uploading original:`,Cs),xs.append("images",vs)}const js=yield _.post("/products/upload-images",xs,{headers:{"Content-Type":"multipart/form-data"}}),ns=[...Ke,...js.data.images],fs=yield _.put(`/products/${o}/images`,{images:ns});l(vs=>vs.map(Cs=>Cs._id===o?j(g({},Cs),{images:ns}):Cs)),a(`${js.data.images.length} ta rasm muvaffaqiyatli yuklandi!`,"Muvaffaqiyat","success")}catch(js){console.error("Error uploading images:",js);const ns=((Ss=(ks=js.response)==null?void 0:ks.data)==null?void 0:Ss.message)||"Rasmlarni yuklashda xatolik";a(ns,"Xatolik","danger")}finally{xe(!1),c(null),H.current&&(H.current.value="")}}),re=()=>E(this,null,function*(){Q(!0);try{yield ye(),a("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(o){console.error("Refresh xatosi:",o),a("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{Q(!1)}}),ge=o=>E(this,null,function*(){const J=o.target.files;if(!J||J.length===0)return;const me=8-S.length;if(me<=0){a("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const Me=Array.from(J).slice(0,me),Ke=new FormData;Me.forEach(Ae=>Ke.append("images",Ae)),xe(!0);try{const Ae=yield _.post("/products/upload-images",Ke,{headers:{"Content-Type":"multipart/form-data"}});be([...S,...Ae.data.images])}catch(Ae){console.error("Error uploading images:",Ae),a("Rasmlarni yuklashda xatolik","Xatolik","danger")}finally{xe(!1),H.current&&(H.current.value="")}}),ss=o=>E(this,null,function*(){try{yield _.delete("/products/delete-image",{data:{imagePath:o}}),be(S.filter(J=>J!==o))}catch(J){console.error("Error deleting image:",J)}}),ps=o=>E(this,null,function*(){var Ke,Ae;if(o.preventDefault(),W){a(W,"Xatolik","danger");return}let J=Number(I.quantity),me=null;if(Fe&&ue.packageCount&&ue.unitsPerPackage){const Le=Number(ue.packageCount)*Number(ue.unitsPerPackage);J=X?Number(I.quantity)+Le:Le,me={packageCount:Number(ue.packageCount),unitsPerPackage:Number(ue.unitsPerPackage),totalUnits:Le}}let Me=J;I.conversionEnabled&&I.conversionRate&&(Me=J*Number(I.conversionRate));try{const Le={code:I.code,name:I.name,price:Number(I.currentPrice),previousPrice:Number(I.previousPrice)||0,currentPrice:Number(I.currentPrice)||0,quantity:J,warehouse:h==null?void 0:h._id,images:S,packageInfo:me,unit:I.unit,unitConversion:{enabled:I.conversionEnabled,baseUnit:I.baseUnit,conversionRate:Number(I.conversionRate)||1,packageCount:J,totalBaseUnits:Me},prices:{perUnit:Number(I.currentPrice),perMeter:Number(I.pricePerMeter)||0,perRoll:Number(I.pricePerRoll)||0,perBox:Number(I.pricePerBox)||0,perKg:Number(I.pricePerKg)||0,perGram:Number(I.pricePerGram)||0}};X?yield _.put(`/products/${X._id}`,Le):yield _.post("/products",Le),ye(),_e()}catch(Le){a(((Ae=(Ke=Le.response)==null?void 0:Ke.data)==null?void 0:Ae.message)||"Xatolik yuz berdi","Xatolik","danger")}}),_e=()=>{K(!1),Z(null),de({code:"",name:"",quantity:"",previousPrice:"",currentPrice:"",unit:"dona",conversionEnabled:!1,baseUnit:"dona",conversionRate:"",packageCount:"",pricePerMeter:"",pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),F({packageCount:"",unitsPerPackage:"",totalCost:""}),be([]),Se(""),Ve(!1)},ms=o=>{ze(o),Ze(""),te(!0)},Ls=()=>{const o=Number(ne)||0;if(o<=0)return;const J=Number(I.quantity)||0;let me=Ce==="add"?J+o:J-o;me<0&&(me=0),de(j(g({},I),{quantity:String(me)})),te(!1),Ze("")},Ks=o=>E(this,null,function*(){if(o)try{const J=(X==null?void 0:X._id)||"";(yield _.get(`/products/check-code/${o}${J?`?excludeId=${J}`:""}`)).data.exists?Se(`Kod "${o}" allaqachon mavjud`):Se("")}catch(J){console.error("Error checking code:",J)}}),R=()=>{if(!ee)return;const o=document.getElementById("qr-code-svg");if(!o)return;const J=new XMLSerializer().serializeToString(o),me=document.createElement("canvas"),Me=me.getContext("2d"),Ke=document.createElement("img");Ke.onload=()=>{me.width=Ke.width,me.height=Ke.height,Me==null||Me.drawImage(Ke,0,0);const Ae=me.toDataURL("image/png"),Le=document.createElement("a");Le.download=`QR-${ee.code}-${ee.name}.png`,Le.href=Ae,Le.click()},Ke.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(J)))},ae=(o,J)=>E(this,null,function*(){try{const me=JSON.stringify({id:o._id,code:o.code,name:o.name,price:o.price});return yield Ft(me,{width:J*10,margin:1,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"H",type:"image/png"})}catch(me){return console.error("Error generating QR code:",me),""}}),je=()=>E(this,null,function*(){if(ee)try{const o=x.customWidth&&x.customHeight,J=o?`${x.customWidth}mm`:null,me=o?`${x.customHeight}mm`:null,Me=x.size==="card"?65:x.size==="thermal"?125:145,Ke=yield ae(ee,Me),Ae=`
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="utf-8">
          <title>Label - ${ee.name}</title>
          <style>
            @page {
              size: ${o?`${J} ${me}`:x.size==="card"?"28mm 18mm":x.size==="A4"?"A4":x.size==="A5"?"A5":"50mm 70mm"};
              margin: 0;
            }
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            html, body {
              width: 100%;
              height: 100%;
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              background: white;
              overflow: hidden;
            }
            .page-container {
              width: 100%;
              height: 100vh;
              display: flex;
              justify-content: center;
              align-items: center;
              page-break-after: avoid;
            }
            .label-container {
              border: 2px solid #333;
              padding: ${x.size==="card"?"1mm":x.size==="thermal"?"6px":"12px"};
              background: white;
              width: ${o?J:x.size==="card"?"26mm":x.size==="thermal"?"44mm":x.size==="A4"?"80mm":(x.size==="A5","120mm")};
              height: ${o?me:x.size==="card"?"16mm":x.size==="thermal"?"60mm":x.size==="A4"?"100mm":(x.size==="A5","140mm")};
              display: flex;
              flex-direction: column;
              justify-content: space-between;
              gap: 2px;
              overflow: hidden;
              border-radius: 2px;
              page-break-inside: avoid;
            }
            .product-info {
              flex: 1;
              width: 100%;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              text-align: center;
              height: auto;
            }
            .product-name {
              font-size: ${x.size==="card"?"8px":x.size==="thermal"?"16px":"20px"};
              font-weight: 600;
              color: #1a1a1a;
              line-height: 1.1;
              margin-bottom: ${x.size==="card"?"1px":"2px"};
              word-wrap: break-word;
              overflow: hidden;
              text-overflow: ellipsis;
              display: -webkit-box;
              -webkit-line-clamp: ${x.size==="card"?"1":"2"};
              -webkit-box-orient: vertical;
            }
            .product-code {
              font-size: ${x.size==="card"?"7px":x.size==="thermal"?"14px":"18px"};
              color: #666;
              line-height: 1.0;
              margin-bottom: ${x.size==="card"?"1px":"2px"};
              font-weight: 500;
            }
            .product-price {
              font-size: ${x.size==="card"?"12px":x.size==="thermal"?"20px":"24px"};
              font-weight: 800;
              color: #d32f2f;
              line-height: 1.0;
              margin-bottom: ${x.size==="card"?"0px":"1px"};
            }
            .qr-code-section {
              flex-shrink: 0;
              display: flex;
              align-items: center;
              justify-content: center;
              width: 100%;
              height: auto;
              padding: 2px 0;
              overflow: hidden;
              box-sizing: border-box;
            }
            .qr-code-img {
              width: ${x.size==="card"?"60px":x.size==="thermal"?"120px":"140px"};
              height: ${x.size==="card"?"60px":x.size==="thermal"?"120px":"140px"};
              max-width: 95%;
              max-height: 95%;
              border: 1px solid #e0e0e0;
              border-radius: 2px;
              background: white;
              object-fit: contain;
              image-rendering: -webkit-optimize-contrast;
              image-rendering: crisp-edges;
              image-rendering: pixelated;
            }
            .additional-info {
              margin: 0;
              font-size: ${x.size==="card"?"4px":x.size==="thermal"?"10px":"12px"};
              color: #888;
              line-height: 1.0;
              font-weight: 400;
            }
            ${x.layout==="minimal"?".additional-info { display: none; }":""}
            
            @media print {
              html, body {
                background: white !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                margin: 0 !important;
                padding: 0 !important;
              }
              .page-container {
                height: 100vh !important;
                page-break-after: avoid !important;
              }
              .label-container {
                page-break-inside: avoid !important;
                width: ${o?J:x.size==="card"?"28mm":x.size==="thermal"?"48mm":x.size==="A4"?"85mm":(x.size==="A5","130mm")} !important;
                height: ${o?me:x.size==="card"?"18mm":x.size==="thermal"?"65mm":x.size==="A4"?"105mm":(x.size==="A5","145mm")} !important;
                padding: ${x.size==="card"?"1.5mm":x.size==="thermal"?"8px":"15px"} !important;
                flex-direction: column !important;
                justify-content: space-between !important;
              }
              .qr-code-section {
                width: 100% !important;
                height: auto !important;
                overflow: hidden !important;
                box-sizing: border-box !important;
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
              }
              .qr-code-img {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                width: ${x.size==="card"?"65px":x.size==="thermal"?"125px":"145px"} !important;
                height: ${x.size==="card"?"65px":x.size==="thermal"?"125px":"145px"} !important;
                max-width: 95% !important;
                max-height: 95% !important;
                object-fit: contain !important;
              }
            }
          </style>
        </head>
        <body>
          <div class="page-container">
            <div class="label-container">
              <div class="product-info">
                <div class="product-price">${w(ee.currentPrice||ee.price)} so'm</div>
                <div class="product-code">Kod: ${ee.code}</div>
                <div class="product-name">${ee.name}</div>
                
                ${x.layout==="standard"?`
                  <div class="additional-info">
                    Miqdor: ${ee.quantity} | ${new Date().toLocaleDateString("uz-UZ")}
                  </div>
                `:""}
              </div>
              
              <div class="qr-code-section">
                <img src="${Ke}" alt="QR Code" class="qr-code-img" />
              </div>
            </div>
          </div>
        </body>
        </html>
      `,Le=window.open("","_blank","width=1024,height=768");if(!Le){alert("Popup blocker tomonidan to'sib qo'yildi. Popup'larni yoqing.");return}Le.document.open(),Le.document.write(Ae),Le.document.close(),Le.onload=()=>{setTimeout(()=>{Le.focus(),Le.print(),setTimeout(()=>{Le.close()},1e3)},500)},ke(!1)}catch(o){console.error("Error generating print content:",o),alert("Chop uchun tayyorlashda xatolik yuz berdi")}}),Te={total:u.length,lowStock:u.filter(o=>o.quantity<=(o.minStock||50)&&o.quantity>0).length,outOfStock:u.filter(o=>o.quantity===0).length,totalValue:u.reduce((o,J)=>o+J.price*J.quantity,0)},Je=o=>{if(o.images&&o.images.length>0){const J=typeof o.images[0]=="string"?o.images[0]:o.images[0].path;return`${Bs}${J}`}return null},Oe=[{label:"Jami tovarlar",value:Te.total,icon:Ie,color:"brand",filter:"all"},{label:"Kam qolgan",value:Te.lowStock,icon:Ms,color:"warning",filter:"low"},{label:"Tugagan",value:Te.outOfStock,icon:fe,color:"danger",filter:"out"},{label:"Jami qiymat",value:`${w(Te.totalValue)} so'm`,icon:is,color:"success",filter:null}];return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[n,e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-brand-600"}),e.jsx("h2",{className:"text-lg font-semibold text-surface-900",children:"Tovarlar (Asosiy ombor)"})]}),e.jsx("div",{className:"flex items-center gap-2 sm:gap-3",children:e.jsxs("button",{onClick:re,disabled:v,className:"flex items-center justify-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50",title:"Tovarlar ro'yxatini yangilash (F5)",children:[e.jsx(Os,{className:`w-4 h-4 ${v?"animate-spin":""}`}),e.jsx("span",{className:"sm:inline",children:v?"Yangilanmoqda...":"Yangilash"})]})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-2 sm:gap-2.5 md:gap-3",children:Oe.map((o,J)=>e.jsx("div",{onClick:()=>o.filter&&T(o.filter),className:`bg-white rounded-lg sm:rounded-xl border-2 transition-all ${o.filter?"cursor-pointer hover:shadow-lg hover:scale-[1.02]":""} ${i===o.filter?"border-brand-500 shadow-md":"border-surface-200"}`,children:e.jsxs("div",{className:"p-2 sm:p-2.5 md:p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-1.5 sm:mb-2",children:[e.jsx("div",{className:`w-7 h-7 sm:w-8 sm:h-8 md:w-9 md:h-9 rounded-lg flex items-center justify-center bg-${o.color}-50`,children:e.jsx(o.icon,{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-4.5 md:h-4.5 text-${o.color}-600`})}),e.jsx("p",{className:"text-[10px] sm:text-xs text-surface-500 font-medium",children:o.label})]}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-surface-900",children:o.value})]})},J))}),e.jsxs("div",{className:"relative",children:[e.jsx(gs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Tovar nomi yoki kodi bo'yicha qidirish...",value:N,onChange:o=>D(o.target.value),className:"w-full pl-10 pr-4 py-2 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-100"})]}),e.jsx("div",{className:"card p-0 overflow-hidden",children:M?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Ie,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Tovarlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:N?"Qidiruv bo'yicha tovarlar topilmadi":"Tovarlar mavjud emas"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden lg:block",children:[e.jsx("div",{className:"table-header",children:e.jsxs("div",{className:"grid grid-cols-14 gap-2 px-4 py-4",children:[e.jsx("span",{className:"table-header-cell col-span-1",children:"Rasm"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Kod"}),e.jsx("span",{className:"table-header-cell col-span-2",children:"Nomi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Tan narxi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Dona narxi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Karobka"}),e.jsx("span",{className:"table-header-cell col-span-3",children:"Chegirmalar"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Oldingi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Hozirgi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Miqdori"})]})}),e.jsx("div",{className:"max-h-[calc(100vh-400px)] overflow-y-auto divide-y divide-surface-100",children:p.map(o=>{var J,me,Me,Ke,Ae,Le,os,ys,xs,ks,Ss,js;return e.jsxs("div",{className:"grid grid-cols-14 gap-2 px-4 py-3 items-center hover:bg-surface-50 transition-colors relative",children:[e.jsx("div",{className:"col-span-1",children:Je(o)?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:Je(o),alt:o.name,className:"w-10 h-10 rounded-lg object-cover cursor-pointer hover:scale-110 transition-transform",onClick:()=>{Ge(Je(o)),We(!0)}}),e.jsx("button",{onClick:ns=>{var fs;ns.stopPropagation(),c(o._id),(fs=H.current)==null||fs.click()},disabled:L&&B===o._id,className:"absolute -top-0.5 -right-0.5 flex items-center justify-center w-4 h-4 bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-full shadow-sm hover:shadow-md transition-all duration-200 hover:scale-110 disabled:opacity-50",title:"Rasm yuklash",children:L&&B===o._id?e.jsx("div",{className:"w-2 h-2 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(St,{className:"w-2 h-2 text-white"})})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-lg flex items-center justify-center",children:e.jsx(nr,{className:"w-5 h-5 text-surface-400"})}),e.jsx("button",{onClick:ns=>{var fs;ns.stopPropagation(),c(o._id),(fs=H.current)==null||fs.click()},disabled:L&&B===o._id,className:"absolute -top-0.5 -right-0.5 flex items-center justify-center w-4 h-4 bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-full shadow-sm hover:shadow-md transition-all duration-200 hover:scale-110 disabled:opacity-50",title:"Rasm yuklash",children:L&&B===o._id?e.jsx("div",{className:"w-2 h-2 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(St,{className:"w-2 h-2 text-white"})})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"font-mono text-xs bg-surface-100 px-1.5 py-0.5 rounded",children:o.code})}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"font-medium text-surface-900 text-sm truncate",children:o.name})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-surface-700 text-sm",children:w(o.costPrice||0)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-brand-600 text-sm",children:w(o.unitPrice||o.price)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-orange-600 text-sm",children:o.boxPrice>0?w(o.boxPrice):"-"})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[((me=(J=o.pricingTiers)==null?void 0:J.tier1)==null?void 0:me.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-emerald-50 text-emerald-700 rounded text-[10px] font-bold",children:[o.pricingTiers.tier1.minQuantity,"-",o.pricingTiers.tier1.maxQuantity,": ",o.pricingTiers.tier1.discountPercent,"%"]}),((Ke=(Me=o.pricingTiers)==null?void 0:Me.tier2)==null?void 0:Ke.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded text-[10px] font-bold",children:[o.pricingTiers.tier2.minQuantity,"-",o.pricingTiers.tier2.maxQuantity,": ",o.pricingTiers.tier2.discountPercent,"%"]}),((Le=(Ae=o.pricingTiers)==null?void 0:Ae.tier3)==null?void 0:Le.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-purple-50 text-purple-700 rounded text-[10px] font-bold",children:[o.pricingTiers.tier3.minQuantity,"+: ",o.pricingTiers.tier3.discountPercent,"%"]}),!((ys=(os=o.pricingTiers)==null?void 0:os.tier1)!=null&&ys.discountPercent)&&!((ks=(xs=o.pricingTiers)==null?void 0:xs.tier2)!=null&&ks.discountPercent)&&!((js=(Ss=o.pricingTiers)==null?void 0:Ss.tier3)!=null&&js.discountPercent)&&e.jsx("span",{className:"text-surface-400 text-xs",children:"-"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:`font-semibold text-sm ${(()=>{const ns=o.previousPrice||0,fs=o.currentPrice||o.price;return ns>0&&fs>0&&ns!==fs?"line-through text-red-500":"text-surface-900"})()}`,children:w(o.previousPrice||0)})}),e.jsxs("div",{className:"col-span-1 relative",children:[(()=>{const ns=o.previousPrice||0,fs=o.currentPrice||o.price;if(ns>0&&fs>0&&ns!==fs){const vs=Math.round((ns-fs)/ns*100);if(vs>0)return e.jsxs("div",{className:"absolute -top-2 -right-1 px-1 py-0.5 bg-red-500 text-white rounded text-[9px] font-bold",children:["-",vs,"%"]});if(vs<0)return e.jsxs("div",{className:"absolute -top-2 -right-1 px-1 py-0.5 bg-green-500 text-white rounded text-[9px] font-bold",children:["+",Math.abs(vs),"%"]})}return null})(),e.jsx("p",{className:"font-semibold text-surface-900 text-sm",children:w(o.currentPrice||o.price)})]}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`font-semibold text-sm ${o.quantity===0?"text-danger-600":o.quantity<=(o.minStock||100)?"text-warning-600":"text-success-600"}`,children:o.quantity})})]},o._id)})})]}),e.jsxs("div",{className:"lg:hidden",children:[e.jsxs("div",{ref:he,className:"max-h-[calc(100vh-300px)] overflow-y-auto p-3 sm:p-4",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-2 sm:gap-3",children:$.map(o=>e.jsx("div",{className:"group bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 hover:border-brand-300 hover:shadow-lg transition-all p-2 sm:p-4 relative",children:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"w-full aspect-square bg-gradient-to-br from-brand-100 to-brand-50 rounded-xl border-2 border-brand-200 flex items-center justify-center mb-2 sm:mb-3 group-hover:scale-105 transition-transform overflow-hidden cursor-pointer relative",onClick:()=>{if(o.images&&o.images.length>0){const J=typeof o.images[0]=="string"?o.images[0]:o.images[0].path;Ge(`${Bs}${J}`),We(!0)}},children:o.images&&o.images.length>0?e.jsx(e.Fragment,{children:e.jsx("img",{src:`${Bs}${typeof o.images[0]=="string"?o.images[0]:o.images[0].path}`,alt:o.name,className:"w-full h-full object-cover",onError:J=>{J.currentTarget.style.display="none",J.currentTarget.parentElement.innerHTML='<svg class="w-6 h-6 sm:w-8 sm:h-8 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>'}})}):e.jsx(Ie,{className:"w-6 h-6 sm:w-8 sm:h-8 text-brand-600"})}),e.jsx("p",{className:"font-semibold text-slate-900 text-[10px] sm:text-sm truncate",children:o.name}),e.jsxs("div",{className:"flex items-center gap-1.5 mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[9px] sm:text-xs text-slate-500",children:o.code}),e.jsx("button",{onClick:J=>{var me;J.stopPropagation(),c(o._id),(me=H.current)==null||me.click()},disabled:L&&B===o._id,className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex items-center justify-center bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-full shadow-sm hover:shadow-md transition-all duration-200 hover:scale-110 disabled:opacity-50",title:"Rasm yuklash",children:L&&B===o._id?e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(St,{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 text-white"})})]}),e.jsxs("p",{className:"font-bold text-brand-600 text-[10px] sm:text-sm",children:[w(o.price)," so'm"]}),e.jsxs("p",{className:"text-[9px] sm:text-xs text-slate-500 mt-1",children:["Mavjud: ",o.quantity," ta"]})]})},o._id))}),f<p.length&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"w-6 h-6 border-2 border-brand-500 border-t-transparent rounded-full animate-spin"})})]}),e.jsx("input",{ref:H,type:"file",accept:"image/*",multiple:!0,onChange:o=>{B&&Y(B,o)},className:"hidden"})]})]})})]}),V&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start sm:items-center justify-center p-2 pt-4 sm:p-4",children:[e.jsx("div",{className:"overlay",onClick:_e}),e.jsxs("div",{className:"modal w-full sm:max-w-lg p-4 sm:p-6 relative z-10 max-h-[calc(100vh-120px)] sm:max-h-[85vh] overflow-y-auto rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6 sticky top-0 bg-white pb-3 border-b border-surface-200 -mx-4 sm:-mx-6 px-4 sm:px-6 z-10",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-surface-900",children:X?"Tovarni tahrirlash":"Yangi tovar"}),e.jsx("button",{onClick:_e,className:"btn-icon-sm",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:ps,className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Rasmlar (max 8)"}),e.jsxs("div",{className:"grid grid-cols-4 gap-1.5 sm:gap-2 mb-2",children:[S.map((o,J)=>e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:`${Bs}${o}`,alt:"",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>ss(o),className:"absolute -top-1 -right-1 w-4 h-4 sm:w-5 sm:h-5 bg-danger-500 text-white rounded-full flex items-center justify-center",children:e.jsx(fe,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})})]},J)),S.length<8&&e.jsx("button",{type:"button",onClick:()=>{var o;return(o=H.current)==null?void 0:o.click()},disabled:L,className:"aspect-square border-2 border-dashed border-surface-300 rounded-lg flex flex-col items-center justify-center hover:border-brand-500 hover:bg-brand-50 transition-colors",children:L?e.jsx("div",{className:"spinner w-4 h-4 sm:w-5 sm:h-5 text-brand-600"}):e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-4 h-4 sm:w-5 sm:h-5 text-surface-400 mb-0.5 sm:mb-1"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-surface-500",children:"Yuklash"})]})})]}),e.jsx("input",{ref:H,type:"file",accept:"image/*",multiple:!0,onChange:ge,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input text-sm sm:text-base py-2 sm:py-2.5 ${W?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"1",value:I.code,onChange:o=>de(j(g({},I),{code:o.target.value})),onBlur:o=>Ks(o.target.value),required:!0}),W&&e.jsx("p",{className:"text-xs sm:text-sm text-danger-600 mt-1",children:W})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Miqdori"}),X?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"flex-1 px-2 sm:px-4 py-2 sm:py-3 bg-surface-100 rounded-xl text-center font-semibold text-surface-900 text-sm sm:text-base",children:w(I.quantity||0)}),e.jsx("button",{type:"button",onClick:()=>ms("add"),className:"btn-icon bg-success-100 text-success-600 hover:bg-success-200 w-8 h-8 sm:w-10 sm:h-10",children:e.jsx(ds,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{type:"button",onClick:()=>ms("subtract"),className:"btn-icon bg-danger-100 text-danger-600 hover:bg-danger-200 w-8 h-8 sm:w-10 sm:h-10",children:e.jsx(ht,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}):e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"0",value:rs(I.quantity),onChange:o=>de(j(g({},I),{quantity:Ye(o.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"Tovar nomi",value:I.name,onChange:o=>de(j(g({},I),{name:o.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Oldingi narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"0",value:rs(I.previousPrice),onChange:o=>de(j(g({},I),{previousPrice:Ye(o.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Hozirgi narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"0",value:rs(I.currentPrice),onChange:o=>de(j(g({},I),{currentPrice:Ye(o.target.value)})),required:!0}),I.previousPrice&&I.currentPrice&&Number(I.previousPrice)>0&&Number(I.currentPrice)>0&&e.jsx("div",{className:"mt-1.5 sm:mt-2",children:(()=>{const o=Number(I.previousPrice),J=Number(I.currentPrice),me=Math.round((o-J)/o*100);return me>0?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1.5 sm:py-2 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-green-500 rounded-full"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-green-700",children:[me,"% chegirma"]})]}):me<0?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1.5 sm:py-2 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-red-500 rounded-full"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-red-700",children:[Math.abs(me),"% qimmatroq"]})]}):null})()})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-3 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-brand-600"}),"O'lchov birligi"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Birlik"}),e.jsxs("select",{className:"input",value:I.unit,onChange:o=>de(j(g({},I),{unit:o.target.value})),children:[e.jsx("option",{value:"dona",children:"Dona"}),e.jsx("option",{value:"metr",children:"Metr"}),e.jsx("option",{value:"rulon",children:"Rulon"}),e.jsx("option",{value:"karobka",children:"Karobka/Quti"}),e.jsx("option",{value:"gram",children:"Gram"}),e.jsx("option",{value:"kg",children:"Kilogram"}),e.jsx("option",{value:"litr",children:"Litr"})]})]}),(I.unit==="rulon"||I.unit==="karobka")&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:["1 ",I.unit==="rulon"?"rulon":"karobka"," = ?"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"input flex-1",placeholder:"30",value:I.conversionRate,onChange:o=>de(j(g({},I),{conversionRate:Ye(o.target.value),conversionEnabled:!0}))}),e.jsxs("select",{className:"input w-24",value:I.baseUnit,onChange:o=>de(j(g({},I),{baseUnit:o.target.value})),children:[e.jsx("option",{value:"metr",children:"metr"}),e.jsx("option",{value:"dona",children:"dona"})]})]})]})]}),I.conversionEnabled&&I.conversionRate&&I.quantity&&e.jsx("div",{className:"mt-3 p-3 bg-purple-50 rounded-xl",children:e.jsxs("p",{className:"text-sm text-purple-700",children:[e.jsx("span",{className:"font-semibold",children:w(I.quantity)})," ",I.unit==="rulon"?"rulon":"karobka"," =",e.jsx("span",{className:"font-semibold ml-1",children:w(Number(I.quantity)*Number(I.conversionRate))})," ",I.baseUnit]})})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-3 flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4 text-green-600"}),"Qo'shimcha narxlar (ixtiyoriy)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Metr narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:rs(I.pricePerMeter),onChange:o=>de(j(g({},I),{pricePerMeter:Ye(o.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Rulon narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:rs(I.pricePerRoll),onChange:o=>de(j(g({},I),{pricePerRoll:Ye(o.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Karobka narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:rs(I.pricePerBox),onChange:o=>de(j(g({},I),{pricePerBox:Ye(o.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Kg narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:rs(I.pricePerKg),onChange:o=>de(j(g({},I),{pricePerKg:Ye(o.target.value)}))})]})]})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 pt-3 sm:pt-4 sticky bottom-0 bg-white pb-safe -mx-4 sm:-mx-6 px-4 sm:px-6 border-t border-surface-200 mt-4 z-10",children:[e.jsx("button",{type:"button",onClick:_e,className:"btn-secondary flex-1 text-sm sm:text-base py-2.5 sm:py-3",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1 text-sm sm:text-base py-2.5 sm:py-3",disabled:!!W,children:"Saqlash"})]})]})]})]}),le&&ee&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>oe(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"QR Kod"}),e.jsx("button",{onClick:()=>oe(!1),className:"btn-icon-sm",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border border-surface-200 mb-4",children:e.jsx(Dt,{id:"qr-code-svg",value:JSON.stringify({id:ee._id,code:ee.code,name:ee.name,price:ee.price}),size:200,level:"H",includeMargin:!0})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-semibold text-surface-900",children:ee.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",ee.code]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Oldingi narxi: ",w(ee.previousPrice||0)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Hozirgi narxi: ",w(ee.currentPrice||ee.price)," so'm"]})]}),e.jsxs("button",{onClick:R,className:"btn-primary w-full",children:[e.jsx(ca,{className:"w-4 h-4"}),"Yuklab olish"]})]})]})]}),O&&ee&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>ke(!1)}),e.jsxs("div",{className:"modal w-full max-w-4xl p-6 relative z-10 max-h-[92vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Print sozlamalari"}),e.jsx("button",{onClick:()=>ke(!1),className:"btn-icon-sm",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Printer tanlash"}),e.jsxs("select",{className:"input",value:x.printer,onChange:o=>ce(j(g({},x),{printer:o.target.value})),children:[e.jsx("option",{value:"",children:"Printer tanlang"}),$e.map(o=>e.jsx("option",{value:o,children:o},o))]}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Print tugmasini bosganda Windows print dialog ochiladi va barcha mavjud printerlarni ko'rsatadi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Qog'oz o'lchami"}),e.jsxs("select",{className:"input",value:x.size,onChange:o=>ce(j(g({},x),{size:o.target.value})),children:[e.jsx("option",{value:"card",children:"Kichik yorliq (50Ã—25mm)"}),e.jsx("option",{value:"A4",children:"A4 (210Ã—297mm)"}),e.jsx("option",{value:"A5",children:"A5 (148Ã—210mm)"}),e.jsx("option",{value:"thermal",children:"Thermal (80Ã—120mm)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Shablon"}),e.jsxs("select",{className:"input",value:x.layout,onChange:o=>ce(j(g({},x),{layout:o.target.value})),children:[e.jsx("option",{value:"standard",children:"Standart (barcha ma'lumotlar)"}),e.jsx("option",{value:"minimal",children:"Minimal (faqat asosiy ma'lumotlar)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Nusxalar soni"}),e.jsx("input",{type:"number",min:"1",max:"10",className:"input",value:x.copies,onChange:o=>ce(j(g({},x),{copies:parseInt(o.target.value)||1}))})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4",children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Maxsus o'lcham (ixtiyoriy)"}),e.jsx("p",{className:"text-xs text-surface-500 mb-3",children:"Agar maxsus o'lcham belgilasangiz, u qog'oz o'lchamidan ustun bo'ladi"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-600 mb-1 block",children:"Eni (mm)"}),e.jsx("input",{type:"number",min:"1",className:"input",placeholder:"Masalan: 50",value:x.customWidth,onChange:o=>ce(j(g({},x),{customWidth:o.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-600 mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"number",min:"1",className:"input",placeholder:"Masalan: 25",value:x.customHeight,onChange:o=>ce(j(g({},x),{customHeight:o.target.value}))})]})]})]})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-surface-700 mb-3",children:"Ko'rinish"}),e.jsx("div",{className:"bg-white shadow-md rounded-xl p-6 flex justify-center items-start min-h-[420px]",children:e.jsx("div",{className:"bg-white border border-gray-200 shadow-lg rounded-xl",style:{width:x.customWidth&&x.customHeight?`${x.customWidth}mm`:x.size==="card"?"26mm":x.size==="thermal"?"48mm":x.size==="A4"?"80mm":x.size==="A5"?"140mm":"120mm",height:x.customWidth&&x.customHeight?`${x.customHeight}mm`:x.size==="card"?"17mm":x.size==="thermal"?"65mm":x.size==="A4"?"105mm":x.size==="A5"?"145mm":"140mm",fontSize:x.size==="card"?"5px":x.size==="thermal"?"9px":"11px",transform:x.size==="card"?"scale(4.2)":x.size==="thermal"?"scale(2.1)":"scale(1.8)",transformOrigin:"center center",overflow:"hidden",padding:x.size==="card"?"1.2mm":x.size==="thermal"?"7px":"12px",borderRadius:"8px",background:"#ffffff",marginTop:"80px"},children:e.jsxs("div",{className:"flex flex-col justify-between h-full",style:{gap:x.size==="card"?"2px":"4px"},children:[e.jsxs("div",{className:"flex flex-col justify-center items-center text-center",style:{flex:1},children:[e.jsxs("div",{className:"font-bold",style:{fontSize:x.size==="card"?"10px":x.size==="thermal"?"18px":"22px",lineHeight:"1.0",marginBottom:x.size==="card"?"0px":"1px",fontWeight:"800",color:"#d32f2f"},children:[w(ee.currentPrice||ee.price)," so'm"]}),e.jsxs("div",{className:"text-gray-600",style:{fontSize:x.size==="card"?"6px":x.size==="thermal"?"12px":"16px",lineHeight:"1.0",marginBottom:x.size==="card"?"0.5px":"1px",fontWeight:"500",color:"#666"},children:["Kod: ",ee.code]}),e.jsx("div",{className:"font-bold text-black",style:{fontSize:x.size==="card"?"7px":x.size==="thermal"?"14px":"18px",lineHeight:"1.1",marginBottom:x.size==="card"?"0.5px":"1px",fontWeight:"600",color:"#1a1a1a",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:x.size==="card"?1:2,WebkitBoxOrient:"vertical"},children:ee.name}),x.layout==="standard"&&e.jsxs("div",{className:"text-gray-500",style:{fontSize:x.size==="card"?"4px":x.size==="thermal"?"10px":"12px",lineHeight:"1.0",margin:0,color:"#888",fontWeight:"400"},children:["Miqdor: ",ee.quantity," | ",new Date().toLocaleDateString("uz-UZ")]})]}),e.jsx("div",{className:"flex justify-center items-center",style:{width:"100%",height:"auto",padding:"2px 0"},children:e.jsx("div",{style:{border:"1px solid #e2e8f0",borderRadius:"4px",background:"#ffffff",padding:"2px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Dt,{value:JSON.stringify({id:ee._id,code:ee.code,name:ee.name,price:ee.price}),size:x.size==="card"?60:x.size==="thermal"?120:140,level:"H",includeMargin:!1,style:{width:"100%",height:"100%",maxWidth:x.size==="card"?"60px":x.size==="thermal"?"120px":"140px",maxHeight:x.size==="card"?"60px":x.size==="thermal"?"120px":"140px",objectFit:"contain"}})})})]})})}),x.copies>1&&e.jsxs("p",{className:"text-xs text-surface-500 mt-2 text-center",children:[x.copies," nusxa chop etiladi"]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>ke(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsxs("button",{type:"button",onClick:je,className:"btn-primary flex-1",disabled:!x.printer,children:[e.jsx(Gs,{className:"w-4 h-4"}),"Print"]})]})]})]}),m&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>te(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:Ce==="add"?"Miqdor qo'shish":"Miqdor ayirish"}),e.jsx("button",{onClick:()=>te(!1),className:"btn-icon-sm",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${Ce==="add"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Hozirgi miqdor"}),e.jsxs("p",{className:`text-2xl font-bold ${Ce==="add"?"text-success-600":"text-danger-600"}`,children:[w(I.quantity||0)," dona"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:Ce==="add"?"Qo'shiladigan miqdor":"Ayiriladigan miqdor"}),e.jsx("input",{type:"text",className:"input text-center text-lg font-semibold",placeholder:"0",value:rs(ne),onChange:o=>Ze(Ye(o.target.value)),autoFocus:!0})]}),ne&&Number(ne)>0&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Yangi miqdor"}),e.jsxs("p",{className:"text-xl font-bold text-surface-900",children:[w(Ce==="add"?(Number(I.quantity)||0)+Number(ne):Math.max(0,(Number(I.quantity)||0)-Number(ne)))," dona"]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>te(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"button",onClick:Ls,className:`flex-1 ${Ce==="add"?"btn-success":"btn-danger"}`,disabled:!ne||Number(ne)<=0,children:Ce==="add"?"Qo'shish":"Ayirish"})]})]})]})]}),Be&&Qe&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in",onClick:()=>We(!1),children:e.jsxs("div",{className:"relative max-w-6xl max-h-[90vh] w-full",children:[e.jsx("button",{onClick:()=>We(!1),className:"absolute -top-12 right-0 sm:right-0 w-10 h-10 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white transition-colors z-10",title:"Yopish (Esc)",children:e.jsx(fe,{className:"w-6 h-6"})}),e.jsx("div",{className:"relative bg-white rounded-2xl overflow-hidden shadow-2xl",onClick:o=>o.stopPropagation(),children:e.jsx("img",{src:Qe,alt:"Mahsulot rasmi",className:"w-full h-auto max-h-[85vh] object-contain"})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-white/80 text-sm",children:"Yopish uchun rasmdan tashqariga bosing yoki ESC tugmasini bosing"})})]})})]})}function bl(){const{showAlert:a,AlertComponent:n}=Ns(),[r,u]=t.useState({botToken:"",chatId:"",isEnabled:!1}),[l,h]=t.useState(null),[k,p]=t.useState(null),[z,$]=t.useState(""),[b,f]=t.useState(""),[y,N]=t.useState(!1),[D,i]=t.useState(!1),[T,M]=t.useState(!1);t.useEffect(()=>{q();const O=window.location.origin.replace("5175","3002");f(`${O}/api/telegram/webhook`)},[]);const q=()=>E(this,null,function*(){try{const O=yield _.get("/telegram/settings");u(O.data),O.data.botToken&&(v(),Q())}catch(O){console.error("Error fetching telegram settings:",O)}}),v=()=>E(this,null,function*(){try{const O=yield _.get("/telegram/bot-info");h(O.data)}catch(O){console.error("Error fetching bot info:",O)}}),Q=()=>E(this,null,function*(){try{const O=yield _.get("/telegram/webhook-info");p(O.data)}catch(O){console.error("Error fetching webhook info:",O)}}),V=()=>E(this,null,function*(){if(!b.trim()){a("Webhook URL ni kiriting","Xatolik","warning");return}M(!0);try{yield _.post("/telegram/set-webhook",{webhookUrl:b}),a("Webhook muvaffaqiyatli o'rnatildi","Muvaffaqiyat","success"),Q()}catch(O){a("Webhook o'rnatishda xatolik","Xatolik","danger")}finally{M(!1)}}),K=()=>E(this,null,function*(){N(!0);try{yield _.post("/telegram/settings",r),a("Sozlamalar saqlandi","Muvaffaqiyat","success"),r.botToken&&v()}catch(O){a("Sozlamalarni saqlashda xatolik","Xatolik","danger")}finally{N(!1)}}),le=()=>E(this,null,function*(){if(!z.trim()){a("Test xabarini kiriting","Xatolik","warning");return}i(!0);try{yield _.post("/telegram/test",{message:z}),a("Test xabari yuborildi","Muvaffaqiyat","success"),$("")}catch(O){a("Xabar yuborishda xatolik","Xatolik","danger")}finally{i(!1)}}),oe=()=>{l!=null&&l.username&&(navigator.clipboard.writeText(`@${l.username}`),a("Bot username nusxalandi","Muvaffaqiyat","success"))};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[n,e.jsx(Fs,{title:"Telegram Sozlamalari"}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-4xl mx-auto",children:[l&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(ir,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Bot Ma'lumotlari"}),e.jsx("p",{className:"text-surface-500",children:"Telegram bot holati"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-surface-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Bot nomi"}),e.jsx("p",{className:"font-medium text-surface-900",children:l.first_name})]}),e.jsx("div",{className:"bg-surface-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Username"}),e.jsxs("p",{className:"font-medium text-surface-900",children:["@",l.username]})]}),e.jsx("button",{onClick:oe,className:"btn-icon-sm hover:bg-surface-200",title:"Nusxalash",children:e.jsx(Na,{className:"w-4 h-4"})})]})})]}),e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-green-700 font-medium",children:"Bot faol"})]})})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-6",children:"Telegram Sozlamalari"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Bot Token"}),e.jsx("input",{type:"password",className:"input",placeholder:"Bot tokenini kiriting",value:r.botToken,onChange:O=>u(j(g({},r),{botToken:O.target.value}))}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"@BotFather dan olingan bot token"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Chat ID yoki Kanal Username"}),e.jsx("input",{type:"text",className:"input",placeholder:"@channel_name yoki -100xxxxxxxxx",value:r.chatId,onChange:O=>u(j(g({},r),{chatId:O.target.value}))}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Xabarlar yuboriladigan kanal yoki guruh"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"telegram-enabled",className:"w-4 h-4 text-brand-600 border-surface-300 rounded focus:ring-brand-500",checked:r.isEnabled,onChange:O=>u(j(g({},r),{isEnabled:O.target.checked}))}),e.jsx("label",{htmlFor:"telegram-enabled",className:"text-sm font-medium text-surface-700",children:"Telegram xabarlarini yoqish"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:K,disabled:y,className:"btn-primary",children:y?e.jsxs(e.Fragment,{children:[e.jsx(Os,{className:"w-4 h-4 animate-spin"}),"Saqlanmoqda..."]}):"Saqlash"})})]})]}),l&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(pa,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Webhook Sozlamalari"}),e.jsx("p",{className:"text-surface-500",children:"Mijozlarga chek yuborish uchun"})]})]}),k&&e.jsxs("div",{className:"mb-4 p-3 bg-surface-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-surface-700",children:"Joriy webhook:"}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${k.url?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:k.url?"Faol":"O'rnatilmagan"})]}),k.url&&e.jsx("p",{className:"text-xs text-surface-500 break-all",children:k.url})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Webhook URL"}),e.jsx("input",{type:"text",className:"input",placeholder:"https://your-domain.com/api/telegram/webhook",value:b,onChange:O=>f(O.target.value)}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Server webhook URL manzili"})]}),e.jsx("button",{onClick:V,disabled:T||!b.trim(),className:"btn-secondary",children:T?e.jsxs(e.Fragment,{children:[e.jsx(Os,{className:"w-4 h-4 animate-spin"}),"O'rnatilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pa,{className:"w-4 h-4"}),"Webhook O'rnatish"]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(Ds,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Mijozlar uchun yo'riqnoma"}),e.jsx("p",{className:"text-surface-500",children:"Cheklar olish uchun"})]})]}),e.jsxs("div",{className:"space-y-4 text-sm text-surface-600",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Mijozlar qanday qilib chek oladi:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-4 text-blue-800",children:[e.jsxs("li",{children:["Telegram da ",e.jsxs("strong",{children:["@",(l==null?void 0:l.username)||"your_bot"]})," botini topish"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"/start"})," buyrug'ini yuborish"]}),e.jsx("li",{children:"Telefon raqamini yuborish (masalan: +998901234567)"}),e.jsx("li",{children:"Ro'yxatdan o'tgandan keyin barcha cheklar avtomatik keladi"})]})]}),e.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[e.jsx("h4",{className:"font-medium text-amber-900 mb-2",children:"Muhim:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4 text-amber-800",children:[e.jsx("li",{children:"Mijoz avval botga /start berishi kerak"}),e.jsx("li",{children:"Telefon raqam bazada mavjud bo'lishi kerak"}),e.jsx("li",{children:"Webhook to'g'ri sozlangan bo'lishi kerak"})]})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-6",children:"Test Xabar"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Test xabari"}),e.jsx("textarea",{className:"input",rows:3,placeholder:"Test xabarini kiriting...",value:z,onChange:O=>$(O.target.value)})]}),e.jsx("button",{onClick:le,disabled:D||!r.botToken||!r.chatId,className:"btn-secondary",children:D?e.jsxs(e.Fragment,{children:[e.jsx(Os,{className:"w-4 h-4 animate-spin"}),"Yuborilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Sa,{className:"w-4 h-4"}),"Test Xabar Yuborish"]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-4",children:"Sozlash Yo'riqnomasi"}),e.jsxs("div",{className:"space-y-4 text-sm text-surface-600",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"1. Bot yaratish:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Telegram da @BotFather ga murojaat qiling"}),e.jsx("li",{children:"/newbot buyrug'ini yuboring"}),e.jsx("li",{children:"Bot nomini va username ni kiriting"}),e.jsx("li",{children:"Olingan tokenni yuqoridagi maydonga kiriting"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"2. Kanal/Guruh sozlash:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Telegram da kanal yoki guruh yarating"}),e.jsx("li",{children:"Botni kanalga admin qilib qo'shing"}),e.jsx("li",{children:"Kanal username ini (@channel_name) yoki Chat ID ni kiriting"}),e.jsx("li",{children:"Barcha xodimlar kanalga obuna bo'lsin"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"3. Mijozlarga chek yuborish:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Webhook URL ni to'g'ri o'rnating"}),e.jsx("li",{children:"Mijozlar botga /start berib ro'yxatdan o'tsin"}),e.jsx("li",{children:"Kassa panelida mijoz tanlanganda chek avtomatik yuboriladi"}),e.jsx("li",{children:"Faqat ro'yxatdan o'tgan mijozlarga chek boradi"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"4. Xabar turlari:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Xarid cheklari (mijozlarga shaxsiy)"}),e.jsx("li",{children:"Yangi qarz qo'shilganda (admin kanaliga)"}),e.jsx("li",{children:"Qarz tasdiqlanganda (admin kanaliga)"}),e.jsx("li",{children:"To'lov qilinganida (admin kanaliga)"}),e.jsx("li",{children:"Kam qolgan mahsulotlar haqida (admin kanaliga)"})]})]})]})]})]})]})}function jl(){const{showAlert:a,AlertComponent:n}=Ns(),{user:r,updateUser:u}=Vs(),[l,h]=t.useState(!1),[k,p]=t.useState(!1),[z,$]=t.useState(!1),[b,f]=t.useState([]),[y,N]=t.useState(!1),[D,i]=t.useState(!1),[T,M]=t.useState(null),[q,v]=t.useState({name:"",login:"",password:""}),[Q,V]=t.useState(!1),[K,le]=t.useState({currentPassword:"",newLogin:(r==null?void 0:r.login)||"",newPassword:"",confirmPassword:""});t.useEffect(()=>{oe()},[]);const oe=()=>E(this,null,function*(){try{N(!0);const Z=yield _.get("/auth/admin/kassa-users");Z.data.success&&f(Z.data.users)}catch(Z){console.error("Load kassa users error:",Z)}finally{N(!1)}}),O=Z=>E(this,null,function*(){var L,xe;if(Z.preventDefault(),!q.name||!q.login){a("Barcha maydonlarni to'ldiring","Xatolik","danger");return}if(!T&&!q.password){a("Parolni kiriting","Xatolik","danger");return}if(q.password&&q.password.length<4){a("Parol kamida 4 ta belgidan iborat bo'lishi kerak","Xatolik","danger");return}h(!0);try{T?(yield _.put(`/auth/admin/kassa-users/${T._id}`,q)).data.success&&(a("Kassa foydalanuvchisi muvaffaqiyatli o'zgartirildi","Muvaffaqiyat","success"),oe(),ve()):(yield _.post("/auth/admin/kassa-users",q)).data.success&&(a("Kassa foydalanuvchisi muvaffaqiyatli yaratildi","Muvaffaqiyat","success"),oe(),ve())}catch(I){console.error("Kassa user submit error:",I);const de=((xe=(L=I.response)==null?void 0:L.data)==null?void 0:xe.message)||"Xatolik yuz berdi";a(de,"Xatolik","danger")}finally{h(!1)}}),ke=Z=>E(this,null,function*(){var L,xe;if(confirm("Rostdan ham bu kassa foydalanuvchisini o'chirmoqchimisiz?")){h(!0);try{(yield _.delete(`/auth/admin/kassa-users/${Z}`)).data.success&&(a("Kassa foydalanuvchisi muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),oe())}catch(I){console.error("Delete kassa user error:",I);const de=((xe=(L=I.response)==null?void 0:L.data)==null?void 0:xe.message)||"O'chirishda xatolik";a(de,"Xatolik","danger")}finally{h(!1)}}}),ee=Z=>{Z?(M(Z),v({name:Z.name,login:Z.login,password:""})):(M(null),v({name:"",login:"",password:""})),i(!0)},ve=()=>{i(!1),M(null),v({name:"",login:"",password:""}),V(!1)},X=Z=>E(this,null,function*(){var L,xe,I;if(Z.preventDefault(),!K.currentPassword){a("Joriy parolni kiriting","Xatolik","danger");return}if(!K.newLogin){a("Yangi loginni kiriting","Xatolik","danger");return}if(K.newPassword&&K.newPassword!==K.confirmPassword){a("Yangi parollar mos kelmadi","Xatolik","danger");return}if(K.newPassword&&K.newPassword.length<6){a("Parol kamida 6 ta belgidan iborat bo'lishi kerak","Xatolik","danger");return}h(!0),console.log("ðŸ” Admin credentials update - Frontend"),console.log("   Current Password:",K.currentPassword?"***":"empty"),console.log("   New Login:",K.newLogin),console.log("   New Password:",K.newPassword?"***":"empty");try{console.log("ðŸ“¤ Sending request to /auth/admin/credentials");const de=yield _.put("/auth/admin/credentials",{currentPassword:K.currentPassword,newLogin:K.newLogin,newPassword:K.newPassword||void 0});console.log("ðŸ“¥ Response received:",de.data),de.data.success&&(console.log("âœ… Success response"),de.data.token&&(console.log("ðŸ’¾ Saving new token to localStorage"),localStorage.setItem("token",de.data.token),console.log("âœ… Token saved")),de.data.user&&(console.log("ðŸ‘¤ Updating user context:",de.data.user),u(de.data.user),console.log("âœ… User context updated")),a("Login va parol muvaffaqiyatli o'zgartirildi","Muvaffaqiyat","success"),le({currentPassword:"",newLogin:de.data.user.login,newPassword:"",confirmPassword:""}),console.log("âœ… Form cleared"))}catch(de){console.error("âŒ Admin credentials update error:",de),console.error("   Error response:",(L=de.response)==null?void 0:L.data);const ue=((I=(xe=de.response)==null?void 0:xe.data)==null?void 0:I.message)||"Login va parolni o'zgartirishda xatolik";a(ue,"Xatolik","danger")}finally{h(!1)}});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-blue-100/30 to-slate-100",children:[e.jsx(Fs,{title:"Admin Sozlamalari"}),n,e.jsx("div",{className:"p-3 sm:p-4 md:p-6 max-w-6xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 md:gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-5 md:p-6 mb-3 sm:mb-4 md:mb-6 border border-slate-200",children:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-xl sm:rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(Js,{className:"w-6 h-6 sm:w-7 sm:h-7 md:w-8 md:h-8 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-slate-900 truncate",children:"Admin Sozlamalari"}),e.jsx("p",{className:"text-xs sm:text-sm md:text-base text-slate-600 mt-0.5 sm:mt-1 truncate",children:"Login va parolni o'zgartirish"})]})]})}),e.jsx("form",{onSubmit:X,className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-5 md:p-6 border border-slate-200",children:e.jsxs("div",{className:"space-y-4 sm:space-y-5 md:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2",children:e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx(ws,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),"Joriy Parol *"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:k?"text":"password",value:K.currentPassword,onChange:Z=>le(j(g({},K),{currentPassword:Z.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 pr-10 sm:pr-12 border border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Joriy parolni kiriting",required:!0}),e.jsx("button",{type:"button",onClick:()=>p(!k),className:"absolute right-2.5 sm:right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 p-1",children:k?e.jsx(st,{className:"w-4 h-4 sm:w-5 sm:h-5"}):e.jsx(Qs,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),e.jsx("div",{className:"border-t border-slate-200 pt-4 sm:pt-5 md:pt-6",children:e.jsxs("h4",{className:"text-xs sm:text-sm font-bold text-slate-700 mb-3 sm:mb-4 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(or,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),"Yangi Ma'lumotlar"]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2",children:"Yangi Login *"}),e.jsx("input",{type:"text",value:K.newLogin,onChange:Z=>le(j(g({},K),{newLogin:Z.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Yangi loginni kiriting",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2",children:"Yangi Parol (ixtiyoriy)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:z?"text":"password",value:K.newPassword,onChange:Z=>le(j(g({},K),{newPassword:Z.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 pr-10 sm:pr-12 border border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Yangi parolni kiriting (ixtiyoriy)",minLength:6}),e.jsx("button",{type:"button",onClick:()=>$(!z),className:"absolute right-2.5 sm:right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 p-1",children:z?e.jsx(st,{className:"w-4 h-4 sm:w-5 sm:h-5"}):e.jsx(Qs,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Kamida 6 ta belgi. Bo'sh qoldiring agar parolni o'zgartirmoqchi bo'lmasangiz."})]}),K.newPassword&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2",children:"Yangi Parolni Tasdiqlash *"}),e.jsx("input",{type:z?"text":"password",value:K.confirmPassword,onChange:Z=>le(j(g({},K),{confirmPassword:Z.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Yangi parolni qayta kiriting",required:!0})]}),e.jsx("button",{type:"submit",disabled:l,className:"w-full py-3 sm:py-3.5 md:py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg sm:rounded-xl text-sm sm:text-base font-bold hover:from-blue-600 hover:to-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Saqlanmoqda..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(mt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"O'zgarishlarni Saqlash"})]})})]})}),e.jsxs("div",{className:"mt-3 sm:mt-4 md:mt-6 bg-yellow-50 border border-yellow-200 rounded-xl sm:rounded-2xl p-4 sm:p-5 md:p-6",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-bold text-yellow-900 mb-2 sm:mb-3 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(Js,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),"Xavfsizlik Maslahatlari"]}),e.jsxs("ul",{className:"space-y-1.5 sm:space-y-2 text-xs sm:text-sm text-yellow-800",children:[e.jsxs("li",{className:"flex items-start gap-1.5 sm:gap-2",children:[e.jsx("span",{className:"text-yellow-600 mt-0.5 flex-shrink-0",children:"â€¢"}),e.jsx("span",{children:"Parolni hech kimga bermang"})]}),e.jsxs("li",{className:"flex items-start gap-1.5 sm:gap-2",children:[e.jsx("span",{className:"text-yellow-600 mt-0.5 flex-shrink-0",children:"â€¢"}),e.jsx("span",{children:"Kuchli parol ishlating (harflar, raqamlar, belgilar)"})]}),e.jsxs("li",{className:"flex items-start gap-1.5 sm:gap-2",children:[e.jsx("span",{className:"text-yellow-600 mt-0.5 flex-shrink-0",children:"â€¢"}),e.jsx("span",{children:"Parolni muntazam o'zgartiring"})]}),e.jsxs("li",{className:"flex items-start gap-1.5 sm:gap-2",children:[e.jsx("span",{className:"text-yellow-600 mt-0.5 flex-shrink-0",children:"â€¢"}),e.jsx("span",{children:"Login va parolni xavfsiz joyda saqlang"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-5 md:p-6 mb-3 sm:mb-4 md:mb-6 border border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 md:gap-4 min-w-0 flex-1",children:[e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-xl sm:rounded-2xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(Ds,{className:"w-6 h-6 sm:w-7 sm:h-7 md:w-8 md:h-8 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-base sm:text-lg md:text-2xl font-bold text-slate-900 truncate",children:"Kassa Foydalanuvchilari"}),e.jsx("p",{className:"text-xs sm:text-sm md:text-base text-slate-600 mt-0.5 sm:mt-1 truncate",children:"Kassa login va parollarini boshqarish"})]})]}),e.jsxs("button",{onClick:()=>ee(),className:"px-2.5 sm:px-3 md:px-4 py-1.5 sm:py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg sm:rounded-xl text-xs sm:text-sm md:text-base font-bold hover:from-green-600 hover:to-green-700 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-1 sm:gap-1.5 md:gap-2 flex-shrink-0",children:[e.jsx(ds,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-5 md:h-5"}),e.jsx("span",{className:"hidden xs:inline",children:"Yangi"})]})]})}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:y?e.jsx("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-6 sm:p-8 border border-slate-200 flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 border-4 border-green-500 border-t-transparent rounded-full animate-spin"})}):b.length===0?e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-6 sm:p-8 border border-slate-200 text-center",children:[e.jsx(Ds,{className:"w-12 h-12 sm:w-16 sm:h-16 text-slate-300 mx-auto mb-3 sm:mb-4"}),e.jsx("p",{className:"text-sm sm:text-base text-slate-600 font-medium",children:"Hozircha kassa foydalanuvchilari yo'q"}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500 mt-1.5 sm:mt-2",children:`Yangi kassa foydalanuvchisi qo'shish uchun "Yangi" tugmasini bosing`})]}):b.map(Z=>e.jsx("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-5 md:p-6 border border-slate-200 hover:shadow-xl transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2 sm:mb-3",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-lg sm:rounded-xl bg-gradient-to-br from-green-400 to-green-500 flex items-center justify-center shadow-md flex-shrink-0",children:e.jsx(ls,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-slate-900 truncate",children:Z.name}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500",children:new Date(Z.createdAt).toLocaleDateString("uz-UZ")})]})]}),e.jsx("div",{className:"bg-slate-50 rounded-lg sm:rounded-xl p-2.5 sm:p-3 border border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs sm:text-sm text-slate-600 font-medium",children:"Login:"}),e.jsx("span",{className:"text-xs sm:text-sm text-slate-900 font-bold truncate",children:Z.login})]})})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 sm:gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>ee(Z),className:"p-1.5 sm:p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors",title:"O'zgartirish",children:e.jsx(cr,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:()=>ke(Z._id),className:"p-1.5 sm:p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors",title:"O'chirish",children:e.jsx(Ps,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]})},Z._id))})]})]})}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-3 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-green-500 to-green-600 p-4 sm:p-5 md:p-6 rounded-t-xl sm:rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h3",{className:"text-base sm:text-lg md:text-xl font-bold text-white truncate",children:T?"Kassa Foydalanuvchisini O'zgartirish":"Yangi Kassa Foydalanuvchisi"}),e.jsx("button",{onClick:ve,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-lg p-1.5 sm:p-2 transition-colors flex-shrink-0",children:e.jsx(fe,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]})}),e.jsxs("form",{onSubmit:O,className:"p-4 sm:p-5 md:p-6 space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2",children:"Ism *"}),e.jsx("input",{type:"text",value:q.name,onChange:Z=>v(j(g({},q),{name:Z.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ism kiriting",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2",children:"Login *"}),e.jsx("input",{type:"text",value:q.login,onChange:Z=>v(j(g({},q),{login:Z.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Login kiriting",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(ws,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-green-600"}),e.jsxs("span",{className:"truncate",children:["Parol ",T?"(ixtiyoriy - o'zgartirish uchun)":"*"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:Q?"text":"password",value:q.password,onChange:Z=>v(j(g({},q),{password:Z.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 pr-10 sm:pr-12 border-2 border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:T?"Yangi parol kiriting (o'zgartirish uchun)":"Parol kiriting",required:!T,minLength:4}),e.jsx("button",{type:"button",onClick:()=>V(!Q),className:"absolute right-2.5 sm:right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 p-1",children:Q?e.jsx(st,{className:"w-4 h-4 sm:w-5 sm:h-5"}):e.jsx(Qs,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),T?e.jsx("div",{className:"mt-2 p-2.5 sm:p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700 font-medium flex items-start gap-1.5 sm:gap-2",children:[e.jsx(Js,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Parolni o'zgartirish uchun yangi parol kiriting. Bo'sh qoldiring agar parolni o'zgartirmoqchi bo'lmasangiz."})]})}):e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Kamida 4 ta belgi. Kassa panelga kirish uchun ishlatiladi."})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 pt-2 sm:pt-4",children:[e.jsx("button",{type:"button",onClick:ve,className:"flex-1 py-2.5 sm:py-3 bg-slate-200 text-slate-700 rounded-lg sm:rounded-xl text-sm sm:text-base font-bold hover:bg-slate-300 transition-colors",children:"Bekor qilish"}),e.jsx("button",{type:"submit",disabled:l,className:"flex-1 py-2.5 sm:py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg sm:rounded-xl text-sm sm:text-base font-bold hover:from-green-600 hover:to-green-700 transition-all duration-300 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1.5 sm:gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Saqlanmoqda..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(mt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{children:"Saqlash"})]})})]})]})]})})]})}function vl(){const[a,n]=t.useState(""),[r,u]=t.useState(""),[l,h]=t.useState(!1),[k,p]=t.useState(""),[z,$]=t.useState(!1),b=As(),f=y=>E(this,null,function*(){y.preventDefault(),p(""),$(!0);try{const N=yield _.post("/kassa-auth/login",{username:a.trim(),password:r});if(N.data.success){N.data.token&&localStorage.setItem("token",N.data.token);const D={loggedIn:!0,timestamp:Date.now(),user:"kassa",username:N.data.data.username,sessionToken:N.data.data.sessionToken,expiresAt:N.data.data.expiresAt,locked:!0};localStorage.setItem("kassaLoggedIn",JSON.stringify(D)),window.history.replaceState(null,"","/kassa"),b("/kassa",{replace:!0})}else p(N.data.message||"Login yoki parol noto'g'ri")}catch(N){console.error("Login error:",N),p("Login yoki parol noto'g'ri")}finally{$(!1)}});return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(109, 40, 217, 0.15) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute top-1/4 right-1/4 w-64 h-64 rounded-full blur-2xl",style:{background:"radial-gradient(circle, rgba(6, 182, 212, 0.1) 0%, transparent 70%)"}})]}),e.jsxs("div",{className:"w-full max-w-sm relative z-10",children:[e.jsxs("div",{className:"text-center mb-6 animate-fade-up",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-4",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 8px 32px -8px rgba(6, 182, 212, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:e.jsx(Ca,{className:"w-10 h-10 text-white"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-7 h-7 rounded-full flex items-center justify-center",style:{background:"linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",boxShadow:"0 2px 8px -2px rgba(34, 197, 94, 0.5)"},children:e.jsx(Js,{className:"w-3.5 h-3.5 text-white"})})]}),e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{background:"linear-gradient(135deg, #2e1065 0%, #5b21b6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Kassa Tizimi"}),e.jsx("p",{className:"font-medium",style:{color:"#71717a"},children:"Sardor Furnitura - Kassa Paneli"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full animate-pulse",style:{background:"#22c55e"}}),e.jsx("span",{className:"text-sm",style:{color:"#a1a1aa"},children:"Xavfsiz tizim"})]})]}),e.jsxs("div",{className:"rounded-2xl p-6 animate-fade-up",style:{background:"linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 20px 40px -12px rgba(109, 40, 217, 0.2)",backdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-1",style:{color:"#2e1065"},children:"Kassa tizimiga kirish"}),e.jsx("p",{style:{color:"#71717a"},children:"Hisobingiz bilan tizimga kiring"})]}),k&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)",border:"1px solid #fca5a5"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#ef4444"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#991b1b"},children:"Xatolik"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#b91c1c"},children:k})]})]})}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(Es,{className:"w-3.5 h-3.5"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Es,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:"text",placeholder:"Login",value:a,onChange:y=>n(y.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ws,{className:"w-3.5 h-3.5"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ws,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:l?"text":"password",placeholder:"Parol",value:r,onChange:y=>u(y.target.value),className:"w-full pl-10 pr-10 py-3 rounded-xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!l),className:"absolute inset-y-0 right-0 pr-3 flex items-center transition-colors",style:{color:"#a1a1aa"},children:l?e.jsx(st,{className:"w-4 h-4"}):e.jsx(Qs,{className:"w-4 h-4"})})]})]}),e.jsx("button",{type:"submit",disabled:z,className:"w-full text-white font-semibold py-3.5 px-4 rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 14px -2px rgba(6, 182, 212, 0.4)"},children:z?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Kirish..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Kirish"}),e.jsx(ta,{className:"w-4 h-4 transition-transform group-hover:translate-x-1"})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"pt-4",style:{borderTop:"1px solid #ede9fe"},children:e.jsxs("div",{className:"rounded-xl p-4 mb-4",style:{background:"linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%)"},children:[e.jsx("p",{className:"font-medium text-sm mb-3",style:{color:"#5b21b6"},children:"Admin uchun:"}),e.jsx("a",{href:"/login",className:"inline-flex items-center justify-center gap-2 font-semibold transition-colors text-base underline decoration-2 underline-offset-4",style:{color:"#7c3aed"},children:e.jsx("span",{children:"Admin panel â†’"})})]})})})})]}),e.jsxs("div",{className:"text-center mt-6 animate-fade-up",children:[e.jsx("p",{className:"text-sm",style:{color:"#71717a"},children:"Â© 2025 Sardor Furnitura. Barcha huquqlar himoyalangan."}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-2 text-xs",style:{color:"#a1a1aa"},children:[e.jsx("span",{children:"Xavfsiz"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Professional"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Ishonchli"})]})]})]})]})}const wl="http://localhost:8000/api",Nl=(a,n)=>{const r={dona:{single:"dona",plural:"dona"},metr:{single:"metr",plural:"metr"},rulon:{single:"rulon",plural:"rulon"},karobka:{single:"quti",plural:"quti"},gram:{single:"gram",plural:"gram"},kg:{single:"kg",plural:"kg"},litr:{single:"litr",plural:"litr"}};return(r[a||"dona"]||r.dona).single};function yl(){var D,i,T;const{id:a}=dr(),n=As(),[r,u]=t.useState(null),[l,h]=t.useState(!0),[k,p]=t.useState(""),[z,$]=t.useState(!1);t.useEffect(()=>{a&&b()},[a]),t.useEffect(()=>(z?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[z]);const b=()=>E(this,null,function*(){var M,q;try{const v=yield qa.get(`${wl}/products/public/${a}`);u(v.data)}catch(v){console.error("Error fetching product:",v),p(((q=(M=v.response)==null?void 0:M.data)==null?void 0:q.message)||"Mahsulot topilmadi")}finally{h(!1)}}),f=[{icon:ra,label:"Bosh sahifa",path:"/"},{icon:it,label:"Mahsulotlar",path:"/admin/products"},{icon:hs,label:"Kassa",path:"/admin/kassa"},{icon:Ds,label:"Mijozlar",path:"/admin/customers"},{icon:Hs,label:"Qarzlar",path:"/admin/debts"},{icon:Zt,label:"Omborlar",path:"/admin/warehouses"},{icon:la,label:"Hodimlar",path:"/admin/helpers"},{icon:Et,label:"Statistika",path:"/admin/dashboard"},{icon:xt,label:"QR Scanner",path:"/helper/scanner"},{icon:Pt,label:"Sozlamalar",path:"/admin/settings"}];if(l)return e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-brand-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-surface-600",children:"Yuklanmoqda..."})]})});if(k||!r)return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-surface-100 to-surface-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-red-100 to-red-200 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx(Ie,{className:"w-12 h-12 text-red-500"})}),e.jsx("h1",{className:"text-2xl font-bold text-surface-900 mb-3",children:"Mahsulot topilmadi"}),e.jsx("p",{className:"text-surface-500 mb-8",children:k||"Bu mahsulot mavjud emas yoki o'chirilgan"}),e.jsx("button",{onClick:()=>n("/"),className:"px-8 py-3.5 bg-gradient-to-r from-brand-500 to-brand-600 text-white rounded-2xl font-semibold hover:from-brand-600 hover:to-brand-700 transition-all shadow-lg shadow-brand-500/30",children:"Bosh sahifaga qaytish"})]})});const y=r.tierPrices&&(r.tierPrices.tier1||r.tierPrices.tier2||r.tierPrices.tier3),N=Nl(r.unit);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-surface-100 to-white",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-lg border-b border-surface-200/50 sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-3 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>n(-1),className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center hover:bg-surface-200 transition-colors active:scale-95",children:e.jsx(ya,{className:"w-5 h-5 text-surface-700"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-base font-semibold text-surface-900 truncate",children:r.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",r.code]})]}),e.jsx("button",{onClick:()=>$(!0),className:"w-10 h-10 bg-brand-500 rounded-xl flex items-center justify-center hover:bg-brand-600 transition-colors active:scale-95 shadow-lg shadow-brand-500/30",children:e.jsx(qt,{className:"w-5 h-5 text-white"})})]})}),z&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] transition-opacity",onClick:()=>$(!1)}),e.jsxs("div",{className:"fixed top-0 right-0 bottom-0 w-80 max-w-[85vw] bg-white z-50 shadow-2xl transform transition-transform",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-black text-white",children:"SF"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-brand-100 text-xs",children:"Mebel furniturasi"})]})]}),e.jsx("button",{onClick:()=>$(!1),className:"w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center hover:bg-white/30 transition-colors",children:e.jsx(fe,{className:"w-5 h-5 text-white"})})]})}),e.jsxs("div",{className:"overflow-y-auto h-[calc(100vh-140px)] p-4",children:[e.jsx("div",{className:"space-y-1",children:f.map((M,q)=>{const v=M.icon;return e.jsxs("button",{onClick:()=>{n(M.path),$(!1)},className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-surface-50 transition-colors group",children:[e.jsx("div",{className:"w-11 h-11 bg-surface-100 rounded-xl flex items-center justify-center group-hover:bg-brand-50 group-hover:scale-110 transition-all",children:e.jsx(v,{className:"w-5 h-5 text-surface-600 group-hover:text-brand-600"})}),e.jsx("span",{className:"font-medium text-surface-900 group-hover:text-brand-600 transition-colors",children:M.label}),e.jsx(Jt,{className:"w-4 h-4 text-surface-300 ml-auto group-hover:text-brand-600 group-hover:translate-x-1 transition-all"})]},q)})}),e.jsxs("div",{className:"mt-6 p-4 bg-surface-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-surface-500 text-center mb-2",children:"QR kod orqali ko'rilmoqda"}),e.jsx("p",{className:"text-xs text-surface-400 text-center",children:new Date().toLocaleDateString("uz-UZ",{year:"numeric",month:"long",day:"numeric"})})]})]})]})]}),e.jsxs("div",{className:"max-w-lg mx-auto pb-8",children:[e.jsxs("div",{className:"relative",children:[r.images&&r.images.length>0?e.jsx("div",{className:"aspect-square bg-white",children:e.jsx("img",{src:`${Bs}${typeof r.images[0]=="string"?r.images[0]:r.images[0].path}`,alt:r.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-square bg-gradient-to-br from-brand-50 via-brand-100 to-indigo-100 flex items-center justify-center",children:e.jsx("div",{className:"w-24 h-24 bg-white/60 backdrop-blur rounded-3xl flex items-center justify-center shadow-xl",children:e.jsx(Ie,{className:"w-12 h-12 text-brand-500"})})}),e.jsx("div",{className:`absolute top-4 right-4 px-4 py-2 rounded-full text-sm font-bold shadow-lg ${r.quantity>10?"bg-gradient-to-r from-emerald-400 to-green-500 text-white":r.quantity>0?"bg-gradient-to-r from-amber-400 to-orange-400 text-white":"bg-gradient-to-r from-red-500 to-rose-500 text-white"}`,children:r.quantity>0?`âœ“ ${r.quantity} ${N} mavjud`:"âœ• Tugagan"})]}),e.jsxs("div",{className:"px-4 -mt-6 relative z-10 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-xl shadow-surface-200/50",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-surface-900 mb-1",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"px-2.5 py-1 bg-surface-100 rounded-lg text-xs font-mono text-surface-600",children:["#",r.code]}),e.jsx("span",{className:"px-2.5 py-1 bg-brand-50 text-brand-600 rounded-lg text-xs font-medium",children:N}),r.dimensions&&(r.dimensions.width||r.dimensions.height||r.dimensions.length)&&e.jsxs("span",{className:"px-2.5 py-1 bg-purple-50 text-purple-600 rounded-lg text-xs font-medium",children:["ðŸ“ ",[r.dimensions.width,r.dimensions.height,r.dimensions.length].filter(Boolean).join(" Ã— ")]})]}),r.description&&e.jsx("p",{className:"mt-3 text-sm text-surface-600 leading-relaxed",children:r.description})]}),e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 rounded-2xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-brand-100 text-sm mb-1",children:"Narxi"}),e.jsx("p",{className:"text-3xl font-black text-white",children:w(r.price)})]}),e.jsxs("span",{className:"text-brand-100 text-lg font-medium",children:["so'm/",N]})]})}),y&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center",children:e.jsx(mr,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"font-bold text-surface-900",children:"Chegirmali narxlar"})]}),e.jsxs("div",{className:"space-y-2",children:[((D=r.tierPrices)==null?void 0:D.tier1)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-emerald-50 to-green-50 rounded-xl border border-emerald-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center",children:e.jsx(Tt,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[r.tierPrices.tier1.minQuantity,"â€“",r.tierPrices.tier1.maxQuantity," ",N]}),e.jsxs("p",{className:"text-xs text-emerald-600 font-medium",children:[r.tierPrices.tier1.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-emerald-600",children:w(r.tierPrices.tier1.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",N]})]})]}),((i=r.tierPrices)==null?void 0:i.tier2)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(Tt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[r.tierPrices.tier2.minQuantity,"â€“",r.tierPrices.tier2.maxQuantity," ",N]}),e.jsxs("p",{className:"text-xs text-blue-600 font-medium",children:[r.tierPrices.tier2.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-blue-600",children:w(r.tierPrices.tier2.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",N]})]})]}),((T=r.tierPrices)==null?void 0:T.tier3)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-violet-50 rounded-xl border border-purple-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(Tt,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[r.tierPrices.tier3.minQuantity,"+ ",N]}),e.jsxs("p",{className:"text-xs text-purple-600 font-medium",children:[r.tierPrices.tier3.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-purple-600",children:w(r.tierPrices.tier3.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",N]})]})]})]}),e.jsx("p",{className:"mt-3 text-xs text-surface-400 text-center",children:"ðŸ’¡ Ko'proq olsangiz, arzonroq!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-surface-50 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-400 mb-1",children:[e.jsx(xr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"O'lchov"})]}),e.jsx("p",{className:"font-bold text-surface-900",children:N})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-400 mb-1",children:[e.jsx(ur,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Kod"})]}),e.jsx("p",{className:"font-bold text-surface-900 font-mono",children:r.code})]})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-lg shadow-surface-200/30",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand-500 to-brand-600 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-500/30",children:e.jsx("span",{className:"text-2xl font-black text-white",children:"SF"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-surface-900 text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-sm text-surface-500",children:"Mebel furniturasi do'koni"})]}),e.jsx(Jt,{className:"w-5 h-5 text-surface-300"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-surface-100 space-y-3",children:[e.jsxs("a",{href:"tel:+998901234567",className:"flex items-center gap-3 text-surface-600 hover:text-brand-600 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(Es,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"+998 90 123 45 67"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-surface-600",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(At,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"Toshkent shahri"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-surface-600",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(dt,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"09:00 - 18:00"})]})]})]}),e.jsxs("p",{className:"text-center text-xs text-surface-400 pt-4",children:["QR kod orqali ko'rilmoqda â€¢ ",new Date().toLocaleDateString("uz-UZ")]})]})]})]})}const kl=(a={})=>{const n=As(),{threshold:r=80,edgeThreshold:u=30,disableOnInput:l=!0,fullScreenSwipe:h=!0}=a;t.useEffect(()=>{if(!(window.innerWidth<=768||"ontouchstart"in window))return;let p=0,z=0,$=0,b=0,f=!1,y=0;const N=T=>{const M=T.touches[0];if(p=M.clientX,z=M.clientY,$=p,b=z,y=Date.now(),f=!1,l){const q=T.target,v=q.closest('input, textarea, select, input[type="range"]'),Q=q.closest('.modal, .overlay, [role="dialog"], .swal2-container, .dialog'),V=q.closest(".no-swipe"),K=q.closest(".overflow-auto, .overflow-scroll, .overflow-y-auto, .overflow-x-auto");if(v||Q||V||K&&h&&!(p<=u))return}if(h)f=!0;else{const q=p<=u,v=p>=window.innerWidth-u;f=q||v}},D=T=>{if(!f)return;const M=T.touches[0];$=M.clientX,b=M.clientY;const q=$-p,v=b-z;if(Math.abs(v)>Math.abs(q)*1.5){f=!1;return}q>20&&Math.abs(v)<Math.abs(q)&&T.preventDefault()},i=T=>{if(!f)return;const M=T.changedTouches[0],q=M.clientX,v=M.clientY,Q=q-p,V=v-z,K=Date.now()-y;if(Math.abs(V)>Math.abs(Q)*1.5||Math.abs(Q)<r)return;const oe=Math.abs(Q)/K>.3;Q>r||oe&&Q>r*.6?requestAnimationFrame(()=>{n(-1)}):!h&&p>=window.innerWidth-u&&(Q<-r||oe&&Q<-r*.6)&&requestAnimationFrame(()=>{n(1)})};return window.addEventListener("touchstart",N,{passive:!0}),window.addEventListener("touchmove",D,{passive:!1}),window.addEventListener("touchend",i,{passive:!0}),()=>{window.removeEventListener("touchstart",N),window.removeEventListener("touchmove",D),window.removeEventListener("touchend",i)}},[n,r,u,l,h])},Sl=()=>(kl({threshold:80,edgeThreshold:30,disableOnInput:!0,fullScreenSwipe:!0}),null),Wt=({children:a,roles:n})=>{const{user:r,loading:u}=Vs();return u?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Yuklanmoqda..."})]})}):r?n&&!n.includes(r.role)?e.jsx(Zs,{to:"/"}):e.jsx(e.Fragment,{children:a}):e.jsx(Zs,{to:"/login"})},Cl=({children:a})=>{const n=As(),[r,u]=ot.useState(null);return ot.useEffect(()=>{document.body.classList.add("kassa-locked","kassa-protected"),(()=>{try{const b=localStorage.getItem("kassaLoggedIn");if(b){const f=JSON.parse(b);if(f.loggedIn&&f.user==="kassa"){const y=j(g({},f),{timestamp:Date.now()});localStorage.setItem("kassaLoggedIn",JSON.stringify(y)),u(!0),window.history.pushState(null,"",window.location.href);return}}u(!1),n("/kassa-login",{replace:!0})}catch(b){console.error("Kassa login check error:",b),u(!1),n("/kassa-login",{replace:!0})}})();const h=()=>{window.location.pathname.startsWith("/kassa")&&window.history.pushState(null,"",window.location.href)},k=b=>{if(window.location.pathname.startsWith("/kassa")&&!(b.key==="F5"||b.ctrlKey&&(b.key==="r"||b.key==="R"))&&b.key!=="F12"&&(b.altKey&&b.key==="F4"||b.ctrlKey&&b.key==="w"||b.ctrlKey&&b.key==="W"||b.ctrlKey&&b.key==="t"||b.ctrlKey&&b.key==="T"||b.ctrlKey&&b.shiftKey&&b.key==="I"||b.ctrlKey&&b.shiftKey&&b.key==="J"||b.ctrlKey&&b.key==="u"||b.ctrlKey&&b.key==="U"||b.ctrlKey&&b.key==="s"||b.ctrlKey&&b.key==="S"||b.ctrlKey&&b.key==="p"||b.ctrlKey&&b.key==="P"))return b.preventDefault(),b.stopPropagation(),alert("âš ï¸ Bu amal kassa tizimida taqiqlanadi!"),!1},p=b=>{if(window.location.pathname.startsWith("/kassa"))return b.preventDefault(),alert("âš ï¸ O'ng tugma kassa tizimida taqiqlanadi!"),!1},z=()=>{window.location.pathname.startsWith("/kassa")},$=()=>{document.hidden&&setTimeout(()=>{window.focus()},100)};return window.addEventListener("popstate",h),window.addEventListener("keydown",k,!0),window.addEventListener("contextmenu",p),window.addEventListener("beforeunload",z),document.addEventListener("visibilitychange",$),window.focus(),()=>{document.body.classList.remove("kassa-locked","kassa-protected"),window.removeEventListener("popstate",h),window.removeEventListener("keydown",k,!0),window.removeEventListener("contextmenu",p),window.removeEventListener("beforeunload",z),document.removeEventListener("visibilitychange",$)}},[n]),r===null?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Tekshirilmoqda..."})]})}):r?e.jsx(e.Fragment,{children:a}):null},ql=()=>{const{user:a,loading:n}=Vs(),[r,u]=ot.useState(!0),[l,h]=ot.useState(!1);return ot.useEffect(()=>{E(es,null,function*(){var p;try{const z=new AbortController,$=setTimeout(()=>z.abort(),5e3),b=yield fetch("http://localhost:8000/api/auth/check-admin",{signal:z.signal,headers:{"Content-Type":"application/json"}});if(clearTimeout($),!b.ok)throw new Error(`HTTP error! status: ${b.status}`);const f=yield b.json();h(f.hasAdmin)}catch(z){console.error("Admin check error:",z),z.name==="AbortError"?console.warn("Admin check timeout - server javob bermadi"):(p=z.message)!=null&&p.includes("Failed to fetch")&&console.warn("Server bilan aloqa yo'q - localhost:8000 ishlamayapti"),h(!0)}finally{u(!1)}})},[]),n||r?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Yuklanmoqda..."})]})}):!l&&!a?e.jsx(Zs,{to:"/register"}):a?a.role==="admin"?e.jsx(Zs,{to:"/admin"}):a.role==="cashier"?e.jsx(Zs,{to:"/kassa"}):e.jsx(Zs,{to:"/helper"}):e.jsx(Zs,{to:"/login"})};function Pl(){return e.jsx(Pr,{children:e.jsx(Cr,{children:e.jsxs(hr,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:[e.jsx(Sl,{}),e.jsxs(pr,{children:[e.jsx(He,{path:"/login",element:e.jsx(zr,{})}),e.jsx(He,{path:"/register",element:e.jsx(Mr,{})}),e.jsx(He,{path:"/kassa-login",element:e.jsx(vl,{})}),e.jsx(He,{path:"/product/:id",element:e.jsx(yl,{})}),e.jsx(He,{path:"/",element:e.jsx(ql,{})}),e.jsxs(He,{path:"/kassa",element:e.jsx(Cl,{children:e.jsx(dl,{})}),children:[e.jsx(He,{index:!0,element:e.jsx(ul,{})}),e.jsx(He,{path:"receipts",element:e.jsx(hl,{})}),e.jsx(He,{path:"clients",element:e.jsx(pl,{})}),e.jsx(He,{path:"debts",element:e.jsx(fl,{})}),e.jsx(He,{path:"products",element:e.jsx(gl,{})})]}),e.jsxs(He,{path:"/admin",element:e.jsx(Wt,{roles:["admin"],children:e.jsx(Qr,{})}),children:[e.jsx(He,{index:!0,element:e.jsx(Dr,{})}),e.jsx(He,{path:"kassa",element:e.jsx(Yt,{})}),e.jsx(He,{path:"kassa-pro",element:e.jsx(Yt,{})}),e.jsx(He,{path:"products",element:e.jsx(Vr,{})}),e.jsx(He,{path:"warehouses",element:e.jsx(Zr,{})}),e.jsx(He,{path:"customers",element:e.jsx(el,{})}),e.jsx(He,{path:"debts",element:e.jsx(ga,{})}),e.jsx(He,{path:"debt-approvals",element:e.jsx(sl,{})}),e.jsx(He,{path:"orders",element:e.jsx(tl,{})}),e.jsx(He,{path:"helpers",element:e.jsx(al,{})}),e.jsx(He,{path:"staff-receipts",element:e.jsx(ba,{})}),e.jsx(He,{path:"settings",element:e.jsx(jl,{})}),e.jsx(He,{path:"telegram-settings",element:e.jsx(bl,{})})]}),e.jsxs(He,{path:"/cashier",element:e.jsx(Wt,{roles:["cashier"],children:e.jsx(il,{})}),children:[e.jsx(He,{index:!0,element:e.jsx(Yt,{})}),e.jsx(He,{path:"debts",element:e.jsx(ga,{})}),e.jsx(He,{path:"staff-receipts",element:e.jsx(ba,{})})]}),e.jsx(He,{path:"/helper",element:e.jsx(Wt,{roles:["helper"],children:e.jsx(ol,{})}),children:e.jsx(He,{index:!0,element:e.jsx(cl,{})})})]})]})})})}fr.createRoot(document.getElementById("root")).render(e.jsx(ot.StrictMode,{children:e.jsx(Pl,{})}))});export default zl();
