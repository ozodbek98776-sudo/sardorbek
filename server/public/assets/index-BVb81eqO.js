const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/qrcode-vendor-DgV9WI2I.js","assets/vendor-CYQBVhcl.js"])))=>i.map(i=>d[i]);
var Ba=Object.defineProperty,Oa=Object.defineProperties;var Fa=Object.getOwnPropertyDescriptors;var ma=Object.getOwnPropertySymbols;var Ka=Object.prototype.hasOwnProperty,Ua=Object.prototype.propertyIsEnumerable;var Ft=(t,l,r)=>l in t?Ba(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,v=(t,l)=>{for(var r in l||(l={}))Ka.call(l,r)&&Ft(t,r,l[r]);if(ma)for(var r of ma(l))Ua.call(l,r)&&Ft(t,r,l[r]);return t},k=(t,l)=>Oa(t,Fa(l));var Xa=(t,l)=>()=>(l||t((l={exports:{}}).exports,l),l.exports);var Ct=(t,l,r)=>Ft(t,typeof l!="symbol"?l+"":l,r);var E=(t,l,r)=>new Promise((h,n)=>{var g=P=>{try{p(r.next(P))}catch($){n($)}},N=P=>{try{p(r.throw(P))}catch($){n($)}},p=P=>P.done?h(P.value):Promise.resolve(P.value).then(g,N);p((r=r.apply(t,l)).next())});import{r as s,j as e,u as Es,b as st,U as is,L as ys,E as $t,c as Xs,d as Gt,B as Ha,S as wt,P as Qs,M as kt,X as be,N as Ya,e as Zs,f as It,g as ga,h as hs,i as Oe,k as Os,C as Us,l as Zt,m as _t,n as Ls,O as Bt,o as ja,p as ct,q as fs,H as ea,s as Ws,F as Hs,t as sa,v as Xt,D as os,T as ta,w as Wa,x as Rs,y as Ht,z as Ja,G as Tt,I as it,J as qs,K as aa,Q as Va,V as Yt,W as ra,Y as Ga,Z as Rt,_ as dt,$ as ps,a0 as Ps,a1 as va,a2 as et,a3 as gt,a4 as Za,a5 as Na,a6 as yt,a7 as vt,a8 as xa,a9 as Qt,aa as na,ab as Bs,ac as Wt,ad as Et,ae as Gs,af as er,ag as ua,ah as wa,ai as sr,aj as tr,ak as Pt,al as ar,am as la,an as rr,ao as ya,ap as ka,aq as nr,ar as Ys,as as lr,at as ir,au as or,av as ha,aw as cr,ax as dr,ay as mr,az as xr,aA as ur,aB as hr,aC as Ge,R as nt,aD as Js,aE as pr}from"./react-vendor-CyoQa8fp.js";import{a as Sa}from"./http-vendor-DnTtldoj.js";import{R as fr,A as br,C as gr,X as jr,Y as vr,T as Nr,a as wr}from"./chart-vendor-CLMpGT3-.js";import{t as ia,H as yr}from"./qrcode-vendor-DgV9WI2I.js";import{an as kr}from"./vendor-CYQBVhcl.js";var zn=Xa(es=>{(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))h(n);new MutationObserver(n=>{for(const g of n)if(g.type==="childList")for(const N of g.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&h(N)}).observe(document,{childList:!0,subtree:!0});function r(n){const g={};return n.integrity&&(g.integrity=n.integrity),n.referrerPolicy&&(g.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?g.credentials="include":n.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function h(n){if(n.ep)return;n.ep=!0;const g=r(n);fetch(n.href,g)}})();const Vs=class Vs{constructor(){Ct(this,"isOnline",navigator.onLine);Ct(this,"listeners",new Set);this.setupEventListeners()}static getInstance(){return Vs.instance||(Vs.instance=new Vs),Vs.instance}setupEventListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.notifyListeners()}),window.addEventListener("offline",()=>{this.isOnline=!1,this.notifyListeners()})}notifyListeners(){this.listeners.forEach(l=>l(this.isOnline))}getOnlineStatus(){return this.isOnline}addListener(l){return this.listeners.add(l),()=>this.listeners.delete(l)}static isServerOfflineError(l){if(!(l!=null&&l.response))return!1;const{status:r,data:h}=l.response;return r===503&&(h==null?void 0:h.offline)===!0}static getOfflineMessage(l){return this.isServerOfflineError(l)?l.response.data.message||"Server is currently offline. Please try again later.":"Network error occurred. Please check your connection."}};Ct(Vs,"instance");let Dt=Vs;Dt.getInstance();const oa="http://localhost:8000/api",Sr="http://localhost:5173",Ca=oa,Ts=oa.replace("/api",""),ca=Sr;console.log("API Base URL:",Ca);console.log("Uploads URL:",Ts);console.log("Environment:","Production");console.log("envApiUrl:",oa);const F=Sa.create({baseURL:Ca,headers:{"Content-Type":"application/json"},timeout:6e4});F.interceptors.request.use(t=>{var r;const l=localStorage.getItem("token");return l&&(t.headers.Authorization=`Bearer ${l}`),(r=t.url)!=null&&r.includes("/products")&&(t.timeout=12e4),t.headers["Cache-Control"]="no-cache, no-store, must-revalidate",t.headers.Pragma="no-cache",t.headers.Expires="0",t});F.interceptors.response.use(t=>t,t=>{var l,r,h;return((l=t.response)==null?void 0:l.status)===304?(console.warn("304 Not Modified - cache muammosi, qayta urinish kerak"),Promise.reject(new Error("Cache error - please refresh"))):t.code==="ERR_NETWORK"||t.message==="Network Error"?(console.error("ðŸ”´ Server bilan aloqa yo'q - localhost:8000 ishlamayapti"),Promise.reject(new Error("Server bilan aloqa yo'q. Iltimos, serverni ishga tushiring."))):t.code==="ECONNREFUSED"?(console.error("ðŸ”´ Connection refused - server port 8000 da ishlamayapti"),Promise.reject(new Error("Server ishlamayapti. Iltimos, serverni ishga tushiring."))):Dt.isServerOfflineError(t)?(console.warn("Server is offline:",t.response.data.message),Promise.reject(t)):(((r=t.response)==null?void 0:r.status)===401&&(console.warn("401 Unauthorized - token yaroqsiz"),localStorage.removeItem("token"),window.location.pathname.includes("/login")||(window.location.href="/login")),t.code==="ECONNABORTED"&&console.error("â±ï¸ Request timeout:",(h=t.config)==null?void 0:h.url),Promise.reject(t))});const qa=s.createContext(void 0),Cr=({children:t})=>{const[l,r]=s.useState(null),[h,n]=s.useState(!0);s.useEffect(()=>{localStorage.getItem("token")?((j=3,M=1e3)=>E(es,null,function*(){var T,D;for(let c=0;c<j;c++)try{const z=yield F.get("/auth/me",{timeout:5e3});r(z.data),n(!1);return}catch(z){if(console.warn(`User fetch attempt ${c+1}/${j} failed:`,z.message),c===j-1||((T=z.response)==null?void 0:T.status)===401||((D=z.response)==null?void 0:D.status)===403){console.error("Failed to fetch user after retries, clearing token"),localStorage.removeItem("token"),n(!1);return}yield new Promise(S=>setTimeout(S,M*(c+1)))}}))():n(!1)},[]);const g=($,w)=>E(es,null,function*(){const j=yield F.post("/auth/login",{phone:$,password:w});localStorage.setItem("token",j.data.token),r(j.data.user)}),N=($,w)=>E(es,null,function*(){const j=yield F.post("/auth/login",{login:$,password:w});localStorage.setItem("token",j.data.token),r(j.data.user)}),p=()=>{localStorage.removeItem("token"),r(null)},P=$=>{r($)};return e.jsx(qa.Provider,{value:{user:l,loading:h,login:g,loginWithCredentials:N,logout:p,updateUser:P},children:t})},tt=()=>{const t=s.useContext(qa);if(!t)throw new Error("useAuth must be used within AuthProvider");return t},Pa=s.createContext(void 0),qr={uz:{"login.title":"Sardorbek.Furnetura","login.subtitle":"Professional Biznes Boshqaruv Tizimi","login.secure":"Xavfsiz va Ishonchli","login.welcome":"Xush kelibsiz","login.description":"Davom etish uchun hisobingizga kiring","login.phone":"Telefon raqam","login.password":"Parol","login.passwordPlaceholder":"Parolingizni kiriting","login.signing":"Kirilmoqda...","login.signin":"Kirish","login.error":"Kirish xatosi","sidebar.statistics":"Statistika","sidebar.products":"Tovarlar","sidebar.warehouses":"Omborlar","sidebar.customers":"Mijozlar","sidebar.debts":"Qarz daftarcha","sidebar.orders":"Buyurtmalar","sidebar.helpers":"Yordamchilar","sidebar.settings":"Sozlamalar","sidebar.pos":"Kassa (POS)","sidebar.receipts":"Xodimlar cheklari","sidebar.aiAssistant":"AI Yordamchi","sidebar.signout":"Chiqish","sidebar.editProfile":"Profilni tahrirlash","sidebar.fullName":"To'liq ism","sidebar.namePlaceholder":"Ismingizni kiriting","sidebar.phoneNumber":"Telefon raqam","sidebar.newPassword":"Yangi parol (Ixtiyoriy)","sidebar.passwordHint":"Joriy parolni saqlash uchun bo'sh qoldiring","sidebar.cancel":"Bekor qilish","sidebar.saveChanges":"O'zgarishlarni saqlash","dashboard.title":"Statistika paneli","dashboard.overview":"Biznes ko'rsatkichlari","dashboard.description":"Biznesingizning ishlashi va asosiy ko'rsatkichlarini kuzating","dashboard.totalRevenue":"Umumiy daromad","dashboard.todaySales":"Bugungi savdo","dashboard.weeklySales":"Haftalik savdo","dashboard.totalOrders":"Jami buyurtmalar","dashboard.peakHour":"Eng yuqori soat","dashboard.today":"Bugun","dashboard.thisWeek":"Bu hafta","dashboard.refresh":"Ma'lumotlarni yangilash","dashboard.totalProducts":"Jami mahsulotlar","dashboard.lowStock":"Kam qolgan","dashboard.outOfStock":"Tugagan","dashboard.inventoryStatus":"Ombor holati","dashboard.currentStock":"Joriy zaxira ko'rinishi","dashboard.liveData":"Jonli ma'lumotlar","header.search":"Qidirish...","header.live":"Jonli","common.loading":"Yuklanmoqda...","common.error":"Xatolik yuz berdi","common.success":"Muvaffaqiyatli","common.save":"Saqlash","common.cancel":"Bekor qilish","common.delete":"O'chirish","common.edit":"Tahrirlash","common.add":"Qo'shish","common.close":"Yopish"}},Pr=({children:t})=>{const[l,r]=s.useState("uz");s.useEffect(()=>{document.documentElement.lang="uz"},[]);const h=n=>qr.uz[n]||n;return e.jsx(Pa.Provider,{value:{language:l,setLanguage:r,t:h},children:t})},Ot=()=>{const t=s.useContext(Pa);if(t===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return t};function zr(){var c;const[t,l]=s.useState(""),[r,h]=s.useState(""),[n,g]=s.useState(!1),[N,p]=s.useState(""),[P,$]=s.useState(!1),{loginWithCredentials:w}=tt(),j=Es(),T=(c=st().state)==null?void 0:c.message,D=z=>E(this,null,function*(){var S,q;z.preventDefault(),p(""),$(!0);try{yield w(t,r);const R=(yield F.get("/auth/me")).data;R.role==="admin"?j("/admin",{replace:!0}):R.role==="cashier"?j("/kassa",{replace:!0}):R.role==="helper"?j("/helper",{replace:!0}):j("/",{replace:!0})}catch(f){p(((q=(S=f.response)==null?void 0:S.data)==null?void 0:q.message)||"Login yoki parol noto'g'ri"),$(!1)}});return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(109, 40, 217, 0.15) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute top-1/4 right-1/4 w-64 h-64 rounded-full blur-2xl",style:{background:"radial-gradient(circle, rgba(6, 182, 212, 0.1) 0%, transparent 70%)"}})]}),e.jsxs("div",{className:"w-full max-w-sm relative z-10",children:[e.jsxs("div",{className:"text-center mb-6 animate-fade-up",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{background:"linear-gradient(135deg, #2e1065 0%, #5b21b6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Sardor Furnitura"}),e.jsx("p",{className:"font-medium",style:{color:"#71717a"},children:"Admin boshqaruv tizimi"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full animate-pulse",style:{background:"#22c55e"}}),e.jsx("span",{className:"text-sm",style:{color:"#a1a1aa"},children:"Xavfsiz kirish"})]})]}),e.jsxs("div",{className:"rounded-2xl p-6 animate-fade-up",style:{background:"linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 20px 40px -12px rgba(109, 40, 217, 0.2)",backdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-1",style:{color:"#2e1065"},children:"Xush kelibsiz!"}),e.jsx("p",{style:{color:"#71717a"},children:"Login va parolingizni kiriting"})]}),T&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)",border:"1px solid #86efac"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#22c55e"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"âœ“"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#166534"},children:"Muvaffaqiyat"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#15803d"},children:T})]})]})}),N&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)",border:"1px solid #fca5a5"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#ef4444"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#991b1b"},children:"Xatolik"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#b91c1c"},children:N})]})]})}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(is,{className:"w-3.5 h-3.5"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(is,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:"text",placeholder:"Loginingizni kiriting",value:t,onChange:z=>l(z.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl transition-all duration-200 focus:outline-none text-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ys,{className:"w-3.5 h-3.5"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ys,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:n?"text":"password",placeholder:"Parolingizni kiriting",value:r,onChange:z=>h(z.target.value),className:"w-full pl-10 pr-10 py-3 rounded-xl transition-all duration-200 focus:outline-none text-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0}),e.jsx("button",{type:"button",onClick:()=>g(!n),className:"absolute inset-y-0 right-0 pr-3 flex items-center transition-colors",style:{color:"#a1a1aa"},children:n?e.jsx($t,{className:"w-4 h-4"}):e.jsx(Xs,{className:"w-4 h-4"})})]})]}),e.jsx("button",{type:"submit",disabled:P,className:"w-full text-white font-semibold py-3.5 px-4 rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 14px -2px rgba(124, 58, 237, 0.4)"},children:P?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Kirish..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Kirish"}),e.jsx(Gt,{className:"w-4 h-4 transition-transform group-hover:translate-x-1"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("div",{className:"p-3 rounded-xl",style:{background:"linear-gradient(135deg, #cffafe 0%, #a5f3fc 100%)",border:"1px solid rgba(6, 182, 212, 0.3)"},children:[e.jsx("p",{className:"text-xs font-medium mb-1",style:{color:"#155e75"},children:"Kassa paneli:"}),e.jsx("button",{onClick:()=>j("/kassa-login"),className:"text-sm font-semibold underline transition-colors",style:{color:"#0891b2"},children:"Kassa tizimiga kirish â†’"})]})})]}),e.jsxs("div",{className:"text-center mt-6 animate-fade-up",children:[e.jsx("p",{className:"text-sm",style:{color:"#71717a"},children:"Â© 2025 Sardor Furnitura. Barcha huquqlar himoyalangan."}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-2 text-xs",style:{color:"#a1a1aa"},children:[e.jsx("span",{children:"Xavfsiz"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Professional"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Ishonchli"})]})]})]})]})}const b=t=>{const l=typeof t=="string"?parseFloat(t):t;return isNaN(l)?"0":l.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},Je=t=>t.replace(/\./g,""),ls=t=>{const l=t.replace(/\./g,"");if(l===""||l==="-")return l;const r=parseFloat(l);return isNaN(r)?"":b(r)},ot=t=>{let r=t.replace(/\D/g,"");return!r.startsWith("998")&&r.length>0&&(r="998"+r),r=r.slice(0,12),r.length===0?"":r.length<=3?"+"+r:r.length<=5?"+998 ("+r.slice(3):r.length<=8?"+998 ("+r.slice(3,5)+") "+r.slice(5):r.length<=10?"+998 ("+r.slice(3,5)+") "+r.slice(5,8)+"-"+r.slice(8):"+998 ("+r.slice(3,5)+") "+r.slice(5,8)+"-"+r.slice(8,10)+"-"+r.slice(10)},zt=t=>t.replace(/\D/g,""),za=t=>{if(!t)return"";const l=t.replace(/\D/g,"");return l.length!==12?t:"+998 ("+l.slice(3,5)+") "+l.slice(5,8)+"-"+l.slice(8,10)+"-"+l.slice(10)};function Mr(){const[t,l]=s.useState({name:"",login:"",phone:"",password:"",confirmPassword:""}),[r,h]=s.useState(!1),[n,g]=s.useState(!1),[N,p]=s.useState(""),[P,$]=s.useState(!1),{t:w}=Ot(),j=Es(),M=D=>{const c=ot(D.target.value);l(z=>k(v({},z),{phone:c}))},T=D=>E(this,null,function*(){var c,z;if(D.preventDefault(),p(""),$(!0),t.password!==t.confirmPassword){p("Parollar mos kelmaydi"),$(!1);return}if(t.password.length<6){p("Parol kamida 6 ta belgidan iborat bo'lishi kerak"),$(!1);return}try{const S=zt(t.phone);yield F.post("/auth/register",{name:t.name,login:t.login,phone:S,password:t.password}),j("/login",{state:{message:"Admin muvaffaqiyatli yaratildi! Endi tizimga kirishingiz mumkin."}})}catch(S){p(((z=(c=S.response)==null?void 0:c.data)==null?void 0:z.message)||"Xatolik yuz berdi")}finally{$(!1)}});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 bg-gradient-to-br from-blue-400/20 to-indigo-600/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-indigo-400/20 to-purple-600/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-gradient-to-r from-blue-300/10 to-indigo-400/10 rounded-full blur-2xl"})]}),e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23e2e8f0%22%20fill-opacity%3D%220.3%22%3E%3Ccircle%20cx%3D%2230%22%20cy%3D%2230%22%20r%3D%221.5%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-40"}),e.jsxs("div",{className:"w-full max-w-md relative z-10",children:[e.jsxs("div",{className:"text-center mb-8 animate-fade-up",children:[e.jsxs("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-3xl shadow-2xl shadow-blue-500/25 mb-6 relative",children:[e.jsx(Ha,{className:"w-10 h-10 text-white"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center",children:e.jsx(wt,{className:"w-3 h-3 text-white"})})]}),e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-slate-900 via-blue-900 to-indigo-900 bg-clip-text text-transparent mb-3",children:w("login.title")}),e.jsx("p",{className:"text-slate-600 text-lg font-medium",children:w("login.subtitle")}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-slate-500",children:w("login.secure")})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/20 animate-fade-up",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Ro'yxatdan o'tish"}),e.jsx("p",{className:"text-slate-600",children:"Admin hisobini yaratish uchun ma'lumotlarni kiriting"})]}),N&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-4 mb-6 animate-fade-in",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-red-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium text-sm",children:"Xatolik"}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:N})]})]})}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4"}),"To'liq ism"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(is,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"text",placeholder:"Ismingizni kiriting",value:t.name,onChange:D=>l(c=>k(v({},c),{name:D.target.value})),className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(is,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"text",placeholder:"Login kiriting (masalan: admin123)",value:t.login,onChange:D=>l(c=>k(v({},c),{login:D.target.value})),className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(Qs,{className:"w-4 h-4"}),"Telefon raqam"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(Qs,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"tel",placeholder:"+998 (XX) XXX-XX-XX",value:t.phone,onChange:M,className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ys,{className:"w-4 h-4"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(ys,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:r?"text":"password",placeholder:"Parolingizni kiriting",value:t.password,onChange:D=>l(c=>k(v({},c),{password:D.target.value})),className:"w-full pl-12 pr-12 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!r),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 transition-colors",children:r?e.jsx($t,{className:"w-5 h-5"}):e.jsx(Xs,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ys,{className:"w-4 h-4"}),"Parolni tasdiqlash"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(ys,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:n?"text":"password",placeholder:"Parolni qayta kiriting",value:t.confirmPassword,onChange:D=>l(c=>k(v({},c),{confirmPassword:D.target.value})),className:"w-full pl-12 pr-12 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0}),e.jsx("button",{type:"button",onClick:()=>g(!n),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 transition-colors",children:n?e.jsx($t,{className:"w-5 h-5"}):e.jsx(Xs,{className:"w-5 h-5"})})]})]}),e.jsx("button",{type:"submit",disabled:P,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold py-4 px-6 rounded-2xl shadow-lg shadow-blue-500/25 transition-all duration-200 hover:from-blue-700 hover:to-indigo-700 hover:shadow-xl hover:shadow-blue-500/30 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",children:P?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Ro'yxatdan o'tilmoqda..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{children:"Ro'yxatdan o'tish"}),e.jsx(Gt,{className:"w-5 h-5 transition-transform group-hover:translate-x-1"})]})})]})]})]})]})}function Ma({items:t,basePath:l,collapsed:r=!1,setCollapsed:h}){var D;const{user:n,logout:g,updateUser:N}=tt(),{t:p}=Ot(),[P,$]=s.useState(!1),[w,j]=s.useState({name:"",phone:"",password:""}),M=()=>{j({name:(n==null?void 0:n.name)||"",phone:(n==null?void 0:n.phone)||"",password:""}),$(!0)},T=c=>E(this,null,function*(){var z,S;c.preventDefault();try{const q={name:w.name,phone:w.phone};w.password&&(q.password=w.password);const f=yield F.put("/auth/profile",q);N(f.data),$(!1)}catch(q){alert(((S=(z=q.response)==null?void 0:z.data)==null?void 0:S.message)||"Xatolik yuz berdi")}});return e.jsxs("aside",{className:`fixed left-0 top-0 h-full transition-all duration-300 ease-in-out z-50 ${r?"w-16":"w-64"}`,style:{background:"linear-gradient(180deg, #2e1065 0%, #4c1d95 100%)",borderRight:"1px solid rgba(6, 182, 212, 0.2)",boxShadow:"4px 0 24px -4px rgba(46, 16, 101, 0.3)"},children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-4",style:{borderBottom:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, transparent 100%)"},children:[!r&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center overflow-hidden",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-lg text-white tracking-wide",style:{fontFamily:"'Playfair Display', serif",letterSpacing:"0.5px"},children:"Sardor"}),e.jsx("p",{className:"text-sm font-semibold tracking-wider",style:{color:"#c4b5fd",fontFamily:"'Montserrat', sans-serif",letterSpacing:"1.5px"},children:"FURNITURA"})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:()=>h==null?void 0:h(!r),className:"p-2 rounded-xl transition-all duration-200",style:{background:"rgba(255, 255, 255, 0.1)",color:"#c4b5fd"},children:r?e.jsx(kt,{className:"w-4 h-4"}):e.jsx(be,{className:"w-4 h-4"})})})]}),e.jsx("nav",{className:"p-3 space-y-1.5 overflow-y-auto h-[calc(100vh-180px)]",children:t.map((c,z)=>e.jsxs(Ya,{to:`${l}${c.path}`,end:c.path==="",className:({isActive:S})=>`
              flex items-center gap-3 px-3 py-3 rounded-xl font-medium transition-all duration-200 group
              ${r?"justify-center px-2":""}
            `,style:({isActive:S})=>({background:S?"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)":"transparent",color:S?"#ffffff":"#c4b5fd",boxShadow:S?"0 4px 12px -2px rgba(6, 182, 212, 0.4)":"none"}),title:r?c.label:void 0,children:[e.jsx("span",{className:"flex-shrink-0 transition-transform group-hover:scale-110",children:c.icon}),!r&&e.jsx("span",{className:"truncate text-sm",children:p(c.label)})]},z))}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3",style:{borderTop:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.2) 100%)"},children:[!r&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5 mb-2 rounded-xl",style:{background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(6, 182, 212, 0.15)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{background:"linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%)"},children:e.jsx("span",{className:"text-sm font-bold text-white",children:(D=n==null?void 0:n.name)==null?void 0:D.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-white truncate",children:n==null?void 0:n.name}),e.jsx("p",{className:"text-xs capitalize font-medium",style:{color:"#a78bfa"},children:n==null?void 0:n.role})]}),(n==null?void 0:n.role)==="admin"&&e.jsx("button",{onClick:M,className:"p-1.5 rounded-lg transition-all duration-200",style:{background:"rgba(6, 182, 212, 0.2)",color:"#67e8f9"},title:"Profilni tahrirlash",children:e.jsx(Zs,{className:"w-3.5 h-3.5"})})]}),e.jsxs("button",{onClick:g,className:`flex items-center gap-2 w-full px-3 py-2.5 rounded-xl transition-all duration-200 font-medium text-sm ${r?"justify-center px-2":""}`,style:{color:"#fca5a5"},title:r?"Sign Out":void 0,children:[e.jsx(It,{className:"w-4 h-4"}),!r&&e.jsx("span",{children:p("sidebar.signout")})]})]}),P&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60]",onClick:()=>$(!1)}),e.jsx("div",{className:"fixed inset-0 z-[200] flex items-end sm:items-center justify-center p-0 sm:p-4 pointer-events-none",children:e.jsxs("div",{className:"w-full sm:w-auto max-w-md p-4 sm:p-8 rounded-t-3xl sm:rounded-3xl flex flex-col max-h-[90vh] overflow-hidden pointer-events-auto",style:{background:"linear-gradient(145deg, #ffffff 0%, #faf5ff 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 25px 50px -12px rgba(46, 16, 101, 0.35)"},children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between mb-4 sm:mb-8 pb-4 sm:pb-0 border-b border-surface-100 sm:border-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold truncate",style:{color:"#2e1065"},children:p("sidebar.editProfile")}),e.jsx("button",{onClick:()=>$(!1),className:"flex-shrink-0 p-2 rounded-xl transition-all",style:{background:"#f5f3ff",color:"#7c3aed"},children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:T,className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(is,{className:"w-4 h-4"}),p("sidebar.fullName")]}),e.jsxs("div",{className:"relative",children:[e.jsx(is,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"text",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:p("sidebar.namePlaceholder"),value:w.name,onChange:c=>j(k(v({},w),{name:c.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(Qs,{className:"w-4 h-4"}),p("sidebar.phoneNumber")]}),e.jsxs("div",{className:"relative",children:[e.jsx(Qs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"tel",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:"+998 (XX) XXX-XX-XX",value:w.phone,onChange:c=>j(k(v({},w),{phone:ot(c.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ys,{className:"w-4 h-4"}),p("sidebar.newPassword")]}),e.jsxs("div",{className:"relative",children:[e.jsx(ys,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"password",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:p("sidebar.passwordHint"),value:w.password,onChange:c=>j(k(v({},w),{password:c.target.value}))})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>$(!1),className:"flex-1 px-6 py-3.5 font-semibold rounded-2xl transition-all duration-200",style:{background:"#f5f3ff",color:"#7c3aed"},children:p("sidebar.cancel")}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3.5 text-white font-semibold rounded-2xl transition-all duration-200",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 14px -2px rgba(124, 58, 237, 0.4)"},children:p("sidebar.saveChanges")})]})]})})]})})]})]})}const $r=[{icon:e.jsx(ga,{className:"w-5 h-5"}),label:"sidebar.statistics",path:""},{icon:e.jsx(hs,{className:"w-5 h-5"}),label:"sidebar.pos",path:"/kassa"},{icon:e.jsx(Oe,{className:"w-5 h-5"}),label:"sidebar.products",path:"/products"},{icon:e.jsx(Os,{className:"w-5 h-5"}),label:"sidebar.customers",path:"/customers"},{icon:e.jsx(Us,{className:"w-5 h-5"}),label:"sidebar.debts",path:"/debts"},{icon:e.jsx(Zt,{className:"w-5 h-5"}),label:"sidebar.helpers",path:"/helpers"},{icon:e.jsx(_t,{className:"w-5 h-5"}),label:"sidebar.settings",path:"/settings"}],Tr=[{icon:e.jsx(hs,{className:"w-5 h-5"}),label:"sidebar.pos",path:""},{icon:e.jsx(Us,{className:"w-5 h-5"}),label:"sidebar.debts",path:"/debts"}];function Rr(){const t=st(),l=Es(),r=[{path:"/admin",icon:ga,label:"Bosh sahifa",exact:!0},{path:"/admin/kassa",icon:hs,label:"Kassa"},{path:"/admin/products",icon:Oe,label:"Tovarlar"},{path:"/admin/debts",icon:Ls,label:"Qarzlar"},{path:"/admin/settings",icon:_t,label:"Sozlamalar"}],h=(n,g)=>g?t.pathname===n:t.pathname.startsWith(n);return e.jsxs("nav",{className:"lg:hidden fixed bottom-0 left-0 right-0 bg-slate-100/80 backdrop-blur-2xl border-t border-slate-200/60 z-50 shadow-[0_-4px_20px_-4px_rgba(0,0,0,0.1)]",children:[e.jsx("div",{className:"grid grid-cols-5 h-[72px] max-w-lg mx-auto",children:r.map(n=>{const g=n.icon,N=h(n.path,n.exact);return e.jsxs("button",{onClick:()=>l(n.path),className:`relative flex flex-col items-center justify-center gap-0.5 transition-all duration-300 ${N?"text-blue-600":"text-slate-400 active:text-slate-600"}`,children:[N&&e.jsx("div",{className:"absolute -top-0.5 left-1/2 -translate-x-1/2 w-8 h-1 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full"}),e.jsx("div",{className:`p-2 rounded-2xl transition-all duration-300 ${N?"bg-gradient-to-br from-blue-50 to-indigo-50 shadow-sm":"hover:bg-slate-50"}`,children:e.jsx(g,{className:`w-5 h-5 transition-all duration-300 ${N?"scale-110 text-blue-600":""}`})}),e.jsx("span",{className:`text-[10px] font-semibold transition-all duration-300 ${N?"text-blue-600":"text-slate-500"}`,children:n.label})]},n.path)})}),e.jsx("div",{className:"h-safe-area-inset-bottom bg-slate-100/80"})]})}function Qr(){const[t,l]=s.useState(!1);return e.jsxs("div",{className:"min-h-screen",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(Ma,{items:$r,basePath:"/admin",collapsed:t,setCollapsed:l})}),e.jsx("main",{className:`
        transition-all duration-300 ease-smooth
        lg:ml-64
        ${t?"lg:ml-[72px]":"lg:ml-64"}
        
        /* Mobile bottom navigation space */
        2xs:pb-[88px] xs:pb-[88px] sm:pb-[88px] md:pb-0
        
        /* Responsive min-height */
        min-h-screen
      `,children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(Bt,{})})}),e.jsx(Rr,{})]})}function Er(){const t=Es(),[l,r]=s.useState(0);s.useEffect(()=>{h();const g=setInterval(h,3e4);return()=>clearInterval(g)},[]);const h=()=>E(this,null,function*(){try{const g=yield F.get("/debts?status=pending_approval");r(g.data.length)}catch(g){console.error("Error fetching pending debts count:",g)}}),n=()=>{t("/admin/debt-approvals")};return l===0?null:e.jsx("div",{className:"relative",children:e.jsxs("button",{onClick:n,className:"relative p-2 rounded-xl bg-amber-100 text-amber-600 hover:bg-amber-200 transition-colors",title:`${l} ta qarz tasdiqlashni kutmoqda`,children:[e.jsx(ja,{className:"w-5 h-5"}),l>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold",children:l>9?"9+":l})]})})}function Fs({title:t,showSearch:l,onSearch:r,actions:h,filterOptions:n,filterValue:g,onFilterChange:N}){const[p,P]=s.useState(""),[$,w]=s.useState(!1),[j,M]=s.useState(!1),T=s.useRef(null),{t:D}=Ot(),{user:c,logout:z}=tt(),S=Es(),q=(c==null?void 0:c.role)==="admin",f=()=>{window.confirm("Tizimdan chiqmoqchimisiz?")&&(z(),S("/login"))};s.useEffect(()=>($?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[$]),s.useEffect(()=>{j&&T.current&&T.current.focus()},[j]);const R=J=>{P(J),r==null||r(J)},W=[{icon:ea,label:"Bosh sahifa",path:"/"},{icon:Ws,label:"Mahsulotlar",path:"/admin/products"},{icon:hs,label:"Kassa",path:"/admin/kassa"},{icon:Os,label:"Mijozlar",path:"/admin/customers"},{icon:Hs,label:"Qarzlar",path:"/admin/debts"},{icon:Ls,label:"Cheklar",path:"/admin/staff-receipts"},{icon:sa,label:"Hodimlar",path:"/admin/helpers"}];return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"sticky top-0 z-50 bg-slate-100 border-b border-slate-200/60 shadow-sm",children:e.jsxs("div",{className:"px-1.5 sm:px-3 md:px-4 lg:px-6 h-10 sm:h-12 md:h-14 flex items-center justify-between gap-1 sm:gap-2 md:gap-3 lg:gap-4",children:[e.jsx("button",{onClick:()=>w(!0),className:"lg:hidden p-0.5 rounded bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-colors active:scale-95 flex-shrink-0 flex items-center justify-center",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Menyuni ochish",children:e.jsx(kt,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1.5 md:gap-2 lg:gap-3 flex-shrink-0",children:[n&&n.length>0&&e.jsxs("div",{className:"relative hidden sm:block",children:[e.jsx("select",{value:g,onChange:J=>N==null?void 0:N(J.target.value),className:"appearance-none pl-2 sm:pl-3 pr-6 sm:pr-8 py-1.5 sm:py-2 bg-slate-50 border border-slate-200 rounded-lg text-xs sm:text-sm font-medium text-slate-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 cursor-pointer transition-all duration-200",children:n.map(J=>e.jsx("option",{value:J.value,children:J.label},J.value))}),e.jsx(ct,{className:"absolute right-1.5 sm:right-2 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-400 pointer-events-none"})]}),l&&e.jsx("button",{onClick:()=>M(!j),className:"flex items-center justify-center p-0.5 rounded bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Qidirish",children:e.jsx(fs,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),q?e.jsx(Er,{}):e.jsxs("button",{className:"relative p-0.5 sm:p-1.5 md:p-2 rounded-md sm:rounded-lg bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-all duration-200 flex-shrink-0 flex items-center justify-center",children:[e.jsx(ja,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-1.5 sm:w-2 h-1.5 sm:h-2 bg-red-500 rounded-full"})]}),h]})]})}),l&&j&&e.jsx("div",{className:"sticky top-10 sm:top-12 md:top-14 z-30 bg-slate-100 border-b border-slate-200 shadow-lg animate-fade-in",children:e.jsx("div",{className:"px-3 sm:px-4 md:px-6 py-3",children:e.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[e.jsx(fs,{className:"absolute left-3 sm:left-3.5 top-1/2 -translate-y-1/2 w-4 sm:w-5 h-4 sm:h-5 text-brand-400"}),e.jsx("input",{ref:T,type:"text",placeholder:"Qidirish...",value:p,onChange:J=>R(J.target.value),className:"w-full h-11 sm:h-12 pl-10 sm:pl-11 pr-10 sm:pr-11 rounded-xl border-2 border-slate-200 focus:border-brand-400 focus:ring-4 focus:ring-brand-100 focus:bg-white transition-all duration-200 text-sm sm:text-base text-slate-900 placeholder:text-slate-400 bg-white shadow-sm hover:border-brand-300"}),e.jsx("button",{onClick:()=>{M(!1),P(""),r==null||r("")},className:"absolute right-3 sm:right-3.5 top-1/2 -translate-y-1/2 w-7 h-7 flex items-center justify-center rounded-full bg-slate-100 hover:bg-slate-200 transition-colors",children:e.jsx(be,{className:"w-4 h-4 text-slate-500"})})]})})}),$&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>w(!1)}),e.jsxs("div",{className:"fixed top-0 left-0 bottom-0 w-80 max-w-[85vw] bg-white z-[80] shadow-2xl animate-slide-in-left",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-8 h-8 rounded-lg border-2 border-white/30"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-brand-100 text-xs",children:"Mebel furniturasi"})]})]}),e.jsx("button",{onClick:()=>w(!1),className:"w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center hover:bg-white/30 transition-colors",children:e.jsx(be,{className:"w-5 h-5 text-white"})})]})}),e.jsxs("div",{className:"overflow-y-auto h-[calc(100vh-140px)] p-4",children:[e.jsx("div",{className:"space-y-1",children:W.map((J,de)=>{const xe=J.icon;return e.jsxs("button",{onClick:()=>{S(J.path),w(!1)},className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-surface-50 transition-colors group",children:[e.jsx("div",{className:"w-11 h-11 bg-surface-100 rounded-xl flex items-center justify-center group-hover:bg-brand-50 group-hover:scale-110 transition-all",children:e.jsx(xe,{className:"w-5 h-5 text-surface-600 group-hover:text-brand-600"})}),e.jsx("span",{className:"font-medium text-surface-900 group-hover:text-brand-600 transition-colors",children:J.label}),e.jsx(Xt,{className:"w-4 h-4 text-surface-300 ml-auto group-hover:text-brand-600 group-hover:translate-x-1 transition-all"})]},de)})}),e.jsxs("div",{className:"mt-6 p-4 bg-surface-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-surface-500 text-center mb-2",children:(c==null?void 0:c.name)||"Foydalanuvchi"}),e.jsx("p",{className:"text-xs text-surface-400 text-center mb-4",children:new Date().toLocaleDateString("uz-UZ",{year:"numeric",month:"long",day:"numeric"})}),e.jsxs("button",{onClick:f,className:"w-full flex items-center justify-center gap-2 p-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-xl transition-colors",children:[e.jsx(It,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Chiqish"})]})]})]})]})]})]})}function Dr(){const[t,l]=s.useState("today"),{t:r}=Ot(),[h,n]=s.useState({totalRevenue:0,todaySales:0,weekSales:0,monthSales:0,totalReceipts:0,totalProducts:0,lowStock:0,outOfStock:0,peakHour:""}),[g,N]=s.useState([]),[p,P]=s.useState([]),[$,w]=s.useState(!0);s.useEffect(()=>{j(),M()},[]),s.useEffect(()=>{T()},[t]);const j=()=>E(this,null,function*(){try{const c=yield F.get("/stats");n(c.data)}catch(c){console.error("Error fetching stats:",c)}finally{w(!1)}}),M=()=>E(this,null,function*(){try{const z=(yield F.get("/stats/top-products")).data.slice(0,3);P(z)}catch(c){console.error("Error fetching top products:",c)}}),T=()=>E(this,null,function*(){try{const c=yield F.get(`/stats/chart?period=${t}`);N(c.data)}catch(c){console.error("Error fetching chart data:",c)}}),D=[{icon:os,label:"Umumiy daromad",value:b(h.totalRevenue||0),suffix:"UZS",color:"from-emerald-500 to-emerald-600",accentColor:"bg-emerald-500",iconBg:"bg-emerald-100",iconColor:"text-emerald-600",textColor:"text-emerald-600",trend:"+12.5%",trendUp:!0},{icon:ta,label:t==="today"?"Bugungi savdo":"Haftalik savdo",value:b(t==="today"?h.todaySales||0:h.weekSales||0),suffix:"UZS",color:"from-blue-500 to-blue-600",accentColor:"bg-blue-500",iconBg:"bg-blue-100",iconColor:"text-blue-600",textColor:"text-blue-600",trend:"+8.2%",trendUp:!0},{icon:hs,label:"Jami buyurtmalar",value:(h.totalReceipts||0).toString(),color:"from-purple-500 to-purple-600",accentColor:"bg-purple-500",iconBg:"bg-purple-100",iconColor:"text-purple-600",textColor:"text-purple-600",trend:"+15.3%",trendUp:!0},{icon:Wa,label:"Eng yuqori soat",value:h.peakHour||"-",color:"from-orange-500 to-orange-600",accentColor:"bg-orange-500",iconBg:"bg-orange-100",iconColor:"text-orange-600",textColor:"text-orange-600",trend:"",trendUp:!0}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100",children:[e.jsx(Fs,{title:r("dashboard.title")}),e.jsxs("div",{className:"py-4 sm:py-5 md:py-6 space-y-4 sm:space-y-5 md:space-y-6 pb-24 lg:pb-8",children:[e.jsxs("div",{className:"px-4 sm:px-6 md:px-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 animate-fade-in",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-extrabold bg-gradient-to-r from-purple-900 via-purple-700 to-purple-600 bg-clip-text text-transparent leading-tight",children:r("dashboard.overview")}),e.jsx("p",{className:"text-slate-600 text-xs sm:text-sm font-medium",children:r("dashboard.description")})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex p-1 bg-white/90 backdrop-blur-xl rounded-xl shadow-lg border border-white/20",children:[e.jsx("button",{onClick:()=>l("today"),className:`px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all duration-300 ${t==="today"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/30":"text-slate-600 hover:text-slate-900 hover:bg-slate-50/50"}`,children:r("dashboard.today")}),e.jsx("button",{onClick:()=>l("week"),className:`px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all duration-300 ${t==="week"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/30":"text-slate-600 hover:text-slate-900 hover:bg-slate-50/50"}`,children:r("dashboard.thisWeek")})]}),e.jsx("button",{onClick:j,className:"p-2.5 sm:p-3 rounded-xl bg-white/90 backdrop-blur-xl border border-white/20 text-slate-600 hover:text-slate-900 hover:bg-white transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 active:scale-95",title:r("dashboard.refresh"),children:e.jsx(Rs,{className:`w-4 h-4 sm:w-5 sm:h-5 ${$?"animate-spin":""}`})})]})]}),$?e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:[1,2,3,4].map(c=>e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-xl sm:rounded-2xl p-3 sm:p-4 md:p-5 shadow-xl border border-slate-200/50 overflow-hidden min-h-[140px] sm:min-h-[160px] md:min-h-[180px]",children:[e.jsxs("div",{className:"animate-pulse space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 bg-gradient-to-br from-slate-200 to-slate-300 rounded-lg sm:rounded-xl"}),e.jsx("div",{className:"w-10 sm:w-12 h-4 sm:h-5 bg-gradient-to-br from-slate-200 to-slate-300 rounded-lg"})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx("div",{className:"h-6 sm:h-8 bg-gradient-to-br from-slate-200 to-slate-300 rounded-lg w-3/4"}),e.jsx("div",{className:"h-3 sm:h-4 bg-gradient-to-br from-slate-200 to-slate-300 rounded w-1/2"})]})]}),e.jsx("div",{className:"absolute inset-0 -translate-x-full animate-[shimmer_2s_infinite] bg-gradient-to-r from-transparent via-white/20 to-transparent"})]},c))})}):e.jsx("div",{children:e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:D.map((c,z)=>e.jsx("div",{className:"group relative animate-slide-up",style:{animationDelay:`${z*100}ms`},children:e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-xl sm:rounded-2xl p-3 sm:p-4 md:p-5 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] overflow-hidden min-h-[140px] sm:min-h-[160px] md:min-h-[180px] flex flex-col border border-slate-200/50",children:[e.jsx("div",{className:`absolute top-0 left-0 right-0 h-0.5 sm:h-1 ${c.accentColor}`}),e.jsxs("div",{className:"flex items-start justify-between mb-auto",children:[e.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 rounded-lg sm:rounded-xl md:rounded-2xl ${c.iconBg} flex items-center justify-center flex-shrink-0`,children:e.jsx(c.icon,{className:`w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7 ${c.iconColor}`})}),c.trend&&e.jsxs("div",{className:`flex items-center gap-0.5 px-1.5 sm:px-2 py-0.5 rounded-md sm:rounded-lg text-[9px] sm:text-[10px] md:text-xs font-bold ${c.trendUp?"bg-emerald-50 text-emerald-700":"bg-red-50 text-red-700"}`,children:[c.trendUp?e.jsx(Ht,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"}):e.jsx(Ja,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"}),e.jsx("span",{children:c.trend})]})]}),e.jsxs("div",{className:"mt-auto space-y-0.5 sm:space-y-1",children:[e.jsxs("div",{className:"flex items-baseline gap-0.5 sm:gap-1 flex-wrap",children:[e.jsx("h3",{className:`text-base sm:text-xl md:text-2xl lg:text-3xl font-bold ${c.textColor} leading-none tracking-tight`,children:c.value}),c.suffix&&e.jsx("span",{className:"text-[7px] sm:text-[8px] md:text-[9px] font-semibold text-slate-400 uppercase",children:c.suffix})]}),e.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs font-medium text-slate-600 leading-tight line-clamp-2",children:c.label})]})]})},z))})})}),e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 sm:gap-5 md:gap-6",children:[e.jsx("div",{className:"xl:col-span-2 relative group animate-slide-up",style:{animationDelay:"400ms"},children:e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 shadow-xl border border-slate-200/50 hover:shadow-2xl transition-all duration-500 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/40 via-transparent to-slate-50/40 opacity-60"}),e.jsxs("div",{className:"relative z-10 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-500 rounded-2xl blur-lg opacity-30"}),e.jsx("div",{className:"relative w-14 h-14 sm:w-16 sm:h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg",children:e.jsx(Tt,{className:"w-7 h-7 sm:w-8 sm:h-8 text-white"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-slate-900 mb-1",children:t==="today"?"Bugungi daromad":"Haftalik daromad"}),e.jsx("p",{className:"text-sm sm:text-base text-slate-500 font-medium",children:t==="today"?"Soatlik taqsimot":"Kunlik ko'rsatkichlar"})]})]}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-50 rounded-xl border border-blue-100",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-bold text-blue-700",children:"Savdo"})]})]}),e.jsx("div",{className:"relative z-10 h-64 sm:h-72 md:h-80 rounded-2xl overflow-hidden bg-gradient-to-br from-slate-50/50 to-white/50 p-4",children:g.length>0?e.jsx(fr,{width:"100%",height:"100%",children:e.jsxs(br,{data:g,margin:{top:10,right:10,left:-20,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorSales",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.4}),e.jsx("stop",{offset:"50%",stopColor:"#3b82f6",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.05})]})}),e.jsx(gr,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1,strokeOpacity:.5}),e.jsx(jr,{dataKey:"date",stroke:"#94a3b8",fontSize:12,tickLine:!1,axisLine:{stroke:"#cbd5e1",strokeWidth:2},tick:{fill:"#64748b",fontWeight:600},dy:8}),e.jsx(vr,{stroke:"#94a3b8",fontSize:12,tickLine:!1,axisLine:{stroke:"#cbd5e1",strokeWidth:2},tick:{fill:"#64748b",fontWeight:600},dx:-5,tickFormatter:c=>`${(c/1e3).toFixed(0)}k`}),e.jsx(Nr,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.98)",border:"none",borderRadius:"16px",boxShadow:"0 20px 40px -12px rgba(0, 0, 0, 0.2)",padding:"12px 16px",backdropFilter:"blur(10px)"},labelStyle:{color:"#0f172a",fontWeight:700,marginBottom:"6px",fontSize:"13px"},itemStyle:{color:"#3b82f6",fontWeight:600,fontSize:"14px"},formatter:c=>[`${b(c)} so'm`,"Daromad"],cursor:{stroke:"#3b82f6",strokeWidth:2,strokeDasharray:"5 5",strokeOpacity:.5}}),e.jsx(wr,{type:"monotone",dataKey:"sales",stroke:"#3b82f6",strokeWidth:3,fill:"url(#colorSales)",dot:{fill:"#3b82f6",strokeWidth:2,stroke:"#fff",r:4},activeDot:{r:6,fill:"#3b82f6",stroke:"#fff",strokeWidth:3,filter:"drop-shadow(0 4px 6px rgba(59, 130, 246, 0.4))"},animationDuration:1200,animationEasing:"ease-in-out"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-200 rounded-3xl blur-2xl opacity-40"}),e.jsx("div",{className:"relative w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-slate-100 to-slate-200 rounded-3xl flex items-center justify-center shadow-lg",children:e.jsx(Tt,{className:"w-10 h-10 sm:w-12 sm:h-12 text-slate-400"})})]}),e.jsx("p",{className:"font-bold text-slate-700 text-lg mb-2",children:"Ma'lumot mavjud emas"}),e.jsx("p",{className:"text-slate-500 text-sm text-center max-w-xs",children:"Analitikani ko'rish uchun savdo qilishni boshlang"})]})})]})}),e.jsx("div",{className:"relative group animate-slide-up",style:{animationDelay:"500ms"},children:e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 shadow-xl border border-slate-200/50 hover:shadow-2xl transition-all duration-500 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-50/40 via-transparent to-pink-50/40 opacity-60"}),e.jsx("div",{className:"relative z-10 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-purple-500 rounded-2xl blur-lg opacity-30"}),e.jsx("div",{className:"relative w-14 h-14 sm:w-16 sm:h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg",children:e.jsx(Oe,{className:"w-7 h-7 sm:w-8 sm:h-8 text-white"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-slate-900 mb-1",children:"Top mahsulotlar"}),e.jsx("p",{className:"text-sm sm:text-base text-slate-500 font-medium",children:"Eng ko'p sotilganlar"})]})]})}),e.jsx("div",{className:"relative z-10",children:p.length>0?e.jsx("div",{className:"space-y-3 sm:space-y-4",children:p.map((c,z)=>e.jsxs("div",{className:"group/item flex items-center gap-3 sm:gap-4 p-4 sm:p-5 bg-gradient-to-r from-slate-50 to-white rounded-xl sm:rounded-2xl border border-slate-200 hover:border-purple-200 hover:shadow-lg transition-all duration-300 cursor-pointer",children:[e.jsx("div",{className:`flex-shrink-0 w-11 h-11 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center font-bold text-base sm:text-lg shadow-lg transition-transform group-hover/item:scale-110 ${z===0?"bg-gradient-to-br from-yellow-400 to-yellow-500 text-white":z===1?"bg-gradient-to-br from-slate-300 to-slate-400 text-white":"bg-gradient-to-br from-orange-300 to-orange-400 text-white"}`,children:z+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-slate-900 text-sm sm:text-base truncate mb-1",children:c._id}),e.jsxs("p",{className:"text-xs sm:text-sm text-slate-500 font-medium",children:[c.totalSold," ta sotildi"]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"font-bold text-purple-600 text-base sm:text-lg",children:b(c.revenue)}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-400 font-semibold",children:"so'm"})]})]},c._id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-56 sm:h-64",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-200 rounded-3xl blur-2xl opacity-40"}),e.jsx("div",{className:"relative w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-slate-100 to-slate-200 rounded-3xl flex items-center justify-center shadow-lg",children:e.jsx(it,{className:"w-10 h-10 sm:w-12 sm:h-12 text-slate-400"})})]}),e.jsx("p",{className:"font-bold text-slate-700 text-lg mb-2",children:"Ma'lumot yo'q"}),e.jsx("p",{className:"text-slate-500 text-sm text-center max-w-xs",children:"Hali sotuvlar amalga oshirilmagan"})]})})]})})]})})]})]})}const Ar="modulepreload",Lr=function(t){return"/"+t},pa={},Ir=function(l,r,h){let n=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const N=document.querySelector("meta[property=csp-nonce]"),p=(N==null?void 0:N.nonce)||(N==null?void 0:N.getAttribute("nonce"));n=Promise.allSettled(r.map(P=>{if(P=Lr(P),P in pa)return;pa[P]=!0;const $=P.endsWith(".css"),w=$?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${P}"]${w}`))return;const j=document.createElement("link");if(j.rel=$?"stylesheet":Ar,$||(j.as="script"),j.crossOrigin="",j.href=P,p&&j.setAttribute("nonce",p),document.head.appendChild(j),$)return new Promise((M,T)=>{j.addEventListener("load",M),j.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${P}`)))})}))}function g(N){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=N,window.dispatchEvent(p),!p.defaultPrevented)throw N}return n.then(N=>{for(const p of N||[])p.status==="rejected"&&g(p.reason);return l().catch(g)})};function _r({isOpen:t,onClose:l,onConfirm:r,title:h,message:n,type:g="info",confirmText:N="OK",cancelText:p="Bekor qilish",showCancel:P=!1,autoClose:$=!1,autoCloseDelay:w=2e3}){const j=s.useRef(null);if(s.useEffect(()=>{if(t&&$&&(g==="success"||g==="info")){const c=setTimeout(()=>{r?r():l()},w);return()=>clearTimeout(c)}},[t,$,w,g,r,l]),s.useEffect(()=>{var c;if(t){(c=j.current)==null||c.focus();const z=S=>{S.key==="Enter"&&(S.preventDefault(),r?r():l()),S.key==="Escape"&&l()};return window.addEventListener("keydown",z),()=>window.removeEventListener("keydown",z)}},[t,r,l]),!t)return null;const M={info:e.jsx(Va,{className:"w-10 h-10 text-blue-600"}),success:e.jsx(aa,{className:"w-10 h-10 text-emerald-600"}),warning:e.jsx(qs,{className:"w-10 h-10 text-amber-600"}),danger:e.jsx(qs,{className:"w-10 h-10 text-red-600"})},T={info:"bg-gradient-to-br from-blue-50 via-blue-50 to-indigo-50 border-blue-200",success:"bg-gradient-to-br from-emerald-50 via-green-50 to-teal-50 border-emerald-300",warning:"bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 border-amber-200",danger:"bg-gradient-to-br from-red-50 via-rose-50 to-pink-50 border-red-200"},D={info:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/30 hover:shadow-xl hover:shadow-blue-500/40",success:"bg-gradient-to-r from-emerald-500 via-green-500 to-teal-500 hover:from-emerald-600 hover:via-green-600 hover:to-teal-600 text-white shadow-lg shadow-emerald-500/30 hover:shadow-xl hover:shadow-emerald-500/40",warning:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white shadow-lg shadow-amber-500/30 hover:shadow-xl hover:shadow-amber-500/40",danger:"bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-white shadow-lg shadow-red-500/30 hover:shadow-xl hover:shadow-red-500/40"};return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-4 sm:p-6",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm -z-10 transition-opacity duration-100",onClick:l,style:{animation:"fadeIn 0.1s ease-out"}}),e.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-3xl w-full sm:w-auto sm:min-w-[480px] sm:max-w-xl md:max-w-2xl p-6 sm:p-8 md:p-10 shadow-2xl relative z-10 border border-slate-200/50",style:{animation:"modalSlideUp 0.1s ease-out",willChange:"transform, opacity"},children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 sm:top-5 sm:right-5 p-2 sm:p-2.5 rounded-xl text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition-all",children:e.jsx(be,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsxs("div",{className:"flex flex-col items-center text-center mb-6 sm:mb-8",children:[e.jsx("div",{className:`w-16 h-16 sm:w-20 sm:h-20 ${T[g]} rounded-2xl flex items-center justify-center mb-4 sm:mb-6 border shadow-sm`,children:M[g]}),e.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-bold text-slate-900 mb-2 sm:mb-3 px-2",children:h}),e.jsx("p",{className:"text-sm sm:text-base md:text-lg text-slate-600 leading-relaxed max-w-md px-2",children:n})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3 sm:gap-4",children:[P&&e.jsx("button",{onClick:l,className:"flex-1 px-4 sm:px-5 md:px-6 py-3 sm:py-3.5 md:py-4 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all duration-200 text-sm sm:text-base",children:p}),e.jsx("button",{ref:j,onClick:r||l,className:`flex-1 px-4 sm:px-5 md:px-6 py-3 sm:py-3.5 md:py-4 font-semibold rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 text-sm sm:text-base ${D[g]}`,children:N})]})]})]})}function vs(){const[t,l]=s.useState({isOpen:!1,title:"",message:"",type:"info",showCancel:!1,confirmText:"OK",autoClose:!1,onClose:void 0}),r=s.useCallback((N,p="Xabar",P="info")=>new Promise($=>{if(P==="success"||P==="info"){$();return}l({isOpen:!0,title:p,message:N,type:P,showCancel:!1,confirmText:"OK",autoClose:!1,onConfirm:()=>{l(w=>k(v({},w),{isOpen:!1})),$()}})}),[]),h=s.useCallback((N,p="Tasdiqlash",P="warning")=>new Promise($=>{l({isOpen:!0,title:p,message:N,type:P,showCancel:!0,confirmText:"Ha",autoClose:!1,onConfirm:()=>{l(M=>k(v({},M),{isOpen:!1})),$(!0)},onClose:()=>{l(M=>k(v({},M),{isOpen:!1})),$(!1)}})}),[]),n=s.useCallback(()=>{t.onClose?t.onClose():l(N=>k(v({},N),{isOpen:!1}))},[t.onClose]),g=e.jsx(_r,{isOpen:t.isOpen,onClose:t.onClose||n,onConfirm:t.onConfirm,title:t.title,message:t.message,type:t.type,showCancel:t.showCancel,confirmText:t.confirmText,autoClose:t.autoClose});return{showAlert:r,showConfirm:h,AlertComponent:g}}const Br="pos_offline_db",Or=2,bs={SALES:"offline_sales",PRODUCTS:"cached_products",STAFF_RECEIPTS:"staff_receipts"};let qt=null;const at=()=>new Promise((t,l)=>{if(qt){t(qt);return}const r=indexedDB.open(Br,Or);r.onerror=()=>{console.error("IndexedDB: Failed to open database"),l(r.error)},r.onsuccess=()=>{qt=r.result,console.log("IndexedDB: Database opened successfully"),t(qt)},r.onupgradeneeded=h=>{const n=h.target.result;if(!n.objectStoreNames.contains(bs.SALES)){const g=n.createObjectStore(bs.SALES,{keyPath:"id"});g.createIndex("synced","synced",{unique:!1}),g.createIndex("createdAt","createdAt",{unique:!1}),console.log("IndexedDB: Created offline_sales store")}if(n.objectStoreNames.contains(bs.PRODUCTS)||(n.createObjectStore(bs.PRODUCTS,{keyPath:"_id"}).createIndex("code","code",{unique:!0}),console.log("IndexedDB: Created cached_products store")),!n.objectStoreNames.contains(bs.STAFF_RECEIPTS)){const g=n.createObjectStore(bs.STAFF_RECEIPTS,{keyPath:"id"});g.createIndex("syncStatus","syncStatus",{unique:!1}),g.createIndex("createdAt","createdAt",{unique:!1}),g.createIndex("updatedAt","updatedAt",{unique:!1}),g.createIndex("userId","userId",{unique:!1}),console.log("IndexedDB: Created staff_receipts store")}}}),Fr=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const l=Math.random()*16|0;return(t==="x"?l:l&3|8).toString(16)}),Kr=t=>E(es,null,function*(){const l=yield at(),r=k(v({},t),{id:Fr(),createdAt:new Date().toISOString(),synced:!1});return new Promise((h,n)=>{const p=l.transaction([bs.SALES],"readwrite").objectStore(bs.SALES).add(r);p.onsuccess=()=>{console.log("IndexedDB: Sale saved offline",r.id),h(r)},p.onerror=()=>{console.error("IndexedDB: Failed to save sale"),n(p.error)}})}),$a=()=>E(es,null,function*(){const t=yield at();return new Promise((l,r)=>{const n=t.transaction([bs.SALES],"readonly").objectStore(bs.SALES),g=[],N=n.openCursor();N.onsuccess=p=>{const P=p.target.result;if(P){const $=P.value;($.synced===!1||$.synced===void 0)&&g.push($),P.continue()}else l(g)},N.onerror=()=>{console.error("IndexedDB: Failed to get unsynced sales"),r(N.error)}})}),Ta=t=>E(es,null,function*(){const l=yield at();return new Promise((r,h)=>{const n=l.transaction([bs.SALES],"readwrite"),g=n.objectStore(bs.SALES);n.onerror=()=>h(n.error);let N=0;const p=t.length;if(p===0){r();return}t.forEach(P=>{const $=g.get(P);$.onsuccess=()=>{const w=$.result;w&&(w.synced=!0,g.put(w)),N++,N===p&&(console.log(`IndexedDB: Marked ${p} sales as synced`),r())},$.onerror=()=>{N++,N===p&&r()}})})}),Ra=t=>E(es,null,function*(){const l=yield at();return new Promise((r,h)=>{const n=l.transaction([bs.SALES],"readwrite"),g=n.objectStore(bs.SALES);n.onerror=()=>h(n.error);let N=0;const p=t.length;if(p===0){r();return}t.forEach(P=>{const $=g.delete(P);$.onsuccess=()=>{N++,N===p&&(console.log(`IndexedDB: Deleted ${p} synced sales`),r())},$.onerror=()=>{N++,N===p&&r()}})})}),rt=()=>E(es,null,function*(){return(yield $a()).length}),Qa=t=>E(es,null,function*(){const l=yield at();return new Promise((r,h)=>{const g=l.transaction([bs.PRODUCTS],"readwrite").objectStore(bs.PRODUCTS),N=g.clear();N.onsuccess=()=>{let p=0;const P=t.length;if(P===0){r();return}t.forEach($=>{const w=g.add($);w.onsuccess=()=>{p++,p===P&&(console.log(`IndexedDB: Cached ${P} products`),r())},w.onerror=()=>{p++,p===P&&r()}})},N.onerror=()=>{h(N.error)}})}),At=()=>E(es,null,function*(){const t=yield at();return new Promise((l,r)=>{const g=t.transaction([bs.PRODUCTS],"readonly").objectStore(bs.PRODUCTS).getAll();g.onsuccess=()=>{var N;console.log(`IndexedDB: Retrieved ${((N=g.result)==null?void 0:N.length)||0} cached products`),l(g.result||[])},g.onerror=()=>{console.error("IndexedDB: Failed to get cached products"),r(g.error)}})});let Mt=[],jt=!1;const Ur=t=>(Mt.push(t),()=>{Mt=Mt.filter(l=>l!==t)}),Nt=t=>E(es,null,function*(){const l=yield rt();Mt.forEach(r=>r(t,l))}),lt=()=>navigator.onLine,Jt=()=>E(es,null,function*(){if(jt)return console.log("Sync: Already syncing, skipping..."),{success:!1,synced:0,error:"Sync already in progress"};if(!lt())return console.log("Sync: Device is offline, skipping..."),{success:!1,synced:0,error:"Device is offline"};jt=!0,yield Nt("syncing");try{const t=yield $a();if(t.length===0)return console.log("Sync: No unsynced sales to sync"),jt=!1,yield Nt("idle"),{success:!0,synced:0};console.log(`Sync: Found ${t.length} unsynced sales`);const l=t.map(h=>({offlineId:h.id,items:h.items,total:h.total,paymentMethod:h.paymentMethod,customer:h.customer,isReturn:h.isReturn,createdAt:h.createdAt})),r=yield F.post("/receipts/bulk",{sales:l});if(r.data.success){const h=t.map(n=>n.id);return yield Ta(h),yield Ra(h),console.log(`Sync: Successfully synced ${h.length} sales`),jt=!1,yield Nt("success"),{success:!0,synced:h.length}}else throw new Error(r.data.message||"Server returned error")}catch(t){return console.error("Sync: Failed to sync sales",t),jt=!1,yield Nt("error"),{success:!1,synced:0,error:t.message||"Sync failed"}}}),Xr=()=>{window.addEventListener("online",()=>E(es,null,function*(){console.log("Sync: Internet connection restored"),setTimeout(()=>E(es,null,function*(){const t=yield Jt();t.success&&t.synced>0&&console.log(`Sync: Auto-synced ${t.synced} sales after reconnection`)}),2e3)})),window.addEventListener("offline",()=>{console.log("Sync: Internet connection lost - sales will be saved locally"),Nt("idle")}),lt()&&setTimeout(()=>{Jt()},3e3),console.log("Sync: Event listeners initialized")},Hr=()=>E(es,null,function*(){return lt()?Jt():{success:!1,synced:0,error:"Internet aloqasi yo'q"}}),Yr=()=>{const[t,l]=s.useState(lt()),[r,h]=s.useState(0),[n,g]=s.useState(!1),[N,p]=s.useState("idle"),[P,$]=s.useState(!1);s.useEffect(()=>{E(es,null,function*(){yield at(),P||(Xr(),$(!0));const S=yield rt();h(S)});const D=Ur((S,q)=>{p(S),h(q),g(S==="syncing")}),c=()=>l(!0),z=()=>l(!1);return window.addEventListener("online",c),window.addEventListener("offline",z),()=>{D(),window.removeEventListener("online",c),window.removeEventListener("offline",z)}},[P]);const w=s.useCallback(T=>E(es,null,function*(){if(lt())try{const c=(yield F.get(`/products${T?`?${T}`:""}`)).data;return yield Qa(c),c}catch(D){return console.log("Failed to fetch from server, using cache"),At()}else return console.log("Offline - using cached products"),At()}),[]),j=s.useCallback(T=>E(es,null,function*(){try{const D=yield Kr(T);if(console.log("Sale saved locally:",D.id),lt())try{yield F.post("/receipts",{items:T.items,total:T.total,paymentMethod:T.paymentMethod,customer:T.customer,isReturn:T.isReturn}),yield Ta([D.id]),yield Ra([D.id]);const c=yield rt();return h(c),{success:!0,offline:!1}}catch(c){console.log("Server sync failed, sale saved offline");const z=yield rt();return h(z),{success:!0,offline:!0}}else{const c=yield rt();return h(c),{success:!0,offline:!0}}}catch(D){return console.error("Failed to save sale:",D),{success:!1,offline:!1}}}),[]),M=s.useCallback(()=>E(es,null,function*(){const T=yield Hr(),D=yield rt();return h(D),T}),[]);return{isOnline:t,pendingCount:r,isSyncing:n,syncStatus:N,fetchProductsWithCache:w,createSaleOfflineFirst:j,manualSync:M}};function Wr({onScan:t,onClose:l}){const[r,h]=s.useState(!1),[n,g]=s.useState(""),[N,p]=s.useState(!1),[P,$]=s.useState(""),[w,j]=s.useState(""),M=s.useRef(null);s.useEffect(()=>{M.current&&M.current.focus()},[]);const T=z=>E(this,null,function*(){var S,q;if(!z||z.trim()===""){$("Kod kiriting");return}try{p(!0),$(""),j(""),console.log("ðŸ” QR Scanner: Mahsulot qidirilmoqda...",z);const f=yield F.get(`/products/scan-qr/${z.trim()}`);if(f.data.success&&f.data.product){console.log("âœ… QR Scanner: Mahsulot topildi",f.data.product);const R=f.data.product;j(`${R.name} topildi! Mavjud: ${R.quantity} ta`),setTimeout(()=>{t(R),g(""),j(""),M.current&&M.current.focus()},500)}else $("Mahsulot topilmadi")}catch(f){console.error("âŒ QR Scanner xatosi:",f),$(((q=(S=f.response)==null?void 0:S.data)==null?void 0:q.message)||"Mahsulot topilmadi")}finally{p(!1)}}),D=z=>{z.key==="Enter"&&T(n)},c=()=>{T(n)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-scale-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(Yt,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"QR Scanner"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Mahsulot kodini kiriting"})]})]}),e.jsx("button",{onClick:l,className:"w-10 h-10 rounded-full hover:bg-slate-100 flex items-center justify-center transition-colors",children:e.jsx(be,{className:"w-5 h-5 text-slate-600"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mahsulot Kodi"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:M,type:"text",value:n,onChange:z=>g(z.target.value),onKeyPress:D,placeholder:"Kodni kiriting yoki skanerlang...",className:"flex-1 px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",disabled:N,autoFocus:!0}),e.jsx("button",{onClick:c,disabled:N||!n,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Qidirilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Yt,{className:"w-5 h-5"}),"Qidirish"]})})]})]}),P&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-xl text-red-700",children:[e.jsx(ra,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium",children:P})]}),w&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-xl text-green-700",children:[e.jsx(aa,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium",children:w})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Qanday ishlatish?"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Mahsulot kodini kiriting"}),e.jsx("li",{children:"â€¢ Yoki QR kod skanerdan foydalaning"}),e.jsx("li",{children:"â€¢ Enter tugmasini bosing"}),e.jsx("li",{children:"â€¢ Mahsulot avtomatik kassaga qo'shiladi"})]})]}),r&&e.jsxs("div",{className:"bg-slate-100 rounded-xl p-8 text-center",children:[e.jsx(Ga,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Kamera skaneri tez orada..."})]})]}),e.jsx("div",{className:"mt-6 flex gap-3",children:e.jsx("button",{onClick:l,className:"flex-1 px-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-all",children:"Yopish"})})]})})}function Kt(){const t=Es(),{showAlert:l,AlertComponent:r}=vs();Yr();const[h,n]=s.useState("products"),[g,N]=s.useState(!1),[p,P]=s.useState([]),[$,w]=s.useState([]),[j,M]=s.useState(20),[T,D]=s.useState([]),[c,z]=s.useState(""),[S,q]=s.useState(!1),[f,R]=s.useState(!1),[W,J]=s.useState(""),[de,xe]=s.useState([]),[O,ke]=s.useState([]),[ee,Se]=s.useState(!1),[ie,ce]=s.useState([]),[L,ge]=s.useState(null),[B,Ne]=s.useState(!1),[je,K]=s.useState(""),[Q,ne]=s.useState(0),[V,he]=s.useState(0),[ye,Fe]=s.useState(0),[Ke,Ue]=s.useState(null),[as,Ve]=s.useState(!1),[u,te]=s.useState(!1),[Pe,$e]=s.useState(""),[le,Be]=s.useState(""),[x,pe]=s.useState(null),[we,Re]=s.useState(!1),[De,Ae]=s.useState(!1),[A,fe]=s.useState([]),[i,ae]=s.useState(!1),Ce=s.useRef(null);s.useEffect(()=>{qe(),y(),U(),ve();const m=localStorage.getItem("pendingReceipt");if(m)try{const X=JSON.parse(m);if(X.customer&&ge(X.customer),X.items&&X.items.length>0){const a=X.items.map(C=>({_id:C.product||C._id,name:C.name,code:C.code||"",price:C.price,cartQuantity:C.quantity,quantity:999}));D(a)}localStorage.removeItem("pendingReceipt"),setTimeout(()=>{q(!0)},500),l("Chek yuklandi! To'lov qilishingiz mumkin.","Muvaffaqiyat","success")}catch(X){console.error("Error loading pending receipt:",X),localStorage.removeItem("pendingReceipt")}},[]),s.useEffect(()=>{w(p.slice(0,j))},[p,j]),s.useEffect(()=>{const m=Ce.current;if(!m)return;const X=()=>{const{scrollTop:a,scrollHeight:C,clientHeight:I}=m;C-a<=I*1.5&&j<p.length&&M(H=>Math.min(H+20,p.length))};return m.addEventListener("scroll",X),()=>m.removeEventListener("scroll",X)},[j,p.length]);const qe=()=>E(this,null,function*(){try{if(navigator.onLine){const m=yield F.get("/products?mainOnly=true&limit=1000"),X=m.data.data||m.data,a=Array.isArray(X)?X:[];P(a),yield Qa(a)}else{const m=yield At();P(m)}}catch(m){console.error("Error fetching products:",m);const X=yield At();X.length>0&&P(X)}}),y=()=>E(this,null,function*(){try{const m=yield F.get("/customers/kassa");ce(m.data)}catch(m){console.error("Error fetching customers:",m)}}),U=()=>E(this,null,function*(){ae(!0);try{const m=yield F.get("/receipts/kassa");fe(m.data||[])}catch(m){console.error("Error fetching helper receipts:",m),l("Cheklar yuklanmadi","Xatolik","danger")}finally{ae(!1)}}),oe=m=>{const X=m.items.map(a=>{var C,I,H;return{_id:((C=a.product)==null?void 0:C._id)||a.product,name:((I=a.product)==null?void 0:I.name)||a.name,code:((H=a.product)==null?void 0:H.code)||a.code||"",price:a.price,cartQuantity:a.quantity,quantity:999}});D(X),n("products"),l("Chek savatga yuklandi!","Muvaffaqiyat","success")},ve=()=>{const m=localStorage.getItem("savedReceipts");m&&ke(JSON.parse(m))},ss=()=>E(this,null,function*(){var m,X,a,C,I,H;if(!Pe.trim()||!le.trim()){l("Ism va telefon raqamini kiriting!","Ogohlantirish","warning");return}try{console.log("ðŸ“¤ Yangi mijoz yaratish so'rovi:",{name:Pe.trim(),phone:le.trim()});const G=yield F.post("/customers/kassa",{name:Pe.trim(),phone:le.trim()});if(console.log("âœ… Mijoz yaratish javobi:",G.data),G.data.success){const Z=G.data.customer;ce(se=>[...se,Z]),ge(Z),te(!1),$e(""),Be(""),l("Yangi mijoz qo'shildi!","Muvaffaqiyat","success"),console.log("âœ… Mijoz muvaffaqiyatli qo'shildi:",Z)}}catch(G){if(console.error("âŒ Mijoz yaratishda xatolik:",G),console.error("Xato tafsilotlari:",(m=G.response)==null?void 0:m.data),((X=G.response)==null?void 0:X.status)===400&&((C=(a=G.response)==null?void 0:a.data)!=null&&C.existingCustomer)){const Z=G.response.data.existingCustomer;ge(Z),te(!1),$e(""),Be(""),l("Bu mijoz allaqachon mavjud. Tanlandi.","Ma'lumot","info"),console.log("â„¹ï¸ Mavjud mijoz tanlandi:",Z)}else l(((H=(I=G.response)==null?void 0:I.data)==null?void 0:H.message)||"Mijoz qo'shishda xatolik","Xatolik","danger")}}),_e=T.reduce((m,X)=>m+X.price*X.cartQuantity,0),rs=T.reduce((m,X)=>m+X.cartQuantity,0),Xe=m=>{if(m.quantity<=0){l(`${m.name} tugagan! Mavjud emas.`,"Ogohlantirish","warning");return}const X=T.find(C=>C._id===m._id);if((X?X.cartQuantity:0)>=m.quantity){l(`${m.name} - maksimal miqdor: ${m.quantity}`,"Ogohlantirish","warning");return}D(C=>C.find(H=>H._id===m._id)?C.map(H=>H._id===m._id?k(v({},H),{cartQuantity:H.cartQuantity+1}):H):[...C,k(v({},m),{cartQuantity:1})]),R(!1),J("")},Ss=m=>{Xe(m),l(`${m.name} savatga qo'shildi`,"Muvaffaqiyat","success"),Ae(!1)},zs=m=>{D(X=>X.filter(a=>a._id!==m))},Cs=(m,X)=>{X<=0?zs(m):D(a=>a.map(C=>C._id===m?k(v({},C),{cartQuantity:X}):C))},js=m=>{if(J(m),m.length>0){const X=p.filter(a=>a.name.toLowerCase().includes(m.toLowerCase())||a.code.toLowerCase().includes(m.toLowerCase()));xe(X)}else xe(p.slice(0,20))},Ns=()=>E(this,null,function*(){var I,H,G;if(T.length===0)return;const m=V+ye,X=_e-m;if(X>0&&!L){l("Qarzga sotish uchun mijozni tanlang yoki yangi mijoz qo'shing!","Ogohlantirish","warning");return}let a;V>0&&ye>0?a="mixed":V>0?a="cash":a="card";const C={items:T.map(Z=>({product:Z._id,name:Z.name,code:Z.code,price:Z.price,quantity:Z.cartQuantity})),total:_e,paidAmount:m,cashAmount:V,cardAmount:ye,paymentMethod:a,isReturn:ee,customer:L==null?void 0:L._id};try{if(navigator.onLine){console.log("ðŸ“¤ Chek yuborish boshlandi:",C);const Z=yield F.post("/receipts",C);console.log("âœ… Server javobi:",Z.data),X>0&&L?l(`To'lov qabul qilindi! Qarz: ${b(X)} so'm`,"Muvaffaqiyat","success"):l(ee?"Qaytarish muvaffaqiyatli!":"Chek saqlandi!","Muvaffaqiyat","success"),xs(Z.data,a,m,X,V,ye),D([]),q(!1),Ve(!1),Ue(null),Se(!1),he(0),Fe(0),ne(0),ge(null),qe()}else l("Internet aloqasi yo'q. Iltimos, internetni yoqing.","Xatolik","danger")}catch(Z){console.error("âŒ Xatolik:",Z),console.error("Xato tafsilotlari:",(I=Z.response)==null?void 0:I.data);const se=((G=(H=Z.response)==null?void 0:H.data)==null?void 0:G.message)||Z.message||"Xatolik yuz berdi";l(se,"Xatolik","danger")}}),xs=(m,X,a,C,I,H)=>{const G=window.open("","","height=600,width=400");if(!G)return;const Z=a||m.total,se=C||0,me=I||0,ze=H||0;let Ie="";X==="mixed"?Ie=`Naqd: ${b(me)} so'm, Karta: ${b(ze)} so'm`:X==="cash"?Ie="Naqd pul":Ie="Karta";const cs=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Chek</title>
        <style>
          body { font-family: monospace; margin: 0; padding: 10px; font-size: 12px; }
          .header { text-align: center; margin-bottom: 10px; border-bottom: 1px dashed #000; padding-bottom: 10px; }
          .title { font-weight: bold; font-size: 14px; }
          .items { margin: 10px 0; border-bottom: 1px dashed #000; padding-bottom: 10px; }
          .item { display: flex; justify-content: space-between; margin: 5px 0; }
          .total { font-weight: bold; font-size: 14px; text-align: right; margin: 10px 0; }
          .payment-info { margin: 10px 0; border-top: 1px dashed #000; padding-top: 10px; }
          .footer { text-align: center; margin-top: 10px; font-size: 10px; }
          .debt-warning { color: #d00; font-weight: bold; text-align: center; margin: 10px 0; }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="title">CHEK</div>
          <div>${new Date().toLocaleString("uz-UZ")}</div>
        </div>
        
        <div class="items">
          ${m.items.map(us=>`
            <div class="item">
              <span>${us.name}</span>
              <span>${b(us.price*us.quantity)} so'm</span>
            </div>
            <div style="font-size: 10px; color: #666;">
              ${us.quantity} x ${b(us.price)} so'm
            </div>
          `).join("")}
        </div>
        
        <div class="total">
          Jami: ${b(m.total)} so'm
        </div>
        
        <div class="payment-info">
          ${X==="mixed"?`
            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
              <span>Naqd:</span>
              <span>${b(me)} so'm</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
              <span>Karta:</span>
              <span>${b(ze)} so'm</span>
            </div>
          `:""}
          <div style="display: flex; justify-content: space-between; margin: 5px 0; font-weight: bold;">
            <span>To'landi:</span>
            <span>${b(Z)} so'm</span>
          </div>
          ${se>0?`
            <div class="debt-warning">
              Qarz: ${b(se)} so'm
            </div>
          `:""}
        </div>
        
        <div class="footer">
          To'lov: ${Ie}
          <br>
          Raxmat!
        </div>
      </body>
      </html>
    `;G.document.write(cs),G.document.close(),setTimeout(()=>{G.print()},250)},gs=m=>E(this,null,function*(){const X=window.open("","_blank","width=600,height=400");if(!X){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}const a=m.map(H=>E(this,null,function*(){try{const G=yield Ir(()=>import("./qrcode-vendor-DgV9WI2I.js").then(ze=>ze.b),__vite__mapDeps([0,1])),Z=G.default||G,se=`${window.location.origin}/product/${H._id}`,me=yield Z.toDataURL(se,{width:300,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});return{product:H,qrDataUrl:me}}catch(G){return console.error("QR generation error:",G),{product:H,qrDataUrl:""}}})),C=yield Promise.all(a);let I="";C.forEach(({product:H,qrDataUrl:G})=>{I+=`
        <div class="label">
          <div class="top-section">
            <div class="qr-box">
              <img src="${G}" alt="QR" class="qr-code" />
            </div>
            <div class="info-box">
              <div class="product-code">Kod: ${H.code}</div>
              <div class="product-name">${H.name}</div>
            </div>
          </div>
          <div class="bottom-section">
            <div class="price-box">
              <span class="price-value">${b(H.price)}</span>
              <span class="price-currency">so'm</span>
            </div>
          </div>
        </div>
      `}),X.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Label</title>
        <style>
          @page {
            size: 60mm 40mm;
            margin: 0;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, Helvetica, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .label {
            width: 60mm;
            height: 40mm;
            padding: 2mm;
            background: white;
            display: flex;
            flex-direction: column;
            page-break-after: always;
          }
          .label:last-child {
            page-break-after: auto;
          }
          .top-section {
            display: flex;
            gap: 2mm;
            flex: 1;
          }
          .qr-box {
            width: 22mm;
            height: 22mm;
            flex-shrink: 0;
          }
          .qr-code {
            width: 22mm;
            height: 22mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
          }
          .product-code {
            font-size: 7pt;
            font-weight: 600;
            color: #666;
            margin-bottom: 1mm;
          }
          .product-name {
            font-size: 9pt;
            font-weight: 700;
            color: #000;
            line-height: 1.2;
            text-transform: uppercase;
            word-break: break-word;
          }
          .bottom-section {
            margin-top: 1.5mm;
          }
          .price-box {
            padding: 1.5mm;
            text-align: center;
            background: #f0f0f0;
            border-radius: 1mm;
          }
          .price-value {
            font-size: 14pt;
            font-weight: 900;
            color: #000;
            letter-spacing: -0.5px;
          }
          .price-currency {
            font-size: 10pt;
            font-weight: 700;
            color: #000;
            margin-left: 1mm;
          }
          @media print {
            body { background: white; }
          }
          @media screen {
            body { background: #e5e7eb; padding: 10mm; }
            .label { 
              margin-bottom: 5mm;
              box-shadow: 0 2px 8px rgba(0,0,0,0.1);
              border: 1px solid #ddd;
            }
          }
        </style>
      </head>
      <body>
        ${I}
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 200);
          }
        <\/script>
      </body>
      </html>
    `),X.document.close()}),ks=()=>{if(T.length===0){l("Chek bo'sh","Ogohlantirish","warning");return}const m={id:Date.now().toString(),items:[...T],total:_e,savedAt:new Date().toLocaleString()},X=[...O,m];ke(X),localStorage.setItem("savedReceipts",JSON.stringify(X)),D([]),l("Chek saqlandi!","Muvaffaqiyat","success")},d=m=>{D(m.items);const X=O.filter(a=>a.id!==m.id);ke(X),localStorage.setItem("savedReceipts",JSON.stringify(X)),Re(!1)},re=m=>{const X=O.filter(a=>a.id!==m);ke(X),localStorage.setItem("savedReceipts",JSON.stringify(X))};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100 pb-20 lg:pb-0",children:[r,e.jsx("header",{className:"bg-white border-b border-slate-200 sticky top-0 z-40 shadow-sm",children:e.jsxs("div",{className:"max-w-[1800px] mx-auto px-3 sm:px-4 lg:px-6 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>N(!0),className:"p-2 rounded-lg bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-colors active:scale-95 flex-shrink-0 flex sm:hidden",title:"Menyuni ochish",children:e.jsx(kt,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-gradient-to-br from-purple-500 via-purple-600 to-blue-600 flex items-center justify-center shadow-xl",children:e.jsx(hs,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white drop-shadow-lg"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-extrabold bg-gradient-to-r from-purple-600 via-blue-600 to-purple-600 bg-clip-text text-transparent leading-tight",children:"Kassa (POS)"}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500 font-medium mt-0.5",children:"Professional Sotish Tizimi"})]})]}),e.jsxs("button",{onClick:()=>Re(!0),className:"flex items-center gap-2 px-3 sm:px-4 py-2 bg-gradient-to-r from-purple-100 to-blue-100 hover:from-purple-200 hover:to-blue-200 rounded-xl text-sm font-bold text-purple-700 transition-all shadow-md hover:shadow-lg",children:[e.jsx(Rt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Saqlangan"}),O.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-red-500 text-white text-xs rounded-full font-bold shadow-md",children:O.length})]})]})}),e.jsx("div",{className:"max-w-[1800px] mx-auto p-2 sm:p-4 lg:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3 sm:gap-4 lg:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-2 sm:space-y-3 lg:space-y-4 order-1",children:[e.jsxs("div",{className:"flex gap-2 bg-white p-2 rounded-xl border-2 border-slate-200 shadow-sm",children:[e.jsxs("button",{onClick:()=>n("products"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-semibold text-sm transition-all ${h==="products"?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-md":"bg-slate-50 text-slate-600 hover:bg-slate-100"}`,children:[e.jsx(Ws,{className:"w-4 h-4"}),"Mahsulotlar"]}),e.jsxs("button",{onClick:()=>n("receipts"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-semibold text-sm transition-all ${h==="receipts"?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-md":"bg-slate-50 text-slate-600 hover:bg-slate-100"}`,children:[e.jsx(Ls,{className:"w-4 h-4"}),"Cheklar",A.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-red-500 text-white text-xs rounded-full font-bold",children:A.length})]})]}),h==="products"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-3 sm:left-4 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Mahsulot qidirish...",value:W,onChange:m=>js(m.target.value),onFocus:()=>R(!0),className:"w-full pl-9 sm:pl-12 pr-3 sm:pr-4 py-2 sm:py-3 bg-white border-2 border-slate-200 rounded-lg sm:rounded-xl focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 text-xs sm:text-sm"})]}),f&&W?e.jsx("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 overflow-hidden shadow-lg",children:e.jsx("div",{className:"max-h-64 sm:max-h-96 overflow-y-auto",children:de.length>0?e.jsx("div",{className:"divide-y divide-slate-100",children:de.map(m=>e.jsxs("button",{onClick:()=>{Xe(m),R(!1),J("")},disabled:m.quantity<=0,className:`w-full flex items-center gap-2 sm:gap-4 p-2 sm:p-4 hover:bg-slate-50 transition-colors text-left ${m.quantity<=0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-brand-100 to-brand-50 rounded-xl border-2 border-brand-200 flex items-center justify-center flex-shrink-0 overflow-hidden relative",children:[m.quantity<=0&&e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center z-10",children:e.jsx("span",{className:"text-white text-[8px] font-bold",children:"TUGAGAN"})}),m.images&&m.images.length>0?e.jsx("img",{src:`${Ts}${m.images[0]}`,alt:m.name,className:"w-full h-full object-cover",onError:X=>{X.currentTarget.style.display="none";const a=X.currentTarget.parentElement;a&&(a.innerHTML='<svg class="w-5 h-5 sm:w-6 sm:h-6 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>')}}):e.jsx(Ws,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-slate-900 truncate text-xs sm:text-sm",children:m.name}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-slate-500",children:["Kod: ",m.code]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"font-bold text-brand-600 text-xs sm:text-sm",children:[b(m.price)," so'm"]}),e.jsxs("p",{className:`text-[10px] sm:text-xs font-semibold ${m.quantity<=0?"text-red-600":m.quantity<=10?"text-orange-600":"text-green-600"}`,children:[m.quantity," ta"]})]})]},m._id))}):e.jsxs("div",{className:"p-6 sm:p-8 text-center text-slate-500",children:[e.jsx(Ws,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 opacity-30"}),e.jsx("p",{className:"text-xs sm:text-sm",children:"Mahsulot topilmadi"})]})})}):e.jsx("div",{ref:Ce,className:"max-h-[calc(100vh-250px)] overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-2 sm:gap-3",children:$.map(m=>e.jsxs("div",{className:"group bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 hover:border-brand-300 hover:shadow-lg transition-all p-2 sm:p-4 relative",children:[e.jsxs("button",{onClick:X=>{X.stopPropagation(),gs([m])},className:"absolute top-2 right-2 w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 z-10 group/qr",title:"QR code chiqarish",children:[e.jsx(Yt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white drop-shadow-lg"}),e.jsx("span",{className:"absolute -bottom-8 right-0 bg-slate-900 text-white text-[10px] px-2 py-1 rounded-lg opacity-0 group-hover/qr:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:"QR Print"})]}),e.jsxs("button",{onClick:()=>Xe(m),disabled:m.quantity<=0,className:`w-full text-left ${m.quantity<=0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"w-full aspect-square bg-gradient-to-br from-brand-100 to-brand-50 rounded-xl border-2 border-brand-200 flex items-center justify-center mb-2 sm:mb-3 group-hover:scale-105 transition-transform overflow-hidden relative",children:[m.quantity<=0&&e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center z-10",children:e.jsx("div",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold",children:"TUGAGAN"})}),m.images&&m.images.length>0?e.jsx("img",{src:`${Ts}${m.images[0]}`,alt:m.name,className:"w-full h-full object-cover",onError:X=>{X.currentTarget.style.display="none";const a=X.currentTarget.parentElement;a&&(a.innerHTML='<svg class="w-6 h-6 sm:w-8 sm:h-8 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>')}}):e.jsx(Ws,{className:"w-6 h-6 sm:w-8 sm:h-8 text-brand-600"})]}),e.jsx("p",{className:"font-semibold text-slate-900 text-[10px] sm:text-sm truncate",children:m.name}),e.jsx("p",{className:"text-[9px] sm:text-xs text-slate-500 mb-1 sm:mb-2",children:m.code}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"font-bold text-brand-600 text-[10px] sm:text-sm",children:[b(m.price)," so'm"]}),m.quantity<=0?e.jsx("span",{className:"text-[9px] sm:text-xs text-red-600 font-semibold",children:"0 ta"}):m.quantity<=10?e.jsxs("span",{className:"text-[9px] sm:text-xs text-orange-600 font-semibold",children:[m.quantity," ta"]}):e.jsxs("span",{className:"text-[9px] sm:text-xs text-green-600 font-semibold",children:[m.quantity," ta"]})]})]})]},m._id))})})]}),h==="receipts"&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-slate-200 shadow-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Hodimlardan kelgan cheklar"}),e.jsx("button",{onClick:U,disabled:i,className:"p-2 rounded-lg bg-brand-50 hover:bg-brand-100 text-brand-600 transition-colors disabled:opacity-50",children:e.jsx(Rs,{className:`w-5 h-5 ${i?"animate-spin":""}`})})]}),i?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-brand-500 border-t-transparent rounded-full animate-spin"})}):A.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(Ls,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"Cheklar yo'q"})]}):e.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:A.map(m=>e.jsxs("div",{className:"border-2 border-slate-200 rounded-xl p-4 hover:border-brand-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-slate-900",children:["Chek #",m.receiptNumber||m._id.slice(-6)]}),e.jsx("p",{className:"text-xs text-slate-500",children:new Date(m.createdAt).toLocaleString("uz-UZ")}),m.createdBy&&e.jsxs("p",{className:"text-xs text-brand-600 font-medium mt-1",children:["ðŸ‘¤ Hodim: ",m.createdBy.name]}),m.customer&&e.jsxs("p",{className:"text-xs text-green-600 font-medium mt-1",children:["ðŸ›’ Mijoz: ",m.customer.name||"Oddiy mijoz"]})]}),e.jsxs("button",{onClick:()=>oe(m),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white rounded-lg font-semibold text-sm shadow-md hover:shadow-lg transition-all",children:[e.jsx(hs,{className:"w-4 h-4"}),"Yuklash"]})]}),e.jsx("div",{className:"space-y-2 mb-3",children:m.items.map((X,a)=>e.jsxs("div",{className:"flex justify-between text-sm bg-slate-50 p-2 rounded-lg",children:[e.jsxs("span",{className:"text-slate-700",children:[X.name," Ã— ",X.quantity]}),e.jsxs("span",{className:"font-semibold text-slate-900",children:[b(X.price*X.quantity)," so'm"]})]},a))}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-slate-200",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Jami:"}),e.jsxs("span",{className:"text-xl font-bold text-brand-600",children:[b(m.totalAmount||m.total)," so'm"]})]})]},m._id))})]})]}),e.jsx("div",{className:"lg:col-span-1 order-2",children:e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-2xl border-2 border-slate-200 shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-3 sm:px-6 py-3 sm:py-4 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-1 sm:mb-2",children:[e.jsx(hs,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("h2",{className:"text-base sm:text-lg font-bold",children:"Savat"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-brand-100",children:[rs," ta mahsulot"]})]}),e.jsx("div",{className:"max-h-48 sm:max-h-64 overflow-y-auto divide-y divide-slate-100",children:T.length===0?e.jsxs("div",{className:"p-4 sm:p-8 text-center text-slate-400",children:[e.jsx(hs,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 opacity-30"}),e.jsx("p",{className:"text-xs sm:text-sm",children:"Savat bo'sh"})]}):T.map(m=>{const X=p.find(C=>C._id===m._id),a=X&&m.cartQuantity>X.quantity;return e.jsxs("div",{className:"p-2 sm:p-4 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1 sm:mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-slate-900 text-xs sm:text-sm truncate",children:m.name}),a&&e.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 text-yellow-700 text-[10px] font-semibold rounded-full whitespace-nowrap",children:"Kam!"})]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500",children:m.code})]}),e.jsx("button",{onClick:()=>zs(m._id),className:"text-slate-400 hover:text-red-500 transition-colors flex-shrink-0 ml-2",children:e.jsx(be,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-slate-100 rounded-lg p-0.5 sm:p-1",children:[e.jsx("button",{onClick:()=>Cs(m._id,m.cartQuantity-1),className:"w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center hover:bg-slate-200 rounded transition-colors",children:e.jsx(dt,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})}),e.jsx("input",{type:"number",min:"1",value:m.cartQuantity,onChange:C=>{const I=parseInt(C.target.value)||1;Cs(m._id,I)},className:"w-10 sm:w-12 text-center text-xs sm:text-sm font-semibold bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-brand-500 rounded"}),e.jsx("button",{onClick:()=>Cs(m._id,m.cartQuantity+1),className:"w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center hover:bg-slate-200 rounded transition-colors",children:e.jsx(ps,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})})]}),e.jsxs("p",{className:"font-bold text-brand-600 text-xs sm:text-sm",children:[b(m.price*m.cartQuantity)," so'm"]})]})]},m._id)})}),T.length>0&&e.jsxs("div",{className:"border-t border-slate-200 p-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-600 mb-2 block",children:"Mijoz"}),e.jsxs("button",{onClick:()=>Ne(!B),className:"w-full flex items-center gap-2 px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-medium text-slate-700 transition-colors",children:[e.jsx(is,{className:"w-4 h-4"}),e.jsx("span",{className:"flex-1 text-left truncate",children:L?L.name:"Oddiy mijoz"}),e.jsx(ct,{className:"w-4 h-4"})]}),B&&e.jsxs("div",{className:"absolute right-0 left-0 mx-4 mt-2 bg-white rounded-lg shadow-xl border border-slate-200 z-50 max-h-48 overflow-y-auto",children:[e.jsx("button",{onClick:()=>{ge(null),Ne(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 border-b border-slate-100",children:"Oddiy mijoz"}),ie.map(m=>e.jsxs("button",{onClick:()=>{ge(m),Ne(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 border-b border-slate-100 last:border-b-0",children:[e.jsx("p",{className:"font-medium text-slate-900",children:m.name}),e.jsx("p",{className:"text-xs text-slate-500",children:m.phone})]},m._id))]})]}),T.length>0&&e.jsxs("div",{className:"border-t border-slate-200 p-3 sm:p-6 space-y-2 sm:space-y-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-50 to-blue-50 rounded-xl p-3 sm:p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm sm:text-base font-semibold text-slate-700",children:"Jami:"}),e.jsxs("span",{className:"text-xl sm:text-2xl font-bold text-brand-600",children:[b(_e)," so'm"]})]})}),e.jsxs("button",{onClick:()=>q(!0),className:"w-full bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white font-bold py-2 sm:py-3 rounded-lg sm:rounded-xl transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2 text-xs sm:text-sm",children:[e.jsx(Us,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"To'lash"]}),e.jsxs("button",{onClick:ks,className:"w-full bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold py-1.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors flex items-center justify-center gap-2 text-xs sm:text-sm",children:[e.jsx(Rt,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Saqlash"]}),e.jsxs("button",{onClick:()=>D([]),className:"w-full bg-red-50 hover:bg-red-100 text-red-600 font-semibold py-1.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors flex items-center justify-center gap-2 text-xs sm:text-sm",children:[e.jsx(Ps,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Tozalash"]})]})]})})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full my-8 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-6 py-4 text-white",children:e.jsx("h3",{className:"text-xl font-bold",children:"To'lov"})}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[calc(100vh-200px)] overflow-y-auto",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Jami summa"}),e.jsxs("p",{className:"text-3xl font-bold text-brand-600",children:[b(_e)," so'm"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700 block",children:"Mijoz"}),u?e.jsxs("div",{className:"space-y-3 p-4 bg-blue-50 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1 block",children:"Ism"}),e.jsx("input",{type:"text",value:Pe,onChange:m=>$e(m.target.value),placeholder:"Mijoz ismi...",className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1 block",children:"Telefon"}),e.jsx("input",{type:"tel",value:le,onChange:m=>Be(m.target.value),placeholder:"+998 90 123 45 67",className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ss,className:"flex-1 bg-brand-500 hover:bg-brand-600 text-white font-semibold py-2 rounded-lg transition-colors text-sm",children:"Saqlash"}),e.jsx("button",{onClick:()=>{te(!1),$e(""),Be("")},className:"px-4 bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold rounded-lg transition-colors text-sm",children:"Bekor"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:(L==null?void 0:L._id)||"",onChange:m=>{const X=ie.find(a=>a._id===m.target.value);ge(X||null)},className:"w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",children:[e.jsx("option",{value:"",children:"Oddiy mijoz"}),ie.map(m=>e.jsxs("option",{value:m._id,children:[m.name," - ",m.phone]},m._id))]}),e.jsx("button",{onClick:()=>te(!0),className:"w-full px-4 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 font-semibold rounded-lg transition-colors text-sm",children:"+ Yangi mijoz qo'shish"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2",children:[e.jsx(va,{className:"w-4 h-4 text-emerald-600"}),"Naqd pul"]}),e.jsx("input",{type:"number",value:V||"",onChange:m=>he(Number(m.target.value)),placeholder:"0",className:"w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 text-lg font-semibold"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2",children:[e.jsx(Us,{className:"w-4 h-4 text-blue-600"}),"Karta"]}),e.jsx("input",{type:"number",value:ye||"",onChange:m=>Fe(Number(m.target.value)),placeholder:"0",className:"w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 text-lg font-semibold"})]})]}),(V>0||ye>0)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Jami to'lanadi:"}),e.jsxs("span",{className:"font-bold text-slate-900",children:[b(V+ye)," so'm"]})]}),V+ye<_e&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-amber-600",children:"Qarz:"}),e.jsxs("span",{className:"font-bold text-amber-600",children:[b(_e-(V+ye))," so'm"]})]}),V+ye>_e&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-600",children:"Qaytim:"}),e.jsxs("span",{className:"font-bold text-green-600",children:[b(V+ye-_e)," so'm"]})]})]}),V+ye<_e&&!L&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-3 flex items-start gap-2",children:[e.jsx(qs,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-900 text-sm",children:"Mijoz tanlanmagan!"}),e.jsx("p",{className:"text-xs text-red-700 mt-1",children:"Qarzga sotish uchun mijozni tanlang yoki yangi mijoz qo'shing"})]})]}),V+ye<_e&&L&&e.jsxs("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-3 flex items-start gap-2",children:[e.jsx(qs,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-amber-900 text-sm",children:"Qisman to'lov"}),e.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:[b(_e-(V+ye))," so'm ",e.jsx("span",{className:"font-bold",children:L.name})," nomiga qarzga yoziladi"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:Ns,disabled:V+ye<=0||V+ye<_e&&!L,className:"flex-1 bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white font-bold py-3 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:"Tasdiqlash"}),e.jsx("button",{onClick:()=>{q(!1),he(0),Fe(0),te(!1),$e(""),Be("")},className:"px-6 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold rounded-xl transition-colors",children:"Bekor"})]})]})]})}),De&&e.jsx(Wr,{onScan:Ss,onClose:()=>Ae(!1)}),we&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-96 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-6 py-4 text-white flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Saqlangan Cheklar"}),e.jsx("button",{onClick:()=>Re(!1),className:"hover:bg-brand-600 p-2 rounded-lg transition-colors",children:e.jsx(be,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto divide-y divide-slate-200",children:O.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx(Ls,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"Saqlangan cheklar yo'q"})]}):O.map(m=>e.jsxs("div",{className:"p-4 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-slate-900",children:[m.items.length," ta mahsulot"]}),e.jsx("p",{className:"text-xs text-slate-500",children:m.savedAt})]}),e.jsxs("p",{className:"font-bold text-brand-600",children:[b(m.total)," so'm"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(m),className:"flex-1 bg-brand-100 hover:bg-brand-200 text-brand-700 font-semibold py-2 rounded-lg transition-colors text-sm",children:"Yuklash"}),e.jsx("button",{onClick:()=>re(m.id),className:"flex-1 bg-red-100 hover:bg-red-200 text-red-700 font-semibold py-2 rounded-lg transition-colors text-sm",children:"O'chirish"})]})]},m.id))})]})}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] sm:hidden",onClick:()=>N(!1)}),e.jsxs("div",{className:"fixed top-0 left-0 bottom-0 w-80 max-w-[85vw] bg-white z-[100] shadow-2xl animate-slide-in-left sm:hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center",children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-8 h-8 rounded-lg border-2 border-white/30"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-brand-100 text-xs",children:"Mebel furniturasi"})]})]}),e.jsx("button",{onClick:()=>N(!1),className:"p-2 rounded-lg bg-white/20 hover:bg-white/30 text-white transition-colors",children:e.jsx(be,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("button",{onClick:()=>{t("/"),N(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(ea,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Bosh sahifa"})]}),e.jsxs("button",{onClick:()=>{t("/admin/products"),N(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(Ws,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Mahsulotlar"})]}),e.jsxs("button",{onClick:()=>{N(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-brand-50 text-brand-700 transition-colors text-left",children:[e.jsx(hs,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Kassa (POS)"})]}),e.jsxs("button",{onClick:()=>{t("/admin/customers"),N(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(Os,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Mijozlar"})]}),e.jsxs("button",{onClick:()=>{t("/admin/debts"),N(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(Hs,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Qarzlar"})]}),e.jsxs("button",{onClick:()=>{t("/admin/staff-receipts"),N(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(Ls,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Cheklar"})]}),e.jsxs("button",{onClick:()=>{t("/admin/helpers"),N(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(sa,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Hodimlar"})]})]})]})]})]})}const Jr=({productId:t,code:l,name:r,price:h,unit:n="dona",dimensions:g="",labelWidth:N=60,labelHeight:p=40,copies:P=1,onPrint:$})=>{const[w,j]=s.useState(""),[M,T]=s.useState(P),D=`${ca}/product/${t}`,c=q=>new Intl.NumberFormat("uz-UZ").format(q);s.useEffect(()=>{z()},[t,l]);const z=()=>E(es,null,function*(){try{const q=yield ia(D,{width:300,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});j(q)}catch(q){console.error("QR generation error:",q)}}),S=()=>{const q=window.open("","_blank","width=600,height=400");if(!q){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}let f="";for(let R=0;R<M;R++)f+=`
        <div class="label">
          <div class="top-section">
            <div class="qr-box">
              <img src="${w}" alt="QR" class="qr-code" />
            </div>
            <div class="info-box">
              <div class="product-code">Kod: ${l}</div>
              <div class="product-name">${r}</div>
              ${g?`<div class="product-dimensions">${g}</div>`:""}
            </div>
          </div>
          <div class="bottom-section">
            <div class="price-box">
              <span class="price-value">${c(h)}</span>
              <span class="price-currency">so'm</span>
            </div>
          </div>
        </div>
      `;q.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Label - ${r}</title>
        <style>
          @page {
            size: ${N}mm ${p}mm;
            margin: 0;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, Helvetica, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .label {
            width: ${N}mm;
            height: ${p}mm;
            padding: 2mm;
            background: white;
            display: flex;
            flex-direction: column;
            page-break-after: always;
          }
          .label:last-child {
            page-break-after: auto;
          }
          .top-section {
            display: flex;
            gap: 2mm;
            flex: 1;
          }
          .qr-box {
            width: 22mm;
            height: 22mm;
            flex-shrink: 0;
          }
          .qr-code {
            width: 22mm;
            height: 22mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
          }
          .product-code {
            font-size: 7pt;
            font-weight: 600;
            color: #666;
            margin-bottom: 1mm;
          }
          .product-name {
            font-size: 9pt;
            font-weight: 700;
            color: #000;
            line-height: 1.2;
            text-transform: uppercase;
            word-break: break-word;
          }
          .product-dimensions {
            font-size: 7pt;
            color: #666;
            margin-top: 1mm;
          }
          .bottom-section {
            margin-top: 1.5mm;
          }
          .price-box {
            padding: 1.5mm;
            text-align: center;
            background: #f0f0f0;
            border-radius: 1mm;
          }
          .price-value {
            font-size: 14pt;
            font-weight: 900;
            color: #000;
            letter-spacing: -0.5px;
          }
          .price-currency {
            font-size: 10pt;
            font-weight: 700;
            color: #000;
            margin-left: 1mm;
          }
          @media print {
            body { background: white; }
          }
          @media screen {
            body { background: #e5e7eb; padding: 10mm; }
            .label { 
              margin-bottom: 5mm;
              box-shadow: 0 2px 8px rgba(0,0,0,0.1);
              border: 1px solid #ddd;
            }
          }
        </style>
      </head>
      <body>
        ${f}
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 200);
          }
        <\/script>
      </body>
      </html>
    `),q.document.close(),$==null||$()};return e.jsxs("div",{className:"qr-print-label w-full",children:[e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden mx-auto shadow-md border border-gray-200",style:{width:"280px",padding:"12px"},children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:w?e.jsx("img",{src:w,alt:"QR Code",className:"w-24 h-24",style:{imageRendering:"pixelated"}}):e.jsx("div",{className:"w-24 h-24 bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-gray-400",children:"QR"})})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-500 mb-1",children:["Kod: ",l]}),e.jsx("div",{className:"text-base font-bold text-gray-900 uppercase leading-tight",children:r}),g&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:g})]})]}),e.jsxs("div",{className:"mt-3 bg-gray-100 rounded-lg p-2 text-center",children:[e.jsx("span",{className:"text-2xl font-black text-gray-900",children:c(h)}),e.jsx("span",{className:"text-lg font-bold text-gray-900 ml-1",children:"so'm"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-3",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Nusxa soni:"}),e.jsx("input",{type:"number",min:1,max:100,value:M,onChange:q=>T(parseInt(q.target.value)||1),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center"})]}),e.jsxs("button",{onClick:S,className:"mt-4 w-full px-4 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"ðŸ–¨ï¸ Chop etish ",M>1?`(${M} ta)`:""]})]})},Vr=({products:t,onClose:l})=>{const[r,h]=s.useState([]),[n,g]=s.useState(!0),[N,p]=s.useState({width:40,height:30,qrSize:18,columns:2,showPrice:!0,showCode:!0}),[P,$]=s.useState(!1),w=q=>new Intl.NumberFormat("uz-UZ").format(q);s.useEffect(()=>{j()},[t]);const j=()=>E(es,null,function*(){g(!0);const q=[];for(const f of t){const R=`${ca}/product/${f._id}`;try{const W=yield ia(R,{width:200,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});q.push({product:f,copies:1,qrDataUrl:W})}catch(W){console.error("QR error for",f.code,W)}}h(q),g(!1)}),M=(q,f)=>{h(R=>R.map((W,J)=>{if(J===q){const de=Math.max(1,Math.min(100,W.copies+f));return k(v({},W),{copies:de})}return W}))},T=(q,f)=>{h(R=>R.map((W,J)=>J===q?k(v({},W),{copies:Math.max(1,Math.min(100,f))}):W))},D=q=>{h(f=>f.filter((R,W)=>W!==q))},c=q=>{h(f=>f.map(R=>k(v({},R),{copies:q})))},z=()=>r.reduce((q,f)=>q+f.copies,0),S=()=>{const q=window.open("","_blank","width=800,height=600");if(!q){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}let f="";r.forEach(R=>{for(let W=0;W<R.copies;W++)f+=`
          <div class="label">
            <div class="qr-section">
              <img src="${R.qrDataUrl}" alt="QR" class="qr-code" />
            </div>
            <div class="info-section">
              <div class="product-name">${R.product.name.length>18?R.product.name.substring(0,18)+"...":R.product.name}</div>
              ${N.showCode?`<div class="product-code">Kod: ${R.product.code}</div>`:""}
              ${N.showPrice?`<div class="product-price">${w(R.product.price)} so'm</div>`:""}
            </div>
          </div>
        `}),q.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Labels - Batch Print</title>
        <style>
          @page {
            size: ${N.width*N.columns+2}mm auto;
            margin: 1mm;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .labels-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1mm;
          }
          .label {
            width: ${N.width}mm;
            height: ${N.height}mm;
            padding: 1.5mm;
            display: flex;
            align-items: center;
            gap: 1.5mm;
            background: white;
            border: 0.2mm solid #ddd;
            page-break-inside: avoid;
          }
          .qr-section {
            flex-shrink: 0;
          }
          .qr-code {
            width: ${N.qrSize}mm;
            height: ${N.qrSize}mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
          }
          .product-name {
            font-size: 6pt;
            font-weight: 700;
            color: #000;
            line-height: 1.1;
            margin-bottom: 0.3mm;
            text-transform: uppercase;
            word-break: break-word;
          }
          .product-code {
            font-size: 5pt;
            color: #333;
            margin-bottom: 0.3mm;
          }
          .product-price {
            font-size: 7pt;
            font-weight: 900;
            color: #000;
          }
          @media print {
            body { background: white; }
            .label { border: none; }
          }
        </style>
      </head>
      <body>
        <div class="labels-container">
          ${f}
        </div>
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 300);
          }
        <\/script>
      </body>
      </html>
    `),q.document.close()};return n?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100]",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-brand-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-surface-600",children:"QR kodlar yaratilmoqda..."})]})}):e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-surface-900",children:"QR Label Chop Etish"}),e.jsxs("p",{className:"text-sm text-surface-500",children:[r.length," ta mahsulot, jami ",z()," ta label"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>$(!P),className:`p-2 rounded-lg transition-colors ${P?"bg-brand-100 text-brand-600":"hover:bg-surface-100"}`,children:e.jsx(_t,{className:"w-5 h-5"})}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-surface-100 rounded-lg",children:e.jsx(be,{className:"w-5 h-5"})})]})]}),P&&e.jsx("div",{className:"p-4 bg-surface-50 border-b border-surface-200",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Eni (mm)"}),e.jsx("input",{type:"number",value:N.width,onChange:q=>p(f=>k(v({},f),{width:Number(q.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"number",value:N.height,onChange:q=>p(f=>k(v({},f),{height:Number(q.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"QR (mm)"}),e.jsx("input",{type:"number",value:N.qrSize,onChange:q=>p(f=>k(v({},f),{qrSize:Number(q.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Ustunlar"}),e.jsx("input",{type:"number",value:N.columns,onChange:q=>p(f=>k(v({},f),{columns:Number(q.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showPrice",checked:N.showPrice,onChange:q=>p(f=>k(v({},f),{showPrice:q.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"showPrice",className:"text-sm",children:"Narx"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showCode",checked:N.showCode,onChange:q=>p(f=>k(v({},f),{showCode:q.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"showCode",className:"text-sm",children:"Kod"})]})]})}),e.jsxs("div",{className:"p-3 border-b border-surface-200 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-surface-500",children:"Barchasi uchun:"}),[1,2,5,10].map(q=>e.jsxs("button",{onClick:()=>c(q),className:"px-3 py-1 text-sm bg-surface-100 hover:bg-surface-200 rounded-lg transition-colors",children:[q," ta"]},q))]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:r.length===0?e.jsx("div",{className:"text-center py-12 text-surface-500",children:"Mahsulotlar yo'q"}):e.jsx("div",{className:"space-y-2",children:r.map((q,f)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-surface-50 rounded-xl",children:[e.jsx("img",{src:q.qrDataUrl,alt:"QR",className:"w-12 h-12 rounded border border-surface-200"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-surface-900 truncate",children:q.product.name}),e.jsxs("div",{className:"text-sm text-surface-500",children:["Kod: ",q.product.code," â€¢ ",w(q.product.price)," so'm"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>M(f,-1),className:"w-8 h-8 flex items-center justify-center bg-surface-200 hover:bg-surface-300 rounded-lg transition-colors",children:e.jsx(dt,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:q.copies,onChange:R=>T(f,Number(R.target.value)),className:"w-14 text-center px-2 py-1 border border-surface-200 rounded-lg",min:1,max:100}),e.jsx("button",{onClick:()=>M(f,1),className:"w-8 h-8 flex items-center justify-center bg-surface-200 hover:bg-surface-300 rounded-lg transition-colors",children:e.jsx(ps,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>D(f),className:"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(be,{className:"w-4 h-4"})})]},q.product._id))})}),e.jsxs("div",{className:"p-4 border-t border-surface-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-surface-500",children:["Jami: ",e.jsx("span",{className:"font-bold text-surface-900",children:z()})," ta label"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 text-surface-600 hover:bg-surface-100 rounded-xl transition-colors",children:"Bekor qilish"}),e.jsxs("button",{onClick:S,disabled:r.length===0,className:"px-6 py-2 bg-brand-600 text-white rounded-xl font-medium hover:bg-brand-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4"}),"Chop etish"]})]})]})]})})},ns={log:(...t)=>{},error:(...t)=>{console.error(...t)},warn:(...t)=>{},info:(...t)=>{},debug:(...t)=>{}};function Ea(){const t=s.useRef(null);return s.useEffect(()=>{const r="http://localhost:8000/api".replace("/api","");console.log("ðŸ”Œ Socket.IO connecting to:",r);const h=kr(r,{transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:5});return h.on("connect",()=>{console.log("âœ… Socket.IO connected:",h.id)}),h.on("disconnect",()=>{console.log("âŒ Socket.IO disconnected")}),h.on("connect_error",n=>{console.error("Socket.IO connection error:",n)}),t.current=h,()=>{h.disconnect()}},[]),t.current}function Gr(){const{showAlert:t,showConfirm:l,AlertComponent:r}=vs(),h=Ea(),[n,g]=s.useState([]),[N,p]=s.useState(1),[P,$]=s.useState(1),[w,j]=s.useState(0),[M,T]=s.useState(!1),[D,c]=s.useState(null),[z,S]=s.useState(!1),[q,f]=s.useState(!1),[R,W]=s.useState(!1),[J,de]=s.useState(!1),[xe,O]=s.useState(new Set),[ke,ee]=s.useState(!1),[Se,ie]=s.useState(!1),[ce,L]=s.useState(null),[ge,B]=s.useState(!1),[Ne,je]=s.useState("7"),[K,Q]=s.useState({total:0,lowStock:0,outOfStock:0,totalValue:0}),[ne,V]=s.useState(null),[he,ye]=s.useState(null),[Fe,Ke]=s.useState(""),[Ue,as]=s.useState(""),[Ve,u]=s.useState("all"),[te,Pe]=s.useState(!0),[$e,le]=s.useState(!1),[Be,x]=s.useState(12500),[pe,we]=s.useState(!1),[Re,De]=s.useState("add"),[Ae,A]=s.useState(""),fe=s.useRef(null);s.useEffect(()=>{const o=setTimeout(()=>{as(Fe)},150);return()=>clearTimeout(o)},[Fe]),s.useEffect(()=>(z||q||R||Se||pe||J?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[z,q,R,Se,pe,J]);const[i,ae]=s.useState({code:"",name:"",description:"",quantity:"",previousPrice:"",currentPrice:"",costPrice:"",costPriceInDollar:"",unitPrice:"",boxPrice:"",pricingTiers:{tier1:{minQuantity:"1",maxQuantity:"5",discountPercent:"15"},tier2:{minQuantity:"6",maxQuantity:"20",discountPercent:"13"},tier3:{minQuantity:"21",maxQuantity:"100",discountPercent:"11"}},unit:"dona",dimensions:{width:"",height:"",length:""},metersPerRoll:"",unitsPerBox:"",meterPriceRanges:[{from:"",to:"",price:""}],pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),[Ce,qe]=s.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[y,U]=s.useState([]),[oe,ve]=s.useState([]),[ss,_e]=s.useState(""),[rs,Xe]=s.useState(!1),Ss=s.useRef(null),zs=()=>{if(!ne)return;const o=document.getElementById("qr-code-svg");if(!o)return;const _=new XMLSerializer().serializeToString(o),Y=document.createElement("canvas"),ue=Y.getContext("2d"),Me=document.createElement("img");Me.onload=()=>{Y.width=Me.width,Y.height=Me.height,ue==null||ue.drawImage(Me,0,0);const Qe=Y.toDataURL("image/png"),Ee=document.createElement("a");Ee.download=`QR-${ne.code}-${ne.name}.png`,Ee.href=Qe,Ee.click()},Me.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(_)))},Cs=o=>E(this,null,function*(){if(o)try{const _=(he==null?void 0:he._id)||"";(yield F.get(`/products/check-code/${o}${_?`?excludeId=${_}`:""}`)).data.exists?_e(`Kod "${o}" allaqachon mavjud`):_e("")}catch(_){ns.error("Error checking code:",_),t("Kod tekshirishda xatolik","Xatolik","danger")}}),js=s.useMemo(()=>{if(!Ue&&Ve==="all")return n;const o=Ue.toLowerCase().trim(),_=o.split(/\s+/).filter(Y=>Y.length>0);return n.filter(Y=>{if(!Ue)return!0;const ue=Y.name.toLowerCase(),Me=Y.code.toLowerCase();return _.length===1?ue.includes(o)||Me.includes(o):_.every(Ze=>ue.includes(Ze)||Me.includes(Ze))?Ve==="all"||Ve==="low"&&Y.quantity<=(Y.minStock||50)&&Y.quantity>0||Ve==="out"&&Y.quantity===0:!1})},[n,Ue,Ve]),Ns=s.useCallback((o=1)=>E(this,null,function*(){var ue,Me,Qe,Ee,Ze;const _=performance.now();/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&console.log("ðŸŽ Safari browser aniqlandi - maxsus optimizatsiyalar faol");try{o===1?Pe(!0):T(!0);const He=Date.now(),Ye=yield F.get(`/products?page=${o}&limit=20&t=${He}`),Le=Ye.data.data||[],Te=Ye.data.pagination||{};console.log(`ðŸ“¦ Sahifa ${o}: ${Le.length} ta mahsulot keldi`);const ms=Le.filter(ds=>!ds||!ds._id?(console.warn("âš ï¸ Mahsulot ID yo'q:",ds),!1):!ds.name||ds.name.trim()===""?(console.warn("âš ï¸ Mahsulot nomi yo'q:",ds._id),!1):!0),Ms=Le.length-ms.length;Ms>0&&console.warn(`âš ï¸ Sahifa ${o}: ${Ms} ta invalid mahsulot o'tkazib yuborildi`);const Ds=performance.now()-_;if(console.log(`âš¡ Sahifa ${o}: ${ms.length}/${Le.length} ta maxsulot ${Math.round(Ds)}ms da yuklandi`),console.log(`ðŸ“Š Pagination: Sahifa ${Te.page}/${Te.pages}, Jami: ${Te.total}`),g(o===1?ms:ds=>[...ds,...ms]),p(Te.page||1),$(Te.pages||1),j(Te.total||0),o===1){const ds=()=>{const _s={total:Te.total||0,lowStock:ms.filter(ws=>ws.quantity<=(ws.minStock||50)&&ws.quantity>0).length,outOfStock:ms.filter(ws=>ws.quantity===0).length,totalValue:ms.reduce((ws,ts)=>{let $s=0;return ts.currentPrice&&ts.currentPrice>0?$s=ts.currentPrice:ts.unitPrice&&ts.unitPrice>0?$s=ts.unitPrice:ts.price&&ts.price>0?$s=ts.price:ts.boxPrice&&ts.boxPrice>0&&ts.unitsPerBox&&ts.unitsPerBox>0?$s=ts.boxPrice/ts.unitsPerBox:ts.previousPrice&&ts.previousPrice>0&&($s=ts.previousPrice),ws+$s*(ts.quantity||0)},0)};console.log("ðŸ’° Client-side jami qiymat:",_s.totalValue),Q(_s)};typeof requestIdleCallback!="undefined"?requestIdleCallback(ds,{timeout:2e3}):setTimeout(ds,100)}}catch(He){console.error("âŒ Mahsulotlarni yuklashda xatolik:",He),console.error("Error details:",{message:He.message,response:(ue=He.response)==null?void 0:ue.data,status:(Me=He.response)==null?void 0:Me.status,stack:He.stack});const Ye=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let Le=((Ee=(Qe=He.response)==null?void 0:Qe.data)==null?void 0:Ee.message)||He.message||"Maxsulotlarni yuklashda xatolik";Ye&&((Ze=He.message)!=null&&Ze.includes("Network"))&&(Le="Internet aloqasini tekshiring. Safari'da ba'zan aloqa muammolari bo'lishi mumkin."),t(Le,"Xatolik","danger"),o===1&&(g([]),Q({total:0,lowStock:0,outOfStock:0,totalValue:0}))}finally{Pe(!1),T(!1)}}),[t]);s.useEffect(()=>{ks(),Ns(1);const o=setTimeout(()=>{xs()},1e3);return()=>clearTimeout(o)},[Ns]),s.useEffect(()=>{if(h)return h.on("product:created",o=>{console.log("ðŸ“¡ Socket: Yangi mahsulot qo'shildi",o),g(_=>[o,..._]),j(_=>_+1),xs()}),h.on("product:updated",o=>{console.log("ðŸ“¡ Socket: Mahsulot yangilandi",o),g(_=>_.map(Y=>Y._id===o._id?o:Y)),xs()}),h.on("product:deleted",o=>{console.log("ðŸ“¡ Socket: Mahsulot o'chirildi",o._id),g(_=>_.filter(Y=>Y._id!==o._id)),j(_=>_-1),xs()}),()=>{h.off("product:created"),h.off("product:updated"),h.off("product:deleted")}},[h]);const xs=()=>E(this,null,function*(){if(!ge){B(!0);try{console.log("ðŸ“Š Statistika yuklanmoqda...");const o=yield F.get("/products/overall-stats");console.log("ðŸ“Š Server statistikasi:",o.data),console.log("ðŸ’° Jami qiymat:",o.data.totalValue),Q(o.data)}catch(o){console.error("Statistikani yuklashda xatolik:",o),o.code==="ECONNABORTED"&&console.warn("âš ï¸ Statistika yuklash juda uzoq davom etdi, keyinroq qayta uriniladi")}finally{B(!1)}}});s.useEffect(()=>{if(N===1&&P>1&&!M){console.log(`ðŸ”„ Background: Qolgan ${P-1} ta sahifa yuklanmoqda...`);const o=setTimeout(()=>E(this,null,function*(){T(!0);for(let _=2;_<=P;_++){console.log(`ðŸ“¥ Sahifa ${_}/${P} yuklanmoqda...`);try{const Me=((yield F.get(`/products?page=${_}&limit=20&t=${Date.now()}`)).data.data||[]).filter(Qe=>!(!Qe||!Qe._id||!Qe.name||Qe.name.trim()===""));g(Qe=>{const Ee=new Set(Qe.map(He=>He._id)),Ze=Me.filter(He=>!Ee.has(He._id));return[...Qe,...Ze]}),p(_),yield new Promise(Qe=>setTimeout(Qe,200))}catch(Y){console.error(`âŒ Sahifa ${_} yuklashda xatolik:`,Y)}}T(!1),console.log(`âœ… Barcha ${P} ta sahifa yuklandi!`)}),500);return()=>clearTimeout(o)}},[N,P,M]);const gs=s.useCallback(()=>{},[]);s.useEffect(()=>{(Ue||Ve!=="all")&&(g([]),p(1),Ns(1))},[Ue,Ve,Ns]),s.useEffect(()=>{const o=fe.current;if(o)return o.addEventListener("scroll",gs),()=>o.removeEventListener("scroll",gs)},[gs]),s.useEffect(()=>{ns.log("Products state updated:",{count:n.length,firstProduct:n.length>0?{_id:n[0]._id,name:n[0].name,code:n[0].code}:null})},[n]);const ks=()=>E(this,null,function*(){try{const o=Date.now(),_=yield F.get(`/warehouses?t=${o}`),ue=(Array.isArray(_.data)?_.data:[]).find(Me=>Me.name==="Asosiy ombor");if(ue)c(ue);else{const Me=yield F.post("/warehouses",{name:"Asosiy ombor",address:""});c(Me.data)}}catch(o){ns.error("Error fetching warehouses:",o),t("Omborlarni yuklashda xatolik","Xatolik","danger"),Pe(!1)}}),d=o=>new Promise((_,Y)=>{const ue=new FileReader;ue.readAsDataURL(o),ue.onload=Me=>{var Ee;const Qe=new Image;Qe.src=(Ee=Me.target)==null?void 0:Ee.result,Qe.onload=()=>{const Ze=document.createElement("canvas");let He=Qe.width,Ye=Qe.height;if(He>1920||Ye>1920){const Te=Math.min(1920/He,1920/Ye);He=Math.round(He*Te),Ye=Math.round(Ye*Te)}Ze.width=He,Ze.height=Ye;const Le=Ze.getContext("2d");if(!Le){Y(new Error("Canvas context not available"));return}Le.drawImage(Qe,0,0,He,Ye),Ze.toBlob(Te=>{Te?_(Te):Y(new Error("Canvas to blob failed"))},"image/jpeg",.8)},Qe.onerror=()=>Y(new Error("Image load failed"))},ue.onerror=()=>Y(new Error("File read failed"))}),re=o=>E(this,null,function*(){const _=o.target.files;if(!_||_.length===0)return;const Y=8-y.length;if(Y<=0){t("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const ue=["image/jpeg","image/jpg","image/png","image/webp"],Me=Array.from(_).filter(Ze=>ue.includes(Ze.type)?!0:(t(`${Ze.name} - noto'g'ri format. Faqat JPG, PNG, WebP qabul qilinadi`,"Xatolik","warning"),!1));if(Me.length===0)return;const Qe=Me.slice(0,Y),Ee=new FormData;le(!0);try{for(const Ye of Qe)try{const Le=yield d(Ye);Ee.append("images",Le,Ye.name)}catch(Le){ns.warn(`Image compression failed for ${Ye.name}, uploading original:`,Le),Ee.append("images",Ye)}const Ze=yield F.post("/products/upload-images",Ee,{headers:{"Content-Type":"multipart/form-data"}}),He=(Ze.data.images||[]).map(Ye=>typeof Ye=="string"?Ye:Ye.path);ve([...oe,...He]),U([...y.map(Ye=>typeof Ye=="string"?Ye:Ye.path),...He]),t(`${Ze.data.images.length} ta rasm muvaffaqiyatli yuklandi`,"Muvaffaqiyat","success")}catch(Ze){ns.error("Error uploading images:",Ze),t("Rasmlarni yuklashda xatolik","Xatolik","danger")}finally{le(!1),Ss.current&&(Ss.current.value="")}}),m=o=>E(this,null,function*(){var _,Y,ue;try{console.log("ðŸ—‘ï¸ Removing image:",{imagePath:o,isNewlyUploaded:oe.includes(o)});const Me=y.map(Ee=>typeof Ee=="string"?Ee:Ee.path).filter(Ee=>Ee!==o);if(U(Me),oe.includes(o)){ve(oe.filter(Ee=>Ee!==o)),t("Rasm o'chirildi (hali saqlanmagan)","Ma'lumot","info");try{yield F.delete("/products/delete-image",{data:{imagePath:o,productId:void 0}}),console.log("âœ… Yangi yuklangan rasm serverdan ham o'chirildi")}catch(Ee){console.warn("Yangi yuklangan rasmni serverdan o'chirishda xatolik:",Ee)}return}const Qe=he==null?void 0:he._id;if(Qe)try{yield F.delete("/products/delete-image",{data:{imagePath:o,productId:Qe}}),t("Rasm o'chirildi","Muvaffaqiyat","success")}catch(Ee){console.warn("Server xatosi:",Ee),((_=Ee.response)==null?void 0:_.status)===404?t("Rasm local state dan o'chirildi","Ma'lumot","info"):t("Rasm local state dan o'chirildi, lekin serverda xatolik","Ogohlantirish","warning")}else t("Rasm o'chirildi","Muvaffaqiyat","success")}catch(Me){ns.error("Error deleting image:",Me);const Qe=((ue=(Y=Me.response)==null?void 0:Y.data)==null?void 0:ue.message)||Me.message||"Rasmni o'chirishda xatolik";t(Qe,"Xatolik","danger")}}),X=o=>{if(o.images&&o.images.length>0){let _=typeof o.images[0]=="string"?o.images[0]:o.images[0].path;if(_.startsWith("http://")||_.startsWith("https://"))try{_=new URL(_).pathname}catch(Y){console.warn("Invalid image URL:",_)}return _.startsWith("/")||(_="/"+_),`${Ts}${_}`}return null},a=o=>E(this,null,function*(){var Qe,Ee,Ze,He,Ye;if(o.preventDefault(),ns.log("Form submit boshlandi. Ma'lumotlar:",{code:i.code,name:i.name,unitPrice:i.unitPrice,currentPrice:i.currentPrice,codeError:ss}),ss){ns.error("Kod xatosi:",ss),t(ss,"Xatolik","danger");return}if(!i.name||!i.name.trim()){ns.error("Tovar nomi bo'sh"),t("Tovar nomi majburiy","Xatolik","danger");return}if(!i.unitPrice&&!i.currentPrice){ns.error("Narx bo'sh"),t("Tovar narxi majburiy","Xatolik","danger");return}let _=Number(i.quantity),Y=null;if(rs&&Ce.packageCount&&Ce.unitsPerPackage){const Le=Number(Ce.packageCount)*Number(Ce.unitsPerPackage);_=he?Number(i.quantity)+Le:Le,Y={packageCount:Number(Ce.packageCount),unitsPerPackage:Number(Ce.unitsPerPackage),totalUnits:Le}}let ue=0,Me=0;i.unit==="rulon"&&i.metersPerRoll&&(ue=_*Number(i.metersPerRoll)),i.unit==="karobka"&&i.unitsPerBox&&(Me=_*Number(i.unitsPerBox));try{const Le={code:i.code,name:i.name,description:i.description||"",price:Number(i.unitPrice)||Number(i.currentPrice),costPrice:Number(i.costPrice)||0,unitPrice:Number(i.unitPrice)||Number(i.currentPrice)||0,boxPrice:Number(i.boxPrice)||0,previousPrice:Number(i.previousPrice)||0,currentPrice:Number(i.currentPrice)||0,pricingTiers:{tier1:{minQuantity:Number(i.pricingTiers.tier1.minQuantity)||1,maxQuantity:Number(i.pricingTiers.tier1.maxQuantity)||5,discountPercent:Number(i.pricingTiers.tier1.discountPercent)||15},tier2:{minQuantity:Number(i.pricingTiers.tier2.minQuantity)||6,maxQuantity:Number(i.pricingTiers.tier2.maxQuantity)||20,discountPercent:Number(i.pricingTiers.tier2.discountPercent)||13},tier3:{minQuantity:Number(i.pricingTiers.tier3.minQuantity)||21,maxQuantity:Number(i.pricingTiers.tier3.maxQuantity)||100,discountPercent:Number(i.pricingTiers.tier3.discountPercent)||11}},quantity:_,warehouse:D==null?void 0:D._id,images:y,packageInfo:Y,unit:i.unit,costPriceInDollar:Number(i.costPriceInDollar)||0,dollarRate:Be,dimensions:{width:i.dimensions.width||"",height:i.dimensions.height||"",length:i.dimensions.length||""},metersPerRoll:Number(i.metersPerRoll)||0,unitsPerBox:Number(i.unitsPerBox)||0,totalMeters:ue,totalUnits:Me,meterPriceRanges:i.meterPriceRanges.filter(Te=>Te.from&&Te.to&&Te.price).map(Te=>({from:Number(Te.from),to:Number(Te.to),price:Number(Te.price)})),prices:{perUnit:Number(i.unitPrice)||Number(i.currentPrice),perRoll:Number(i.pricePerRoll)||0,perBox:Number(i.boxPrice)||Number(i.pricePerBox)||0,perKg:Number(i.pricePerKg)||0,perGram:Number(i.pricePerGram)||0}};if(ns.log("Tovar serverga yuborilmoqda:",{code:Le.code,name:Le.name,warehouse:Le.warehouse,quantity:Le.quantity,price:Le.price}),he){const Te=yield F.put(`/products/${he._id}`,Le);if(ns.log("Tovar yangilandi:",he._id),Te.data&&Te.data._id){const ms=k(v({},Te.data),{warehouse:Te.data.warehouse||D,images:Te.data.images||y||[]});g(Ms=>{const Ds=Ms.map(ds=>ds._id===he._id?ms:ds);return Ds.sort((ds,_s)=>{const ws=new Date(ds.createdAt||0).getTime();return new Date(_s.createdAt||0).getTime()-ws}),Ds}),ns.log("Tovar darhol UI da yangilandi:",Te.data.name)}}else{const Te=yield F.post("/products",Le);if(ns.log("Tovar serverdan qaytdi:",Te.data),ns.log("Tovar rasmlar:",Te.data.images),Te.data&&Te.data._id){const ms=k(v({},Te.data),{warehouse:Te.data.warehouse||D,images:Te.data.images||y||[]});ns.log("UI ga qo'shilayotgan tovar:",{_id:ms._id,name:ms.name,images:ms.images,imagesCount:((Qe=ms.images)==null?void 0:Qe.length)||0}),g(Ms=>[ms,...Ms]),ns.log("Yangi tovar darhol UI ga qo'shildi:",Te.data.name),Ke(""),u("all")}}cs(),us(),t(he?"Tovar yangilandi":"Tovar qo'shildi","Muvaffaqiyat","success"),xs()}catch(Le){ns.error("Error adding/updating product:",Le);const Te=((Ze=(Ee=Le.response)==null?void 0:Ee.data)==null?void 0:Ze.message)||Le.message||"Xatolik yuz berdi";ns.error("Error details:",{status:(He=Le.response)==null?void 0:He.status,message:Te,data:(Ye=Le.response)==null?void 0:Ye.data}),t(Te,"Xatolik","danger")}}),C=o=>E(this,null,function*(){if(yield l("Tovarni o'chirishni tasdiqlaysizmi?","O'chirish"))try{yield F.delete(`/products/${o}`),g(Y=>Y.filter(ue=>ue._id!==o)),ns.log("Tovar UI dan o'chirildi:",o),t("Tovar o'chirildi","Muvaffaqiyat","success"),xs()}catch(Y){ns.error("Error deleting product:",Y),t("Tovarni o'chirishda xatolik","Xatolik","danger")}}),I=o=>{var Y,ue,Me,Qe,Ee,Ze,He,Ye,Le,Te,ms,Ms,Ds,ds,_s,ws,ts,$s,mt,xt,ut,ht,pt,ft,bt,We;ye(o);const _=o;x(_.dollarRate||12500),ae({code:o.code,name:o.name,description:_.description||"",previousPrice:String(_.previousPrice||0),currentPrice:String(_.currentPrice||o.price),costPrice:String(_.costPrice||0),costPriceInDollar:String(_.costPriceInDollar||0),unitPrice:String(_.unitPrice||_.currentPrice||o.price),boxPrice:String(_.boxPrice||0),pricingTiers:{tier1:{minQuantity:String(((ue=(Y=_.pricingTiers)==null?void 0:Y.tier1)==null?void 0:ue.minQuantity)||1),maxQuantity:String(((Qe=(Me=_.pricingTiers)==null?void 0:Me.tier1)==null?void 0:Qe.maxQuantity)||5),discountPercent:String(((Ze=(Ee=_.pricingTiers)==null?void 0:Ee.tier1)==null?void 0:Ze.discountPercent)||15)},tier2:{minQuantity:String(((Ye=(He=_.pricingTiers)==null?void 0:He.tier2)==null?void 0:Ye.minQuantity)||6),maxQuantity:String(((Te=(Le=_.pricingTiers)==null?void 0:Le.tier2)==null?void 0:Te.maxQuantity)||20),discountPercent:String(((Ms=(ms=_.pricingTiers)==null?void 0:ms.tier2)==null?void 0:Ms.discountPercent)||13)},tier3:{minQuantity:String(((ds=(Ds=_.pricingTiers)==null?void 0:Ds.tier3)==null?void 0:ds.minQuantity)||21),maxQuantity:String(((ws=(_s=_.pricingTiers)==null?void 0:_s.tier3)==null?void 0:ws.maxQuantity)||100),discountPercent:String((($s=(ts=_.pricingTiers)==null?void 0:ts.tier3)==null?void 0:$s.discountPercent)||11)}},quantity:String(o.quantity),unit:o.unit||"dona",dimensions:{width:((mt=_.dimensions)==null?void 0:mt.width)||"",height:((xt=_.dimensions)==null?void 0:xt.height)||"",length:((ut=_.dimensions)==null?void 0:ut.length)||""},metersPerRoll:String(_.metersPerRoll||""),unitsPerBox:String(_.unitsPerBox||""),meterPriceRanges:((ht=_.meterPriceRanges)==null?void 0:ht.length)>0?_.meterPriceRanges.map(Ks=>({from:String(Ks.from||""),to:String(Ks.to||""),price:String(Ks.price||"")})):[{from:"",to:"",price:""}],pricePerRoll:String(((pt=o.prices)==null?void 0:pt.perRoll)||""),pricePerBox:String(((ft=o.prices)==null?void 0:ft.perBox)||""),pricePerKg:String(((bt=o.prices)==null?void 0:bt.perKg)||""),pricePerGram:String(((We=o.prices)==null?void 0:We.perGram)||"")}),U((_.images||[]).map(Ks=>typeof Ks=="string"?Ks:Ks.path)),qe({packageCount:"",unitsPerPackage:"",totalCost:""}),_e(""),Xe(!1),S(!0)},H=o=>{V(o),f(!0)},G=o=>{O(_=>{const Y=new Set(_);return Y.has(o)?Y.delete(o):Y.add(o),Y})},Z=()=>{xe.size===js.length?O(new Set):O(new Set(js.map(o=>o._id)))},se=()=>{if(xe.size===0){t("Kamida bitta mahsulot tanlang","Ogohlantirish","warning");return}W(!0)},me=()=>{ee(!1),O(new Set)},ze=o=>E(this,null,function*(){var _,Y,ue,Me,Qe,Ee,Ze,He,Ye,Le,Te,ms,Ms,Ds,ds,_s,ws,ts,$s,mt,xt,ut,ht,pt,ft,bt;try{S(!0),ye(null);const We=o;x(We.dollarRate||12500);const Ks=F.get("/products/next-code");ae({code:"",name:o.name,description:We.description||"",previousPrice:String(We.previousPrice||0),currentPrice:String(We.currentPrice||o.price),costPrice:String(We.costPrice||0),costPriceInDollar:String(We.costPriceInDollar||0),unitPrice:String(We.unitPrice||We.currentPrice||o.price),boxPrice:String(We.boxPrice||0),pricingTiers:{tier1:{minQuantity:String(((Y=(_=We.pricingTiers)==null?void 0:_.tier1)==null?void 0:Y.minQuantity)||1),maxQuantity:String(((Me=(ue=We.pricingTiers)==null?void 0:ue.tier1)==null?void 0:Me.maxQuantity)||5),discountPercent:String(((Ee=(Qe=We.pricingTiers)==null?void 0:Qe.tier1)==null?void 0:Ee.discountPercent)||15)},tier2:{minQuantity:String(((He=(Ze=We.pricingTiers)==null?void 0:Ze.tier2)==null?void 0:He.minQuantity)||6),maxQuantity:String(((Le=(Ye=We.pricingTiers)==null?void 0:Ye.tier2)==null?void 0:Le.maxQuantity)||20),discountPercent:String(((ms=(Te=We.pricingTiers)==null?void 0:Te.tier2)==null?void 0:ms.discountPercent)||13)},tier3:{minQuantity:String(((Ds=(Ms=We.pricingTiers)==null?void 0:Ms.tier3)==null?void 0:Ds.minQuantity)||21),maxQuantity:String(((_s=(ds=We.pricingTiers)==null?void 0:ds.tier3)==null?void 0:_s.maxQuantity)||100),discountPercent:String(((ts=(ws=We.pricingTiers)==null?void 0:ws.tier3)==null?void 0:ts.discountPercent)||11)}},quantity:"0",unit:o.unit||"dona",dimensions:{width:(($s=We.dimensions)==null?void 0:$s.width)||"",height:((mt=We.dimensions)==null?void 0:mt.height)||"",length:((xt=We.dimensions)==null?void 0:xt.length)||""},metersPerRoll:String(We.metersPerRoll||""),unitsPerBox:String(We.unitsPerBox||""),meterPriceRanges:((ut=We.meterPriceRanges)==null?void 0:ut.length)>0?We.meterPriceRanges.map(As=>({from:String(As.from||""),to:String(As.to||""),price:String(As.price||"")})):[{from:"",to:"",price:""}],pricePerRoll:String(((ht=o.prices)==null?void 0:ht.perRoll)||""),pricePerBox:String(((pt=o.prices)==null?void 0:pt.perBox)||""),pricePerKg:String(((ft=o.prices)==null?void 0:ft.perKg)||""),pricePerGram:String(((bt=o.prices)==null?void 0:bt.perGram)||"")}),U((We.images||[]).map(As=>typeof As=="string"?As:As.path)),qe({packageCount:"",unitsPerPackage:"",totalCost:""}),_e(""),Xe(!1);try{const As=yield Ks;ae(_a=>k(v({},_a),{code:As.data.code}))}catch(As){ns.error("Error getting next code:",As),t("Keyingi kodni olishda xatolik","Xatolik","danger")}t("Mahsulot nusxalandi. Kerakli o'zgarishlarni kiriting va saqlang.","Muvaffaqiyat","success")}catch(We){ns.error("Error copying product:",We),t("Mahsulotni nusxalashda xatolik","Xatolik","danger")}}),Ie=o=>E(this,null,function*(){if(ne){je(o),B(!0);try{const _=yield F.get(`/products/stats/${ne._id}?period=${o}`);L(_.data)}catch(_){ns.error("Error fetching product stats:",_),t("Statistikani yuklashda xatolik","Xatolik","danger")}finally{B(!1)}}}),cs=()=>{S(!1)},us=()=>{ye(null),x(12500),U([]),_e(""),Xe(!1),ae({code:"",name:"",description:"",quantity:"",previousPrice:"",currentPrice:"",costPrice:"",costPriceInDollar:"",unitPrice:"",boxPrice:"",pricingTiers:{tier1:{minQuantity:"1",maxQuantity:"5",discountPercent:"15"},tier2:{minQuantity:"6",maxQuantity:"20",discountPercent:"13"},tier3:{minQuantity:"21",maxQuantity:"100",discountPercent:"11"}},unit:"dona",dimensions:{width:"",height:"",length:""},metersPerRoll:"",unitsPerBox:"",meterPriceRanges:[{from:"",to:"",price:""}],pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),qe({packageCount:"",unitsPerPackage:"",totalCost:""}),U([]),ve([]),_e(""),Xe(!1)},Is=o=>{De(o),A(""),we(!0)},La=()=>{const o=Number(Ae)||0;if(o<=0)return;const _=Number(i.quantity)||0;let Y=Re==="add"?_+o:_-o;Y<0&&(Y=0),ae(k(v({},i),{quantity:String(Y)})),we(!1),A("")},da=()=>E(this,null,function*(){us(),S(!0),U([]),_e(""),Xe(!1);try{const o=yield F.get("/products/next-code");ae(_=>k(v({},_),{code:o.data.code}))}catch(o){ns.error("Error getting next code:",o),t("Keyingi kodni olishda xatolik","Xatolik","danger")}}),St=s.useMemo(()=>({total:K.total||n.length||0,lowStock:K.lowStock||0,outOfStock:K.outOfStock||0,totalValue:K.totalValue||0}),[K,n.length]),Ia=[{label:"Jami tovarlar",value:St.total,icon:Oe,color:"brand",filter:"all"},{label:"Kam qolgan",value:St.lowStock,icon:qs,color:"warning",filter:"low"},{label:"Tugagan",value:St.outOfStock,icon:be,color:"danger",filter:"out"},{label:"Jami qiymat",value:`${b(St.totalValue)} so'm`,icon:os,color:"success",filter:null}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100 pb-20 lg:pb-0",children:[r,e.jsx(Fs,{title:"Tovarlar",showSearch:!0,onSearch:Ke,actions:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>Ns(),className:"flex items-center justify-center p-0.5 rounded bg-purple-50 hover:bg-purple-100 text-purple-600 hover:text-purple-700 transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Tovarlarni qayta yuklash",children:e.jsx(gt,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),ke?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Z,className:"flex items-center justify-center px-2 py-0.5 rounded text-xs bg-purple-50 hover:bg-purple-100 text-purple-600 hover:text-purple-700 transition-all duration-200 flex-shrink-0 font-medium",style:{height:"24px",minHeight:"24px"},children:xe.size===js.length?"Bekor":"Barchasi"}),e.jsxs("button",{onClick:se,className:"flex items-center justify-center gap-1 px-2 py-0.5 rounded text-xs bg-brand-500 hover:bg-brand-600 text-white transition-all duration-200 flex-shrink-0 font-medium disabled:opacity-50 disabled:cursor-not-allowed",style:{height:"24px",minHeight:"24px"},disabled:xe.size===0,children:[e.jsx(et,{className:"w-3 h-3",style:{width:"12px",height:"12px"}}),e.jsx("span",{children:xe.size})]}),e.jsx("button",{onClick:me,className:"flex items-center justify-center p-0.5 rounded bg-surface-200 hover:bg-surface-300 transition-all duration-200 flex-shrink-0",style:{width:"24px",height:"24px",minWidth:"24px",minHeight:"24px"},children:e.jsx(be,{className:"w-3 h-3",style:{width:"12px",height:"12px"}})})]}):e.jsx("button",{onClick:()=>ee(!0),className:"flex items-center justify-center p-0.5 rounded bg-blue-50 hover:bg-blue-100 text-blue-600 hover:text-blue-700 transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Bir nechta QR chiqarish",children:e.jsx(Za,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),e.jsxs("button",{onClick:da,className:"flex items-center gap-1 px-2 py-1 rounded bg-brand-500 hover:bg-brand-600 text-white transition-all duration-200 flex-shrink-0",style:{minHeight:"28px"},children:[e.jsx(ps,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),e.jsx("span",{className:"text-[10px] sm:text-xs font-medium",children:"Qo'shish"})]})]})}),e.jsxs("div",{className:"p-2 sm:p-3 md:p-4 lg:p-6 space-y-3 sm:space-y-4 md:space-y-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 md:gap-5",children:Ia.map((o,_)=>e.jsx("div",{onClick:()=>o.filter&&u(o.filter),className:`bg-white rounded-xl sm:rounded-2xl border-2 transition-all ${o.filter?"cursor-pointer hover:shadow-lg hover:scale-[1.02]":""} ${Ve===o.filter?"border-brand-500 shadow-md":"border-surface-200"}`,children:e.jsxs("div",{className:"p-3 sm:p-4 md:p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-2.5 mb-2 sm:mb-3",children:[e.jsx("div",{className:`w-10 h-10 sm:w-11 sm:h-11 md:w-12 md:h-12 rounded-xl flex items-center justify-center bg-${o.color}-50`,children:e.jsx(o.icon,{className:`w-5 h-5 sm:w-5.5 sm:h-5.5 md:w-6 md:h-6 text-${o.color}-600`})}),e.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-surface-500 font-medium",children:o.label})]}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-surface-900 truncate",children:o.value})]})},_))}),te?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):js.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Oe,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Tovarlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md mb-6",children:Fe?"Qidiruv bo'yicha tovarlar topilmadi":"Birinchi tovarni qo'shing"}),e.jsx("button",{onClick:da,className:"btn-primary",children:"Tovar qo'shish"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:fe,className:"space-y-2 sm:space-y-2.5 md:space-y-3",children:js.map(o=>{const _=xe.has(o._id),Y=X(o);return e.jsxs("div",{className:`group relative bg-white rounded-lg sm:rounded-xl transition-all duration-200 hover:shadow-lg ${_?"shadow-md ring-2 ring-brand-500":"shadow-sm hover:shadow-md"}`,children:[e.jsxs("div",{className:"absolute top-1.5 right-1.5 flex items-center gap-1 z-10",children:[e.jsx("button",{onClick:ue=>{ue.stopPropagation(),ze(o)},className:"w-7 h-7 sm:w-8 sm:h-8 bg-blue-50 hover:bg-blue-100 rounded-lg transition-none text-blue-600 flex items-center justify-center hover:scale-110 shadow-sm hover:shadow-md",title:"Mahsulotni nusxalash",children:e.jsx(Na,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5"})}),e.jsx("button",{onClick:ue=>{ue.stopPropagation(),H(o)},className:"w-7 h-7 sm:w-8 sm:h-8 bg-purple-50 hover:bg-purple-100 rounded-lg transition-none text-purple-600 flex items-center justify-center hover:scale-110 shadow-sm hover:shadow-md",title:"QR kod",children:e.jsx(yt,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5"})}),e.jsx("button",{onClick:ue=>{ue.stopPropagation(),I(o)},className:"w-7 h-7 sm:w-8 sm:h-8 bg-amber-50 hover:bg-amber-100 rounded-lg transition-none text-amber-600 flex items-center justify-center hover:scale-110 shadow-sm hover:shadow-md",title:"Tahrirlash",children:e.jsx(Zs,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5"})}),e.jsx("button",{onClick:ue=>{ue.stopPropagation(),C(o._id)},className:"w-7 h-7 sm:w-8 sm:h-8 bg-red-50 hover:bg-red-100 rounded-lg transition-none text-red-600 flex items-center justify-center hover:scale-110 shadow-sm hover:shadow-md",title:"O'chirish",children:e.jsx(Ps,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5"})})]}),ke&&e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx("input",{type:"checkbox",checked:_,onChange:()=>G(o._id),className:"w-4 h-4 sm:w-5 sm:h-5 rounded border-2 cursor-pointer"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 md:gap-4 p-2 sm:p-3 md:p-4",children:[e.jsx("div",{className:"relative w-full sm:w-24 md:w-28 h-28 sm:h-24 md:h-28 rounded-lg sm:rounded-xl overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100 cursor-pointer flex-shrink-0 shadow-sm",onClick:()=>{Y&&(V(o),de(!0))},children:Y?e.jsx("img",{src:Y,alt:o.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Oe,{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 text-slate-300"})})}),e.jsxs("div",{className:"flex-1 min-w-0 px-2 pb-2 sm:p-0",children:[e.jsxs("div",{className:"text-xs sm:text-sm font-mono text-slate-500 mb-1 sm:mb-1.5",children:["#",o.code]}),e.jsxs("h3",{className:"font-semibold text-base sm:text-lg md:text-xl text-slate-900 mb-1.5 sm:mb-2 line-clamp-2",children:[o.name,o.description&&o.description.trim()&&e.jsx("span",{className:"text-base sm:text-lg md:text-xl font-semibold text-slate-900 ml-1.5",children:o.description})]}),e.jsxs("div",{className:"flex items-baseline gap-1 sm:gap-1.5",children:[e.jsx("span",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-brand-600",children:b(o.unitPrice||o.price)}),e.jsx("span",{className:"text-sm sm:text-base text-slate-500",children:"so'm"})]})]})]})]},o._id)})}),N>=P&&!M&&js.length>0&&e.jsx("div",{className:"flex justify-center items-center py-6 mt-4",children:e.jsxs("div",{className:"text-slate-400 text-sm",children:["âœ… Barcha maxsulotlar yuklandi (",w," ta)"]})})]})]}),z&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-3 sm:p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/70 via-purple-900/30 to-black/70 backdrop-blur-sm transition-opacity duration-100",onClick:cs,style:{animation:"fadeIn 0.1s ease-out"}}),e.jsxs("form",{onSubmit:a,className:"relative z-10 bg-white rounded-3xl w-full max-w-xs sm:max-w-sm md:max-w-2xl max-h-[90vh] overflow-hidden shadow-[0_20px_60px_-15px_rgba(0,0,0,0.4)] border border-white/20 transform",style:{animation:"modalSlideUp 0.1s ease-out",willChange:"transform, opacity"},children:[e.jsx("div",{className:"sticky top-0 z-10 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 px-4 sm:px-6 py-4 sm:py-5 border-b border-white/20 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white flex items-center gap-2 mb-1",children:he?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(Zs,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),"Tovarni tahrirlash"]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(ps,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),"Yangi tovar qo'shish"]})}),e.jsx("p",{className:"text-xs sm:text-sm text-white/90 font-medium",children:he?"Tovar ma'lumotlarini yangilang":"Yangi tovar ma'lumotlarini kiriting"})]}),e.jsx("button",{type:"button",onClick:cs,className:"p-2 sm:p-2.5 hover:bg-white/20 rounded-xl transition-all duration-300 hover:rotate-90 hover:scale-110 active:scale-95 group ml-3",children:e.jsx(be,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white group-hover:text-white/90"})})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-180px)] p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Rasmlar (max 8 ta - JPG, PNG, WebP)"}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-1 sm:gap-2 mb-1 sm:mb-2",children:[y.map((o,_)=>{let Y=typeof o=="string"?o:o.path;if(Y.startsWith("http://")||Y.startsWith("https://"))try{Y=new URL(Y).pathname}catch(ue){console.warn("Invalid image URL:",Y)}return Y.startsWith("/")||(Y="/"+Y),e.jsxs("div",{className:"relative aspect-square group bg-surface-100 rounded-lg overflow-hidden",children:[e.jsx("img",{src:`${Ts}${Y}`,alt:`Rasm ${_+1}`,loading:"lazy",decoding:"async",className:"w-full h-full object-cover",style:{contentVisibility:"auto"}}),e.jsx("button",{type:"button",onClick:()=>m(Y),className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2 w-7 h-7 sm:w-8 sm:h-8 bg-red-500 hover:bg-red-600 text-white rounded-lg sm:rounded-xl flex items-center justify-center shadow-lg hover:shadow-xl transition-all hover:scale-110 z-10 opacity-90 hover:opacity-100",title:"Rasmni o'chirish",children:e.jsx(be,{className:"w-4 h-4 sm:w-5 sm:h-5",strokeWidth:2.5})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors pointer-events-none"})]},_)}),y.length<8&&e.jsx("button",{type:"button",onClick:()=>{var o;return(o=Ss.current)==null?void 0:o.click()},disabled:$e,className:"aspect-square border-2 border-dashed border-surface-300 rounded-lg flex flex-col items-center justify-center hover:border-brand-500 hover:bg-brand-50 transition-colors cursor-pointer group disabled:opacity-50 disabled:cursor-not-allowed",children:$e?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"spinner w-4 h-4 sm:w-5 sm:h-5 text-brand-600"}),e.jsx("span",{className:"text-[8px] sm:text-[9px] text-brand-600 font-semibold",children:"Yuklash..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(vt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-surface-400 mb-0.5 sm:mb-1 group-hover:text-brand-500 transition-colors"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-surface-500 text-center px-0.5 group-hover:text-brand-600 transition-colors",children:"Rasm"})]})})]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-surface-500 mb-2 sm:mb-3",children:"ðŸ’¡ Telefondan rasm olib qo'ysangiz, avtomatik sifati yaxshi bo'lib qo'yiladi. Bir vaqtning o'zida bir nechta rasmni yuklash mumkin."}),e.jsx("input",{ref:Ss,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",multiple:!0,capture:"environment",onChange:re,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input text-sm ${ss?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"1",value:i.code,onChange:o=>ae(k(v({},i),{code:o.target.value})),onBlur:o=>Cs(o.target.value),required:!0}),ss&&e.jsx("p",{className:"text-xs text-danger-600 mt-0.5 sm:mt-1",children:ss})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"Tovar nomi",value:i.name,onChange:o=>ae(k(v({},i),{name:o.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Qisqacha izoh (ixtiyoriy)"}),e.jsx("textarea",{className:"input min-h-[60px] sm:min-h-[80px] resize-none text-sm",placeholder:"Mahsulot haqida qisqacha ma'lumot...",value:i.description||"",onChange:o=>ae(k(v({},i),{description:o.target.value})),maxLength:500}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-surface-400 mt-0.5 sm:mt-1",children:[(i.description||"").length,"/500"]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 sm:pt-3 md:pt-4 mt-2 sm:mt-3 md:mt-4",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-semibold text-surface-900 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(xa,{className:"w-3 h-3 sm:w-4 sm:h-4 text-brand-600"}),"O'lchamlar (ixtiyoriy)"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Eni (sm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"50",value:i.dimensions.width,onChange:o=>ae(k(v({},i),{dimensions:k(v({},i.dimensions),{width:o.target.value})}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:i.dimensions.height,onChange:o=>ae(k(v({},i),{dimensions:k(v({},i.dimensions),{height:o.target.value})}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Uzunligi (sm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"100",value:i.dimensions.length,onChange:o=>ae(k(v({},i),{dimensions:k(v({},i.dimensions),{length:o.target.value})}))})]})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 sm:pt-3 md:pt-4 mt-2 sm:mt-3 md:mt-4",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-semibold text-surface-900 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(xa,{className:"w-3 h-3 sm:w-4 sm:h-4 text-brand-600"}),"O'lchov birligi va Miqdor"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 mb-2 sm:mb-4",children:[e.jsxs("div",{className:"w-full sm:w-1/3",children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Birlik"}),e.jsxs("select",{className:"input text-sm",value:i.unit,onChange:o=>ae(k(v({},i),{unit:o.target.value})),children:[e.jsx("option",{value:"dona",children:"Dona"}),e.jsx("option",{value:"metr",children:"Metr"}),e.jsx("option",{value:"rulon",children:"Rulon"}),e.jsx("option",{value:"karobka",children:"Karobka"}),e.jsx("option",{value:"kg",children:"Kilogram"}),e.jsx("option",{value:"gram",children:"Gram"}),e.jsx("option",{value:"litr",children:"Litr"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:["Miqdor (",i.unit==="dona"?"dona":i.unit==="metr"?"metr":i.unit==="rulon"?"rulon":i.unit==="karobka"?"karobka":i.unit==="kg"?"kg":i.unit==="gram"?"gram":"litr",")"]}),he?e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("div",{className:"flex-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-surface-100 rounded-lg text-center font-semibold text-surface-900 text-sm",children:b(i.quantity||0)}),e.jsx("button",{type:"button",onClick:()=>Is("add"),className:"btn-icon-sm bg-success-100 text-success-600 hover:bg-success-200",children:e.jsx(ps,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{type:"button",onClick:()=>Is("subtract"),className:"btn-icon-sm bg-danger-100 text-danger-600 hover:bg-danger-200",children:e.jsx(dt,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}):e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:ls(i.quantity),onChange:o=>ae(k(v({},i),{quantity:Je(o.target.value)})),required:!0})]})]}),i.unit==="metr"&&e.jsxs("div",{className:"bg-purple-50 rounded-xl p-3 mb-3 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"ðŸŽžï¸ 1 rulonda necha metr?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:i.metersPerRoll,onChange:o=>ae(k(v({},i),{metersPerRoll:Je(o.target.value)}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"Rulon narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:ls(i.pricePerRoll),onChange:o=>ae(k(v({},i),{pricePerRoll:Je(o.target.value)}))})]})]}),i.metersPerRoll&&i.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(gt,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"text-sm font-semibold text-purple-700",children:[i.quantity," metr = ",(Number(i.quantity)/Number(i.metersPerRoll)).toFixed(1)," rulon"]})]})]}),i.unit==="dona"&&e.jsxs("div",{className:"bg-orange-50 rounded-xl p-3 mb-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"ðŸ“¦ 1 karobkada necha dona?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"12",value:i.unitsPerBox,onChange:o=>ae(k(v({},i),{unitsPerBox:Je(o.target.value)}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"Karobka narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:ls(i.pricePerBox),onChange:o=>ae(k(v({},i),{pricePerBox:Je(o.target.value)}))})]})]}),i.unitsPerBox&&i.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(gt,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-sm font-semibold text-orange-700",children:[i.quantity," dona = ",(Number(i.quantity)/Number(i.unitsPerBox)).toFixed(1)," karobka"]})]})]}),i.unit==="rulon"&&e.jsxs("div",{className:"bg-purple-50 rounded-xl p-3 mb-3 border border-purple-200",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"1 rulonda necha metr?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:i.metersPerRoll,onChange:o=>ae(k(v({},i),{metersPerRoll:Je(o.target.value)}))})]})}),i.metersPerRoll&&i.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(gt,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"text-sm font-semibold text-purple-700",children:[i.quantity," rulon = ",b(Number(i.quantity)*Number(i.metersPerRoll))," metr"]})]})]}),i.unit==="karobka"&&e.jsxs("div",{className:"bg-orange-50 rounded-xl p-3 mb-3 border border-orange-200",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"1 karobkada necha dona?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"12",value:i.unitsPerBox,onChange:o=>ae(k(v({},i),{unitsPerBox:Je(o.target.value)}))})]})}),i.unitsPerBox&&i.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(gt,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-sm font-semibold text-orange-700",children:[i.quantity," karobka = ",b(Number(i.quantity)*Number(i.unitsPerBox))," dona"]})]})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 sm:pt-3 md:pt-4 mt-2 sm:mt-3 md:mt-4",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-semibold text-surface-900 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(os,{className:"w-3 h-3 sm:w-4 sm:h-4 text-green-600"}),"Narxlar (5 ta)"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 mb-2 sm:mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"ðŸ’µ Tan narxi (Dollar)"}),e.jsxs("div",{className:"flex gap-1 sm:gap-2",children:[e.jsx("input",{type:"text",className:"input flex-1 text-sm",placeholder:"0.00",value:i.costPriceInDollar,onChange:o=>{const _=o.target.value.replace(/[^0-9.]/g,""),Y=_.split("."),ue=Y.length>2?Y[0]+"."+Y.slice(1).join(""):_,Me=parseFloat(ue)||0;ae(k(v({},i),{costPriceInDollar:ue,costPrice:(Me*Be).toString()}))}}),e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-surface-600 flex items-center px-1.5 sm:px-2 bg-surface-100 rounded",children:"$"})]}),e.jsxs("p",{className:"text-[9px] sm:text-[10px] text-surface-500 mt-0.5 sm:mt-1",children:["= ",b((parseFloat(i.costPriceInDollar)||0)*Be)," so'm"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"ðŸ·ï¸ Dona narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:ls(i.unitPrice),onChange:o=>ae(k(v({},i),{unitPrice:Je(o.target.value)})),required:!0})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 mb-3 border border-blue-200",children:[e.jsx("label",{className:"text-xs font-medium text-blue-700 mb-1 block",children:"ðŸ’± Dollar kursi (1 $ = ? so'm)"}),e.jsx("input",{type:"number",className:"input",placeholder:"12500",step:"1",min:"0",value:Be,onChange:o=>x(parseFloat(o.target.value)||12500)}),e.jsxs("p",{className:"text-[10px] text-blue-600 mt-1",children:["Hozirgi kurs: 1 $ = ",b(Be)," so'm"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"ðŸ“¦ Karobka narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:ls(i.boxPrice),onChange:o=>ae(k(v({},i),{boxPrice:Je(o.target.value)}))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-green-50 rounded-xl p-2.5 border border-emerald-200 shadow-sm",children:[e.jsx("h5",{className:"text-[11px] font-semibold text-emerald-800 mb-2 flex items-center gap-1",children:"ðŸŽ¯ Chegirmalar"}),e.jsxs("div",{className:"bg-white rounded-2xl p-2 mb-1.5 border border-emerald-100 flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[9px] font-bold text-emerald-700 bg-emerald-100 px-2 py-0.5 rounded-full",children:"1"}),e.jsx("span",{className:"text-[9px] text-emerald-500 font-medium",children:"Birinci daraja"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] justify-center",children:[e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"1",value:i.pricingTiers.tier1.minQuantity,onChange:o=>ae(k(v({},i),{pricingTiers:k(v({},i.pricingTiers),{tier1:k(v({},i.pricingTiers.tier1),{minQuantity:o.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"-"}),e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"5",value:i.pricingTiers.tier1.maxQuantity,onChange:o=>ae(k(v({},i),{pricingTiers:k(v({},i.pricingTiers),{tier1:k(v({},i.pricingTiers.tier1),{maxQuantity:o.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"="}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center font-bold rounded-2xl border-indigo-300 bg-indigo-50/60 text-indigo-700 focus:border-indigo-500 focus:ring-indigo-200",placeholder:"15",value:i.pricingTiers.tier1.discountPercent,onChange:o=>ae(k(v({},i),{pricingTiers:k(v({},i.pricingTiers),{tier1:k(v({},i.pricingTiers.tier1),{discountPercent:o.target.value})})}))}),e.jsx("span",{className:"text-[11px] font-bold text-indigo-600",children:"%"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-2 mb-1.5 border border-blue-100 flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[9px] font-bold text-blue-700 bg-blue-100 px-2 py-0.5 rounded-full",children:"2"}),e.jsx("span",{className:"text-[9px] text-blue-500 font-medium",children:"Ikkinchi daraja"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] justify-center",children:[e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"6",value:i.pricingTiers.tier2.minQuantity,onChange:o=>ae(k(v({},i),{pricingTiers:k(v({},i.pricingTiers),{tier2:k(v({},i.pricingTiers.tier2),{minQuantity:o.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"-"}),e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"20",value:i.pricingTiers.tier2.maxQuantity,onChange:o=>ae(k(v({},i),{pricingTiers:k(v({},i.pricingTiers),{tier2:k(v({},i.pricingTiers.tier2),{maxQuantity:o.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"="}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center font-bold rounded-2xl border-indigo-300 bg-indigo-50/60 text-indigo-700 focus:border-indigo-500 focus:ring-indigo-200",placeholder:"13",value:i.pricingTiers.tier2.discountPercent,onChange:o=>ae(k(v({},i),{pricingTiers:k(v({},i.pricingTiers),{tier2:k(v({},i.pricingTiers.tier2),{discountPercent:o.target.value})})}))}),e.jsx("span",{className:"text-[11px] font-bold text-indigo-600",children:"%"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-2 border border-purple-100 flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[9px] font-bold text-purple-700 bg-purple-100 px-2 py-0.5 rounded-full",children:"3"}),e.jsx("span",{className:"text-[9px] text-purple-500 font-medium",children:"Uchinchi daraja"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] justify-center",children:[e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"21",value:i.pricingTiers.tier3.minQuantity,onChange:o=>ae(k(v({},i),{pricingTiers:k(v({},i.pricingTiers),{tier3:k(v({},i.pricingTiers.tier3),{minQuantity:o.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"-"}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"100",value:i.pricingTiers.tier3.maxQuantity,onChange:o=>ae(k(v({},i),{pricingTiers:k(v({},i.pricingTiers),{tier3:k(v({},i.pricingTiers.tier3),{maxQuantity:o.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"="}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center font-bold rounded-2xl border-indigo-300 bg-indigo-50/60 text-indigo-700 focus:border-indigo-500 focus:ring-indigo-200",placeholder:"11",value:i.pricingTiers.tier3.discountPercent,onChange:o=>ae(k(v({},i),{pricingTiers:k(v({},i.pricingTiers),{tier3:k(v({},i.pricingTiers.tier3),{discountPercent:o.target.value})})}))}),e.jsx("span",{className:"text-[11px] font-bold text-indigo-600",children:"%"})]})]}),e.jsx("p",{className:"text-[10px] text-emerald-600 mt-2 italic",children:"* Masalan: 1-5 dona = 15% chegirma, 6-20 dona = 13% chegirma, 21-100 dona = 11% chegirma"})]}),e.jsxs("div",{className:"mt-4 mb-4 hidden",children:[e.jsxs("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:[i.unit==="metr"?"ðŸ“ Metr narxi":i.unit==="rulon"?"ðŸŽžï¸ Rulon narxi":i.unit==="karobka"?"ðŸ“¦ Karobka narxi":i.unit==="kg"?"âš–ï¸ Kg narxi":i.unit==="gram"?"âš–ï¸ Gram narxi":i.unit==="litr"?"ðŸ’§ Litr narxi":"ðŸ’° Dona narxi"," (so'm)"]}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:ls(i.currentPrice),onChange:o=>ae(k(v({},i),{currentPrice:Je(o.target.value)}))})]}),(i.unit==="metr"||i.unit==="rulon")&&e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 mb-3 border border-blue-200",children:[e.jsx("label",{className:"text-xs font-medium text-blue-700 mb-2 block",children:"ðŸ“ Metr narxlari (diapazon bo'yicha)"}),i.meterPriceRanges.map((o,_)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",className:"input text-sm w-16",placeholder:"1",value:o.from,onChange:Y=>{const ue=[...i.meterPriceRanges];ue[_].from=Y.target.value,ae(k(v({},i),{meterPriceRanges:ue}))}}),e.jsx("input",{type:"text",className:"input text-sm w-16",placeholder:"10",value:o.to,onChange:Y=>{const ue=[...i.meterPriceRanges];ue[_].to=Y.target.value,ae(k(v({},i),{meterPriceRanges:ue}))}}),e.jsx("input",{type:"text",className:"input text-sm flex-1",placeholder:"Narx",value:ls(o.price),onChange:Y=>{const ue=[...i.meterPriceRanges];ue[_].price=Je(Y.target.value),ae(k(v({},i),{meterPriceRanges:ue}))}}),e.jsx("span",{className:"text-xs text-blue-600",children:"so'm"}),i.meterPriceRanges.length>1&&e.jsx("button",{type:"button",onClick:()=>{const Y=i.meterPriceRanges.filter((ue,Me)=>Me!==_);ae(k(v({},i),{meterPriceRanges:Y}))},className:"w-6 h-6 bg-red-100 text-red-600 rounded flex items-center justify-center hover:bg-red-200",children:e.jsx(be,{className:"w-3 h-3"})})]},_)),e.jsxs("button",{type:"button",onClick:()=>ae(k(v({},i),{meterPriceRanges:[...i.meterPriceRanges,{from:"",to:"",price:""}]})),className:"text-xs text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1",children:[e.jsx(ps,{className:"w-3 h-3"})," Diapazon qo'shish"]})]}),i.unit==="kg"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"âš–ï¸ Kg narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:ls(i.pricePerKg),onChange:o=>ae(k(v({},i),{pricePerKg:Je(o.target.value)}))})]})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-gradient-to-r from-slate-50 via-blue-50 to-purple-50 px-4 sm:px-6 py-4 sm:py-5 border-t border-slate-200/50 shadow-[0_-10px_30px_-10px_rgba(0,0,0,0.1)] backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsxs("button",{type:"button",onClick:cs,className:"px-5 sm:px-7 py-2.5 sm:py-3 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-semibold hover:bg-slate-50 hover:border-slate-400 hover:shadow-md transition-all duration-300 hover:scale-105 active:scale-95 flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Bekor qilish"}),e.jsx("span",{className:"sm:hidden",children:"Bekor"})]}),e.jsxs("button",{type:"submit",disabled:!!ss||$e,className:"px-6 sm:px-10 py-2.5 sm:py-3 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 text-white rounded-xl font-bold hover:from-blue-700 hover:via-purple-700 hover:to-blue-700 transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg hover:shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center gap-2 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"}),e.jsx(Rt,{className:"w-4 h-4 sm:w-5 sm:h-5 relative z-10"}),e.jsx("span",{className:"relative z-10",children:he?"Yangilash":"Saqlash"})]})]})})]})]}),q&&ne&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>f(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 max-h-[90vh] overflow-y-auto rounded-t-2xl sm:rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 sticky top-0 bg-white pb-2 -mt-2 pt-2 border-b border-surface-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"QR Label - Xprinter"}),e.jsx("button",{onClick:()=>f(!1),className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Jr,{productId:ne._id,code:ne.code,name:ne.name,price:ne.price,unit:ne.unit,dimensions:ne.dimensions?[ne.dimensions.width,ne.dimensions.height,ne.dimensions.length].filter(Boolean).join(" Ã— "):"",labelWidth:60,labelHeight:40,copies:1,onPrint:()=>f(!1)}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-surface-200 w-full",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-3 text-center",children:"Katta QR (yuklab olish uchun)"}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-white p-3 rounded-xl border border-surface-200",children:e.jsx(Qt,{id:"qr-code-svg",value:`${ca}/product/${ne._id}`,size:150,level:"H",includeMargin:!0})})}),e.jsxs("button",{onClick:zs,className:"btn-secondary w-full",children:[e.jsx(na,{className:"w-4 h-4"}),"PNG yuklab olish"]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg text-xs text-blue-700 w-full",children:[e.jsx("p",{className:"font-medium mb-1",children:"ðŸ“‹ Xprinter sozlamalari:"}),e.jsxs("ul",{className:"space-y-0.5",children:[e.jsx("li",{children:"â€¢ Label o'lchami: 40mm x 30mm"}),e.jsx("li",{children:"â€¢ QR o'lchami: 20mm x 20mm"}),e.jsx("li",{children:"â€¢ Margins: None"})]})]})]})]})]}),pe&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>we(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-[71]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:Re==="add"?"Miqdor qo'shish":"Miqdor ayirish"}),e.jsx("button",{onClick:()=>we(!1),className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${Re==="add"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Hozirgi miqdor"}),e.jsxs("p",{className:`text-2xl font-bold ${Re==="add"?"text-success-600":"text-danger-600"}`,children:[b(i.quantity||0)," dona"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:Re==="add"?"Qo'shiladigan miqdor":"Ayiriladigan miqdor"}),e.jsx("input",{type:"text",className:"input text-center text-lg font-semibold",placeholder:"0",value:ls(Ae),onChange:o=>A(Je(o.target.value)),autoFocus:!0})]}),Ae&&Number(Ae)>0&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Yangi miqdor"}),e.jsxs("p",{className:"text-xl font-bold text-surface-900",children:[b(Re==="add"?(Number(i.quantity)||0)+Number(Ae):Math.max(0,(Number(i.quantity)||0)-Number(Ae)))," dona"]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>we(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"button",onClick:La,className:`flex-1 ${Re==="add"?"btn-success":"btn-danger"}`,disabled:!Ae||Number(Ae)<=0,children:Re==="add"?"Qo'shish":"Ayirish"})]})]})]})]}),Se&&ne&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-3 sm:p-4 bg-black/50 backdrop-blur-sm",children:[e.jsx("div",{className:"overlay",onClick:()=>ie(!1)}),e.jsxs("div",{className:"modal w-full max-w-3xl p-4 sm:p-5 relative z-50 max-h-[90vh] overflow-y-auto bg-white rounded-xl shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-surface-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[X(ne)?e.jsx("img",{src:X(ne),alt:ne.name,className:"w-20 h-20 sm:w-24 sm:h-24 rounded-xl object-cover border-2 border-brand-200 shadow-lg"}):e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-brand-500 to-indigo-600 rounded-xl flex items-center justify-center",children:e.jsx(Oe,{className:"w-10 h-10 sm:w-12 sm:h-12 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-surface-900",children:ne.name}),e.jsx("p",{className:"text-sm sm:text-base text-surface-500",children:"Sotuv statistikasi"})]})]}),e.jsx("button",{onClick:()=>ie(!1),className:"btn-icon-sm",children:e.jsx(be,{className:"w-4 h-4"})})]}),ge?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-3"}),e.jsx("p",{className:"text-sm text-surface-500",children:"Yuklanmoqda..."})]}):ce?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-3 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-md flex items-center justify-center",children:e.jsx(hs,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 uppercase tracking-wide",children:"Sotilgan"})]}),e.jsx("p",{className:"text-xl font-bold text-blue-700 mb-0.5",children:b(ce.stats.totalSold)}),e.jsxs("p",{className:"text-[10px] text-blue-500",children:[ce.stats.totalReceipts," ta chek"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-3 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-md flex items-center justify-center",children:e.jsx(ta,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-green-600 uppercase tracking-wide",children:"Daromad"})]}),e.jsx("p",{className:"text-xl font-bold text-green-700 mb-0.5",children:b(ce.stats.totalRevenue)}),e.jsx("p",{className:"text-[10px] text-green-500",children:"so'm"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-3 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-purple-500 rounded-md flex items-center justify-center",children:e.jsx(Bs,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 uppercase tracking-wide",children:"Top kun"})]}),ce.stats.bestDay?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-base font-bold text-purple-700 mb-0.5",children:ce.stats.bestDay.date}),e.jsxs("p",{className:"text-[10px] text-purple-500",children:[ce.stats.bestDay.count," dona"]})]}):e.jsx("p",{className:"text-xs text-purple-500",children:"Ma'lumot yo'q"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-orange-500 rounded-md flex items-center justify-center",children:e.jsx(it,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-orange-600 uppercase tracking-wide",children:"Top soat"})]}),ce.stats.bestHour?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-base font-bold text-orange-700 mb-0.5",children:ce.stats.bestHour.label}),e.jsxs("p",{className:"text-[10px] text-orange-500",children:[ce.stats.bestHour.count," dona"]})]}):e.jsx("p",{className:"text-xs text-orange-500",children:"Ma'lumot yo'q"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-surface-200 p-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-surface-900 mb-3 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(it,{className:"w-3 h-3 text-brand-600"})}),"Soatlik statistika"]}),e.jsx("div",{className:"flex items-end gap-0.5 h-24",children:ce.hourlyStats.map((o,_)=>{var Qe;const Y=Math.max(...ce.hourlyStats.map(Ee=>Ee.count),1),ue=o.count/Y*100,Me=((Qe=ce.stats.bestHour)==null?void 0:Qe.hour)===o.hour;return e.jsxs("div",{className:"flex-1 flex flex-col items-center group relative",children:[e.jsx("div",{className:`w-full rounded-t transition-all ${Me?"bg-gradient-to-t from-orange-500 to-amber-400":"bg-gradient-to-t from-brand-500 to-brand-400"} hover:opacity-80`,style:{height:`${Math.max(ue,3)}%`}}),e.jsx("span",{className:"text-[7px] text-surface-400 mt-0.5",children:o.hour}),e.jsxs("div",{className:"absolute bottom-full mb-1 hidden group-hover:block bg-surface-900 text-white text-[10px] px-1.5 py-0.5 rounded whitespace-nowrap z-10",children:[o.label,": ",o.count]})]},_)})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-surface-200 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-surface-900 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(Bs,{className:"w-3 h-3 text-brand-600"})}),"Sotuv tarixi"]}),e.jsx("div",{className:"flex gap-1",children:[{value:"7",label:"7"},{value:"30",label:"30"},{value:"90",label:"90"},{value:"365",label:"1y"},{value:"all",label:"All"}].map(o=>e.jsx("button",{onClick:()=>Ie(o.value),className:`px-2 py-1 text-[10px] font-semibold rounded transition-all ${Ne===o.value?"bg-brand-600 text-white shadow-sm":"bg-surface-100 text-surface-600 hover:bg-surface-200"}`,children:o.label},o.value))})]}),(Ne==="365"||Ne==="all")&&ce.monthlyStats&&ce.monthlyStats.length>0?e.jsx("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:ce.monthlyStats.map((o,_)=>{const Y=Math.max(...ce.monthlyStats.map(Me=>Me.count),1),ue=o.count/Y*100;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-surface-600 w-16 flex-shrink-0 font-medium",children:o.label}),e.jsx("div",{className:"flex-1 bg-surface-100 rounded-full h-5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-brand-500 to-indigo-500 rounded-full flex items-center justify-end pr-1.5 transition-all",style:{width:`${Math.max(ue,4)}%`},children:o.count>0&&e.jsx("span",{className:"text-[9px] font-bold text-white",children:o.count})})}),e.jsx("span",{className:"text-[10px] text-surface-500 w-20 text-right",children:b(o.revenue)})]},_)})}):e.jsx("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:ce.periodStats&&ce.periodStats.slice(-30).map((o,_)=>{const Y=Math.max(...ce.periodStats.map(Me=>Me.count),1),ue=o.count/Y*100;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-surface-600 w-14 flex-shrink-0 font-medium",children:new Date(o.date).toLocaleDateString("uz-UZ",{day:"numeric",month:"short"})}),e.jsx("div",{className:"flex-1 bg-surface-100 rounded-full h-5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-brand-500 to-indigo-500 rounded-full flex items-center justify-end pr-1.5 transition-all",style:{width:`${Math.max(ue,4)}%`},children:o.count>0&&e.jsx("span",{className:"text-[9px] font-bold text-white",children:o.count})})}),e.jsx("span",{className:"text-[10px] text-surface-500 w-20 text-right",children:b(o.revenue)})]},_)})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-surface-200 p-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-surface-900 mb-3 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(hs,{className:"w-3 h-3 text-brand-600"})}),"Oxirgi sotuvlar"]}),ce.recentSales.length>0?e.jsx("div",{className:"overflow-x-auto max-h-48 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"sticky top-0 bg-white",children:e.jsxs("tr",{className:"border-b border-surface-200",children:[e.jsx("th",{className:"text-left py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Sana"}),e.jsx("th",{className:"text-center py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Miqdor"}),e.jsx("th",{className:"text-right py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Narx"}),e.jsx("th",{className:"text-right py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Jami"}),e.jsx("th",{className:"text-left py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Mijoz"})]})}),e.jsx("tbody",{children:ce.recentSales.map((o,_)=>{var Y;return e.jsxs("tr",{className:"border-b border-surface-100 hover:bg-surface-50",children:[e.jsx("td",{className:"py-1.5 px-2 text-surface-700 text-[10px]",children:new Date(o.date).toLocaleString("uz-UZ",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"py-1.5 px-2 text-center",children:e.jsx("span",{className:"px-1.5 py-0.5 bg-brand-100 text-brand-700 rounded-full text-[10px] font-semibold",children:o.quantity})}),e.jsx("td",{className:"py-1.5 px-2 text-right text-surface-600 text-[10px]",children:b(o.price)}),e.jsx("td",{className:"py-1.5 px-2 text-right font-semibold text-surface-900 text-[10px]",children:b(o.total)}),e.jsx("td",{className:"py-1.5 px-2 text-surface-600 text-[10px]",children:((Y=o.customer)==null?void 0:Y.name)||"Noma'lum"})]},_)})})]})}):e.jsxs("div",{className:"text-center py-6 text-surface-500",children:[e.jsx(hs,{className:"w-8 h-8 mx-auto mb-1.5 text-surface-300"}),e.jsx("p",{className:"text-xs",children:"Hali sotuvlar yo'q"})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-surface-500",children:[e.jsx(Tt,{className:"w-12 h-12 mx-auto mb-2 text-surface-300"}),e.jsx("p",{className:"text-sm",children:"Statistika topilmadi"})]})]})]}),J&&ne&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 animate-fade-in",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm transition-all duration-300",onClick:()=>de(!1)}),e.jsxs("div",{className:"relative z-10 max-w-4xl w-full max-h-[90vh] animate-scale-in",children:[e.jsx("button",{onClick:()=>de(!1),className:"absolute -top-12 right-0 w-10 h-10 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center transition-all hover:rotate-90 group",children:e.jsx(be,{className:"w-6 h-6 text-white group-hover:scale-110 transition-transform"})}),e.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-brand-600 to-purple-600",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:ne.name}),e.jsxs("p",{className:"text-sm text-white/80",children:["#",ne.code]})]}),e.jsx("div",{className:"p-4 max-h-[70vh] overflow-y-auto",children:ne.images&&ne.images.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:ne.images.map((o,_)=>{const Y=typeof o=="string"?o:o.path;return e.jsx("img",{src:`${Ts}${Y}`,alt:`${ne.name} - ${_+1}`,className:"w-full h-auto rounded-lg shadow-lg"},_)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-surface-400",children:[e.jsx(Oe,{className:"w-16 h-16 mb-4"}),e.jsx("p",{children:"Rasm mavjud emas"})]})})]})]})]}),R&&e.jsx(Vr,{products:n.filter(o=>xe.has(o._id)),onClose:()=>{W(!1),ee(!1),O(new Set)}})]})}function Zr(){const{showAlert:t,showConfirm:l,AlertComponent:r}=vs(),[h,n]=s.useState([]),[g,N]=s.useState(!1),[p,P]=s.useState(!1),[$,w]=s.useState(!1),[j,M]=s.useState(null),[T,D]=s.useState([]),[c,z]=s.useState(null),[S,q]=s.useState(null),[f,R]=s.useState(!0),[W,J]=s.useState(!1),[de,xe]=s.useState(""),[O,ke]=s.useState(!1),[ee,Se]=s.useState(null),[ie,ce]=s.useState({name:"",address:""}),[L,ge]=s.useState({code:"",name:"",costPrice:"",wholesalePrice:"",quantity:""}),[B,Ne]=s.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[je,K]=s.useState("");s.useEffect(()=>{Q()},[]);const Q=()=>E(this,null,function*(){try{const pe=(yield F.get("/warehouses")).data.filter(we=>we.name!=="Asosiy ombor");n(pe)}catch(x){console.error("Error fetching warehouses:",x)}finally{R(!1)}}),ne=x=>E(this,null,function*(){J(!0);try{const pe=yield F.get(`/products?warehouse=${x}`);D(pe.data)}catch(pe){console.error("Error fetching products:",pe)}finally{J(!1)}}),V=x=>E(this,null,function*(){x.preventDefault();try{c?yield F.put(`/warehouses/${c._id}`,ie):yield F.post("/warehouses",ie),Q(),Ve()}catch(pe){console.error("Error saving warehouse:",pe)}}),he=x=>E(this,null,function*(){var Re,De;if(x.preventDefault(),!j)return;if(je){t(je,"Xatolik","danger");return}let pe=0,we=Number(L.costPrice)||0;if(B.packageCount&&B.unitsPerPackage){const Ae=Number(B.packageCount)*Number(B.unitsPerPackage);pe=S?S.quantity+Ae:Ae}else S&&(pe=S.quantity);try{const Ae={code:L.code,name:L.name,costPrice:we,price:Number(L.wholesalePrice),quantity:pe,warehouse:j._id};S?yield F.put(`/products/${S._id}`,Ae):yield F.post("/products",Ae),ne(j._id),te()}catch(Ae){t(((De=(Re=Ae.response)==null?void 0:Re.data)==null?void 0:De.message)||"Xatolik yuz berdi","Xatolik","danger")}}),ye=x=>E(this,null,function*(){if((yield l("Tovarni o'chirishni tasdiqlaysizmi?","O'chirish"))&&j)try{yield F.delete(`/products/${x}`),ne(j._id)}catch(we){console.error("Error deleting product:",we)}}),Fe=x=>E(this,null,function*(){if(yield l("Omborni o'chirishni tasdiqlaysizmi?","O'chirish"))try{yield F.delete(`/warehouses/${x}`),Q()}catch(we){console.error("Error deleting warehouse:",we)}}),Ke=x=>{M(x),ne(x._id),P(!0)},Ue=x=>{z(x),ce({name:x.name,address:x.address||""}),N(!0)},as=x=>{q(x),ge({code:x.code,name:x.name,costPrice:String(x.costPrice||0),wholesalePrice:String(x.price),quantity:String(x.quantity)}),K(""),w(!0)},Ve=()=>{N(!1),z(null),ce({name:"",address:""})},u=()=>{P(!1),M(null),D([]),xe("")},te=()=>{w(!1),q(null),ge({code:"",name:"",costPrice:"",wholesalePrice:"",quantity:""}),Ne({packageCount:"",unitsPerPackage:"",totalCost:""}),K("")},Pe=()=>E(this,null,function*(){try{const x=yield F.get("/products/next-code");ge(k(v({},L),{code:x.data.code,name:"",costPrice:"",wholesalePrice:"",quantity:""}))}catch(x){console.error("Error getting next code:",x)}Ne({packageCount:"",unitsPerPackage:"",totalCost:""}),K(""),w(!0)}),$e=x=>E(this,null,function*(){if(x)try{const pe=(S==null?void 0:S._id)||"";(yield F.get(`/products/check-code/${x}${pe?`?excludeId=${pe}`:""}`)).data.exists?K(`Kod "${x}" allaqachon mavjud`):K("")}catch(pe){console.error("Error checking code:",pe)}}),le=x=>{Se(x),ke(!0)},Be=()=>{if(!ee)return;const x=document.getElementById("qr-code-svg-warehouse");if(!x)return;const pe=new XMLSerializer().serializeToString(x),we=document.createElement("canvas"),Re=we.getContext("2d"),De=new Image;De.onload=()=>{we.width=De.width,we.height=De.height,Re==null||Re.drawImage(De,0,0);const Ae=we.toDataURL("image/png"),A=document.createElement("a");A.download=`QR-${ee.code}-${ee.name}.png`,A.href=Ae,A.click()},De.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(pe)))};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsx(Fs,{title:"Omborlar",actions:e.jsxs("button",{onClick:()=>N(!0),className:"btn-primary",children:[e.jsx(ps,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi ombor"})]})}),e.jsx("div",{className:"p-4 lg:p-6",children:f?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):h.length===0?e.jsxs("div",{className:"card flex flex-col items-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Wt,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Omborlar yo'q"}),e.jsx("p",{className:"text-surface-500 mb-6",children:"Birinchi omborni qo'shing"}),e.jsx("button",{onClick:()=>N(!0),className:"btn-primary",children:"Ombor qo'shish"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(x=>e.jsxs("div",{className:"card-hover cursor-pointer",onClick:()=>Ke(x),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(Wt,{className:"w-6 h-6 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-surface-900",children:x.name}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-surface-500",children:[e.jsx(Et,{className:"w-3 h-3"}),e.jsx("span",{children:x.address||"Manzil ko'rsatilmagan"})]})]})]}),e.jsxs("div",{className:"flex gap-1",onClick:pe=>pe.stopPropagation(),children:[e.jsx("button",{onClick:()=>Ue(x),className:"btn-icon-sm hover:bg-brand-100 hover:text-brand-600",children:e.jsx(Zs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Fe(x._id),className:"btn-icon-sm hover:bg-danger-100 hover:text-danger-600",children:e.jsx(Ps,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500 pt-3 border-t border-surface-100",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsxs("span",{children:[x.productCount||0," ta tovar"]})]})]},x._id))})}),g&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:Ve}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:c?"Omborni tahrirlash":"Yangi ombor"}),e.jsx("button",{onClick:Ve,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:V,className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Ombor nomi"}),e.jsx("input",{type:"text",className:"input",placeholder:"Ombor nomi",value:ie.name,onChange:x=>ce(k(v({},ie),{name:x.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Manzil"}),e.jsxs("div",{className:"relative",children:[e.jsx(Et,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-12",placeholder:"Manzilni kiriting",value:ie.address,onChange:x=>ce(k(v({},ie),{address:x.target.value}))})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:Ve,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Saqlash"})]})]})})]})]}),p&&j&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-2 lg:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:u}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-[98vw] lg:max-w-[95vw] relative z-10 flex flex-col max-h-[96vh] lg:max-h-[94vh]",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 lg:p-6 gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:j.name}),e.jsx("p",{className:"text-sm text-surface-500 truncate",children:"Ombordagi tovarlar"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Qidirish...",value:de,onChange:x=>xe(x.target.value),className:"w-48 lg:w-64 pl-9 pr-4 py-2 bg-surface-50 border border-surface-200 rounded-xl text-sm focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"})]}),e.jsxs("button",{onClick:Pe,className:"btn-primary",children:[e.jsx(ps,{className:"w-4 h-4"}),"Tovar qo'shish"]}),e.jsx("button",{onClick:u,className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:W?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):T.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Oe,{className:"w-12 h-12 text-surface-300 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Bu omborga tovarlar yo'q"}),e.jsx("button",{onClick:Pe,className:"btn-primary mt-4",children:"Tovar qo'shish"})]}):e.jsx("div",{className:"divide-y divide-surface-100",children:T.filter(x=>de===""||x.name.toLowerCase().includes(de.toLowerCase())||x.code.toLowerCase().includes(de.toLowerCase())).map(x=>e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(Oe,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:x.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",x.code]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-surface-500",children:["Tan narxi: ",b(x.costPrice||0)," so'm"]}),e.jsxs("p",{className:"font-semibold text-surface-900",children:["Optom: ",b(x.price)," so'm"]}),e.jsxs("p",{className:`text-sm ${x.quantity===0?"text-danger-600":"text-surface-500"}`,children:[x.quantity," dona"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>le(x),className:"btn-icon-sm hover:bg-surface-200",title:"QR kod",children:e.jsx(yt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>as(x),className:"btn-icon-sm hover:bg-brand-100 hover:text-brand-600",children:e.jsx(Zs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ye(x._id),className:"btn-icon-sm hover:bg-danger-100 hover:text-danger-600",children:e.jsx(Ps,{className:"w-4 h-4"})})]})]})]},x._id))})})]})]}),$&&j&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:te}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-lg relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:S?"Tovarni tahrirlash":"Yangi tovar"}),e.jsxs("p",{className:"text-sm text-surface-500 truncate",children:[j.name," uchun"]})]}),e.jsx("button",{onClick:te,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:he,className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input ${je?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"000001",value:L.code,onChange:x=>ge(k(v({},L),{code:x.target.value})),onBlur:x=>$e(x.target.value),required:!0}),je&&e.jsx("p",{className:"text-sm text-danger-600 mt-1",children:je})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input",placeholder:"Tovar nomi",value:L.name,onChange:x=>ge(k(v({},L),{name:x.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Tan narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:ls(L.costPrice),onChange:x=>ge(k(v({},L),{costPrice:Je(x.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Optom narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:ls(L.wholesalePrice),onChange:x=>ge(k(v({},L),{wholesalePrice:Je(x.target.value)})),required:!0})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4",children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-3 block",children:"Qop ma'lumotlari"}),e.jsx("div",{className:"space-y-3 bg-surface-50 p-4 rounded-xl",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Qoplar soni"}),e.jsx("input",{type:"number",className:"input text-sm",placeholder:"5",value:B.packageCount,onChange:x=>Ne(k(v({},B),{packageCount:x.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Har qopda"}),e.jsx("input",{type:"number",className:"input text-sm",placeholder:"20",value:B.unitsPerPackage,onChange:x=>Ne(k(v({},B),{unitsPerPackage:x.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Jami mahsulot"}),e.jsx("input",{type:"text",className:"input text-sm bg-surface-100",placeholder:"0",value:B.packageCount&&B.unitsPerPackage?b(Number(B.packageCount)*Number(B.unitsPerPackage)):"",readOnly:!0})]})]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:te,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:!!je,children:"Saqlash"})]})]})})]})]}),O&&ee&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>ke(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-sm relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900",children:"QR Kod"}),e.jsx("button",{onClick:()=>ke(!1),className:"flex-shrink-0 btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 flex flex-col items-center",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border border-surface-200 mb-4",children:e.jsx(Qt,{id:"qr-code-svg-warehouse",value:JSON.stringify({id:ee._id,code:ee.code,name:ee.name,price:ee.price}),size:200,level:"H",includeMargin:!0})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-semibold text-surface-900",children:ee.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",ee.code]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Tan narxi: ",b(ee.costPrice||0)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Optom: ",b(ee.price)," so'm"]})]}),e.jsxs("button",{onClick:Be,className:"btn-primary w-full",children:[e.jsx(na,{className:"w-4 h-4"}),"Yuklab olish"]})]})})]})]})]})}const Lt={"Toshkent shahri":["Bektemir","Chilonzor","Mirobod","Mirzo Ulug'bek","Olmazor","Sergeli","Shayxontohur","Uchtepa","Yakkasaroy","Yunusobod","Yashnobod"],"Toshkent viloyati":["Angren","Bekobod","Bo'ka","Bo'stonliq","Chinoz","Chirchiq","Nurafshon","Ohangaron","Olmaliq","Oqqo'rg'on","Parkent","Piskent","Qibray","Quyi Chirchiq","Toshkent","Yangiyo'l","Yuqori Chirchiq","Zangiota"],"Andijon viloyati":["Andijon","Asaka","Baliqchi","Bo'z","Buloqboshi","Izboskan","Jalaquduq","Xo'jaobod","Qo'rg'ontepa","Marhamat","Oltinko'l","Paxtaobod","Shahrixon","Ulug'nor","Xonobod"],"Buxoro viloyati":["Buxoro","G'ijduvon","Jondor","Kogon","Olot","Peshku","Qorako'l","Qorovulbozor","Romitan","Shofirkon","Vobkent"],"Farg'ona viloyati":["Farg'ona","Bag'dod","Beshariq","Buvayda","Dang'ara","Furqat","Qo'qon","Quva","Marg'ilon","Oltiariq","Qo'shtepa","Rishton","So'x","Toshloq","Uchko'prik","Yozyovon"],"Jizzax viloyati":["Jizzax","Arnasoy","Baxmal","Do'stlik","Forish","G'allaorol","Mirzacho'l","Paxtakor","Yangiobod","Zafarobod","Zarband","Zomin"],"Xorazm viloyati":["Urganch","Bog'ot","Gurlan","Xonqa","Hazorasp","Xiva","Qo'shko'pir","Shovot","Tuproqqal'a","Yangiariq","Yangibozor"],"Namangan viloyati":["Namangan","Chortoq","Chust","Kosonsoy","Mingbuloq","Norin","Pop","To'raqo'rg'on","Uchqo'rg'on","Uychi","Yangiqo'rg'on"],"Navoiy viloyati":["Navoiy","Karmana","Konimex","Navbahor","Nurota","Qiziltepa","Tomdi","Uchquduq","Xatirchi","Zarafshon"],"Qashqadaryo viloyati":["Qarshi","Chiroqchi","Dehqonobod","G'uzor","Kasbi","Kitob","Koson","Mirishkor","Muborak","Nishon","Qamashi","Shahrisabz","Yakkabog'"],"Qoraqalpog'iston":["Nukus","Amudaryo","Beruniy","Chimboy","Ellikqal'a","Kegeyli","Mo'ynoq","Nukus tumani","Qanliko'l","Qo'ng'irot","Shumanay","Taxtako'pir","To'rtko'l","Xo'jayli"],"Samarqand viloyati":["Samarqand","Bulung'ur","Ishtixon","Jomboy","Kattaqo'rg'on","Narpay","Nurobod","Oqdaryo","Past darg'om","Payariq","Paxtachi","Qo'shrabot","Toyloq","Urgut"],"Sirdaryo viloyati":["Guliston","Boyovut","Mirzaobod","Oqoltin","Sardoba","Sayxunobod","Sirdaryo","Xovos","Yangiyer"],"Surxondaryo viloyati":["Termiz","Angor","Bandixon","Boysun","Denov","Jarqo'rg'on","Muzrabot","Oltinsoy","Qiziriq","Qumqo'rg'on","Sariosiyo","Sherobod","Sho'rchi","Uzun"]},Vt=Object.keys(Lt);function en(){var Ne,je;const{showConfirm:t,showAlert:l,AlertComponent:r}=vs(),[h,n]=s.useState([]),[g,N]=s.useState(!0),[p,P]=s.useState(!1),[$,w]=s.useState(null),[j,M]=s.useState(""),[T,D]=s.useState(null),[c,z]=s.useState({name:"",phone:"",region:"",district:""}),[S,q]=s.useState(""),[f,R]=s.useState(""),[W,J]=s.useState(!1),[de,xe]=s.useState("name");s.useEffect(()=>{O()},[]);const O=()=>E(this,null,function*(){try{const K=yield F.get("/customers");n(K.data)}catch(K){console.error(K),l("Mijozlarni yuklashda xatolik","Xatolik","danger")}finally{N(!1)}}),ke=K=>E(this,null,function*(){K.preventDefault();try{const Q={name:c.name,phone:c.phone,address:c.region&&c.district?`${c.region}, ${c.district}`:""};$?(yield F.put(`/customers/${$._id}`,Q),l("Mijoz yangilandi","Muvaffaqiyat","success")):(yield F.post("/customers",Q),l("Mijoz qo'shildi","Muvaffaqiyat","success")),O(),ie()}catch(Q){console.error(Q),l("Xatolik yuz berdi","Xatolik","danger")}}),ee=K=>E(this,null,function*(){if(yield t("Mijozni o'chirishni tasdiqlaysizmi?","O'chirish")){D(K);try{yield F.delete(`/customers/${K}`),n(h.filter(ne=>ne._id!==K)),l("Mijoz o'chirildi","Muvaffaqiyat","success"),setTimeout(()=>{D(null)},2e3)}catch(ne){D(null),console.error(ne),l("Xatolik yuz berdi","Xatolik","danger")}}}),Se=K=>{w(K);const Q=(K.address||"").split(", ");z({name:K.name,phone:K.phone,region:Q[0]||"",district:Q[1]||""}),P(!0)},ie=()=>{P(!1),w(null),z({name:"",phone:"",region:"",district:""})},ce=h.filter(K=>{const Q=j.trim()===""||K.name.toLowerCase().includes(j.toLowerCase())||K.phone.includes(j);let ne=!0;if(S){const V=(K.address||"").split(", "),he=V[0]||"",ye=V[1]||"";ne=he===S,ne&&f&&(ne=ye===f)}return Q&&ne}).sort((K,Q)=>de==="debt"?(Q.debt||0)-(K.debt||0):de==="purchases"?(Q.totalPurchases||0)-(K.totalPurchases||0):K.name.localeCompare(Q.name)),L={total:h.length,withDebt:h.filter(K=>K.debt>0).length,totalDebt:h.reduce((K,Q)=>K+(Q.debt||0),0),totalPurchases:h.reduce((K,Q)=>K+(Q.totalPurchases||0),0)},ge=()=>S?f?`${S}, ${f}`:S:"Barcha hududlar",B=()=>{q(""),R("")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100 pb-20 lg:pb-0",children:[r,e.jsx(Fs,{title:"Mijozlar",showSearch:!0,onSearch:M,actions:e.jsxs("button",{onClick:()=>P(!0),className:"btn-primary",children:[e.jsx(ps,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi mijoz"})]})}),e.jsxs("div",{className:"max-w-[1800px] mx-auto p-4 lg:p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-3 lg:gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Jami"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Os,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-blue-600"})})]}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-slate-900",children:L.total}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"mijozlar"})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Qarzli"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(ra,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-red-600"})})]}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-slate-900",children:L.withDebt}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"ta"})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Qarz"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(os,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-red-600"})})]}),e.jsx("p",{className:"text-base sm:text-xl lg:text-2xl font-bold text-red-600",children:b(L.totalDebt)}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"so'm"})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Xarid"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(hs,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-green-600"})})]}),e.jsx("p",{className:"text-base sm:text-xl lg:text-2xl font-bold text-green-600",children:b(L.totalPurchases)}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"so'm"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 flex flex-col sm:flex-row gap-2 sm:gap-3 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs("button",{onClick:()=>J(!W),className:`flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors whitespace-nowrap ${S?"bg-brand-100 text-brand-700":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:[e.jsx(Et,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),e.jsx("span",{className:"max-w-[120px] sm:max-w-none truncate",children:ge()}),e.jsx(ct,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})]}),W&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>J(!1)}),e.jsxs("div",{className:"absolute left-0 sm:left-auto sm:right-0 top-full mt-2 w-[calc(100vw-2rem)] sm:w-72 bg-white rounded-xl shadow-xl border border-slate-200 z-50 p-3 sm:p-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-slate-700",children:"Hudud filtri"}),S&&e.jsx("button",{onClick:B,className:"text-xs text-brand-600 hover:text-brand-700 font-medium",children:"Tozalash"})]}),e.jsxs("select",{className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 text-xs sm:text-sm mb-2",value:S,onChange:K=>{q(K.target.value),R("")},children:[e.jsx("option",{value:"",children:"Barcha viloyatlar"}),Vt.map(K=>e.jsx("option",{value:K,children:K},K))]}),S&&e.jsxs("select",{className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 text-xs sm:text-sm",value:f,onChange:K=>R(K.target.value),children:[e.jsx("option",{value:"",children:"Barcha tumanlar"}),(Ne=Lt[S])==null?void 0:Ne.map(K=>e.jsx("option",{value:K,children:K},K))]})]})]})]}),e.jsxs("select",{value:de,onChange:K=>xe(K.target.value),className:"px-3 sm:px-4 py-2 border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 text-xs sm:text-sm font-medium bg-white flex-shrink-0",children:[e.jsx("option",{value:"name",children:"Ism"}),e.jsx("option",{value:"debt",children:"Qarz"}),e.jsx("option",{value:"purchases",children:"Xarid"})]})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-slate-500 whitespace-nowrap",children:[ce.length," ta"]})]}),g?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):ce.length===0?e.jsxs("div",{className:"bg-white rounded-xl border-2 border-slate-200 flex flex-col items-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Os,{className:"w-8 h-8 text-slate-400"})}),S?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Bu hududda mijozlar yo'q"}),e.jsxs("p",{className:"text-slate-500 mb-6 text-center",children:[e.jsx("span",{className:"font-medium text-brand-600",children:f?`${S}, ${f}`:S})," da hech qanday mijoz topilmadi"]}),e.jsxs("button",{onClick:B,className:"px-6 py-2 bg-brand-500 hover:bg-brand-600 text-white font-semibold rounded-lg transition-colors",children:[e.jsx(be,{className:"w-4 h-4 inline mr-2"}),"Filterni tozalash"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Mijozlar yo'q"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Birinchi mijozni qo'shing"}),e.jsx("button",{onClick:()=>P(!0),className:"px-6 py-2 bg-brand-500 hover:bg-brand-600 text-white font-semibold rounded-lg transition-colors",children:"Mijoz qo'shish"})]})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 lg:gap-6",children:ce.map(K=>e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 hover:border-brand-300 hover:shadow-lg transition-all p-4 sm:p-5 lg:p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 lg:w-14 lg:h-14 bg-gradient-to-br from-brand-100 to-brand-50 rounded-lg sm:rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"font-bold text-sm sm:text-base lg:text-lg text-brand-600",children:K.name.charAt(0)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-bold text-slate-900 text-sm sm:text-base lg:text-lg truncate",children:K.name}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500 truncate",children:za(K.phone)})]})]}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-shrink-0 ml-2",children:[e.jsx("button",{onClick:()=>Se(K),className:"p-1.5 sm:p-2 hover:bg-blue-100 text-blue-600 rounded-lg transition-colors",title:"Tahrirlash",children:e.jsx(Zs,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:()=>ee(K._id),disabled:T===K._id,className:"p-1.5 sm:p-2 hover:bg-red-100 text-red-600 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"O'chirish",children:T===K._id?e.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):e.jsx(Ps,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),K.address&&e.jsxs("div",{className:"mb-3 sm:mb-4 pb-3 sm:pb-4 border-b border-slate-100",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mb-1",children:"Manzil"}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-700 font-medium truncate",children:K.address})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-2.5 sm:p-3 border border-green-200",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-green-600 font-semibold mb-0.5 sm:mb-1",children:"Xaridlar"}),e.jsx("p",{className:"text-base sm:text-lg font-bold text-green-700 truncate",children:b(K.totalPurchases||0)}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-green-600 mt-0.5 sm:mt-1",children:[K.purchaseCount||0," ta"]})]}),e.jsxs("div",{className:`rounded-lg p-2.5 sm:p-3 border ${K.debt>0?"bg-gradient-to-br from-red-50 to-rose-50 border-red-200":"bg-gradient-to-br from-emerald-50 to-green-50 border-emerald-200"}`,children:[e.jsx("p",{className:`text-[10px] sm:text-xs font-semibold mb-0.5 sm:mb-1 ${K.debt>0?"text-red-600":"text-emerald-600"}`,children:K.debt>0?"Qarz":"Qarz yo'q"}),e.jsx("p",{className:`text-base sm:text-lg font-bold truncate ${K.debt>0?"text-red-700":"text-emerald-700"}`,children:b(K.debt)})]})]})]},K._id))})]}),p&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-4 py-3 text-white flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-bold",children:$?"Mijozni tahrirlash":"Yangi mijoz"}),e.jsx("button",{onClick:ie,className:"hover:bg-brand-600 p-1 rounded-lg transition-colors",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:ke,className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Ism"}),e.jsx("input",{className:"w-full px-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",placeholder:"Mijoz ismi",value:c.name,onChange:K=>z(k(v({},c),{name:K.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Telefon"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{className:"w-full pl-10 pr-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",placeholder:"+998 (XX) XXX-XX-XX",value:c.phone,onChange:K=>z(k(v({},c),{phone:ot(K.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Viloyat"}),e.jsxs("select",{className:"w-full px-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",value:c.region,onChange:K=>z(k(v({},c),{region:K.target.value,district:""})),children:[e.jsx("option",{value:"",children:"Viloyatni tanlang"}),Vt.map(K=>e.jsx("option",{value:K,children:K},K))]})]}),c.region&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Tuman"}),e.jsxs("select",{className:"w-full px-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",value:c.district,onChange:K=>z(k(v({},c),{district:K.target.value})),children:[e.jsx("option",{value:"",children:"Tumanni tanlang"}),(je=Lt[c.region])==null?void 0:je.map(K=>e.jsx("option",{value:K,children:K},K))]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:ie,className:"flex-1 px-3 py-2 text-xs font-semibold bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"flex-1 px-3 py-2 text-xs font-semibold bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white rounded-lg transition-all shadow-lg",children:"Saqlash"})]})]})]})})]})}function fa(){var Ve;const{user:t}=tt(),l=(t==null?void 0:t.role)==="admin",{showConfirm:r,showAlert:h,AlertComponent:n}=vs(),[g,N]=s.useState([]),[p,P]=s.useState([]),[$,w]=s.useState({total:0,approved:0,today:0,overdue:0,paid:0,blacklist:0,totalAmount:0,pendingApproval:0}),[j,M]=s.useState(!1),[T,D]=s.useState(!1),[c,z]=s.useState(null),[S,q]=s.useState(!0),[f,R]=s.useState("receivable"),[W,J]=s.useState({customer:"",creditorName:"",amount:"",dueDate:"",description:"",collateral:""}),[de,xe]=s.useState(""),[O,ke]=s.useState(""),[ee,Se]=s.useState("all"),[ie,ce]=s.useState(!1),[L,ge]=s.useState({name:"",phone:"",region:"",district:""}),[B,Ne]=s.useState(null);s.useEffect(()=>{je(),K(),Q()},[f]);const je=()=>E(this,null,function*(){try{const u=yield F.get(`/debts?type=${f}`);N(u.data)}catch(u){console.error("Error fetching debts:",u)}finally{q(!1)}}),K=()=>E(this,null,function*(){try{const u=yield F.get("/customers");P(u.data)}catch(u){console.error("Error fetching customers:",u)}}),Q=()=>E(this,null,function*(){try{const u=yield F.get(`/debts/stats?type=${f}`);w(u.data)}catch(u){console.error("Error fetching stats:",u)}}),ne=u=>E(this,null,function*(){u.preventDefault();try{const te={type:f,customer:f==="receivable"?W.customer:void 0,creditorName:f==="payable"?W.creditorName:void 0,amount:Number(W.amount),dueDate:W.dueDate,description:W.description,collateral:W.collateral};B?yield F.put(`/debts/${B._id}`,te):(yield F.post("/debts",te),h("Qarz muvaffaqiyatli qo'shildi","Muvaffaqiyat","success")),je(),Q(),he()}catch(te){console.error("Error saving debt:",te),h("Qarz qo'shishda xatolik yuz berdi","Xatolik","danger")}}),V=u=>E(this,null,function*(){if(u.preventDefault(),!!c)try{yield F.post(`/debts/${c._id}/payment`,{amount:Number(de),method:"cash"}),je(),Q(),D(!1),z(null),xe("")}catch(te){console.error("Error making payment:",te)}}),he=()=>{M(!1),Ne(null),J({customer:"",creditorName:"",amount:"",dueDate:"",description:"",collateral:""}),ce(!1),ge({name:"",phone:"",region:"",district:""})},ye=()=>E(this,null,function*(){if(!(!L.name||!L.phone))try{const u={name:L.name,phone:L.phone,address:L.region&&L.district?`${L.region}, ${L.district}`:""},te=yield F.post("/customers",u);yield K(),J(k(v({},W),{customer:te.data._id})),ce(!1),ge({name:"",phone:"",region:"",district:""})}catch(u){console.error("Error creating customer:",u)}}),Fe=g.filter(u=>{var Be,x;const te=((Be=u.customer)==null?void 0:Be.name)||u.creditorName||"",Pe=((x=u.customer)==null?void 0:x.phone)||"",$e=te.toLowerCase().includes(O.toLowerCase())||Pe.includes(O);let le=!0;if(ee==="today"){const pe=new Date;pe.setHours(0,0,0,0);const we=new Date(pe.getTime()+864e5),Re=new Date(u.dueDate);le=Re>=pe&&Re<we&&u.status!=="paid"}else ee!=="all"&&(le=u.status===ee);return $e&&le}),Ke=[{label:"AKTIV",value:$.approved,icon:Gs,color:"success",filter:"approved"},{label:"QORA RO'YXAT",value:$.blacklist,icon:qs,color:"danger",filter:"blacklist"},{label:"MUDDATI O'TGAN",value:$.overdue,icon:ra,color:"danger",filter:"overdue"},{label:"JAMI QARZ",value:`${b($.totalAmount)} so'm`,icon:er,color:"accent",filter:null}],Ue=u=>{var te;return(te=u.customer)!=null&&te.name?u.customer.name:u.creditorName||"Noma'lum"},as=u=>{var te;return((te=u.customer)==null?void 0:te.phone)||""};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[n,e.jsx(Fs,{title:"Qarz daftarcha",showSearch:!0,onSearch:ke,actions:e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("button",{onClick:()=>M(!0),className:"flex items-center gap-1 px-2 py-1 sm:px-3 sm:py-2 rounded-full bg-brand-500 hover:bg-brand-600 text-white shadow-sm hover:shadow-md transition-all active:scale-95",title:"Yangi qarz qo'shish",children:[e.jsx(ps,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"text-[10px] sm:text-xs font-medium",children:"Qo'shish"})]})})}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[l&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"inline-flex p-1 bg-surface-100 rounded-xl",children:[e.jsxs("button",{onClick:()=>{R("receivable"),Se("all")},className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all ${f==="receivable"?"bg-white text-success-600 shadow-sm":"text-surface-500 hover:text-surface-700"}`,children:[e.jsx(ua,{className:"w-4 h-4"}),"Menga qarzdor"]}),e.jsxs("button",{onClick:()=>{R("payable"),Se("all")},className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all ${f==="payable"?"bg-white text-danger-600 shadow-sm":"text-surface-500 hover:text-surface-700"}`,children:[e.jsx(Ht,{className:"w-4 h-4"}),"Men qarzdorman"]})]})}),e.jsx("div",{className:"grid grid-cols-4 gap-2 sm:gap-3",children:Ke.map((u,te)=>e.jsx("div",{onClick:()=>u.filter&&Se(u.filter),className:`group relative ${u.filter?"cursor-pointer":""}`,children:e.jsxs("div",{className:`relative bg-white rounded-xl p-2 sm:p-3 shadow-md hover:shadow-lg transition-all duration-300 hover:scale-[1.02] overflow-hidden h-[80px] sm:h-[90px] flex flex-col ${ee===u.filter?"ring-2 ring-brand-500":"border border-surface-200"}`,children:[e.jsx("div",{className:`absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r ${u.color==="success"?"from-emerald-500 to-emerald-600":u.color==="danger"?"from-red-500 to-red-600":(u.color==="accent","from-purple-500 to-purple-600")}`}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full justify-between",children:[e.jsx("div",{className:`w-6 h-6 sm:w-7 sm:h-7 rounded-lg flex items-center justify-center ${u.color==="success"?"bg-emerald-50":u.color==="danger"?"bg-red-50":(u.color==="accent","bg-purple-50")}`,children:e.jsx(u.icon,{className:`w-3 h-3 sm:w-4 sm:h-4 ${u.color==="success"?"text-emerald-600":u.color==="danger"?"text-red-600":(u.color==="accent","text-purple-600")}`})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-base sm:text-lg font-bold mb-0.5 ${u.color==="success"?"text-emerald-600":u.color==="danger"?"text-red-600":(u.color==="accent","text-purple-600")}`,children:u.value}),e.jsx("p",{className:"text-[10px] sm:text-[11px] font-semibold text-slate-600 uppercase tracking-wide leading-tight truncate",children:u.label})]})]})]})},te))}),e.jsx("div",{className:"card p-0 overflow-hidden",children:S?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):Fe.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(qs,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Qarzlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:O||ee!=="all"?"Filtr bo'yicha qarzlar topilmadi":"Hozircha qarzlar yo'q"})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-3 sm:gap-4 md:gap-5 p-3 sm:p-4 md:p-5",children:Fe.map(u=>{const te=u.status==="paid",Pe=u.status==="overdue",$e=u.status==="approved",le=u.status==="blacklist",Be=u.amount-u.paidAmount,x=Math.round(u.paidAmount/u.amount*100),pe=new Date(u.dueDate),we=new Date;we.setHours(0,0,0,0);const Re=Math.ceil((pe.getTime()-we.getTime())/(1e3*60*60*24)),De=!te&&(Pe||Re<=0),Ae=!te&&!De&&Re<=3,A=!te&&!De&&!Ae&&Re<=7,fe=De?"border-red-400 ring-2 ring-red-200":Ae?"border-orange-400 ring-2 ring-orange-200":A?"border-amber-400 ring-1 ring-amber-200":le?"border-slate-700 ring-2 ring-slate-400":"border-surface-200 hover:border-brand-300";return e.jsxs("div",{className:`bg-white rounded-xl sm:rounded-2xl border ${fe} hover:shadow-xl transition-all duration-300 overflow-hidden group ${De?"animate-pulse-slow":""}`,children:[e.jsxs("div",{className:`relative p-3 sm:p-4 ${le?"bg-gradient-to-br from-slate-800 to-slate-900":De?"bg-gradient-to-br from-red-100 to-rose-100":Ae?"bg-gradient-to-br from-orange-50 to-amber-50":A?"bg-gradient-to-br from-amber-50 to-yellow-50":f==="receivable"?"bg-gradient-to-br from-emerald-50 to-green-50":"bg-gradient-to-br from-red-50 to-rose-50"}`,children:[!te&&Re<=7&&e.jsx("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-lg text-[10px] font-bold ${De?"bg-red-500 text-white animate-pulse":Ae?"bg-orange-500 text-white":"bg-amber-500 text-white"}`,children:Pe||Re<0?`${Math.abs(Re)} kun o'tdi!`:Re===0?"Bugun!":`${Re} kun qoldi`}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center shadow-lg ${le?"bg-gradient-to-br from-slate-900 to-black":De?"bg-gradient-to-br from-red-500 to-rose-600":Ae?"bg-gradient-to-br from-orange-400 to-amber-500":A?"bg-gradient-to-br from-amber-400 to-yellow-500":f==="receivable"?"bg-gradient-to-br from-emerald-400 to-green-500":"bg-gradient-to-br from-red-400 to-rose-500"}`,children:e.jsx(is,{className:`w-6 h-6 ${le?"text-amber-300":"text-white"}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-bold text-surface-900 truncate text-sm sm:text-base",children:Ue(u)}),as(u)&&e.jsxs("p",{className:"text-xs sm:text-sm text-surface-500 flex items-center gap-1",children:[e.jsx(Qs,{className:"w-3 h-3"}),as(u)]})]})]}),e.jsxs("div",{className:`px-3 py-1.5 rounded-xl text-[10px] sm:text-xs font-semibold flex items-center gap-1.5 ${le?"bg-gradient-to-r from-slate-900 to-black text-amber-300 shadow-lg shadow-slate-500":$e?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg shadow-green-200":"bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow-lg shadow-blue-200"}`,children:[le?e.jsx(qs,{className:"w-3 h-3"}):$e?e.jsx(Gs,{className:"w-3 h-3"}):e.jsx(Bs,{className:"w-3 h-3"}),e.jsx("span",{children:le?"Qora ro'yxat":te?"To'langan":Pe?"Muddati o'tgan":$e?"Aktiv":"Jarayonda"})]})]}),!te&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-[10px] sm:text-xs text-surface-600 mb-1",children:[e.jsxs("span",{children:["To'langan: ",x,"%"]}),e.jsxs("span",{children:[b(u.paidAmount)," / ",b(u.amount)]})]}),e.jsx("div",{className:`h-2 rounded-full overflow-hidden ${De?"bg-red-200":Ae?"bg-orange-200":A?"bg-amber-200":"bg-white/60"}`,children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${De?"bg-red-500":Ae?"bg-orange-500":A?"bg-amber-500":f==="receivable"?"bg-emerald-500":"bg-red-500"}`,style:{width:`${x}%`}})})]})]}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[e.jsxs("div",{className:"bg-surface-50 rounded-xl p-1.5 sm:p-3 border border-surface-100",children:[e.jsx("p",{className:"text-[9px] sm:text-xs text-surface-500 uppercase tracking-wide font-semibold mb-0.5 sm:mb-1",children:"Jami qarz"}),e.jsx("p",{className:"font-bold text-surface-900 text-xs sm:text-base",children:b(u.amount)}),e.jsx("p",{className:"text-[9px] text-surface-400",children:"so'm"})]}),e.jsxs("div",{className:`rounded-xl p-1.5 sm:p-3 border ${f==="receivable"?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"}`,children:[e.jsx("p",{className:"text-[9px] sm:text-xs text-surface-500 uppercase tracking-wide font-semibold mb-0.5 sm:mb-1",children:"Qoldiq"}),e.jsx("p",{className:`font-bold text-xs sm:text-base ${f==="receivable"?"text-emerald-600":"text-red-600"}`,children:b(Be)}),e.jsx("p",{className:"text-[9px] text-surface-400",children:"so'm"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3 text-[10px] sm:text-sm",children:[e.jsxs("div",{className:"flex flex-col gap-0.5 sm:gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 text-surface-600",children:[e.jsx(Bs,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),e.jsx("span",{children:new Date(u.dueDate).toLocaleDateString("uz-UZ")})]}),u.extensionDays>0&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-blue-50 rounded-md text-blue-700 text-[9px] sm:text-[10px] font-medium border border-blue-200",children:["ðŸ“… ",u.extensionDays," kun muddat"]})]}),f==="receivable"&&u.collateral&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-amber-50 rounded-lg text-amber-700 text-[9px] sm:text-[10px] font-medium border border-amber-200 max-w-[100px] truncate",children:["ðŸ”’ ",u.collateral]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-1.5 sm:gap-2 pt-2 sm:pt-3 border-t border-surface-100 flex-wrap",children:[l&&e.jsxs("button",{onClick:()=>E(this,null,function*(){try{yield F.delete(`/debts/${u._id}`),je(),Q()}catch(i){console.error("Error deleting debt:",i)}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-red-100 text-red-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-red-200 transition-all whitespace-nowrap",title:"Qarzni o'chirish",children:[e.jsx(Ps,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"O'chirish"})]}),l&&!te&&e.jsxs(e.Fragment,{children:[u.extensionCount===void 0||u.extensionCount<3?e.jsxs("button",{onClick:()=>E(this,null,function*(){var Ce,qe;const i=prompt("Necha kun muddat berilsin?");if(!i)return;const ae=parseInt(i,10);if(!(Number.isNaN(ae)||ae<=0))try{yield F.post(`/debts/${u._id}/extend`,{days:ae}),je(),Q()}catch(y){console.error("Error extending debt:",y),h(((qe=(Ce=y.response)==null?void 0:Ce.data)==null?void 0:qe.message)||"Muddat berishda xatolik","Xatolik","danger")}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-amber-100 text-amber-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-amber-200 transition-all whitespace-nowrap",children:[e.jsx(Bs,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{children:"Muddat"})]}):null,e.jsxs("button",{onClick:()=>E(this,null,function*(){var ae,Ce;if(yield r("Bu qarzni to'landi deb belgilaysizmi? Qoldiq summa nol bo'ladi.","Bo'ldi"))try{const qe=u.amount-u.paidAmount;qe>0&&(yield F.post(`/debts/${u._id}/payment`,{amount:qe,method:"cash"})),je(),Q(),h("Qarz to'landi deb belgilandi","Muvaffaqiyat","success")}catch(qe){console.error("Error marking debt as paid:",qe),h(((Ce=(ae=qe.response)==null?void 0:ae.data)==null?void 0:Ce.message)||"Qarz to'landi deb belgilashda xatolik","Xatolik","danger")}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-emerald-100 text-emerald-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-emerald-200 transition-all whitespace-nowrap",children:[e.jsx(Gs,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{children:"Bo'ldi"})]})]}),!te&&e.jsxs("button",{onClick:()=>{z(u),D(!0)},className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-emerald-100 text-emerald-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-emerald-200 transition-all whitespace-nowrap",children:[e.jsx(os,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{children:"To'lov"})]}),l&&le&&e.jsxs("button",{onClick:()=>E(this,null,function*(){var ae,Ce;if(yield r("Ushbu mijozni qora ro'yxatdan chiqarasizmi?","Qora ro'yxatdan chiqarish"))try{yield F.post(`/debts/${u._id}/remove-blacklist`),je(),Q(),h("Mijoz qora ro'yxatdan chiqarildi","Muvaffaqiyat","success")}catch(qe){console.error("Error removing from blacklist:",qe),h(((Ce=(ae=qe.response)==null?void 0:ae.data)==null?void 0:Ce.message)||"Qora ro'yxatdan chiqarishda xatolik","Xatolik","danger")}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-slate-800 text-amber-300 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-slate-900 transition-all whitespace-nowrap",children:[e.jsx(qs,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Qora ro'yxatdan chiqarish"}),e.jsx("span",{className:"sm:hidden",children:"Chiqarish"})]})]})]})]},u._id)})})})})]}),j&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:he}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:B?"Qarzni tahrirlash":"Yangi qarz"}),e.jsx("button",{onClick:he,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[l&&e.jsxs("div",{className:"flex p-1 bg-surface-100 rounded-xl mb-6",children:[e.jsxs("button",{type:"button",onClick:()=>R("receivable"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg transition-all ${f==="receivable"?"bg-white text-success-600 shadow-sm":"text-surface-500"}`,children:[e.jsx(ua,{className:"w-4 h-4"}),"Menga qarzdor"]}),e.jsxs("button",{type:"button",onClick:()=>R("payable"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg transition-all ${f==="payable"?"bg-white text-danger-600 shadow-sm":"text-surface-500"}`,children:[e.jsx(Ht,{className:"w-4 h-4"}),"Men qarzdorman"]})]}),e.jsxs("form",{onSubmit:ne,className:"space-y-4",children:[e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(qs,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-amber-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"Diqqat!"}),e.jsx("p",{children:"Qo'shilgan qarz darhol mijozning umumiy qarziga qo'shiladi. Shuning uchun ma'lumotlarni diqqat bilan kiriting."})]})]})}),f==="receivable"?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Mijoz"}),ie?e.jsxs("div",{className:"space-y-3 p-3 bg-surface-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-brand-600",children:"Yangi mijoz"}),e.jsx("button",{type:"button",onClick:()=>ce(!1),className:"text-surface-400 hover:text-surface-600",children:e.jsx(be,{className:"w-4 h-4"})})]}),e.jsx("input",{type:"text",className:"input",placeholder:"Mijoz ismi",value:L.name,onChange:u=>ge(k(v({},L),{name:u.target.value}))}),e.jsxs("div",{className:"relative",children:[e.jsx(Qs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-12",placeholder:"+998 (XX) XXX-XX-XX",value:L.phone,onChange:u=>ge(k(v({},L),{phone:ot(u.target.value)}))})]}),e.jsxs("select",{className:"select text-sm",value:L.region,onChange:u=>ge(k(v({},L),{region:u.target.value,district:""})),children:[e.jsx("option",{value:"",children:"Viloyatni tanlang"}),Vt.map(u=>e.jsx("option",{value:u,children:u},u))]}),L.region&&e.jsxs("select",{className:"select text-sm",value:L.district,onChange:u=>ge(k(v({},L),{district:u.target.value})),children:[e.jsx("option",{value:"",children:"Tumanni tanlang"}),(Ve=Lt[L.region])==null?void 0:Ve.map(u=>e.jsx("option",{value:u,children:u},u))]}),e.jsxs("button",{type:"button",onClick:ye,disabled:!L.name||!L.phone,className:"btn-primary w-full",children:[e.jsx(Zt,{className:"w-4 h-4"}),"Mijozni yaratish"]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"select flex-1",value:W.customer,onChange:u=>J(k(v({},W),{customer:u.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Tanlang"}),p.map(u=>e.jsxs("option",{value:u._id,children:[u.name," - ",u.phone]},u._id))]}),e.jsx("button",{type:"button",onClick:()=>ce(!0),className:"btn-icon bg-brand-100 text-brand-600 hover:bg-brand-200",title:"Yangi mijoz qo'shish",children:e.jsx(ps,{className:"w-5 h-5"})})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Kimga qarzdorman"}),e.jsx("input",{type:"text",className:"input",placeholder:"Ism yoki kompaniya nomi",value:W.creditorName,onChange:u=>J(k(v({},W),{creditorName:u.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Summa (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:ls(W.amount),onChange:u=>J(k(v({},W),{amount:Je(u.target.value)})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Muddat"}),e.jsx("input",{type:"date",className:"input",value:W.dueDate,onChange:u=>J(k(v({},W),{dueDate:u.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Izoh (ixtiyoriy)"}),e.jsx("input",{type:"text",className:"input",placeholder:"Qarz haqida izoh",value:W.description,onChange:u=>J(k(v({},W),{description:u.target.value}))})]}),f==="receivable"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Zalog (ixtiyoriy)"}),e.jsx("input",{type:"text",className:"input",placeholder:"Zalogga nima qoldirdi",value:W.collateral,onChange:u=>J(k(v({},W),{collateral:u.target.value}))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:he,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Saqlash"})]})]})]})})]})]}),T&&c&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>D(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900",children:"To'lov qilish"}),e.jsx("button",{onClick:()=>D(!1),className:"flex-shrink-0 btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${f==="receivable"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Qoldiq summa"}),e.jsxs("p",{className:`text-2xl font-bold ${f==="receivable"?"text-success-600":"text-danger-600"}`,children:[b(c.amount-c.paidAmount)," so'm"]})]}),e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"To'lov summasi"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:ls(de),onChange:u=>xe(Je(u.target.value)),required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>D(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-success flex-1",children:"To'lash"})]})]})]})})]})]})]})}function sn(){const{showAlert:t,showConfirm:l,AlertComponent:r}=vs(),h=Es(),[n,g]=s.useState([]),[N,p]=s.useState(!0),[P,$]=s.useState(null),[w,j]=s.useState(null);s.useEffect(()=>{M()},[]);const M=()=>E(this,null,function*(){try{const c=yield F.get("/debts?status=pending_approval");g(c.data)}catch(c){console.error("Error fetching pending debts:",c)}finally{p(!1)}}),T=c=>E(this,null,function*(){var z,S;$(c);try{yield F.post(`/debts/${c}/approve`),g(n.filter(q=>q._id!==c)),t("Qarz muvaffaqiyatli tasdiqlandi","Muvaffaqiyat","success")}catch(q){$(null),console.error("Error approving debt:",q),t(((S=(z=q.response)==null?void 0:z.data)==null?void 0:S.message)||"Xatolik yuz berdi","Xatolik","danger")}}),D=c=>E(this,null,function*(){var S,q;if(yield l("Bu qarzni rad etasizmi?","Rad etish")){j(c);try{yield F.post(`/debts/${c}/reject`),g(n.filter(f=>f._id!==c)),t("Qarz rad etildi","Muvaffaqiyat","success")}catch(f){j(null),console.error("Error rejecting debt:",f),t(((q=(S=f.response)==null?void 0:S.data)==null?void 0:q.message)||"Xatolik yuz berdi","Xatolik","danger")}}});return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsx(Fs,{title:"Qarz tasdiqlash",actions:e.jsxs("button",{onClick:()=>h("/admin/debts"),className:"btn-secondary",children:[e.jsx(wa,{className:"w-4 h-4"}),"Orqaga"]})}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-4xl mx-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-6 border border-amber-200",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 rounded-xl flex items-center justify-center",children:e.jsx(qs,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-amber-900",children:"Tasdiqlashni kutayotgan qarzlar"}),e.jsxs("p",{className:"text-sm text-amber-700",children:[n.length," ta qarz kassachi tomonidan qo'shilgan va sizning tasdiqlashingizni kutmoqda"]})]})]})}),N?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):n.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Gs,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Barcha qarzlar ko'rib chiqildi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:"Hozirda tasdiqlashni kutayotgan qarzlar yo'q. Yangi qarzlar qo'shilganda bu yerda ko'rinadi."})]}):e.jsx("div",{className:"space-y-4",children:n.map(c=>{var z,S;return e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-amber-200 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center",children:e.jsx(is,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-lg",children:(z=c.customer)==null?void 0:z.name}),e.jsx("p",{className:"text-surface-500",children:(S=c.customer)==null?void 0:S.phone}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-surface-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Bs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Muddat: ",new Date(c.dueDate).toLocaleDateString("uz-UZ")]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(os,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium text-lg",children:[b(c.amount)," so'm"]})]})]})]})]}),e.jsxs("span",{className:"badge badge-amber",children:[e.jsx(qs,{className:"w-3 h-3"}),"Kutilmoqda"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[c.description&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("h5",{className:"font-medium text-surface-700 mb-2",children:"Izoh"}),e.jsx("p",{className:"text-surface-600 text-sm",children:c.description})]}),c.collateral&&e.jsxs("div",{className:"bg-amber-50 rounded-xl p-4",children:[e.jsx("h5",{className:"font-medium text-amber-700 mb-2",children:"Zalog"}),e.jsx("p",{className:"text-amber-600 text-sm",children:c.collateral})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>D(c._id),disabled:w===c._id||P===c._id,className:"btn-secondary flex-1 text-red-600 hover:bg-red-50 hover:border-red-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:w===c._id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Rad etilmoqda..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4"}),"Rad etish"]})}),e.jsx("button",{onClick:()=>T(c._id),disabled:P===c._id||w===c._id,className:"btn-primary flex-1 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:P===c._id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Tasdiqlanamoqda..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Gs,{className:"w-4 h-4"}),"Tasdiqlash"]})})]})]},c._id)})})]})]})}function tn(){const[t,l]=s.useState([]),[r,h]=s.useState("all"),[n,g]=s.useState(!0);s.useEffect(()=>{N()},[]);const N=()=>E(this,null,function*(){try{const j=yield F.get("/orders");l(j.data)}catch(j){console.error("Error fetching orders:",j)}finally{g(!1)}}),p=(j,M)=>E(this,null,function*(){try{yield F.put(`/orders/${j}/status`,{status:M}),N()}catch(T){console.error("Error updating order:",T)}}),P={new:{color:"brand",label:"Yangi",icon:it},processing:{color:"warning",label:"Jarayonda",icon:Oe},shipped:{color:"accent",label:"Yo'lda",icon:tr},delivered:{color:"success",label:"Yetkazildi",icon:Gs},cancelled:{color:"danger",label:"Bekor qilindi",icon:sr}},$=[{value:"all",label:"Barchasi"},...Object.entries(P).map(([j,M])=>({value:j,label:M.label}))],w=t.filter(j=>r==="all"||j.status===r);return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[e.jsx(Fs,{title:"Buyurtmalar",filterOptions:$,filterValue:r,onFilterChange:h}),e.jsx("div",{className:"p-4 lg:p-6",children:e.jsx("div",{className:"card p-0 overflow-hidden",children:n?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):w.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Pt,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Buyurtmalar topilmadi"}),e.jsx("p",{className:"text-surface-500",children:"Hozircha buyurtmalar yo'q"})]}):e.jsx("div",{className:"divide-y divide-surface-100",children:w.map(j=>{var T;const M=P[j.status];return e.jsx("div",{className:"p-4 lg:p-6 hover:bg-surface-50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(Oe,{className:"w-6 h-6 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-surface-900",children:["Buyurtma #",j._id.slice(-6)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500 mt-1",children:[e.jsx(is,{className:"w-4 h-4"}),e.jsx("span",{children:((T=j.customer)==null?void 0:T.name)||"Noma'lum mijoz"})]})]}),e.jsx("select",{value:j.status,onChange:D=>p(j._id,D.target.value),className:`select text-sm py-2 px-3 bg-${M.color}-50 text-${M.color}-700 border-${M.color}-200`,children:Object.entries(P).map(([D,c])=>e.jsx("option",{value:D,children:c.label},D))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-surface-500",children:[e.jsxs("span",{children:[j.items.length," ta mahsulot"]}),e.jsx("span",{children:new Date(j.createdAt).toLocaleDateString("uz-UZ")})]}),e.jsxs("p",{className:"font-bold text-surface-900",children:[j.total.toLocaleString()," so'm"]})]})]})]})},j._id)})})})})]})}function an(){const{showConfirm:t,showAlert:l,AlertComponent:r}=vs(),[h,n]=s.useState([]),[g,N]=s.useState([]),[p,P]=s.useState(null),[$,w]=s.useState([]),[j,M]=s.useState(!1),[T,D]=s.useState(!1),[c,z]=s.useState(!1),[S,q]=s.useState(null),[f,R]=s.useState(null),[W,J]=s.useState(!0),[de,xe]=s.useState(!1),[O,ke]=s.useState(!1),[ee,Se]=s.useState(null),[ie,ce]=s.useState({name:"",phone:"",password:"",role:"helper",bonusPercentage:0}),[L,ge]=s.useState({name:"",login:"",phone:"",password:"",confirmPassword:"",role:"helper",bonusPercentage:0}),[B,Ne]=s.useState(!1);s.useEffect(()=>{K(),Q(),je()},[]);const je=()=>E(this,null,function*(){try{const u=yield F.get("/auth/admin/kassa-users");if(u.data.success&&u.data.users.length>0){const te=u.data.users[0];P({login:te.login,name:te.name})}}catch(u){console.error("Error fetching kassa user:",u)}}),K=()=>E(this,null,function*(){try{const u=yield F.get("/auth/admin/helpers");n(u.data.users||u.data)}catch(u){console.error("Error fetching helpers:",u)}finally{J(!1)}}),Q=()=>E(this,null,function*(){try{const u=yield F.get("/receipts/helpers-stats");N(u.data)}catch(u){console.error("Error fetching helpers stats:",u)}}),ne=u=>E(this,null,function*(){xe(!0);try{const te=yield F.get(`/receipts/helper/${u}/receipts`);w(te.data.receipts)}catch(te){console.error("Error fetching helper receipts:",te)}finally{xe(!1)}}),V=u=>{q(u),z(!0),ne(u._id)},he=u=>{const te=ot(u.target.value);ce(k(v({},ie),{phone:te}))},ye=u=>E(this,null,function*(){var te,Pe;u.preventDefault(),ke(!0);try{const $e=v(v({name:ie.name,phone:zt(ie.phone),role:ie.role},ie.password&&{password:ie.password}),ie.role==="cashier"&&{bonusPercentage:ie.bonusPercentage});if(f)yield F.put(`/auth/admin/helpers/${f._id}`,$e),N(g.map(le=>le._id===f._id?k(v({},le),{name:ie.name,role:ie.role,bonusPercentage:ie.bonusPercentage}):le)),n(h.map(le=>le._id===f._id?k(v({},le),{name:ie.name,role:ie.role,phone:zt(ie.phone)}):le));else{yield F.post("/users",k(v({},$e),{password:ie.password}));const le={_id:Math.random().toString(),name:ie.name,role:ie.role,receiptCount:0,totalAmount:0,bonusPercentage:ie.bonusPercentage||0,totalEarnings:0,totalBonus:0};N([...g,le])}setTimeout(()=>{Ue(),ke(!1)},2e3)}catch($e){ke(!1),alert(((Pe=(te=$e.response)==null?void 0:te.data)==null?void 0:Pe.message)||"Xatolik yuz berdi")}}),Fe=u=>E(this,null,function*(){var Pe,$e;if(yield t(`"${u.name}" yordamchisini o'chirishni tasdiqlaysizmi?`,"Yordamchini o'chirish")){Se(u._id);try{yield F.delete(`/auth/admin/helpers/${u._id}`),N(g.filter(le=>le._id!==u._id)),n(h.filter(le=>le._id!==u._id)),l("Yordamchi muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),setTimeout(()=>{Se(null)},2e3)}catch(le){Se(null),console.error("Error deleting helper:",le),l(`Yordamchini o'chirishda xatolik: ${(($e=(Pe=le.response)==null?void 0:Pe.data)==null?void 0:$e.message)||le.message}`,"Xatolik","danger")}}}),Ke=u=>{R(u),ce({name:u.name,phone:za(u.phone),password:"",role:u.role,bonusPercentage:u.bonusPercentage||0}),M(!0)},Ue=()=>{M(!1),R(null),ce({name:"",phone:"",password:"",role:"helper",bonusPercentage:0})},as=()=>{D(!1),ge({name:"",login:"",phone:"",password:"",confirmPassword:"",role:"helper",bonusPercentage:0})},Ve=u=>E(this,null,function*(){var te,Pe;if(u.preventDefault(),L.password!==L.confirmPassword){l("Parollar mos kelmadi","Xatolik","danger");return}if(L.password.length<6){l("Parol kamida 6 ta belgidan iborat bo'lishi kerak","Xatolik","danger");return}Ne(!0);try{const $e={name:L.name,login:L.login,phone:zt(L.phone),password:L.password};console.log("ðŸ“¤ Xodim yaratish so'rovi:",$e);const le=yield F.post("/auth/admin/helpers",$e);console.log("âœ… Server javobi:",le.data);const Be={_id:le.data.user._id,name:le.data.user.name,login:le.data.user.login,phone:le.data.user.phone,role:le.data.user.role,receiptCount:0,totalAmount:0,totalEarnings:0,totalBonus:0};N([...g,Be]),l("Xodim muvaffaqiyatli qo'shildi","Muvaffaqiyat","success"),setTimeout(()=>{as(),Ne(!1)},2e3)}catch($e){Ne(!1),l(((Pe=(te=$e.response)==null?void 0:te.data)==null?void 0:Pe.message)||"Xatolik yuz berdi","Xatolik","danger")}});return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsx(Fs,{title:"Yordamchilar",actions:e.jsxs("button",{onClick:()=>D(!0),className:"btn-primary",children:[e.jsx(ps,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yordamchi qo'shish"})]})}),e.jsx("div",{className:"p-4 lg:p-6",children:W?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):h.length===0?e.jsxs("div",{className:"card flex flex-col items-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Zt,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Yordamchilar yo'q"}),e.jsx("p",{className:"text-surface-500 mb-6",children:"Birinchi yordamchini qo'shing"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-6 shadow-lg border-2 border-purple-400",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(wt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white text-lg",children:"Kassa Paneli Kodi"}),e.jsx("p",{className:"text-purple-100 text-sm",children:"Admin tomonidan belgilangan login va parol"})]})]}),e.jsx("div",{className:"bg-white/20 backdrop-blur-sm px-3 py-1 rounded-lg",children:e.jsx("span",{className:"text-white text-xs font-semibold",children:"Maxsus"})})]}),p?e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Ism:"}),e.jsx("span",{className:"text-white font-bold",children:p.name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Login:"}),e.jsx("span",{className:"text-white font-bold",children:p.login})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Parol:"}),e.jsx("span",{className:"text-white font-bold",children:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-white/20",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Rol:"}),e.jsx("span",{className:"bg-white/20 text-white px-3 py-1 rounded-lg text-xs font-semibold",children:"Kassir"})]}),e.jsx("div",{className:"pt-3 border-t border-white/20",children:e.jsxs("a",{href:"/admin/settings",className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white rounded-lg font-semibold transition-all duration-300 hover:shadow-lg",children:[e.jsx(ys,{className:"w-4 h-4"}),"Parolni o'zgartirish"]})})]}):e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-white text-sm",children:"Kassa foydalanuvchisi topilmadi"}),e.jsx("p",{className:"text-purple-100 text-xs mt-2",children:"Admin sozlamalarida kassa yarating"})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-purple-100 text-xs",children:[e.jsx(ys,{className:"w-4 h-4"}),e.jsx("span",{children:"Bu karta o'chirib bo'lmaydi. Faqat Admin Sozlamalari â†’ Kassa Foydalanuvchilari bo'limida o'zgartirish mumkin."})]})]}),e.jsx("h2",{className:"text-lg font-semibold text-surface-900 mb-4",children:"Kassirlar statistikasi"}),g.length===0?e.jsx("p",{className:"text-surface-500 text-center py-8",children:"Hali cheklar chiqarilmagan"}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 max-w-4xl",children:g.map(u=>e.jsxs("div",{className:"group bg-white rounded-xl p-3 shadow-sm border border-surface-200 hover:shadow-lg hover:border-brand-300 transition-all duration-300 hover:-translate-y-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center text-white font-bold text-base flex-shrink-0",children:u.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm text-surface-900 truncate",title:u.name,children:u.name}),e.jsx("span",{className:`inline-block text-[10px] px-1.5 py-0.5 rounded-full font-semibold mt-0.5 ${u.role==="cashier"?"bg-success-100 text-success-700":"bg-brand-100 text-brand-700"}`,children:u.role==="cashier"?"Kassir":"Yordamchi"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 pt-4 border-t border-surface-100 flex-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-bold text-brand-600",children:u.receiptCount}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Cheklar"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-success-600",children:b(u.totalAmount)}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Savdo"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xl font-bold text-orange-600",children:[u.bonusPercentage,"%"]}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Bonus"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6 pt-4 border-t border-surface-100",children:[e.jsx("button",{onClick:te=>{te.stopPropagation();const Pe=h.find($e=>$e.name===u.name);Pe&&Ke(Pe)},className:"p-2.5 hover:bg-brand-100 hover:text-brand-600 text-surface-400 rounded-lg transition-all hover:shadow-md hover:-translate-y-0.5",title:"Tahrirlash",children:e.jsx(Zs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:te=>{te.stopPropagation(),V(u)},className:"p-2.5 hover:bg-blue-100 hover:text-blue-600 text-surface-400 rounded-lg transition-all hover:shadow-md hover:-translate-y-0.5",title:"Cheklar",children:e.jsx(Xs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:te=>{te.stopPropagation(),Fe(u)},disabled:ee===u._id,className:"p-2.5 hover:bg-danger-100 hover:text-danger-600 text-surface-400 rounded-lg transition-all hover:shadow-md hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed",title:"O'chirish",children:ee===u._id?e.jsx("div",{className:"w-4 h-4 border-2 border-danger-600 border-t-transparent rounded-full animate-spin"}):e.jsx(Ps,{className:"w-4 h-4"})})]})]},u._id))})]})}),T&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-3 md:p-4 bg-black/50",children:[e.jsx("div",{className:"overlay",onClick:as}),e.jsxs("div",{className:"modal w-full max-w-[95%] xs:max-w-sm sm:max-w-md p-3 sm:p-4 md:p-5 relative z-50 max-h-[85vh] overflow-y-auto bg-white rounded-xl sm:rounded-2xl shadow-2xl my-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3 pb-2 sm:pb-3 border-b border-surface-200",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-surface-900",children:"Yordamchi qo'shish"}),e.jsx("button",{onClick:as,className:"btn-icon-sm",children:e.jsx(be,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("form",{onSubmit:Ve,className:"space-y-2 sm:space-y-3 flex flex-col h-full",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Ism"}),e.jsxs("div",{className:"relative",children:[e.jsx(is,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Yordamchi ismi",value:L.name,onChange:u=>ge(k(v({},L),{name:u.target.value})),disabled:B,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Login"}),e.jsxs("div",{className:"relative",children:[e.jsx(is,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Login (foydalanuvchi nomi)",value:L.login,onChange:u=>ge(k(v({},L),{login:u.target.value})),disabled:B,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Telefon raqam"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"tel",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"+998 (XX) XXX-XX-XX",value:L.phone,onChange:u=>ge(k(v({},L),{phone:ot(u.target.value)})),disabled:B,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Parol"}),e.jsxs("div",{className:"relative",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"password",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Kamida 6 ta belgi",value:L.password,onChange:u=>ge(k(v({},L),{password:u.target.value})),disabled:B,required:!0,minLength:6})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Parolni tasdiqlash"}),e.jsxs("div",{className:"relative",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"password",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Parolni qayta kiriting",value:L.confirmPassword,onChange:u=>ge(k(v({},L),{confirmPassword:u.target.value})),disabled:B,required:!0,minLength:6})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-2 block",children:"Rol"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>ge(k(v({},L),{role:"cashier"})),disabled:B,className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed ${L.role==="cashier"?"border-success-500 bg-success-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(hs,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${L.role==="cashier"?"text-success-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Kassir"})]}),e.jsxs("button",{type:"button",onClick:()=>ge(k(v({},L),{role:"helper"})),disabled:B,className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed ${L.role==="helper"?"border-brand-500 bg-brand-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(wt,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${L.role==="helper"?"text-brand-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Yordamchi"})]})]})]}),L.role==="cashier"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Bonus foizi (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx(os,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"number",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Masalan: 1",value:L.bonusPercentage,min:"0",max:"100",step:"0.1",disabled:B,onChange:u=>ge(k(v({},L),{bonusPercentage:parseFloat(u.target.value)||0}))})]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-surface-500 mt-0.5 sm:mt-1",children:[L.bonusPercentage,"% bonus"]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 mt-auto border-t border-surface-100",children:[e.jsx("button",{type:"button",onClick:as,disabled:B,className:"btn-secondary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Bekor"}),e.jsx("button",{type:"submit",disabled:B,className:"btn-primary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:B?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Qo'shilmoqda..."})]}):"Qo'shish"})]})]})]})]}),j&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-3 md:p-4 bg-black/50",children:[e.jsx("div",{className:"overlay",onClick:Ue}),e.jsxs("div",{className:"modal w-full max-w-[95%] xs:max-w-sm sm:max-w-md p-3 sm:p-4 md:p-5 relative z-50 max-h-[85vh] overflow-y-auto bg-white rounded-xl sm:rounded-2xl shadow-2xl my-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3 pb-2 sm:pb-3 border-b border-surface-200",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-surface-900",children:f?"Tahrirlash":"Yangi yordamchi"}),e.jsx("button",{onClick:Ue,className:"btn-icon-sm",children:e.jsx(be,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("form",{onSubmit:ye,className:"space-y-2 sm:space-y-3 flex flex-col h-full",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Ism"}),e.jsxs("div",{className:"relative",children:[e.jsx(is,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-9 text-sm",placeholder:"Yordamchi ismi",value:ie.name,onChange:u=>ce(k(v({},ie),{name:u.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Telefon raqam"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"tel",className:"input pl-9 text-sm",placeholder:"+998 (XX) XXX-XX-XX",value:ie.phone,onChange:he,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:f?"Yangi parol (ixtiyoriy)":"Parol"}),e.jsxs("div",{className:"relative",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",v({type:"password",className:"input pl-9 text-sm",placeholder:f?"O'zgartirmaslik uchun bo'sh qoldiring":"Parol",value:ie.password,onChange:u=>ce(k(v({},ie),{password:u.target.value}))},!f&&{required:!0,minLength:6}))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-2 block",children:"Rol"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>ce(k(v({},ie),{role:"cashier"})),className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm ${ie.role==="cashier"?"border-success-500 bg-success-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(hs,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${ie.role==="cashier"?"text-success-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Kassir"})]}),e.jsxs("button",{type:"button",onClick:()=>ce(k(v({},ie),{role:"helper"})),className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm ${ie.role==="helper"?"border-brand-500 bg-brand-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(wt,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${ie.role==="helper"?"text-brand-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Yordamchi"})]})]})]}),ie.role==="cashier"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Bonus foizi (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx(os,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"number",className:"input pl-9 text-sm",placeholder:"Masalan: 1",value:ie.bonusPercentage,min:"0",max:"100",step:"0.1",onChange:u=>ce(k(v({},ie),{bonusPercentage:parseFloat(u.target.value)||0}))})]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-surface-500 mt-0.5 sm:mt-1",children:[ie.bonusPercentage,"% bonus"]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 mt-auto border-t border-surface-100",children:[e.jsx("button",{type:"button",onClick:Ue,disabled:O,className:"btn-secondary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Bekor"}),e.jsx("button",{type:"submit",disabled:O,className:"btn-primary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:O?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Saqlanmoqda..."})]}):"Saqlash"})]})]})]})]}),c&&S&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-2 sm:p-3 md:p-4 bg-black/50",children:["`n          ",e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>z(!1)}),e.jsxs("div",{className:"modal w-full max-w-[98%] sm:max-w-[95%] md:max-w-4xl max-h-[90vh] overflow-hidden relative z-50 bg-white rounded-2xl shadow-2xl",children:[e.jsxs("div",{className:"p-6 border-b border-surface-100 bg-gradient-to-r from-brand-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center text-white font-bold text-lg",children:S.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-surface-900",children:S.name}),e.jsx("span",{className:`text-sm px-3 py-1 rounded-full font-medium ${S.role==="cashier"?"bg-success-100 text-success-700":"bg-brand-100 text-brand-700"}`,children:S.role==="cashier"?"Kassir":"Yordamchi"})]})]}),e.jsx("button",{onClick:()=>z(!1),className:"btn-icon-sm hover:bg-white/50",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(Ls,{className:"w-5 h-5 text-brand-600"})}),e.jsx("p",{className:"text-2xl font-bold text-surface-900",children:S.receiptCount}),e.jsx("p",{className:"text-xs text-surface-500",children:"Cheklar"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(os,{className:"w-5 h-5 text-success-600"})}),e.jsx("p",{className:"text-lg font-bold text-success-600",children:b(S.totalAmount)}),e.jsx("p",{className:"text-xs text-surface-500",children:"Savdo"})]}),S.bonusPercentage>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx("span",{className:"text-orange-500 font-bold",children:"%"})}),e.jsxs("p",{className:"text-lg font-bold text-orange-600",children:[S.bonusPercentage,"%"]}),e.jsx("p",{className:"text-xs text-surface-500",children:"Bonus foizi"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(os,{className:"w-5 h-5 text-green-600"})}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:b(S.totalAmount*S.bonusPercentage/100)}),e.jsx("p",{className:"text-xs text-surface-500",children:"Jami bonus"})]})]})]})]}),e.jsx("div",{className:"p-6 overflow-auto max-h-[calc(90vh-120px)]",children:de?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):$.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(Ls,{className:"w-12 h-12 mx-auto mb-4 text-surface-400"}),e.jsx("p",{className:"text-surface-500",children:"Cheklar topilmadi"})]}):e.jsx("div",{className:"space-y-3",children:$.map(u=>e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-surface-100 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(Ls,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-surface-900",children:["Chek #",u._id.slice(-6)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500",children:[e.jsx(Bs,{className:"w-4 h-4"}),new Date(u.createdAt).toLocaleString("uz-UZ")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-brand-600",children:b(u.total)}),e.jsx("p",{className:"text-sm text-surface-500",children:"so'm"})]})]}),e.jsxs("div",{className:"border-t border-surface-100 pt-4",children:[e.jsx("h5",{className:"text-sm font-medium text-surface-700 mb-3",children:"Mahsulotlar:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:u.items.map((te,Pe)=>e.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-surface-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-surface-700 font-medium",children:te.name}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-sm text-surface-600",children:[te.quantity," Ã— ",b(te.price)]}),e.jsxs("p",{className:"text-sm font-semibold text-surface-900",children:[b(te.price*te.quantity)," so'm"]})]})]},Pe))})]})]},u._id))})})]})]})]})}const Da=t=>{const l=t.date||new Date,r=t.receiptNumber||`CHK-${Date.now()}`,h=t.cashier||"Kassa";let n="";n+=`========================
`,n+=`SARDOR FURNITURA
`,n+=`========================
`,n+=`
`,n+=`CHK: ${r}
`,n+=`${l.toLocaleDateString("uz-UZ")} ${l.toLocaleTimeString("uz-UZ",{hour:"2-digit",minute:"2-digit"})}
`,n+=`KASSIR: ${h}
`,t.customer&&(n+=`MIJOZ: ${t.customer.name}
`,n+=`TEL: ${t.customer.phone}
`),n+=`------------------------
`;let g=0,N=0;if(t.items.forEach((j,M)=>{n+=`${M+1}. ${j.name}
`,n+=`   ${j.code}
`;const T=j.previousPrice,D=j.currentPrice||j.price;if(g+=(T&&T>0?T:D)*j.cartQuantity,N+=D*j.cartQuantity,T&&T>0&&T!==D){const c=Math.round((T-D)/T*100);n+=`   OLDINGI: ${b(T)}
`,n+=`   HOZIRGI: ${b(D)}`,c>0?n+=` (-${c}%)
`:c<0?n+=` (+${Math.abs(c)}%)
`:n+=`
`}else n+=`   NARXI: ${b(j.price)}
`;n+=`   ${j.cartQuantity} x ${b(D)}
`,n+=`   = ${b(D*j.cartQuantity)}
`,n+=`
`}),n+=`------------------------
`,n+=`JAMI: ${b(t.total)}
`,g>N){const j=g-N,M=Math.round(j/g*100);n+=`CHEGIRMA: ${b(j)}
`,n+=`(${M}%)
`}const p=t.items.reduce((j,M)=>{var T;return j+(((T=M.paymentBreakdown)==null?void 0:T.cash)||0)},0),P=t.items.reduce((j,M)=>{var T;return j+(((T=M.paymentBreakdown)==null?void 0:T.click)||0)},0),$=t.items.reduce((j,M)=>{var T;return j+(((T=M.paymentBreakdown)==null?void 0:T.card)||0)},0);p>0&&(n+=`NAQT: ${b(p)}
`),P>0&&(n+=`CLICK: ${b(P)}
`),$>0&&(n+=`KARTA: ${b($)}
`),n+=`TO'LOV: ${t.paymentMethod==="cash"?"NAQD":t.paymentMethod==="click"?"CLICK":"KARTA"}
`;const w=Math.floor(t.total/1e6);return w>0&&(n+=`------------------------
`,n+=`BALL: +${w} BALL!
`),t.customer&&t.customer.totalBalls&&(n+=`JAMI: ${t.customer.totalBalls} BALL
`),n+=`========================
`,n+=`XARIDINGIZ UCHUN
`,n+=`RAHMAT!
`,n+=`========================
`,n+=`
`,n+=`âš ï¸ VAZVRAT CHEKSIZ âš ï¸
`,n+=`QABUL QILINMAYDI
`,n+=`========================
`,n},rn=(t,l)=>E(es,null,function*(){var r;try{const h=Da(t),n=document.createElement("iframe");n.style.position="absolute",n.style.left="-9999px",n.style.top="-9999px",n.style.width="1px",n.style.height="1px",n.style.visibility="hidden",n.style.opacity="0",document.body.appendChild(n);const g=n.contentDocument||((r=n.contentWindow)==null?void 0:r.document);if(!g)throw new Error("Iframe document topilmadi");const N=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>X PRINTER CHEK</title>
          <meta charset="UTF-8">
          <style>
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            
            body {
              font-family: 'Courier New', monospace;
              font-size: 12px;
              font-weight: bold;
              line-height: 1.2;
              color: #000;
              background: white;
              padding: 0;
              margin: 0 auto;
              display: flex;
              justify-content: center;
              align-items: flex-start;
              width: 100%;
            }
            
            .receipt-text {
              white-space: pre-line;
              font-family: 'Courier New', monospace;
              font-size: 12px;
              font-weight: bold;
              word-break: break-word;
              padding: 5px;
              text-align: center;
              width: 58mm;
              margin: 0 auto;
            }
            
            /* X Printer uchun maxsus print sozlamalari */
            @media print {
              @page {
                size: 58mm auto;
                margin: 0;
                padding: 0;
              }
              
              body {
                background: white;
                font-size: 10px;
                font-weight: bold;
                padding: 0;
                margin: 0 auto;
                width: 58mm;
                display: flex;
                justify-content: center;
                align-items: flex-start;
              }
              
              .receipt-text {
                width: 58mm;
                font-weight: bold;
                font-size: 10px;
                padding: 2mm;
                text-align: center;
                margin: 0 auto;
              }
            }
          </style>
        </head>
        <body>
          <div class="receipt-text">${h}</div>
          
          <script>
            // X Printer uchun print tugagandan keyin callback
            window.addEventListener('afterprint', function() {
              console.log('X Printer: Print tugadi');
              if (window.parent && window.parent.xPrinterCompleted) {
                window.parent.xPrinterCompleted();
              }
            });
            
            // X Printer uchun avtomatik print
            window.addEventListener('load', function() {
              setTimeout(function() {
                console.log('X Printer: Print boshlanmoqda...');
                window.print();
              }, 300);
            });
          <\/script>
        </body>
      </html>
    `;return g.open(),g.write(N),g.close(),l&&(window.xPrinterCompleted=()=>{console.log("X Printer: Callback chaqirildi"),l(),setTimeout(()=>{document.body.contains(n)&&document.body.removeChild(n)},1e3),delete window.xPrinterCompleted}),l||setTimeout(()=>{document.body.contains(n)&&document.body.removeChild(n)},3e3),console.log("X Printer: Chek tayyorlandi va yuborildi"),!0}catch(h){console.error("X Printer xatosi:",h);try{return nn(t),!1}catch(n){return console.error("Faylni yuklashda xatolik:",n),!1}}}),Aa=(t,l)=>E(es,null,function*(){return yield rn(t,l)}),nn=t=>{const l=Da(t),r=new Blob([l],{type:"text/plain;charset=utf-8"}),h=URL.createObjectURL(r),n=document.createElement("a");n.href=h,n.download=`chek-${t.receiptNumber||Date.now()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(h)},ln=()=>E(es,null,function*(){var t;try{if(navigator.printing&&navigator.printing.getPrinters){const l=yield navigator.printing.getPrinters(),r=l.map(n=>n.name||n.id),h=r.some(n=>n.toLowerCase().includes("x printer")||n.toLowerCase().includes("xprinter")||n.toLowerCase().includes("x-printer"));return{available:l.length>0,printers:r,defaultPrinter:(t=l.find(n=>n.isDefault))==null?void 0:t.name,xPrinterFound:h}}return{available:"print"in window,printers:["Browser Default Printer","X Printer (Auto-detect)"],defaultPrinter:"X Printer (Auto-detect)",xPrinterFound:!0}}catch(l){return console.error("Printer holatini tekshirishda xatolik:",l),{available:!1,printers:[],defaultPrinter:void 0,xPrinterFound:!1}}});function ba(){const{showAlert:t,AlertComponent:l}=vs(),[r,h]=s.useState([]),[n,g]=s.useState([]),[N,p]=s.useState(!0),[P,$]=s.useState(""),[w,j]=s.useState(""),[M,T]=s.useState(""),[D,c]=s.useState(""),[z,S]=s.useState(null),[q,f]=s.useState(1),[R,W]=s.useState(1),[J,de]=s.useState(null),[xe,O]=s.useState(null),[ke,ee]=s.useState(null),[Se,ie]=s.useState({totalReceipts:0,totalAmount:0,totalItems:0});s.useEffect(()=>{ce(),L()},[]),s.useEffect(()=>{L()},[P,w,M,D,q]);const ce=()=>E(this,null,function*(){try{const Q=yield F.get("/receipts/helpers-stats");g(Q.data)}catch(Q){console.error("Error fetching helpers:",Q)}}),L=()=>E(this,null,function*(){try{p(!0);const Q=new URLSearchParams({page:q.toString(),limit:"20"});P&&Q.append("helperId",P),w&&Q.append("startDate",w),M&&Q.append("endDate",M),D&&Q.append("search",D);const ne=yield F.get(`/receipts/all-helper-receipts?${Q}`);h(ne.data.receipts),W(ne.data.pagination.totalPages),ie(ne.data.summary)}catch(Q){console.error("Error fetching receipts:",Q),t("Cheklar yuklanmadi","Xatolik","danger")}finally{p(!1)}}),ge=Q=>{S(z===Q?null:Q)},B=Q=>new Date(Q).toLocaleDateString("uz-UZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Ne=()=>{$(""),j(""),T(""),c(""),f(1)},je=Q=>E(this,null,function*(){var ne;try{de(Q._id);const V={items:Q.items.map(ye=>({_id:ye._id,name:ye.name,code:ye.code,price:ye.price,cartQuantity:ye.quantity,quantity:ye.quantity,warehouse:"main",category:"",image:ye.image||void 0})),total:Q.total,paymentMethod:Q.paymentMethod,receiptNumber:Q.receiptNumber,cashier:((ne=Q.helper)==null?void 0:ne.name)||"Xodim",date:new Date(Q.createdAt)};(yield Aa(V,()=>{console.log("Chek chiqarildi:",Q.receiptNumber)}))?t("Chek muvaffaqiyatli chiqarildi","Muvaffaqiyat","success"):t("Chek chiqarishda xatolik yuz berdi","Xatolik","warning")}catch(V){console.error("Print error:",V),t("Chek chiqarishda xatolik yuz berdi","Xatolik","danger")}finally{de(null)}}),K=Q=>E(this,null,function*(){var ne,V;try{O(Q);const he=yield F.delete(`/receipts/helper-receipt/${Q}`);he.data.success?(t("Chek muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),L(),ce()):t(he.data.message||"Chekni o'chirishda xatolik","Xatolik","danger")}catch(he){console.error("Delete error:",he),t(((V=(ne=he.response)==null?void 0:ne.data)==null?void 0:V.message)||"Chekni o'chirishda xatolik yuz berdi","Xatolik","danger")}finally{O(null),ee(null)}});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-blue-100/30 to-slate-100 pb-20 lg:pb-0",children:[l,e.jsx(Fs,{title:"Xodimlar cheklari"}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Jami cheklar"}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:Se.totalReceipts})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg",children:e.jsx(Ls,{className:"w-7 h-7 text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Jami summa"}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:b(Se.totalAmount)}),e.jsx("p",{className:"text-slate-500 text-xs mt-1",children:"UZS"})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center shadow-lg",children:e.jsx(os,{className:"w-7 h-7 text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Jami mahsulotlar"}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:Se.totalItems})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg",children:e.jsx(Oe,{className:"w-7 h-7 text-white"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ar,{className:"w-5 h-5 text-slate-600"}),e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Filtrlar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(is,{className:"w-4 h-4 inline mr-1"}),"Xodim"]}),e.jsxs("select",{value:P,onChange:Q=>{$(Q.target.value),f(1)},className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",children:[e.jsx("option",{value:"",children:"Barchasi"}),n.map(Q=>e.jsxs("option",{value:Q._id,children:[Q.name," (",Q.receiptCount," ta chek)"]},Q._id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(Bs,{className:"w-4 h-4 inline mr-1"}),"Boshlanish"]}),e.jsx("input",{type:"date",value:w,onChange:Q=>{j(Q.target.value),f(1)},className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(Bs,{className:"w-4 h-4 inline mr-1"}),"Tugash"]}),e.jsx("input",{type:"date",value:M,onChange:Q=>{T(Q.target.value),f(1)},className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(fs,{className:"w-4 h-4 inline mr-1"}),"Qidiruv"]}),e.jsx("input",{type:"text",value:D,onChange:Q=>{c(Q.target.value),f(1)},placeholder:"Chek raqami yoki mahsulot",className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),(P||w||M||D)&&e.jsx("button",{onClick:Ne,className:"mt-4 px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-lg transition-all",children:"Filtrlarni tozalash"})]}),N?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(Q=>e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-slate-200 rounded mb-4 w-1/2"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded w-3/4"})]},Q))}):r.length===0?e.jsxs("div",{className:"bg-white rounded-2xl p-12 shadow-lg border border-slate-200/60 text-center",children:[e.jsx(Hs,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:"Cheklar topilmadi"}),e.jsx("p",{className:"text-slate-600",children:"Tanlangan filtrlar bo'yicha cheklar mavjud emas"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(Q=>{var ne,V;return e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200/60 overflow-hidden hover:shadow-xl transition-all duration-300",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-3 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(Ls,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-sm truncate",children:Q.receiptNumber}),e.jsxs("span",{className:"px-2 py-0.5 bg-white/20 rounded text-xs font-medium flex-shrink-0",children:[Q.itemsCount," ta"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("button",{onClick:()=>je(Q),disabled:J===Q._id,className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Chekni chiqarish",children:J===Q._id?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(et,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ee(Q._id),disabled:xe===Q._id,className:"p-1.5 bg-red-500/80 hover:bg-red-600 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Chekni o'chirish",children:xe===Q._id?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Ps,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-50 text-xs",children:[e.jsx(is,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"Mijoz:"}),e.jsx("span",{className:"truncate",children:Q.customer?Q.customer.name:"Oddiy mijoz"})]}),(Q.helper||Q.createdBy)&&e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-50 text-xs",children:[e.jsx(is,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"Hodim:"}),e.jsx("span",{className:"truncate",children:((ne=Q.helper)==null?void 0:ne.name)||((V=Q.createdBy)==null?void 0:V.name)||"Noma'lum"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-100 text-xs mt-1.5",children:[e.jsx(it,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:B(Q.createdAt)})]})]}),e.jsxs("div",{className:"p-3 space-y-3",children:[Q.helper&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-white font-bold text-xs flex-shrink-0",children:Q.helper.name.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-slate-900 text-xs truncate",children:Q.helper.name}),e.jsx("p",{className:"text-[10px] text-slate-600 capitalize truncate",children:Q.helper.role})]}),Q.helper.bonusPercentage>0&&e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"text-[10px] text-slate-600",children:"Bonus"}),e.jsxs("p",{className:"font-bold text-emerald-600 text-xs",children:[Q.helper.bonusPercentage,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-emerald-50 to-emerald-100 rounded-xl",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-emerald-700 font-medium mb-0.5",children:"Jami summa"}),e.jsx("p",{className:"text-xl font-bold text-emerald-900 truncate",children:b(Q.total)}),e.jsx("p",{className:"text-[10px] text-emerald-600",children:"UZS"})]}),Q.bonusAmount>0&&e.jsxs("div",{className:"text-right flex-shrink-0 ml-2",children:[e.jsx("p",{className:"text-[10px] text-emerald-700 font-medium mb-0.5",children:"Bonus"}),e.jsx("p",{className:"text-base font-bold text-emerald-900",children:b(Q.bonusAmount)})]})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>ge(Q._id),className:"w-full flex items-center justify-between p-2 bg-slate-50 hover:bg-slate-100 rounded-xl transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(Oe,{className:"w-3.5 h-3.5 text-slate-600 flex-shrink-0"}),e.jsxs("span",{className:"font-medium text-slate-900 text-xs truncate",children:["Mahsulotlar (",Q.totalQuantity," dona)"]})]}),z===Q._id?e.jsx(la,{className:"w-4 h-4 text-slate-600 flex-shrink-0"}):e.jsx(ct,{className:"w-4 h-4 text-slate-600 flex-shrink-0"})]}),z===Q._id&&e.jsx("div",{className:"mt-2 space-y-1.5 max-h-64 overflow-y-auto",children:Q.items.map(he=>e.jsx("div",{className:"flex items-center gap-2 p-2 bg-white border border-slate-200 rounded-xl hover:border-blue-300 transition-all",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-slate-900 text-xs truncate",children:he.name}),e.jsxs("p",{className:"text-[10px] text-slate-600 truncate",children:["Kod: ",he.code]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5",children:[e.jsxs("span",{className:"text-xs text-slate-600 truncate",children:[he.quantity," x ",b(he.price)]}),e.jsxs("span",{className:"text-xs font-bold text-blue-600 flex-shrink-0",children:["= ",b(he.total)]})]})]})},he._id))})]})]})]},Q._id)})}),R>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6",children:[e.jsx("button",{onClick:()=>f(Q=>Math.max(1,Q-1)),disabled:q===1,className:"px-4 py-2 rounded-xl bg-white border border-slate-300 text-slate-700 font-medium hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Oldingi"}),e.jsxs("span",{className:"px-4 py-2 text-slate-700 font-medium",children:[q," / ",R]}),e.jsx("button",{onClick:()=>f(Q=>Math.min(R,Q+1)),disabled:q===R,className:"px-4 py-2 rounded-xl bg-white border border-slate-300 text-slate-700 font-medium hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Keyingi"})]})]})]}),ke&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-scale-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx(Ps,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"Chekni o'chirish"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Bu amalni qaytarib bo'lmaydi"})]})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:[e.jsxs("p",{className:"text-sm text-red-800 mb-2",children:[e.jsx("strong",{children:"Diqqat!"})," Chekni o'chirsangiz:"]}),e.jsxs("ul",{className:"text-sm text-red-700 space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ Mahsulot miqdorlari qaytariladi"}),e.jsx("li",{children:"â€¢ Xodim bonusi ayriladi"}),e.jsx("li",{children:"â€¢ Statistika yangilanadi"}),e.jsx("li",{children:"â€¢ Bu amalni bekor qilib bo'lmaydi"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>ee(null),disabled:xe===ke,className:"flex-1 px-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-all disabled:opacity-50",children:"Bekor qilish"}),e.jsx("button",{onClick:()=>K(ke),disabled:xe===ke,className:"flex-1 px-4 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-xl transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:xe===ke?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"O'chirilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ps,{className:"w-5 h-5"}),"O'chirish"]})})]})]})})]})}function on(){const[t,l]=s.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-surface-50",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(Ma,{items:Tr,basePath:"/cashier",collapsed:t,setCollapsed:l})}),e.jsx("main",{className:`transition-all duration-300 ease-smooth ${t?"lg:ml-[72px]":"lg:ml-64"}`,children:e.jsx(Bt,{})})]})}function cn(){const{user:t,logout:l}=tt();return e.jsxs("div",{className:"min-h-screen bg-surface-50",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-white/80 backdrop-blur-xl border-b border-surface-200/60",children:e.jsxs("div",{className:"px-3 sm:px-4 h-14 sm:h-16 flex items-center justify-between max-w-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-shrink",children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center shadow-sm flex-shrink-0",children:e.jsx(rr,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),e.jsx("span",{className:"font-bold text-base sm:text-lg text-surface-900 hidden sm:inline truncate",children:"Sardorbek.Furnetura"}),e.jsx("span",{className:"font-bold text-sm text-surface-900 sm:hidden truncate",children:"Sardorbek"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-2 px-3 py-2 bg-surface-100 rounded-xl max-w-[150px]",children:[e.jsx(is,{className:"w-4 h-4 text-surface-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-surface-700 truncate",children:t==null?void 0:t.name})]}),e.jsx("div",{className:"md:hidden flex items-center justify-center w-8 h-8 bg-surface-100 rounded-lg flex-shrink-0",children:e.jsx(is,{className:"w-4 h-4 text-surface-500"})}),e.jsx("button",{onClick:l,className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg text-surface-500 hover:text-danger-600 hover:bg-danger-50 transition-colors flex-shrink-0",title:"Chiqish",children:e.jsx(It,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]})}),e.jsx("main",{className:"p-3 sm:p-4",children:e.jsx(Bt,{})})]})}function dn(){var $e,le,Be,x,pe,we,Re,De,Ae;const{showAlert:t,AlertComponent:l}=vs(),[r,h]=s.useState(!1),[n,g]=s.useState(""),[N,p]=s.useState([]),[P,$]=s.useState([]),[w,j]=s.useState([]),[M,T]=s.useState(null),[D,c]=s.useState(null),[z,S]=s.useState(!1),[q,f]=s.useState([]),[R,W]=s.useState(null),[J,de]=s.useState(""),[xe,O]=s.useState(!1),[ke,ee]=s.useState(!1),[Se,ie]=s.useState({name:"",phone:""}),[ce,L]=s.useState(!1),[ge,B]=s.useState("environment"),Ne=s.useRef(null);s.useEffect(()=>(je(),K(),()=>{Ne.current&&Ne.current.stop().catch(()=>{})}),[]);const je=()=>E(this,null,function*(){try{const A=yield F.get("/products"),fe=A.data.data||A.data;$(Array.isArray(fe)?fe:[])}catch(A){console.error("Error fetching products:",A)}}),K=()=>E(this,null,function*(){try{const A=yield F.get("/customers");f(A.data.data||A.data||[])}catch(A){console.error("Error fetching customers:",A)}}),Q=()=>E(this,null,function*(){var A,fe;if(!Se.name.trim()||!Se.phone.trim()){t("Iltimos, ism va telefon raqamni kiriting!","Ogohlantirish","warning");return}L(!0);try{const ae=(yield F.post("/customers",{name:Se.name.trim(),phone:Se.phone.trim()})).data;f(Ce=>[ae,...Ce]),W(ae),ee(!1),O(!1),ie({name:"",phone:""}),t(`Mijoz ${ae.name} qo'shildi!`,"Muvaffaqiyat","success")}catch(i){t(((fe=(A=i==null?void 0:i.response)==null?void 0:A.data)==null?void 0:fe.message)||"Mijoz qo'shishda xatolik","Xatolik","danger")}finally{L(!1)}}),ne=()=>E(this,null,function*(){T(null),g(""),j([]),h(!0),yield new Promise(A=>setTimeout(A,100));try{if(!document.getElementById("qr-reader"))throw new Error("QR reader element topilmadi. Iltimos, qayta urinib ko'ring.");const fe=new yr("qr-reader");Ne.current=fe,yield fe.start({facingMode:ge},{fps:30,qrbox:{width:250,height:250},aspectRatio:1,disableFlip:!1,videoConstraints:{facingMode:ge,width:{ideal:1280},height:{ideal:720}}},i=>E(this,null,function*(){var y;console.log("QR kod o'qildi:",i);let ae=null;try{const U=JSON.parse(i);U&&typeof U=="object"&&(U.code?ae=String(U.code):(U.id||U._id)&&(ae=String(U.id||U._id)))}catch(U){}let Ce=ae||i;if(Ce.includes("/product/")){const U=Ce.split("/product/");U.length>1&&(Ce=U[1].split("?")[0].split("#")[0])}console.log("Qidiruv kaliti:",Ce);let qe=P.find(U=>U.code===Ce||U._id===Ce);if(console.log("Local'da topildi:",!!qe),!qe)try{console.log("Serverdan qidirilmoqda:",Ce),qe=(yield F.get(`/products/scan-qr/${encodeURIComponent(Ce)}`)).data,console.log("Serverdan topildi:",!!qe)}catch(U){console.error("Server qidiruv xatosi:",(y=U.response)==null?void 0:y.status,U.message)}qe?(T(qe),P.find(U=>U._id===qe._id)||$(U=>[...U,qe])):t("Tovar topilmadi: "+Ce,"Xatolik","warning"),V()}),()=>{})}catch(A){console.error("Scanner error:",A),h(!1);let fe="Kamerani ishga tushirishda xatolik";A.name==="NotAllowedError"?fe="Kamera ruxsati berilmadi. Brauzer sozlamalarida kamera ruxsatini yoqing.":A.name==="NotFoundError"?fe="Kamera topilmadi. Qurilmangizda kamera borligini tekshiring.":A.name==="NotReadableError"?fe="Kamera band. Boshqa ilova kamerani ishlatayotgan bo'lishi mumkin.":A.name==="NotSupportedError"?fe="HTTPS kerak. Xavfsiz ulanish orqali kirish kerak.":A.message&&(fe=A.message),t(fe,"Xatolik","danger")}}),V=()=>E(this,null,function*(){if(Ne.current){try{yield Ne.current.stop()}catch(A){}Ne.current=null}h(!1)}),he=()=>E(this,null,function*(){r?(yield V(),B(A=>A==="environment"?"user":"environment"),setTimeout(()=>{ne()},300)):B(A=>A==="environment"?"user":"environment")}),ye=A=>{if(g(A),T(null),A.length>0){const fe=P.filter(i=>i.name.toLowerCase().includes(A.toLowerCase())||i.code.toLowerCase().includes(A.toLowerCase()));j(fe)}else j([])},Fe=(A,fe)=>{let i=15;fe>=100?i=11:fe>=10?i=13:i=15;const ae=A*(1+i/100);return Math.round(ae)},Ke=A=>A>=100?{name:"100+ dona",markupPercent:11,discount:!0}:A>=10?{name:"10-99 dona",markupPercent:13,discount:!0}:{name:"1-9 dona",markupPercent:15,discount:!1},Ue=A=>{p(fe=>{const i=fe.find(Ce=>Ce._id===A._id);if(i){const Ce=i.cartQuantity+1,qe=Fe(A.price,Ce);return fe.map(y=>y._id===A._id?k(v({},y),{cartQuantity:Ce,price:qe}):y)}const ae=Fe(A.price,1);return[...fe,k(v({},A),{cartQuantity:1,price:ae})]}),g(""),j([]),T(null)},as=(A,fe)=>{p(i=>i.map(ae=>{if(ae._id===A){const Ce=Math.max(1,ae.cartQuantity+fe),qe=P.find(y=>y._id===A);if(qe){const y=Fe(qe.price,Ce);return k(v({},ae),{cartQuantity:Ce,price:y})}return k(v({},ae),{cartQuantity:Ce})}return ae}))},Ve=A=>{p(fe=>fe.filter(i=>i._id!==A))},u=()=>E(this,null,function*(){if(N.length===0){t("Savat bo'sh!","Ogohlantirish","warning");return}if(!R){t("Iltimos, mijozni tanlang!","Ogohlantirish","warning"),O(!0);return}S(!0);try{const A={customer:R._id==="default"?null:R._id,items:N.map(i=>({product:i._id,name:i.name,code:i.code,price:i.price,quantity:i.cartQuantity})),total:Pe,paymentMethod:"cash",paidAmount:Pe,status:R._id==="default"?"completed":"pending"};yield F.post("/receipts",A);const fe=R._id==="default"?"Oddiy mijoz":R.name;t(`Chek ${fe} uchun saqlandi!`,"Muvaffaqiyat","success"),p([]),W(null)}catch(A){console.error("Error sending receipt:",A),t("Xatolik yuz berdi","Xatolik","danger")}finally{S(!1)}}),te=q.filter(A=>A.name.toLowerCase().includes(J.toLowerCase())||A.phone.includes(J)),Pe=N.reduce((A,fe)=>A+fe.price*fe.cartQuantity,0);return e.jsxs("div",{className:"min-h-[calc(100vh-120px)] bg-gradient-to-b from-surface-50 to-surface-100/80 rounded-3xl p-4 sm:p-6 lg:p-8 shadow-sm overflow-x-hidden",children:[l,e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-semibold text-surface-900 flex items-center gap-2",children:[e.jsx(yt,{className:"w-6 h-6 text-brand-600"}),"Skaner orqali savat to'ldirish"]}),e.jsx("p",{className:"text-sm text-surface-500 mt-1",children:"Tovarlarni QR kod orqali tezda toping, savatga qo'shing va kassaga yuboring."})]}),e.jsxs("button",{onClick:()=>O(!0),className:`flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-xl transition-all shadow-sm text-sm sm:text-base w-full sm:w-auto ${R?"bg-green-50 border-2 border-green-500 text-green-700 hover:bg-green-100":"bg-brand-500 text-white hover:bg-brand-600"}`,children:[e.jsx(is,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("div",{className:"text-xs font-medium",children:R?"Mijoz tanlandi":"Mijoz tanlash"}),R&&e.jsx("div",{className:"text-sm font-semibold truncate",children:R.name})]})]})]}),xe&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-surface-200 flex items-center justify-between bg-gradient-to-r from-brand-500 to-brand-600",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(Os,{className:"w-5 h-5"}),"Mijoz tanlash"]}),e.jsx("button",{onClick:()=>O(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/20 transition-colors text-white",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:ke?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900",children:"Yangi mijoz qo'shish"}),e.jsx("button",{onClick:()=>{ee(!1),ie({name:"",phone:""})},className:"text-surface-500 hover:text-surface-700",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Ism"}),e.jsx("input",{type:"text",value:Se.name,onChange:A=>ie(k(v({},Se),{name:A.target.value})),placeholder:"Alisher Karimov",className:"w-full px-4 py-2.5 border border-surface-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Telefon raqam"}),e.jsx("input",{type:"tel",value:Se.phone,onChange:A=>ie(k(v({},Se),{phone:A.target.value})),placeholder:"+998901234567",className:"w-full px-4 py-2.5 border border-surface-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>{ee(!1),ie({name:"",phone:""})},className:"flex-1 px-4 py-2.5 border border-surface-200 text-surface-700 rounded-xl hover:bg-surface-50 transition-colors font-medium",disabled:ce,children:"Bekor qilish"}),e.jsx("button",{onClick:Q,disabled:ce,className:"flex-1 px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-xl transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:ce?"Qo'shilmoqda...":"Qo'shish"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",value:J,onChange:A=>de(A.target.value),placeholder:"Ism yoki telefon raqam...",className:"w-full pl-10 pr-4 py-2.5 border border-surface-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500",autoFocus:!0})]}),e.jsxs("button",{onClick:()=>ee(!0),className:"px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-xl transition-colors flex items-center gap-2 font-medium whitespace-nowrap",children:[e.jsx(ps,{className:"w-4 h-4"}),"Yangi"]})]}),e.jsxs("div",{className:"max-h-96 overflow-y-auto space-y-2",children:[e.jsxs("button",{onClick:()=>{W({_id:"default",name:"Oddiy mijoz",phone:"",debt:0}),O(!1),de("")},className:`w-full p-3 rounded-xl text-left transition-all ${(R==null?void 0:R._id)==="default"?"bg-blue-50 border-2 border-blue-500":"bg-blue-50/50 hover:bg-blue-100 border-2 border-blue-200"}`,children:[e.jsxs("div",{className:"font-medium text-blue-900 flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4"}),"Oddiy mijoz"]}),e.jsx("div",{className:"text-xs text-blue-600",children:"Faqat to'liq to'lov"})]}),te.length===0?e.jsxs("div",{className:"text-center py-8 text-surface-500",children:[e.jsx(Os,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Mijoz topilmadi"})]}):te.map(A=>e.jsxs("button",{onClick:()=>{W(A),O(!1),de("")},className:`w-full p-3 rounded-xl text-left transition-all ${(R==null?void 0:R._id)===A._id?"bg-green-50 border-2 border-green-500":"bg-surface-50 hover:bg-surface-100 border-2 border-transparent"}`,children:[e.jsx("div",{className:"font-medium text-surface-900",children:A.name}),e.jsx("div",{className:"text-sm text-surface-500",children:A.phone})]},A._id))]})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_400px] gap-4 lg:gap-6 items-start w-full",children:[e.jsxs("div",{className:"space-y-4 lg:space-y-5 min-w-0",children:[e.jsx("div",{className:"card p-3 sm:p-4 border border-surface-100 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-3 items-stretch",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(fs,{className:"absolute left-3 sm:left-3.5 top-1/2 -translate-y-1/2 w-4 sm:w-5 h-4 sm:h-5 text-brand-400 z-10 pointer-events-none"}),e.jsx("input",{type:"text",value:n,onChange:A=>ye(A.target.value),placeholder:"Qidirish...",className:"w-full h-12 pl-10 sm:pl-11 pr-10 rounded-xl border-2 border-surface-200 focus:border-brand-400 focus:ring-4 focus:ring-brand-100 transition-all text-sm sm:text-base text-surface-900 placeholder:text-surface-400 bg-white shadow-sm hover:border-brand-300 relative z-0"}),n&&e.jsx("button",{onClick:()=>ye(""),className:"absolute right-3 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full bg-surface-100 hover:bg-surface-200 flex items-center justify-center transition-colors z-10",children:e.jsx(be,{className:"w-4 h-4 text-surface-500"})})]}),e.jsxs("button",{onClick:r?V:ne,className:`h-12 flex items-center justify-center gap-2 rounded-xl px-4 font-medium ${r?"btn-secondary":"btn-primary"} shadow-md hover:shadow-lg transition-all`,children:[e.jsx(yt,{className:"w-5 h-5"}),e.jsx("span",{children:r?"Skanerni to'xtatish":"QR skaner"})]})]})}),r&&e.jsx("div",{className:"card border border-brand-100 bg-gradient-to-br from-brand-50/60 to-surface-0 shadow-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 sm:p-5",children:[e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl overflow-hidden ring-4 ring-brand-300/50 ring-offset-4 ring-offset-surface-0 shadow-lg",children:[e.jsx("div",{id:"qr-reader",className:"w-full aspect-square bg-black"}),e.jsx("button",{onClick:he,className:"absolute bottom-3 right-3 w-9 h-9 bg-white/95 hover:bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-all hover:scale-105 z-10 backdrop-blur-sm border border-white/20",title:ge==="environment"?"Old kameraga o'tish":"Orqa kameraga o'tish",children:e.jsx(Rs,{className:"w-4 h-4 text-surface-600"})})]}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-surface-800",children:"QR kodni kameraga toâ€˜gâ€˜ri tuting"}),e.jsx("p",{className:"text-xs text-surface-500",children:"Kamera kodni oâ€˜qigach, tovar ma'lumotlari avtomatik chiqadi."})]})]})}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-success-500 to-success-600 p-4 flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(aa,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Tovar topildi!"})]}),e.jsx("button",{onClick:()=>T(null),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/20 transition-colors text-white",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide",children:"Mahsulot nomi"}),e.jsx("p",{className:"text-xl font-bold text-surface-900 mt-1",children:M.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide",children:"Mahsulot kodi"}),e.jsx("p",{className:"text-lg font-semibold text-surface-700 mt-1",children:M.code})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide",children:"Mavjud miqdor"}),e.jsxs("p",{className:"text-lg font-semibold text-brand-600 mt-1",children:[M.quantity," dona"]})]}),e.jsxs("div",{className:"bg-brand-50 border border-brand-200 rounded-xl p-4",children:[e.jsx("label",{className:"text-xs font-medium text-brand-700 uppercase tracking-wide",children:"Optom narxi"}),e.jsxs("p",{className:"text-2xl font-bold text-brand-600 mt-1",children:[b(M.price)," so'm"]})]}),(M.unitPrice||M.boxPrice||(($e=M.prices)==null?void 0:$e.perUnit)||((le=M.prices)==null?void 0:le.perBox)||((Be=M.prices)==null?void 0:Be.perRoll))&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide mb-2 block",children:"Boshqa narxlar"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(x=M.prices)!=null&&x.perUnit||M.unitPrice||M.price?e.jsxs("div",{className:"flex-1 min-w-[140px] px-4 py-3 rounded-xl bg-success-50 border border-success-200",children:[e.jsx("p",{className:"text-xs text-success-600 font-medium",children:"Dona narxi"}),e.jsxs("p",{className:"text-lg font-bold text-success-700 mt-0.5",children:[b(((pe=M.prices)==null?void 0:pe.perUnit)||M.unitPrice||M.price)," so'm"]})]}):null,(we=M.prices)!=null&&we.perBox||M.boxPrice?e.jsxs("div",{className:"flex-1 min-w-[140px] px-4 py-3 rounded-xl bg-brand-50 border border-brand-200",children:[e.jsx("p",{className:"text-xs text-brand-600 font-medium",children:"Karobka narxi"}),e.jsxs("p",{className:"text-lg font-bold text-brand-700 mt-0.5",children:[b(((Re=M.prices)==null?void 0:Re.perBox)||M.boxPrice||0)," so'm"]})]}):null,(De=M.prices)!=null&&De.perRoll?e.jsxs("div",{className:"flex-1 min-w-[140px] px-4 py-3 rounded-xl bg-sky-50 border border-sky-200",children:[e.jsx("p",{className:"text-xs text-sky-600 font-medium",children:"Rulon narxi"}),e.jsxs("p",{className:"text-lg font-bold text-sky-700 mt-0.5",children:[b(((Ae=M.prices)==null?void 0:Ae.perRoll)||0)," so'm"]})]}):null]})]}),M.pricingTiers&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide mb-2 block",children:"Miqdorga qarab chegirmalar"}),e.jsxs("div",{className:"space-y-2",children:[M.pricingTiers.tier1&&e.jsxs("div",{className:"px-4 py-3 rounded-xl border border-emerald-200 bg-emerald-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-emerald-700",children:[M.pricingTiers.tier1.minQuantity,"-",M.pricingTiers.tier1.maxQuantity," dona"]}),e.jsxs("span",{className:"text-lg font-bold text-emerald-700",children:[M.pricingTiers.tier1.discountPercent,"% chegirma"]})]}),e.jsxs("p",{className:"text-sm text-emerald-600 mt-1",children:["Narx: ",b(Math.round(M.price*(1-M.pricingTiers.tier1.discountPercent/100)))," so'm"]})]}),M.pricingTiers.tier2&&e.jsxs("div",{className:"px-4 py-3 rounded-xl border border-sky-200 bg-sky-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-sky-700",children:[M.pricingTiers.tier2.minQuantity,"-",M.pricingTiers.tier2.maxQuantity," dona"]}),e.jsxs("span",{className:"text-lg font-bold text-sky-700",children:[M.pricingTiers.tier2.discountPercent,"% chegirma"]})]}),e.jsxs("p",{className:"text-sm text-sky-600 mt-1",children:["Narx: ",b(Math.round(M.price*(1-M.pricingTiers.tier2.discountPercent/100)))," so'm"]})]}),M.pricingTiers.tier3&&e.jsxs("div",{className:"px-4 py-3 rounded-xl border border-violet-200 bg-violet-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-violet-700",children:[M.pricingTiers.tier3.minQuantity,"+ dona"]}),e.jsxs("span",{className:"text-lg font-bold text-violet-700",children:[M.pricingTiers.tier3.discountPercent,"% chegirma"]})]}),e.jsxs("p",{className:"text-sm text-violet-600 mt-1",children:["Narx: ",b(Math.round(M.price*(1-M.pricingTiers.tier3.discountPercent/100)))," so'm"]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>T(null),className:"flex-1 px-4 py-3 border border-surface-200 text-surface-700 rounded-xl hover:bg-surface-50 transition-colors font-medium",children:"Yopish"}),e.jsxs("button",{onClick:()=>{Ue(M),T(null)},className:"flex-1 px-4 py-3 bg-success-500 hover:bg-success-600 text-white rounded-xl transition-colors font-medium flex items-center justify-center gap-2",children:[e.jsx(ps,{className:"w-5 h-5"}),"Savatga qo'shish"]})]})]})]})}),n&&w.length>0&&e.jsxs("div",{className:"card p-0 overflow-hidden border border-surface-100 shadow-sm",children:[e.jsxs("div",{className:"px-4 pt-4 pb-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700",children:"Qidiruv natijalari"}),e.jsxs("span",{className:"text-xs text-surface-400",children:[w.length," ta topildi"]})]}),e.jsx("div",{className:"divide-y divide-surface-100 max-h-72 overflow-auto custom-scrollbar",children:w.map(A=>e.jsxs("button",{onClick:()=>Ue(A),className:"w-full flex items-center justify-between p-4 hover:bg-surface-50/80 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(Oe,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900 line-clamp-1",children:A.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",A.code]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-brand-600",children:[b(A.price)," so'm"]}),e.jsxs("p",{className:"text-[11px] text-surface-400",children:[A.quantity," dona"]})]})]},A._id))})]}),n&&w.length===0&&e.jsx("div",{className:"card text-center py-10 bg-surface-0/60 border-dashed border-surface-200",children:e.jsx("p",{className:"text-sm text-surface-500",children:"Tovar topilmadi. Nomi yoki kodini tekshirib qayta urinib ko'ring."})})]}),e.jsx("div",{className:"lg:sticky lg:top-4 min-w-0 w-full",children:e.jsxs("div",{className:"card border border-surface-100 shadow-md shadow-surface-900/5 p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 rounded-xl bg-brand-50 flex items-center justify-center flex-shrink-0",children:e.jsx(hs,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Savat"}),e.jsx("p",{className:"text-xs text-surface-400 truncate",children:"Tanlangan tovarlar"})]})]}),e.jsxs("span",{className:"badge-primary text-xs px-2 sm:px-3 py-1 rounded-full flex-shrink-0",children:[N.length," ta"]})]}),N.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-10",children:[e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 bg-surface-100 rounded-2xl flex items-center justify-center mx-auto mb-3",children:e.jsx(hs,{className:"w-7 h-7 sm:w-8 sm:h-8 text-surface-300"})}),e.jsx("p",{className:"text-surface-500 text-xs sm:text-sm px-2",children:"Savat bo'sh. QR skaner yoki qidiruv orqali tovar qo'shing."})]}):e.jsx("div",{className:"space-y-2 sm:space-y-3 max-h-[360px] overflow-auto pr-1 custom-scrollbar",children:N.map(A=>{var Ce,qe,y,U,oe,ve,ss,_e,rs,Xe,Ss,zs,Cs,js,Ns,xs,gs;const fe=Ke(A.cartQuantity);(Ce=P.find(ks=>ks._id===A._id))!=null&&Ce.price||A.price;const i=P.find(ks=>ks._id===A._id),ae=D===A._id;return e.jsxs("div",{className:"bg-surface-50 rounded-xl border border-surface-100",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 sm:p-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate text-sm",children:A.name}),e.jsxs("button",{onClick:()=>c(ae?null:A._id),className:"flex items-center gap-1.5 mt-1 hover:opacity-80 transition-opacity",children:[e.jsxs("span",{className:`text-[9px] sm:text-[10px] font-bold px-1.5 py-0.5 rounded ${fe.discount?"bg-success-100 text-success-700":"bg-surface-200 text-surface-600"}`,children:[fe.name," â€¢ ",fe.markupPercent,"%"]}),ae?e.jsx(la,{className:"w-3 h-3 text-surface-500"}):e.jsx(ct,{className:"w-3 h-3 text-surface-500"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-brand-600 font-semibold mt-1",children:[b(A.price*A.cartQuantity)," so'm"]})]}),e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1 bg-white rounded-lg border border-surface-200 px-1 sm:px-1.5 py-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>as(A._id,-1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded hover:bg-surface-100 transition-colors",children:e.jsx(dt,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("input",{type:"number",min:"1",value:A.cartQuantity,onChange:ks=>{const re=(parseInt(ks.target.value)||1)-A.cartQuantity;as(A._id,re)},className:"w-8 sm:w-10 text-center font-semibold text-xs sm:text-sm bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-brand-500 rounded"}),e.jsx("button",{onClick:()=>as(A._id,1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded hover:bg-surface-100 transition-colors",children:e.jsx(ps,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsx("button",{onClick:()=>Ve(A._id),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded-lg hover:bg-red-50 text-red-500 transition-colors flex-shrink-0",children:e.jsx(be,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]}),ae&&i&&e.jsxs("div",{className:"px-2 sm:px-3 pb-2 sm:pb-3 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-[10px] font-medium text-green-900",children:[((y=(qe=i.pricingTiers)==null?void 0:qe.tier1)==null?void 0:y.minQuantity)||1,"-",((oe=(U=i.pricingTiers)==null?void 0:U.tier1)==null?void 0:oe.maxQuantity)||9," dona"]})}),e.jsxs("span",{className:"text-xs font-bold text-green-700",children:[((ss=(ve=i.pricingTiers)==null?void 0:ve.tier1)==null?void 0:ss.discountPercent)||15,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-[10px] font-medium text-blue-900",children:[((rs=(_e=i.pricingTiers)==null?void 0:_e.tier2)==null?void 0:rs.minQuantity)||10,"-",((Ss=(Xe=i.pricingTiers)==null?void 0:Xe.tier2)==null?void 0:Ss.maxQuantity)||99," dona"]})}),e.jsxs("span",{className:"text-xs font-bold text-blue-700",children:[((Cs=(zs=i.pricingTiers)==null?void 0:zs.tier2)==null?void 0:Cs.discountPercent)||13,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-[10px] font-medium text-purple-900",children:[((Ns=(js=i.pricingTiers)==null?void 0:js.tier3)==null?void 0:Ns.minQuantity)||100,"+ dona"]})}),e.jsxs("span",{className:"text-xs font-bold text-purple-700",children:[((gs=(xs=i.pricingTiers)==null?void 0:xs.tier3)==null?void 0:gs.discountPercent)||11,"%"]})]})]})]},A._id)})}),N.length>0&&e.jsxs("div",{className:"mt-4 pt-3 sm:pt-4 border-t border-surface-200 space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-surface-500 text-xs sm:text-sm",children:"Jami summa"}),e.jsxs("span",{className:"text-xl sm:text-2xl font-bold text-surface-900",children:[b(Pe)," so'm"]})]}),e.jsx("button",{onClick:u,disabled:z,className:"btn-primary w-full py-3 sm:py-3.5 text-sm sm:text-base rounded-xl flex items-center justify-center gap-2",children:z?e.jsx("div",{className:"spinner"}):e.jsxs(e.Fragment,{children:[e.jsx(ya,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Kassaga yuborish"]})})]})]})})]})]})}function mn(){const t=Es(),l=st(),[r,h]=s.useState(!1),[n,g]=s.useState(null),[N,p]=s.useState("idle"),{showAlert:P,AlertComponent:$}=vs(),[w,j]=s.useState({arrived:0,left:0}),[M,T]=s.useState("");s.useEffect(()=>{window.location.pathname.startsWith("/kassa")||t("/kassa",{replace:!0});const W=()=>{window.history.pushState(null,"",window.location.href)};return window.addEventListener("popstate",W),window.history.pushState(null,"",window.location.href),()=>{window.removeEventListener("popstate",W)}},[t]);const c=(()=>{try{const R=localStorage.getItem("kassaLoggedIn");if(R)return{username:JSON.parse(R).username||"Kassa",isActive:!0}}catch(R){console.error("Error getting user info:",R)}return{username:"Kassa",isActive:!1}})(),z=()=>{const R=new Date,W=R.getFullYear(),J=String(R.getMonth()+1).padStart(2,"0"),de=String(R.getDate()).padStart(2,"0");return`${W}-${J}-${de}`};s.useEffect(()=>{const R=()=>{const J=z();T(J);const de=`attendance:kassa:${c.username}:${J}`,xe=localStorage.getItem(de),O=xe?JSON.parse(xe):{arrived:0,left:0};j(O),p(O.arrived>0&&O.left===0?"arrived":"idle")};R();const W=setInterval(()=>{z()!==M&&R()},6e4);return()=>clearInterval(W)},[c.username,M]);const S=R=>E(this,null,function*(){var W,J;if(!n)try{if(g(R),yield F.post("/telegram/attendance/kassa",{type:R,username:c.username}),yield P(R==="arrived"?"Keldingiz xabari yuborildi":"Ketdingiz xabari yuborildi","Muvaffaqiyatli","success"),R==="arrived"){const de=`attendance:kassa:${c.username}:${M||z()}`,xe=w,O=k(v({},xe),{arrived:xe.arrived+1});localStorage.setItem(de,JSON.stringify(O)),j(O),O.arrived>0&&O.left===0&&p("arrived")}else{const de=`attendance:kassa:${c.username}:${M||z()}`,xe=w,O=k(v({},xe),{left:xe.left+1});localStorage.setItem(de,JSON.stringify(O)),j(O),q(),window.location.replace("/kassa-login")}}catch(de){yield P(((J=(W=de==null?void 0:de.response)==null?void 0:W.data)==null?void 0:J.message)||"Xabar yuborishda xatolik","Xatolik","danger")}finally{g(null)}}),q=s.useCallback(()=>{localStorage.removeItem("kassaLoggedIn"),localStorage.removeItem("kassaToken"),window.location.replace("/kassa-login")},[]),f=()=>{const R=l.pathname;return R==="/kassa"||R==="/kassa/"?"Kassa":R==="/kassa/receipts"?"Cheklar":R==="/kassa/clients"?"Mijozlar":R==="/kassa/products"?"Tovarlar":"Kassa"};return e.jsxs("div",{className:"h-screen flex overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[r&&e.jsx("div",{className:"fixed inset-0 z-40 lg:hidden",style:{background:"rgba(46, 16, 101, 0.6)",backdropFilter:"blur(8px)"},onClick:()=>h(!1)}),e.jsxs("aside",{className:`
        fixed lg:static inset-y-0 left-0 z-50 w-72 flex flex-col
        transform transition-transform duration-300 ease-in-out lg:transform-none
        ${r?"translate-x-0":"-translate-x-full lg:translate-x-0"}
      `,style:{background:"linear-gradient(180deg, #2e1065 0%, #4c1d95 100%)",borderRight:"1px solid rgba(6, 182, 212, 0.2)",boxShadow:"4px 0 24px -4px rgba(46, 16, 101, 0.3)"},children:[e.jsxs("div",{className:"p-5 flex items-center justify-between",style:{borderBottom:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, transparent 100%)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center overflow-hidden",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-lg text-white tracking-wide",style:{fontFamily:"'Playfair Display', serif",letterSpacing:"0.5px"},children:"Sardor"}),e.jsx("p",{className:"text-sm font-semibold tracking-wider",style:{color:"#c4b5fd",fontFamily:"'Montserrat', sans-serif",letterSpacing:"1.5px"},children:"FURNITURA"})]})]}),e.jsx("button",{onClick:()=>h(!1),className:"lg:hidden p-2 rounded-xl transition-colors",style:{background:"rgba(255, 255, 255, 0.1)",color:"#c4b5fd"},children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"flex-1 p-4 overflow-y-auto",children:e.jsx("div",{className:"space-y-1.5",children:[{path:"/kassa",label:"Kassa",icon:ka},{path:"/kassa/receipts",label:"Cheklar",icon:Hs},{path:"/kassa/clients",label:"Mijozlar",icon:Os},{path:"/kassa/debts",label:"Qarz daftarcha",icon:Hs},{path:"/kassa/products",label:"Tovarlar",icon:Oe}].map(({path:R,label:W,icon:J})=>e.jsxs(nr,{to:R,onClick:()=>h(!1),className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200",style:{background:l.pathname===R?"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)":"transparent",color:l.pathname===R?"#ffffff":"#c4b5fd",boxShadow:l.pathname===R?"0 4px 12px -2px rgba(6, 182, 212, 0.4)":"none"},children:[e.jsx(J,{className:"w-5 h-5"}),W]},R))})}),e.jsxs("div",{className:"p-4",style:{borderTop:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.2) 100%)"},children:[e.jsx("div",{className:"rounded-2xl p-4 mb-3",style:{background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(6, 182, 212, 0.15)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 12px -2px rgba(124, 58, 237, 0.4)"},children:e.jsx("span",{className:"text-base font-bold text-white",children:c.username.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-bold text-white truncate",children:c.username==="alisher"?"Namozov Alisher":c.username==="kassa1"?"Kassa Xodimi":c.username==="admin"?"Administrator":c.username}),e.jsxs("p",{className:"text-xs font-medium flex items-center gap-1",style:{color:"#a5b4fc"},children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-400 rounded-full animate-pulse"}),"Kassir â€¢ Faol"]})]})]})}),e.jsxs("button",{onClick:q,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl transition-all duration-200 text-sm font-semibold",style:{border:"1px solid rgba(239, 68, 68, 0.3)",color:"#fca5a5"},title:"Kassa tizimidan chiqish",children:[e.jsx(It,{className:"w-4 h-4"}),"Chiqish"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:ml-0 h-full",children:[e.jsxs("header",{className:"px-4 lg:px-6 h-14 lg:h-16 flex items-center justify-between flex-shrink-0",style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",borderBottom:"1px solid rgba(91, 33, 182, 0.1)",backdropFilter:"blur(20px)",boxShadow:"0 4px 20px -4px rgba(46, 16, 101, 0.08)"},children:[e.jsx("button",{onClick:()=>h(!0),className:"lg:hidden p-2.5 rounded-xl transition-colors",style:{background:"rgba(91, 33, 182, 0.08)",color:"#5b21b6"},children:e.jsx(kt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg lg:text-xl font-bold",style:{color:"#2e1065"},children:f()}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium",style:{color:"#6b7280"},children:"Faol"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Bt,{})})]}),N==="idle"&&e.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0",style:{background:"rgba(250, 245, 255, 0.7)",backdropFilter:"blur(8px)"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:e.jsxs("div",{className:"mx-auto max-w-md flex gap-4",children:[e.jsx("button",{onClick:()=>S("arrived"),disabled:n!==null,className:"pointer-events-auto flex-1 px-6 py-4 rounded-2xl text-white font-bold shadow-lg disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 8px 24px -4px rgba(6, 182, 212, 0.4)"},children:n==="arrived"?"Yuborilmoqda...":"Keldim"}),e.jsx("button",{onClick:()=>S("left"),disabled:n!==null,className:"pointer-events-auto flex-1 px-6 py-4 rounded-2xl text-white font-bold shadow-lg disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",boxShadow:"0 8px 24px -4px rgba(220, 38, 38, 0.4)"},children:n==="left"?"Yuborilmoqda...":"Ketdim"})]})})]}),N==="arrived"&&e.jsxs("div",{className:"fixed bottom-4 right-4 z-40 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>S("arrived"),disabled:n!==null,className:"px-3 py-2 rounded-xl text-white text-sm font-semibold shadow-md disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:n==="arrived"?"...":"Keldim"}),e.jsx("button",{onClick:()=>S("left"),disabled:n!==null,className:"px-3 py-2 rounded-xl text-white text-sm font-semibold shadow-md disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",boxShadow:"0 4px 12px -2px rgba(220, 38, 38, 0.4)"},children:n==="left"?"...":"Ketdim"})]}),$]})}const xn=({isOpen:t,onClose:l,item:r,customer:h,onSave:n})=>{const[g,N]=s.useState([]),[p,P]=s.useState(""),[$,w]=s.useState(""),[j,M]=s.useState(!1),[T,D]=s.useState(""),c=r.price*r.cartQuantity,z=r.paymentBreakdown||{cash:0,click:0,card:0,partner:0},S=z.cash+z.click+z.card+(z.partner||0),q=c-S;s.useEffect(()=>{t&&(f(),w(q.toString()))},[t,q]);const f=()=>E(es,null,function*(){try{const ke=yield(yield fetch("/api/partners")).json();ke.success?N(ke.partners):D("Hamkorlar ro'yxatini yuklashda xatolik")}catch(O){console.error("Hamkorlar yuklash xatosi:",O),D("Tarmoq xatoligi")}}),R=O=>{const ke=Je(O);(ke===""?0:parseFloat(ke)||0)>q?w(q.toString()):w(ke)},W=()=>E(es,null,function*(){if(!p){D("Hamkorni tanlang");return}const O=parseFloat($)||0;if(O<=0){D("To'lov summasi noto'g'ri");return}if(O>q){D("To'lov summasi qoldiq summadan ko'p bo'lishi mumkin emas");return}M(!0),D("");try{const ee=yield(yield fetch("/api/partners/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({partner:p,amount:O,item:{name:r.name,code:r.code,price:r.price,quantity:r.cartQuantity},customer:h?{name:h.name,phone:h.phone}:null,receiptNumber:`CHK-${Date.now()}`})})).json();if(ee.success){n(p,O),l();const Se=g.find(ie=>ie.id===p);alert(`âœ… ${Se==null?void 0:Se.name} orqali ${b(O)} so'm to'lov muvaffaqiyatli yuborildi!`)}else D(ee.message||"To'lov yuborishda xatolik")}catch(ke){console.error("Hamkor to'lovi xatosi:",ke),D("Tarmoq xatoligi yuz berdi")}finally{M(!1)}}),J=O=>{switch(O){case"uzum":return e.jsx(hs,{className:"w-6 h-6"});case"ishonch":return e.jsx(Us,{className:"w-6 h-6"});default:return e.jsx(Ys,{className:"w-6 h-6"})}},de=O=>{switch(O){case"uzum":return"from-purple-500 to-purple-600";case"ishonch":return"from-amber-500 to-amber-600";default:return"from-blue-500 to-blue-600"}},xe=O=>{switch(O){case"uzum":return"Muddatli to'lov";case"ishonch":return"Kredit tizimi";default:return""}};return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm -z-10",onClick:l}),e.jsxs("div",{className:"bg-white w-full sm:w-auto rounded-t-2xl sm:rounded-2xl shadow-2xl max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-gray-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 truncate",children:"Hamkor to'lovi"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 truncate",children:r.name})]}),e.jsx("button",{onClick:l,className:"flex-shrink-0 w-10 h-10 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Umumiy summa:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[b(c)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"To'langan:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[b(S)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Qoldiq:"}),e.jsxs("span",{className:"font-bold text-blue-600",children:[b(q)," so'm"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Hamkorni tanlang"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:g.map(O=>e.jsx("button",{onClick:()=>P(O.id),className:`relative p-4 rounded-xl border-2 transition-all duration-200 ${p===O.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-r ${de(O.id)} flex items-center justify-center text-white`,children:J(O.id)}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:O.name}),e.jsx("p",{className:"text-sm text-gray-500",children:xe(O.id)})]}),p===O.id&&e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})},O.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To'lov summasi"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:$,onChange:O=>R(O.target.value),placeholder:"0",className:"w-full px-4 py-3 text-lg font-semibold border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:"so'm"})]}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("button",{onClick:()=>w((q/2).toString()),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Yarmini"}),e.jsx("button",{onClick:()=>w(q.toString()),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Hammasini"})]})]}),T&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:T})})]})}),e.jsxs("div",{className:"sticky bottom-0 z-10 bg-white/95 backdrop-blur-sm border-t border-gray-100 flex gap-3 p-4 sm:p-6",children:[e.jsx("button",{onClick:l,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:W,disabled:j||!p||!$,className:"flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-xl font-medium transition-colors",children:j?"Yuborilmoqda...":"Yuborish"})]})]})]}):null},un=({item:t,selectedCustomer:l,onSave:r,onCancel:h})=>{var c,z,S;const[n,g]=s.useState(((c=t.paymentBreakdown)==null?void 0:c.cash)||0),[N,p]=s.useState(((z=t.paymentBreakdown)==null?void 0:z.click)||0),[P,$]=s.useState(((S=t.paymentBreakdown)==null?void 0:S.card)||0),w=t.price*t.cartQuantity,j=n+N+P,M=w-j,T=()=>{M<-1||r(n,N,P)},D=(q,f)=>{const R=Je(q),W=R===""?0:parseFloat(R)||0,J=f==="cash"?N+P:f==="click"?n+P:n+N,de=w-J,xe=W>de?de:W;f==="cash"?g(xe):f==="click"?p(xe):$(xe)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Naqd pul"}),e.jsx("input",{type:"text",value:ls(n.toString()),onChange:q=>D(q.target.value,"cash"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-success-200 rounded-xl focus:outline-none focus:border-success-500 focus:ring-4 focus:ring-success-500/10 bg-success-50",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Click"}),e.jsx("input",{type:"text",value:ls(N.toString()),onChange:q=>D(q.target.value,"click"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-purple-200 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-500/10 bg-purple-50",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Plastik karta"}),e.jsx("input",{type:"text",value:ls(P.toString()),onChange:q=>D(q.target.value,"card"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-brand-200 rounded-xl focus:outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 bg-brand-50",placeholder:"0"})]})]}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Jami to'lov:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[b(j)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Tovar summasi:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[b(j)," so'm"]})]}),e.jsxs("div",{className:`flex justify-between text-sm font-semibold pt-2 border-t border-surface-200 ${M<=1&&M>=-1?"text-success-600":M>1?"text-warning-600":"text-danger-600"}`,children:[e.jsx("span",{children:"Qoldiq:"}),e.jsxs("span",{children:[b(w-j)," so'm"]})]}),M<-1&&e.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-lg p-2 mt-2",children:e.jsxs("p",{className:"text-xs text-warning-700",children:["âš ï¸ Ortiq pul kiritib bo'lmaydi. Maksimal: ",b(w)," so'm"]})}),M>1&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2 mt-2",children:e.jsxs("p",{className:"text-xs text-blue-700",children:["â„¹ï¸ ",b(M)," so'm qoldiq ",l?"qarz daftariga qo'shiladi va botga yuboriladi":"qarz bo'ladi (mijoz tanlanmagan)"]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:h,className:"flex-1 py-3 text-surface-600 hover:text-surface-900 transition-colors rounded-xl border border-surface-200 hover:bg-surface-50",children:"Bekor qilish"}),e.jsx("button",{onClick:T,disabled:M<-1,className:`flex-1 py-3 rounded-xl font-semibold transition-colors ${M<-1?"bg-surface-300 text-surface-500 cursor-not-allowed":"bg-brand-500 hover:bg-brand-600 text-white"}`,children:"Saqlash"})]})]})};function hn(){const{showAlert:t,AlertComponent:l}=vs(),r=st(),[h,n]=s.useState([]),[g,N]=s.useState([]),[p,P]=s.useState([]),[$,w]=s.useState(""),[j,M]=s.useState(!1),[T,D]=s.useState(!1),[c,z]=s.useState(""),[S,q]=s.useState([]),[f,R]=s.useState(null),[W,J]=s.useState(!1),[de,xe]=s.useState(""),[O,ke]=s.useState([]),[ee,Se]=s.useState([]),[ie,ce]=s.useState(!1),[L,ge]=s.useState(!1),[B,Ne]=s.useState({available:!1,printers:[],xPrinterFound:!1}),[je,K]=s.useState("kod"),[Q,ne]=s.useState(""),[V,he]=s.useState(null),[ye,Fe]=s.useState(!1),[Ke,Ue]=s.useState(null),[as,Ve]=s.useState(!1),[u,te]=s.useState(null),[Pe,$e]=s.useState(!1),[le,Be]=s.useState(null),[x,pe]=s.useState(15),[we,Re]=s.useState(0),[De,Ae]=s.useState({cash:0,click:0,card:0}),A=(a,C)=>{const I=a.price;let H=15;C>=100?H=11:C>=10?H=13:H=15;const G=I*(1+H/100);return Math.round(G)},fe=(a,C)=>C!==void 0?{name:"Maxsus",markupPercent:C,discount:C<15,custom:!0}:a>=100?{name:"100+ dona",markupPercent:11,discount:!0,custom:!1}:a>=10?{name:"10-99 dona",markupPercent:13,discount:!0,custom:!1}:{name:"1-9 dona",markupPercent:15,discount:!1,custom:!1},i=a=>{Be(a);const C=fe(a.cartQuantity,a.customMarkup);pe(C.markupPercent),$e(!0)},ae=()=>{if(!le)return;const a=le.costPrice||le.price/1.15,C=Math.round(a*(1+x/100));P(I=>I.map(H=>H._id===le._id?k(v({},H),{price:C,customMarkup:x}):H)),$e(!1),Be(null),t(`Narx yangilandi: ${x}% qo'shimcha`,"Muvaffaqiyat","success")};s.useEffect(()=>{qe(),oe(),_e(),rs();const a=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=a}},[]),s.useEffect(()=>{qe(),oe()},[r.pathname]);const Ce=()=>E(this,null,function*(){console.log("Refresh tugmasi bosildi"),ge(!0);try{console.log("Ma'lumotlar yangilanmoqda..."),yield Promise.all([qe(),oe()]),console.log("Ma'lumotlar muvaffaqiyatli yangilandi"),t("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(a){console.error("Refresh xatosi:",a),t("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{ge(!1)}}),qe=()=>E(this,null,function*(){try{const a=yield F.get("/products/kassa");n(a.data),console.log(`Kassa: ${a.data.length} ta tovar yuklandi`)}catch(a){console.error("Error fetching products:",a),t("Tovarlarni yuklashda xatolik","Xatolik","danger")}}),y=a=>E(this,null,function*(){if(!a.trim()||a.length===0){Se([]),ce(!1);return}const C=h.filter(I=>I.code.toLowerCase().includes(a.toLowerCase())).sort((I,H)=>{const G=I.code.toLowerCase().startsWith(a.toLowerCase()),Z=H.code.toLowerCase().startsWith(a.toLowerCase());return G&&!Z?-1:!G&&Z?1:I.code.localeCompare(H.code)});if(Se(C.slice(0,8)),ce(!0),C.length<5&&a.length>=1)try{const G=((yield F.get(`/products/kassa?search=${encodeURIComponent(a)}`)).data||[]).filter(se=>se.code.toLowerCase().includes(a.toLowerCase())).sort((se,me)=>{const ze=se.code.toLowerCase().startsWith(a.toLowerCase()),Ie=me.code.toLowerCase().startsWith(a.toLowerCase());return ze&&!Ie?-1:!ze&&Ie?1:se.code.localeCompare(me.code)}),Z=[...C];G.forEach(se=>{Z.find(ze=>ze._id===se._id)||Z.push(se)}),Se(Z.slice(0,8)),n(se=>{const me=[...se];return G.forEach(ze=>{me.find(cs=>cs._id===ze._id)||me.push(ze)}),me})}catch(I){console.error("Error searching products by code:",I)}}),U=a=>E(this,null,function*(){if(!a.trim())return null;try{const C=h.find(H=>H.code===a.trim());if(C)return C;const I=yield F.get(`/products/kassa?search=${encodeURIComponent(a.trim())}`);if(I.data&&I.data.length>0){const H=I.data.find(G=>G.code===a.trim());if(H)return n(G=>G.find(se=>se._id===H._id)?G:[...G,H]),H}return null}catch(C){return console.error("Error searching product:",C),null}}),oe=()=>E(this,null,function*(){try{const a=yield F.get("/customers/kassa");N(a.data)}catch(a){console.error("Error fetching customers:",a)}}),ve=a=>{xe(a)},ss=g.filter(a=>a.name.toLowerCase().includes(de.toLowerCase())||a.phone.includes(de)),_e=()=>{const a=localStorage.getItem("savedReceipts");a&&ke(JSON.parse(a))},rs=()=>E(this,null,function*(){try{const a=yield ln();Ne(a),console.log("Printer holati:",a)}catch(a){console.error("Printer holatini tekshirishda xatolik:",a)}}),Xe=p.reduce((a,C)=>a+C.price*C.cartQuantity,0),Ss=a=>{if(a==="C")je==="kod"?(w(""),ce(!1),Se([])):(ne("1"),V&&p.find(I=>I._id===V._id)&&P(I=>I.map(H=>H._id===V._id?k(v({},H),{cartQuantity:1}):H)));else if(a==="âŒ«")if(je==="kod"){const C=$.slice(0,-1);w(C),C.length>0?y(C):(ce(!1),Se([]))}else{const C=Q.slice(0,-1),I=C===""||parseInt(C)===0?"1":C;if(ne(I),V){const H=parseInt(I);H>0&&H<=V.quantity&&p.find(Z=>Z._id===V._id)&&P(Z=>Z.map(se=>se._id===V._id?k(v({},se),{cartQuantity:H}):se))}}else if(a==="+")if(je==="kod")zs($);else if(V&&Q.trim()){const C=parseInt(Q);if(!isNaN(C)&&C>0){if(C>V.quantity){t(`${V.name} uchun maksimal miqdor: ${V.quantity} ta`,"Ogohlantirish","warning");return}p.find(H=>H._id===V._id)?P(H=>H.map(G=>G._id===V._id?k(v({},G),{cartQuantity:C}):G)):Ns(V,C),he(null),ne(""),K("kod")}}else V||t("Mahsulot qo'shing","Ogohlantirish","warning");else if(je==="kod"){const C=$+a;w(C),y(C)}else if(V&&(/^[\d]$/.test(a)||a==="00")){const C=Q+a,I=parseInt(C);if(!isNaN(I)&&I>V.quantity){t(`${V.name} uchun maksimal miqdor: ${V.quantity} ta`,"Ogohlantirish","warning");return}console.log("SON rejimida raqam kiritildi:",a,"Yangi qiymat:",C),ne(C),!isNaN(I)&&I>0&&p.find(G=>G._id===V._id)&&P(G=>G.map(Z=>Z._id===V._id?k(v({},Z),{cartQuantity:I}):Z))}else V||(K("kod"),t("Mahsulot qo'shing","Ogohlantirish","warning"))},zs=a=>E(this,null,function*(){if(!a.trim())return;const C=yield U(a.trim());if(C){if(C.quantity===0){t(`"${C.name}" tugagan, savatchaga qo'shib bo'lmaydi`,"Ogohlantirish","warning");return}xs(C),w(""),ce(!1),Se([])}else t(`Kod "${a}" bo'yicha tovar topilmadi`,"Xatolik","warning")}),Cs=a=>{if(a.quantity===0){t(`"${a.name}" tugagan, savatchaga qo'shib bo'lmaydi`,"Ogohlantirish","warning");return}xs(a),w(""),ce(!1),Se([])},js=a=>{he(a),K("son"),ne(a.cartQuantity.toString())},Ns=(a,C)=>{P(I=>{const H=I.find(Z=>Z._id===a._id);if(H){const Z=H.cartQuantity+C;if(Z>a.quantity)return t(`${a.name} uchun maksimal miqdor: ${a.quantity} ta`,"Ogohlantirish","warning"),I;const se=A(a,Z);return I.map(me=>me._id===a._id?k(v({},me),{cartQuantity:Z,price:se}):me)}const G=A(a,C);return[...I,k(v({},a),{cartQuantity:C,price:G})]}),D(!1),z("")},xs=a=>{P(C=>{const I=C.find(G=>G._id===a._id);if(I){const G=I.cartQuantity+1;if(G>a.quantity)return t(`${a.name} uchun maksimal miqdor: ${a.quantity} ta`,"Ogohlantirish","warning"),C;const Z=A(a,G);return C.map(se=>se._id===a._id?k(v({},se),{cartQuantity:G,price:Z}):se)}const H=A(a,1);return[...C,k(v({},a),{cartQuantity:1,price:H})]}),D(!1),z("")},gs=a=>{P(C=>C.filter(I=>I._id!==a))},ks=a=>E(this,null,function*(){if(z(a),a.length>0){const C=h.filter(I=>I.name.toLowerCase().includes(a.toLowerCase())||I.code.toLowerCase().includes(a.toLowerCase()));if(C.length<5&&a.length>2)try{const H=(yield F.get(`/products/kassa?search=${encodeURIComponent(a)}`)).data||[],G=[...C];H.forEach(Z=>{G.find(me=>me._id===Z._id)||G.push(Z)}),q(G),n(Z=>{const se=[...Z];return H.forEach(me=>{se.find(Ie=>Ie._id===me._id)||se.push(me)}),se})}catch(I){console.error("Error searching products:",I),q(C)}else q(C)}else q(h.slice(0,20))}),d=a=>{Ue(a),Fe(!0)},re=a=>{te(a),Ve(!0)},m=(a,C,I)=>E(this,null,function*(){if(!Ke)return;const H=Ke.price*Ke.cartQuantity,G=a+C+I;if(G>H+1){t(`Ortiq pul kiritib bo'lmaydi. Maksimal: ${b(H)} so'm, Kiritilgan: ${b(G)} so'm`,"Xatolik","danger");return}const Z=H-G;if(Z>1&&f)try{console.log(`Tovar uchun qoldiq qarz yaratilmoqda: ${Z} so'm`);const se={customer:f._id,amount:Z,paidAmount:0,description:`${Ke.name} uchun qoldiq to'lov - ${new Date().toLocaleDateString("uz-UZ")}`,items:[{product:Ke._id,name:Ke.name,code:Ke.code,price:Ke.price,quantity:Ke.cartQuantity}]};yield F.post("/debts/kassa",se),console.log("âœ… Tovar uchun qoldiq qarz muvaffaqiyatli qo'shildi va botga yuborildi"),t(`${b(Z)} so'm qarz qo'shildi va botga yuborildi`,"Ma'lumot","info")}catch(se){console.error("âŒ Qarz yaratishda xatolik:",se),t("Qarz yaratishda xatolik yuz berdi","Ogohlantirish","warning")}P(se=>se.map(me=>{var ze;return me._id===Ke._id?k(v({},me),{paymentBreakdown:{cash:a,click:C,card:I,partner:((ze=me.paymentBreakdown)==null?void 0:ze.partner)||0}}):me})),Fe(!1),Ue(null)}),X=()=>{if(p.length===0){t("Chek bo'sh","Ogohlantirish","warning");return}const a={id:Date.now().toString(),items:[...p],total:Xe,savedAt:new Date().toLocaleString()},C=[...O,a];ke(C),localStorage.setItem("savedReceipts",JSON.stringify(C)),P([]),t("Chek saqlandi!","Muvaffaqiyat","success")};return e.jsxs("div",{className:"h-full flex flex-col lg:flex-row overflow-hidden",children:[l,e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0",children:[e.jsxs("div",{className:"p-2 sm:p-3 lg:p-4 flex flex-col sm:flex-row sm:items-center justify-between gap-2 bg-white border-b border-surface-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-col xs:flex-row xs:items-center gap-2 xs:gap-3",children:[e.jsxs("span",{className:"text-xs sm:text-sm text-surface-600 font-medium",children:["JAMI: ",p.length," ta mahsulot"]}),e.jsxs("button",{onClick:Ce,disabled:L,className:"flex items-center gap-1 px-2 py-1 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50 text-xs w-fit",children:[e.jsx(Rs,{className:`w-3 h-3 ${L?"animate-spin":""}`}),e.jsx("span",{className:"hidden xs:inline",children:L?"Yangilanmoqda...":"Yangilash"}),e.jsx("span",{className:"xs:hidden",children:L?"...":"â†»"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:f?e.jsxs("div",{className:"flex items-center gap-2 bg-brand-50 border border-brand-200 rounded-lg px-3 py-2",children:[e.jsx("div",{className:"w-6 h-6 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-brand-600",children:f.name.charAt(0)})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-brand-700",children:f.name}),e.jsx("span",{className:"text-xs text-brand-600",children:f.phone})]}),e.jsx("button",{onClick:()=>R(null),className:"ml-2 w-5 h-5 flex items-center justify-center rounded-full text-brand-500 hover:bg-brand-200 transition-colors",children:"Ã—"})]}):e.jsxs("button",{onClick:()=>J(!0),className:"flex items-center gap-2 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),e.jsx("span",{children:"Mijoz tanlash"})]})})]}),e.jsxs("div",{className:"flex-1 bg-white overflow-hidden flex flex-col min-h-0",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-2 px-3 sm:px-4 py-3 bg-surface-50 border-b border-surface-200 text-xs font-semibold text-surface-500 uppercase flex-shrink-0",children:[e.jsx("div",{className:"col-span-1",children:"Kod"}),e.jsx("div",{className:"col-span-4",children:"Mahsulot"}),e.jsx("div",{className:"col-span-2 text-center",children:"Soni"}),e.jsx("div",{className:"col-span-2 text-right",children:"Narx"}),e.jsx("div",{className:"col-span-2 text-right",children:"Summa"}),e.jsx("div",{className:"col-span-1 text-center",children:"Amallar"})]}),e.jsx("div",{className:"flex-1 overflow-auto min-h-0",children:p.length===0?ie&&ee.length>0?e.jsxs("div",{className:"p-2 sm:p-3 lg:p-4 h-full flex flex-col",children:[e.jsx("div",{className:"text-center mb-2 sm:mb-3 flex-shrink-0",children:e.jsxs("p",{className:"text-sm text-surface-500",children:['"',$,`" ni o'z ichiga olgan tovarlar`,ee.length>4&&e.jsxs("span",{className:"block text-xs text-surface-400 mt-1",children:["Jami ",ee.length," ta tovar"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-1 sm:space-y-2 min-h-0",children:ee.map((a,C)=>e.jsxs("button",{onClick:()=>Cs(a),disabled:a.quantity===0,className:`w-full flex items-center gap-2 sm:gap-3 p-2 sm:p-3 rounded-xl transition-colors text-left relative overflow-hidden ${a.quantity===0?"bg-red-50 border-2 border-red-200 cursor-not-allowed opacity-80":C<4?"bg-brand-50 hover:bg-brand-100 border border-brand-200":"bg-surface-50 hover:bg-surface-100 border border-transparent"}`,children:[a.quantity===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none bg-red-50 bg-opacity-90 rounded-xl",children:e.jsx("div",{className:"bg-red-500 text-white text-xs sm:text-sm font-bold px-2 sm:px-4 py-1 sm:py-2 rounded-full shadow-lg border-2 border-white transform rotate-12 animate-pulse",children:"TUGAGAN"})}),e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-xl flex items-center justify-center ${a.quantity===0?"bg-red-100":"bg-brand-100"}`,children:e.jsx(Oe,{className:`w-4 h-4 sm:w-5 sm:h-5 ${a.quantity===0?"text-red-600":"text-brand-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0 relative",children:[e.jsx("p",{className:`font-medium text-sm sm:text-base truncate ${a.quantity===0?"text-red-700 opacity-60":"text-surface-900"}`,children:a.name}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 text-xs sm:text-sm text-surface-500",children:[e.jsx("span",{className:`font-mono px-1.5 sm:px-2 py-0.5 rounded border text-xs ${a.quantity===0?"bg-red-100 border-red-300 text-red-700 opacity-60":"bg-white"}`,children:$&&a.code.toLowerCase().includes($.toLowerCase())?e.jsx(e.Fragment,{children:a.code.split(new RegExp(`(${$})`,"gi")).map((I,H)=>I.toLowerCase()===$.toLowerCase()?e.jsx("span",{className:"bg-yellow-200 text-yellow-800 font-bold",children:I},H):e.jsx("span",{children:I},H))}):a.code}),a.quantity!==void 0&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${a.quantity>10?"bg-success-100 text-success-700":a.quantity>0?"bg-warning-100 text-warning-700":"bg-danger-100 text-danger-700 font-bold animate-pulse"}`,children:a.quantity>0?`${a.quantity} ta`:"TUGAGAN"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`font-semibold text-sm sm:text-base ${a.quantity===0?"text-red-600 opacity-60":"text-brand-600"}`,children:b(a.price)}),e.jsx("p",{className:`text-xs ${a.quantity===0?"text-red-500":"text-surface-500"}`,children:a.quantity===0?"Mavjud emas":"so'm"})]})]},a._id))})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-surface-400 py-8 sm:py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Oe,{className:"w-8 h-8 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 opacity-50"}),e.jsx("p",{className:"text-sm sm:text-base",children:"Savat bo'sh"}),$.length>0&&e.jsx("p",{className:"text-xs sm:text-sm mt-1 sm:mt-2",children:"Kod kiriting yoki qidiring"})]})}):e.jsx("div",{className:"divide-y divide-surface-100",children:p.map(a=>e.jsxs("div",{children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-2 px-4 py-3 items-center hover:bg-surface-50 transition-colors",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-mono text-surface-600",children:a.code})}),e.jsx("div",{className:"col-span-4",children:e.jsx("span",{className:"text-sm font-medium text-surface-900",children:a.name})}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("input",{type:"text",value:a.cartQuantity,onClick:()=>js(a),onChange:C=>{const I=C.target.value;if(I===""||/^\d+$/.test(I)){const H=I===""?0:parseInt(I);if(H>a.quantity){t(`${a.name} uchun maksimal miqdor: ${a.quantity} ta`,"Ogohlantirish","warning");return}const G=A(a,H);P(Z=>Z.map(se=>se._id===a._id?k(v({},se),{cartQuantity:H,price:G}):se))}},onBlur:()=>{(a.cartQuantity===0||!a.cartQuantity)&&gs(a._id)},className:`w-16 h-9 text-center font-medium border rounded-xl focus:outline-none focus:ring-2 cursor-pointer ${a.cartQuantity>a.quantity?"border-danger-500 bg-danger-50 text-danger-700 focus:border-danger-500 focus:ring-danger-500/20":"border-surface-200 focus:border-brand-500 focus:ring-brand-500/20 hover:bg-surface-50"}`})}),e.jsx("div",{className:"col-span-2 text-right",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm text-surface-900",children:b(a.price)}),(()=>{const C=fe(a.cartQuantity,a.customMarkup);return e.jsxs("div",{onClick:()=>i(a),className:`text-xs px-2 py-0.5 rounded-full inline-block cursor-pointer hover:opacity-80 transition-opacity ${C.custom?"bg-purple-100 text-purple-700":C.discount?"bg-success-100 text-success-700":"bg-surface-100 text-surface-600"}`,title:"Foizni o'zgartirish uchun bosing",children:[C.name," (",C.markupPercent,"%)"]})})()]})}),e.jsxs("div",{className:"col-span-2 text-right",children:[e.jsx("span",{className:"text-sm font-semibold text-surface-900",children:b(a.price*a.cartQuantity)}),a.paymentBreakdown&&e.jsxs("div",{className:"mt-1 text-xs text-surface-600 space-y-0.5",children:[a.paymentBreakdown.cash>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(os,{className:"w-3 h-3 text-green-600"}),b(a.paymentBreakdown.cash)]}),a.paymentBreakdown.click>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ys,{className:"w-3 h-3 text-purple-600"}),b(a.paymentBreakdown.click)]}),a.paymentBreakdown.card>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Us,{className:"w-3 h-3 text-blue-600"}),b(a.paymentBreakdown.card)]}),a.paymentBreakdown.partner&&a.paymentBreakdown.partner>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ys,{className:"w-3 h-3 text-blue-600"}),b(a.paymentBreakdown.partner)]})]}),!a.paymentBreakdown&&e.jsx("button",{onClick:()=>d(a),className:"mt-1 inline-flex items-center px-2 py-1 text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-md transition-colors",children:"To'lov"})]}),e.jsxs("div",{className:"col-span-1 flex justify-center gap-1",children:[e.jsx("button",{onClick:()=>re(a),className:"w-7 h-7 flex items-center justify-center rounded-lg text-purple-500 hover:bg-purple-50 transition-colors",title:"Hamkor orqali to'lash",children:e.jsx(Ys,{className:"w-4 h-4"})}),a.paymentBreakdown&&e.jsx("button",{onClick:()=>d(a),className:"w-7 h-7 flex items-center justify-center rounded-lg text-brand-500 hover:bg-brand-50 transition-colors",title:"To'lov turini o'zgartirish",children:e.jsx(Us,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>gs(a._id),className:"w-7 h-7 flex items-center justify-center rounded-lg text-danger-500 hover:bg-danger-50 transition-colors",children:e.jsx(Ps,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"md:hidden p-4 hover:bg-surface-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-surface-900 mb-1",children:a.name}),e.jsxs("p",{className:"text-sm text-surface-500 font-mono",children:["Kod: ",a.code]})]}),e.jsx("button",{onClick:()=>gs(a._id),className:"ml-3 w-8 h-8 flex items-center justify-center rounded-lg text-danger-500 hover:bg-danger-50 transition-colors",children:e.jsx(Ps,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-surface-600",children:"Soni:"}),e.jsx("input",{type:"text",value:a.cartQuantity,onClick:()=>js(a),onChange:C=>{const I=C.target.value;if(I===""||/^\d+$/.test(I)){const H=I===""?0:parseInt(I);if(H>a.quantity){t(`${a.name} uchun maksimal miqdor: ${a.quantity} ta`,"Ogohlantirish","warning");return}const G=A(a,H);P(Z=>Z.map(se=>se._id===a._id?k(v({},se),{cartQuantity:H,price:G}):se))}},onBlur:()=>{(a.cartQuantity===0||!a.cartQuantity)&&gs(a._id)},className:`w-16 h-8 text-center font-medium border rounded-lg focus:outline-none focus:ring-2 cursor-pointer ${a.cartQuantity>a.quantity?"border-danger-500 bg-danger-50 text-danger-700 focus:border-danger-500 focus:ring-danger-500/20":"border-surface-200 focus:border-brand-500 focus:ring-brand-500/20 hover:bg-surface-50"}`})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-surface-600",children:[b(a.price)," so'm"]}),(()=>{const C=fe(a.cartQuantity,a.customMarkup);return e.jsxs("div",{onClick:()=>i(a),className:`text-xs px-2 py-0.5 rounded-full inline-block cursor-pointer hover:opacity-80 transition-opacity ${C.custom?"bg-purple-100 text-purple-700":C.discount?"bg-success-100 text-success-700":"bg-surface-100 text-surface-600"}`,title:"Foizni o'zgartirish uchun bosing",children:[C.name," (",C.markupPercent,"%)"]})})(),e.jsxs("p",{className:"font-semibold text-surface-900",children:[b(a.price*a.cartQuantity)," so'm"]})]}),a.paymentBreakdown&&e.jsxs("div",{className:"mt-1 text-xs text-surface-600 space-y-0.5",children:[a.paymentBreakdown.cash>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(os,{className:"w-3 h-3 text-green-600"}),b(a.paymentBreakdown.cash)]}),a.paymentBreakdown.click>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ys,{className:"w-3 h-3 text-purple-600"}),b(a.paymentBreakdown.click)]}),a.paymentBreakdown.card>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Us,{className:"w-3 h-3 text-blue-600"}),b(a.paymentBreakdown.card)]}),a.paymentBreakdown.partner&&a.paymentBreakdown.partner>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ys,{className:"w-3 h-3 text-blue-600"}),b(a.paymentBreakdown.partner)]})]}),!a.paymentBreakdown&&e.jsx("button",{onClick:()=>d(a),className:"mt-1 inline-flex items-center px-2 py-1 text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-md transition-colors",children:"To'lov"})]})]})]})]},a._id))})})]}),ie&&ee.length>0&&p.length>0&&e.jsxs("div",{className:"mt-4 bg-white border border-surface-200 rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-surface-100 bg-surface-50",children:e.jsxs("p",{className:"text-sm text-surface-600 text-center",children:['"',$,`" ni o'z ichiga olgan tovarlar (`,ee.length," ta)"]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:ee.map(a=>e.jsxs("button",{onClick:()=>Cs(a),disabled:a.quantity===0,className:`w-full flex items-center gap-3 p-3 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0 relative ${a.quantity===0?"opacity-60 cursor-not-allowed":""}`,children:[a.quantity===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none bg-red-50 bg-opacity-80 rounded",children:e.jsx("span",{className:"bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg",children:"TUGAGAN"})}),e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 ${a.quantity===0?"bg-red-100":"bg-brand-100"}`,children:e.jsx(Oe,{className:`w-5 h-5 ${a.quantity===0?"text-red-600":"text-brand-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium text-base truncate ${a.quantity===0?"text-red-700":"text-surface-900"}`,children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm mt-1",children:[e.jsx("span",{className:`font-mono px-2 py-1 rounded border ${a.quantity===0?"bg-red-100 border-red-300 text-red-700":"bg-white border-surface-200"}`,children:$&&a.code.toLowerCase().includes($.toLowerCase())?e.jsx(e.Fragment,{children:a.code.split(new RegExp(`(${$})`,"gi")).map((C,I)=>C.toLowerCase()===$.toLowerCase()?e.jsx("span",{className:"bg-yellow-200 text-yellow-800 font-bold",children:C},I):e.jsx("span",{children:C},I))}):a.code}),a.quantity!==void 0&&e.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${a.quantity>10?"bg-success-100 text-success-700":a.quantity>0?"bg-warning-100 text-warning-700":"bg-danger-100 text-danger-700"}`,children:a.quantity>0?`${a.quantity} ta`:"TUGAGAN"})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:`font-semibold text-lg ${a.quantity===0?"text-red-600":"text-brand-600"}`,children:b(a.price)}),e.jsx("p",{className:`text-sm ${a.quantity===0?"text-red-500":"text-surface-500"}`,children:"so'm"})]})]},a._id))})]}),e.jsx("div",{className:"p-2 sm:p-3 lg:p-4 bg-white border-t border-surface-200 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>{D(!0),ks("")},className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-white border border-surface-200 rounded-lg text-surface-700 hover:bg-surface-50 transition-colors flex-1 min-w-[100px]",children:[e.jsx(fs,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"Qidirish"})]}),e.jsxs("button",{onClick:X,className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-white border border-surface-200 rounded-lg text-surface-700 hover:bg-surface-50 transition-colors flex-1 min-w-[100px]",children:[e.jsx(Rt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"Saqlash"})]}),p.length>0&&e.jsxs("button",{onClick:()=>{const a=p.reduce((Z,se)=>{var me;return Z+(((me=se.paymentBreakdown)==null?void 0:me.cash)||0)},0),C=p.reduce((Z,se)=>{var me;return Z+(((me=se.paymentBreakdown)==null?void 0:me.click)||0)},0),I=p.reduce((Z,se)=>{var me;return Z+(((me=se.paymentBreakdown)==null?void 0:me.card)||0)},0),H=p.reduce((Z,se)=>{var me;return Z+(((me=se.paymentBreakdown)==null?void 0:me.partner)||0)},0),G=a+C+I+H;Ae({cash:a,click:C,card:I}),Re(G),M(!0)},className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-success-500 text-white rounded-lg hover:bg-success-600 transition-colors flex-1 min-w-[100px] font-semibold",children:[e.jsx(va,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"To'lov"})]})]})})]}),e.jsxs("div",{className:"w-full lg:w-72 xl:w-80 bg-white border-t lg:border-t-0 lg:border-l border-surface-200 p-2 sm:p-3 lg:p-4 flex flex-col flex-shrink-0",children:[e.jsx("div",{className:"text-center xl:text-right mb-3 sm:mb-4",children:e.jsxs("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-surface-900",children:[b(Xe)," so'm"]})}),e.jsx("div",{className:"text-center mb-2 bg-surface-50 rounded-lg py-3 px-4 min-h-[60px] flex flex-col items-center justify-center",children:je==="kod"?$?e.jsxs("div",{className:"text-lg font-mono text-surface-900",children:["Kod: ",e.jsx("span",{className:"font-bold text-brand-600",children:$})]}):e.jsx("div",{className:"text-sm text-surface-500",children:"Mahsulot kodini kiriting"}):e.jsxs("div",{className:"text-center w-full",children:[V&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-sm font-medium text-surface-700",children:V.name}),e.jsxs("div",{className:"text-xs text-surface-500",children:["Mavjud: ",V.quantity," ta"]})]}),e.jsx("div",{className:"text-xs text-surface-500 mb-1 uppercase tracking-wider",children:"SONI"}),Q?e.jsx("div",{className:`text-3xl font-bold rounded-lg py-2 px-4 border-2 inline-block min-w-[80px] ${V&&parseInt(Q)>V.quantity?"bg-red-50 border-red-500 text-red-700 animate-pulse":"bg-white border-gray-200 text-gray-800"}`,children:Q}):e.jsx("div",{className:"text-lg text-surface-400 bg-white rounded-lg py-2 px-4 border-2 border-dashed border-gray-300 inline-block min-w-[80px]",children:V?"0":"â€”"})]})}),e.jsxs("div",{className:"relative mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex mb-2 sm:mb-3 bg-surface-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>{K("kod"),ne("")},className:`flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all ${je==="kod"?"bg-blue-500 text-white shadow-sm":"text-surface-600 hover:text-surface-900"}`,children:"KOD"}),e.jsx("button",{onClick:()=>{K("son"),w(""),ce(!1),Se([])},className:`flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all ${je==="son"?"bg-gray-500 text-white shadow-sm":"text-surface-600 hover:text-surface-900"}`,children:"SON"})]}),je==="kod"?e.jsx("input",{type:"text",value:$,onChange:a=>{const C=a.target.value;w(C),C.length>0?y(C):(ce(!1),Se([]))},onKeyDown:a=>{a.key==="Enter"?(a.preventDefault(),zs($)):a.key==="Escape"&&(ce(!1),Se([]))},onFocus:()=>{$.length>0&&y($)},placeholder:"Kod kiriting...",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-center text-sm sm:text-base font-mono bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"}):e.jsx("input",{type:"text",value:Q,onChange:a=>{const C=a.target.value;/^\d*$/.test(C)&&ne(C)},onKeyDown:a=>{if(a.key==="Enter"&&(a.preventDefault(),V&&Q.trim())){const C=parseInt(Q);if(!isNaN(C)&&C>0){if(C>V.quantity){t(`${V.name} uchun maksimal miqdor: ${V.quantity} ta`,"Ogohlantirish","warning");return}Ns(V,C),he(null),ne(""),K("kod"),t(`${V.name} (${C} ta) savatchaga qo'shildi`,"Muvaffaqiyat","success")}}},placeholder:"1",disabled:!V,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-center text-lg sm:text-xl font-bold rounded-lg focus:outline-none focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed ${V&&Q&&parseInt(Q)>V.quantity?"bg-red-50 border-2 border-red-500 text-red-700 focus:border-red-500 focus:ring-red-500/20":"bg-surface-50 border border-surface-200 focus:border-gray-500 focus:ring-gray-500/20"}`})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1 sm:gap-2 mb-3",children:["7","8","9","C","4","5","6","âŒ«","1","2","3","+","0","00","."].map(a=>e.jsx("button",{onClick:()=>Ss(a),className:`
                flex items-center justify-center rounded-lg text-base sm:text-lg font-semibold transition-all active:scale-95
                ${a==="C"?"bg-red-500 text-white hover:bg-red-600":""}
                ${a==="âŒ«"?"bg-orange-500 text-white hover:bg-orange-600":""}
                ${a==="+"?`${je==="kod"?"bg-green-500 hover:bg-green-600":"bg-blue-500 hover:bg-blue-600"} text-white row-span-2`:""}
                ${["C","âŒ«","+"].includes(a)?"":"bg-surface-100 text-surface-700 hover:bg-surface-200"}
                ${a==="+"?"h-full":"h-10 sm:h-12 lg:h-14"}
              `,children:a==="âŒ«"?e.jsx(lr,{className:"w-4 h-4 sm:w-5 sm:h-5"}):a==="+"?je==="kod"?"+":"âœ“":a},a))})]}),T&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-4 sm:pt-20 px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>D(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl relative z-10 overflow-hidden max-h-[90vh] sm:max-h-none",children:[e.jsx("div",{className:"p-4 border-b border-surface-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Nom yoki kod bo'yicha qidiring...",value:c,onChange:a=>ks(a.target.value),className:"w-full pl-12 pr-4 py-3 bg-surface-50 border border-surface-200 rounded-xl focus:outline-none focus:border-brand-500",autoFocus:!0})]})}),e.jsxs("div",{className:"max-h-80 sm:max-h-96 overflow-auto",children:[S.map(a=>e.jsxs("button",{onClick:()=>xs(a),className:"w-full flex items-center gap-3 p-4 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(Oe,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500",children:[e.jsxs("span",{children:["Kod: ",a.code]}),a.quantity!==void 0&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${a.quantity>10?"bg-success-100 text-success-700":a.quantity>0?"bg-warning-100 text-warning-700":"bg-danger-100 text-danger-700"}`,children:a.quantity>0?`${a.quantity} ta`:"Tugagan"})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsx("p",{className:"font-semibold text-brand-600",children:b(a.price)})})]},a._id)),c&&S.length===0&&e.jsx("p",{className:"text-center text-surface-500 py-8",children:"Tovar topilmadi"})]})]})]}),W&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-4 sm:pt-20 px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>J(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl relative z-10 overflow-hidden max-h-[90vh] sm:max-h-none",children:[e.jsxs("div",{className:"p-4 border-b border-surface-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Mijoz tanlash"}),e.jsx("button",{onClick:()=>J(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:bg-surface-100 transition-colors",children:"Ã—"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz ismi yoki telefon raqami...",value:de,onChange:a=>ve(a.target.value),className:"w-full pl-12 pr-4 py-3 bg-surface-50 border border-surface-200 rounded-xl focus:outline-none focus:border-brand-500",autoFocus:!0})]})]}),e.jsx("div",{className:"max-h-80 sm:max-h-96 overflow-auto",children:ss.length>0?ss.map(a=>e.jsxs("button",{onClick:()=>{R(a),J(!1),xe("")},className:"w-full flex items-center gap-3 p-4 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:a.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500",children:[e.jsx("span",{children:a.phone}),a.debt>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 rounded text-xs font-medium",children:[b(a.debt)," so'm qarz"]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"text-sm text-surface-600",children:[b(a.totalPurchases)," so'm"]}),e.jsx("p",{className:"text-xs text-surface-400",children:"jami xarid"})]})]},a._id)):e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-surface-500",children:de?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"})})})]})]}),j&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>M(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"To'lov turlarini tanlang"}),f&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-brand-600",children:f.name.charAt(0)})}),e.jsx("span",{className:"text-sm text-surface-600 truncate",children:f.name})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Jami summa:"}),e.jsxs("p",{className:"text-2xl sm:text-3xl font-bold text-surface-900 mb-3",children:[b(Xe)," so'm"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(os,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Naqd pul:"})]}),e.jsxs("span",{className:"font-semibold",children:[b(De.cash)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(Ys,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Click:"})]}),e.jsxs("span",{className:"font-semibold",children:[b(De.click)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(Us,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Plastik karta:"})]}),e.jsxs("span",{className:"font-semibold",children:[b(De.card)," so'm"]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 flex justify-between",children:[e.jsx("span",{className:"text-surface-600",children:"Jami to'lov:"}),e.jsxs("span",{className:"font-bold text-lg",children:[b(we)," so'm"]})]}),we<Xe&&e.jsxs("div",{className:"flex justify-between text-warning-600",children:[e.jsx("span",{children:"Qoldiq:"}),e.jsxs("span",{className:"font-bold",children:[b(Xe-we)," so'm"]})]}),we>Xe&&e.jsxs("div",{className:"flex justify-between text-success-600",children:[e.jsx("span",{children:"Qaytim:"}),e.jsxs("span",{className:"font-bold",children:[b(we-Xe)," so'm"]})]})]})]}),we<Xe&&e.jsx("div",{className:`border rounded-lg p-3 mb-4 ${f?"bg-blue-50 border-blue-200":"bg-warning-50 border-warning-200"}`,children:e.jsx("p",{className:`text-sm ${f?"text-blue-700":"text-warning-700"}`,children:f?e.jsxs(e.Fragment,{children:["â„¹ï¸ ",b(Xe-we)," so'm qarz daftariga qo'shiladi"]}):e.jsxs(e.Fragment,{children:["âš ï¸ ",b(Xe-we)," so'm qoldiq - mijoz tanlanmagan"]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs",children:[e.jsx(et,{className:`w-3 h-3 ${B.xPrinterFound?"text-green-600":B.available?"text-yellow-600":"text-red-600"}`}),e.jsx("span",{className:B.xPrinterFound?"text-green-600":B.available?"text-yellow-600":"text-red-600",children:B.xPrinterFound?"X Printer tayyor":B.available?`Printer mavjud (${B.printers.length} ta)`:"Printer topilmadi"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>E(this,null,function*(){var a,C;if(p.length===0){t("Savat bo'sh","Ogohlantirish","warning");return}try{console.log("Chek chiqarish uchun tovar miqdorlarini kamaytirish boshlandi...");const I=[];for(const se of p)try{console.log(`${se.name} uchun miqdorni kamaytirish: ${se.cartQuantity} ta`),yield F.put(`/products/${se._id}/reduce-quantity`,{quantity:se.cartQuantity}),console.log(`âœ… ${se.name} muvaffaqiyatli yangilandi`),I.push({success:!0,item:se.name})}catch(me){console.error(`âŒ ${se.name} miqdorini kamaytirish xatosi:`,me);const ze=((C=(a=me.response)==null?void 0:a.data)==null?void 0:C.message)||"Noma'lum xatolik";I.push({success:!1,item:se.name,error:ze})}console.log("Tovar miqdorlarini yangilash tugadi. Natijalar:",I);const H=`HELPER-${Date.now()}`,G={items:p,total:Xe,paymentMethod:"cash",customer:f,receiptNumber:H,cashier:"Kassir",date:new Date};try{console.log("Telegram botga chek ma'lumotlarini yuborish...");const se={items:p.map(ze=>({product:ze._id,name:ze.name,code:ze.code,price:ze.price,quantity:ze.cartQuantity,paymentBreakdown:ze.paymentBreakdown||{cash:0,click:0,card:0}})),total:Xe,paymentMethod:"cash",customer:(f==null?void 0:f._id)||null,receiptNumber:H,paidAmount:we,remainingAmount:Xe-we},me=yield F.post("/receipts/kassa",se);console.log("âœ… Chek ma'lumotlari serverga yuborildi:",me.data)}catch(se){console.error("âŒ Telegram xabar yuborishda xatolik:",se)}if(!(yield Aa(G,()=>{const se=I.filter(Ie=>Ie.success).length,me=I.filter(Ie=>!Ie.success).length;let ze="Chek muvaffaqiyatli chiqarildi va telegram botga yuborildi";me===0?t(ze+", tovar miqdorlari yangilandi!","Muvaffaqiyat","success"):t(`${ze}. ${se} ta tovar yangilandi, ${me} ta xatolik`,"Ogohlantirish","warning"),P([]),R(null),M(!1),qe()}))){const se=I.filter(Ie=>Ie.success).length,me=I.filter(Ie=>!Ie.success).length;let ze="Chek faylga yuklandi va telegram botga yuborildi";me===0?t(ze+", tovar miqdorlari yangilandi!","Ma'lumot","info"):t(`${ze}. ${se} ta tovar yangilandi, ${me} ta xatolik`,"Ogohlantirish","warning"),P([]),R(null),M(!1),qe()}}catch(I){console.error("Chek chiqarish xatosi:",I),t("Chek chiqarishda xatolik yuz berdi","Xatolik","danger")}}),className:"w-full flex items-center justify-center gap-2 py-3 sm:py-4 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-semibold transition-colors",children:[e.jsx(et,{className:"w-5 h-5"}),"Chek chiqarish (to'lovsiz)"]}),we<Xe&&!f&&e.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-lg p-3",children:e.jsx("p",{className:"text-xs text-warning-700 text-center",children:"ðŸ’¡ Qoldiq summa uchun mijoz tanlashingiz mumkin yoki oddiy mijoz sifatida saqlashingiz mumkin"})}),e.jsx("button",{onClick:()=>M(!1),className:"w-full py-3 text-surface-600 hover:text-surface-900 transition-colors",children:"Bekor qilish"})]})]})]}),ye&&Ke&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{Fe(!1),Ue(null)}}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"To'lov turlarini tanlang"}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-1",children:Ke.name}),e.jsxs("p",{className:"text-xs text-surface-500 font-mono mb-2",children:["Kod: ",Ke.code]}),e.jsxs("p",{className:"text-lg font-bold text-surface-900",children:["Jami: ",b(Ke.price*Ke.cartQuantity)," so'm"]})]})]}),e.jsx(un,{item:Ke,selectedCustomer:f,onSave:m,onCancel:()=>{Fe(!1),Ue(null)}})]})]}),as&&u&&e.jsx(xn,{isOpen:as,onClose:()=>{Ve(!1),te(null)},item:u,customer:f,onSave:(a,C)=>{P(I=>I.map(H=>{if(H._id!==u._id)return H;const G=H.paymentBreakdown||{cash:0,click:0,card:0,partner:0};return k(v({},H),{paymentBreakdown:k(v({},G),{partner:(G.partner||0)+C})})}))}}),Pe&&le&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{$e(!1),Be(null)}}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"Foizni o'zgartirish"}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-1",children:le.name}),e.jsxs("p",{className:"text-xs text-surface-500 font-mono mb-2",children:["Kod: ",le.code]}),e.jsxs("p",{className:"text-sm text-surface-600",children:["Miqdor: ",le.cartQuantity," ta"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Qo'shimcha foiz (%)"}),e.jsx("input",{type:"number",value:x,onChange:a=>pe(Number(a.target.value)||0),min:"0",max:"100",step:"0.1",className:"w-full px-3 py-2 border border-surface-200 rounded-lg text-center text-lg font-semibold focus:ring-2 focus:ring-brand-500 focus:border-transparent",placeholder:"15"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[5,10,15,20].map(a=>e.jsxs("button",{onClick:()=>pe(a),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${x===a?"bg-brand-500 text-white":"bg-surface-100 text-surface-700 hover:bg-surface-200"}`,children:[a,"%"]},a))}),le&&e.jsxs("div",{className:"bg-brand-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[e.jsx("span",{className:"text-surface-600",children:"Yangi narx (1 ta):"}),e.jsxs("span",{className:"font-semibold text-brand-600",children:[b(Math.round((le.costPrice||le.price/1.15)*(1+x/100)))," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Jami summa:"}),e.jsxs("span",{className:"font-bold text-brand-700",children:[b(Math.round((le.costPrice||le.price/1.15)*(1+x/100))*le.cartQuantity)," so'm"]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{$e(!1),Be(null)},className:"flex-1 py-3 px-4 bg-surface-100 text-surface-700 rounded-xl font-medium hover:bg-surface-200 transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:ae,className:"flex-1 py-3 px-4 bg-brand-500 text-white rounded-xl font-medium hover:bg-brand-600 transition-colors",children:"Saqlash"})]})]})]})]})}function pn(){const t=Ea(),[l,r]=s.useState([]),[h,n]=s.useState(!0),[g,N]=s.useState(null),[p,P]=s.useState(!1),[$,w]=s.useState({}),{showAlert:j,AlertComponent:M}=vs();s.useEffect(()=>{T()},[]),s.useEffect(()=>{if(t)return t.on("receipt:created",z=>E(this,null,function*(){console.log("ðŸ“¡ Kassa Receipts Socket: Yangi chek keldi",z);try{const q=(yield F.get(`/receipts/${z._id}`)).data;r(f=>[q,...f]),j("Yangi chek keldi!","Yangilik","success")}catch(S){console.error("Chek ma'lumotlarini olishda xatolik:",S),T()}})),()=>{t.off("receipt:created")}},[t]);const T=()=>E(this,null,function*(){var z,S;try{n(!0),console.log("Fetching receipts from /receipts/kassa...");const q=yield F.get("/receipts/kassa");console.log("Receipts response:",q.data),console.log("Total receipts:",q.data.length),r(q.data)}catch(q){console.error("Cheklar yuklashda xatolik:",q),console.error("Error response:",q.response),j(((S=(z=q.response)==null?void 0:z.data)==null?void 0:S.message)||"Cheklar yuklashda xatolik","Xatolik","danger")}finally{n(!1)}}),D=z=>{const S=window.open("","_blank","width=600,height=800");if(!S){j("Popup bloklangan. Iltimos, popup ga ruxsat bering.","Ogohlantirish","warning");return}const q=z.items.map((f,R)=>`
      <tr>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: center; font-size: 14px;">${R+1}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; font-size: 14px;">${f.product.name}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: center; font-size: 14px;">${f.quantity}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: right; font-size: 14px;">${b(f.price)}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: right; font-weight: bold; font-size: 14px;">${b(f.price*f.quantity)}</td>
      </tr>
    `).join("");S.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Chek #${z.receiptNumber}</title>
        <style>
          @page { size: 80mm auto; margin: 0; }
          @media print {
            body { width: 80mm; margin: 0; }
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body { 
            font-family: 'Courier New', monospace;
            width: 80mm;
            padding: 10mm 5mm;
            background: white;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
          }
          .header { 
            text-align: center; 
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px dashed #000;
          }
          .header h1 { 
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
          }
          .header .subtitle { 
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
          }
          .header .receipt-number { 
            font-size: 14px;
            font-weight: bold;
            margin-top: 8px;
          }
          table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 15px 0;
          }
          th { 
            padding: 8px 4px;
            text-align: left; 
            border-bottom: 2px solid #000;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
          }
          th.center { text-align: center; }
          th.right { text-align: right; }
          .total-section { 
            margin-top: 15px;
            padding-top: 10px;
            border-top: 2px dashed #000;
          }
          .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
          }
          .total-label {
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
          }
          .total-amount {
            font-size: 20px;
            font-weight: bold;
          }
          .footer { 
            margin-top: 20px;
            padding-top: 15px;
            text-align: center;
            border-top: 2px dashed #000;
          }
          .footer p {
            font-size: 11px;
            color: #666;
            margin: 3px 0;
          }
          .thank-you {
            font-size: 13px;
            font-weight: bold;
            margin-top: 10px;
          }
        </style>
      </head>
      <body>
        <div class="header">
          <!-- Logo -->
          <div style="margin-bottom: 8px;">
            <img src="/o5sk1awh.png" alt="Logo" style="width: 40px; height: 40px; display: block; margin: 0 auto; border-radius: 6px;" />
          </div>
          <h1>SARDOR FURNITURA</h1>
          <div class="subtitle">Mebel furniturasi</div>
          <div class="receipt-number">Chek #${z.receiptNumber}</div>
        </div>

        <table>
          <thead>
            <tr>
              <th style="width: 25px;" class="center">â„–</th>
              <th>Mahsulot</th>
              <th style="width: 35px;" class="center">Soni</th>
              <th style="width: 60px;" class="right">Narxi</th>
              <th style="width: 70px;" class="right">Jami</th>
            </tr>
          </thead>
          <tbody>
            ${q}
          </tbody>
        </table>

        <div class="total-section">
          <div class="total-row">
            <span class="total-label">JAMI:</span>
            <span class="total-amount">${b(z.totalAmount)} so'm</span>
          </div>
        </div>

        <div class="footer">
          <p class="thank-you">Xaridingiz uchun rahmat!</p>
          <p>Sardor Furnitura - Sifatli mebel furniturasi</p>
        </div>
      </body>
      </html>
    `),S.document.close(),S.print()},c=z=>{N(z),P(!0)};return h?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-brand-500 border-t-transparent"})}):e.jsxs("div",{className:"min-h-screen bg-surface-50 p-2 sm:p-4 pb-20",children:[M,e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-3 sm:p-4 mb-3 sm:mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(Hs,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-base sm:text-xl font-bold text-surface-900 truncate",children:"Cheklar"}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Hodimlar cheklari"})]})]}),e.jsxs("button",{onClick:T,className:"btn-secondary flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-2 text-sm flex-shrink-0",children:[e.jsx(Rs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangilash"})]})]})}),l.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-8 sm:p-12 text-center",children:[e.jsx(Hs,{className:"w-12 h-12 sm:w-16 sm:h-16 text-surface-300 mx-auto mb-3 sm:mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-surface-900 mb-2",children:"Cheklar yo'q"}),e.jsx("p",{className:"text-sm sm:text-base text-surface-500",children:"Hali hech qanday chek yaratilmagan"})]}):e.jsx("div",{className:"max-h-[calc(100vh-180px)] overflow-y-auto",children:e.jsx("div",{className:"grid gap-3 sm:gap-4 pr-1",children:l.map(z=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-3 sm:p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-brand-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Hs,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"font-bold text-sm sm:text-base text-surface-900 truncate",children:["Chek #",z.receiptNumber]}),e.jsx("p",{className:"text-xs text-surface-500",children:new Date(z.createdAt).toLocaleString("uz-UZ",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(is,{className:"w-3 h-3 sm:w-4 sm:h-4 text-surface-400 flex-shrink-0"}),e.jsx("span",{className:"text-surface-600",children:"Sotuvchi:"}),e.jsx("span",{className:"font-medium text-surface-900 truncate",children:z.createdBy.name})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(Oe,{className:"w-3 h-3 sm:w-4 sm:h-4 text-surface-400 flex-shrink-0"}),e.jsx("span",{className:"text-surface-600",children:"Mahsulotlar:"}),e.jsxs("span",{className:"font-medium text-surface-900",children:[z.items.length," ta"]})]}),z.customer&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(is,{className:"w-3 h-3 sm:w-4 sm:h-4 text-surface-400 flex-shrink-0"}),e.jsx("span",{className:"text-surface-600",children:"Mijoz:"}),e.jsx("span",{className:"font-medium text-surface-900 truncate",children:z.customer.name})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Tel:"}),e.jsx("span",{className:"font-medium text-surface-900",children:z.customer.phone})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 sm:p-3 bg-brand-50 rounded-lg mb-3",children:[e.jsx(os,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600 flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm text-surface-600",children:"Jami:"}),e.jsxs("span",{className:"text-base sm:text-lg font-bold text-brand-700",children:[b(z.totalAmount)," so'm"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>c(z),className:"flex-1 flex items-center justify-center gap-1 sm:gap-2 p-2 bg-blue-50 hover:bg-blue-100 text-blue-600 rounded-lg transition-colors text-xs sm:text-sm",children:[e.jsx(Xs,{className:"w-4 h-4"}),e.jsx("span",{children:"Ko'rish"})]}),e.jsxs("button",{onClick:()=>D(z),className:"flex-1 flex items-center justify-center gap-1 sm:gap-2 p-2 bg-green-50 hover:bg-green-100 text-green-600 rounded-lg transition-colors text-xs sm:text-sm",children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"Print"})]})]})]},z._id))})}),p&&g&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-2 sm:p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-white border-b border-surface-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-base sm:text-xl font-bold text-surface-900",children:["Chek #",g.receiptNumber]}),e.jsx("button",{onClick:()=>P(!1),className:"p-2 hover:bg-surface-100 rounded-lg transition-colors",children:"âœ•"})]})}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3 mb-4 sm:mb-6",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-surface-900 mb-2 sm:mb-3",children:"Mahsulotlar:"}),g.items.map((z,S)=>{var W;const q=z.product.images&&z.product.images.length>0,f=$[S]||!1,R=f?z.product.images:(W=z.product.images)==null?void 0:W.slice(0,1);return e.jsx("div",{className:"p-2 sm:p-3 bg-surface-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[q&&e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"space-y-1",children:[R==null?void 0:R.map((J,de)=>e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-lg overflow-hidden bg-surface-100 border border-surface-200",children:e.jsx("img",{src:`${Ts}${J.path}`,alt:z.product.name,className:"w-full h-full object-cover",onError:xe=>{xe.currentTarget.src="/o5sk1awh.png"}})},de)),z.product.images&&z.product.images.length>1&&e.jsx("button",{onClick:()=>w(J=>k(v({},J),{[S]:!f})),className:"w-full flex items-center justify-center gap-1 py-1 text-xs text-brand-600 hover:text-brand-700 font-medium",children:f?e.jsxs(e.Fragment,{children:[e.jsx(la,{className:"w-3 h-3"}),e.jsx("span",{children:"Yashirish"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"w-3 h-3"}),e.jsxs("span",{children:["+",z.product.images.length-1," rasm"]})]})})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm sm:text-base text-surface-900 break-words",children:z.product.name}),e.jsxs("p",{className:"text-xs sm:text-sm text-surface-500",children:["Kod: ",z.product.code]}),e.jsxs("div",{className:"mt-2 text-right",children:[e.jsxs("p",{className:"font-semibold text-xs sm:text-sm text-surface-900",children:[z.quantity," x ",b(z.price)]}),e.jsxs("p",{className:"text-xs sm:text-sm text-brand-600 font-bold",children:[b(z.quantity*z.price)," so'm"]})]})]})]})},S)})]}),e.jsx("div",{className:"border-t border-surface-200 pt-3 sm:pt-4",children:e.jsxs("div",{className:"flex items-center justify-between text-base sm:text-lg font-bold",children:[e.jsx("span",{className:"text-surface-900",children:"JAMI:"}),e.jsxs("span",{className:"text-brand-700",children:[b(g.totalAmount)," so'm"]})]})})]})]})})]})}function fn(){const{showAlert:t,AlertComponent:l}=vs(),r=st(),[h,n]=s.useState([]),[g,N]=s.useState(""),[p,P]=s.useState([]),[$,w]=s.useState(!1),[j,M]=s.useState(!1),[T,D]=s.useState("");s.useEffect(()=>{z(!0);const S=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=S}},[]),s.useEffect(()=>{z(!0)},[r.pathname]);const c=()=>E(this,null,function*(){w(!0);try{yield z(!1),t("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(S){console.error("Refresh xatosi:",S),t("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{w(!1)}});s.useEffect(()=>{if(g.trim()==="")P(h);else{const S=h.filter(q=>q.name.toLowerCase().includes(g.toLowerCase())||q.phone.includes(g));P(S)}},[h,g]);const z=(S=!0)=>E(this,null,function*(){try{S&&M(!0),D("");const f=(yield F.get("/customers/kassa")).data.filter(R=>{const W=R.name&&R.name.trim().length>0,J=R.phone&&R.phone.trim().length>0;return W&&J}).map(R=>k(v({},R),{name:R.name.trim(),phone:R.phone.trim(),totalPurchases:Number(R.totalPurchases)||0,debt:Number(R.debt)||0}));n(f)}catch(q){console.error("Error fetching customers:",q),D("Mijozlarni yuklashda xatolik yuz berdi")}finally{S&&M(!1)}});return e.jsxs("div",{className:"p-6",children:[l,e.jsxs("div",{className:"bg-white rounded-xl border border-surface-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz qidirish...",value:g,onChange:S=>N(S.target.value),className:"w-full pl-10 pr-4 py-2 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500"})]}),e.jsxs("button",{onClick:c,disabled:$,className:"flex items-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50",children:[e.jsx(Rs,{className:`w-4 h-4 ${$?"animate-spin":""}`}),$?"Yangilanmoqda...":"Yangilash"]})]})}),e.jsx("div",{className:"divide-y divide-surface-100",children:j?e.jsx("div",{className:"p-8 text-center text-surface-500",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Rs,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Mijozlar yuklanmoqda..."})]})}):T?e.jsxs("div",{className:"p-8 text-center text-danger-500",children:[e.jsx("p",{children:T}),e.jsx("button",{onClick:c,className:"mt-2 px-4 py-2 bg-danger-100 text-danger-700 rounded-lg hover:bg-danger-200 transition-colors",children:"Qayta urinish"})]}):p.length===0?e.jsx("div",{className:"p-8 text-center text-surface-500",children:g?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"}):p.map(S=>e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-surface-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600",children:S.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:S.name}),e.jsx("p",{className:"text-sm text-surface-500",children:S.phone}),S.email&&e.jsx("p",{className:"text-xs text-surface-400",children:S.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-surface-500",children:"Jami xaridlar"}),e.jsx("p",{className:"font-semibold text-surface-900",children:b(S.totalPurchases||0)}),S.debt>0&&e.jsxs("p",{className:"text-xs text-danger-600 font-medium",children:["Qarz: ",b(S.debt)]})]})]},S._id))})]})]})}function bn(){var A,fe,i,ae,Ce,qe;const{showAlert:t,AlertComponent:l}=vs(),r=st(),[h,n]=s.useState([]),[g,N]=s.useState([]),[p,P]=s.useState([]),[$,w]=s.useState(!1),[j,M]=s.useState(""),[T,D]=s.useState(""),[c,z]=s.useState(""),[S,q]=s.useState(null),[f,R]=s.useState([]),[W,J]=s.useState(!1),[de,xe]=s.useState(!1),[O,ke]=s.useState({paidAmount:"",dueDate:"",description:""}),[ee,Se]=s.useState(!1),[ie,ce]=s.useState(!1),[L,ge]=s.useState(null),[B,Ne]=s.useState(!1),[je,K]=s.useState({name:"",phone:"",email:"",address:""});s.useEffect(()=>{he(),ye(),Fe();const y=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=y}},[]),s.useEffect(()=>{he(),ye(),Fe()},[r.pathname]);const Q=()=>E(this,null,function*(){var y,U;if(!je.name.trim()||!je.phone.trim()){t("Mijoz ismi va telefon raqami majburiy","Xatolik","warning");return}try{const oe=yield F.post("/customers/kassa",{name:je.name.trim(),phone:je.phone.trim(),email:je.email.trim(),address:je.address.trim()});oe.data.success&&(t("Mijoz muvaffaqiyatli qo'shildi","Muvaffaqiyat","success"),ye(),q(oe.data.customer),K({name:"",phone:"",email:"",address:""}),Ne(!1))}catch(oe){console.error("Error creating customer:",oe);const ve=((U=(y=oe.response)==null?void 0:y.data)==null?void 0:U.message)||"Mijoz qo'shishda xatolik yuz berdi";t(ve,"Xatolik","danger")}}),ne=()=>{K({name:"",phone:"",email:"",address:""}),Ne(!1)},V=()=>E(this,null,function*(){xe(!0);try{yield Promise.all([he(),ye(),Fe()]),t("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(y){console.error("Refresh xatosi:",y),t("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{xe(!1)}}),he=()=>E(this,null,function*(){try{const y=yield F.get("/debts/kassa");n(y.data)}catch(y){console.error("Error fetching debts:",y)}}),ye=()=>E(this,null,function*(){try{const y=yield F.get("/customers/kassa");N(y.data)}catch(y){console.error("Error fetching customers:",y)}}),Fe=()=>E(this,null,function*(){try{const y=yield F.get("/products/kassa"),U=y.data.data||y.data;P(Array.isArray(U)?U:[])}catch(y){console.error("Error fetching products:",y)}}),Ke=y=>{q(y);const U=h.find(oe=>{var ve;return((ve=oe.customer)==null?void 0:ve._id)===y._id&&oe.status==="approved"});U&&t(`${y.name} mijozining ${b(U.amount-U.paidAmount)} so'm tasdiqlangan qarzi mavjud. Yangi qarz to'g'ridan-to'g'ri mavjud qarzga qo'shiladi.`,"Ma'lumot","info")},Ue=()=>{w(!1),q(null),R([]),D(""),z(""),J(!1),Ne(!1),ke({paidAmount:"",dueDate:"",description:""}),K({name:"",phone:"",email:"",address:""})},as=y=>{const U=f.find(oe=>oe.product._id===y._id);R(U?oe=>oe.map(ve=>ve.product._id===y._id?k(v({},ve),{quantity:ve.quantity+1}):ve):oe=>[...oe,{product:y,quantity:1,price:y.price}]),z(""),J(!1)},Ve=(y,U)=>{if(U<=0){R(oe=>oe.filter(ve=>ve.product._id!==y));return}R(oe=>oe.map(ve=>ve.product._id===y?k(v({},ve),{quantity:U}):ve))},u=y=>{R(U=>U.filter(oe=>oe.product._id!==y))},te=y=>{ge(y),Se(!0)},Pe=()=>E(this,null,function*(){var y,U;if(L)try{yield F.delete(`/debts/kassa/${L._id}`),t("Qarz muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),ce(!1),ge(null),he()}catch(oe){console.error("Error deleting debt:",oe);const ve=((U=(y=oe.response)==null?void 0:y.data)==null?void 0:U.message)||"Qarzni o'chirishda xatolik yuz berdi";t(ve,"Xatolik","danger")}}),$e=()=>{Se(!1),ge(null)},le=()=>{ce(!1),ge(null)},Be=()=>E(this,null,function*(){if(!S||f.length===0||!O.dueDate){t("Barcha majburiy maydonlarni to'ldiring","Xatolik","warning");return}try{const y=f.reduce((rs,Xe)=>rs+Xe.price*Xe.quantity,0),U=parseFloat(Je(O.paidAmount))||0;if(U>y){t(`To'langan summa (${b(U)} so'm) jami summadan (${b(y)} so'm) ko'p bo'lishi mumkin emas!`,"Xatolik","danger");return}const oe={customer:S._id,amount:y,paidAmount:U,dueDate:O.dueDate,description:O.description,items:f.map(rs=>({product:rs.product._id,quantity:rs.quantity,price:rs.price}))},_e=(yield F.post("/debts/kassa",oe)).status===200?"Qarz mavjud qarzga muvaffaqiyatli qo'shildi! Bitta qarz sifatida ko'rinadi.":"Yangi qarz yaratildi va admin tasdiqlashini kutmoqda.";t(_e,"Muvaffaqiyat","success"),Ue(),he()}catch(y){console.error("Error creating debt:",y),t("Qarz qo'shishda xatolik yuz berdi","Xatolik","danger")}}),x=g.filter(y=>T===""||y.name.toLowerCase().includes(T.toLowerCase())||y.phone.includes(T)),pe=p.filter(y=>{if(!c.trim())return!1;const U=c.toLowerCase().trim(),oe=y.name.toLowerCase(),ve=y.code.toLowerCase();return!!(ve===U||ve.startsWith(U)||ve.includes(U)||oe.includes(U))}).sort((y,U)=>{const oe=c.toLowerCase().trim(),ve=y.code.toLowerCase(),ss=U.code.toLowerCase(),_e=y.name.toLowerCase(),rs=U.name.toLowerCase();return ve===oe&&ss!==oe?-1:ss===oe&&ve!==oe?1:ve.startsWith(oe)&&!ss.startsWith(oe)?-1:ss.startsWith(oe)&&!ve.startsWith(oe)?1:_e.startsWith(oe)&&!rs.startsWith(oe)?-1:rs.startsWith(oe)&&!_e.startsWith(oe)?1:y.name.localeCompare(U.name)}),we=f.reduce((y,U)=>y+U.price*U.quantity,0),Re=parseFloat(Je(O.paidAmount))||0,De=we-Re,Ae=h.filter(y=>{var ss,_e,rs;if(!j.trim())return!0;const U=j.toLowerCase(),oe=((_e=(ss=y.customer)==null?void 0:ss.name)==null?void 0:_e.toLowerCase())||"",ve=((rs=y.customer)==null?void 0:rs.phone)||"";return oe.includes(U)||ve.includes(U)});return e.jsxs("div",{className:"p-3 sm:p-6 h-full flex flex-col overflow-hidden",children:[l,e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-6 flex-shrink-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center justify-center gap-2 px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors w-full sm:w-auto",children:[e.jsx(os,{className:"w-4 h-4"}),"Yangi qarz"]}),e.jsxs("button",{onClick:V,disabled:de,className:"flex items-center justify-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50 w-full sm:w-auto",children:[e.jsx(Rs,{className:`w-4 h-4 ${de?"animate-spin":""}`}),de?"Yangilanmoqda...":"Yangilash"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 mb-6 flex-shrink-0",children:[e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl border border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx(os,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Jami qarz"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-surface-900 truncate",children:b(h.reduce((y,U)=>y+(U.amount-U.paidAmount),0))})]})]})}),e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl border border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-success-100 rounded-lg flex items-center justify-center",children:e.jsx(ta,{className:"w-4 h-4 sm:w-5 sm:h-5 text-success-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Jami qarzlar soni"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-surface-900",children:h.length})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-surface-200 overflow-hidden flex flex-col h-[calc(100vh-400px)] min-h-[400px]",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-surface-200 flex-shrink-0",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz qidirish...",value:j,onChange:y=>M(y.target.value),className:"w-full pl-9 sm:pl-10 pr-4 py-2 sm:py-3 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:Ae.length===0?e.jsxs("div",{className:"p-8 text-center text-surface-500",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(os,{className:"w-8 h-8 text-surface-400"})}),e.jsx("p",{className:"font-medium text-lg mb-2",children:j?"Qarz topilmadi":"Qarzlar ro'yxati bo'sh"}),e.jsx("p",{className:"text-sm",children:j?`"${j}" bo'yicha hech qanday qarz topilmadi`:"Hozircha hech qanday qarz qo'shilmagan"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block sm:hidden",children:Ae.map(y=>{var U,oe,ve;return e.jsxs("div",{className:"p-4 border-b border-surface-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:(U=y.customer)==null?void 0:U.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:(oe=y.customer)==null?void 0:oe.name}),e.jsx("p",{className:"text-sm text-surface-500",children:(ve=y.customer)==null?void 0:ve.phone})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Qarz summasi"}),e.jsx("p",{className:"font-medium text-surface-900",children:b(y.amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Qoldiq"}),e.jsx("p",{className:"font-medium text-danger-600",children:b(y.amount-y.paidAmount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Muddat"}),e.jsx("p",{className:"text-surface-900",children:new Date(y.dueDate).toLocaleDateString()})]}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx("button",{onClick:()=>te(y),className:"p-2 text-brand-600 hover:text-brand-700 hover:bg-brand-50 rounded-lg transition-colors",title:"Qarz ma'lumotlarini ko'rish",children:e.jsx(Xs,{className:"w-4 h-4"})})})]})]},y._id)})}),e.jsx("div",{className:"hidden sm:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surface-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Mijoz"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Qarz"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Qoldiq"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Muddat"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Amallar"})]})}),e.jsx("tbody",{className:"divide-y divide-surface-100",children:Ae.map(y=>{var U,oe,ve;return e.jsxs("tr",{className:"hover:bg-surface-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:(U=y.customer)==null?void 0:U.name.charAt(0)})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:(oe=y.customer)==null?void 0:oe.name}),e.jsx("p",{className:"text-sm text-surface-500 truncate",children:(ve=y.customer)==null?void 0:ve.phone})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-surface-900",children:b(y.amount)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-danger-600",children:b(y.amount-y.paidAmount)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-surface-500",children:new Date(y.dueDate).toLocaleDateString()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>te(y),className:"p-2 text-brand-600 hover:text-brand-700 hover:bg-brand-50 rounded-lg transition-colors",title:"Qarz ma'lumotlarini ko'rish",children:e.jsx(Xs,{className:"w-4 h-4"})})})})]},y._id)})})]})})]})})]}),$&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>Ue()}),e.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl w-full max-w-6xl shadow-2xl relative z-10 max-h-[95vh] sm:max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 lg:p-6 border-b border-surface-200 bg-gradient-to-r from-brand-50 to-blue-50 rounded-t-2xl sm:rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-lg flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(os,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold text-surface-900 truncate",children:S?`${S.name} uchun qarz qo'shish`:"Mijoz tanlash"}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-600 truncate",children:S?"Mahsulotlarni tanlang va to'lov ma'lumotlarini kiriting":"Qarz berish uchun mijozni tanlang"})]})]}),e.jsx("button",{onClick:()=>Ue(),className:"w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors flex-shrink-0",children:e.jsx(be,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),S?e.jsxs("div",{className:"flex-1 p-3 sm:p-4 lg:p-6 overflow-y-auto min-h-0",children:[e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"bg-surface-50 p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600 text-sm sm:text-lg",children:S.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:S.name}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-500",children:S.phone})]})]})}),e.jsxs("div",{className:"bg-white border border-surface-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Mahsulotlar"}),e.jsxs("button",{onClick:()=>J(!0),className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 lg:px-4 py-1.5 sm:py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors shadow-sm text-xs sm:text-sm",children:[e.jsx(ps,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Mahsulot qidirish"}),e.jsx("span",{className:"sm:hidden",children:"Qo'shish"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Tez qidirish: mahsulot nomi yoki kodi...",value:c,onChange:y=>z(y.target.value),onFocus:()=>J(!0),onKeyDown:y=>{y.key==="Enter"&&pe.length>0&&as(pe[0]),y.key==="Escape"&&z("")},className:"w-full pl-10 pr-10 py-2 text-xs sm:text-sm bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"}),c&&e.jsx("button",{onClick:()=>z(""),className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 flex items-center justify-center text-surface-400 hover:text-surface-600 rounded-full hover:bg-surface-100",children:e.jsx(be,{className:"w-3 h-3"})})]}),c&&pe.length>0&&!W&&e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-surface-500",children:[e.jsxs("span",{children:[pe.length," ta mahsulot topildi"]}),e.jsx("span",{className:"text-brand-600",children:"Enter - birinchisini tanlash"})]})]}),c&&pe.length>0&&!W&&e.jsxs("div",{className:"mb-4 max-h-40 overflow-y-auto border border-surface-200 rounded-lg",children:[pe.slice(0,5).map(y=>e.jsxs("button",{onClick:()=>as(y),className:"w-full flex items-center gap-3 p-2 hover:bg-surface-50 transition-colors text-left border-b border-surface-100 last:border-b-0",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(Oe,{className:"w-4 h-4 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 text-sm truncate",children:y.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-surface-500 bg-surface-100 px-2 py-0.5 rounded",children:y.code}),e.jsxs("span",{className:"text-xs text-surface-500",children:["Omborda: ",y.quantity," ta"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold text-brand-600 text-sm",children:b(y.price)})})]},y._id)),pe.length>5&&e.jsxs("button",{onClick:()=>J(!0),className:"w-full p-2 text-center text-sm text-brand-600 hover:bg-brand-50 transition-colors",children:["Yana ",pe.length-5," ta ko'rish..."]})]}),e.jsx("div",{className:"space-y-2",children:f.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center text-surface-500 border-2 border-dashed border-surface-200 rounded-lg",children:[e.jsx(Oe,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Mahsulot tanlanmagan"})]}):f.map(y=>e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 bg-surface-50 rounded-lg border border-surface-200",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 text-xs sm:text-sm truncate",children:y.product.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",y.product.code]})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>Ve(y.product._id,y.quantity-1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded bg-surface-200 hover:bg-surface-300 transition-colors",children:e.jsx(dt,{className:"w-3 h-3"})}),e.jsx("span",{className:"w-8 sm:w-10 text-center font-medium bg-white px-1 sm:px-2 py-1 rounded border text-xs sm:text-sm",children:y.quantity}),e.jsx("button",{onClick:()=>Ve(y.product._id,y.quantity+1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded bg-surface-200 hover:bg-surface-300 transition-colors",children:e.jsx(ps,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"text-right min-w-0",children:[e.jsxs("p",{className:"font-bold text-surface-900 text-xs sm:text-sm",children:[b(y.price*y.quantity)," so'm"]}),e.jsxs("p",{className:"text-xs text-surface-500",children:[b(y.price)," Ã— ",y.quantity]})]}),e.jsx("button",{onClick:()=>u(y.product._id),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded text-danger-500 hover:bg-danger-50 transition-colors flex-shrink-0",children:e.jsx(be,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]},y.product._id))})]}),e.jsxs("div",{className:"bg-surface-50 p-3 sm:p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"Jami summa:"}),e.jsxs("span",{className:"font-semibold text-surface-900 text-xs sm:text-sm",children:[b(we)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"To'langan:"}),e.jsxs("span",{className:"font-semibold text-success-600 text-xs sm:text-sm",children:[b(Re)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between border-t border-surface-200 pt-2",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"Qarz qoldi:"}),e.jsxs("span",{className:`font-bold text-sm sm:text-base ${De<0,"text-danger-600"}`,children:[De<0?"-":"",b(Math.abs(De))," so'm"]})]}),De<0&&e.jsx("div",{className:"bg-danger-50 border border-danger-200 rounded-lg p-2 mt-2",children:e.jsx("p",{className:"text-danger-700 text-xs font-medium",children:"âš ï¸ To'langan summa jami summadan ko'p! Qarz minus bo'ldi."})})]}),e.jsxs("div",{className:"bg-white border border-surface-200 rounded-xl p-4 space-y-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"To'lov ma'lumotlari"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-surface-700 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(os,{className:"w-3 h-3 sm:w-4 sm:h-4 text-success-600"}),"To'langan summa"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"0",value:O.paidAmount,onChange:y=>{const U=ls(y.target.value);if((parseFloat(Je(U))||0)>we&&we>0){t(`To'langan summa jami summadan (${b(we)} so'm) ko'p bo'lishi mumkin emas!`,"Ogohlantirish","warning");return}ke(ve=>k(v({},ve),{paidAmount:U}))},className:`w-full pl-3 sm:pl-4 pr-12 sm:pr-16 py-3 sm:py-4 text-base sm:text-lg font-semibold border-2 rounded-xl focus:outline-none focus:ring-4 transition-all ${De<0?"border-danger-500 bg-gradient-to-r from-danger-50 to-red-50 focus:border-danger-500 focus:ring-danger-500/10":Re<we&&Re>0?"border-orange-400 bg-gradient-to-r from-yellow-100 to-orange-100 focus:border-orange-400 focus:ring-orange-400/10":"border-surface-200 bg-gradient-to-r from-white to-success-50 focus:border-success-500 focus:ring-success-500/10"}`}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 sm:pr-4 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-surface-500 font-medium text-xs sm:text-sm",children:"so'm"})})]}),O.paidAmount&&e.jsxs("div",{className:`mt-2 text-xs sm:text-sm font-medium ${De<0?"text-danger-600":"text-success-600"}`,children:[O.paidAmount," so'm",De<0&&e.jsx("span",{className:"block text-danger-600 font-bold mt-1",children:"âš ï¸ Jami summadan ko'p!"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-surface-700 mb-2",children:[e.jsx(Bs,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"Qaytarish muddati *"]}),e.jsx("input",{type:"date",value:O.dueDate,onChange:y=>ke(U=>k(v({},U),{dueDate:y.target.value})),className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"})]})]})]}),W&&e.jsxs("div",{className:"fixed inset-0 z-60 flex items-center justify-center p-2 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>J(!1)}),e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-4xl shadow-2xl relative z-10 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-3 sm:p-4 border-b border-surface-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h5",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Mahsulot tanlash"}),e.jsx("button",{onClick:()=>J(!1),className:"text-surface-400 hover:text-surface-600",children:e.jsx(be,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mahsulot nomi yoki kodi bilan qidiring...",value:c,onChange:y=>z(y.target.value),className:"w-full pl-10 pr-4 py-2 sm:py-3 text-xs sm:text-sm bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",autoFocus:!0})]}),c&&e.jsxs("div",{className:"mt-2 text-xs text-surface-500",children:['"',c,`" bo'yicha `,pe.length," ta natija topildi"]})]}),e.jsx("div",{className:"max-h-80 sm:max-h-96 overflow-y-auto p-3 sm:p-4",children:pe.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center text-surface-500",children:[e.jsx(Oe,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium mb-1 text-sm",children:c?"Mahsulot topilmadi":"Qidirish uchun mahsulot nomini yoki kodini kiriting"}),c&&e.jsxs("p",{className:"text-xs",children:['"',c,`" bo'yicha hech narsa topilmadi`]})]}):e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[pe.slice(0,100).map(y=>e.jsxs("button",{onClick:()=>as(y),className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 hover:bg-surface-50 transition-colors text-left border border-surface-200 rounded-lg group",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-lg flex items-center justify-center group-hover:bg-brand-200 transition-colors flex-shrink-0",children:e.jsx(Oe,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate text-xs sm:text-sm",children:y.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-surface-500 bg-surface-100 px-2 py-1 rounded",children:["Kod: ",y.code]}),e.jsxs("span",{className:"text-xs text-surface-500",children:["Omborda: ",y.quantity," ta"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-brand-600 text-sm sm:text-base",children:[b(y.price)," so'm"]}),e.jsx("p",{className:"text-xs text-surface-500",children:"Narxi"})]})]},y._id)),pe.length>100&&e.jsx("div",{className:"p-3 text-center text-surface-500 text-xs border-t border-surface-200",children:"Faqat birinchi 100 ta natija ko'rsatildi. Aniqroq qidiring."})]})}),e.jsx("div",{className:"p-3 sm:p-4 border-t border-surface-200 bg-surface-50",children:e.jsx("div",{className:"flex items-center gap-2 text-xs text-surface-500",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fs,{className:"w-3 h-3"}),e.jsx("span",{children:"Maslahat: Mahsulot nomini yoki kodini to'liq kiriting"})]})})})]})]})]}):e.jsxs("div",{className:"flex-1 p-3 sm:p-4 lg:p-6 overflow-y-auto min-h-0",children:[e.jsx("div",{className:"relative mb-3 sm:mb-4 lg:mb-6",children:e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(fs,{className:"w-4 h-4 sm:w-5 sm:h-5 text-surface-400"})}),e.jsx("input",{type:"text",placeholder:"Mijoz ismi yoki telefon raqami bilan qidiring...",value:T,onChange:y=>D(y.target.value),className:"w-full pl-9 sm:pl-10 pr-4 py-2 sm:py-3 text-sm bg-white border-2 border-surface-200 rounded-xl focus:outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 transition-all"}),T&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("button",{onClick:()=>D(""),className:"w-5 h-5 flex items-center justify-center text-surface-400 hover:text-surface-600 rounded-full hover:bg-surface-100",children:e.jsx(be,{className:"w-3 h-3"})})})]}),e.jsxs("button",{onClick:()=>Ne(!0),className:"flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-3 bg-success-500 text-white rounded-xl hover:bg-success-600 transition-colors flex-shrink-0",title:"Yangi mijoz qo'shish",children:[e.jsx(ps,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi mijoz"})]})]})}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:x.length===0?e.jsxs("div",{className:"p-6 sm:p-8 lg:p-12 text-center text-surface-500",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-surface-100 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4",children:e.jsx(fs,{className:"w-6 h-6 sm:w-8 sm:h-8 text-surface-400"})}),e.jsx("p",{className:"font-medium text-sm sm:text-base lg:text-lg mb-2",children:T?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"}),e.jsx("p",{className:"text-xs sm:text-sm",children:T?`"${T}" bo'yicha hech kim topilmadi`:"Hozircha mijozlar qo'shilmagan"})]}):x.map(y=>{const U=h.find(oe=>{var ve;return((ve=oe.customer)==null?void 0:ve._id)===y._id&&oe.status==="pending_approval"});return e.jsx("button",{onClick:()=>Ke(y),className:"w-full p-3 sm:p-4 hover:bg-gradient-to-r hover:from-brand-50 hover:to-blue-50 transition-all duration-200 text-left border-2 border-surface-200 hover:border-brand-300 rounded-xl group",children:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center shadow-lg group-hover:shadow-xl transition-shadow flex-shrink-0",children:e.jsx("span",{className:"text-sm sm:text-base lg:text-lg font-bold text-white",children:y.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-surface-900 text-sm sm:text-base lg:text-lg truncate",children:y.name}),U&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-warning-100 text-warning-700 flex-shrink-0",children:"Qarz mavjud"})]}),e.jsxs("p",{className:"text-surface-600 flex items-center gap-1 text-xs sm:text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{className:"truncate",children:y.phone})]}),U&&e.jsxs("p",{className:"text-xs text-warning-600 font-medium mt-1",children:["Mavjud qarz: ",b(U.amount-U.paidAmount)," so'm"]}),y.email&&e.jsxs("p",{className:"text-xs text-surface-500 flex items-center gap-1 mt-1",children:[e.jsx("svg",{className:"w-3 h-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("span",{className:"truncate",children:y.email})]})]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-brand-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})},y._id)})})]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row items-center justify-between gap-3 p-3 sm:p-4 lg:p-6 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-surface-600 order-2 sm:order-1",children:S&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-success-500 rounded-full"}),e.jsxs("span",{children:["Mijoz tanlandi: ",S.name]})]})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto order-1 sm:order-2",children:[S&&e.jsxs("button",{onClick:()=>q(null),className:"flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors text-xs sm:text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Orqaga"]}),e.jsx("button",{onClick:()=>Ue(),className:"px-3 sm:px-4 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors text-xs sm:text-sm",children:"Bekor qilish"}),S&&e.jsxs("button",{onClick:Be,disabled:f.length===0||!O.dueDate,className:"flex items-center gap-1 sm:gap-2 px-4 sm:px-6 py-2 bg-gradient-to-r from-brand-500 to-brand-600 text-white rounded-lg hover:from-brand-600 hover:to-brand-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-xs sm:text-sm flex-1 sm:flex-none justify-center",children:[e.jsx(os,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Qarz qo'shish",we>0&&e.jsxs("span",{className:"ml-2 px-2 py-1 bg-white/20 rounded text-xs hidden sm:inline",children:[b(De)," so'm"]})]})]})]})]})]}),ee&&L&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:$e}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl shadow-2xl relative z-10 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-surface-200 bg-gradient-to-r from-brand-50 to-blue-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(Xs,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-surface-900",children:"Qarz ma'lumotlari"}),e.jsxs("p",{className:"text-sm text-surface-600",children:["#",L._id.slice(-6)]})]})]}),e.jsx("button",{onClick:$e,className:"w-10 h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-3",children:"Mijoz ma'lumotlari"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600 text-lg",children:(A=L.customer)==null?void 0:A.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-surface-900",children:(fe=L.customer)==null?void 0:fe.name}),e.jsx("p",{className:"text-surface-600",children:(i=L.customer)==null?void 0:i.phone}),((ae=L.customer)==null?void 0:ae.email)&&e.jsx("p",{className:"text-sm text-surface-500",children:(Ce=L.customer)==null?void 0:Ce.email})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Qarz summasi"}),e.jsxs("p",{className:"text-2xl font-bold text-surface-900",children:[b(L.amount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"To'langan"}),e.jsxs("p",{className:"text-2xl font-bold text-success-600",children:[b(L.paidAmount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Qoldiq"}),e.jsxs("p",{className:"text-2xl font-bold text-danger-600",children:[b(L.amount-L.paidAmount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Muddat"}),e.jsx("p",{className:"text-lg font-semibold text-surface-900",children:new Date(L.dueDate).toLocaleDateString()})]})]}),L.description&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-2",children:"Izoh"}),e.jsx("p",{className:"text-surface-700",children:L.description})]}),L.items&&L.items.length>0&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-3",children:"Mahsulotlar"}),e.jsx("div",{className:"space-y-2",children:L.items.map((y,U)=>{var oe;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-surface-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(Oe,{className:"w-4 h-4 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:((oe=y.product)==null?void 0:oe.name)||"Mahsulot"}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Miqdor: ",y.quantity]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[b(y.price*y.quantity)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:[b(y.price)," Ã— ",y.quantity]})]})]},U)})})]}),e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Yaratilgan"}),e.jsx("p",{className:"font-semibold text-surface-900",children:new Date(L.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:"flex justify-end gap-3 p-6 border-t border-surface-200 bg-surface-50/50",children:e.jsx("button",{onClick:$e,className:"px-6 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Yopish"})})]})]}),ie&&L&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:le}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-surface-200 bg-gradient-to-r from-danger-50 to-red-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-danger-500 to-danger-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(Ps,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-surface-900",children:"Qarzni o'chirish"}),e.jsx("p",{className:"text-sm text-surface-600",children:"Bu amalni bekor qilib bo'lmaydi"})]})]}),e.jsx("button",{onClick:le,className:"w-10 h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-danger-50 p-4 rounded-xl border border-danger-200 mb-4",children:[e.jsx("p",{className:"text-danger-800 font-medium mb-2",children:"Diqqat!"}),e.jsxs("p",{className:"text-danger-700 text-sm",children:["Siz ",e.jsx("strong",{children:(qe=L.customer)==null?void 0:qe.name})," mijozining ",e.jsxs("strong",{children:[b(L.amount)," so'm"]})," qarzini o'chirmoqchisiz. Bu amal bekor qilinmaydi va barcha ma'lumotlar yo'qoladi."]}),L.status==="approved"&&e.jsxs("p",{className:"text-danger-600 text-xs mt-2",children:[e.jsx("strong",{children:"Eslatma:"})," Bu tasdiqlangan qarz. O'chirilganda mijozning umumiy qarzidan ham ayriladi."]})]}),e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Qarz summasi:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[b(L.amount)," so'm"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-surface-600",children:"Qoldiq:"}),e.jsxs("span",{className:"font-semibold text-danger-600",children:[b(L.amount-L.paidAmount)," so'm"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("button",{onClick:le,className:"px-6 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:Pe,className:"px-6 py-2 bg-gradient-to-r from-danger-500 to-danger-600 text-white rounded-lg hover:from-danger-600 hover:to-danger-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:"O'chirish"})]})]})]}),B&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:ne}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-200 bg-gradient-to-r from-success-50 to-green-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-success-500 to-success-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(ps,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-surface-900",children:"Yangi mijoz"}),e.jsx("p",{className:"text-xs text-surface-600",children:"Mijoz ma'lumotlari"})]})]}),e.jsx("button",{onClick:ne,className:"w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(be,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Ism *"}),e.jsx("input",{type:"text",value:je.name,onChange:y=>K(U=>k(v({},U),{name:y.target.value})),className:"w-full px-3 py-2 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20",placeholder:"Mijoz ismi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Telefon *"}),e.jsx("input",{type:"tel",value:je.phone,onChange:y=>K(U=>k(v({},U),{phone:y.target.value})),className:"w-full px-3 py-2 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20",placeholder:"+998 (XX) XXX-XX-XX"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Viloyat"}),e.jsx("textarea",{value:je.address,onChange:y=>K(U=>k(v({},U),{address:y.target.value})),className:"w-full px-3 py-2 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20 resize-none",rows:2,placeholder:"Viloyatni tanlang"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("button",{onClick:ne,className:"px-4 py-2 text-xs font-medium text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:Q,disabled:!je.name.trim()||!je.phone.trim(),className:"px-4 py-2 text-xs font-medium bg-gradient-to-r from-success-500 to-success-600 text-white rounded-lg hover:from-success-600 hover:to-success-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:"Saqlash"})]})]})]})]})}function gn(){const{showAlert:t,AlertComponent:l}=vs(),r=st(),[h,n]=s.useState([]),[g,N]=s.useState(null),[p,P]=s.useState([]),[$,w]=s.useState([]),[j,M]=s.useState(20),[T,D]=s.useState(""),[c,z]=s.useState("all"),[S,q]=s.useState(!1),[f,R]=s.useState(!1),[W,J]=s.useState(!1),[de,xe]=s.useState(!1),[O,ke]=s.useState(!1),[ee,Se]=s.useState(null),[ie,ce]=s.useState(null),[L,ge]=s.useState(!1),[B,Ne]=s.useState({code:"",name:"",quantity:"",previousPrice:"",currentPrice:"",unit:"dona",conversionEnabled:!1,baseUnit:"dona",conversionRate:"",packageCount:"",pricePerMeter:"",pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),[je,K]=s.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[Q,ne]=s.useState([]),[V,he]=s.useState(""),[ye,Fe]=s.useState(!1),[Ke,Ue]=s.useState(null),[as,Ve]=s.useState(!1),[u,te]=s.useState(!1),[Pe,$e]=s.useState("add"),[le,Be]=s.useState(""),[x,pe]=s.useState({printer:"",copies:1,size:"card",layout:"standard",customWidth:"",customHeight:""}),[we,Re]=s.useState([]),[De,Ae]=s.useState(!1),[A,fe]=s.useState(null),i=s.useRef(null),ae=s.useRef(null);s.useEffect(()=>{Ce()},[]),s.useEffect(()=>{g&&qe()},[g]),s.useEffect(()=>{w(p.slice(0,j))},[p,j]),s.useEffect(()=>{const d=ae.current;if(!d)return;const re=()=>{const{scrollTop:m,scrollHeight:X,clientHeight:a}=d;X-m<=a*1.5&&j<p.length&&M(C=>Math.min(C+20,p.length))};return d.addEventListener("scroll",re),()=>d.removeEventListener("scroll",re)},[j,p.length]),s.useEffect(()=>{g&&qe()},[r.pathname]),s.useEffect(()=>{const d=re=>{re.key==="Escape"&&ye&&Fe(!1)};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[ye]),s.useEffect(()=>{let d=h;T.trim()!==""&&(d=d.filter(re=>re.name.toLowerCase().includes(T.toLowerCase())||re.code.toLowerCase().includes(T.toLowerCase()))),c!=="all"&&(c==="low"?d=d.filter(re=>re.quantity<=(re.minStock||50)&&re.quantity>0):c==="out"&&(d=d.filter(re=>re.quantity===0))),P(d),M(20)},[h,T,c]);const Ce=()=>E(this,null,function*(){try{const re=(yield F.get("/warehouses")).data.find(m=>m.name==="Asosiy ombor");if(re)N(re);else{const m=yield F.post("/warehouses",{name:"Asosiy ombor",address:""});N(m.data)}}catch(d){console.error("Error fetching warehouses:",d),q(!1)}}),qe=()=>E(this,null,function*(){try{q(!0);const d=yield F.get("/products?mainOnly=true&limit=10000"),re=d.data.data||d.data;n(Array.isArray(re)?re:[])}catch(d){console.error("Error fetching products:",d),t("Tovarlarni yuklashda xatolik yuz berdi","Xatolik","danger")}finally{q(!1)}}),y=d=>new Promise((re,m)=>{const X=new FileReader;X.readAsDataURL(d),X.onload=a=>{var I;const C=document.createElement("img");C.src=(I=a.target)==null?void 0:I.result,C.onload=()=>{const H=document.createElement("canvas");let G=C.width,Z=C.height;if(G>1920||Z>1920){const me=Math.min(1920/G,1920/Z);G=Math.round(G*me),Z=Math.round(Z*me)}H.width=G,H.height=Z;const se=H.getContext("2d");if(!se){m(new Error("Canvas context not available"));return}se.drawImage(C,0,0,G,Z),H.toBlob(me=>{me?re(me):m(new Error("Canvas to blob failed"))},"image/jpeg",.8)},C.onerror=()=>m(new Error("Image load failed"))},X.onerror=()=>m(new Error("File read failed"))}),U=(d,re)=>E(this,null,function*(){var se,me;const m=re.target.files;if(!m||m.length===0)return;const X=h.find(ze=>ze._id===d);if(!X)return;const a=X.images||[],C=8-a.length;if(C<=0){t("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const I=["image/jpeg","image/jpg","image/png","image/webp"],H=Array.from(m).filter(ze=>I.includes(ze.type)?!0:(t(`${ze.name} - noto'g'ri format. Faqat JPG, PNG, WebP qabul qilinadi`,"Xatolik","warning"),!1));if(H.length===0)return;const G=H.slice(0,C),Z=new FormData;ge(!0),fe(d);try{for(const us of G)try{const Is=yield y(us);Z.append("images",Is,us.name)}catch(Is){console.warn(`Image compression failed for ${us.name}, uploading original:`,Is),Z.append("images",us)}const ze=yield F.post("/products/upload-images",Z,{headers:{"Content-Type":"multipart/form-data"}}),Ie=[...a,...ze.data.images],cs=yield F.put(`/products/${d}/images`,{images:Ie});n(us=>us.map(Is=>Is._id===d?k(v({},Is),{images:Ie}):Is)),t(`${ze.data.images.length} ta rasm muvaffaqiyatli yuklandi!`,"Muvaffaqiyat","success")}catch(ze){console.error("Error uploading images:",ze);const Ie=((me=(se=ze.response)==null?void 0:se.data)==null?void 0:me.message)||"Rasmlarni yuklashda xatolik";t(Ie,"Xatolik","danger")}finally{ge(!1),fe(null),i.current&&(i.current.value="")}}),oe=()=>E(this,null,function*(){R(!0);try{yield qe(),t("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(d){console.error("Refresh xatosi:",d),t("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{R(!1)}}),ve=d=>E(this,null,function*(){const re=d.target.files;if(!re||re.length===0)return;const m=8-Q.length;if(m<=0){t("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const X=Array.from(re).slice(0,m),a=new FormData;X.forEach(C=>a.append("images",C)),ge(!0);try{const C=yield F.post("/products/upload-images",a,{headers:{"Content-Type":"multipart/form-data"}});ne([...Q,...C.data.images])}catch(C){console.error("Error uploading images:",C),t("Rasmlarni yuklashda xatolik","Xatolik","danger")}finally{ge(!1),i.current&&(i.current.value="")}}),ss=d=>E(this,null,function*(){try{yield F.delete("/products/delete-image",{data:{imagePath:d}}),ne(Q.filter(re=>re!==d))}catch(re){console.error("Error deleting image:",re)}}),_e=d=>E(this,null,function*(){var a,C;if(d.preventDefault(),V){t(V,"Xatolik","danger");return}let re=Number(B.quantity),m=null;if(as&&je.packageCount&&je.unitsPerPackage){const I=Number(je.packageCount)*Number(je.unitsPerPackage);re=ie?Number(B.quantity)+I:I,m={packageCount:Number(je.packageCount),unitsPerPackage:Number(je.unitsPerPackage),totalUnits:I}}let X=re;B.conversionEnabled&&B.conversionRate&&(X=re*Number(B.conversionRate));try{const I={code:B.code,name:B.name,price:Number(B.currentPrice),previousPrice:Number(B.previousPrice)||0,currentPrice:Number(B.currentPrice)||0,quantity:re,warehouse:g==null?void 0:g._id,images:Q,packageInfo:m,unit:B.unit,unitConversion:{enabled:B.conversionEnabled,baseUnit:B.baseUnit,conversionRate:Number(B.conversionRate)||1,packageCount:re,totalBaseUnits:X},prices:{perUnit:Number(B.currentPrice),perMeter:Number(B.pricePerMeter)||0,perRoll:Number(B.pricePerRoll)||0,perBox:Number(B.pricePerBox)||0,perKg:Number(B.pricePerKg)||0,perGram:Number(B.pricePerGram)||0}};ie?yield F.put(`/products/${ie._id}`,I):yield F.post("/products",I),qe(),rs()}catch(I){t(((C=(a=I.response)==null?void 0:a.data)==null?void 0:C.message)||"Xatolik yuz berdi","Xatolik","danger")}}),rs=()=>{J(!1),ce(null),Ne({code:"",name:"",quantity:"",previousPrice:"",currentPrice:"",unit:"dona",conversionEnabled:!1,baseUnit:"dona",conversionRate:"",packageCount:"",pricePerMeter:"",pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),K({packageCount:"",unitsPerPackage:"",totalCost:""}),ne([]),he(""),Ve(!1)},Xe=d=>{$e(d),Be(""),te(!0)},Ss=()=>{const d=Number(le)||0;if(d<=0)return;const re=Number(B.quantity)||0;let m=Pe==="add"?re+d:re-d;m<0&&(m=0),Ne(k(v({},B),{quantity:String(m)})),te(!1),Be("")},zs=d=>E(this,null,function*(){if(d)try{const re=(ie==null?void 0:ie._id)||"";(yield F.get(`/products/check-code/${d}${re?`?excludeId=${re}`:""}`)).data.exists?he(`Kod "${d}" allaqachon mavjud`):he("")}catch(re){console.error("Error checking code:",re)}}),Cs=()=>{if(!ee)return;const d=document.getElementById("qr-code-svg");if(!d)return;const re=new XMLSerializer().serializeToString(d),m=document.createElement("canvas"),X=m.getContext("2d"),a=document.createElement("img");a.onload=()=>{m.width=a.width,m.height=a.height,X==null||X.drawImage(a,0,0);const C=m.toDataURL("image/png"),I=document.createElement("a");I.download=`QR-${ee.code}-${ee.name}.png`,I.href=C,I.click()},a.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(re)))},js=(d,re)=>E(this,null,function*(){try{const m=JSON.stringify({id:d._id,code:d.code,name:d.name,price:d.price});return yield ia(m,{width:re*10,margin:1,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"H",type:"image/png"})}catch(m){return console.error("Error generating QR code:",m),""}}),Ns=()=>E(this,null,function*(){if(ee)try{const d=x.customWidth&&x.customHeight,re=d?`${x.customWidth}mm`:null,m=d?`${x.customHeight}mm`:null,X=x.size==="card"?65:x.size==="thermal"?125:145,a=yield js(ee,X),C=`
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="utf-8">
          <title>Label - ${ee.name}</title>
          <style>
            @page {
              size: ${d?`${re} ${m}`:x.size==="card"?"28mm 18mm":x.size==="A4"?"A4":x.size==="A5"?"A5":"50mm 70mm"};
              margin: 0;
            }
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            html, body {
              width: 100%;
              height: 100%;
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              background: white;
              overflow: hidden;
            }
            .page-container {
              width: 100%;
              height: 100vh;
              display: flex;
              justify-content: center;
              align-items: center;
              page-break-after: avoid;
            }
            .label-container {
              border: 2px solid #333;
              padding: ${x.size==="card"?"1mm":x.size==="thermal"?"6px":"12px"};
              background: white;
              width: ${d?re:x.size==="card"?"26mm":x.size==="thermal"?"44mm":x.size==="A4"?"80mm":(x.size==="A5","120mm")};
              height: ${d?m:x.size==="card"?"16mm":x.size==="thermal"?"60mm":x.size==="A4"?"100mm":(x.size==="A5","140mm")};
              display: flex;
              flex-direction: column;
              justify-content: space-between;
              gap: 2px;
              overflow: hidden;
              border-radius: 2px;
              page-break-inside: avoid;
            }
            .product-info {
              flex: 1;
              width: 100%;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              text-align: center;
              height: auto;
            }
            .product-name {
              font-size: ${x.size==="card"?"8px":x.size==="thermal"?"16px":"20px"};
              font-weight: 600;
              color: #1a1a1a;
              line-height: 1.1;
              margin-bottom: ${x.size==="card"?"1px":"2px"};
              word-wrap: break-word;
              overflow: hidden;
              text-overflow: ellipsis;
              display: -webkit-box;
              -webkit-line-clamp: ${x.size==="card"?"1":"2"};
              -webkit-box-orient: vertical;
            }
            .product-code {
              font-size: ${x.size==="card"?"7px":x.size==="thermal"?"14px":"18px"};
              color: #666;
              line-height: 1.0;
              margin-bottom: ${x.size==="card"?"1px":"2px"};
              font-weight: 500;
            }
            .product-price {
              font-size: ${x.size==="card"?"12px":x.size==="thermal"?"20px":"24px"};
              font-weight: 800;
              color: #d32f2f;
              line-height: 1.0;
              margin-bottom: ${x.size==="card"?"0px":"1px"};
            }
            .qr-code-section {
              flex-shrink: 0;
              display: flex;
              align-items: center;
              justify-content: center;
              width: 100%;
              height: auto;
              padding: 2px 0;
              overflow: hidden;
              box-sizing: border-box;
            }
            .qr-code-img {
              width: ${x.size==="card"?"60px":x.size==="thermal"?"120px":"140px"};
              height: ${x.size==="card"?"60px":x.size==="thermal"?"120px":"140px"};
              max-width: 95%;
              max-height: 95%;
              border: 1px solid #e0e0e0;
              border-radius: 2px;
              background: white;
              object-fit: contain;
              image-rendering: -webkit-optimize-contrast;
              image-rendering: crisp-edges;
              image-rendering: pixelated;
            }
            .additional-info {
              margin: 0;
              font-size: ${x.size==="card"?"4px":x.size==="thermal"?"10px":"12px"};
              color: #888;
              line-height: 1.0;
              font-weight: 400;
            }
            ${x.layout==="minimal"?".additional-info { display: none; }":""}
            
            @media print {
              html, body {
                background: white !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                margin: 0 !important;
                padding: 0 !important;
              }
              .page-container {
                height: 100vh !important;
                page-break-after: avoid !important;
              }
              .label-container {
                page-break-inside: avoid !important;
                width: ${d?re:x.size==="card"?"28mm":x.size==="thermal"?"48mm":x.size==="A4"?"85mm":(x.size==="A5","130mm")} !important;
                height: ${d?m:x.size==="card"?"18mm":x.size==="thermal"?"65mm":x.size==="A4"?"105mm":(x.size==="A5","145mm")} !important;
                padding: ${x.size==="card"?"1.5mm":x.size==="thermal"?"8px":"15px"} !important;
                flex-direction: column !important;
                justify-content: space-between !important;
              }
              .qr-code-section {
                width: 100% !important;
                height: auto !important;
                overflow: hidden !important;
                box-sizing: border-box !important;
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
              }
              .qr-code-img {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                width: ${x.size==="card"?"65px":x.size==="thermal"?"125px":"145px"} !important;
                height: ${x.size==="card"?"65px":x.size==="thermal"?"125px":"145px"} !important;
                max-width: 95% !important;
                max-height: 95% !important;
                object-fit: contain !important;
              }
            }
          </style>
        </head>
        <body>
          <div class="page-container">
            <div class="label-container">
              <div class="product-info">
                <div class="product-price">${b(ee.currentPrice||ee.price)} so'm</div>
                <div class="product-code">Kod: ${ee.code}</div>
                <div class="product-name">${ee.name}</div>
                
                ${x.layout==="standard"?`
                  <div class="additional-info">
                    Miqdor: ${ee.quantity} | ${new Date().toLocaleDateString("uz-UZ")}
                  </div>
                `:""}
              </div>
              
              <div class="qr-code-section">
                <img src="${a}" alt="QR Code" class="qr-code-img" />
              </div>
            </div>
          </div>
        </body>
        </html>
      `,I=window.open("","_blank","width=1024,height=768");if(!I){alert("Popup blocker tomonidan to'sib qo'yildi. Popup'larni yoqing.");return}I.document.open(),I.document.write(C),I.document.close(),I.onload=()=>{setTimeout(()=>{I.focus(),I.print(),setTimeout(()=>{I.close()},1e3)},500)},ke(!1)}catch(d){console.error("Error generating print content:",d),alert("Chop uchun tayyorlashda xatolik yuz berdi")}}),xs={total:h.length,lowStock:h.filter(d=>d.quantity<=(d.minStock||50)&&d.quantity>0).length,outOfStock:h.filter(d=>d.quantity===0).length,totalValue:h.reduce((d,re)=>d+re.price*re.quantity,0)},gs=d=>{if(d.images&&d.images.length>0){const re=typeof d.images[0]=="string"?d.images[0]:d.images[0].path;return`${Ts}${re}`}return null},ks=[{label:"Jami tovarlar",value:xs.total,icon:Oe,color:"brand",filter:"all"},{label:"Kam qolgan",value:xs.lowStock,icon:qs,color:"warning",filter:"low"},{label:"Tugagan",value:xs.outOfStock,icon:be,color:"danger",filter:"out"},{label:"Jami qiymat",value:`${b(xs.totalValue)} so'm`,icon:os,color:"success",filter:null}];return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[l,e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-brand-600"}),e.jsx("h2",{className:"text-lg font-semibold text-surface-900",children:"Tovarlar (Asosiy ombor)"})]}),e.jsx("div",{className:"flex items-center gap-2 sm:gap-3",children:e.jsxs("button",{onClick:oe,disabled:f,className:"flex items-center justify-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50",title:"Tovarlar ro'yxatini yangilash (F5)",children:[e.jsx(Rs,{className:`w-4 h-4 ${f?"animate-spin":""}`}),e.jsx("span",{className:"sm:inline",children:f?"Yangilanmoqda...":"Yangilash"})]})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-2 sm:gap-2.5 md:gap-3",children:ks.map((d,re)=>e.jsx("div",{onClick:()=>d.filter&&z(d.filter),className:`bg-white rounded-lg sm:rounded-xl border-2 transition-all ${d.filter?"cursor-pointer hover:shadow-lg hover:scale-[1.02]":""} ${c===d.filter?"border-brand-500 shadow-md":"border-surface-200"}`,children:e.jsxs("div",{className:"p-2 sm:p-2.5 md:p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-1.5 sm:mb-2",children:[e.jsx("div",{className:`w-7 h-7 sm:w-8 sm:h-8 md:w-9 md:h-9 rounded-lg flex items-center justify-center bg-${d.color}-50`,children:e.jsx(d.icon,{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-4.5 md:h-4.5 text-${d.color}-600`})}),e.jsx("p",{className:"text-[10px] sm:text-xs text-surface-500 font-medium",children:d.label})]}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-surface-900",children:d.value})]})},re))}),e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Tovar nomi yoki kodi bo'yicha qidirish...",value:T,onChange:d=>D(d.target.value),className:"w-full pl-10 pr-4 py-2 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-100"})]}),e.jsx("div",{className:"card p-0 overflow-hidden",children:S?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Oe,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Tovarlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:T?"Qidiruv bo'yicha tovarlar topilmadi":"Tovarlar mavjud emas"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden lg:block",children:[e.jsx("div",{className:"table-header",children:e.jsxs("div",{className:"grid grid-cols-14 gap-2 px-4 py-4",children:[e.jsx("span",{className:"table-header-cell col-span-1",children:"Rasm"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Kod"}),e.jsx("span",{className:"table-header-cell col-span-2",children:"Nomi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Tan narxi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Dona narxi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Karobka"}),e.jsx("span",{className:"table-header-cell col-span-3",children:"Chegirmalar"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Oldingi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Hozirgi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Miqdori"})]})}),e.jsx("div",{className:"max-h-[calc(100vh-400px)] overflow-y-auto divide-y divide-surface-100",children:p.map(d=>{var re,m,X,a,C,I,H,G,Z,se,me,ze;return e.jsxs("div",{className:"grid grid-cols-14 gap-2 px-4 py-3 items-center hover:bg-surface-50 transition-colors relative",children:[e.jsx("div",{className:"col-span-1",children:gs(d)?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:gs(d),alt:d.name,className:"w-10 h-10 rounded-lg object-cover cursor-pointer hover:scale-110 transition-transform",onClick:()=>{Ue(gs(d)),Fe(!0)}}),e.jsx("button",{onClick:Ie=>{var cs;Ie.stopPropagation(),fe(d._id),(cs=i.current)==null||cs.click()},disabled:L&&A===d._id,className:"absolute -top-0.5 -right-0.5 flex items-center justify-center w-4 h-4 bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-full shadow-sm hover:shadow-md transition-all duration-200 hover:scale-110 disabled:opacity-50",title:"Rasm yuklash",children:L&&A===d._id?e.jsx("div",{className:"w-2 h-2 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(vt,{className:"w-2 h-2 text-white"})})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-lg flex items-center justify-center",children:e.jsx(ir,{className:"w-5 h-5 text-surface-400"})}),e.jsx("button",{onClick:Ie=>{var cs;Ie.stopPropagation(),fe(d._id),(cs=i.current)==null||cs.click()},disabled:L&&A===d._id,className:"absolute -top-0.5 -right-0.5 flex items-center justify-center w-4 h-4 bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-full shadow-sm hover:shadow-md transition-all duration-200 hover:scale-110 disabled:opacity-50",title:"Rasm yuklash",children:L&&A===d._id?e.jsx("div",{className:"w-2 h-2 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(vt,{className:"w-2 h-2 text-white"})})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"font-mono text-xs bg-surface-100 px-1.5 py-0.5 rounded",children:d.code})}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"font-medium text-surface-900 text-sm truncate",children:d.name})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-surface-700 text-sm",children:b(d.costPrice||0)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-brand-600 text-sm",children:b(d.unitPrice||d.price)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-orange-600 text-sm",children:d.boxPrice>0?b(d.boxPrice):"-"})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[((m=(re=d.pricingTiers)==null?void 0:re.tier1)==null?void 0:m.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-emerald-50 text-emerald-700 rounded text-[10px] font-bold",children:[d.pricingTiers.tier1.minQuantity,"-",d.pricingTiers.tier1.maxQuantity,": ",d.pricingTiers.tier1.discountPercent,"%"]}),((a=(X=d.pricingTiers)==null?void 0:X.tier2)==null?void 0:a.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded text-[10px] font-bold",children:[d.pricingTiers.tier2.minQuantity,"-",d.pricingTiers.tier2.maxQuantity,": ",d.pricingTiers.tier2.discountPercent,"%"]}),((I=(C=d.pricingTiers)==null?void 0:C.tier3)==null?void 0:I.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-purple-50 text-purple-700 rounded text-[10px] font-bold",children:[d.pricingTiers.tier3.minQuantity,"+: ",d.pricingTiers.tier3.discountPercent,"%"]}),!((G=(H=d.pricingTiers)==null?void 0:H.tier1)!=null&&G.discountPercent)&&!((se=(Z=d.pricingTiers)==null?void 0:Z.tier2)!=null&&se.discountPercent)&&!((ze=(me=d.pricingTiers)==null?void 0:me.tier3)!=null&&ze.discountPercent)&&e.jsx("span",{className:"text-surface-400 text-xs",children:"-"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:`font-semibold text-sm ${(()=>{const Ie=d.previousPrice||0,cs=d.currentPrice||d.price;return Ie>0&&cs>0&&Ie!==cs?"line-through text-red-500":"text-surface-900"})()}`,children:b(d.previousPrice||0)})}),e.jsxs("div",{className:"col-span-1 relative",children:[(()=>{const Ie=d.previousPrice||0,cs=d.currentPrice||d.price;if(Ie>0&&cs>0&&Ie!==cs){const us=Math.round((Ie-cs)/Ie*100);if(us>0)return e.jsxs("div",{className:"absolute -top-2 -right-1 px-1 py-0.5 bg-red-500 text-white rounded text-[9px] font-bold",children:["-",us,"%"]});if(us<0)return e.jsxs("div",{className:"absolute -top-2 -right-1 px-1 py-0.5 bg-green-500 text-white rounded text-[9px] font-bold",children:["+",Math.abs(us),"%"]})}return null})(),e.jsx("p",{className:"font-semibold text-surface-900 text-sm",children:b(d.currentPrice||d.price)})]}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`font-semibold text-sm ${d.quantity===0?"text-danger-600":d.quantity<=(d.minStock||100)?"text-warning-600":"text-success-600"}`,children:d.quantity})})]},d._id)})})]}),e.jsxs("div",{className:"lg:hidden",children:[e.jsxs("div",{ref:ae,className:"max-h-[calc(100vh-300px)] overflow-y-auto p-3 sm:p-4",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-2 sm:gap-3",children:$.map(d=>e.jsx("div",{className:"group bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 hover:border-brand-300 hover:shadow-lg transition-all p-2 sm:p-4 relative",children:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"w-full aspect-square bg-gradient-to-br from-brand-100 to-brand-50 rounded-xl border-2 border-brand-200 flex items-center justify-center mb-2 sm:mb-3 group-hover:scale-105 transition-transform overflow-hidden cursor-pointer relative",onClick:()=>{if(d.images&&d.images.length>0){const re=typeof d.images[0]=="string"?d.images[0]:d.images[0].path;Ue(`${Ts}${re}`),Fe(!0)}},children:d.images&&d.images.length>0?e.jsx(e.Fragment,{children:e.jsx("img",{src:`${Ts}${typeof d.images[0]=="string"?d.images[0]:d.images[0].path}`,alt:d.name,className:"w-full h-full object-cover",onError:re=>{re.currentTarget.style.display="none",re.currentTarget.parentElement.innerHTML='<svg class="w-6 h-6 sm:w-8 sm:h-8 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>'}})}):e.jsx(Oe,{className:"w-6 h-6 sm:w-8 sm:h-8 text-brand-600"})}),e.jsx("p",{className:"font-semibold text-slate-900 text-[10px] sm:text-sm truncate",children:d.name}),e.jsxs("div",{className:"flex items-center gap-1.5 mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[9px] sm:text-xs text-slate-500",children:d.code}),e.jsx("button",{onClick:re=>{var m;re.stopPropagation(),fe(d._id),(m=i.current)==null||m.click()},disabled:L&&A===d._id,className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex items-center justify-center bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-full shadow-sm hover:shadow-md transition-all duration-200 hover:scale-110 disabled:opacity-50",title:"Rasm yuklash",children:L&&A===d._id?e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(vt,{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 text-white"})})]}),e.jsxs("p",{className:"font-bold text-brand-600 text-[10px] sm:text-sm",children:[b(d.price)," so'm"]}),e.jsxs("p",{className:"text-[9px] sm:text-xs text-slate-500 mt-1",children:["Mavjud: ",d.quantity," ta"]})]})},d._id))}),j<p.length&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"w-6 h-6 border-2 border-brand-500 border-t-transparent rounded-full animate-spin"})})]}),e.jsx("input",{ref:i,type:"file",accept:"image/*",multiple:!0,onChange:d=>{A&&U(A,d)},className:"hidden"})]})]})})]}),W&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start sm:items-center justify-center p-2 pt-4 sm:p-4",children:[e.jsx("div",{className:"overlay",onClick:rs}),e.jsxs("div",{className:"modal w-full sm:max-w-lg p-4 sm:p-6 relative z-10 max-h-[calc(100vh-120px)] sm:max-h-[85vh] overflow-y-auto rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6 sticky top-0 bg-white pb-3 border-b border-surface-200 -mx-4 sm:-mx-6 px-4 sm:px-6 z-10",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-surface-900",children:ie?"Tovarni tahrirlash":"Yangi tovar"}),e.jsx("button",{onClick:rs,className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:_e,className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Rasmlar (max 8)"}),e.jsxs("div",{className:"grid grid-cols-4 gap-1.5 sm:gap-2 mb-2",children:[Q.map((d,re)=>e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:`${Ts}${d}`,alt:"",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>ss(d),className:"absolute -top-1 -right-1 w-4 h-4 sm:w-5 sm:h-5 bg-danger-500 text-white rounded-full flex items-center justify-center",children:e.jsx(be,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})})]},re)),Q.length<8&&e.jsx("button",{type:"button",onClick:()=>{var d;return(d=i.current)==null?void 0:d.click()},disabled:L,className:"aspect-square border-2 border-dashed border-surface-300 rounded-lg flex flex-col items-center justify-center hover:border-brand-500 hover:bg-brand-50 transition-colors",children:L?e.jsx("div",{className:"spinner w-4 h-4 sm:w-5 sm:h-5 text-brand-600"}):e.jsxs(e.Fragment,{children:[e.jsx(vt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-surface-400 mb-0.5 sm:mb-1"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-surface-500",children:"Yuklash"})]})})]}),e.jsx("input",{ref:i,type:"file",accept:"image/*",multiple:!0,onChange:ve,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input text-sm sm:text-base py-2 sm:py-2.5 ${V?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"1",value:B.code,onChange:d=>Ne(k(v({},B),{code:d.target.value})),onBlur:d=>zs(d.target.value),required:!0}),V&&e.jsx("p",{className:"text-xs sm:text-sm text-danger-600 mt-1",children:V})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Miqdori"}),ie?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"flex-1 px-2 sm:px-4 py-2 sm:py-3 bg-surface-100 rounded-xl text-center font-semibold text-surface-900 text-sm sm:text-base",children:b(B.quantity||0)}),e.jsx("button",{type:"button",onClick:()=>Xe("add"),className:"btn-icon bg-success-100 text-success-600 hover:bg-success-200 w-8 h-8 sm:w-10 sm:h-10",children:e.jsx(ps,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{type:"button",onClick:()=>Xe("subtract"),className:"btn-icon bg-danger-100 text-danger-600 hover:bg-danger-200 w-8 h-8 sm:w-10 sm:h-10",children:e.jsx(dt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}):e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"0",value:ls(B.quantity),onChange:d=>Ne(k(v({},B),{quantity:Je(d.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"Tovar nomi",value:B.name,onChange:d=>Ne(k(v({},B),{name:d.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Oldingi narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"0",value:ls(B.previousPrice),onChange:d=>Ne(k(v({},B),{previousPrice:Je(d.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Hozirgi narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"0",value:ls(B.currentPrice),onChange:d=>Ne(k(v({},B),{currentPrice:Je(d.target.value)})),required:!0}),B.previousPrice&&B.currentPrice&&Number(B.previousPrice)>0&&Number(B.currentPrice)>0&&e.jsx("div",{className:"mt-1.5 sm:mt-2",children:(()=>{const d=Number(B.previousPrice),re=Number(B.currentPrice),m=Math.round((d-re)/d*100);return m>0?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1.5 sm:py-2 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-green-500 rounded-full"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-green-700",children:[m,"% chegirma"]})]}):m<0?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1.5 sm:py-2 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-red-500 rounded-full"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-red-700",children:[Math.abs(m),"% qimmatroq"]})]}):null})()})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-3 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-brand-600"}),"O'lchov birligi"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Birlik"}),e.jsxs("select",{className:"input",value:B.unit,onChange:d=>Ne(k(v({},B),{unit:d.target.value})),children:[e.jsx("option",{value:"dona",children:"Dona"}),e.jsx("option",{value:"metr",children:"Metr"}),e.jsx("option",{value:"rulon",children:"Rulon"}),e.jsx("option",{value:"karobka",children:"Karobka/Quti"}),e.jsx("option",{value:"gram",children:"Gram"}),e.jsx("option",{value:"kg",children:"Kilogram"}),e.jsx("option",{value:"litr",children:"Litr"})]})]}),(B.unit==="rulon"||B.unit==="karobka")&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:["1 ",B.unit==="rulon"?"rulon":"karobka"," = ?"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"input flex-1",placeholder:"30",value:B.conversionRate,onChange:d=>Ne(k(v({},B),{conversionRate:Je(d.target.value),conversionEnabled:!0}))}),e.jsxs("select",{className:"input w-24",value:B.baseUnit,onChange:d=>Ne(k(v({},B),{baseUnit:d.target.value})),children:[e.jsx("option",{value:"metr",children:"metr"}),e.jsx("option",{value:"dona",children:"dona"})]})]})]})]}),B.conversionEnabled&&B.conversionRate&&B.quantity&&e.jsx("div",{className:"mt-3 p-3 bg-purple-50 rounded-xl",children:e.jsxs("p",{className:"text-sm text-purple-700",children:[e.jsx("span",{className:"font-semibold",children:b(B.quantity)})," ",B.unit==="rulon"?"rulon":"karobka"," =",e.jsx("span",{className:"font-semibold ml-1",children:b(Number(B.quantity)*Number(B.conversionRate))})," ",B.baseUnit]})})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-3 flex items-center gap-2",children:[e.jsx(os,{className:"w-4 h-4 text-green-600"}),"Qo'shimcha narxlar (ixtiyoriy)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Metr narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:ls(B.pricePerMeter),onChange:d=>Ne(k(v({},B),{pricePerMeter:Je(d.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Rulon narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:ls(B.pricePerRoll),onChange:d=>Ne(k(v({},B),{pricePerRoll:Je(d.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Karobka narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:ls(B.pricePerBox),onChange:d=>Ne(k(v({},B),{pricePerBox:Je(d.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Kg narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:ls(B.pricePerKg),onChange:d=>Ne(k(v({},B),{pricePerKg:Je(d.target.value)}))})]})]})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 pt-3 sm:pt-4 sticky bottom-0 bg-white pb-safe -mx-4 sm:-mx-6 px-4 sm:px-6 border-t border-surface-200 mt-4 z-10",children:[e.jsx("button",{type:"button",onClick:rs,className:"btn-secondary flex-1 text-sm sm:text-base py-2.5 sm:py-3",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1 text-sm sm:text-base py-2.5 sm:py-3",disabled:!!V,children:"Saqlash"})]})]})]})]}),de&&ee&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>xe(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"QR Kod"}),e.jsx("button",{onClick:()=>xe(!1),className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border border-surface-200 mb-4",children:e.jsx(Qt,{id:"qr-code-svg",value:JSON.stringify({id:ee._id,code:ee.code,name:ee.name,price:ee.price}),size:200,level:"H",includeMargin:!0})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-semibold text-surface-900",children:ee.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",ee.code]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Oldingi narxi: ",b(ee.previousPrice||0)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Hozirgi narxi: ",b(ee.currentPrice||ee.price)," so'm"]})]}),e.jsxs("button",{onClick:Cs,className:"btn-primary w-full",children:[e.jsx(na,{className:"w-4 h-4"}),"Yuklab olish"]})]})]})]}),O&&ee&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>ke(!1)}),e.jsxs("div",{className:"modal w-full max-w-4xl p-6 relative z-10 max-h-[92vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Print sozlamalari"}),e.jsx("button",{onClick:()=>ke(!1),className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Printer tanlash"}),e.jsxs("select",{className:"input",value:x.printer,onChange:d=>pe(k(v({},x),{printer:d.target.value})),children:[e.jsx("option",{value:"",children:"Printer tanlang"}),we.map(d=>e.jsx("option",{value:d,children:d},d))]}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Print tugmasini bosganda Windows print dialog ochiladi va barcha mavjud printerlarni ko'rsatadi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Qog'oz o'lchami"}),e.jsxs("select",{className:"input",value:x.size,onChange:d=>pe(k(v({},x),{size:d.target.value})),children:[e.jsx("option",{value:"card",children:"Kichik yorliq (50Ã—25mm)"}),e.jsx("option",{value:"A4",children:"A4 (210Ã—297mm)"}),e.jsx("option",{value:"A5",children:"A5 (148Ã—210mm)"}),e.jsx("option",{value:"thermal",children:"Thermal (80Ã—120mm)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Shablon"}),e.jsxs("select",{className:"input",value:x.layout,onChange:d=>pe(k(v({},x),{layout:d.target.value})),children:[e.jsx("option",{value:"standard",children:"Standart (barcha ma'lumotlar)"}),e.jsx("option",{value:"minimal",children:"Minimal (faqat asosiy ma'lumotlar)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Nusxalar soni"}),e.jsx("input",{type:"number",min:"1",max:"10",className:"input",value:x.copies,onChange:d=>pe(k(v({},x),{copies:parseInt(d.target.value)||1}))})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4",children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Maxsus o'lcham (ixtiyoriy)"}),e.jsx("p",{className:"text-xs text-surface-500 mb-3",children:"Agar maxsus o'lcham belgilasangiz, u qog'oz o'lchamidan ustun bo'ladi"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-600 mb-1 block",children:"Eni (mm)"}),e.jsx("input",{type:"number",min:"1",className:"input",placeholder:"Masalan: 50",value:x.customWidth,onChange:d=>pe(k(v({},x),{customWidth:d.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-600 mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"number",min:"1",className:"input",placeholder:"Masalan: 25",value:x.customHeight,onChange:d=>pe(k(v({},x),{customHeight:d.target.value}))})]})]})]})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-surface-700 mb-3",children:"Ko'rinish"}),e.jsx("div",{className:"bg-white shadow-md rounded-xl p-6 flex justify-center items-start min-h-[420px]",children:e.jsx("div",{className:"bg-white border border-gray-200 shadow-lg rounded-xl",style:{width:x.customWidth&&x.customHeight?`${x.customWidth}mm`:x.size==="card"?"26mm":x.size==="thermal"?"48mm":x.size==="A4"?"80mm":x.size==="A5"?"140mm":"120mm",height:x.customWidth&&x.customHeight?`${x.customHeight}mm`:x.size==="card"?"17mm":x.size==="thermal"?"65mm":x.size==="A4"?"105mm":x.size==="A5"?"145mm":"140mm",fontSize:x.size==="card"?"5px":x.size==="thermal"?"9px":"11px",transform:x.size==="card"?"scale(4.2)":x.size==="thermal"?"scale(2.1)":"scale(1.8)",transformOrigin:"center center",overflow:"hidden",padding:x.size==="card"?"1.2mm":x.size==="thermal"?"7px":"12px",borderRadius:"8px",background:"#ffffff",marginTop:"80px"},children:e.jsxs("div",{className:"flex flex-col justify-between h-full",style:{gap:x.size==="card"?"2px":"4px"},children:[e.jsxs("div",{className:"flex flex-col justify-center items-center text-center",style:{flex:1},children:[e.jsxs("div",{className:"font-bold",style:{fontSize:x.size==="card"?"10px":x.size==="thermal"?"18px":"22px",lineHeight:"1.0",marginBottom:x.size==="card"?"0px":"1px",fontWeight:"800",color:"#d32f2f"},children:[b(ee.currentPrice||ee.price)," so'm"]}),e.jsxs("div",{className:"text-gray-600",style:{fontSize:x.size==="card"?"6px":x.size==="thermal"?"12px":"16px",lineHeight:"1.0",marginBottom:x.size==="card"?"0.5px":"1px",fontWeight:"500",color:"#666"},children:["Kod: ",ee.code]}),e.jsx("div",{className:"font-bold text-black",style:{fontSize:x.size==="card"?"7px":x.size==="thermal"?"14px":"18px",lineHeight:"1.1",marginBottom:x.size==="card"?"0.5px":"1px",fontWeight:"600",color:"#1a1a1a",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:x.size==="card"?1:2,WebkitBoxOrient:"vertical"},children:ee.name}),x.layout==="standard"&&e.jsxs("div",{className:"text-gray-500",style:{fontSize:x.size==="card"?"4px":x.size==="thermal"?"10px":"12px",lineHeight:"1.0",margin:0,color:"#888",fontWeight:"400"},children:["Miqdor: ",ee.quantity," | ",new Date().toLocaleDateString("uz-UZ")]})]}),e.jsx("div",{className:"flex justify-center items-center",style:{width:"100%",height:"auto",padding:"2px 0"},children:e.jsx("div",{style:{border:"1px solid #e2e8f0",borderRadius:"4px",background:"#ffffff",padding:"2px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Qt,{value:JSON.stringify({id:ee._id,code:ee.code,name:ee.name,price:ee.price}),size:x.size==="card"?60:x.size==="thermal"?120:140,level:"H",includeMargin:!1,style:{width:"100%",height:"100%",maxWidth:x.size==="card"?"60px":x.size==="thermal"?"120px":"140px",maxHeight:x.size==="card"?"60px":x.size==="thermal"?"120px":"140px",objectFit:"contain"}})})})]})})}),x.copies>1&&e.jsxs("p",{className:"text-xs text-surface-500 mt-2 text-center",children:[x.copies," nusxa chop etiladi"]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>ke(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsxs("button",{type:"button",onClick:Ns,className:"btn-primary flex-1",disabled:!x.printer,children:[e.jsx(et,{className:"w-4 h-4"}),"Print"]})]})]})]}),u&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>te(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:Pe==="add"?"Miqdor qo'shish":"Miqdor ayirish"}),e.jsx("button",{onClick:()=>te(!1),className:"btn-icon-sm",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${Pe==="add"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Hozirgi miqdor"}),e.jsxs("p",{className:`text-2xl font-bold ${Pe==="add"?"text-success-600":"text-danger-600"}`,children:[b(B.quantity||0)," dona"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:Pe==="add"?"Qo'shiladigan miqdor":"Ayiriladigan miqdor"}),e.jsx("input",{type:"text",className:"input text-center text-lg font-semibold",placeholder:"0",value:ls(le),onChange:d=>Be(Je(d.target.value)),autoFocus:!0})]}),le&&Number(le)>0&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Yangi miqdor"}),e.jsxs("p",{className:"text-xl font-bold text-surface-900",children:[b(Pe==="add"?(Number(B.quantity)||0)+Number(le):Math.max(0,(Number(B.quantity)||0)-Number(le)))," dona"]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>te(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"button",onClick:Ss,className:`flex-1 ${Pe==="add"?"btn-success":"btn-danger"}`,disabled:!le||Number(le)<=0,children:Pe==="add"?"Qo'shish":"Ayirish"})]})]})]})]}),ye&&Ke&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in",onClick:()=>Fe(!1),children:e.jsxs("div",{className:"relative max-w-6xl max-h-[90vh] w-full",children:[e.jsx("button",{onClick:()=>Fe(!1),className:"absolute -top-12 right-0 sm:right-0 w-10 h-10 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white transition-colors z-10",title:"Yopish (Esc)",children:e.jsx(be,{className:"w-6 h-6"})}),e.jsx("div",{className:"relative bg-white rounded-2xl overflow-hidden shadow-2xl",onClick:d=>d.stopPropagation(),children:e.jsx("img",{src:Ke,alt:"Mahsulot rasmi",className:"w-full h-auto max-h-[85vh] object-contain"})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-white/80 text-sm",children:"Yopish uchun rasmdan tashqariga bosing yoki ESC tugmasini bosing"})})]})})]})}function jn(){const{showAlert:t,AlertComponent:l}=vs(),[r,h]=s.useState({botToken:"",chatId:"",isEnabled:!1}),[n,g]=s.useState(null),[N,p]=s.useState(null),[P,$]=s.useState(""),[w,j]=s.useState(""),[M,T]=s.useState(!1),[D,c]=s.useState(!1),[z,S]=s.useState(!1);s.useEffect(()=>{q();const O=window.location.origin.replace("5175","3002");j(`${O}/api/telegram/webhook`)},[]);const q=()=>E(this,null,function*(){try{const O=yield F.get("/telegram/settings");h(O.data),O.data.botToken&&(f(),R())}catch(O){console.error("Error fetching telegram settings:",O)}}),f=()=>E(this,null,function*(){try{const O=yield F.get("/telegram/bot-info");g(O.data)}catch(O){console.error("Error fetching bot info:",O)}}),R=()=>E(this,null,function*(){try{const O=yield F.get("/telegram/webhook-info");p(O.data)}catch(O){console.error("Error fetching webhook info:",O)}}),W=()=>E(this,null,function*(){if(!w.trim()){t("Webhook URL ni kiriting","Xatolik","warning");return}S(!0);try{yield F.post("/telegram/set-webhook",{webhookUrl:w}),t("Webhook muvaffaqiyatli o'rnatildi","Muvaffaqiyat","success"),R()}catch(O){t("Webhook o'rnatishda xatolik","Xatolik","danger")}finally{S(!1)}}),J=()=>E(this,null,function*(){T(!0);try{yield F.post("/telegram/settings",r),t("Sozlamalar saqlandi","Muvaffaqiyat","success"),r.botToken&&f()}catch(O){t("Sozlamalarni saqlashda xatolik","Xatolik","danger")}finally{T(!1)}}),de=()=>E(this,null,function*(){if(!P.trim()){t("Test xabarini kiriting","Xatolik","warning");return}c(!0);try{yield F.post("/telegram/test",{message:P}),t("Test xabari yuborildi","Muvaffaqiyat","success"),$("")}catch(O){t("Xabar yuborishda xatolik","Xatolik","danger")}finally{c(!1)}}),xe=()=>{n!=null&&n.username&&(navigator.clipboard.writeText(`@${n.username}`),t("Bot username nusxalandi","Muvaffaqiyat","success"))};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[l,e.jsx(Fs,{title:"Telegram Sozlamalari"}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-4xl mx-auto",children:[n&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(or,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Bot Ma'lumotlari"}),e.jsx("p",{className:"text-surface-500",children:"Telegram bot holati"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-surface-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Bot nomi"}),e.jsx("p",{className:"font-medium text-surface-900",children:n.first_name})]}),e.jsx("div",{className:"bg-surface-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Username"}),e.jsxs("p",{className:"font-medium text-surface-900",children:["@",n.username]})]}),e.jsx("button",{onClick:xe,className:"btn-icon-sm hover:bg-surface-200",title:"Nusxalash",children:e.jsx(Na,{className:"w-4 h-4"})})]})})]}),e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-green-700 font-medium",children:"Bot faol"})]})})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-6",children:"Telegram Sozlamalari"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Bot Token"}),e.jsx("input",{type:"password",className:"input",placeholder:"Bot tokenini kiriting",value:r.botToken,onChange:O=>h(k(v({},r),{botToken:O.target.value}))}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"@BotFather dan olingan bot token"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Chat ID yoki Kanal Username"}),e.jsx("input",{type:"text",className:"input",placeholder:"@channel_name yoki -100xxxxxxxxx",value:r.chatId,onChange:O=>h(k(v({},r),{chatId:O.target.value}))}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Xabarlar yuboriladigan kanal yoki guruh"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"telegram-enabled",className:"w-4 h-4 text-brand-600 border-surface-300 rounded focus:ring-brand-500",checked:r.isEnabled,onChange:O=>h(k(v({},r),{isEnabled:O.target.checked}))}),e.jsx("label",{htmlFor:"telegram-enabled",className:"text-sm font-medium text-surface-700",children:"Telegram xabarlarini yoqish"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:J,disabled:M,className:"btn-primary",children:M?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 animate-spin"}),"Saqlanmoqda..."]}):"Saqlash"})})]})]}),n&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(ha,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Webhook Sozlamalari"}),e.jsx("p",{className:"text-surface-500",children:"Mijozlarga chek yuborish uchun"})]})]}),N&&e.jsxs("div",{className:"mb-4 p-3 bg-surface-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-surface-700",children:"Joriy webhook:"}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${N.url?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:N.url?"Faol":"O'rnatilmagan"})]}),N.url&&e.jsx("p",{className:"text-xs text-surface-500 break-all",children:N.url})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Webhook URL"}),e.jsx("input",{type:"text",className:"input",placeholder:"https://your-domain.com/api/telegram/webhook",value:w,onChange:O=>j(O.target.value)}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Server webhook URL manzili"})]}),e.jsx("button",{onClick:W,disabled:z||!w.trim(),className:"btn-secondary",children:z?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 animate-spin"}),"O'rnatilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ha,{className:"w-4 h-4"}),"Webhook O'rnatish"]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(Os,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Mijozlar uchun yo'riqnoma"}),e.jsx("p",{className:"text-surface-500",children:"Cheklar olish uchun"})]})]}),e.jsxs("div",{className:"space-y-4 text-sm text-surface-600",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Mijozlar qanday qilib chek oladi:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-4 text-blue-800",children:[e.jsxs("li",{children:["Telegram da ",e.jsxs("strong",{children:["@",(n==null?void 0:n.username)||"your_bot"]})," botini topish"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"/start"})," buyrug'ini yuborish"]}),e.jsx("li",{children:"Telefon raqamini yuborish (masalan: +998901234567)"}),e.jsx("li",{children:"Ro'yxatdan o'tgandan keyin barcha cheklar avtomatik keladi"})]})]}),e.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[e.jsx("h4",{className:"font-medium text-amber-900 mb-2",children:"Muhim:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4 text-amber-800",children:[e.jsx("li",{children:"Mijoz avval botga /start berishi kerak"}),e.jsx("li",{children:"Telefon raqam bazada mavjud bo'lishi kerak"}),e.jsx("li",{children:"Webhook to'g'ri sozlangan bo'lishi kerak"})]})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-6",children:"Test Xabar"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Test xabari"}),e.jsx("textarea",{className:"input",rows:3,placeholder:"Test xabarini kiriting...",value:P,onChange:O=>$(O.target.value)})]}),e.jsx("button",{onClick:de,disabled:D||!r.botToken||!r.chatId,className:"btn-secondary",children:D?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 animate-spin"}),"Yuborilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ya,{className:"w-4 h-4"}),"Test Xabar Yuborish"]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-4",children:"Sozlash Yo'riqnomasi"}),e.jsxs("div",{className:"space-y-4 text-sm text-surface-600",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"1. Bot yaratish:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Telegram da @BotFather ga murojaat qiling"}),e.jsx("li",{children:"/newbot buyrug'ini yuboring"}),e.jsx("li",{children:"Bot nomini va username ni kiriting"}),e.jsx("li",{children:"Olingan tokenni yuqoridagi maydonga kiriting"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"2. Kanal/Guruh sozlash:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Telegram da kanal yoki guruh yarating"}),e.jsx("li",{children:"Botni kanalga admin qilib qo'shing"}),e.jsx("li",{children:"Kanal username ini (@channel_name) yoki Chat ID ni kiriting"}),e.jsx("li",{children:"Barcha xodimlar kanalga obuna bo'lsin"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"3. Mijozlarga chek yuborish:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Webhook URL ni to'g'ri o'rnating"}),e.jsx("li",{children:"Mijozlar botga /start berib ro'yxatdan o'tsin"}),e.jsx("li",{children:"Kassa panelida mijoz tanlanganda chek avtomatik yuboriladi"}),e.jsx("li",{children:"Faqat ro'yxatdan o'tgan mijozlarga chek boradi"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"4. Xabar turlari:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Xarid cheklari (mijozlarga shaxsiy)"}),e.jsx("li",{children:"Yangi qarz qo'shilganda (admin kanaliga)"}),e.jsx("li",{children:"Qarz tasdiqlanganda (admin kanaliga)"}),e.jsx("li",{children:"To'lov qilinganida (admin kanaliga)"}),e.jsx("li",{children:"Kam qolgan mahsulotlar haqida (admin kanaliga)"})]})]})]})]})]})]})}function vn(){const[t,l]=s.useState(""),[r,h]=s.useState(""),[n,g]=s.useState(!1),[N,p]=s.useState(""),[P,$]=s.useState(!1),w=Es(),j=M=>E(this,null,function*(){M.preventDefault(),p(""),$(!0);try{const T=yield F.post("/kassa-auth/login",{username:t.trim(),password:r});if(T.data.success){T.data.token&&localStorage.setItem("token",T.data.token);const D={loggedIn:!0,timestamp:Date.now(),user:"kassa",username:T.data.data.username,sessionToken:T.data.data.sessionToken,expiresAt:T.data.data.expiresAt,locked:!0};localStorage.setItem("kassaLoggedIn",JSON.stringify(D)),window.history.replaceState(null,"","/kassa"),w("/kassa",{replace:!0})}else p(T.data.message||"Login yoki parol noto'g'ri")}catch(T){console.error("Login error:",T),p("Login yoki parol noto'g'ri")}finally{$(!1)}});return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(109, 40, 217, 0.15) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute top-1/4 right-1/4 w-64 h-64 rounded-full blur-2xl",style:{background:"radial-gradient(circle, rgba(6, 182, 212, 0.1) 0%, transparent 70%)"}})]}),e.jsxs("div",{className:"w-full max-w-sm relative z-10",children:[e.jsxs("div",{className:"text-center mb-6 animate-fade-up",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-4",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 8px 32px -8px rgba(6, 182, 212, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:e.jsx(ka,{className:"w-10 h-10 text-white"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-7 h-7 rounded-full flex items-center justify-center",style:{background:"linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",boxShadow:"0 2px 8px -2px rgba(34, 197, 94, 0.5)"},children:e.jsx(wt,{className:"w-3.5 h-3.5 text-white"})})]}),e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{background:"linear-gradient(135deg, #2e1065 0%, #5b21b6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Kassa Tizimi"}),e.jsx("p",{className:"font-medium",style:{color:"#71717a"},children:"Sardor Furnitura - Kassa Paneli"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full animate-pulse",style:{background:"#22c55e"}}),e.jsx("span",{className:"text-sm",style:{color:"#a1a1aa"},children:"Xavfsiz tizim"})]})]}),e.jsxs("div",{className:"rounded-2xl p-6 animate-fade-up",style:{background:"linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 20px 40px -12px rgba(109, 40, 217, 0.2)",backdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-1",style:{color:"#2e1065"},children:"Kassa tizimiga kirish"}),e.jsx("p",{style:{color:"#71717a"},children:"Hisobingiz bilan tizimga kiring"})]}),N&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)",border:"1px solid #fca5a5"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#ef4444"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#991b1b"},children:"Xatolik"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#b91c1c"},children:N})]})]})}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(Qs,{className:"w-3.5 h-3.5"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Qs,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:"text",placeholder:"Login",value:t,onChange:M=>l(M.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ys,{className:"w-3.5 h-3.5"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ys,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:n?"text":"password",placeholder:"Parol",value:r,onChange:M=>h(M.target.value),className:"w-full pl-10 pr-10 py-3 rounded-xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0}),e.jsx("button",{type:"button",onClick:()=>g(!n),className:"absolute inset-y-0 right-0 pr-3 flex items-center transition-colors",style:{color:"#a1a1aa"},children:n?e.jsx($t,{className:"w-4 h-4"}):e.jsx(Xs,{className:"w-4 h-4"})})]})]}),e.jsx("button",{type:"submit",disabled:P,className:"w-full text-white font-semibold py-3.5 px-4 rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 14px -2px rgba(6, 182, 212, 0.4)"},children:P?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Kirish..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Kirish"}),e.jsx(Gt,{className:"w-4 h-4 transition-transform group-hover:translate-x-1"})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"pt-4",style:{borderTop:"1px solid #ede9fe"},children:e.jsxs("div",{className:"rounded-xl p-4 mb-4",style:{background:"linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%)"},children:[e.jsx("p",{className:"font-medium text-sm mb-3",style:{color:"#5b21b6"},children:"Admin uchun:"}),e.jsx("a",{href:"/login",className:"inline-flex items-center justify-center gap-2 font-semibold transition-colors text-base underline decoration-2 underline-offset-4",style:{color:"#7c3aed"},children:e.jsx("span",{children:"Admin panel â†’"})})]})})})})]}),e.jsxs("div",{className:"text-center mt-6 animate-fade-up",children:[e.jsx("p",{className:"text-sm",style:{color:"#71717a"},children:"Â© 2025 Sardor Furnitura. Barcha huquqlar himoyalangan."}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-2 text-xs",style:{color:"#a1a1aa"},children:[e.jsx("span",{children:"Xavfsiz"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Professional"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Ishonchli"})]})]})]})]})}const Nn="http://localhost:8000/api",wn=(t,l)=>{const r={dona:{single:"dona",plural:"dona"},metr:{single:"metr",plural:"metr"},rulon:{single:"rulon",plural:"rulon"},karobka:{single:"quti",plural:"quti"},gram:{single:"gram",plural:"gram"},kg:{single:"kg",plural:"kg"},litr:{single:"litr",plural:"litr"}};return(r[t||"dona"]||r.dona).single};function yn(){var D,c,z;const{id:t}=cr(),l=Es(),[r,h]=s.useState(null),[n,g]=s.useState(!0),[N,p]=s.useState(""),[P,$]=s.useState(!1);s.useEffect(()=>{t&&w()},[t]),s.useEffect(()=>(P?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[P]);const w=()=>E(this,null,function*(){var S,q;try{const f=yield Sa.get(`${Nn}/products/public/${t}`);h(f.data)}catch(f){console.error("Error fetching product:",f),p(((q=(S=f.response)==null?void 0:S.data)==null?void 0:q.message)||"Mahsulot topilmadi")}finally{g(!1)}}),j=[{icon:ea,label:"Bosh sahifa",path:"/"},{icon:Ws,label:"Mahsulotlar",path:"/admin/products"},{icon:hs,label:"Kassa",path:"/admin/kassa"},{icon:Os,label:"Mijozlar",path:"/admin/customers"},{icon:Hs,label:"Qarzlar",path:"/admin/debts"},{icon:Wt,label:"Omborlar",path:"/admin/warehouses"},{icon:sa,label:"Hodimlar",path:"/admin/helpers"},{icon:Tt,label:"Statistika",path:"/admin/dashboard"},{icon:yt,label:"QR Scanner",path:"/helper/scanner"},{icon:_t,label:"Sozlamalar",path:"/admin/settings"}];if(n)return e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-brand-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-surface-600",children:"Yuklanmoqda..."})]})});if(N||!r)return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-surface-100 to-surface-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-red-100 to-red-200 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx(Oe,{className:"w-12 h-12 text-red-500"})}),e.jsx("h1",{className:"text-2xl font-bold text-surface-900 mb-3",children:"Mahsulot topilmadi"}),e.jsx("p",{className:"text-surface-500 mb-8",children:N||"Bu mahsulot mavjud emas yoki o'chirilgan"}),e.jsx("button",{onClick:()=>l("/"),className:"px-8 py-3.5 bg-gradient-to-r from-brand-500 to-brand-600 text-white rounded-2xl font-semibold hover:from-brand-600 hover:to-brand-700 transition-all shadow-lg shadow-brand-500/30",children:"Bosh sahifaga qaytish"})]})});const M=r.tierPrices&&(r.tierPrices.tier1||r.tierPrices.tier2||r.tierPrices.tier3),T=wn(r.unit);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-surface-100 to-white",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-lg border-b border-surface-200/50 sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-3 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>l(-1),className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center hover:bg-surface-200 transition-colors active:scale-95",children:e.jsx(wa,{className:"w-5 h-5 text-surface-700"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-base font-semibold text-surface-900 truncate",children:r.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",r.code]})]}),e.jsx("button",{onClick:()=>$(!0),className:"w-10 h-10 bg-brand-500 rounded-xl flex items-center justify-center hover:bg-brand-600 transition-colors active:scale-95 shadow-lg shadow-brand-500/30",children:e.jsx(kt,{className:"w-5 h-5 text-white"})})]})}),P&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] transition-opacity",onClick:()=>$(!1)}),e.jsxs("div",{className:"fixed top-0 right-0 bottom-0 w-80 max-w-[85vw] bg-white z-[100] shadow-2xl transform transition-transform",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-black text-white",children:"SF"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-brand-100 text-xs",children:"Mebel furniturasi"})]})]}),e.jsx("button",{onClick:()=>$(!1),className:"w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center hover:bg-white/30 transition-colors",children:e.jsx(be,{className:"w-5 h-5 text-white"})})]})}),e.jsxs("div",{className:"overflow-y-auto h-[calc(100vh-140px)] p-4",children:[e.jsx("div",{className:"space-y-1",children:j.map((S,q)=>{const f=S.icon;return e.jsxs("button",{onClick:()=>{l(S.path),$(!1)},className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-surface-50 transition-colors group",children:[e.jsx("div",{className:"w-11 h-11 bg-surface-100 rounded-xl flex items-center justify-center group-hover:bg-brand-50 group-hover:scale-110 transition-all",children:e.jsx(f,{className:"w-5 h-5 text-surface-600 group-hover:text-brand-600"})}),e.jsx("span",{className:"font-medium text-surface-900 group-hover:text-brand-600 transition-colors",children:S.label}),e.jsx(Xt,{className:"w-4 h-4 text-surface-300 ml-auto group-hover:text-brand-600 group-hover:translate-x-1 transition-all"})]},q)})}),e.jsxs("div",{className:"mt-6 p-4 bg-surface-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-surface-500 text-center mb-2",children:"QR kod orqali ko'rilmoqda"}),e.jsx("p",{className:"text-xs text-surface-400 text-center",children:new Date().toLocaleDateString("uz-UZ",{year:"numeric",month:"long",day:"numeric"})})]})]})]})]}),e.jsxs("div",{className:"max-w-lg mx-auto pb-8",children:[e.jsxs("div",{className:"relative",children:[r.images&&r.images.length>0?e.jsx("div",{className:"aspect-square bg-white",children:e.jsx("img",{src:`${Ts}${typeof r.images[0]=="string"?r.images[0]:r.images[0].path}`,alt:r.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-square bg-gradient-to-br from-brand-50 via-brand-100 to-indigo-100 flex items-center justify-center",children:e.jsx("div",{className:"w-24 h-24 bg-white/60 backdrop-blur rounded-3xl flex items-center justify-center shadow-xl",children:e.jsx(Oe,{className:"w-12 h-12 text-brand-500"})})}),e.jsx("div",{className:`absolute top-4 right-4 px-4 py-2 rounded-full text-sm font-bold shadow-lg ${r.quantity>10?"bg-gradient-to-r from-emerald-400 to-green-500 text-white":r.quantity>0?"bg-gradient-to-r from-amber-400 to-orange-400 text-white":"bg-gradient-to-r from-red-500 to-rose-500 text-white"}`,children:r.quantity>0?`âœ“ ${r.quantity} ${T} mavjud`:"âœ• Tugagan"})]}),e.jsxs("div",{className:"px-4 -mt-6 relative z-10 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-xl shadow-surface-200/50",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-surface-900 mb-1",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"px-2.5 py-1 bg-surface-100 rounded-lg text-xs font-mono text-surface-600",children:["#",r.code]}),e.jsx("span",{className:"px-2.5 py-1 bg-brand-50 text-brand-600 rounded-lg text-xs font-medium",children:T}),r.dimensions&&(r.dimensions.width||r.dimensions.height||r.dimensions.length)&&e.jsxs("span",{className:"px-2.5 py-1 bg-purple-50 text-purple-600 rounded-lg text-xs font-medium",children:["ðŸ“ ",[r.dimensions.width,r.dimensions.height,r.dimensions.length].filter(Boolean).join(" Ã— ")]})]}),r.description&&e.jsx("p",{className:"mt-3 text-sm text-surface-600 leading-relaxed",children:r.description})]}),e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 rounded-2xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-brand-100 text-sm mb-1",children:"Narxi"}),e.jsx("p",{className:"text-3xl font-black text-white",children:b(r.price)})]}),e.jsxs("span",{className:"text-brand-100 text-lg font-medium",children:["so'm/",T]})]})}),M&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center",children:e.jsx(dr,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"font-bold text-surface-900",children:"Chegirmali narxlar"})]}),e.jsxs("div",{className:"space-y-2",children:[((D=r.tierPrices)==null?void 0:D.tier1)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-emerald-50 to-green-50 rounded-xl border border-emerald-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center",children:e.jsx(Pt,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[r.tierPrices.tier1.minQuantity,"â€“",r.tierPrices.tier1.maxQuantity," ",T]}),e.jsxs("p",{className:"text-xs text-emerald-600 font-medium",children:[r.tierPrices.tier1.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-emerald-600",children:b(r.tierPrices.tier1.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",T]})]})]}),((c=r.tierPrices)==null?void 0:c.tier2)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(Pt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[r.tierPrices.tier2.minQuantity,"â€“",r.tierPrices.tier2.maxQuantity," ",T]}),e.jsxs("p",{className:"text-xs text-blue-600 font-medium",children:[r.tierPrices.tier2.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-blue-600",children:b(r.tierPrices.tier2.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",T]})]})]}),((z=r.tierPrices)==null?void 0:z.tier3)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-violet-50 rounded-xl border border-purple-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(Pt,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[r.tierPrices.tier3.minQuantity,"+ ",T]}),e.jsxs("p",{className:"text-xs text-purple-600 font-medium",children:[r.tierPrices.tier3.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-purple-600",children:b(r.tierPrices.tier3.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",T]})]})]})]}),e.jsx("p",{className:"mt-3 text-xs text-surface-400 text-center",children:"ðŸ’¡ Ko'proq olsangiz, arzonroq!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-surface-50 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-400 mb-1",children:[e.jsx(mr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"O'lchov"})]}),e.jsx("p",{className:"font-bold text-surface-900",children:T})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-400 mb-1",children:[e.jsx(xr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Kod"})]}),e.jsx("p",{className:"font-bold text-surface-900 font-mono",children:r.code})]})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-lg shadow-surface-200/30",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand-500 to-brand-600 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-500/30",children:e.jsx("span",{className:"text-2xl font-black text-white",children:"SF"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-surface-900 text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-sm text-surface-500",children:"Mebel furniturasi do'koni"})]}),e.jsx(Xt,{className:"w-5 h-5 text-surface-300"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-surface-100 space-y-3",children:[e.jsxs("a",{href:"tel:+998901234567",className:"flex items-center gap-3 text-surface-600 hover:text-brand-600 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(Qs,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"+998 90 123 45 67"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-surface-600",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(Et,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"Toshkent shahri"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-surface-600",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(it,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"09:00 - 18:00"})]})]})]}),e.jsxs("p",{className:"text-center text-xs text-surface-400 pt-4",children:["QR kod orqali ko'rilmoqda â€¢ ",new Date().toLocaleDateString("uz-UZ")]})]})]})]})}const kn=(t={})=>{const l=Es(),{threshold:r=80,edgeThreshold:h=30,disableOnInput:n=!0,fullScreenSwipe:g=!0}=t;s.useEffect(()=>{if(!(window.innerWidth<=768||"ontouchstart"in window))return;let p=0,P=0,$=0,w=0,j=!1,M=0;const T=z=>{const S=z.touches[0];if(p=S.clientX,P=S.clientY,$=p,w=P,M=Date.now(),j=!1,n){const q=z.target,f=q.closest('input, textarea, select, input[type="range"]'),R=q.closest('.modal, .overlay, [role="dialog"], .swal2-container, .dialog'),W=q.closest(".no-swipe"),J=q.closest(".overflow-auto, .overflow-scroll, .overflow-y-auto, .overflow-x-auto");if(f||R||W||J&&g&&!(p<=h))return}if(g)j=!0;else{const q=p<=h,f=p>=window.innerWidth-h;j=q||f}},D=z=>{if(!j)return;const S=z.touches[0];$=S.clientX,w=S.clientY;const q=$-p,f=w-P;if(Math.abs(f)>Math.abs(q)*1.5){j=!1;return}q>20&&Math.abs(f)<Math.abs(q)&&z.preventDefault()},c=z=>{if(!j)return;const S=z.changedTouches[0],q=S.clientX,f=S.clientY,R=q-p,W=f-P,J=Date.now()-M;if(Math.abs(W)>Math.abs(R)*1.5||Math.abs(R)<r)return;const xe=Math.abs(R)/J>.3;R>r||xe&&R>r*.6?requestAnimationFrame(()=>{l(-1)}):!g&&p>=window.innerWidth-h&&(R<-r||xe&&R<-r*.6)&&requestAnimationFrame(()=>{l(1)})};return window.addEventListener("touchstart",T,{passive:!0}),window.addEventListener("touchmove",D,{passive:!1}),window.addEventListener("touchend",c,{passive:!0}),()=>{window.removeEventListener("touchstart",T),window.removeEventListener("touchmove",D),window.removeEventListener("touchend",c)}},[l,r,h,n,g])},Sn=()=>(kn({threshold:80,edgeThreshold:30,disableOnInput:!0,fullScreenSwipe:!0}),null),Ut=({children:t,roles:l})=>{const{user:r,loading:h}=tt();return h?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Yuklanmoqda..."})]})}):r?l&&!l.includes(r.role)?e.jsx(Js,{to:"/"}):e.jsx(e.Fragment,{children:t}):e.jsx(Js,{to:"/login"})},Cn=({children:t})=>{const l=Es(),[r,h]=nt.useState(null);return nt.useEffect(()=>{document.body.classList.add("kassa-locked","kassa-protected"),(()=>{try{const w=localStorage.getItem("kassaLoggedIn");if(w){const j=JSON.parse(w);if(j.loggedIn&&j.user==="kassa"){const M=k(v({},j),{timestamp:Date.now()});localStorage.setItem("kassaLoggedIn",JSON.stringify(M)),h(!0),window.history.pushState(null,"",window.location.href);return}}h(!1),l("/kassa-login",{replace:!0})}catch(w){console.error("Kassa login check error:",w),h(!1),l("/kassa-login",{replace:!0})}})();const g=()=>{window.location.pathname.startsWith("/kassa")&&window.history.pushState(null,"",window.location.href)},N=w=>{if(window.location.pathname.startsWith("/kassa")&&!(w.key==="F5"||w.ctrlKey&&(w.key==="r"||w.key==="R"))&&w.key!=="F12"&&(w.altKey&&w.key==="F4"||w.ctrlKey&&w.key==="w"||w.ctrlKey&&w.key==="W"||w.ctrlKey&&w.key==="t"||w.ctrlKey&&w.key==="T"||w.ctrlKey&&w.shiftKey&&w.key==="I"||w.ctrlKey&&w.shiftKey&&w.key==="J"||w.ctrlKey&&w.key==="u"||w.ctrlKey&&w.key==="U"||w.ctrlKey&&w.key==="s"||w.ctrlKey&&w.key==="S"||w.ctrlKey&&w.key==="p"||w.ctrlKey&&w.key==="P"))return w.preventDefault(),w.stopPropagation(),alert("âš ï¸ Bu amal kassa tizimida taqiqlanadi!"),!1},p=w=>{if(window.location.pathname.startsWith("/kassa"))return w.preventDefault(),alert("âš ï¸ O'ng tugma kassa tizimida taqiqlanadi!"),!1},P=()=>{window.location.pathname.startsWith("/kassa")},$=()=>{document.hidden&&setTimeout(()=>{window.focus()},100)};return window.addEventListener("popstate",g),window.addEventListener("keydown",N,!0),window.addEventListener("contextmenu",p),window.addEventListener("beforeunload",P),document.addEventListener("visibilitychange",$),window.focus(),()=>{document.body.classList.remove("kassa-locked","kassa-protected"),window.removeEventListener("popstate",g),window.removeEventListener("keydown",N,!0),window.removeEventListener("contextmenu",p),window.removeEventListener("beforeunload",P),document.removeEventListener("visibilitychange",$)}},[l]),r===null?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Tekshirilmoqda..."})]})}):r?e.jsx(e.Fragment,{children:t}):null},qn=()=>{const{user:t,loading:l}=tt(),[r,h]=nt.useState(!0),[n,g]=nt.useState(!1);return nt.useEffect(()=>{E(es,null,function*(){var p;try{const P=new AbortController,$=setTimeout(()=>P.abort(),5e3),w=yield fetch("http://localhost:8000/api/auth/check-admin",{signal:P.signal,headers:{"Content-Type":"application/json"}});if(clearTimeout($),!w.ok)throw new Error(`HTTP error! status: ${w.status}`);const j=yield w.json();g(j.hasAdmin)}catch(P){console.error("Admin check error:",P),P.name==="AbortError"?console.warn("Admin check timeout - server javob bermadi"):(p=P.message)!=null&&p.includes("Failed to fetch")&&console.warn("Server bilan aloqa yo'q - localhost:8000 ishlamayapti"),g(!0)}finally{h(!1)}})},[]),l||r?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Yuklanmoqda..."})]})}):!n&&!t?e.jsx(Js,{to:"/register"}):t?t.role==="admin"?e.jsx(Js,{to:"/admin"}):t.role==="cashier"?e.jsx(Js,{to:"/kassa"}):e.jsx(Js,{to:"/helper"}):e.jsx(Js,{to:"/login"})};function Pn(){return e.jsx(Pr,{children:e.jsx(Cr,{children:e.jsxs(ur,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:[e.jsx(Sn,{}),e.jsxs(hr,{children:[e.jsx(Ge,{path:"/login",element:e.jsx(zr,{})}),e.jsx(Ge,{path:"/register",element:e.jsx(Mr,{})}),e.jsx(Ge,{path:"/kassa-login",element:e.jsx(vn,{})}),e.jsx(Ge,{path:"/product/:id",element:e.jsx(yn,{})}),e.jsx(Ge,{path:"/",element:e.jsx(qn,{})}),e.jsxs(Ge,{path:"/kassa",element:e.jsx(Cn,{children:e.jsx(mn,{})}),children:[e.jsx(Ge,{index:!0,element:e.jsx(hn,{})}),e.jsx(Ge,{path:"receipts",element:e.jsx(pn,{})}),e.jsx(Ge,{path:"clients",element:e.jsx(fn,{})}),e.jsx(Ge,{path:"debts",element:e.jsx(bn,{})}),e.jsx(Ge,{path:"products",element:e.jsx(gn,{})})]}),e.jsxs(Ge,{path:"/admin",element:e.jsx(Ut,{roles:["admin"],children:e.jsx(Qr,{})}),children:[e.jsx(Ge,{index:!0,element:e.jsx(Dr,{})}),e.jsx(Ge,{path:"kassa",element:e.jsx(Kt,{})}),e.jsx(Ge,{path:"kassa-pro",element:e.jsx(Kt,{})}),e.jsx(Ge,{path:"products",element:e.jsx(Gr,{})}),e.jsx(Ge,{path:"warehouses",element:e.jsx(Zr,{})}),e.jsx(Ge,{path:"customers",element:e.jsx(en,{})}),e.jsx(Ge,{path:"debts",element:e.jsx(fa,{})}),e.jsx(Ge,{path:"debt-approvals",element:e.jsx(sn,{})}),e.jsx(Ge,{path:"orders",element:e.jsx(tn,{})}),e.jsx(Ge,{path:"helpers",element:e.jsx(an,{})}),e.jsx(Ge,{path:"staff-receipts",element:e.jsx(ba,{})}),e.jsx(Ge,{path:"telegram-settings",element:e.jsx(jn,{})})]}),e.jsxs(Ge,{path:"/cashier",element:e.jsx(Ut,{roles:["cashier"],children:e.jsx(on,{})}),children:[e.jsx(Ge,{index:!0,element:e.jsx(Kt,{})}),e.jsx(Ge,{path:"debts",element:e.jsx(fa,{})}),e.jsx(Ge,{path:"staff-receipts",element:e.jsx(ba,{})})]}),e.jsx(Ge,{path:"/helper",element:e.jsx(Ut,{roles:["helper"],children:e.jsx(cn,{})}),children:e.jsx(Ge,{index:!0,element:e.jsx(dn,{})})})]})]})})})}pr.createRoot(document.getElementById("root")).render(e.jsx(nt.StrictMode,{children:e.jsx(Pn,{})}))});export default zn();
