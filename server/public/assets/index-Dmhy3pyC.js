const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/qrcode-vendor-DPnJAP0X.js","assets/vendor-B7oWd0tj.js"])))=>i.map(i=>d[i]);
var Ia=Object.defineProperty,_a=Object.defineProperties;var Ba=Object.getOwnPropertyDescriptors;var ma=Object.getOwnPropertySymbols;var Fa=Object.prototype.hasOwnProperty,Oa=Object.prototype.propertyIsEnumerable;var Yt=(t,n,r)=>n in t?Ia(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,g=(t,n)=>{for(var r in n||(n={}))Fa.call(n,r)&&Yt(t,r,n[r]);if(ma)for(var r of ma(n))Oa.call(n,r)&&Yt(t,r,n[r]);return t},j=(t,n)=>_a(t,Ba(n));var Ka=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);var $t=(t,n,r)=>Yt(t,typeof n!="symbol"?n+"":n,r);var Q=(t,n,r)=>new Promise((h,l)=>{var w=q=>{try{p(r.next(q))}catch(z){l(z)}},S=q=>{try{p(r.throw(q))}catch(z){l(z)}},p=q=>q.done?h(q.value):Promise.resolve(q.value).then(w,S);p((r=r.apply(t,n)).next())});import{r as s,j as e,u as _s,b as nt,U as ls,L as vs,E as rt,c as Ds,d as aa,B as Xa,S as Vs,P as Ls,M as Pt,X as Ne,N as Ua,e as lt,f as Ft,g as ba,h as us,i as Fe,k as Is,C as Es,l as ra,m as zt,n as Os,O as Ot,o as ja,p as Mt,q as bs,H as la,s as st,F as Hs,t as na,v as Vt,D as ns,T as ia,w as Ha,x as As,y as Gt,z as Ya,G as Dt,I as xt,J as Ts,K as oa,Q as Wa,V as Zt,W as ca,Y as Ja,Z as ut,_ as ft,$ as ms,a0 as zs,a1 as va,a2 as Gs,a3 as kt,a4 as Va,a5 as wa,a6 as ht,a7 as Ct,a8 as xa,a9 as At,aa as Kt,ab as Xs,ac as ea,ad as Lt,ae as Js,af as Ga,ag as ua,ah as Na,ai as Za,aj as er,ak as Rt,al as sr,am as ya,an as tr,ao as ka,ap as Sa,aq as ar,ar as Ws,as as rr,at as lr,au as nr,av as ha,aw as ir,ax as or,ay as cr,az as dr,aA as mr,aB as xr,aC as ur,aD as hr,aE as Ye,R as dt,aF as tt,aG as pr}from"./react-vendor-x18ucqhj.js";import{a as Ca}from"./http-vendor-DnTtldoj.js";import{R as fr,A as gr,C as br,X as jr,Y as vr,T as wr,a as Nr}from"./chart-vendor-DvBy4UFf.js";import{t as Xt,H as yr}from"./qrcode-vendor-DPnJAP0X.js";import"./vendor-B7oWd0tj.js";var Pl=Ka(Ze=>{(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))h(l);new MutationObserver(l=>{for(const w of l)if(w.type==="childList")for(const S of w.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&h(S)}).observe(document,{childList:!0,subtree:!0});function r(l){const w={};return l.integrity&&(w.integrity=l.integrity),l.referrerPolicy&&(w.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?w.credentials="include":l.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function h(l){if(l.ep)return;l.ep=!0;const w=r(l);fetch(l.href,w)}})();const at=class at{constructor(){$t(this,"isOnline",navigator.onLine);$t(this,"listeners",new Set);this.setupEventListeners()}static getInstance(){return at.instance||(at.instance=new at),at.instance}setupEventListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.notifyListeners()}),window.addEventListener("offline",()=>{this.isOnline=!1,this.notifyListeners()})}notifyListeners(){this.listeners.forEach(n=>n(this.isOnline))}getOnlineStatus(){return this.isOnline}addListener(n){return this.listeners.add(n),()=>this.listeners.delete(n)}static isServerOfflineError(n){if(!(n!=null&&n.response))return!1;const{status:r,data:h}=n.response;return r===503&&(h==null?void 0:h.offline)===!0}static getOfflineMessage(n){return this.isServerOfflineError(n)?n.response.data.message||"Server is currently offline. Please try again later.":"Network error occurred. Please check your connection."}};$t(at,"instance");let It=at;It.getInstance();const da="http://localhost:8000/api",kr="http://localhost:5173",qa=da,Ps=da.replace("/api",""),Ut=kr;console.log("API Base URL:",qa);console.log("Uploads URL:",Ps);console.log("Environment:","Production");console.log("envApiUrl:",da);const K=Ca.create({baseURL:qa,headers:{"Content-Type":"application/json"},timeout:6e4});K.interceptors.request.use(t=>{var r;const n=localStorage.getItem("token");return n&&(t.headers.Authorization=`Bearer ${n}`),(r=t.url)!=null&&r.includes("/products")&&(t.timeout=12e4),t.headers["Cache-Control"]="no-cache, no-store, must-revalidate",t.headers.Pragma="no-cache",t.headers.Expires="0",t});K.interceptors.response.use(t=>t,t=>{var n,r,h;return((n=t.response)==null?void 0:n.status)===304?(console.warn("304 Not Modified - cache muammosi, qayta urinish kerak"),Promise.reject(new Error("Cache error - please refresh"))):t.code==="ERR_NETWORK"||t.message==="Network Error"?(console.error("ðŸ”´ Server bilan aloqa yo'q - localhost:8000 ishlamayapti"),Promise.reject(new Error("Server bilan aloqa yo'q. Iltimos, serverni ishga tushiring."))):t.code==="ECONNREFUSED"?(console.error("ðŸ”´ Connection refused - server port 8000 da ishlamayapti"),Promise.reject(new Error("Server ishlamayapti. Iltimos, serverni ishga tushiring."))):It.isServerOfflineError(t)?(console.warn("Server is offline:",t.response.data.message),Promise.reject(t)):(((r=t.response)==null?void 0:r.status)===401&&(console.warn("401 Unauthorized - token yaroqsiz"),localStorage.removeItem("token"),window.location.pathname.includes("/login")||(window.location.href="/login")),t.code==="ECONNABORTED"&&console.error("â±ï¸ Request timeout:",(h=t.config)==null?void 0:h.url),Promise.reject(t))});const Pa=s.createContext(void 0),Sr=({children:t})=>{const[n,r]=s.useState(null),[h,l]=s.useState(!0);s.useEffect(()=>{localStorage.getItem("token")?((k=3,M=1e3)=>Q(Ze,null,function*(){var f,E;for(let c=0;c<k;c++)try{const R=yield K.get("/auth/me",{timeout:5e3});r(R.data),l(!1);return}catch(R){if(console.warn(`User fetch attempt ${c+1}/${k} failed:`,R.message),c===k-1||((f=R.response)==null?void 0:f.status)===401||((E=R.response)==null?void 0:E.status)===403){console.error("Failed to fetch user after retries, clearing token"),localStorage.removeItem("token"),l(!1);return}yield new Promise(P=>setTimeout(P,M*(c+1)))}}))():l(!1)},[]);const w=(z,y)=>Q(Ze,null,function*(){const k=yield K.post("/auth/login",{phone:z,password:y});localStorage.setItem("token",k.data.token),r(k.data.user)}),S=(z,y)=>Q(Ze,null,function*(){const k=yield K.post("/auth/login",{login:z,password:y});localStorage.setItem("token",k.data.token),r(k.data.user)}),p=()=>{localStorage.removeItem("token"),r(null)},q=z=>{r(z)};return e.jsx(Pa.Provider,{value:{user:n,loading:h,login:w,loginWithCredentials:S,logout:p,updateUser:q},children:t})},Zs=()=>{const t=s.useContext(Pa);if(!t)throw new Error("useAuth must be used within AuthProvider");return t},za=s.createContext(void 0),Cr={uz:{"login.title":"Sardorbek.Furnetura","login.subtitle":"Professional Biznes Boshqaruv Tizimi","login.secure":"Xavfsiz va Ishonchli","login.welcome":"Xush kelibsiz","login.description":"Davom etish uchun hisobingizga kiring","login.phone":"Telefon raqam","login.password":"Parol","login.passwordPlaceholder":"Parolingizni kiriting","login.signing":"Kirilmoqda...","login.signin":"Kirish","login.error":"Kirish xatosi","sidebar.statistics":"Statistika","sidebar.products":"Tovarlar","sidebar.warehouses":"Omborlar","sidebar.customers":"Mijozlar","sidebar.debts":"Qarz daftarcha","sidebar.orders":"Buyurtmalar","sidebar.helpers":"Yordamchilar","sidebar.settings":"Sozlamalar","sidebar.pos":"Kassa (POS)","sidebar.receipts":"Xodimlar cheklari","sidebar.aiAssistant":"AI Yordamchi","sidebar.signout":"Chiqish","sidebar.editProfile":"Profilni tahrirlash","sidebar.fullName":"To'liq ism","sidebar.namePlaceholder":"Ismingizni kiriting","sidebar.phoneNumber":"Telefon raqam","sidebar.newPassword":"Yangi parol (Ixtiyoriy)","sidebar.passwordHint":"Joriy parolni saqlash uchun bo'sh qoldiring","sidebar.cancel":"Bekor qilish","sidebar.saveChanges":"O'zgarishlarni saqlash","dashboard.title":"Statistika paneli","dashboard.overview":"Biznes ko'rsatkichlari","dashboard.description":"Biznesingizning ishlashi va asosiy ko'rsatkichlarini kuzating","dashboard.totalRevenue":"Umumiy daromad","dashboard.todaySales":"Bugungi savdo","dashboard.weeklySales":"Haftalik savdo","dashboard.totalOrders":"Jami buyurtmalar","dashboard.peakHour":"Eng yuqori soat","dashboard.today":"Bugun","dashboard.thisWeek":"Bu hafta","dashboard.refresh":"Ma'lumotlarni yangilash","dashboard.totalProducts":"Jami mahsulotlar","dashboard.lowStock":"Kam qolgan","dashboard.outOfStock":"Tugagan","dashboard.inventoryStatus":"Ombor holati","dashboard.currentStock":"Joriy zaxira ko'rinishi","dashboard.liveData":"Jonli ma'lumotlar","header.search":"Qidirish...","header.live":"Jonli","common.loading":"Yuklanmoqda...","common.error":"Xatolik yuz berdi","common.success":"Muvaffaqiyatli","common.save":"Saqlash","common.cancel":"Bekor qilish","common.delete":"O'chirish","common.edit":"Tahrirlash","common.add":"Qo'shish","common.close":"Yopish"}},qr=({children:t})=>{const[n,r]=s.useState("uz");s.useEffect(()=>{document.documentElement.lang="uz"},[]);const h=l=>Cr.uz[l]||l;return e.jsx(za.Provider,{value:{language:n,setLanguage:r,t:h},children:t})},Ht=()=>{const t=s.useContext(za);if(t===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return t};function Pr(){var c;const[t,n]=s.useState(""),[r,h]=s.useState(""),[l,w]=s.useState(!1),[S,p]=s.useState(""),[q,z]=s.useState(!1),{loginWithCredentials:y}=Zs(),k=_s(),f=(c=nt().state)==null?void 0:c.message,E=R=>Q(this,null,function*(){var P,C;R.preventDefault(),p(""),z(!0);try{yield y(t,r);const _=(yield K.get("/auth/me")).data;_.role==="admin"?k("/admin",{replace:!0}):_.role==="cashier"?k("/kassa",{replace:!0}):_.role==="helper"?k("/helper",{replace:!0}):k("/",{replace:!0})}catch(v){p(((C=(P=v.response)==null?void 0:P.data)==null?void 0:C.message)||"Login yoki parol noto'g'ri"),z(!1)}});return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(109, 40, 217, 0.15) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute top-1/4 right-1/4 w-64 h-64 rounded-full blur-2xl",style:{background:"radial-gradient(circle, rgba(6, 182, 212, 0.1) 0%, transparent 70%)"}})]}),e.jsxs("div",{className:"w-full max-w-sm relative z-10",children:[e.jsxs("div",{className:"text-center mb-6 animate-fade-up",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{background:"linear-gradient(135deg, #2e1065 0%, #5b21b6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Sardor Furnitura"}),e.jsx("p",{className:"font-medium",style:{color:"#71717a"},children:"Admin boshqaruv tizimi"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full animate-pulse",style:{background:"#22c55e"}}),e.jsx("span",{className:"text-sm",style:{color:"#a1a1aa"},children:"Xavfsiz kirish"})]})]}),e.jsxs("div",{className:"rounded-2xl p-6 animate-fade-up",style:{background:"linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 20px 40px -12px rgba(109, 40, 217, 0.2)",backdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-1",style:{color:"#2e1065"},children:"Xush kelibsiz!"}),e.jsx("p",{style:{color:"#71717a"},children:"Login va parolingizni kiriting"})]}),f&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)",border:"1px solid #86efac"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#22c55e"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"âœ“"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#166534"},children:"Muvaffaqiyat"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#15803d"},children:f})]})]})}),S&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)",border:"1px solid #fca5a5"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#ef4444"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#991b1b"},children:"Xatolik"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#b91c1c"},children:S})]})]})}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ls,{className:"w-3.5 h-3.5"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ls,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:"text",placeholder:"Loginingizni kiriting",value:t,onChange:R=>n(R.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl transition-all duration-200 focus:outline-none text-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(vs,{className:"w-3.5 h-3.5"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(vs,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:l?"text":"password",placeholder:"Parolingizni kiriting",value:r,onChange:R=>h(R.target.value),className:"w-full pl-10 pr-10 py-3 rounded-xl transition-all duration-200 focus:outline-none text-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0}),e.jsx("button",{type:"button",onClick:()=>w(!l),className:"absolute inset-y-0 right-0 pr-3 flex items-center transition-colors",style:{color:"#a1a1aa"},children:l?e.jsx(rt,{className:"w-4 h-4"}):e.jsx(Ds,{className:"w-4 h-4"})})]})]}),e.jsx("button",{type:"submit",disabled:q,className:"w-full text-white font-semibold py-3.5 px-4 rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 14px -2px rgba(124, 58, 237, 0.4)"},children:q?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Kirish..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Kirish"}),e.jsx(aa,{className:"w-4 h-4 transition-transform group-hover:translate-x-1"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("div",{className:"p-3 rounded-xl",style:{background:"linear-gradient(135deg, #cffafe 0%, #a5f3fc 100%)",border:"1px solid rgba(6, 182, 212, 0.3)"},children:[e.jsx("p",{className:"text-xs font-medium mb-1",style:{color:"#155e75"},children:"Kassa paneli:"}),e.jsx("button",{onClick:()=>k("/kassa-login"),className:"text-sm font-semibold underline transition-colors",style:{color:"#0891b2"},children:"Kassa tizimiga kirish â†’"})]})})]}),e.jsxs("div",{className:"text-center mt-6 animate-fade-up",children:[e.jsx("p",{className:"text-sm",style:{color:"#71717a"},children:"Â© 2025 Sardor Furnitura. Barcha huquqlar himoyalangan."}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-2 text-xs",style:{color:"#a1a1aa"},children:[e.jsx("span",{children:"Xavfsiz"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Professional"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Ishonchli"})]})]})]})]})}const b=t=>{const n=typeof t=="string"?parseFloat(t):t;return isNaN(n)?"0":n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},We=t=>t.replace(/\./g,""),rs=t=>{const n=t.replace(/\./g,"");if(n===""||n==="-")return n;const r=parseFloat(n);return isNaN(r)?"":b(r)},pt=t=>{let r=t.replace(/\D/g,"");return!r.startsWith("998")&&r.length>0&&(r="998"+r),r=r.slice(0,12),r.length===0?"":r.length<=3?"+"+r:r.length<=5?"+998 ("+r.slice(3):r.length<=8?"+998 ("+r.slice(3,5)+") "+r.slice(5):r.length<=10?"+998 ("+r.slice(3,5)+") "+r.slice(5,8)+"-"+r.slice(8):"+998 ("+r.slice(3,5)+") "+r.slice(5,8)+"-"+r.slice(8,10)+"-"+r.slice(10)},Qt=t=>t.replace(/\D/g,""),Ma=t=>{if(!t)return"";const n=t.replace(/\D/g,"");return n.length!==12?t:"+998 ("+n.slice(3,5)+") "+n.slice(5,8)+"-"+n.slice(8,10)+"-"+n.slice(10)};function zr(){const[t,n]=s.useState({name:"",login:"",phone:"",password:"",confirmPassword:""}),[r,h]=s.useState(!1),[l,w]=s.useState(!1),[S,p]=s.useState(""),[q,z]=s.useState(!1),{t:y}=Ht(),k=_s(),M=E=>{const c=pt(E.target.value);n(R=>j(g({},R),{phone:c}))},f=E=>Q(this,null,function*(){var c,R;if(E.preventDefault(),p(""),z(!0),t.password!==t.confirmPassword){p("Parollar mos kelmaydi"),z(!1);return}if(t.password.length<6){p("Parol kamida 6 ta belgidan iborat bo'lishi kerak"),z(!1);return}try{const P=Qt(t.phone);yield K.post("/auth/register",{name:t.name,login:t.login,phone:P,password:t.password}),k("/login",{state:{message:"Admin muvaffaqiyatli yaratildi! Endi tizimga kirishingiz mumkin."}})}catch(P){p(((R=(c=P.response)==null?void 0:c.data)==null?void 0:R.message)||"Xatolik yuz berdi")}finally{z(!1)}});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 bg-gradient-to-br from-blue-400/20 to-indigo-600/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-indigo-400/20 to-purple-600/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-gradient-to-r from-blue-300/10 to-indigo-400/10 rounded-full blur-2xl"})]}),e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23e2e8f0%22%20fill-opacity%3D%220.3%22%3E%3Ccircle%20cx%3D%2230%22%20cy%3D%2230%22%20r%3D%221.5%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-40"}),e.jsxs("div",{className:"w-full max-w-md relative z-10",children:[e.jsxs("div",{className:"text-center mb-8 animate-fade-up",children:[e.jsxs("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-3xl shadow-2xl shadow-blue-500/25 mb-6 relative",children:[e.jsx(Xa,{className:"w-10 h-10 text-white"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center",children:e.jsx(Vs,{className:"w-3 h-3 text-white"})})]}),e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-slate-900 via-blue-900 to-indigo-900 bg-clip-text text-transparent mb-3",children:y("login.title")}),e.jsx("p",{className:"text-slate-600 text-lg font-medium",children:y("login.subtitle")}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-slate-500",children:y("login.secure")})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/20 animate-fade-up",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Ro'yxatdan o'tish"}),e.jsx("p",{className:"text-slate-600",children:"Admin hisobini yaratish uchun ma'lumotlarni kiriting"})]}),S&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-4 mb-6 animate-fade-in",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-red-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium text-sm",children:"Xatolik"}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:S})]})]})}),e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4"}),"To'liq ism"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(ls,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"text",placeholder:"Ismingizni kiriting",value:t.name,onChange:E=>n(c=>j(g({},c),{name:E.target.value})),className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(ls,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"text",placeholder:"Login kiriting (masalan: admin123)",value:t.login,onChange:E=>n(c=>j(g({},c),{login:E.target.value})),className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(Ls,{className:"w-4 h-4"}),"Telefon raqam"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(Ls,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"tel",placeholder:"+998 (XX) XXX-XX-XX",value:t.phone,onChange:M,className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(vs,{className:"w-4 h-4"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(vs,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:r?"text":"password",placeholder:"Parolingizni kiriting",value:t.password,onChange:E=>n(c=>j(g({},c),{password:E.target.value})),className:"w-full pl-12 pr-12 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!r),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 transition-colors",children:r?e.jsx(rt,{className:"w-5 h-5"}):e.jsx(Ds,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(vs,{className:"w-4 h-4"}),"Parolni tasdiqlash"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(vs,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:l?"text":"password",placeholder:"Parolni qayta kiriting",value:t.confirmPassword,onChange:E=>n(c=>j(g({},c),{confirmPassword:E.target.value})),className:"w-full pl-12 pr-12 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0}),e.jsx("button",{type:"button",onClick:()=>w(!l),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 transition-colors",children:l?e.jsx(rt,{className:"w-5 h-5"}):e.jsx(Ds,{className:"w-5 h-5"})})]})]}),e.jsx("button",{type:"submit",disabled:q,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold py-4 px-6 rounded-2xl shadow-lg shadow-blue-500/25 transition-all duration-200 hover:from-blue-700 hover:to-indigo-700 hover:shadow-xl hover:shadow-blue-500/30 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",children:q?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Ro'yxatdan o'tilmoqda..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{children:"Ro'yxatdan o'tish"}),e.jsx(aa,{className:"w-5 h-5 transition-transform group-hover:translate-x-1"})]})})]})]})]})]})}function $a({items:t,basePath:n,collapsed:r=!1,setCollapsed:h}){var E;const{user:l,logout:w,updateUser:S}=Zs(),{t:p}=Ht(),[q,z]=s.useState(!1),[y,k]=s.useState({name:"",phone:"",password:""}),M=()=>{k({name:(l==null?void 0:l.name)||"",phone:(l==null?void 0:l.phone)||"",password:""}),z(!0)},f=c=>Q(this,null,function*(){var R,P;c.preventDefault();try{const C={name:y.name,phone:y.phone};y.password&&(C.password=y.password);const v=yield K.put("/auth/profile",C);S(v.data),z(!1)}catch(C){alert(((P=(R=C.response)==null?void 0:R.data)==null?void 0:P.message)||"Xatolik yuz berdi")}});return e.jsxs("aside",{className:`fixed left-0 top-0 h-full transition-all duration-300 ease-in-out z-50 ${r?"w-16":"w-64"}`,style:{background:"linear-gradient(180deg, #2e1065 0%, #4c1d95 100%)",borderRight:"1px solid rgba(6, 182, 212, 0.2)",boxShadow:"4px 0 24px -4px rgba(46, 16, 101, 0.3)"},children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-4",style:{borderBottom:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, transparent 100%)"},children:[!r&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center overflow-hidden",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-lg text-white tracking-wide",style:{fontFamily:"'Playfair Display', serif",letterSpacing:"0.5px"},children:"Sardor"}),e.jsx("p",{className:"text-sm font-semibold tracking-wider",style:{color:"#c4b5fd",fontFamily:"'Montserrat', sans-serif",letterSpacing:"1.5px"},children:"FURNITURA"})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:()=>h==null?void 0:h(!r),className:"p-2 rounded-xl transition-all duration-200",style:{background:"rgba(255, 255, 255, 0.1)",color:"#c4b5fd"},children:r?e.jsx(Pt,{className:"w-4 h-4"}):e.jsx(Ne,{className:"w-4 h-4"})})})]}),e.jsx("nav",{className:"p-3 space-y-1.5 overflow-y-auto h-[calc(100vh-180px)]",children:t.map((c,R)=>e.jsxs(Ua,{to:`${n}${c.path}`,end:c.path==="",className:({isActive:P})=>`
              flex items-center gap-3 px-3 py-3 rounded-xl font-medium transition-all duration-200 group
              ${r?"justify-center px-2":""}
            `,style:({isActive:P})=>({background:P?"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)":"transparent",color:P?"#ffffff":"#c4b5fd",boxShadow:P?"0 4px 12px -2px rgba(6, 182, 212, 0.4)":"none"}),title:r?c.label:void 0,children:[e.jsx("span",{className:"flex-shrink-0 transition-transform group-hover:scale-110",children:c.icon}),!r&&e.jsx("span",{className:"truncate text-sm",children:p(c.label)})]},R))}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3",style:{borderTop:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.2) 100%)"},children:[!r&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5 mb-2 rounded-xl",style:{background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(6, 182, 212, 0.15)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{background:"linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%)"},children:e.jsx("span",{className:"text-sm font-bold text-white",children:(E=l==null?void 0:l.name)==null?void 0:E.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-white truncate",children:l==null?void 0:l.name}),e.jsx("p",{className:"text-xs capitalize font-medium",style:{color:"#a78bfa"},children:l==null?void 0:l.role})]}),(l==null?void 0:l.role)==="admin"&&e.jsx("button",{onClick:M,className:"p-1.5 rounded-lg transition-all duration-200",style:{background:"rgba(6, 182, 212, 0.2)",color:"#67e8f9"},title:"Profilni tahrirlash",children:e.jsx(lt,{className:"w-3.5 h-3.5"})})]}),e.jsxs("button",{onClick:w,className:`flex items-center gap-2 w-full px-3 py-2.5 rounded-xl transition-all duration-200 font-medium text-sm ${r?"justify-center px-2":""}`,style:{color:"#fca5a5"},title:r?"Sign Out":void 0,children:[e.jsx(Ft,{className:"w-4 h-4"}),!r&&e.jsx("span",{children:p("sidebar.signout")})]})]}),q&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60]",onClick:()=>z(!1)}),e.jsx("div",{className:"fixed inset-0 z-[200] flex items-end sm:items-center justify-center p-0 sm:p-4 pointer-events-none",children:e.jsxs("div",{className:"w-full sm:w-auto max-w-md p-4 sm:p-8 rounded-t-3xl sm:rounded-3xl flex flex-col max-h-[90vh] overflow-hidden pointer-events-auto",style:{background:"linear-gradient(145deg, #ffffff 0%, #faf5ff 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 25px 50px -12px rgba(46, 16, 101, 0.35)"},children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between mb-4 sm:mb-8 pb-4 sm:pb-0 border-b border-surface-100 sm:border-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold truncate",style:{color:"#2e1065"},children:p("sidebar.editProfile")}),e.jsx("button",{onClick:()=>z(!1),className:"flex-shrink-0 p-2 rounded-xl transition-all",style:{background:"#f5f3ff",color:"#7c3aed"},children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:f,className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ls,{className:"w-4 h-4"}),p("sidebar.fullName")]}),e.jsxs("div",{className:"relative",children:[e.jsx(ls,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"text",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:p("sidebar.namePlaceholder"),value:y.name,onChange:c=>k(j(g({},y),{name:c.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(Ls,{className:"w-4 h-4"}),p("sidebar.phoneNumber")]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ls,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"tel",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:"+998 (XX) XXX-XX-XX",value:y.phone,onChange:c=>k(j(g({},y),{phone:pt(c.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(vs,{className:"w-4 h-4"}),p("sidebar.newPassword")]}),e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"password",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:p("sidebar.passwordHint"),value:y.password,onChange:c=>k(j(g({},y),{password:c.target.value}))})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>z(!1),className:"flex-1 px-6 py-3.5 font-semibold rounded-2xl transition-all duration-200",style:{background:"#f5f3ff",color:"#7c3aed"},children:p("sidebar.cancel")}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3.5 text-white font-semibold rounded-2xl transition-all duration-200",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 14px -2px rgba(124, 58, 237, 0.4)"},children:p("sidebar.saveChanges")})]})]})})]})})]})]})}const Mr=[{icon:e.jsx(ba,{className:"w-5 h-5"}),label:"sidebar.statistics",path:""},{icon:e.jsx(us,{className:"w-5 h-5"}),label:"sidebar.pos",path:"/kassa"},{icon:e.jsx(Fe,{className:"w-5 h-5"}),label:"sidebar.products",path:"/products"},{icon:e.jsx(Is,{className:"w-5 h-5"}),label:"sidebar.customers",path:"/customers"},{icon:e.jsx(Es,{className:"w-5 h-5"}),label:"sidebar.debts",path:"/debts"},{icon:e.jsx(ra,{className:"w-5 h-5"}),label:"sidebar.helpers",path:"/helpers"},{icon:e.jsx(zt,{className:"w-5 h-5"}),label:"sidebar.settings",path:"/settings"}],$r=[{icon:e.jsx(us,{className:"w-5 h-5"}),label:"sidebar.pos",path:""},{icon:e.jsx(Es,{className:"w-5 h-5"}),label:"sidebar.debts",path:"/debts"}];function Tr(){const t=nt(),n=_s(),r=[{path:"/admin",icon:ba,label:"Bosh sahifa",exact:!0},{path:"/admin/kassa",icon:us,label:"Kassa"},{path:"/admin/products",icon:Fe,label:"Tovarlar"},{path:"/admin/debts",icon:Os,label:"Qarzlar"},{path:"/admin/settings",icon:zt,label:"Sozlamalar"}],h=(l,w)=>w?t.pathname===l:t.pathname.startsWith(l);return e.jsxs("nav",{className:"lg:hidden fixed bottom-0 left-0 right-0 bg-slate-100/80 backdrop-blur-2xl border-t border-slate-200/60 z-50 shadow-[0_-4px_20px_-4px_rgba(0,0,0,0.1)]",children:[e.jsx("div",{className:"grid grid-cols-5 h-[72px] max-w-lg mx-auto",children:r.map(l=>{const w=l.icon,S=h(l.path,l.exact);return e.jsxs("button",{onClick:()=>n(l.path),className:`relative flex flex-col items-center justify-center gap-0.5 transition-all duration-300 ${S?"text-blue-600":"text-slate-400 active:text-slate-600"}`,children:[S&&e.jsx("div",{className:"absolute -top-0.5 left-1/2 -translate-x-1/2 w-8 h-1 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full"}),e.jsx("div",{className:`p-2 rounded-2xl transition-all duration-300 ${S?"bg-gradient-to-br from-blue-50 to-indigo-50 shadow-sm":"hover:bg-slate-50"}`,children:e.jsx(w,{className:`w-5 h-5 transition-all duration-300 ${S?"scale-110 text-blue-600":""}`})}),e.jsx("span",{className:`text-[10px] font-semibold transition-all duration-300 ${S?"text-blue-600":"text-slate-500"}`,children:l.label})]},l.path)})}),e.jsx("div",{className:"h-safe-area-inset-bottom bg-slate-100/80"})]})}function Rr(){const[t,n]=s.useState(!1);return e.jsxs("div",{className:"min-h-screen",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx($a,{items:Mr,basePath:"/admin",collapsed:t,setCollapsed:n})}),e.jsx("main",{className:`
        transition-all duration-300 ease-smooth
        lg:ml-64
        ${t?"lg:ml-[72px]":"lg:ml-64"}
        
        /* Mobile bottom navigation space */
        2xs:pb-[88px] xs:pb-[88px] sm:pb-[88px] md:pb-0
        
        /* Responsive min-height */
        min-h-screen
      `,children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(Ot,{})})}),e.jsx(Tr,{})]})}function Qr(){const t=_s(),[n,r]=s.useState(0);s.useEffect(()=>{h();const w=setInterval(h,3e4);return()=>clearInterval(w)},[]);const h=()=>Q(this,null,function*(){try{const w=yield K.get("/debts?status=pending_approval");r(w.data.length)}catch(w){console.error("Error fetching pending debts count:",w)}}),l=()=>{t("/admin/debt-approvals")};return n===0?null:e.jsx("div",{className:"relative",children:e.jsxs("button",{onClick:l,className:"relative p-2 rounded-xl bg-amber-100 text-amber-600 hover:bg-amber-200 transition-colors",title:`${n} ta qarz tasdiqlashni kutmoqda`,children:[e.jsx(ja,{className:"w-5 h-5"}),n>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold",children:n>9?"9+":n})]})})}function Ks({title:t,showSearch:n,onSearch:r,actions:h,filterOptions:l,filterValue:w,onFilterChange:S}){const[p,q]=s.useState(""),[z,y]=s.useState(!1),[k,M]=s.useState(!1),f=s.useRef(null),{t:E}=Ht(),{user:c,logout:R}=Zs(),P=_s(),C=(c==null?void 0:c.role)==="admin",v=()=>{window.confirm("Tizimdan chiqmoqchimisiz?")&&(R(),P("/login"))};s.useEffect(()=>(z?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[z]),s.useEffect(()=>{k&&f.current&&f.current.focus()},[k]);const _=B=>{q(B),r==null||r(B)},X=[{icon:la,label:"Bosh sahifa",path:"/"},{icon:st,label:"Mahsulotlar",path:"/admin/products"},{icon:us,label:"Kassa",path:"/admin/kassa"},{icon:Is,label:"Mijozlar",path:"/admin/customers"},{icon:Hs,label:"Qarzlar",path:"/admin/debts"},{icon:Os,label:"Cheklar",path:"/admin/staff-receipts"},{icon:na,label:"Hodimlar",path:"/admin/helpers"}];return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"sticky top-0 z-50 bg-slate-100 border-b border-slate-200/60 shadow-sm",children:e.jsxs("div",{className:"px-1.5 sm:px-3 md:px-4 lg:px-6 h-10 sm:h-12 md:h-14 flex items-center justify-between gap-1 sm:gap-2 md:gap-3 lg:gap-4",children:[e.jsx("button",{onClick:()=>y(!0),className:"lg:hidden p-0.5 rounded bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-colors active:scale-95 flex-shrink-0 flex items-center justify-center",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Menyuni ochish",children:e.jsx(Pt,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1.5 md:gap-2 lg:gap-3 flex-shrink-0",children:[l&&l.length>0&&e.jsxs("div",{className:"relative hidden sm:block",children:[e.jsx("select",{value:w,onChange:B=>S==null?void 0:S(B.target.value),className:"appearance-none pl-2 sm:pl-3 pr-6 sm:pr-8 py-1.5 sm:py-2 bg-slate-50 border border-slate-200 rounded-lg text-xs sm:text-sm font-medium text-slate-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 cursor-pointer transition-all duration-200",children:l.map(B=>e.jsx("option",{value:B.value,children:B.label},B.value))}),e.jsx(Mt,{className:"absolute right-1.5 sm:right-2 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-400 pointer-events-none"})]}),n&&e.jsx("button",{onClick:()=>M(!k),className:"flex items-center justify-center p-0.5 rounded bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Qidirish",children:e.jsx(bs,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),C?e.jsx(Qr,{}):e.jsxs("button",{className:"relative p-0.5 sm:p-1.5 md:p-2 rounded-md sm:rounded-lg bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-all duration-200 flex-shrink-0 flex items-center justify-center",children:[e.jsx(ja,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-1.5 sm:w-2 h-1.5 sm:h-2 bg-red-500 rounded-full"})]}),e.jsx("button",{onClick:()=>P("/admin/settings"),className:"hidden sm:flex items-center justify-center p-1.5 md:p-2 rounded-lg bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-all duration-200 flex-shrink-0",children:e.jsx(zt,{className:"w-4 h-4"})}),h]})]})}),n&&k&&e.jsx("div",{className:"sticky top-10 sm:top-12 md:top-14 z-30 bg-slate-100 border-b border-slate-200 shadow-lg animate-fade-in",children:e.jsx("div",{className:"px-3 sm:px-4 md:px-6 py-3",children:e.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[e.jsx(bs,{className:"absolute left-3 sm:left-3.5 top-1/2 -translate-y-1/2 w-4 sm:w-5 h-4 sm:h-5 text-brand-400"}),e.jsx("input",{ref:f,type:"text",placeholder:"Qidirish...",value:p,onChange:B=>_(B.target.value),className:"w-full h-11 sm:h-12 pl-10 sm:pl-11 pr-10 sm:pr-11 rounded-xl border-2 border-slate-200 focus:border-brand-400 focus:ring-4 focus:ring-brand-100 focus:bg-white transition-all duration-200 text-sm sm:text-base text-slate-900 placeholder:text-slate-400 bg-white shadow-sm hover:border-brand-300"}),e.jsx("button",{onClick:()=>{M(!1),q(""),r==null||r("")},className:"absolute right-3 sm:right-3.5 top-1/2 -translate-y-1/2 w-7 h-7 flex items-center justify-center rounded-full bg-slate-100 hover:bg-slate-200 transition-colors",children:e.jsx(Ne,{className:"w-4 h-4 text-slate-500"})})]})})}),z&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>y(!1)}),e.jsxs("div",{className:"fixed top-0 left-0 bottom-0 w-80 max-w-[85vw] bg-white z-[80] shadow-2xl animate-slide-in-left",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-8 h-8 rounded-lg border-2 border-white/30"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-brand-100 text-xs",children:"Mebel furniturasi"})]})]}),e.jsx("button",{onClick:()=>y(!1),className:"w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center hover:bg-white/30 transition-colors",children:e.jsx(Ne,{className:"w-5 h-5 text-white"})})]})}),e.jsxs("div",{className:"overflow-y-auto h-[calc(100vh-140px)] p-4",children:[e.jsx("div",{className:"space-y-1",children:X.map((B,he)=>{const pe=B.icon;return e.jsxs("button",{onClick:()=>{P(B.path),y(!1)},className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-surface-50 transition-colors group",children:[e.jsx("div",{className:"w-11 h-11 bg-surface-100 rounded-xl flex items-center justify-center group-hover:bg-brand-50 group-hover:scale-110 transition-all",children:e.jsx(pe,{className:"w-5 h-5 text-surface-600 group-hover:text-brand-600"})}),e.jsx("span",{className:"font-medium text-surface-900 group-hover:text-brand-600 transition-colors",children:B.label}),e.jsx(Vt,{className:"w-4 h-4 text-surface-300 ml-auto group-hover:text-brand-600 group-hover:translate-x-1 transition-all"})]},he)})}),e.jsxs("div",{className:"mt-6 p-4 bg-surface-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-surface-500 text-center mb-2",children:(c==null?void 0:c.name)||"Foydalanuvchi"}),e.jsx("p",{className:"text-xs text-surface-400 text-center mb-4",children:new Date().toLocaleDateString("uz-UZ",{year:"numeric",month:"long",day:"numeric"})}),e.jsxs("button",{onClick:v,className:"w-full flex items-center justify-center gap-2 p-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-xl transition-colors",children:[e.jsx(Ft,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Chiqish"})]})]})]})]})]})]})}function Er(){const[t,n]=s.useState("today"),{t:r}=Ht(),[h,l]=s.useState({totalRevenue:0,todaySales:0,weekSales:0,monthSales:0,totalReceipts:0,totalProducts:0,lowStock:0,outOfStock:0,peakHour:""}),[w,S]=s.useState([]),[p,q]=s.useState([]),[z,y]=s.useState(!0);s.useEffect(()=>{k(),M()},[]),s.useEffect(()=>{f()},[t]);const k=()=>Q(this,null,function*(){try{const c=yield K.get("/stats");l(c.data)}catch(c){console.error("Error fetching stats:",c)}finally{y(!1)}}),M=()=>Q(this,null,function*(){try{const R=(yield K.get("/stats/top-products")).data.slice(0,3);q(R)}catch(c){console.error("Error fetching top products:",c)}}),f=()=>Q(this,null,function*(){try{const c=yield K.get(`/stats/chart?period=${t}`);S(c.data)}catch(c){console.error("Error fetching chart data:",c)}}),E=[{icon:ns,label:"Umumiy daromad",value:b(h.totalRevenue||0),suffix:"UZS",color:"from-emerald-500 to-emerald-600",accentColor:"bg-emerald-500",iconBg:"bg-emerald-100",iconColor:"text-emerald-600",textColor:"text-emerald-600",trend:"+12.5%",trendUp:!0},{icon:ia,label:t==="today"?"Bugungi savdo":"Haftalik savdo",value:b(t==="today"?h.todaySales||0:h.weekSales||0),suffix:"UZS",color:"from-blue-500 to-blue-600",accentColor:"bg-blue-500",iconBg:"bg-blue-100",iconColor:"text-blue-600",textColor:"text-blue-600",trend:"+8.2%",trendUp:!0},{icon:us,label:"Jami buyurtmalar",value:(h.totalReceipts||0).toString(),color:"from-purple-500 to-purple-600",accentColor:"bg-purple-500",iconBg:"bg-purple-100",iconColor:"text-purple-600",textColor:"text-purple-600",trend:"+15.3%",trendUp:!0},{icon:Ha,label:"Eng yuqori soat",value:h.peakHour||"-",color:"from-orange-500 to-orange-600",accentColor:"bg-orange-500",iconBg:"bg-orange-100",iconColor:"text-orange-600",textColor:"text-orange-600",trend:"",trendUp:!0}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100",children:[e.jsx(Ks,{title:r("dashboard.title")}),e.jsxs("div",{className:"py-4 sm:py-5 md:py-6 space-y-4 sm:space-y-5 md:space-y-6 pb-24 lg:pb-8",children:[e.jsxs("div",{className:"px-4 sm:px-6 md:px-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 animate-fade-in",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-extrabold bg-gradient-to-r from-purple-900 via-purple-700 to-purple-600 bg-clip-text text-transparent leading-tight",children:r("dashboard.overview")}),e.jsx("p",{className:"text-slate-600 text-xs sm:text-sm font-medium",children:r("dashboard.description")})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex p-1 bg-white/90 backdrop-blur-xl rounded-xl shadow-lg border border-white/20",children:[e.jsx("button",{onClick:()=>n("today"),className:`px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all duration-300 ${t==="today"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/30":"text-slate-600 hover:text-slate-900 hover:bg-slate-50/50"}`,children:r("dashboard.today")}),e.jsx("button",{onClick:()=>n("week"),className:`px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all duration-300 ${t==="week"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/30":"text-slate-600 hover:text-slate-900 hover:bg-slate-50/50"}`,children:r("dashboard.thisWeek")})]}),e.jsx("button",{onClick:k,className:"p-2.5 sm:p-3 rounded-xl bg-white/90 backdrop-blur-xl border border-white/20 text-slate-600 hover:text-slate-900 hover:bg-white transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 active:scale-95",title:r("dashboard.refresh"),children:e.jsx(As,{className:`w-4 h-4 sm:w-5 sm:h-5 ${z?"animate-spin":""}`})})]})]}),z?e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:[1,2,3,4].map(c=>e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-xl sm:rounded-2xl p-3 sm:p-4 md:p-5 shadow-xl border border-slate-200/50 overflow-hidden min-h-[140px] sm:min-h-[160px] md:min-h-[180px]",children:[e.jsxs("div",{className:"animate-pulse space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 bg-gradient-to-br from-slate-200 to-slate-300 rounded-lg sm:rounded-xl"}),e.jsx("div",{className:"w-10 sm:w-12 h-4 sm:h-5 bg-gradient-to-br from-slate-200 to-slate-300 rounded-lg"})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx("div",{className:"h-6 sm:h-8 bg-gradient-to-br from-slate-200 to-slate-300 rounded-lg w-3/4"}),e.jsx("div",{className:"h-3 sm:h-4 bg-gradient-to-br from-slate-200 to-slate-300 rounded w-1/2"})]})]}),e.jsx("div",{className:"absolute inset-0 -translate-x-full animate-[shimmer_2s_infinite] bg-gradient-to-r from-transparent via-white/20 to-transparent"})]},c))})}):e.jsx("div",{children:e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:E.map((c,R)=>e.jsx("div",{className:"group relative animate-slide-up",style:{animationDelay:`${R*100}ms`},children:e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-xl sm:rounded-2xl p-3 sm:p-4 md:p-5 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] overflow-hidden min-h-[140px] sm:min-h-[160px] md:min-h-[180px] flex flex-col border border-slate-200/50",children:[e.jsx("div",{className:`absolute top-0 left-0 right-0 h-0.5 sm:h-1 ${c.accentColor}`}),e.jsxs("div",{className:"flex items-start justify-between mb-auto",children:[e.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 rounded-lg sm:rounded-xl md:rounded-2xl ${c.iconBg} flex items-center justify-center flex-shrink-0`,children:e.jsx(c.icon,{className:`w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7 ${c.iconColor}`})}),c.trend&&e.jsxs("div",{className:`flex items-center gap-0.5 px-1.5 sm:px-2 py-0.5 rounded-md sm:rounded-lg text-[9px] sm:text-[10px] md:text-xs font-bold ${c.trendUp?"bg-emerald-50 text-emerald-700":"bg-red-50 text-red-700"}`,children:[c.trendUp?e.jsx(Gt,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"}):e.jsx(Ya,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"}),e.jsx("span",{children:c.trend})]})]}),e.jsxs("div",{className:"mt-auto space-y-0.5 sm:space-y-1",children:[e.jsxs("div",{className:"flex items-baseline gap-0.5 sm:gap-1 flex-wrap",children:[e.jsx("h3",{className:`text-base sm:text-xl md:text-2xl lg:text-3xl font-bold ${c.textColor} leading-none tracking-tight`,children:c.value}),c.suffix&&e.jsx("span",{className:"text-[7px] sm:text-[8px] md:text-[9px] font-semibold text-slate-400 uppercase",children:c.suffix})]}),e.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs font-medium text-slate-600 leading-tight line-clamp-2",children:c.label})]})]})},R))})})}),e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 sm:gap-5 md:gap-6",children:[e.jsx("div",{className:"xl:col-span-2 relative group animate-slide-up",style:{animationDelay:"400ms"},children:e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 shadow-xl border border-slate-200/50 hover:shadow-2xl transition-all duration-500 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/40 via-transparent to-slate-50/40 opacity-60"}),e.jsxs("div",{className:"relative z-10 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-500 rounded-2xl blur-lg opacity-30"}),e.jsx("div",{className:"relative w-14 h-14 sm:w-16 sm:h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg",children:e.jsx(Dt,{className:"w-7 h-7 sm:w-8 sm:h-8 text-white"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-slate-900 mb-1",children:t==="today"?"Bugungi daromad":"Haftalik daromad"}),e.jsx("p",{className:"text-sm sm:text-base text-slate-500 font-medium",children:t==="today"?"Soatlik taqsimot":"Kunlik ko'rsatkichlar"})]})]}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-50 rounded-xl border border-blue-100",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-bold text-blue-700",children:"Savdo"})]})]}),e.jsx("div",{className:"relative z-10 h-64 sm:h-72 md:h-80 rounded-2xl overflow-hidden bg-gradient-to-br from-slate-50/50 to-white/50 p-4",children:w.length>0?e.jsx(fr,{width:"100%",height:"100%",children:e.jsxs(gr,{data:w,margin:{top:10,right:10,left:-20,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorSales",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.4}),e.jsx("stop",{offset:"50%",stopColor:"#3b82f6",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.05})]})}),e.jsx(br,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1,strokeOpacity:.5}),e.jsx(jr,{dataKey:"date",stroke:"#94a3b8",fontSize:12,tickLine:!1,axisLine:{stroke:"#cbd5e1",strokeWidth:2},tick:{fill:"#64748b",fontWeight:600},dy:8}),e.jsx(vr,{stroke:"#94a3b8",fontSize:12,tickLine:!1,axisLine:{stroke:"#cbd5e1",strokeWidth:2},tick:{fill:"#64748b",fontWeight:600},dx:-5,tickFormatter:c=>`${(c/1e3).toFixed(0)}k`}),e.jsx(wr,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.98)",border:"none",borderRadius:"16px",boxShadow:"0 20px 40px -12px rgba(0, 0, 0, 0.2)",padding:"12px 16px",backdropFilter:"blur(10px)"},labelStyle:{color:"#0f172a",fontWeight:700,marginBottom:"6px",fontSize:"13px"},itemStyle:{color:"#3b82f6",fontWeight:600,fontSize:"14px"},formatter:c=>[`${b(c)} so'm`,"Daromad"],cursor:{stroke:"#3b82f6",strokeWidth:2,strokeDasharray:"5 5",strokeOpacity:.5}}),e.jsx(Nr,{type:"monotone",dataKey:"sales",stroke:"#3b82f6",strokeWidth:3,fill:"url(#colorSales)",dot:{fill:"#3b82f6",strokeWidth:2,stroke:"#fff",r:4},activeDot:{r:6,fill:"#3b82f6",stroke:"#fff",strokeWidth:3,filter:"drop-shadow(0 4px 6px rgba(59, 130, 246, 0.4))"},animationDuration:1200,animationEasing:"ease-in-out"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-200 rounded-3xl blur-2xl opacity-40"}),e.jsx("div",{className:"relative w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-slate-100 to-slate-200 rounded-3xl flex items-center justify-center shadow-lg",children:e.jsx(Dt,{className:"w-10 h-10 sm:w-12 sm:h-12 text-slate-400"})})]}),e.jsx("p",{className:"font-bold text-slate-700 text-lg mb-2",children:"Ma'lumot mavjud emas"}),e.jsx("p",{className:"text-slate-500 text-sm text-center max-w-xs",children:"Analitikani ko'rish uchun savdo qilishni boshlang"})]})})]})}),e.jsx("div",{className:"relative group animate-slide-up",style:{animationDelay:"500ms"},children:e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 shadow-xl border border-slate-200/50 hover:shadow-2xl transition-all duration-500 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-50/40 via-transparent to-pink-50/40 opacity-60"}),e.jsx("div",{className:"relative z-10 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-purple-500 rounded-2xl blur-lg opacity-30"}),e.jsx("div",{className:"relative w-14 h-14 sm:w-16 sm:h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg",children:e.jsx(Fe,{className:"w-7 h-7 sm:w-8 sm:h-8 text-white"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-slate-900 mb-1",children:"Top mahsulotlar"}),e.jsx("p",{className:"text-sm sm:text-base text-slate-500 font-medium",children:"Eng ko'p sotilganlar"})]})]})}),e.jsx("div",{className:"relative z-10",children:p.length>0?e.jsx("div",{className:"space-y-3 sm:space-y-4",children:p.map((c,R)=>e.jsxs("div",{className:"group/item flex items-center gap-3 sm:gap-4 p-4 sm:p-5 bg-gradient-to-r from-slate-50 to-white rounded-xl sm:rounded-2xl border border-slate-200 hover:border-purple-200 hover:shadow-lg transition-all duration-300 cursor-pointer",children:[e.jsx("div",{className:`flex-shrink-0 w-11 h-11 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center font-bold text-base sm:text-lg shadow-lg transition-transform group-hover/item:scale-110 ${R===0?"bg-gradient-to-br from-yellow-400 to-yellow-500 text-white":R===1?"bg-gradient-to-br from-slate-300 to-slate-400 text-white":"bg-gradient-to-br from-orange-300 to-orange-400 text-white"}`,children:R+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-slate-900 text-sm sm:text-base truncate mb-1",children:c._id}),e.jsxs("p",{className:"text-xs sm:text-sm text-slate-500 font-medium",children:[c.totalSold," ta sotildi"]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"font-bold text-purple-600 text-base sm:text-lg",children:b(c.revenue)}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-400 font-semibold",children:"so'm"})]})]},c._id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-56 sm:h-64",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-200 rounded-3xl blur-2xl opacity-40"}),e.jsx("div",{className:"relative w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-slate-100 to-slate-200 rounded-3xl flex items-center justify-center shadow-lg",children:e.jsx(xt,{className:"w-10 h-10 sm:w-12 sm:h-12 text-slate-400"})})]}),e.jsx("p",{className:"font-bold text-slate-700 text-lg mb-2",children:"Ma'lumot yo'q"}),e.jsx("p",{className:"text-slate-500 text-sm text-center max-w-xs",children:"Hali sotuvlar amalga oshirilmagan"})]})})]})})]})})]})]})}const Dr="modulepreload",Ar=function(t){return"/"+t},pa={},Lr=function(n,r,h){let l=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const S=document.querySelector("meta[property=csp-nonce]"),p=(S==null?void 0:S.nonce)||(S==null?void 0:S.getAttribute("nonce"));l=Promise.allSettled(r.map(q=>{if(q=Ar(q),q in pa)return;pa[q]=!0;const z=q.endsWith(".css"),y=z?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${q}"]${y}`))return;const k=document.createElement("link");if(k.rel=z?"stylesheet":Dr,z||(k.as="script"),k.crossOrigin="",k.href=q,p&&k.setAttribute("nonce",p),document.head.appendChild(k),z)return new Promise((M,f)=>{k.addEventListener("load",M),k.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${q}`)))})}))}function w(S){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=S,window.dispatchEvent(p),!p.defaultPrevented)throw S}return l.then(S=>{for(const p of S||[])p.status==="rejected"&&w(p.reason);return n().catch(w)})};function Ir({isOpen:t,onClose:n,onConfirm:r,title:h,message:l,type:w="info",confirmText:S="OK",cancelText:p="Bekor qilish",showCancel:q=!1,autoClose:z=!1,autoCloseDelay:y=2e3}){const k=s.useRef(null);if(s.useEffect(()=>{if(t&&z&&(w==="success"||w==="info")){const c=setTimeout(()=>{r?r():n()},y);return()=>clearTimeout(c)}},[t,z,y,w,r,n]),s.useEffect(()=>{var c;if(t){(c=k.current)==null||c.focus();const R=P=>{P.key==="Enter"&&(P.preventDefault(),r?r():n()),P.key==="Escape"&&n()};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)}},[t,r,n]),!t)return null;const M={info:e.jsx(Wa,{className:"w-10 h-10 text-blue-600"}),success:e.jsx(oa,{className:"w-10 h-10 text-emerald-600"}),warning:e.jsx(Ts,{className:"w-10 h-10 text-amber-600"}),danger:e.jsx(Ts,{className:"w-10 h-10 text-red-600"})},f={info:"bg-gradient-to-br from-blue-50 via-blue-50 to-indigo-50 border-blue-200",success:"bg-gradient-to-br from-emerald-50 via-green-50 to-teal-50 border-emerald-300",warning:"bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 border-amber-200",danger:"bg-gradient-to-br from-red-50 via-rose-50 to-pink-50 border-red-200"},E={info:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/30 hover:shadow-xl hover:shadow-blue-500/40",success:"bg-gradient-to-r from-emerald-500 via-green-500 to-teal-500 hover:from-emerald-600 hover:via-green-600 hover:to-teal-600 text-white shadow-lg shadow-emerald-500/30 hover:shadow-xl hover:shadow-emerald-500/40",warning:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white shadow-lg shadow-amber-500/30 hover:shadow-xl hover:shadow-amber-500/40",danger:"bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-white shadow-lg shadow-red-500/30 hover:shadow-xl hover:shadow-red-500/40"};return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-4 sm:p-6",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm -z-10 transition-opacity duration-100",onClick:n,style:{animation:"fadeIn 0.1s ease-out"}}),e.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-3xl w-full sm:w-auto sm:min-w-[480px] sm:max-w-xl md:max-w-2xl p-6 sm:p-8 md:p-10 shadow-2xl relative z-10 border border-slate-200/50",style:{animation:"modalSlideUp 0.1s ease-out",willChange:"transform, opacity"},children:[e.jsx("button",{onClick:n,className:"absolute top-4 right-4 sm:top-5 sm:right-5 p-2 sm:p-2.5 rounded-xl text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition-all",children:e.jsx(Ne,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsxs("div",{className:"flex flex-col items-center text-center mb-6 sm:mb-8",children:[e.jsx("div",{className:`w-16 h-16 sm:w-20 sm:h-20 ${f[w]} rounded-2xl flex items-center justify-center mb-4 sm:mb-6 border shadow-sm`,children:M[w]}),e.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-bold text-slate-900 mb-2 sm:mb-3 px-2",children:h}),e.jsx("p",{className:"text-sm sm:text-base md:text-lg text-slate-600 leading-relaxed max-w-md px-2",children:l})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3 sm:gap-4",children:[q&&e.jsx("button",{onClick:n,className:"flex-1 px-4 sm:px-5 md:px-6 py-3 sm:py-3.5 md:py-4 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all duration-200 text-sm sm:text-base",children:p}),e.jsx("button",{ref:k,onClick:r||n,className:`flex-1 px-4 sm:px-5 md:px-6 py-3 sm:py-3.5 md:py-4 font-semibold rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 text-sm sm:text-base ${E[w]}`,children:S})]})]})]})}function ws(){const[t,n]=s.useState({isOpen:!1,title:"",message:"",type:"info",showCancel:!1,confirmText:"OK",autoClose:!1,onClose:void 0}),r=s.useCallback((S,p="Xabar",q="info")=>new Promise(z=>{if(q==="success"||q==="info"){z();return}n({isOpen:!0,title:p,message:S,type:q,showCancel:!1,confirmText:"OK",autoClose:!1,onConfirm:()=>{n(y=>j(g({},y),{isOpen:!1})),z()}})}),[]),h=s.useCallback((S,p="Tasdiqlash",q="warning")=>new Promise(z=>{n({isOpen:!0,title:p,message:S,type:q,showCancel:!0,confirmText:"Ha",autoClose:!1,onConfirm:()=>{n(M=>j(g({},M),{isOpen:!1})),z(!0)},onClose:()=>{n(M=>j(g({},M),{isOpen:!1})),z(!1)}})}),[]),l=s.useCallback(()=>{t.onClose?t.onClose():n(S=>j(g({},S),{isOpen:!1}))},[t.onClose]),w=e.jsx(Ir,{isOpen:t.isOpen,onClose:t.onClose||l,onConfirm:t.onConfirm,title:t.title,message:t.message,type:t.type,showCancel:t.showCancel,confirmText:t.confirmText,autoClose:t.autoClose});return{showAlert:r,showConfirm:h,AlertComponent:w}}const _r="pos_offline_db",Br=2,js={SALES:"offline_sales",PRODUCTS:"cached_products",STAFF_RECEIPTS:"staff_receipts"};let Tt=null;const it=()=>new Promise((t,n)=>{if(Tt){t(Tt);return}const r=indexedDB.open(_r,Br);r.onerror=()=>{console.error("IndexedDB: Failed to open database"),n(r.error)},r.onsuccess=()=>{Tt=r.result,console.log("IndexedDB: Database opened successfully"),t(Tt)},r.onupgradeneeded=h=>{const l=h.target.result;if(!l.objectStoreNames.contains(js.SALES)){const w=l.createObjectStore(js.SALES,{keyPath:"id"});w.createIndex("synced","synced",{unique:!1}),w.createIndex("createdAt","createdAt",{unique:!1}),console.log("IndexedDB: Created offline_sales store")}if(l.objectStoreNames.contains(js.PRODUCTS)||(l.createObjectStore(js.PRODUCTS,{keyPath:"_id"}).createIndex("code","code",{unique:!0}),console.log("IndexedDB: Created cached_products store")),!l.objectStoreNames.contains(js.STAFF_RECEIPTS)){const w=l.createObjectStore(js.STAFF_RECEIPTS,{keyPath:"id"});w.createIndex("syncStatus","syncStatus",{unique:!1}),w.createIndex("createdAt","createdAt",{unique:!1}),w.createIndex("updatedAt","updatedAt",{unique:!1}),w.createIndex("userId","userId",{unique:!1}),console.log("IndexedDB: Created staff_receipts store")}}}),Fr=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const n=Math.random()*16|0;return(t==="x"?n:n&3|8).toString(16)}),Or=t=>Q(Ze,null,function*(){const n=yield it(),r=j(g({},t),{id:Fr(),createdAt:new Date().toISOString(),synced:!1});return new Promise((h,l)=>{const p=n.transaction([js.SALES],"readwrite").objectStore(js.SALES).add(r);p.onsuccess=()=>{console.log("IndexedDB: Sale saved offline",r.id),h(r)},p.onerror=()=>{console.error("IndexedDB: Failed to save sale"),l(p.error)}})}),Ta=()=>Q(Ze,null,function*(){const t=yield it();return new Promise((n,r)=>{const l=t.transaction([js.SALES],"readonly").objectStore(js.SALES),w=[],S=l.openCursor();S.onsuccess=p=>{const q=p.target.result;if(q){const z=q.value;(z.synced===!1||z.synced===void 0)&&w.push(z),q.continue()}else n(w)},S.onerror=()=>{console.error("IndexedDB: Failed to get unsynced sales"),r(S.error)}})}),Ra=t=>Q(Ze,null,function*(){const n=yield it();return new Promise((r,h)=>{const l=n.transaction([js.SALES],"readwrite"),w=l.objectStore(js.SALES);l.onerror=()=>h(l.error);let S=0;const p=t.length;if(p===0){r();return}t.forEach(q=>{const z=w.get(q);z.onsuccess=()=>{const y=z.result;y&&(y.synced=!0,w.put(y)),S++,S===p&&(console.log(`IndexedDB: Marked ${p} sales as synced`),r())},z.onerror=()=>{S++,S===p&&r()}})})}),Qa=t=>Q(Ze,null,function*(){const n=yield it();return new Promise((r,h)=>{const l=n.transaction([js.SALES],"readwrite"),w=l.objectStore(js.SALES);l.onerror=()=>h(l.error);let S=0;const p=t.length;if(p===0){r();return}t.forEach(q=>{const z=w.delete(q);z.onsuccess=()=>{S++,S===p&&(console.log(`IndexedDB: Deleted ${p} synced sales`),r())},z.onerror=()=>{S++,S===p&&r()}})})}),ct=()=>Q(Ze,null,function*(){return(yield Ta()).length}),Ea=t=>Q(Ze,null,function*(){const n=yield it();return new Promise((r,h)=>{const w=n.transaction([js.PRODUCTS],"readwrite").objectStore(js.PRODUCTS),S=w.clear();S.onsuccess=()=>{let p=0;const q=t.length;if(q===0){r();return}t.forEach(z=>{const y=w.add(z);y.onsuccess=()=>{p++,p===q&&(console.log(`IndexedDB: Cached ${q} products`),r())},y.onerror=()=>{p++,p===q&&r()}})},S.onerror=()=>{h(S.error)}})}),_t=()=>Q(Ze,null,function*(){const t=yield it();return new Promise((n,r)=>{const w=t.transaction([js.PRODUCTS],"readonly").objectStore(js.PRODUCTS).getAll();w.onsuccess=()=>{var S;console.log(`IndexedDB: Retrieved ${((S=w.result)==null?void 0:S.length)||0} cached products`),n(w.result||[])},w.onerror=()=>{console.error("IndexedDB: Failed to get cached products"),r(w.error)}})});let Et=[],St=!1;const Kr=t=>(Et.push(t),()=>{Et=Et.filter(n=>n!==t)}),qt=t=>Q(Ze,null,function*(){const n=yield ct();Et.forEach(r=>r(t,n))}),mt=()=>navigator.onLine,sa=()=>Q(Ze,null,function*(){if(St)return console.log("Sync: Already syncing, skipping..."),{success:!1,synced:0,error:"Sync already in progress"};if(!mt())return console.log("Sync: Device is offline, skipping..."),{success:!1,synced:0,error:"Device is offline"};St=!0,yield qt("syncing");try{const t=yield Ta();if(t.length===0)return console.log("Sync: No unsynced sales to sync"),St=!1,yield qt("idle"),{success:!0,synced:0};console.log(`Sync: Found ${t.length} unsynced sales`);const n=t.map(h=>({offlineId:h.id,items:h.items,total:h.total,paymentMethod:h.paymentMethod,customer:h.customer,isReturn:h.isReturn,createdAt:h.createdAt})),r=yield K.post("/receipts/bulk",{sales:n});if(r.data.success){const h=t.map(l=>l.id);return yield Ra(h),yield Qa(h),console.log(`Sync: Successfully synced ${h.length} sales`),St=!1,yield qt("success"),{success:!0,synced:h.length}}else throw new Error(r.data.message||"Server returned error")}catch(t){return console.error("Sync: Failed to sync sales",t),St=!1,yield qt("error"),{success:!1,synced:0,error:t.message||"Sync failed"}}}),Xr=()=>{window.addEventListener("online",()=>Q(Ze,null,function*(){console.log("Sync: Internet connection restored"),setTimeout(()=>Q(Ze,null,function*(){const t=yield sa();t.success&&t.synced>0&&console.log(`Sync: Auto-synced ${t.synced} sales after reconnection`)}),2e3)})),window.addEventListener("offline",()=>{console.log("Sync: Internet connection lost - sales will be saved locally"),qt("idle")}),mt()&&setTimeout(()=>{sa()},3e3),console.log("Sync: Event listeners initialized")},Ur=()=>Q(Ze,null,function*(){return mt()?sa():{success:!1,synced:0,error:"Internet aloqasi yo'q"}}),Hr=()=>{const[t,n]=s.useState(mt()),[r,h]=s.useState(0),[l,w]=s.useState(!1),[S,p]=s.useState("idle"),[q,z]=s.useState(!1);s.useEffect(()=>{Q(Ze,null,function*(){yield it(),q||(Xr(),z(!0));const P=yield ct();h(P)});const E=Kr((P,C)=>{p(P),h(C),w(P==="syncing")}),c=()=>n(!0),R=()=>n(!1);return window.addEventListener("online",c),window.addEventListener("offline",R),()=>{E(),window.removeEventListener("online",c),window.removeEventListener("offline",R)}},[q]);const y=s.useCallback(f=>Q(Ze,null,function*(){if(mt())try{const c=(yield K.get(`/products${f?`?${f}`:""}`)).data;return yield Ea(c),c}catch(E){return console.log("Failed to fetch from server, using cache"),_t()}else return console.log("Offline - using cached products"),_t()}),[]),k=s.useCallback(f=>Q(Ze,null,function*(){try{const E=yield Or(f);if(console.log("Sale saved locally:",E.id),mt())try{yield K.post("/receipts",{items:f.items,total:f.total,paymentMethod:f.paymentMethod,customer:f.customer,isReturn:f.isReturn}),yield Ra([E.id]),yield Qa([E.id]);const c=yield ct();return h(c),{success:!0,offline:!1}}catch(c){console.log("Server sync failed, sale saved offline");const R=yield ct();return h(R),{success:!0,offline:!0}}else{const c=yield ct();return h(c),{success:!0,offline:!0}}}catch(E){return console.error("Failed to save sale:",E),{success:!1,offline:!1}}}),[]),M=s.useCallback(()=>Q(Ze,null,function*(){const f=yield Ur(),E=yield ct();return h(E),f}),[]);return{isOnline:t,pendingCount:r,isSyncing:l,syncStatus:S,fetchProductsWithCache:y,createSaleOfflineFirst:k,manualSync:M}};function Yr({onScan:t,onClose:n}){const[r,h]=s.useState(!1),[l,w]=s.useState(""),[S,p]=s.useState(!1),[q,z]=s.useState(""),[y,k]=s.useState(""),M=s.useRef(null);s.useEffect(()=>{M.current&&M.current.focus()},[]);const f=R=>Q(this,null,function*(){var P,C;if(!R||R.trim()===""){z("Kod kiriting");return}try{p(!0),z(""),k(""),console.log("ðŸ” QR Scanner: Mahsulot qidirilmoqda...",R);const v=yield K.get(`/products/scan-qr/${R.trim()}`);if(v.data.success&&v.data.product){console.log("âœ… QR Scanner: Mahsulot topildi",v.data.product);const _=v.data.product;k(`${_.name} topildi! Mavjud: ${_.quantity} ta`),setTimeout(()=>{t(_),w(""),k(""),M.current&&M.current.focus()},500)}else z("Mahsulot topilmadi")}catch(v){console.error("âŒ QR Scanner xatosi:",v),z(((C=(P=v.response)==null?void 0:P.data)==null?void 0:C.message)||"Mahsulot topilmadi")}finally{p(!1)}}),E=R=>{R.key==="Enter"&&f(l)},c=()=>{f(l)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-scale-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(Zt,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"QR Scanner"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Mahsulot kodini kiriting"})]})]}),e.jsx("button",{onClick:n,className:"w-10 h-10 rounded-full hover:bg-slate-100 flex items-center justify-center transition-colors",children:e.jsx(Ne,{className:"w-5 h-5 text-slate-600"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mahsulot Kodi"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:M,type:"text",value:l,onChange:R=>w(R.target.value),onKeyPress:E,placeholder:"Kodni kiriting yoki skanerlang...",className:"flex-1 px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",disabled:S,autoFocus:!0}),e.jsx("button",{onClick:c,disabled:S||!l,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Qidirilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Zt,{className:"w-5 h-5"}),"Qidirish"]})})]})]}),q&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-xl text-red-700",children:[e.jsx(ca,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium",children:q})]}),y&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-xl text-green-700",children:[e.jsx(oa,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium",children:y})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Qanday ishlatish?"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Mahsulot kodini kiriting"}),e.jsx("li",{children:"â€¢ Yoki QR kod skanerdan foydalaning"}),e.jsx("li",{children:"â€¢ Enter tugmasini bosing"}),e.jsx("li",{children:"â€¢ Mahsulot avtomatik kassaga qo'shiladi"})]})]}),r&&e.jsxs("div",{className:"bg-slate-100 rounded-xl p-8 text-center",children:[e.jsx(Ja,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Kamera skaneri tez orada..."})]})]}),e.jsx("div",{className:"mt-6 flex gap-3",children:e.jsx("button",{onClick:n,className:"flex-1 px-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-all",children:"Yopish"})})]})})}function Wt(){const t=_s(),{showAlert:n,AlertComponent:r}=ws();Hr();const[h,l]=s.useState("products"),[w,S]=s.useState(!1),[p,q]=s.useState([]),[z,y]=s.useState([]),[k,M]=s.useState(20),[f,E]=s.useState([]),[c,R]=s.useState(""),[P,C]=s.useState(!1),[v,_]=s.useState(!1),[X,B]=s.useState(""),[he,pe]=s.useState([]),[F,be]=s.useState([]),[le,Te]=s.useState(!1),[W,te]=s.useState([]),[D,xe]=s.useState(null),[I,fe]=s.useState(!1),[ve,H]=s.useState(""),[T,ye]=s.useState(0),[de,ke]=s.useState(0),[ae,Ke]=s.useState(0),[is,Ve]=s.useState(null),[Me,es]=s.useState(!1),[u,re]=s.useState(!1),[Pe,Qe]=s.useState(""),[ge,Oe]=s.useState(""),[m,je]=s.useState(null),[ze,Ie]=s.useState(!1),[Re,_e]=s.useState(!1),[L,o]=s.useState([]),[Y,Se]=s.useState(!1),$e=s.useRef(null);s.useEffect(()=>{Ce(),N(),J(),we();const x=localStorage.getItem("pendingReceipt");if(x)try{const V=JSON.parse(x);if(V.customer&&xe(V.customer),V.items&&V.items.length>0){const ce=V.items.map(oe=>({_id:oe.product||oe._id,name:oe.name,code:oe.code||"",price:oe.price,cartQuantity:oe.quantity,quantity:999}));E(ce)}localStorage.removeItem("pendingReceipt"),setTimeout(()=>{C(!0)},500),n("Chek yuklandi! To'lov qilishingiz mumkin.","Muvaffaqiyat","success")}catch(V){console.error("Error loading pending receipt:",V),localStorage.removeItem("pendingReceipt")}},[]),s.useEffect(()=>{y(p.slice(0,k))},[p,k]),s.useEffect(()=>{const x=$e.current;if(!x)return;const V=()=>{const{scrollTop:ce,scrollHeight:oe,clientHeight:qe}=x;oe-ce<=qe*1.5&&k<p.length&&M(Ee=>Math.min(Ee+20,p.length))};return x.addEventListener("scroll",V),()=>x.removeEventListener("scroll",V)},[k,p.length]);const Ce=()=>Q(this,null,function*(){try{if(navigator.onLine){const x=yield K.get("/products?mainOnly=true&limit=1000"),V=x.data.data||x.data,ce=Array.isArray(V)?V:[];q(ce),yield Ea(ce)}else{const x=yield _t();q(x)}}catch(x){console.error("Error fetching products:",x);const V=yield _t();V.length>0&&q(V)}}),N=()=>Q(this,null,function*(){try{const x=yield K.get("/customers/kassa");te(x.data)}catch(x){console.error("Error fetching customers:",x)}}),J=()=>Q(this,null,function*(){Se(!0);try{const x=yield K.get("/receipts/kassa");o(x.data||[])}catch(x){console.error("Error fetching helper receipts:",x),n("Cheklar yuklanmadi","Xatolik","danger")}finally{Se(!1)}}),ue=x=>{const V=x.items.map(ce=>{var oe,qe,Ee;return{_id:((oe=ce.product)==null?void 0:oe._id)||ce.product,name:((qe=ce.product)==null?void 0:qe.name)||ce.name,code:((Ee=ce.product)==null?void 0:Ee.code)||ce.code||"",price:ce.price,cartQuantity:ce.quantity,quantity:999}});E(V),l("products"),n("Chek savatga yuklandi!","Muvaffaqiyat","success")},we=()=>{const x=localStorage.getItem("savedReceipts");x&&be(JSON.parse(x))},Be=()=>Q(this,null,function*(){var x,V,ce,oe,qe,Ee;if(!Pe.trim()||!ge.trim()){n("Ism va telefon raqamini kiriting!","Ogohlantirish","warning");return}try{console.log("ðŸ“¤ Yangi mijoz yaratish so'rovi:",{name:Pe.trim(),phone:ge.trim()});const Ae=yield K.post("/customers/kassa",{name:Pe.trim(),phone:ge.trim()});if(console.log("âœ… Mijoz yaratish javobi:",Ae.data),Ae.data.success){const De=Ae.data.customer;te(os=>[...os,De]),xe(De),re(!1),Qe(""),Oe(""),n("Yangi mijoz qo'shildi!","Muvaffaqiyat","success"),console.log("âœ… Mijoz muvaffaqiyatli qo'shildi:",De)}}catch(Ae){if(console.error("âŒ Mijoz yaratishda xatolik:",Ae),console.error("Xato tafsilotlari:",(x=Ae.response)==null?void 0:x.data),((V=Ae.response)==null?void 0:V.status)===400&&((oe=(ce=Ae.response)==null?void 0:ce.data)!=null&&oe.existingCustomer)){const De=Ae.response.data.existingCustomer;xe(De),re(!1),Qe(""),Oe(""),n("Bu mijoz allaqachon mavjud. Tanlandi.","Ma'lumot","info"),console.log("â„¹ï¸ Mavjud mijoz tanlandi:",De)}else n(((Ee=(qe=Ae.response)==null?void 0:qe.data)==null?void 0:Ee.message)||"Mijoz qo'shishda xatolik","Xatolik","danger")}}),Je=f.reduce((x,V)=>x+V.price*V.cartQuantity,0),Xe=f.reduce((x,V)=>x+V.cartQuantity,0),hs=x=>{if(x.quantity<=0){n(`${x.name} tugagan! Mavjud emas.`,"Ogohlantirish","warning");return}const V=f.find(oe=>oe._id===x._id);if((V?V.cartQuantity:0)>=x.quantity){n(`${x.name} - maksimal miqdor: ${x.quantity}`,"Ogohlantirish","warning");return}E(oe=>oe.find(Ee=>Ee._id===x._id)?oe.map(Ee=>Ee._id===x._id?j(g({},Ee),{cartQuantity:Ee.cartQuantity+1}):Ee):[...oe,j(g({},x),{cartQuantity:1})]),_(!1),B("")},Ns=x=>{hs(x),n(`${x.name} savatga qo'shildi`,"Muvaffaqiyat","success"),_e(!1)},Ms=x=>{E(V=>V.filter(ce=>ce._id!==x))},gs=(x,V)=>{V<=0?Ms(x):E(ce=>ce.map(oe=>oe._id===x?j(g({},oe),{cartQuantity:V}):oe))},Cs=x=>{if(B(x),x.length>0){const V=p.filter(ce=>ce.name.toLowerCase().includes(x.toLowerCase())||ce.code.toLowerCase().includes(x.toLowerCase()));pe(V)}else pe(p.slice(0,20))},Rs=()=>Q(this,null,function*(){var qe,Ee,Ae;if(f.length===0)return;const x=de+ae,V=Je-x;if(V>0&&!D){n("Qarzga sotish uchun mijozni tanlang yoki yangi mijoz qo'shing!","Ogohlantirish","warning");return}let ce;de>0&&ae>0?ce="mixed":de>0?ce="cash":ce="card";const oe={items:f.map(De=>({product:De._id,name:De.name,code:De.code,price:De.price,quantity:De.cartQuantity})),total:Je,paidAmount:x,cashAmount:de,cardAmount:ae,paymentMethod:ce,isReturn:le,customer:D==null?void 0:D._id};try{if(navigator.onLine){console.log("ðŸ“¤ Chek yuborish boshlandi:",oe);const De=yield K.post("/receipts",oe);console.log("âœ… Server javobi:",De.data),V>0&&D?n(`To'lov qabul qilindi! Qarz: ${b(V)} so'm`,"Muvaffaqiyat","success"):n(le?"Qaytarish muvaffaqiyatli!":"Chek saqlandi!","Muvaffaqiyat","success"),ps(De.data,ce,x,V,de,ae),E([]),C(!1),es(!1),Ve(null),Te(!1),ke(0),Ke(0),ye(0),xe(null),Ce()}else n("Internet aloqasi yo'q. Iltimos, internetni yoqing.","Xatolik","danger")}catch(De){console.error("âŒ Xatolik:",De),console.error("Xato tafsilotlari:",(qe=De.response)==null?void 0:qe.data);const os=((Ae=(Ee=De.response)==null?void 0:Ee.data)==null?void 0:Ae.message)||De.message||"Xatolik yuz berdi";n(os,"Xatolik","danger")}}),ps=(x,V,ce,oe,qe,Ee)=>{const Ae=window.open("","","height=600,width=400");if(!Ae)return;const De=ce||x.total,os=oe||0,cs=qe||0,ts=Ee||0;let Ge="";V==="mixed"?Ge=`Naqd: ${b(cs)} so'm, Karta: ${b(ts)} so'm`:V==="cash"?Ge="Naqd pul":Ge="Karta";const xs=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Chek</title>
        <style>
          body { font-family: monospace; margin: 0; padding: 10px; font-size: 12px; }
          .header { text-align: center; margin-bottom: 10px; border-bottom: 1px dashed #000; padding-bottom: 10px; }
          .title { font-weight: bold; font-size: 14px; }
          .items { margin: 10px 0; border-bottom: 1px dashed #000; padding-bottom: 10px; }
          .item { display: flex; justify-content: space-between; margin: 5px 0; }
          .total { font-weight: bold; font-size: 14px; text-align: right; margin: 10px 0; }
          .payment-info { margin: 10px 0; border-top: 1px dashed #000; padding-top: 10px; }
          .footer { text-align: center; margin-top: 10px; font-size: 10px; }
          .debt-warning { color: #d00; font-weight: bold; text-align: center; margin: 10px 0; }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="title">CHEK</div>
          <div>${new Date().toLocaleString("uz-UZ")}</div>
        </div>
        
        <div class="items">
          ${x.items.map(ds=>`
            <div class="item">
              <span>${ds.name}</span>
              <span>${b(ds.price*ds.quantity)} so'm</span>
            </div>
            <div style="font-size: 10px; color: #666;">
              ${ds.quantity} x ${b(ds.price)} so'm
            </div>
          `).join("")}
        </div>
        
        <div class="total">
          Jami: ${b(x.total)} so'm
        </div>
        
        <div class="payment-info">
          ${V==="mixed"?`
            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
              <span>Naqd:</span>
              <span>${b(cs)} so'm</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
              <span>Karta:</span>
              <span>${b(ts)} so'm</span>
            </div>
          `:""}
          <div style="display: flex; justify-content: space-between; margin: 5px 0; font-weight: bold;">
            <span>To'landi:</span>
            <span>${b(De)} so'm</span>
          </div>
          ${os>0?`
            <div class="debt-warning">
              Qarz: ${b(os)} so'm
            </div>
          `:""}
        </div>
        
        <div class="footer">
          To'lov: ${Ge}
          <br>
          Raxmat!
        </div>
      </body>
      </html>
    `;Ae.document.write(xs),Ae.document.close(),setTimeout(()=>{Ae.print()},250)},ys=x=>Q(this,null,function*(){const V=window.open("","_blank","width=600,height=400");if(!V){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}const ce=x.map(Ee=>Q(this,null,function*(){try{const Ae=yield Lr(()=>import("./qrcode-vendor-DPnJAP0X.js").then(ts=>ts.b),__vite__mapDeps([0,1])),De=Ae.default||Ae,os=`${window.location.origin}/product/${Ee._id}`,cs=yield De.toDataURL(os,{width:300,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});return{product:Ee,qrDataUrl:cs}}catch(Ae){return console.error("QR generation error:",Ae),{product:Ee,qrDataUrl:""}}})),oe=yield Promise.all(ce);let qe="";oe.forEach(({product:Ee,qrDataUrl:Ae})=>{qe+=`
        <div class="label">
          <div class="top-section">
            <div class="qr-box">
              <img src="${Ae}" alt="QR" class="qr-code" />
            </div>
            <div class="info-box">
              <div class="product-code">Kod: ${Ee.code}</div>
              <div class="product-name">${Ee.name}</div>
            </div>
          </div>
          <div class="bottom-section">
            <div class="price-box">
              <span class="price-value">${b(Ee.price)}</span>
              <span class="price-currency">so'm</span>
            </div>
          </div>
        </div>
      `}),V.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Label</title>
        <style>
          @page {
            size: 60mm 40mm;
            margin: 0;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, Helvetica, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .label {
            width: 60mm;
            height: 40mm;
            padding: 2mm;
            background: white;
            display: flex;
            flex-direction: column;
            page-break-after: always;
          }
          .label:last-child {
            page-break-after: auto;
          }
          .top-section {
            display: flex;
            gap: 2mm;
            flex: 1;
          }
          .qr-box {
            width: 22mm;
            height: 22mm;
            flex-shrink: 0;
          }
          .qr-code {
            width: 22mm;
            height: 22mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
          }
          .product-code {
            font-size: 7pt;
            font-weight: 600;
            color: #666;
            margin-bottom: 1mm;
          }
          .product-name {
            font-size: 9pt;
            font-weight: 700;
            color: #000;
            line-height: 1.2;
            text-transform: uppercase;
            word-break: break-word;
          }
          .bottom-section {
            margin-top: 1.5mm;
          }
          .price-box {
            padding: 1.5mm;
            text-align: center;
            background: #f0f0f0;
            border-radius: 1mm;
          }
          .price-value {
            font-size: 14pt;
            font-weight: 900;
            color: #000;
            letter-spacing: -0.5px;
          }
          .price-currency {
            font-size: 10pt;
            font-weight: 700;
            color: #000;
            margin-left: 1mm;
          }
          @media print {
            body { background: white; }
          }
          @media screen {
            body { background: #e5e7eb; padding: 10mm; }
            .label { 
              margin-bottom: 5mm;
              box-shadow: 0 2px 8px rgba(0,0,0,0.1);
              border: 1px solid #ddd;
            }
          }
        </style>
      </head>
      <body>
        ${qe}
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 200);
          }
        <\/script>
      </body>
      </html>
    `),V.document.close()}),$s=()=>{if(f.length===0){n("Chek bo'sh","Ogohlantirish","warning");return}const x={id:Date.now().toString(),items:[...f],total:Je,savedAt:new Date().toLocaleString()},V=[...F,x];be(V),localStorage.setItem("savedReceipts",JSON.stringify(V)),E([]),n("Chek saqlandi!","Muvaffaqiyat","success")},d=x=>{E(x.items);const V=F.filter(ce=>ce.id!==x.id);be(V),localStorage.setItem("savedReceipts",JSON.stringify(V)),Ie(!1)},ne=x=>{const V=F.filter(ce=>ce.id!==x);be(V),localStorage.setItem("savedReceipts",JSON.stringify(V))};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100 pb-20 lg:pb-0",children:[r,e.jsx("header",{className:"bg-white border-b border-slate-200 sticky top-0 z-40 shadow-sm",children:e.jsxs("div",{className:"max-w-[1800px] mx-auto px-3 sm:px-4 lg:px-6 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>S(!0),className:"p-2 rounded-lg bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-colors active:scale-95 flex-shrink-0 flex sm:hidden",title:"Menyuni ochish",children:e.jsx(Pt,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-gradient-to-br from-purple-500 via-purple-600 to-blue-600 flex items-center justify-center shadow-xl",children:e.jsx(us,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white drop-shadow-lg"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-extrabold bg-gradient-to-r from-purple-600 via-blue-600 to-purple-600 bg-clip-text text-transparent leading-tight",children:"Kassa (POS)"}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500 font-medium mt-0.5",children:"Professional Sotish Tizimi"})]})]}),e.jsxs("button",{onClick:()=>Ie(!0),className:"flex items-center gap-2 px-3 sm:px-4 py-2 bg-gradient-to-r from-purple-100 to-blue-100 hover:from-purple-200 hover:to-blue-200 rounded-xl text-sm font-bold text-purple-700 transition-all shadow-md hover:shadow-lg",children:[e.jsx(ut,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Saqlangan"}),F.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-red-500 text-white text-xs rounded-full font-bold shadow-md",children:F.length})]})]})}),e.jsx("div",{className:"max-w-[1800px] mx-auto p-2 sm:p-4 lg:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3 sm:gap-4 lg:gap-6",children:[e.jsx("div",{className:"lg:col-span-1 order-1",children:e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-2xl border-2 border-slate-200 shadow-xl overflow-hidden sticky top-20 sm:top-24",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-3 sm:px-6 py-3 sm:py-4 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-1 sm:mb-2",children:[e.jsx(us,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("h2",{className:"text-base sm:text-lg font-bold",children:"Savat"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-brand-100",children:[Xe," ta mahsulot"]})]}),e.jsx("div",{className:"max-h-48 sm:max-h-64 overflow-y-auto divide-y divide-slate-100",children:f.length===0?e.jsxs("div",{className:"p-4 sm:p-8 text-center text-slate-400",children:[e.jsx(us,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 opacity-30"}),e.jsx("p",{className:"text-xs sm:text-sm",children:"Savat bo'sh"})]}):f.map(x=>{const V=p.find(oe=>oe._id===x._id),ce=V&&x.cartQuantity>V.quantity;return e.jsxs("div",{className:"p-2 sm:p-4 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1 sm:mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-slate-900 text-xs sm:text-sm truncate",children:x.name}),ce&&e.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 text-yellow-700 text-[10px] font-semibold rounded-full whitespace-nowrap",children:"Kam!"})]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500",children:x.code})]}),e.jsx("button",{onClick:()=>Ms(x._id),className:"text-slate-400 hover:text-red-500 transition-colors flex-shrink-0 ml-2",children:e.jsx(Ne,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-slate-100 rounded-lg p-0.5 sm:p-1",children:[e.jsx("button",{onClick:()=>gs(x._id,x.cartQuantity-1),className:"w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center hover:bg-slate-200 rounded transition-colors",children:e.jsx(ft,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})}),e.jsx("input",{type:"number",min:"1",value:x.cartQuantity,onChange:oe=>{const qe=parseInt(oe.target.value)||1;gs(x._id,qe)},className:"w-10 sm:w-12 text-center text-xs sm:text-sm font-semibold bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-brand-500 rounded"}),e.jsx("button",{onClick:()=>gs(x._id,x.cartQuantity+1),className:"w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center hover:bg-slate-200 rounded transition-colors",children:e.jsx(ms,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})})]}),e.jsxs("p",{className:"font-bold text-brand-600 text-xs sm:text-sm",children:[b(x.price*x.cartQuantity)," so'm"]})]})]},x._id)})}),f.length>0&&e.jsxs("div",{className:"border-t border-slate-200 p-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-600 mb-2 block",children:"Mijoz"}),e.jsxs("button",{onClick:()=>fe(!I),className:"w-full flex items-center gap-2 px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-medium text-slate-700 transition-colors",children:[e.jsx(ls,{className:"w-4 h-4"}),e.jsx("span",{className:"flex-1 text-left truncate",children:D?D.name:"Oddiy mijoz"}),e.jsx(Mt,{className:"w-4 h-4"})]}),I&&e.jsxs("div",{className:"absolute right-0 left-0 mx-4 mt-2 bg-white rounded-lg shadow-xl border border-slate-200 z-50 max-h-48 overflow-y-auto",children:[e.jsx("button",{onClick:()=>{xe(null),fe(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 border-b border-slate-100",children:"Oddiy mijoz"}),W.map(x=>e.jsxs("button",{onClick:()=>{xe(x),fe(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 border-b border-slate-100 last:border-b-0",children:[e.jsx("p",{className:"font-medium text-slate-900",children:x.name}),e.jsx("p",{className:"text-xs text-slate-500",children:x.phone})]},x._id))]})]}),f.length>0&&e.jsxs("div",{className:"border-t border-slate-200 p-3 sm:p-6 space-y-2 sm:space-y-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-50 to-blue-50 rounded-xl p-3 sm:p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm sm:text-base font-semibold text-slate-700",children:"Jami:"}),e.jsxs("span",{className:"text-xl sm:text-2xl font-bold text-brand-600",children:[b(Je)," so'm"]})]})}),e.jsxs("button",{onClick:()=>C(!0),className:"w-full bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white font-bold py-2 sm:py-3 rounded-lg sm:rounded-xl transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2 text-xs sm:text-sm",children:[e.jsx(Es,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"To'lash"]}),e.jsxs("button",{onClick:$s,className:"w-full bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold py-1.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors flex items-center justify-center gap-2 text-xs sm:text-sm",children:[e.jsx(ut,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Saqlash"]}),e.jsxs("button",{onClick:()=>E([]),className:"w-full bg-red-50 hover:bg-red-100 text-red-600 font-semibold py-1.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors flex items-center justify-center gap-2 text-xs sm:text-sm",children:[e.jsx(zs,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Tozalash"]})]})]})}),e.jsxs("div",{className:"lg:col-span-2 space-y-2 sm:space-y-3 lg:space-y-4 order-2",children:[e.jsxs("div",{className:"flex gap-2 bg-white p-2 rounded-xl border-2 border-slate-200 shadow-sm",children:[e.jsxs("button",{onClick:()=>l("products"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-semibold text-sm transition-all ${h==="products"?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-md":"bg-slate-50 text-slate-600 hover:bg-slate-100"}`,children:[e.jsx(st,{className:"w-4 h-4"}),"Mahsulotlar"]}),e.jsxs("button",{onClick:()=>l("receipts"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-semibold text-sm transition-all ${h==="receipts"?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-md":"bg-slate-50 text-slate-600 hover:bg-slate-100"}`,children:[e.jsx(Os,{className:"w-4 h-4"}),"Cheklar",L.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-red-500 text-white text-xs rounded-full font-bold",children:L.length})]})]}),h==="products"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(bs,{className:"absolute left-3 sm:left-4 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Mahsulot qidirish...",value:X,onChange:x=>Cs(x.target.value),onFocus:()=>_(!0),className:"w-full pl-9 sm:pl-12 pr-3 sm:pr-4 py-2 sm:py-3 bg-white border-2 border-slate-200 rounded-lg sm:rounded-xl focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 text-xs sm:text-sm"})]}),v&&X?e.jsx("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 overflow-hidden shadow-lg",children:e.jsx("div",{className:"max-h-64 sm:max-h-96 overflow-y-auto",children:he.length>0?e.jsx("div",{className:"divide-y divide-slate-100",children:he.map(x=>e.jsxs("button",{onClick:()=>{hs(x),_(!1),B("")},disabled:x.quantity<=0,className:`w-full flex items-center gap-2 sm:gap-4 p-2 sm:p-4 hover:bg-slate-50 transition-colors text-left ${x.quantity<=0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-brand-100 to-brand-50 rounded-xl border-2 border-brand-200 flex items-center justify-center flex-shrink-0 overflow-hidden relative",children:[x.quantity<=0&&e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center z-10",children:e.jsx("span",{className:"text-white text-[8px] font-bold",children:"TUGAGAN"})}),x.images&&x.images.length>0?e.jsx("img",{src:`${Ps}${x.images[0]}`,alt:x.name,className:"w-full h-full object-cover",onError:V=>{V.currentTarget.style.display="none";const ce=V.currentTarget.parentElement;ce&&(ce.innerHTML='<svg class="w-5 h-5 sm:w-6 sm:h-6 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>')}}):e.jsx(st,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-slate-900 truncate text-xs sm:text-sm",children:x.name}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-slate-500",children:["Kod: ",x.code]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"font-bold text-brand-600 text-xs sm:text-sm",children:[b(x.price)," so'm"]}),e.jsxs("p",{className:`text-[10px] sm:text-xs font-semibold ${x.quantity<=0?"text-red-600":x.quantity<=10?"text-orange-600":"text-green-600"}`,children:[x.quantity," ta"]})]})]},x._id))}):e.jsxs("div",{className:"p-6 sm:p-8 text-center text-slate-500",children:[e.jsx(st,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 opacity-30"}),e.jsx("p",{className:"text-xs sm:text-sm",children:"Mahsulot topilmadi"})]})})}):e.jsx("div",{ref:$e,className:"max-h-[calc(100vh-250px)] overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-2 sm:gap-3",children:z.map(x=>e.jsxs("div",{className:"group bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 hover:border-brand-300 hover:shadow-lg transition-all p-2 sm:p-4 relative",children:[e.jsxs("button",{onClick:V=>{V.stopPropagation(),ys([x])},className:"absolute top-2 right-2 w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 z-10 group/qr",title:"QR code chiqarish",children:[e.jsx(Zt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white drop-shadow-lg"}),e.jsx("span",{className:"absolute -bottom-8 right-0 bg-slate-900 text-white text-[10px] px-2 py-1 rounded-lg opacity-0 group-hover/qr:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:"QR Print"})]}),e.jsxs("button",{onClick:()=>hs(x),disabled:x.quantity<=0,className:`w-full text-left ${x.quantity<=0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"w-full aspect-square bg-gradient-to-br from-brand-100 to-brand-50 rounded-xl border-2 border-brand-200 flex items-center justify-center mb-2 sm:mb-3 group-hover:scale-105 transition-transform overflow-hidden relative",children:[x.quantity<=0&&e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center z-10",children:e.jsx("div",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold",children:"TUGAGAN"})}),x.images&&x.images.length>0?e.jsx("img",{src:`${Ps}${x.images[0]}`,alt:x.name,className:"w-full h-full object-cover",onError:V=>{V.currentTarget.style.display="none";const ce=V.currentTarget.parentElement;ce&&(ce.innerHTML='<svg class="w-6 h-6 sm:w-8 sm:h-8 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>')}}):e.jsx(st,{className:"w-6 h-6 sm:w-8 sm:h-8 text-brand-600"})]}),e.jsx("p",{className:"font-semibold text-slate-900 text-[10px] sm:text-sm truncate",children:x.name}),e.jsx("p",{className:"text-[9px] sm:text-xs text-slate-500 mb-1 sm:mb-2",children:x.code}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"font-bold text-brand-600 text-[10px] sm:text-sm",children:[b(x.price)," so'm"]}),x.quantity<=0?e.jsx("span",{className:"text-[9px] sm:text-xs text-red-600 font-semibold",children:"0 ta"}):x.quantity<=10?e.jsxs("span",{className:"text-[9px] sm:text-xs text-orange-600 font-semibold",children:[x.quantity," ta"]}):e.jsxs("span",{className:"text-[9px] sm:text-xs text-green-600 font-semibold",children:[x.quantity," ta"]})]})]})]},x._id))})})]}),h==="receipts"&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-slate-200 shadow-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Hodimlardan kelgan cheklar"}),e.jsx("button",{onClick:J,disabled:Y,className:"p-2 rounded-lg bg-brand-50 hover:bg-brand-100 text-brand-600 transition-colors disabled:opacity-50",children:e.jsx(As,{className:`w-5 h-5 ${Y?"animate-spin":""}`})})]}),Y?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-brand-500 border-t-transparent rounded-full animate-spin"})}):L.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(Os,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"Cheklar yo'q"})]}):e.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:L.map(x=>e.jsxs("div",{className:"border-2 border-slate-200 rounded-xl p-4 hover:border-brand-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-slate-900",children:["Chek #",x.receiptNumber||x._id.slice(-6)]}),e.jsx("p",{className:"text-xs text-slate-500",children:new Date(x.createdAt).toLocaleString("uz-UZ")}),x.createdBy&&e.jsxs("p",{className:"text-xs text-brand-600 font-medium mt-1",children:["Hodim: ",x.createdBy.name]})]}),e.jsxs("button",{onClick:()=>ue(x),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white rounded-lg font-semibold text-sm shadow-md hover:shadow-lg transition-all",children:[e.jsx(us,{className:"w-4 h-4"}),"Yuklash"]})]}),e.jsx("div",{className:"space-y-2 mb-3",children:x.items.map((V,ce)=>e.jsxs("div",{className:"flex justify-between text-sm bg-slate-50 p-2 rounded-lg",children:[e.jsxs("span",{className:"text-slate-700",children:[V.name," Ã— ",V.quantity]}),e.jsxs("span",{className:"font-semibold text-slate-900",children:[b(V.price*V.quantity)," so'm"]})]},ce))}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-slate-200",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Jami:"}),e.jsxs("span",{className:"text-xl font-bold text-brand-600",children:[b(x.totalAmount||x.total)," so'm"]})]})]},x._id))})]})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full my-8 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-6 py-4 text-white",children:e.jsx("h3",{className:"text-xl font-bold",children:"To'lov"})}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[calc(100vh-200px)] overflow-y-auto",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Jami summa"}),e.jsxs("p",{className:"text-3xl font-bold text-brand-600",children:[b(Je)," so'm"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700 block",children:"Mijoz"}),u?e.jsxs("div",{className:"space-y-3 p-4 bg-blue-50 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1 block",children:"Ism"}),e.jsx("input",{type:"text",value:Pe,onChange:x=>Qe(x.target.value),placeholder:"Mijoz ismi...",className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1 block",children:"Telefon"}),e.jsx("input",{type:"tel",value:ge,onChange:x=>Oe(x.target.value),placeholder:"+998 90 123 45 67",className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Be,className:"flex-1 bg-brand-500 hover:bg-brand-600 text-white font-semibold py-2 rounded-lg transition-colors text-sm",children:"Saqlash"}),e.jsx("button",{onClick:()=>{re(!1),Qe(""),Oe("")},className:"px-4 bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold rounded-lg transition-colors text-sm",children:"Bekor"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:(D==null?void 0:D._id)||"",onChange:x=>{const V=W.find(ce=>ce._id===x.target.value);xe(V||null)},className:"w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",children:[e.jsx("option",{value:"",children:"Oddiy mijoz"}),W.map(x=>e.jsxs("option",{value:x._id,children:[x.name," - ",x.phone]},x._id))]}),e.jsx("button",{onClick:()=>re(!0),className:"w-full px-4 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 font-semibold rounded-lg transition-colors text-sm",children:"+ Yangi mijoz qo'shish"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2",children:[e.jsx(va,{className:"w-4 h-4 text-emerald-600"}),"Naqd pul"]}),e.jsx("input",{type:"number",value:de||"",onChange:x=>ke(Number(x.target.value)),placeholder:"0",className:"w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 text-lg font-semibold"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4 text-blue-600"}),"Karta"]}),e.jsx("input",{type:"number",value:ae||"",onChange:x=>Ke(Number(x.target.value)),placeholder:"0",className:"w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 text-lg font-semibold"})]})]}),(de>0||ae>0)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Jami to'lanadi:"}),e.jsxs("span",{className:"font-bold text-slate-900",children:[b(de+ae)," so'm"]})]}),de+ae<Je&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-amber-600",children:"Qarz:"}),e.jsxs("span",{className:"font-bold text-amber-600",children:[b(Je-(de+ae))," so'm"]})]}),de+ae>Je&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-600",children:"Qaytim:"}),e.jsxs("span",{className:"font-bold text-green-600",children:[b(de+ae-Je)," so'm"]})]})]}),de+ae<Je&&!D&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-3 flex items-start gap-2",children:[e.jsx(Ts,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-900 text-sm",children:"Mijoz tanlanmagan!"}),e.jsx("p",{className:"text-xs text-red-700 mt-1",children:"Qarzga sotish uchun mijozni tanlang yoki yangi mijoz qo'shing"})]})]}),de+ae<Je&&D&&e.jsxs("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-3 flex items-start gap-2",children:[e.jsx(Ts,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-amber-900 text-sm",children:"Qisman to'lov"}),e.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:[b(Je-(de+ae))," so'm ",e.jsx("span",{className:"font-bold",children:D.name})," nomiga qarzga yoziladi"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:Rs,disabled:de+ae<=0||de+ae<Je&&!D,className:"flex-1 bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white font-bold py-3 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:"Tasdiqlash"}),e.jsx("button",{onClick:()=>{C(!1),ke(0),Ke(0),re(!1),Qe(""),Oe("")},className:"px-6 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold rounded-xl transition-colors",children:"Bekor"})]})]})]})}),Re&&e.jsx(Yr,{onScan:Ns,onClose:()=>_e(!1)}),ze&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-96 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-6 py-4 text-white flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Saqlangan Cheklar"}),e.jsx("button",{onClick:()=>Ie(!1),className:"hover:bg-brand-600 p-2 rounded-lg transition-colors",children:e.jsx(Ne,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto divide-y divide-slate-200",children:F.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx(Os,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"Saqlangan cheklar yo'q"})]}):F.map(x=>e.jsxs("div",{className:"p-4 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-slate-900",children:[x.items.length," ta mahsulot"]}),e.jsx("p",{className:"text-xs text-slate-500",children:x.savedAt})]}),e.jsxs("p",{className:"font-bold text-brand-600",children:[b(x.total)," so'm"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(x),className:"flex-1 bg-brand-100 hover:bg-brand-200 text-brand-700 font-semibold py-2 rounded-lg transition-colors text-sm",children:"Yuklash"}),e.jsx("button",{onClick:()=>ne(x.id),className:"flex-1 bg-red-100 hover:bg-red-200 text-red-700 font-semibold py-2 rounded-lg transition-colors text-sm",children:"O'chirish"})]})]},x.id))})]})}),w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] sm:hidden",onClick:()=>S(!1)}),e.jsxs("div",{className:"fixed top-0 left-0 bottom-0 w-80 max-w-[85vw] bg-white z-[100] shadow-2xl animate-slide-in-left sm:hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center",children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-8 h-8 rounded-lg border-2 border-white/30"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-brand-100 text-xs",children:"Mebel furniturasi"})]})]}),e.jsx("button",{onClick:()=>S(!1),className:"p-2 rounded-lg bg-white/20 hover:bg-white/30 text-white transition-colors",children:e.jsx(Ne,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("button",{onClick:()=>{t("/"),S(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(la,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Bosh sahifa"})]}),e.jsxs("button",{onClick:()=>{t("/admin/products"),S(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(st,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Mahsulotlar"})]}),e.jsxs("button",{onClick:()=>{S(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-brand-50 text-brand-700 transition-colors text-left",children:[e.jsx(us,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Kassa (POS)"})]}),e.jsxs("button",{onClick:()=>{t("/admin/customers"),S(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(Is,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Mijozlar"})]}),e.jsxs("button",{onClick:()=>{t("/admin/debts"),S(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(Hs,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Qarzlar"})]}),e.jsxs("button",{onClick:()=>{t("/admin/staff-receipts"),S(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(Os,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Cheklar"})]}),e.jsxs("button",{onClick:()=>{t("/admin/helpers"),S(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(na,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Hodimlar"})]})]})]})]})]})}const Wr=({productId:t,code:n,name:r,price:h,unit:l="dona",dimensions:w="",labelWidth:S=60,labelHeight:p=40,copies:q=1,onPrint:z})=>{const[y,k]=s.useState(""),[M,f]=s.useState(q),E=`${Ut}/product/${t}`,c=C=>new Intl.NumberFormat("uz-UZ").format(C);s.useEffect(()=>{R()},[t,n]);const R=()=>Q(Ze,null,function*(){try{const C=yield Xt(E,{width:300,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});k(C)}catch(C){console.error("QR generation error:",C)}}),P=()=>{const C=window.open("","_blank","width=600,height=400");if(!C){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}let v="";for(let _=0;_<M;_++)v+=`
        <div class="label">
          <div class="top-section">
            <div class="qr-box">
              <img src="${y}" alt="QR" class="qr-code" />
            </div>
            <div class="info-box">
              <div class="product-code">Kod: ${n}</div>
              <div class="product-name">${r}</div>
              ${w?`<div class="product-dimensions">${w}</div>`:""}
            </div>
          </div>
          <div class="bottom-section">
            <div class="price-box">
              <span class="price-value">${c(h)}</span>
              <span class="price-currency">so'm</span>
            </div>
          </div>
        </div>
      `;C.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Label - ${r}</title>
        <style>
          @page {
            size: ${S}mm ${p}mm;
            margin: 0;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, Helvetica, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .label {
            width: ${S}mm;
            height: ${p}mm;
            padding: 2mm;
            background: white;
            display: flex;
            flex-direction: column;
            page-break-after: always;
          }
          .label:last-child {
            page-break-after: auto;
          }
          .top-section {
            display: flex;
            gap: 2mm;
            flex: 1;
          }
          .qr-box {
            width: 22mm;
            height: 22mm;
            flex-shrink: 0;
          }
          .qr-code {
            width: 22mm;
            height: 22mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
          }
          .product-code {
            font-size: 7pt;
            font-weight: 600;
            color: #666;
            margin-bottom: 1mm;
          }
          .product-name {
            font-size: 9pt;
            font-weight: 700;
            color: #000;
            line-height: 1.2;
            text-transform: uppercase;
            word-break: break-word;
          }
          .product-dimensions {
            font-size: 7pt;
            color: #666;
            margin-top: 1mm;
          }
          .bottom-section {
            margin-top: 1.5mm;
          }
          .price-box {
            padding: 1.5mm;
            text-align: center;
            background: #f0f0f0;
            border-radius: 1mm;
          }
          .price-value {
            font-size: 14pt;
            font-weight: 900;
            color: #000;
            letter-spacing: -0.5px;
          }
          .price-currency {
            font-size: 10pt;
            font-weight: 700;
            color: #000;
            margin-left: 1mm;
          }
          @media print {
            body { background: white; }
          }
          @media screen {
            body { background: #e5e7eb; padding: 10mm; }
            .label { 
              margin-bottom: 5mm;
              box-shadow: 0 2px 8px rgba(0,0,0,0.1);
              border: 1px solid #ddd;
            }
          }
        </style>
      </head>
      <body>
        ${v}
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 200);
          }
        <\/script>
      </body>
      </html>
    `),C.document.close(),z==null||z()};return e.jsxs("div",{className:"qr-print-label w-full",children:[e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden mx-auto shadow-md border border-gray-200",style:{width:"280px",padding:"12px"},children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:y?e.jsx("img",{src:y,alt:"QR Code",className:"w-24 h-24",style:{imageRendering:"pixelated"}}):e.jsx("div",{className:"w-24 h-24 bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-gray-400",children:"QR"})})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-500 mb-1",children:["Kod: ",n]}),e.jsx("div",{className:"text-base font-bold text-gray-900 uppercase leading-tight",children:r}),w&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:w})]})]}),e.jsxs("div",{className:"mt-3 bg-gray-100 rounded-lg p-2 text-center",children:[e.jsx("span",{className:"text-2xl font-black text-gray-900",children:c(h)}),e.jsx("span",{className:"text-lg font-bold text-gray-900 ml-1",children:"so'm"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-3",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Nusxa soni:"}),e.jsx("input",{type:"number",min:1,max:100,value:M,onChange:C=>f(parseInt(C.target.value)||1),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center"})]}),e.jsxs("button",{onClick:P,className:"mt-4 w-full px-4 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"ðŸ–¨ï¸ Chop etish ",M>1?`(${M} ta)`:""]})]})},Jr=({products:t,onClose:n})=>{const[r,h]=s.useState([]),[l,w]=s.useState(!0),[S,p]=s.useState({width:40,height:30,qrSize:18,columns:2,showPrice:!0,showCode:!0}),[q,z]=s.useState(!1),y=C=>new Intl.NumberFormat("uz-UZ").format(C);s.useEffect(()=>{k()},[t]);const k=()=>Q(Ze,null,function*(){w(!0);const C=[];for(const v of t){const _=`${Ut}/product/${v._id}`;try{const X=yield Xt(_,{width:200,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});C.push({product:v,copies:1,qrDataUrl:X})}catch(X){console.error("QR error for",v.code,X)}}h(C),w(!1)}),M=(C,v)=>{h(_=>_.map((X,B)=>{if(B===C){const he=Math.max(1,Math.min(100,X.copies+v));return j(g({},X),{copies:he})}return X}))},f=(C,v)=>{h(_=>_.map((X,B)=>B===C?j(g({},X),{copies:Math.max(1,Math.min(100,v))}):X))},E=C=>{h(v=>v.filter((_,X)=>X!==C))},c=C=>{h(v=>v.map(_=>j(g({},_),{copies:C})))},R=()=>r.reduce((C,v)=>C+v.copies,0),P=()=>{const C=window.open("","_blank","width=800,height=600");if(!C){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}let v="";r.forEach(_=>{for(let X=0;X<_.copies;X++)v+=`
          <div class="label">
            <div class="qr-section">
              <img src="${_.qrDataUrl}" alt="QR" class="qr-code" />
            </div>
            <div class="info-section">
              <div class="product-name">${_.product.name.length>18?_.product.name.substring(0,18)+"...":_.product.name}</div>
              ${S.showCode?`<div class="product-code">Kod: ${_.product.code}</div>`:""}
              ${S.showPrice?`<div class="product-price">${y(_.product.price)} so'm</div>`:""}
            </div>
          </div>
        `}),C.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Labels - Batch Print</title>
        <style>
          @page {
            size: ${S.width*S.columns+2}mm auto;
            margin: 1mm;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .labels-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1mm;
          }
          .label {
            width: ${S.width}mm;
            height: ${S.height}mm;
            padding: 1.5mm;
            display: flex;
            align-items: center;
            gap: 1.5mm;
            background: white;
            border: 0.2mm solid #ddd;
            page-break-inside: avoid;
          }
          .qr-section {
            flex-shrink: 0;
          }
          .qr-code {
            width: ${S.qrSize}mm;
            height: ${S.qrSize}mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
          }
          .product-name {
            font-size: 6pt;
            font-weight: 700;
            color: #000;
            line-height: 1.1;
            margin-bottom: 0.3mm;
            text-transform: uppercase;
            word-break: break-word;
          }
          .product-code {
            font-size: 5pt;
            color: #333;
            margin-bottom: 0.3mm;
          }
          .product-price {
            font-size: 7pt;
            font-weight: 900;
            color: #000;
          }
          @media print {
            body { background: white; }
            .label { border: none; }
          }
        </style>
      </head>
      <body>
        <div class="labels-container">
          ${v}
        </div>
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 300);
          }
        <\/script>
      </body>
      </html>
    `),C.document.close()};return l?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100]",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-brand-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-surface-600",children:"QR kodlar yaratilmoqda..."})]})}):e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-surface-900",children:"QR Label Chop Etish"}),e.jsxs("p",{className:"text-sm text-surface-500",children:[r.length," ta mahsulot, jami ",R()," ta label"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>z(!q),className:`p-2 rounded-lg transition-colors ${q?"bg-brand-100 text-brand-600":"hover:bg-surface-100"}`,children:e.jsx(zt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-surface-100 rounded-lg",children:e.jsx(Ne,{className:"w-5 h-5"})})]})]}),q&&e.jsx("div",{className:"p-4 bg-surface-50 border-b border-surface-200",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Eni (mm)"}),e.jsx("input",{type:"number",value:S.width,onChange:C=>p(v=>j(g({},v),{width:Number(C.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"number",value:S.height,onChange:C=>p(v=>j(g({},v),{height:Number(C.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"QR (mm)"}),e.jsx("input",{type:"number",value:S.qrSize,onChange:C=>p(v=>j(g({},v),{qrSize:Number(C.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Ustunlar"}),e.jsx("input",{type:"number",value:S.columns,onChange:C=>p(v=>j(g({},v),{columns:Number(C.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showPrice",checked:S.showPrice,onChange:C=>p(v=>j(g({},v),{showPrice:C.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"showPrice",className:"text-sm",children:"Narx"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showCode",checked:S.showCode,onChange:C=>p(v=>j(g({},v),{showCode:C.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"showCode",className:"text-sm",children:"Kod"})]})]})}),e.jsxs("div",{className:"p-3 border-b border-surface-200 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-surface-500",children:"Barchasi uchun:"}),[1,2,5,10].map(C=>e.jsxs("button",{onClick:()=>c(C),className:"px-3 py-1 text-sm bg-surface-100 hover:bg-surface-200 rounded-lg transition-colors",children:[C," ta"]},C))]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:r.length===0?e.jsx("div",{className:"text-center py-12 text-surface-500",children:"Mahsulotlar yo'q"}):e.jsx("div",{className:"space-y-2",children:r.map((C,v)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-surface-50 rounded-xl",children:[e.jsx("img",{src:C.qrDataUrl,alt:"QR",className:"w-12 h-12 rounded border border-surface-200"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-surface-900 truncate",children:C.product.name}),e.jsxs("div",{className:"text-sm text-surface-500",children:["Kod: ",C.product.code," â€¢ ",y(C.product.price)," so'm"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>M(v,-1),className:"w-8 h-8 flex items-center justify-center bg-surface-200 hover:bg-surface-300 rounded-lg transition-colors",children:e.jsx(ft,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:C.copies,onChange:_=>f(v,Number(_.target.value)),className:"w-14 text-center px-2 py-1 border border-surface-200 rounded-lg",min:1,max:100}),e.jsx("button",{onClick:()=>M(v,1),className:"w-8 h-8 flex items-center justify-center bg-surface-200 hover:bg-surface-300 rounded-lg transition-colors",children:e.jsx(ms,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>E(v),className:"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(Ne,{className:"w-4 h-4"})})]},C.product._id))})}),e.jsxs("div",{className:"p-4 border-t border-surface-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-surface-500",children:["Jami: ",e.jsx("span",{className:"font-bold text-surface-900",children:R()})," ta label"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 text-surface-600 hover:bg-surface-100 rounded-xl transition-colors",children:"Bekor qilish"}),e.jsxs("button",{onClick:P,disabled:r.length===0,className:"px-6 py-2 bg-brand-600 text-white rounded-xl font-medium hover:bg-brand-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(Gs,{className:"w-4 h-4"}),"Chop etish"]})]})]})]})})},as={log:(...t)=>{},error:(...t)=>{console.error(...t)},warn:(...t)=>{},info:(...t)=>{},debug:(...t)=>{}};function Vr(){const{showAlert:t,showConfirm:n,AlertComponent:r}=ws(),[h,l]=s.useState([]),[w,S]=s.useState(1),[p,q]=s.useState(1),[z,y]=s.useState(0),[k,M]=s.useState(!1),[f,E]=s.useState(null),[c,R]=s.useState(!1),[P,C]=s.useState(!1),[v,_]=s.useState(!1),[X,B]=s.useState(!1),[he,pe]=s.useState(new Set),[F,be]=s.useState(!1),[le,Te]=s.useState(!1),[W,te]=s.useState(null),[D,xe]=s.useState(!1),[I,fe]=s.useState("7"),[ve,H]=s.useState({total:0,lowStock:0,outOfStock:0,totalValue:0}),[T,ye]=s.useState(null),[de,ke]=s.useState(null),[ae,Ke]=s.useState(""),[is,Ve]=s.useState(""),[Me,es]=s.useState("all"),[u,re]=s.useState(!0),[Pe,Qe]=s.useState(!1),[ge,Oe]=s.useState(12500),[m,je]=s.useState(!1),[ze,Ie]=s.useState("add"),[Re,_e]=s.useState(""),L=s.useRef(null);s.useEffect(()=>{const i=setTimeout(()=>{Ve(ae)},150);return()=>clearTimeout(i)},[ae]),s.useEffect(()=>(c||P||v||le||m||X?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[c,P,v,le,m,X]);const[o,Y]=s.useState({code:"",name:"",description:"",quantity:"",previousPrice:"",currentPrice:"",costPrice:"",costPriceInDollar:"",unitPrice:"",boxPrice:"",pricingTiers:{tier1:{minQuantity:"1",maxQuantity:"5",discountPercent:"15"},tier2:{minQuantity:"6",maxQuantity:"20",discountPercent:"13"},tier3:{minQuantity:"21",maxQuantity:"100",discountPercent:"11"}},unit:"dona",dimensions:{width:"",height:"",length:""},metersPerRoll:"",unitsPerBox:"",meterPriceRanges:[{from:"",to:"",price:""}],pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),[Se,$e]=s.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[Ce,N]=s.useState([]),[J,ue]=s.useState([]),[we,Be]=s.useState(""),[Je,Xe]=s.useState(!1),hs=s.useRef(null),Ns=()=>{if(!T)return;const i=document.getElementById("qr-code-svg");if(!i)return;const U=new XMLSerializer().serializeToString(i),Z=document.createElement("canvas"),a=Z.getContext("2d"),$=document.createElement("img");$.onload=()=>{Z.width=$.width,Z.height=$.height,a==null||a.drawImage($,0,0);const A=Z.toDataURL("image/png"),O=document.createElement("a");O.download=`QR-${T.code}-${T.name}.png`,O.href=A,O.click()},$.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(U)))},Ms=i=>Q(this,null,function*(){if(i)try{const U=(de==null?void 0:de._id)||"";(yield K.get(`/products/check-code/${i}${U?`?excludeId=${U}`:""}`)).data.exists?Be(`Kod "${i}" allaqachon mavjud`):Be("")}catch(U){as.error("Error checking code:",U),t("Kod tekshirishda xatolik","Xatolik","danger")}}),gs=s.useMemo(()=>{if(!is&&Me==="all")return h;const i=is.toLowerCase().trim(),U=i.split(/\s+/).filter(Z=>Z.length>0);return h.filter(Z=>{if(!is)return!0;const a=Z.name.toLowerCase(),$=Z.code.toLowerCase();return U.length===1?a.includes(i)||$.includes(i):U.every(ee=>a.includes(ee)||$.includes(ee))?Me==="all"||Me==="low"&&Z.quantity<=(Z.minStock||50)&&Z.quantity>0||Me==="out"&&Z.quantity===0:!1})},[h,is,Me]),Cs=s.useCallback((i=1)=>Q(this,null,function*(){var a,$,A,O,ee;const U=performance.now();/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&console.log("ðŸŽ Safari browser aniqlandi - maxsus optimizatsiyalar faol");try{i===1?re(!0):M(!0);const ie=Date.now(),G=yield K.get(`/products?page=${i}&limit=20&t=${ie}`),se=G.data.data||[],me=G.data.pagination||{};console.log(`ðŸ“¦ Sahifa ${i}: ${se.length} ta mahsulot keldi`);const Le=se.filter(ss=>!ss||!ss._id?(console.warn("âš ï¸ Mahsulot ID yo'q:",ss),!1):!ss.name||ss.name.trim()===""?(console.warn("âš ï¸ Mahsulot nomi yo'q:",ss._id),!1):!0),ks=se.length-Le.length;ks>0&&console.warn(`âš ï¸ Sahifa ${i}: ${ks} ta invalid mahsulot o'tkazib yuborildi`);const Ss=performance.now()-U;if(console.log(`âš¡ Sahifa ${i}: ${Le.length}/${se.length} ta maxsulot ${Math.round(Ss)}ms da yuklandi`),console.log(`ðŸ“Š Pagination: Sahifa ${me.page}/${me.pages}, Jami: ${me.total}`),l(i===1?Le:ss=>[...ss,...Le]),S(me.page||1),q(me.pages||1),y(me.total||0),i===1){const ss=()=>{const qs={total:me.total||0,lowStock:Le.filter(fs=>fs.quantity<=(fs.minStock||50)&&fs.quantity>0).length,outOfStock:Le.filter(fs=>fs.quantity===0).length,totalValue:Le.reduce((fs,Ue)=>{let Qs=0;return Ue.currentPrice&&Ue.currentPrice>0?Qs=Ue.currentPrice:Ue.unitPrice&&Ue.unitPrice>0?Qs=Ue.unitPrice:Ue.price&&Ue.price>0?Qs=Ue.price:Ue.boxPrice&&Ue.boxPrice>0&&Ue.unitsPerBox&&Ue.unitsPerBox>0?Qs=Ue.boxPrice/Ue.unitsPerBox:Ue.previousPrice&&Ue.previousPrice>0&&(Qs=Ue.previousPrice),fs+Qs*(Ue.quantity||0)},0)};console.log("ðŸ’° Client-side jami qiymat:",qs.totalValue),H(qs)};typeof requestIdleCallback!="undefined"?requestIdleCallback(ss,{timeout:2e3}):setTimeout(ss,100)}}catch(ie){console.error("âŒ Mahsulotlarni yuklashda xatolik:",ie),console.error("Error details:",{message:ie.message,response:(a=ie.response)==null?void 0:a.data,status:($=ie.response)==null?void 0:$.status,stack:ie.stack});const G=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let se=((O=(A=ie.response)==null?void 0:A.data)==null?void 0:O.message)||ie.message||"Maxsulotlarni yuklashda xatolik";G&&((ee=ie.message)!=null&&ee.includes("Network"))&&(se="Internet aloqasini tekshiring. Safari'da ba'zan aloqa muammolari bo'lishi mumkin."),t(se,"Xatolik","danger"),i===1&&(l([]),H({total:0,lowStock:0,outOfStock:0,totalValue:0}))}finally{re(!1),M(!1)}}),[t]);s.useEffect(()=>{ys(),Cs(1);const i=setTimeout(()=>{Rs()},1e3);return()=>clearTimeout(i)},[Cs]);const Rs=()=>Q(this,null,function*(){if(!D){xe(!0);try{console.log("ðŸ“Š Statistika yuklanmoqda...");const i=yield K.get("/products/overall-stats");console.log("ðŸ“Š Server statistikasi:",i.data),console.log("ðŸ’° Jami qiymat:",i.data.totalValue),H(i.data)}catch(i){console.error("Statistikani yuklashda xatolik:",i),i.code==="ECONNABORTED"&&console.warn("âš ï¸ Statistika yuklash juda uzoq davom etdi, keyinroq qayta uriniladi")}finally{xe(!1)}}});s.useEffect(()=>{if(w===1&&p>1&&!k){console.log(`ðŸ”„ Background: Qolgan ${p-1} ta sahifa yuklanmoqda...`);const i=setTimeout(()=>Q(this,null,function*(){M(!0);for(let U=2;U<=p;U++){console.log(`ðŸ“¥ Sahifa ${U}/${p} yuklanmoqda...`);try{const $=((yield K.get(`/products?page=${U}&limit=20&t=${Date.now()}`)).data.data||[]).filter(A=>!(!A||!A._id||!A.name||A.name.trim()===""));l(A=>{const O=new Set(A.map(ie=>ie._id)),ee=$.filter(ie=>!O.has(ie._id));return[...A,...ee]}),S(U),yield new Promise(A=>setTimeout(A,200))}catch(Z){console.error(`âŒ Sahifa ${U} yuklashda xatolik:`,Z)}}M(!1),console.log(`âœ… Barcha ${p} ta sahifa yuklandi!`)}),500);return()=>clearTimeout(i)}},[w,p,k]);const ps=s.useCallback(()=>{},[]);s.useEffect(()=>{(is||Me!=="all")&&(l([]),S(1),Cs(1))},[is,Me,Cs]),s.useEffect(()=>{const i=L.current;if(i)return i.addEventListener("scroll",ps),()=>i.removeEventListener("scroll",ps)},[ps]),s.useEffect(()=>{as.log("Products state updated:",{count:h.length,firstProduct:h.length>0?{_id:h[0]._id,name:h[0].name,code:h[0].code}:null})},[h]);const ys=()=>Q(this,null,function*(){try{const i=Date.now(),U=yield K.get(`/warehouses?t=${i}`),a=(Array.isArray(U.data)?U.data:[]).find($=>$.name==="Asosiy ombor");if(a)E(a);else{const $=yield K.post("/warehouses",{name:"Asosiy ombor",address:""});E($.data)}}catch(i){as.error("Error fetching warehouses:",i),t("Omborlarni yuklashda xatolik","Xatolik","danger"),re(!1)}}),$s=i=>new Promise((U,Z)=>{const a=new FileReader;a.readAsDataURL(i),a.onload=$=>{var O;const A=new Image;A.src=(O=$.target)==null?void 0:O.result,A.onload=()=>{const ee=document.createElement("canvas");let ie=A.width,G=A.height;if(ie>1920||G>1920){const me=Math.min(1920/ie,1920/G);ie=Math.round(ie*me),G=Math.round(G*me)}ee.width=ie,ee.height=G;const se=ee.getContext("2d");if(!se){Z(new Error("Canvas context not available"));return}se.drawImage(A,0,0,ie,G),ee.toBlob(me=>{me?U(me):Z(new Error("Canvas to blob failed"))},"image/jpeg",.8)},A.onerror=()=>Z(new Error("Image load failed"))},a.onerror=()=>Z(new Error("File read failed"))}),d=i=>Q(this,null,function*(){const U=i.target.files;if(!U||U.length===0)return;const Z=8-Ce.length;if(Z<=0){t("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const a=["image/jpeg","image/jpg","image/png","image/webp"],$=Array.from(U).filter(ee=>a.includes(ee.type)?!0:(t(`${ee.name} - noto'g'ri format. Faqat JPG, PNG, WebP qabul qilinadi`,"Xatolik","warning"),!1));if($.length===0)return;const A=$.slice(0,Z),O=new FormData;Qe(!0);try{for(const G of A)try{const se=yield $s(G);O.append("images",se,G.name)}catch(se){as.warn(`Image compression failed for ${G.name}, uploading original:`,se),O.append("images",G)}const ee=yield K.post("/products/upload-images",O,{headers:{"Content-Type":"multipart/form-data"}}),ie=(ee.data.images||[]).map(G=>typeof G=="string"?G:G.path);ue([...J,...ie]),N([...Ce.map(G=>typeof G=="string"?G:G.path),...ie]),t(`${ee.data.images.length} ta rasm muvaffaqiyatli yuklandi`,"Muvaffaqiyat","success")}catch(ee){as.error("Error uploading images:",ee),t("Rasmlarni yuklashda xatolik","Xatolik","danger")}finally{Qe(!1),hs.current&&(hs.current.value="")}}),ne=i=>Q(this,null,function*(){var U,Z,a;try{console.log("ðŸ—‘ï¸ Removing image:",{imagePath:i,isNewlyUploaded:J.includes(i)});const $=Ce.map(O=>typeof O=="string"?O:O.path).filter(O=>O!==i);if(N($),J.includes(i)){ue(J.filter(O=>O!==i)),t("Rasm o'chirildi (hali saqlanmagan)","Ma'lumot","info");try{yield K.delete("/products/delete-image",{data:{imagePath:i,productId:void 0}}),console.log("âœ… Yangi yuklangan rasm serverdan ham o'chirildi")}catch(O){console.warn("Yangi yuklangan rasmni serverdan o'chirishda xatolik:",O)}return}const A=de==null?void 0:de._id;if(A)try{yield K.delete("/products/delete-image",{data:{imagePath:i,productId:A}}),t("Rasm o'chirildi","Muvaffaqiyat","success")}catch(O){console.warn("Server xatosi:",O),((U=O.response)==null?void 0:U.status)===404?t("Rasm local state dan o'chirildi","Ma'lumot","info"):t("Rasm local state dan o'chirildi, lekin serverda xatolik","Ogohlantirish","warning")}else t("Rasm o'chirildi","Muvaffaqiyat","success")}catch($){as.error("Error deleting image:",$);const A=((a=(Z=$.response)==null?void 0:Z.data)==null?void 0:a.message)||$.message||"Rasmni o'chirishda xatolik";t(A,"Xatolik","danger")}}),x=i=>{if(i.images&&i.images.length>0){let U=typeof i.images[0]=="string"?i.images[0]:i.images[0].path;if(U.startsWith("http://")||U.startsWith("https://"))try{U=new URL(U).pathname}catch(Z){console.warn("Invalid image URL:",U)}return U.startsWith("/")||(U="/"+U),`${Ps}${U}`}return null},V=i=>Q(this,null,function*(){var A,O,ee,ie,G;if(i.preventDefault(),as.log("Form submit boshlandi. Ma'lumotlar:",{code:o.code,name:o.name,unitPrice:o.unitPrice,currentPrice:o.currentPrice,codeError:we}),we){as.error("Kod xatosi:",we),t(we,"Xatolik","danger");return}if(!o.name||!o.name.trim()){as.error("Tovar nomi bo'sh"),t("Tovar nomi majburiy","Xatolik","danger");return}if(!o.unitPrice&&!o.currentPrice){as.error("Narx bo'sh"),t("Tovar narxi majburiy","Xatolik","danger");return}let U=Number(o.quantity),Z=null;if(Je&&Se.packageCount&&Se.unitsPerPackage){const se=Number(Se.packageCount)*Number(Se.unitsPerPackage);U=de?Number(o.quantity)+se:se,Z={packageCount:Number(Se.packageCount),unitsPerPackage:Number(Se.unitsPerPackage),totalUnits:se}}let a=0,$=0;o.unit==="rulon"&&o.metersPerRoll&&(a=U*Number(o.metersPerRoll)),o.unit==="karobka"&&o.unitsPerBox&&($=U*Number(o.unitsPerBox));try{const se={code:o.code,name:o.name,description:o.description||"",price:Number(o.unitPrice)||Number(o.currentPrice),costPrice:Number(o.costPrice)||0,unitPrice:Number(o.unitPrice)||Number(o.currentPrice)||0,boxPrice:Number(o.boxPrice)||0,previousPrice:Number(o.previousPrice)||0,currentPrice:Number(o.currentPrice)||0,pricingTiers:{tier1:{minQuantity:Number(o.pricingTiers.tier1.minQuantity)||1,maxQuantity:Number(o.pricingTiers.tier1.maxQuantity)||5,discountPercent:Number(o.pricingTiers.tier1.discountPercent)||15},tier2:{minQuantity:Number(o.pricingTiers.tier2.minQuantity)||6,maxQuantity:Number(o.pricingTiers.tier2.maxQuantity)||20,discountPercent:Number(o.pricingTiers.tier2.discountPercent)||13},tier3:{minQuantity:Number(o.pricingTiers.tier3.minQuantity)||21,maxQuantity:Number(o.pricingTiers.tier3.maxQuantity)||100,discountPercent:Number(o.pricingTiers.tier3.discountPercent)||11}},quantity:U,warehouse:f==null?void 0:f._id,images:Ce,packageInfo:Z,unit:o.unit,costPriceInDollar:Number(o.costPriceInDollar)||0,dollarRate:ge,dimensions:{width:o.dimensions.width||"",height:o.dimensions.height||"",length:o.dimensions.length||""},metersPerRoll:Number(o.metersPerRoll)||0,unitsPerBox:Number(o.unitsPerBox)||0,totalMeters:a,totalUnits:$,meterPriceRanges:o.meterPriceRanges.filter(me=>me.from&&me.to&&me.price).map(me=>({from:Number(me.from),to:Number(me.to),price:Number(me.price)})),prices:{perUnit:Number(o.unitPrice)||Number(o.currentPrice),perRoll:Number(o.pricePerRoll)||0,perBox:Number(o.boxPrice)||Number(o.pricePerBox)||0,perKg:Number(o.pricePerKg)||0,perGram:Number(o.pricePerGram)||0}};if(as.log("Tovar serverga yuborilmoqda:",{code:se.code,name:se.name,warehouse:se.warehouse,quantity:se.quantity,price:se.price}),de){const me=yield K.put(`/products/${de._id}`,se);if(as.log("Tovar yangilandi:",de._id),me.data&&me.data._id){const Le=j(g({},me.data),{warehouse:me.data.warehouse||f,images:me.data.images||Ce||[]});l(ks=>{const Ss=ks.map(ss=>ss._id===de._id?Le:ss);return Ss.sort((ss,qs)=>{const fs=parseInt(ss.code)||0,Ue=parseInt(qs.code)||0;return fs===0&&Ue===0?String(ss.code).localeCompare(String(qs.code)):fs-Ue}),Ss}),as.log("Tovar darhol UI da yangilandi:",me.data.name)}}else{const me=yield K.post("/products",se);if(as.log("Tovar serverdan qaytdi:",me.data),as.log("Tovar rasmlar:",me.data.images),me.data&&me.data._id){const Le=j(g({},me.data),{warehouse:me.data.warehouse||f,images:me.data.images||Ce||[]});as.log("UI ga qo'shilayotgan tovar:",{_id:Le._id,name:Le.name,images:Le.images,imagesCount:((A=Le.images)==null?void 0:A.length)||0}),l(ks=>{const Ss=[...ks,Le];return Ss.sort((ss,qs)=>{const fs=parseInt(ss.code)||0,Ue=parseInt(qs.code)||0;return fs===0&&Ue===0?String(ss.code).localeCompare(String(qs.code)):fs-Ue}),Ss}),as.log("Yangi tovar darhol UI ga qo'shildi:",me.data.name),Ke(""),es("all")}}Ge(),xs(),t(de?"Tovar yangilandi":"Tovar qo'shildi","Muvaffaqiyat","success"),Rs()}catch(se){as.error("Error adding/updating product:",se);const me=((ee=(O=se.response)==null?void 0:O.data)==null?void 0:ee.message)||se.message||"Xatolik yuz berdi";as.error("Error details:",{status:(ie=se.response)==null?void 0:ie.status,message:me,data:(G=se.response)==null?void 0:G.data}),t(me,"Xatolik","danger")}}),ce=i=>Q(this,null,function*(){if(yield n("Tovarni o'chirishni tasdiqlaysizmi?","O'chirish"))try{yield K.delete(`/products/${i}`),l(Z=>Z.filter(a=>a._id!==i)),as.log("Tovar UI dan o'chirildi:",i),t("Tovar o'chirildi","Muvaffaqiyat","success"),Rs()}catch(Z){as.error("Error deleting product:",Z),t("Tovarni o'chirishda xatolik","Xatolik","danger")}}),oe=i=>{var Z,a,$,A,O,ee,ie,G,se,me,Le,ks,Ss,ss,qs,fs,Ue,Qs,gt,bt,jt,vt,wt,Nt,yt,He;ke(i);const U=i;Oe(U.dollarRate||12500),Y({code:i.code,name:i.name,description:U.description||"",previousPrice:String(U.previousPrice||0),currentPrice:String(U.currentPrice||i.price),costPrice:String(U.costPrice||0),costPriceInDollar:String(U.costPriceInDollar||0),unitPrice:String(U.unitPrice||U.currentPrice||i.price),boxPrice:String(U.boxPrice||0),pricingTiers:{tier1:{minQuantity:String(((a=(Z=U.pricingTiers)==null?void 0:Z.tier1)==null?void 0:a.minQuantity)||1),maxQuantity:String(((A=($=U.pricingTiers)==null?void 0:$.tier1)==null?void 0:A.maxQuantity)||5),discountPercent:String(((ee=(O=U.pricingTiers)==null?void 0:O.tier1)==null?void 0:ee.discountPercent)||15)},tier2:{minQuantity:String(((G=(ie=U.pricingTiers)==null?void 0:ie.tier2)==null?void 0:G.minQuantity)||6),maxQuantity:String(((me=(se=U.pricingTiers)==null?void 0:se.tier2)==null?void 0:me.maxQuantity)||20),discountPercent:String(((ks=(Le=U.pricingTiers)==null?void 0:Le.tier2)==null?void 0:ks.discountPercent)||13)},tier3:{minQuantity:String(((ss=(Ss=U.pricingTiers)==null?void 0:Ss.tier3)==null?void 0:ss.minQuantity)||21),maxQuantity:String(((fs=(qs=U.pricingTiers)==null?void 0:qs.tier3)==null?void 0:fs.maxQuantity)||100),discountPercent:String(((Qs=(Ue=U.pricingTiers)==null?void 0:Ue.tier3)==null?void 0:Qs.discountPercent)||11)}},quantity:String(i.quantity),unit:i.unit||"dona",dimensions:{width:((gt=U.dimensions)==null?void 0:gt.width)||"",height:((bt=U.dimensions)==null?void 0:bt.height)||"",length:((jt=U.dimensions)==null?void 0:jt.length)||""},metersPerRoll:String(U.metersPerRoll||""),unitsPerBox:String(U.unitsPerBox||""),meterPriceRanges:((vt=U.meterPriceRanges)==null?void 0:vt.length)>0?U.meterPriceRanges.map(Us=>({from:String(Us.from||""),to:String(Us.to||""),price:String(Us.price||"")})):[{from:"",to:"",price:""}],pricePerRoll:String(((wt=i.prices)==null?void 0:wt.perRoll)||""),pricePerBox:String(((Nt=i.prices)==null?void 0:Nt.perBox)||""),pricePerKg:String(((yt=i.prices)==null?void 0:yt.perKg)||""),pricePerGram:String(((He=i.prices)==null?void 0:He.perGram)||"")}),N((U.images||[]).map(Us=>typeof Us=="string"?Us:Us.path)),$e({packageCount:"",unitsPerPackage:"",totalCost:""}),Be(""),Xe(!1),R(!0)},qe=i=>{ye(i),C(!0)},Ee=i=>{pe(U=>{const Z=new Set(U);return Z.has(i)?Z.delete(i):Z.add(i),Z})},Ae=()=>{he.size===gs.length?pe(new Set):pe(new Set(gs.map(i=>i._id)))},De=()=>{if(he.size===0){t("Kamida bitta mahsulot tanlang","Ogohlantirish","warning");return}_(!0)},os=()=>{be(!1),pe(new Set)},cs=i=>Q(this,null,function*(){var U,Z,a,$,A,O,ee,ie,G,se,me,Le,ks,Ss,ss,qs,fs,Ue,Qs,gt,bt,jt,vt,wt,Nt,yt;try{R(!0),ke(null);const He=i;Oe(He.dollarRate||12500);const Us=K.get("/products/next-code");Y({code:"",name:i.name,description:He.description||"",previousPrice:String(He.previousPrice||0),currentPrice:String(He.currentPrice||i.price),costPrice:String(He.costPrice||0),costPriceInDollar:String(He.costPriceInDollar||0),unitPrice:String(He.unitPrice||He.currentPrice||i.price),boxPrice:String(He.boxPrice||0),pricingTiers:{tier1:{minQuantity:String(((Z=(U=He.pricingTiers)==null?void 0:U.tier1)==null?void 0:Z.minQuantity)||1),maxQuantity:String((($=(a=He.pricingTiers)==null?void 0:a.tier1)==null?void 0:$.maxQuantity)||5),discountPercent:String(((O=(A=He.pricingTiers)==null?void 0:A.tier1)==null?void 0:O.discountPercent)||15)},tier2:{minQuantity:String(((ie=(ee=He.pricingTiers)==null?void 0:ee.tier2)==null?void 0:ie.minQuantity)||6),maxQuantity:String(((se=(G=He.pricingTiers)==null?void 0:G.tier2)==null?void 0:se.maxQuantity)||20),discountPercent:String(((Le=(me=He.pricingTiers)==null?void 0:me.tier2)==null?void 0:Le.discountPercent)||13)},tier3:{minQuantity:String(((Ss=(ks=He.pricingTiers)==null?void 0:ks.tier3)==null?void 0:Ss.minQuantity)||21),maxQuantity:String(((qs=(ss=He.pricingTiers)==null?void 0:ss.tier3)==null?void 0:qs.maxQuantity)||100),discountPercent:String(((Ue=(fs=He.pricingTiers)==null?void 0:fs.tier3)==null?void 0:Ue.discountPercent)||11)}},quantity:"0",unit:i.unit||"dona",dimensions:{width:((Qs=He.dimensions)==null?void 0:Qs.width)||"",height:((gt=He.dimensions)==null?void 0:gt.height)||"",length:((bt=He.dimensions)==null?void 0:bt.length)||""},metersPerRoll:String(He.metersPerRoll||""),unitsPerBox:String(He.unitsPerBox||""),meterPriceRanges:((jt=He.meterPriceRanges)==null?void 0:jt.length)>0?He.meterPriceRanges.map(Fs=>({from:String(Fs.from||""),to:String(Fs.to||""),price:String(Fs.price||"")})):[{from:"",to:"",price:""}],pricePerRoll:String(((vt=i.prices)==null?void 0:vt.perRoll)||""),pricePerBox:String(((wt=i.prices)==null?void 0:wt.perBox)||""),pricePerKg:String(((Nt=i.prices)==null?void 0:Nt.perKg)||""),pricePerGram:String(((yt=i.prices)==null?void 0:yt.perGram)||"")}),N((He.images||[]).map(Fs=>typeof Fs=="string"?Fs:Fs.path)),$e({packageCount:"",unitsPerPackage:"",totalCost:""}),Be(""),Xe(!1);try{const Fs=yield Us;Y(La=>j(g({},La),{code:Fs.data.code}))}catch(Fs){as.error("Error getting next code:",Fs),t("Keyingi kodni olishda xatolik","Xatolik","danger")}t("Mahsulot nusxalandi. Kerakli o'zgarishlarni kiriting va saqlang.","Muvaffaqiyat","success")}catch(He){as.error("Error copying product:",He),t("Mahsulotni nusxalashda xatolik","Xatolik","danger")}}),ts=i=>Q(this,null,function*(){if(T){fe(i),xe(!0);try{const U=yield K.get(`/products/stats/${T._id}?period=${i}`);te(U.data)}catch(U){as.error("Error fetching product stats:",U),t("Statistikani yuklashda xatolik","Xatolik","danger")}finally{xe(!1)}}}),Ge=()=>{R(!1)},xs=()=>{ke(null),Oe(12500),N([]),Be(""),Xe(!1),Y({code:"",name:"",description:"",quantity:"",previousPrice:"",currentPrice:"",costPrice:"",costPriceInDollar:"",unitPrice:"",boxPrice:"",pricingTiers:{tier1:{minQuantity:"1",maxQuantity:"5",discountPercent:"15"},tier2:{minQuantity:"6",maxQuantity:"20",discountPercent:"13"},tier3:{minQuantity:"21",maxQuantity:"100",discountPercent:"11"}},unit:"dona",dimensions:{width:"",height:"",length:""},metersPerRoll:"",unitsPerBox:"",meterPriceRanges:[{from:"",to:"",price:""}],pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),$e({packageCount:"",unitsPerPackage:"",totalCost:""}),N([]),ue([]),Be(""),Xe(!1)},ds=i=>{Ie(i),_e(""),je(!0)},Bs=()=>{const i=Number(Re)||0;if(i<=0)return;const U=Number(o.quantity)||0;let Z=ze==="add"?U+i:U-i;Z<0&&(Z=0),Y(j(g({},o),{quantity:String(Z)})),je(!1),_e("")},Ys=()=>Q(this,null,function*(){xs(),R(!0),N([]),Be(""),Xe(!1);try{const i=yield K.get("/products/next-code");Y(U=>j(g({},U),{code:i.data.code}))}catch(i){as.error("Error getting next code:",i),t("Keyingi kodni olishda xatolik","Xatolik","danger")}}),et=s.useMemo(()=>({total:ve.total||h.length||0,lowStock:ve.lowStock||0,outOfStock:ve.outOfStock||0,totalValue:ve.totalValue||0}),[ve,h.length]),ot=[{label:"Jami tovarlar",value:et.total,icon:Fe,color:"brand",filter:"all"},{label:"Kam qolgan",value:et.lowStock,icon:Ts,color:"warning",filter:"low"},{label:"Tugagan",value:et.outOfStock,icon:Ne,color:"danger",filter:"out"},{label:"Jami qiymat",value:`${b(et.totalValue)} so'm`,icon:ns,color:"success",filter:null}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100 pb-20 lg:pb-0",children:[r,e.jsx(Ks,{title:"Tovarlar",showSearch:!0,onSearch:Ke,actions:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>Cs(),className:"flex items-center justify-center p-0.5 rounded bg-purple-50 hover:bg-purple-100 text-purple-600 hover:text-purple-700 transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Tovarlarni qayta yuklash",children:e.jsx(kt,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),F?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Ae,className:"flex items-center justify-center px-2 py-0.5 rounded text-xs bg-purple-50 hover:bg-purple-100 text-purple-600 hover:text-purple-700 transition-all duration-200 flex-shrink-0 font-medium",style:{height:"24px",minHeight:"24px"},children:he.size===gs.length?"Bekor":"Barchasi"}),e.jsxs("button",{onClick:De,className:"flex items-center justify-center gap-1 px-2 py-0.5 rounded text-xs bg-brand-500 hover:bg-brand-600 text-white transition-all duration-200 flex-shrink-0 font-medium disabled:opacity-50 disabled:cursor-not-allowed",style:{height:"24px",minHeight:"24px"},disabled:he.size===0,children:[e.jsx(Gs,{className:"w-3 h-3",style:{width:"12px",height:"12px"}}),e.jsx("span",{children:he.size})]}),e.jsx("button",{onClick:os,className:"flex items-center justify-center p-0.5 rounded bg-surface-200 hover:bg-surface-300 transition-all duration-200 flex-shrink-0",style:{width:"24px",height:"24px",minWidth:"24px",minHeight:"24px"},children:e.jsx(Ne,{className:"w-3 h-3",style:{width:"12px",height:"12px"}})})]}):e.jsx("button",{onClick:()=>be(!0),className:"flex items-center justify-center p-0.5 rounded bg-blue-50 hover:bg-blue-100 text-blue-600 hover:text-blue-700 transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Bir nechta QR chiqarish",children:e.jsx(Va,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),e.jsx("button",{onClick:Ys,className:"flex items-center justify-center p-0.5 rounded bg-brand-500 hover:bg-brand-600 text-white transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},children:e.jsx(ms,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})})]})}),e.jsxs("div",{className:"p-2 sm:p-3 md:p-4 lg:p-6 space-y-3 sm:space-y-4 md:space-y-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-2 sm:gap-2.5 md:gap-3",children:ot.map((i,U)=>e.jsx("div",{onClick:()=>i.filter&&es(i.filter),className:`bg-white rounded-lg sm:rounded-xl border-2 transition-all ${i.filter?"cursor-pointer hover:shadow-lg hover:scale-[1.02]":""} ${Me===i.filter?"border-brand-500 shadow-md":"border-surface-200"}`,children:e.jsxs("div",{className:"p-2 sm:p-2.5 md:p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-1.5 sm:mb-2",children:[e.jsx("div",{className:`w-7 h-7 sm:w-8 sm:h-8 md:w-9 md:h-9 rounded-lg flex items-center justify-center bg-${i.color}-50`,children:e.jsx(i.icon,{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-4.5 md:h-4.5 text-${i.color}-600`})}),e.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs text-surface-500 font-medium",children:i.label})]}),e.jsx("p",{className:"text-sm sm:text-base md:text-lg lg:text-xl font-bold text-surface-900",children:i.value})]})},U))}),u?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):gs.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Fe,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Tovarlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md mb-6",children:ae?"Qidiruv bo'yicha tovarlar topilmadi":"Birinchi tovarni qo'shing"}),e.jsx("button",{onClick:Ys,className:"btn-primary",children:"Tovar qo'shish"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:L,className:"space-y-2 sm:space-y-2.5 md:space-y-3",children:gs.map(i=>{const U=he.has(i._id),Z=x(i);return e.jsxs("div",{className:`group relative bg-white rounded-lg sm:rounded-xl transition-all duration-200 hover:shadow-lg ${U?"shadow-md ring-2 ring-brand-500":"shadow-sm hover:shadow-md"}`,children:[e.jsxs("div",{className:"absolute top-1.5 right-1.5 flex items-center gap-1 z-10",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),cs(i)},className:"w-7 h-7 sm:w-8 sm:h-8 bg-blue-50 hover:bg-blue-100 rounded-lg transition-none text-blue-600 flex items-center justify-center hover:scale-110 shadow-sm hover:shadow-md",title:"Mahsulotni nusxalash",children:e.jsx(wa,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),qe(i)},className:"w-7 h-7 sm:w-8 sm:h-8 bg-purple-50 hover:bg-purple-100 rounded-lg transition-none text-purple-600 flex items-center justify-center hover:scale-110 shadow-sm hover:shadow-md",title:"QR kod",children:e.jsx(ht,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),oe(i)},className:"w-7 h-7 sm:w-8 sm:h-8 bg-amber-50 hover:bg-amber-100 rounded-lg transition-none text-amber-600 flex items-center justify-center hover:scale-110 shadow-sm hover:shadow-md",title:"Tahrirlash",children:e.jsx(lt,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),ce(i._id)},className:"w-7 h-7 sm:w-8 sm:h-8 bg-red-50 hover:bg-red-100 rounded-lg transition-none text-red-600 flex items-center justify-center hover:scale-110 shadow-sm hover:shadow-md",title:"O'chirish",children:e.jsx(zs,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5"})})]}),F&&e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx("input",{type:"checkbox",checked:U,onChange:()=>Ee(i._id),className:"w-4 h-4 sm:w-5 sm:h-5 rounded border-2 cursor-pointer"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 md:gap-4 p-2 sm:p-3 md:p-4",children:[e.jsx("div",{className:"relative w-full sm:w-24 md:w-28 h-28 sm:h-24 md:h-28 rounded-lg sm:rounded-xl overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100 cursor-pointer flex-shrink-0 shadow-sm",onClick:()=>{Z&&(ye(i),B(!0))},children:Z?e.jsx("img",{src:Z,alt:i.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Fe,{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 text-slate-300"})})}),e.jsxs("div",{className:"flex-1 min-w-0 px-2 pb-2 sm:p-0",children:[e.jsxs("div",{className:"text-xs sm:text-sm font-mono text-slate-500 mb-1 sm:mb-1.5",children:["#",i.code]}),e.jsxs("h3",{className:"font-semibold text-base sm:text-lg md:text-xl text-slate-900 mb-1.5 sm:mb-2 line-clamp-2",children:[i.name,i.description&&i.description.trim()&&e.jsx("span",{className:"text-base sm:text-lg md:text-xl font-semibold text-slate-900 ml-1.5",children:i.description})]}),e.jsxs("div",{className:"flex items-baseline gap-1 sm:gap-1.5",children:[e.jsx("span",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-brand-600",children:b(i.unitPrice||i.price)}),e.jsx("span",{className:"text-sm sm:text-base text-slate-500",children:"so'm"})]})]})]})]},i._id)})}),w>=p&&!k&&gs.length>0&&e.jsx("div",{className:"flex justify-center items-center py-6 mt-4",children:e.jsxs("div",{className:"text-slate-400 text-sm",children:["âœ… Barcha maxsulotlar yuklandi (",z," ta)"]})})]})]}),c&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-3 sm:p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/70 via-purple-900/30 to-black/70 backdrop-blur-sm transition-opacity duration-100",onClick:Ge,style:{animation:"fadeIn 0.1s ease-out"}}),e.jsxs("form",{onSubmit:V,className:"relative z-10 bg-white rounded-3xl w-full max-w-xs sm:max-w-sm md:max-w-2xl max-h-[90vh] overflow-hidden shadow-[0_20px_60px_-15px_rgba(0,0,0,0.4)] border border-white/20 transform",style:{animation:"modalSlideUp 0.1s ease-out",willChange:"transform, opacity"},children:[e.jsx("div",{className:"sticky top-0 z-10 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 px-4 sm:px-6 py-4 sm:py-5 border-b border-white/20 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white flex items-center gap-2 mb-1",children:de?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(lt,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),"Tovarni tahrirlash"]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(ms,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),"Yangi tovar qo'shish"]})}),e.jsx("p",{className:"text-xs sm:text-sm text-white/90 font-medium",children:de?"Tovar ma'lumotlarini yangilang":"Yangi tovar ma'lumotlarini kiriting"})]}),e.jsx("button",{type:"button",onClick:Ge,className:"p-2 sm:p-2.5 hover:bg-white/20 rounded-xl transition-all duration-300 hover:rotate-90 hover:scale-110 active:scale-95 group ml-3",children:e.jsx(Ne,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white group-hover:text-white/90"})})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-180px)] p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Rasmlar (max 8 ta - JPG, PNG, WebP)"}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-1 sm:gap-2 mb-1 sm:mb-2",children:[Ce.map((i,U)=>{let Z=typeof i=="string"?i:i.path;if(Z.startsWith("http://")||Z.startsWith("https://"))try{Z=new URL(Z).pathname}catch(a){console.warn("Invalid image URL:",Z)}return Z.startsWith("/")||(Z="/"+Z),e.jsxs("div",{className:"relative aspect-square group bg-surface-100 rounded-lg overflow-hidden",children:[e.jsx("img",{src:`${Ps}${Z}`,alt:`Rasm ${U+1}`,loading:"lazy",decoding:"async",className:"w-full h-full object-cover",style:{contentVisibility:"auto"}}),e.jsx("button",{type:"button",onClick:()=>ne(Z),className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2 w-7 h-7 sm:w-8 sm:h-8 bg-red-500 hover:bg-red-600 text-white rounded-lg sm:rounded-xl flex items-center justify-center shadow-lg hover:shadow-xl transition-all hover:scale-110 z-10 opacity-90 hover:opacity-100",title:"Rasmni o'chirish",children:e.jsx(Ne,{className:"w-4 h-4 sm:w-5 sm:h-5",strokeWidth:2.5})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors pointer-events-none"})]},U)}),Ce.length<8&&e.jsx("button",{type:"button",onClick:()=>{var i;return(i=hs.current)==null?void 0:i.click()},disabled:Pe,className:"aspect-square border-2 border-dashed border-surface-300 rounded-lg flex flex-col items-center justify-center hover:border-brand-500 hover:bg-brand-50 transition-colors cursor-pointer group disabled:opacity-50 disabled:cursor-not-allowed",children:Pe?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"spinner w-4 h-4 sm:w-5 sm:h-5 text-brand-600"}),e.jsx("span",{className:"text-[8px] sm:text-[9px] text-brand-600 font-semibold",children:"Yuklash..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"w-4 h-4 sm:w-5 sm:h-5 text-surface-400 mb-0.5 sm:mb-1 group-hover:text-brand-500 transition-colors"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-surface-500 text-center px-0.5 group-hover:text-brand-600 transition-colors",children:"Rasm"})]})})]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-surface-500 mb-2 sm:mb-3",children:"ðŸ’¡ Telefondan rasm olib qo'ysangiz, avtomatik sifati yaxshi bo'lib qo'yiladi. Bir vaqtning o'zida bir nechta rasmni yuklash mumkin."}),e.jsx("input",{ref:hs,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",multiple:!0,capture:"environment",onChange:d,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input text-sm ${we?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"1",value:o.code,onChange:i=>Y(j(g({},o),{code:i.target.value})),onBlur:i=>Ms(i.target.value),required:!0}),we&&e.jsx("p",{className:"text-xs text-danger-600 mt-0.5 sm:mt-1",children:we})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"Tovar nomi",value:o.name,onChange:i=>Y(j(g({},o),{name:i.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Qisqacha izoh (ixtiyoriy)"}),e.jsx("textarea",{className:"input min-h-[60px] sm:min-h-[80px] resize-none text-sm",placeholder:"Mahsulot haqida qisqacha ma'lumot...",value:o.description||"",onChange:i=>Y(j(g({},o),{description:i.target.value})),maxLength:500}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-surface-400 mt-0.5 sm:mt-1",children:[(o.description||"").length,"/500"]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 sm:pt-3 md:pt-4 mt-2 sm:mt-3 md:mt-4",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-semibold text-surface-900 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(xa,{className:"w-3 h-3 sm:w-4 sm:h-4 text-brand-600"}),"O'lchamlar (ixtiyoriy)"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Eni (sm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"50",value:o.dimensions.width,onChange:i=>Y(j(g({},o),{dimensions:j(g({},o.dimensions),{width:i.target.value})}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:o.dimensions.height,onChange:i=>Y(j(g({},o),{dimensions:j(g({},o.dimensions),{height:i.target.value})}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Uzunligi (sm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"100",value:o.dimensions.length,onChange:i=>Y(j(g({},o),{dimensions:j(g({},o.dimensions),{length:i.target.value})}))})]})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 sm:pt-3 md:pt-4 mt-2 sm:mt-3 md:mt-4",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-semibold text-surface-900 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(xa,{className:"w-3 h-3 sm:w-4 sm:h-4 text-brand-600"}),"O'lchov birligi va Miqdor"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 mb-2 sm:mb-4",children:[e.jsxs("div",{className:"w-full sm:w-1/3",children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Birlik"}),e.jsxs("select",{className:"input text-sm",value:o.unit,onChange:i=>Y(j(g({},o),{unit:i.target.value})),children:[e.jsx("option",{value:"dona",children:"Dona"}),e.jsx("option",{value:"metr",children:"Metr"}),e.jsx("option",{value:"rulon",children:"Rulon"}),e.jsx("option",{value:"karobka",children:"Karobka"}),e.jsx("option",{value:"kg",children:"Kilogram"}),e.jsx("option",{value:"gram",children:"Gram"}),e.jsx("option",{value:"litr",children:"Litr"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:["Miqdor (",o.unit==="dona"?"dona":o.unit==="metr"?"metr":o.unit==="rulon"?"rulon":o.unit==="karobka"?"karobka":o.unit==="kg"?"kg":o.unit==="gram"?"gram":"litr",")"]}),de?e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("div",{className:"flex-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-surface-100 rounded-lg text-center font-semibold text-surface-900 text-sm",children:b(o.quantity||0)}),e.jsx("button",{type:"button",onClick:()=>ds("add"),className:"btn-icon-sm bg-success-100 text-success-600 hover:bg-success-200",children:e.jsx(ms,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{type:"button",onClick:()=>ds("subtract"),className:"btn-icon-sm bg-danger-100 text-danger-600 hover:bg-danger-200",children:e.jsx(ft,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}):e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:rs(o.quantity),onChange:i=>Y(j(g({},o),{quantity:We(i.target.value)})),required:!0})]})]}),o.unit==="metr"&&e.jsxs("div",{className:"bg-purple-50 rounded-xl p-3 mb-3 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"ðŸŽžï¸ 1 rulonda necha metr?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:o.metersPerRoll,onChange:i=>Y(j(g({},o),{metersPerRoll:We(i.target.value)}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"Rulon narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:rs(o.pricePerRoll),onChange:i=>Y(j(g({},o),{pricePerRoll:We(i.target.value)}))})]})]}),o.metersPerRoll&&o.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(kt,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"text-sm font-semibold text-purple-700",children:[o.quantity," metr = ",(Number(o.quantity)/Number(o.metersPerRoll)).toFixed(1)," rulon"]})]})]}),o.unit==="dona"&&e.jsxs("div",{className:"bg-orange-50 rounded-xl p-3 mb-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"ðŸ“¦ 1 karobkada necha dona?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"12",value:o.unitsPerBox,onChange:i=>Y(j(g({},o),{unitsPerBox:We(i.target.value)}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"Karobka narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:rs(o.pricePerBox),onChange:i=>Y(j(g({},o),{pricePerBox:We(i.target.value)}))})]})]}),o.unitsPerBox&&o.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(kt,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-sm font-semibold text-orange-700",children:[o.quantity," dona = ",(Number(o.quantity)/Number(o.unitsPerBox)).toFixed(1)," karobka"]})]})]}),o.unit==="rulon"&&e.jsxs("div",{className:"bg-purple-50 rounded-xl p-3 mb-3 border border-purple-200",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"1 rulonda necha metr?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:o.metersPerRoll,onChange:i=>Y(j(g({},o),{metersPerRoll:We(i.target.value)}))})]})}),o.metersPerRoll&&o.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(kt,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"text-sm font-semibold text-purple-700",children:[o.quantity," rulon = ",b(Number(o.quantity)*Number(o.metersPerRoll))," metr"]})]})]}),o.unit==="karobka"&&e.jsxs("div",{className:"bg-orange-50 rounded-xl p-3 mb-3 border border-orange-200",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"1 karobkada necha dona?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"12",value:o.unitsPerBox,onChange:i=>Y(j(g({},o),{unitsPerBox:We(i.target.value)}))})]})}),o.unitsPerBox&&o.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(kt,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-sm font-semibold text-orange-700",children:[o.quantity," karobka = ",b(Number(o.quantity)*Number(o.unitsPerBox))," dona"]})]})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 sm:pt-3 md:pt-4 mt-2 sm:mt-3 md:mt-4",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-semibold text-surface-900 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(ns,{className:"w-3 h-3 sm:w-4 sm:h-4 text-green-600"}),"Narxlar (5 ta)"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 mb-2 sm:mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"ðŸ’µ Tan narxi (Dollar)"}),e.jsxs("div",{className:"flex gap-1 sm:gap-2",children:[e.jsx("input",{type:"text",className:"input flex-1 text-sm",placeholder:"0.00",value:o.costPriceInDollar,onChange:i=>{const U=i.target.value.replace(/[^0-9.]/g,""),Z=U.split("."),a=Z.length>2?Z[0]+"."+Z.slice(1).join(""):U,$=parseFloat(a)||0;Y(j(g({},o),{costPriceInDollar:a,costPrice:($*ge).toString()}))}}),e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-surface-600 flex items-center px-1.5 sm:px-2 bg-surface-100 rounded",children:"$"})]}),e.jsxs("p",{className:"text-[9px] sm:text-[10px] text-surface-500 mt-0.5 sm:mt-1",children:["= ",b((parseFloat(o.costPriceInDollar)||0)*ge)," so'm"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"ðŸ·ï¸ Dona narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:rs(o.unitPrice),onChange:i=>Y(j(g({},o),{unitPrice:We(i.target.value)})),required:!0})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 mb-3 border border-blue-200",children:[e.jsx("label",{className:"text-xs font-medium text-blue-700 mb-1 block",children:"ðŸ’± Dollar kursi (1 $ = ? so'm)"}),e.jsx("input",{type:"number",className:"input",placeholder:"12500",step:"1",min:"0",value:ge,onChange:i=>Oe(parseFloat(i.target.value)||12500)}),e.jsxs("p",{className:"text-[10px] text-blue-600 mt-1",children:["Hozirgi kurs: 1 $ = ",b(ge)," so'm"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"ðŸ“¦ Karobka narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:rs(o.boxPrice),onChange:i=>Y(j(g({},o),{boxPrice:We(i.target.value)}))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-green-50 rounded-xl p-2.5 border border-emerald-200 shadow-sm",children:[e.jsx("h5",{className:"text-[11px] font-semibold text-emerald-800 mb-2 flex items-center gap-1",children:"ðŸŽ¯ Chegirmalar"}),e.jsxs("div",{className:"bg-white rounded-2xl p-2 mb-1.5 border border-emerald-100 flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[9px] font-bold text-emerald-700 bg-emerald-100 px-2 py-0.5 rounded-full",children:"1"}),e.jsx("span",{className:"text-[9px] text-emerald-500 font-medium",children:"Birinci daraja"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] justify-center",children:[e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"1",value:o.pricingTiers.tier1.minQuantity,onChange:i=>Y(j(g({},o),{pricingTiers:j(g({},o.pricingTiers),{tier1:j(g({},o.pricingTiers.tier1),{minQuantity:i.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"-"}),e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"5",value:o.pricingTiers.tier1.maxQuantity,onChange:i=>Y(j(g({},o),{pricingTiers:j(g({},o.pricingTiers),{tier1:j(g({},o.pricingTiers.tier1),{maxQuantity:i.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"="}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center font-bold rounded-2xl border-indigo-300 bg-indigo-50/60 text-indigo-700 focus:border-indigo-500 focus:ring-indigo-200",placeholder:"15",value:o.pricingTiers.tier1.discountPercent,onChange:i=>Y(j(g({},o),{pricingTiers:j(g({},o.pricingTiers),{tier1:j(g({},o.pricingTiers.tier1),{discountPercent:i.target.value})})}))}),e.jsx("span",{className:"text-[11px] font-bold text-indigo-600",children:"%"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-2 mb-1.5 border border-blue-100 flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[9px] font-bold text-blue-700 bg-blue-100 px-2 py-0.5 rounded-full",children:"2"}),e.jsx("span",{className:"text-[9px] text-blue-500 font-medium",children:"Ikkinchi daraja"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] justify-center",children:[e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"6",value:o.pricingTiers.tier2.minQuantity,onChange:i=>Y(j(g({},o),{pricingTiers:j(g({},o.pricingTiers),{tier2:j(g({},o.pricingTiers.tier2),{minQuantity:i.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"-"}),e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"20",value:o.pricingTiers.tier2.maxQuantity,onChange:i=>Y(j(g({},o),{pricingTiers:j(g({},o.pricingTiers),{tier2:j(g({},o.pricingTiers.tier2),{maxQuantity:i.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"="}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center font-bold rounded-2xl border-indigo-300 bg-indigo-50/60 text-indigo-700 focus:border-indigo-500 focus:ring-indigo-200",placeholder:"13",value:o.pricingTiers.tier2.discountPercent,onChange:i=>Y(j(g({},o),{pricingTiers:j(g({},o.pricingTiers),{tier2:j(g({},o.pricingTiers.tier2),{discountPercent:i.target.value})})}))}),e.jsx("span",{className:"text-[11px] font-bold text-indigo-600",children:"%"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-2 border border-purple-100 flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[9px] font-bold text-purple-700 bg-purple-100 px-2 py-0.5 rounded-full",children:"3"}),e.jsx("span",{className:"text-[9px] text-purple-500 font-medium",children:"Uchinchi daraja"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] justify-center",children:[e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"21",value:o.pricingTiers.tier3.minQuantity,onChange:i=>Y(j(g({},o),{pricingTiers:j(g({},o.pricingTiers),{tier3:j(g({},o.pricingTiers.tier3),{minQuantity:i.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"-"}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"100",value:o.pricingTiers.tier3.maxQuantity,onChange:i=>Y(j(g({},o),{pricingTiers:j(g({},o.pricingTiers),{tier3:j(g({},o.pricingTiers.tier3),{maxQuantity:i.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"="}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center font-bold rounded-2xl border-indigo-300 bg-indigo-50/60 text-indigo-700 focus:border-indigo-500 focus:ring-indigo-200",placeholder:"11",value:o.pricingTiers.tier3.discountPercent,onChange:i=>Y(j(g({},o),{pricingTiers:j(g({},o.pricingTiers),{tier3:j(g({},o.pricingTiers.tier3),{discountPercent:i.target.value})})}))}),e.jsx("span",{className:"text-[11px] font-bold text-indigo-600",children:"%"})]})]}),e.jsx("p",{className:"text-[10px] text-emerald-600 mt-2 italic",children:"* Masalan: 1-5 dona = 15% chegirma, 6-20 dona = 13% chegirma, 21-100 dona = 11% chegirma"})]}),e.jsxs("div",{className:"mt-4 mb-4 hidden",children:[e.jsxs("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:[o.unit==="metr"?"ðŸ“ Metr narxi":o.unit==="rulon"?"ðŸŽžï¸ Rulon narxi":o.unit==="karobka"?"ðŸ“¦ Karobka narxi":o.unit==="kg"?"âš–ï¸ Kg narxi":o.unit==="gram"?"âš–ï¸ Gram narxi":o.unit==="litr"?"ðŸ’§ Litr narxi":"ðŸ’° Dona narxi"," (so'm)"]}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:rs(o.currentPrice),onChange:i=>Y(j(g({},o),{currentPrice:We(i.target.value)}))})]}),(o.unit==="metr"||o.unit==="rulon")&&e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 mb-3 border border-blue-200",children:[e.jsx("label",{className:"text-xs font-medium text-blue-700 mb-2 block",children:"ðŸ“ Metr narxlari (diapazon bo'yicha)"}),o.meterPriceRanges.map((i,U)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",className:"input text-sm w-16",placeholder:"1",value:i.from,onChange:Z=>{const a=[...o.meterPriceRanges];a[U].from=Z.target.value,Y(j(g({},o),{meterPriceRanges:a}))}}),e.jsx("input",{type:"text",className:"input text-sm w-16",placeholder:"10",value:i.to,onChange:Z=>{const a=[...o.meterPriceRanges];a[U].to=Z.target.value,Y(j(g({},o),{meterPriceRanges:a}))}}),e.jsx("input",{type:"text",className:"input text-sm flex-1",placeholder:"Narx",value:rs(i.price),onChange:Z=>{const a=[...o.meterPriceRanges];a[U].price=We(Z.target.value),Y(j(g({},o),{meterPriceRanges:a}))}}),e.jsx("span",{className:"text-xs text-blue-600",children:"so'm"}),o.meterPriceRanges.length>1&&e.jsx("button",{type:"button",onClick:()=>{const Z=o.meterPriceRanges.filter((a,$)=>$!==U);Y(j(g({},o),{meterPriceRanges:Z}))},className:"w-6 h-6 bg-red-100 text-red-600 rounded flex items-center justify-center hover:bg-red-200",children:e.jsx(Ne,{className:"w-3 h-3"})})]},U)),e.jsxs("button",{type:"button",onClick:()=>Y(j(g({},o),{meterPriceRanges:[...o.meterPriceRanges,{from:"",to:"",price:""}]})),className:"text-xs text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1",children:[e.jsx(ms,{className:"w-3 h-3"})," Diapazon qo'shish"]})]}),o.unit==="kg"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"âš–ï¸ Kg narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:rs(o.pricePerKg),onChange:i=>Y(j(g({},o),{pricePerKg:We(i.target.value)}))})]})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-gradient-to-r from-slate-50 via-blue-50 to-purple-50 px-4 sm:px-6 py-4 sm:py-5 border-t border-slate-200/50 shadow-[0_-10px_30px_-10px_rgba(0,0,0,0.1)] backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsxs("button",{type:"button",onClick:Ge,className:"px-5 sm:px-7 py-2.5 sm:py-3 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-semibold hover:bg-slate-50 hover:border-slate-400 hover:shadow-md transition-all duration-300 hover:scale-105 active:scale-95 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Bekor qilish"}),e.jsx("span",{className:"sm:hidden",children:"Bekor"})]}),e.jsxs("button",{type:"submit",disabled:!!we||Pe,className:"px-6 sm:px-10 py-2.5 sm:py-3 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 text-white rounded-xl font-bold hover:from-blue-700 hover:via-purple-700 hover:to-blue-700 transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg hover:shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center gap-2 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"}),e.jsx(ut,{className:"w-4 h-4 sm:w-5 sm:h-5 relative z-10"}),e.jsx("span",{className:"relative z-10",children:de?"Yangilash":"Saqlash"})]})]})})]})]}),P&&T&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>C(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 max-h-[90vh] overflow-y-auto rounded-t-2xl sm:rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 sticky top-0 bg-white pb-2 -mt-2 pt-2 border-b border-surface-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"QR Label - Xprinter"}),e.jsx("button",{onClick:()=>C(!1),className:"btn-icon-sm",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Wr,{productId:T._id,code:T.code,name:T.name,price:T.price,unit:T.unit,dimensions:T.dimensions?[T.dimensions.width,T.dimensions.height,T.dimensions.length].filter(Boolean).join(" Ã— "):"",labelWidth:60,labelHeight:40,copies:1,onPrint:()=>C(!1)}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-surface-200 w-full",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-3 text-center",children:"Katta QR (yuklab olish uchun)"}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-white p-3 rounded-xl border border-surface-200",children:e.jsx(At,{id:"qr-code-svg",value:`${Ut}/product/${T._id}`,size:150,level:"H",includeMargin:!0})})}),e.jsxs("button",{onClick:Ns,className:"btn-secondary w-full",children:[e.jsx(Kt,{className:"w-4 h-4"}),"PNG yuklab olish"]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg text-xs text-blue-700 w-full",children:[e.jsx("p",{className:"font-medium mb-1",children:"ðŸ“‹ Xprinter sozlamalari:"}),e.jsxs("ul",{className:"space-y-0.5",children:[e.jsx("li",{children:"â€¢ Label o'lchami: 40mm x 30mm"}),e.jsx("li",{children:"â€¢ QR o'lchami: 20mm x 20mm"}),e.jsx("li",{children:"â€¢ Margins: None"})]})]})]})]})]}),m&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>je(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-[71]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:ze==="add"?"Miqdor qo'shish":"Miqdor ayirish"}),e.jsx("button",{onClick:()=>je(!1),className:"btn-icon-sm",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${ze==="add"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Hozirgi miqdor"}),e.jsxs("p",{className:`text-2xl font-bold ${ze==="add"?"text-success-600":"text-danger-600"}`,children:[b(o.quantity||0)," dona"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:ze==="add"?"Qo'shiladigan miqdor":"Ayiriladigan miqdor"}),e.jsx("input",{type:"text",className:"input text-center text-lg font-semibold",placeholder:"0",value:rs(Re),onChange:i=>_e(We(i.target.value)),autoFocus:!0})]}),Re&&Number(Re)>0&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Yangi miqdor"}),e.jsxs("p",{className:"text-xl font-bold text-surface-900",children:[b(ze==="add"?(Number(o.quantity)||0)+Number(Re):Math.max(0,(Number(o.quantity)||0)-Number(Re)))," dona"]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>je(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"button",onClick:Bs,className:`flex-1 ${ze==="add"?"btn-success":"btn-danger"}`,disabled:!Re||Number(Re)<=0,children:ze==="add"?"Qo'shish":"Ayirish"})]})]})]})]}),le&&T&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-3 sm:p-4 bg-black/50 backdrop-blur-sm",children:[e.jsx("div",{className:"overlay",onClick:()=>Te(!1)}),e.jsxs("div",{className:"modal w-full max-w-3xl p-4 sm:p-5 relative z-50 max-h-[90vh] overflow-y-auto bg-white rounded-xl shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-surface-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[x(T)?e.jsx("img",{src:x(T),alt:T.name,className:"w-20 h-20 sm:w-24 sm:h-24 rounded-xl object-cover border-2 border-brand-200 shadow-lg"}):e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-brand-500 to-indigo-600 rounded-xl flex items-center justify-center",children:e.jsx(Fe,{className:"w-10 h-10 sm:w-12 sm:h-12 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-surface-900",children:T.name}),e.jsx("p",{className:"text-sm sm:text-base text-surface-500",children:"Sotuv statistikasi"})]})]}),e.jsx("button",{onClick:()=>Te(!1),className:"btn-icon-sm",children:e.jsx(Ne,{className:"w-4 h-4"})})]}),D?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-3"}),e.jsx("p",{className:"text-sm text-surface-500",children:"Yuklanmoqda..."})]}):W?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-3 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-md flex items-center justify-center",children:e.jsx(us,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 uppercase tracking-wide",children:"Sotilgan"})]}),e.jsx("p",{className:"text-xl font-bold text-blue-700 mb-0.5",children:b(W.stats.totalSold)}),e.jsxs("p",{className:"text-[10px] text-blue-500",children:[W.stats.totalReceipts," ta chek"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-3 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-md flex items-center justify-center",children:e.jsx(ia,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-green-600 uppercase tracking-wide",children:"Daromad"})]}),e.jsx("p",{className:"text-xl font-bold text-green-700 mb-0.5",children:b(W.stats.totalRevenue)}),e.jsx("p",{className:"text-[10px] text-green-500",children:"so'm"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-3 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-purple-500 rounded-md flex items-center justify-center",children:e.jsx(Xs,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 uppercase tracking-wide",children:"Top kun"})]}),W.stats.bestDay?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-base font-bold text-purple-700 mb-0.5",children:W.stats.bestDay.date}),e.jsxs("p",{className:"text-[10px] text-purple-500",children:[W.stats.bestDay.count," dona"]})]}):e.jsx("p",{className:"text-xs text-purple-500",children:"Ma'lumot yo'q"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-orange-500 rounded-md flex items-center justify-center",children:e.jsx(xt,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-orange-600 uppercase tracking-wide",children:"Top soat"})]}),W.stats.bestHour?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-base font-bold text-orange-700 mb-0.5",children:W.stats.bestHour.label}),e.jsxs("p",{className:"text-[10px] text-orange-500",children:[W.stats.bestHour.count," dona"]})]}):e.jsx("p",{className:"text-xs text-orange-500",children:"Ma'lumot yo'q"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-surface-200 p-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-surface-900 mb-3 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(xt,{className:"w-3 h-3 text-brand-600"})}),"Soatlik statistika"]}),e.jsx("div",{className:"flex items-end gap-0.5 h-24",children:W.hourlyStats.map((i,U)=>{var A;const Z=Math.max(...W.hourlyStats.map(O=>O.count),1),a=i.count/Z*100,$=((A=W.stats.bestHour)==null?void 0:A.hour)===i.hour;return e.jsxs("div",{className:"flex-1 flex flex-col items-center group relative",children:[e.jsx("div",{className:`w-full rounded-t transition-all ${$?"bg-gradient-to-t from-orange-500 to-amber-400":"bg-gradient-to-t from-brand-500 to-brand-400"} hover:opacity-80`,style:{height:`${Math.max(a,3)}%`}}),e.jsx("span",{className:"text-[7px] text-surface-400 mt-0.5",children:i.hour}),e.jsxs("div",{className:"absolute bottom-full mb-1 hidden group-hover:block bg-surface-900 text-white text-[10px] px-1.5 py-0.5 rounded whitespace-nowrap z-10",children:[i.label,": ",i.count]})]},U)})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-surface-200 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-surface-900 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(Xs,{className:"w-3 h-3 text-brand-600"})}),"Sotuv tarixi"]}),e.jsx("div",{className:"flex gap-1",children:[{value:"7",label:"7"},{value:"30",label:"30"},{value:"90",label:"90"},{value:"365",label:"1y"},{value:"all",label:"All"}].map(i=>e.jsx("button",{onClick:()=>ts(i.value),className:`px-2 py-1 text-[10px] font-semibold rounded transition-all ${I===i.value?"bg-brand-600 text-white shadow-sm":"bg-surface-100 text-surface-600 hover:bg-surface-200"}`,children:i.label},i.value))})]}),(I==="365"||I==="all")&&W.monthlyStats&&W.monthlyStats.length>0?e.jsx("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:W.monthlyStats.map((i,U)=>{const Z=Math.max(...W.monthlyStats.map($=>$.count),1),a=i.count/Z*100;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-surface-600 w-16 flex-shrink-0 font-medium",children:i.label}),e.jsx("div",{className:"flex-1 bg-surface-100 rounded-full h-5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-brand-500 to-indigo-500 rounded-full flex items-center justify-end pr-1.5 transition-all",style:{width:`${Math.max(a,4)}%`},children:i.count>0&&e.jsx("span",{className:"text-[9px] font-bold text-white",children:i.count})})}),e.jsx("span",{className:"text-[10px] text-surface-500 w-20 text-right",children:b(i.revenue)})]},U)})}):e.jsx("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:W.periodStats&&W.periodStats.slice(-30).map((i,U)=>{const Z=Math.max(...W.periodStats.map($=>$.count),1),a=i.count/Z*100;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-surface-600 w-14 flex-shrink-0 font-medium",children:new Date(i.date).toLocaleDateString("uz-UZ",{day:"numeric",month:"short"})}),e.jsx("div",{className:"flex-1 bg-surface-100 rounded-full h-5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-brand-500 to-indigo-500 rounded-full flex items-center justify-end pr-1.5 transition-all",style:{width:`${Math.max(a,4)}%`},children:i.count>0&&e.jsx("span",{className:"text-[9px] font-bold text-white",children:i.count})})}),e.jsx("span",{className:"text-[10px] text-surface-500 w-20 text-right",children:b(i.revenue)})]},U)})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-surface-200 p-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-surface-900 mb-3 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(us,{className:"w-3 h-3 text-brand-600"})}),"Oxirgi sotuvlar"]}),W.recentSales.length>0?e.jsx("div",{className:"overflow-x-auto max-h-48 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"sticky top-0 bg-white",children:e.jsxs("tr",{className:"border-b border-surface-200",children:[e.jsx("th",{className:"text-left py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Sana"}),e.jsx("th",{className:"text-center py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Miqdor"}),e.jsx("th",{className:"text-right py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Narx"}),e.jsx("th",{className:"text-right py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Jami"}),e.jsx("th",{className:"text-left py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Mijoz"})]})}),e.jsx("tbody",{children:W.recentSales.map((i,U)=>{var Z;return e.jsxs("tr",{className:"border-b border-surface-100 hover:bg-surface-50",children:[e.jsx("td",{className:"py-1.5 px-2 text-surface-700 text-[10px]",children:new Date(i.date).toLocaleString("uz-UZ",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"py-1.5 px-2 text-center",children:e.jsx("span",{className:"px-1.5 py-0.5 bg-brand-100 text-brand-700 rounded-full text-[10px] font-semibold",children:i.quantity})}),e.jsx("td",{className:"py-1.5 px-2 text-right text-surface-600 text-[10px]",children:b(i.price)}),e.jsx("td",{className:"py-1.5 px-2 text-right font-semibold text-surface-900 text-[10px]",children:b(i.total)}),e.jsx("td",{className:"py-1.5 px-2 text-surface-600 text-[10px]",children:((Z=i.customer)==null?void 0:Z.name)||"Noma'lum"})]},U)})})]})}):e.jsxs("div",{className:"text-center py-6 text-surface-500",children:[e.jsx(us,{className:"w-8 h-8 mx-auto mb-1.5 text-surface-300"}),e.jsx("p",{className:"text-xs",children:"Hali sotuvlar yo'q"})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-surface-500",children:[e.jsx(Dt,{className:"w-12 h-12 mx-auto mb-2 text-surface-300"}),e.jsx("p",{className:"text-sm",children:"Statistika topilmadi"})]})]})]}),X&&T&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 animate-fade-in",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm transition-all duration-300",onClick:()=>B(!1)}),e.jsxs("div",{className:"relative z-10 max-w-4xl w-full max-h-[90vh] animate-scale-in",children:[e.jsx("button",{onClick:()=>B(!1),className:"absolute -top-12 right-0 w-10 h-10 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center transition-all hover:rotate-90 group",children:e.jsx(Ne,{className:"w-6 h-6 text-white group-hover:scale-110 transition-transform"})}),e.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-brand-600 to-purple-600",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:T.name}),e.jsxs("p",{className:"text-sm text-white/80",children:["#",T.code]})]}),e.jsx("div",{className:"p-4 max-h-[70vh] overflow-y-auto",children:T.images&&T.images.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:T.images.map((i,U)=>{const Z=typeof i=="string"?i:i.path;return e.jsx("img",{src:`${Ps}${Z}`,alt:`${T.name} - ${U+1}`,className:"w-full h-auto rounded-lg shadow-lg"},U)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-surface-400",children:[e.jsx(Fe,{className:"w-16 h-16 mb-4"}),e.jsx("p",{children:"Rasm mavjud emas"})]})})]})]})]}),v&&e.jsx(Jr,{products:h.filter(i=>he.has(i._id)),onClose:()=>{_(!1),be(!1),pe(new Set)}})]})}function Gr(){const{showAlert:t,showConfirm:n,AlertComponent:r}=ws(),[h,l]=s.useState([]),[w,S]=s.useState(!1),[p,q]=s.useState(!1),[z,y]=s.useState(!1),[k,M]=s.useState(null),[f,E]=s.useState([]),[c,R]=s.useState(null),[P,C]=s.useState(null),[v,_]=s.useState(!0),[X,B]=s.useState(!1),[he,pe]=s.useState(""),[F,be]=s.useState(!1),[le,Te]=s.useState(null),[W,te]=s.useState({name:"",address:""}),[D,xe]=s.useState({code:"",name:"",costPrice:"",wholesalePrice:"",quantity:""}),[I,fe]=s.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[ve,H]=s.useState("");s.useEffect(()=>{T()},[]);const T=()=>Q(this,null,function*(){try{const je=(yield K.get("/warehouses")).data.filter(ze=>ze.name!=="Asosiy ombor");l(je)}catch(m){console.error("Error fetching warehouses:",m)}finally{_(!1)}}),ye=m=>Q(this,null,function*(){B(!0);try{const je=yield K.get(`/products?warehouse=${m}`);E(je.data)}catch(je){console.error("Error fetching products:",je)}finally{B(!1)}}),de=m=>Q(this,null,function*(){m.preventDefault();try{c?yield K.put(`/warehouses/${c._id}`,W):yield K.post("/warehouses",W),T(),es()}catch(je){console.error("Error saving warehouse:",je)}}),ke=m=>Q(this,null,function*(){var Ie,Re;if(m.preventDefault(),!k)return;if(ve){t(ve,"Xatolik","danger");return}let je=0,ze=Number(D.costPrice)||0;if(I.packageCount&&I.unitsPerPackage){const _e=Number(I.packageCount)*Number(I.unitsPerPackage);je=P?P.quantity+_e:_e}else P&&(je=P.quantity);try{const _e={code:D.code,name:D.name,costPrice:ze,price:Number(D.wholesalePrice),quantity:je,warehouse:k._id};P?yield K.put(`/products/${P._id}`,_e):yield K.post("/products",_e),ye(k._id),re()}catch(_e){t(((Re=(Ie=_e.response)==null?void 0:Ie.data)==null?void 0:Re.message)||"Xatolik yuz berdi","Xatolik","danger")}}),ae=m=>Q(this,null,function*(){if((yield n("Tovarni o'chirishni tasdiqlaysizmi?","O'chirish"))&&k)try{yield K.delete(`/products/${m}`),ye(k._id)}catch(ze){console.error("Error deleting product:",ze)}}),Ke=m=>Q(this,null,function*(){if(yield n("Omborni o'chirishni tasdiqlaysizmi?","O'chirish"))try{yield K.delete(`/warehouses/${m}`),T()}catch(ze){console.error("Error deleting warehouse:",ze)}}),is=m=>{M(m),ye(m._id),q(!0)},Ve=m=>{R(m),te({name:m.name,address:m.address||""}),S(!0)},Me=m=>{C(m),xe({code:m.code,name:m.name,costPrice:String(m.costPrice||0),wholesalePrice:String(m.price),quantity:String(m.quantity)}),H(""),y(!0)},es=()=>{S(!1),R(null),te({name:"",address:""})},u=()=>{q(!1),M(null),E([]),pe("")},re=()=>{y(!1),C(null),xe({code:"",name:"",costPrice:"",wholesalePrice:"",quantity:""}),fe({packageCount:"",unitsPerPackage:"",totalCost:""}),H("")},Pe=()=>Q(this,null,function*(){try{const m=yield K.get("/products/next-code");xe(j(g({},D),{code:m.data.code,name:"",costPrice:"",wholesalePrice:"",quantity:""}))}catch(m){console.error("Error getting next code:",m)}fe({packageCount:"",unitsPerPackage:"",totalCost:""}),H(""),y(!0)}),Qe=m=>Q(this,null,function*(){if(m)try{const je=(P==null?void 0:P._id)||"";(yield K.get(`/products/check-code/${m}${je?`?excludeId=${je}`:""}`)).data.exists?H(`Kod "${m}" allaqachon mavjud`):H("")}catch(je){console.error("Error checking code:",je)}}),ge=m=>{Te(m),be(!0)},Oe=()=>{if(!le)return;const m=document.getElementById("qr-code-svg-warehouse");if(!m)return;const je=new XMLSerializer().serializeToString(m),ze=document.createElement("canvas"),Ie=ze.getContext("2d"),Re=new Image;Re.onload=()=>{ze.width=Re.width,ze.height=Re.height,Ie==null||Ie.drawImage(Re,0,0);const _e=ze.toDataURL("image/png"),L=document.createElement("a");L.download=`QR-${le.code}-${le.name}.png`,L.href=_e,L.click()},Re.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(je)))};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsx(Ks,{title:"Omborlar",actions:e.jsxs("button",{onClick:()=>S(!0),className:"btn-primary",children:[e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi ombor"})]})}),e.jsx("div",{className:"p-4 lg:p-6",children:v?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):h.length===0?e.jsxs("div",{className:"card flex flex-col items-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(ea,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Omborlar yo'q"}),e.jsx("p",{className:"text-surface-500 mb-6",children:"Birinchi omborni qo'shing"}),e.jsx("button",{onClick:()=>S(!0),className:"btn-primary",children:"Ombor qo'shish"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(m=>e.jsxs("div",{className:"card-hover cursor-pointer",onClick:()=>is(m),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(ea,{className:"w-6 h-6 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-surface-900",children:m.name}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-surface-500",children:[e.jsx(Lt,{className:"w-3 h-3"}),e.jsx("span",{children:m.address||"Manzil ko'rsatilmagan"})]})]})]}),e.jsxs("div",{className:"flex gap-1",onClick:je=>je.stopPropagation(),children:[e.jsx("button",{onClick:()=>Ve(m),className:"btn-icon-sm hover:bg-brand-100 hover:text-brand-600",children:e.jsx(lt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ke(m._id),className:"btn-icon-sm hover:bg-danger-100 hover:text-danger-600",children:e.jsx(zs,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500 pt-3 border-t border-surface-100",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsxs("span",{children:[m.productCount||0," ta tovar"]})]})]},m._id))})}),w&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:es}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:c?"Omborni tahrirlash":"Yangi ombor"}),e.jsx("button",{onClick:es,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:de,className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Ombor nomi"}),e.jsx("input",{type:"text",className:"input",placeholder:"Ombor nomi",value:W.name,onChange:m=>te(j(g({},W),{name:m.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Manzil"}),e.jsxs("div",{className:"relative",children:[e.jsx(Lt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-12",placeholder:"Manzilni kiriting",value:W.address,onChange:m=>te(j(g({},W),{address:m.target.value}))})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:es,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Saqlash"})]})]})})]})]}),p&&k&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-2 lg:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:u}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-[98vw] lg:max-w-[95vw] relative z-10 flex flex-col max-h-[96vh] lg:max-h-[94vh]",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 lg:p-6 gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:k.name}),e.jsx("p",{className:"text-sm text-surface-500 truncate",children:"Ombordagi tovarlar"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(bs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Qidirish...",value:he,onChange:m=>pe(m.target.value),className:"w-48 lg:w-64 pl-9 pr-4 py-2 bg-surface-50 border border-surface-200 rounded-xl text-sm focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"})]}),e.jsxs("button",{onClick:Pe,className:"btn-primary",children:[e.jsx(ms,{className:"w-4 h-4"}),"Tovar qo'shish"]}),e.jsx("button",{onClick:u,className:"btn-icon-sm",children:e.jsx(Ne,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:X?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Fe,{className:"w-12 h-12 text-surface-300 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Bu omborga tovarlar yo'q"}),e.jsx("button",{onClick:Pe,className:"btn-primary mt-4",children:"Tovar qo'shish"})]}):e.jsx("div",{className:"divide-y divide-surface-100",children:f.filter(m=>he===""||m.name.toLowerCase().includes(he.toLowerCase())||m.code.toLowerCase().includes(he.toLowerCase())).map(m=>e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(Fe,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:m.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",m.code]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-surface-500",children:["Tan narxi: ",b(m.costPrice||0)," so'm"]}),e.jsxs("p",{className:"font-semibold text-surface-900",children:["Optom: ",b(m.price)," so'm"]}),e.jsxs("p",{className:`text-sm ${m.quantity===0?"text-danger-600":"text-surface-500"}`,children:[m.quantity," dona"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>ge(m),className:"btn-icon-sm hover:bg-surface-200",title:"QR kod",children:e.jsx(ht,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Me(m),className:"btn-icon-sm hover:bg-brand-100 hover:text-brand-600",children:e.jsx(lt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ae(m._id),className:"btn-icon-sm hover:bg-danger-100 hover:text-danger-600",children:e.jsx(zs,{className:"w-4 h-4"})})]})]})]},m._id))})})]})]}),z&&k&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:re}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-lg relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:P?"Tovarni tahrirlash":"Yangi tovar"}),e.jsxs("p",{className:"text-sm text-surface-500 truncate",children:[k.name," uchun"]})]}),e.jsx("button",{onClick:re,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:ke,className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input ${ve?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"000001",value:D.code,onChange:m=>xe(j(g({},D),{code:m.target.value})),onBlur:m=>Qe(m.target.value),required:!0}),ve&&e.jsx("p",{className:"text-sm text-danger-600 mt-1",children:ve})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input",placeholder:"Tovar nomi",value:D.name,onChange:m=>xe(j(g({},D),{name:m.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Tan narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:rs(D.costPrice),onChange:m=>xe(j(g({},D),{costPrice:We(m.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Optom narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:rs(D.wholesalePrice),onChange:m=>xe(j(g({},D),{wholesalePrice:We(m.target.value)})),required:!0})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4",children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-3 block",children:"Qop ma'lumotlari"}),e.jsx("div",{className:"space-y-3 bg-surface-50 p-4 rounded-xl",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Qoplar soni"}),e.jsx("input",{type:"number",className:"input text-sm",placeholder:"5",value:I.packageCount,onChange:m=>fe(j(g({},I),{packageCount:m.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Har qopda"}),e.jsx("input",{type:"number",className:"input text-sm",placeholder:"20",value:I.unitsPerPackage,onChange:m=>fe(j(g({},I),{unitsPerPackage:m.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Jami mahsulot"}),e.jsx("input",{type:"text",className:"input text-sm bg-surface-100",placeholder:"0",value:I.packageCount&&I.unitsPerPackage?b(Number(I.packageCount)*Number(I.unitsPerPackage)):"",readOnly:!0})]})]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:re,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:!!ve,children:"Saqlash"})]})]})})]})]}),F&&le&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>be(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-sm relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900",children:"QR Kod"}),e.jsx("button",{onClick:()=>be(!1),className:"flex-shrink-0 btn-icon-sm",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 flex flex-col items-center",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border border-surface-200 mb-4",children:e.jsx(At,{id:"qr-code-svg-warehouse",value:JSON.stringify({id:le._id,code:le.code,name:le.name,price:le.price}),size:200,level:"H",includeMargin:!0})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-semibold text-surface-900",children:le.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",le.code]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Tan narxi: ",b(le.costPrice||0)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Optom: ",b(le.price)," so'm"]})]}),e.jsxs("button",{onClick:Oe,className:"btn-primary w-full",children:[e.jsx(Kt,{className:"w-4 h-4"}),"Yuklab olish"]})]})})]})]})]})}const Bt={"Toshkent shahri":["Bektemir","Chilonzor","Mirobod","Mirzo Ulug'bek","Olmazor","Sergeli","Shayxontohur","Uchtepa","Yakkasaroy","Yunusobod","Yashnobod"],"Toshkent viloyati":["Angren","Bekobod","Bo'ka","Bo'stonliq","Chinoz","Chirchiq","Nurafshon","Ohangaron","Olmaliq","Oqqo'rg'on","Parkent","Piskent","Qibray","Quyi Chirchiq","Toshkent","Yangiyo'l","Yuqori Chirchiq","Zangiota"],"Andijon viloyati":["Andijon","Asaka","Baliqchi","Bo'z","Buloqboshi","Izboskan","Jalaquduq","Xo'jaobod","Qo'rg'ontepa","Marhamat","Oltinko'l","Paxtaobod","Shahrixon","Ulug'nor","Xonobod"],"Buxoro viloyati":["Buxoro","G'ijduvon","Jondor","Kogon","Olot","Peshku","Qorako'l","Qorovulbozor","Romitan","Shofirkon","Vobkent"],"Farg'ona viloyati":["Farg'ona","Bag'dod","Beshariq","Buvayda","Dang'ara","Furqat","Qo'qon","Quva","Marg'ilon","Oltiariq","Qo'shtepa","Rishton","So'x","Toshloq","Uchko'prik","Yozyovon"],"Jizzax viloyati":["Jizzax","Arnasoy","Baxmal","Do'stlik","Forish","G'allaorol","Mirzacho'l","Paxtakor","Yangiobod","Zafarobod","Zarband","Zomin"],"Xorazm viloyati":["Urganch","Bog'ot","Gurlan","Xonqa","Hazorasp","Xiva","Qo'shko'pir","Shovot","Tuproqqal'a","Yangiariq","Yangibozor"],"Namangan viloyati":["Namangan","Chortoq","Chust","Kosonsoy","Mingbuloq","Norin","Pop","To'raqo'rg'on","Uchqo'rg'on","Uychi","Yangiqo'rg'on"],"Navoiy viloyati":["Navoiy","Karmana","Konimex","Navbahor","Nurota","Qiziltepa","Tomdi","Uchquduq","Xatirchi","Zarafshon"],"Qashqadaryo viloyati":["Qarshi","Chiroqchi","Dehqonobod","G'uzor","Kasbi","Kitob","Koson","Mirishkor","Muborak","Nishon","Qamashi","Shahrisabz","Yakkabog'"],"Qoraqalpog'iston":["Nukus","Amudaryo","Beruniy","Chimboy","Ellikqal'a","Kegeyli","Mo'ynoq","Nukus tumani","Qanliko'l","Qo'ng'irot","Shumanay","Taxtako'pir","To'rtko'l","Xo'jayli"],"Samarqand viloyati":["Samarqand","Bulung'ur","Ishtixon","Jomboy","Kattaqo'rg'on","Narpay","Nurobod","Oqdaryo","Past darg'om","Payariq","Paxtachi","Qo'shrabot","Toyloq","Urgut"],"Sirdaryo viloyati":["Guliston","Boyovut","Mirzaobod","Oqoltin","Sardoba","Sayxunobod","Sirdaryo","Xovos","Yangiyer"],"Surxondaryo viloyati":["Termiz","Angor","Bandixon","Boysun","Denov","Jarqo'rg'on","Muzrabot","Oltinsoy","Qiziriq","Qumqo'rg'on","Sariosiyo","Sherobod","Sho'rchi","Uzun"]},ta=Object.keys(Bt);function Zr(){var fe,ve;const{showConfirm:t,showAlert:n,AlertComponent:r}=ws(),[h,l]=s.useState([]),[w,S]=s.useState(!0),[p,q]=s.useState(!1),[z,y]=s.useState(null),[k,M]=s.useState(""),[f,E]=s.useState(null),[c,R]=s.useState({name:"",phone:"",region:"",district:""}),[P,C]=s.useState(""),[v,_]=s.useState(""),[X,B]=s.useState(!1),[he,pe]=s.useState("name");s.useEffect(()=>{F()},[]);const F=()=>Q(this,null,function*(){try{const H=yield K.get("/customers");l(H.data)}catch(H){console.error(H),n("Mijozlarni yuklashda xatolik","Xatolik","danger")}finally{S(!1)}}),be=H=>Q(this,null,function*(){H.preventDefault();try{const T={name:c.name,phone:c.phone,address:c.region&&c.district?`${c.region}, ${c.district}`:""};z?(yield K.put(`/customers/${z._id}`,T),n("Mijoz yangilandi","Muvaffaqiyat","success")):(yield K.post("/customers",T),n("Mijoz qo'shildi","Muvaffaqiyat","success")),F(),W()}catch(T){console.error(T),n("Xatolik yuz berdi","Xatolik","danger")}}),le=H=>Q(this,null,function*(){if(yield t("Mijozni o'chirishni tasdiqlaysizmi?","O'chirish")){E(H);try{yield K.delete(`/customers/${H}`),l(h.filter(ye=>ye._id!==H)),n("Mijoz o'chirildi","Muvaffaqiyat","success"),setTimeout(()=>{E(null)},2e3)}catch(ye){E(null),console.error(ye),n("Xatolik yuz berdi","Xatolik","danger")}}}),Te=H=>{y(H);const T=(H.address||"").split(", ");R({name:H.name,phone:H.phone,region:T[0]||"",district:T[1]||""}),q(!0)},W=()=>{q(!1),y(null),R({name:"",phone:"",region:"",district:""})},te=h.filter(H=>{const T=k.trim()===""||H.name.toLowerCase().includes(k.toLowerCase())||H.phone.includes(k);let ye=!0;if(P){const de=(H.address||"").split(", "),ke=de[0]||"",ae=de[1]||"";ye=ke===P,ye&&v&&(ye=ae===v)}return T&&ye}).sort((H,T)=>he==="debt"?(T.debt||0)-(H.debt||0):he==="purchases"?(T.totalPurchases||0)-(H.totalPurchases||0):H.name.localeCompare(T.name)),D={total:h.length,withDebt:h.filter(H=>H.debt>0).length,totalDebt:h.reduce((H,T)=>H+(T.debt||0),0),totalPurchases:h.reduce((H,T)=>H+(T.totalPurchases||0),0)},xe=()=>P?v?`${P}, ${v}`:P:"Barcha hududlar",I=()=>{C(""),_("")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100 pb-20 lg:pb-0",children:[r,e.jsx(Ks,{title:"Mijozlar",showSearch:!0,onSearch:M,actions:e.jsxs("button",{onClick:()=>q(!0),className:"btn-primary",children:[e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi mijoz"})]})}),e.jsxs("div",{className:"max-w-[1800px] mx-auto p-4 lg:p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-3 lg:gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Jami"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Is,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-blue-600"})})]}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-slate-900",children:D.total}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"mijozlar"})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Qarzli"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(ca,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-red-600"})})]}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-slate-900",children:D.withDebt}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"ta"})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Qarz"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(ns,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-red-600"})})]}),e.jsx("p",{className:"text-base sm:text-xl lg:text-2xl font-bold text-red-600",children:b(D.totalDebt)}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"so'm"})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Xarid"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(us,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-green-600"})})]}),e.jsx("p",{className:"text-base sm:text-xl lg:text-2xl font-bold text-green-600",children:b(D.totalPurchases)}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"so'm"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 flex flex-col sm:flex-row gap-2 sm:gap-3 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs("button",{onClick:()=>B(!X),className:`flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors whitespace-nowrap ${P?"bg-brand-100 text-brand-700":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:[e.jsx(Lt,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),e.jsx("span",{className:"max-w-[120px] sm:max-w-none truncate",children:xe()}),e.jsx(Mt,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})]}),X&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>B(!1)}),e.jsxs("div",{className:"absolute left-0 sm:left-auto sm:right-0 top-full mt-2 w-[calc(100vw-2rem)] sm:w-72 bg-white rounded-xl shadow-xl border border-slate-200 z-50 p-3 sm:p-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-slate-700",children:"Hudud filtri"}),P&&e.jsx("button",{onClick:I,className:"text-xs text-brand-600 hover:text-brand-700 font-medium",children:"Tozalash"})]}),e.jsxs("select",{className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 text-xs sm:text-sm mb-2",value:P,onChange:H=>{C(H.target.value),_("")},children:[e.jsx("option",{value:"",children:"Barcha viloyatlar"}),ta.map(H=>e.jsx("option",{value:H,children:H},H))]}),P&&e.jsxs("select",{className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 text-xs sm:text-sm",value:v,onChange:H=>_(H.target.value),children:[e.jsx("option",{value:"",children:"Barcha tumanlar"}),(fe=Bt[P])==null?void 0:fe.map(H=>e.jsx("option",{value:H,children:H},H))]})]})]})]}),e.jsxs("select",{value:he,onChange:H=>pe(H.target.value),className:"px-3 sm:px-4 py-2 border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 text-xs sm:text-sm font-medium bg-white flex-shrink-0",children:[e.jsx("option",{value:"name",children:"Ism"}),e.jsx("option",{value:"debt",children:"Qarz"}),e.jsx("option",{value:"purchases",children:"Xarid"})]})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-slate-500 whitespace-nowrap",children:[te.length," ta"]})]}),w?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):te.length===0?e.jsxs("div",{className:"bg-white rounded-xl border-2 border-slate-200 flex flex-col items-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Is,{className:"w-8 h-8 text-slate-400"})}),P?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Bu hududda mijozlar yo'q"}),e.jsxs("p",{className:"text-slate-500 mb-6 text-center",children:[e.jsx("span",{className:"font-medium text-brand-600",children:v?`${P}, ${v}`:P})," da hech qanday mijoz topilmadi"]}),e.jsxs("button",{onClick:I,className:"px-6 py-2 bg-brand-500 hover:bg-brand-600 text-white font-semibold rounded-lg transition-colors",children:[e.jsx(Ne,{className:"w-4 h-4 inline mr-2"}),"Filterni tozalash"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Mijozlar yo'q"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Birinchi mijozni qo'shing"}),e.jsx("button",{onClick:()=>q(!0),className:"px-6 py-2 bg-brand-500 hover:bg-brand-600 text-white font-semibold rounded-lg transition-colors",children:"Mijoz qo'shish"})]})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 lg:gap-6",children:te.map(H=>e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 hover:border-brand-300 hover:shadow-lg transition-all p-4 sm:p-5 lg:p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 lg:w-14 lg:h-14 bg-gradient-to-br from-brand-100 to-brand-50 rounded-lg sm:rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"font-bold text-sm sm:text-base lg:text-lg text-brand-600",children:H.name.charAt(0)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-bold text-slate-900 text-sm sm:text-base lg:text-lg truncate",children:H.name}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500 truncate",children:Ma(H.phone)})]})]}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-shrink-0 ml-2",children:[e.jsx("button",{onClick:()=>Te(H),className:"p-1.5 sm:p-2 hover:bg-blue-100 text-blue-600 rounded-lg transition-colors",title:"Tahrirlash",children:e.jsx(lt,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:()=>le(H._id),disabled:f===H._id,className:"p-1.5 sm:p-2 hover:bg-red-100 text-red-600 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"O'chirish",children:f===H._id?e.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):e.jsx(zs,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),H.address&&e.jsxs("div",{className:"mb-3 sm:mb-4 pb-3 sm:pb-4 border-b border-slate-100",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mb-1",children:"Manzil"}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-700 font-medium truncate",children:H.address})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-2.5 sm:p-3 border border-green-200",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-green-600 font-semibold mb-0.5 sm:mb-1",children:"Xaridlar"}),e.jsx("p",{className:"text-base sm:text-lg font-bold text-green-700 truncate",children:b(H.totalPurchases||0)}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-green-600 mt-0.5 sm:mt-1",children:[H.purchaseCount||0," ta"]})]}),e.jsxs("div",{className:`rounded-lg p-2.5 sm:p-3 border ${H.debt>0?"bg-gradient-to-br from-red-50 to-rose-50 border-red-200":"bg-gradient-to-br from-emerald-50 to-green-50 border-emerald-200"}`,children:[e.jsx("p",{className:`text-[10px] sm:text-xs font-semibold mb-0.5 sm:mb-1 ${H.debt>0?"text-red-600":"text-emerald-600"}`,children:H.debt>0?"Qarz":"Qarz yo'q"}),e.jsx("p",{className:`text-base sm:text-lg font-bold truncate ${H.debt>0?"text-red-700":"text-emerald-700"}`,children:b(H.debt)})]})]})]},H._id))})]}),p&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-4 py-3 text-white flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-bold",children:z?"Mijozni tahrirlash":"Yangi mijoz"}),e.jsx("button",{onClick:W,className:"hover:bg-brand-600 p-1 rounded-lg transition-colors",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:be,className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Ism"}),e.jsx("input",{className:"w-full px-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",placeholder:"Mijoz ismi",value:c.name,onChange:H=>R(j(g({},c),{name:H.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Telefon"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{className:"w-full pl-10 pr-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",placeholder:"+998 (XX) XXX-XX-XX",value:c.phone,onChange:H=>R(j(g({},c),{phone:pt(H.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Viloyat"}),e.jsxs("select",{className:"w-full px-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",value:c.region,onChange:H=>R(j(g({},c),{region:H.target.value,district:""})),children:[e.jsx("option",{value:"",children:"Viloyatni tanlang"}),ta.map(H=>e.jsx("option",{value:H,children:H},H))]})]}),c.region&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Tuman"}),e.jsxs("select",{className:"w-full px-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",value:c.district,onChange:H=>R(j(g({},c),{district:H.target.value})),children:[e.jsx("option",{value:"",children:"Tumanni tanlang"}),(ve=Bt[c.region])==null?void 0:ve.map(H=>e.jsx("option",{value:H,children:H},H))]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:W,className:"flex-1 px-3 py-2 text-xs font-semibold bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"flex-1 px-3 py-2 text-xs font-semibold bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white rounded-lg transition-all shadow-lg",children:"Saqlash"})]})]})]})})]})}function fa(){var es;const{user:t}=Zs(),n=(t==null?void 0:t.role)==="admin",{showConfirm:r,showAlert:h,AlertComponent:l}=ws(),[w,S]=s.useState([]),[p,q]=s.useState([]),[z,y]=s.useState({total:0,approved:0,today:0,overdue:0,paid:0,blacklist:0,totalAmount:0,pendingApproval:0}),[k,M]=s.useState(!1),[f,E]=s.useState(!1),[c,R]=s.useState(null),[P,C]=s.useState(!0),[v,_]=s.useState("receivable"),[X,B]=s.useState({customer:"",creditorName:"",amount:"",dueDate:"",description:"",collateral:""}),[he,pe]=s.useState(""),[F,be]=s.useState(""),[le,Te]=s.useState("all"),[W,te]=s.useState(!1),[D,xe]=s.useState({name:"",phone:"",region:"",district:""}),[I,fe]=s.useState(null);s.useEffect(()=>{ve(),H(),T()},[v]);const ve=()=>Q(this,null,function*(){try{const u=yield K.get(`/debts?type=${v}`);S(u.data)}catch(u){console.error("Error fetching debts:",u)}finally{C(!1)}}),H=()=>Q(this,null,function*(){try{const u=yield K.get("/customers");q(u.data)}catch(u){console.error("Error fetching customers:",u)}}),T=()=>Q(this,null,function*(){try{const u=yield K.get(`/debts/stats?type=${v}`);y(u.data)}catch(u){console.error("Error fetching stats:",u)}}),ye=u=>Q(this,null,function*(){u.preventDefault();try{const re={type:v,customer:v==="receivable"?X.customer:void 0,creditorName:v==="payable"?X.creditorName:void 0,amount:Number(X.amount),dueDate:X.dueDate,description:X.description,collateral:X.collateral};I?yield K.put(`/debts/${I._id}`,re):(yield K.post("/debts",re),h("Qarz muvaffaqiyatli qo'shildi","Muvaffaqiyat","success")),ve(),T(),ke()}catch(re){console.error("Error saving debt:",re),h("Qarz qo'shishda xatolik yuz berdi","Xatolik","danger")}}),de=u=>Q(this,null,function*(){if(u.preventDefault(),!!c)try{yield K.post(`/debts/${c._id}/payment`,{amount:Number(he),method:"cash"}),ve(),T(),E(!1),R(null),pe("")}catch(re){console.error("Error making payment:",re)}}),ke=()=>{M(!1),fe(null),B({customer:"",creditorName:"",amount:"",dueDate:"",description:"",collateral:""}),te(!1),xe({name:"",phone:"",region:"",district:""})},ae=()=>Q(this,null,function*(){if(!(!D.name||!D.phone))try{const u={name:D.name,phone:D.phone,address:D.region&&D.district?`${D.region}, ${D.district}`:""},re=yield K.post("/customers",u);yield H(),B(j(g({},X),{customer:re.data._id})),te(!1),xe({name:"",phone:"",region:"",district:""})}catch(u){console.error("Error creating customer:",u)}}),Ke=w.filter(u=>{var Oe,m;const re=((Oe=u.customer)==null?void 0:Oe.name)||u.creditorName||"",Pe=((m=u.customer)==null?void 0:m.phone)||"",Qe=re.toLowerCase().includes(F.toLowerCase())||Pe.includes(F);let ge=!0;if(le==="today"){const je=new Date;je.setHours(0,0,0,0);const ze=new Date(je.getTime()+864e5),Ie=new Date(u.dueDate);ge=Ie>=je&&Ie<ze&&u.status!=="paid"}else le!=="all"&&(ge=u.status===le);return Qe&&ge}),is=[{label:"AKTIV",value:z.approved,icon:Js,color:"success",filter:"approved"},{label:"TO'LANGAN",value:z.paid,icon:Js,color:"success",filter:"paid"},{label:"MUDDATI O'TGAN",value:z.overdue,icon:ca,color:"danger",filter:"overdue"},{label:"QORA RO'YXAT",value:z.blacklist,icon:Ts,color:"danger",filter:"blacklist"},{label:"JAMI QARZ",value:`${b(z.totalAmount)} so'm`,icon:Ga,color:"accent",filter:null}],Ve=u=>{var re;return(re=u.customer)!=null&&re.name?u.customer.name:u.creditorName||"Noma'lum"},Me=u=>{var re;return((re=u.customer)==null?void 0:re.phone)||""};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[l,e.jsx(Ks,{title:"Qarz daftarcha",showSearch:!0,onSearch:be,actions:e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:()=>M(!0),className:"w-5 h-5 md:w-9 md:h-9 rounded-full bg-brand-500 hover:bg-brand-600 text-white flex items-center justify-center shadow-sm hover:shadow-md transition-all active:scale-95",title:"Yangi qarz qo'shish",children:e.jsx(ms,{className:"w-2.5 h-2.5 md:w-4.5 md:h-4.5"})})})}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[n&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"inline-flex p-1 bg-surface-100 rounded-xl",children:[e.jsxs("button",{onClick:()=>{_("receivable"),Te("all")},className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all ${v==="receivable"?"bg-white text-success-600 shadow-sm":"text-surface-500 hover:text-surface-700"}`,children:[e.jsx(ua,{className:"w-4 h-4"}),"Menga qarzdor"]}),e.jsxs("button",{onClick:()=>{_("payable"),Te("all")},className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all ${v==="payable"?"bg-white text-danger-600 shadow-sm":"text-surface-500 hover:text-surface-700"}`,children:[e.jsx(Gt,{className:"w-4 h-4"}),"Men qarzdorman"]})]})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4",children:is.map((u,re)=>e.jsx("div",{onClick:()=>u.filter&&Te(u.filter),className:`group relative ${u.filter?"cursor-pointer":""}`,children:e.jsxs("div",{className:`relative bg-white/90 backdrop-blur-xl rounded-2xl p-4 sm:p-5 shadow-xl border border-white/20 hover:shadow-2xl transition-all duration-500 hover:scale-[1.02] overflow-hidden h-[140px] sm:h-[160px] flex flex-col ${le===u.filter?"ring-2 ring-brand-500":""}`,children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${u.color==="success"?"from-emerald-500 to-emerald-600":u.color==="danger"?"from-red-500 to-red-600":"from-purple-500 to-purple-600"} opacity-[0.03] group-hover:opacity-[0.08] transition-all duration-700`}),e.jsx("div",{className:`absolute -right-8 -top-8 w-32 h-32 bg-gradient-to-br ${u.color==="success"?"from-emerald-500 to-emerald-600":u.color==="danger"?"from-red-500 to-red-600":"from-purple-500 to-purple-600"} opacity-[0.08] rounded-full blur-3xl group-hover:opacity-[0.15] group-hover:scale-125 transition-all duration-700`}),e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 bg-gradient-to-r ${u.color==="success"?"from-emerald-500 to-emerald-600":u.color==="danger"?"from-red-500 to-red-600":"from-purple-500 to-purple-600"} opacity-60 group-hover:opacity-100 transition-all duration-500`}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center shadow-lg transition-all duration-500 group-hover:scale-110 group-hover:rotate-3 ${u.color==="success"?"bg-gradient-to-br from-emerald-100 to-emerald-50":u.color==="danger"?"bg-gradient-to-br from-red-100 to-red-50":"bg-gradient-to-br from-purple-100 to-purple-50"}`,children:e.jsx(u.icon,{className:`w-5 h-5 sm:w-6 sm:h-6 ${u.color==="success"?"text-emerald-600":u.color==="danger"?"text-red-600":"text-purple-600"}`})})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-end",children:[e.jsx("p",{className:`text-lg sm:text-xl lg:text-2xl font-extrabold mb-0.5 transition-all duration-500 group-hover:scale-105 ${u.color==="success"?"text-emerald-600":u.color==="danger"?"text-red-600":"text-purple-600"}`,children:u.value}),e.jsx("p",{className:"text-[9px] sm:text-[10px] font-bold text-slate-600 uppercase tracking-wider leading-tight",children:u.label})]})]}),e.jsx("div",{className:"absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 bg-gradient-to-r from-transparent via-white/10 to-transparent"})]})},re))}),e.jsx("div",{className:"card p-0 overflow-hidden",children:P?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):Ke.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Ts,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Qarzlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:F||le!=="all"?"Filtr bo'yicha qarzlar topilmadi":"Hozircha qarzlar yo'q"})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-3 sm:gap-4 md:gap-5 p-3 sm:p-4 md:p-5",children:Ke.map(u=>{const re=u.status==="paid",Pe=u.status==="overdue",Qe=u.status==="approved",ge=u.status==="blacklist",Oe=u.amount-u.paidAmount,m=Math.round(u.paidAmount/u.amount*100),je=new Date(u.dueDate),ze=new Date;ze.setHours(0,0,0,0);const Ie=Math.ceil((je.getTime()-ze.getTime())/(1e3*60*60*24)),Re=!re&&(Pe||Ie<=0),_e=!re&&!Re&&Ie<=3,L=!re&&!Re&&!_e&&Ie<=7,o=Re?"border-red-400 ring-2 ring-red-200":_e?"border-orange-400 ring-2 ring-orange-200":L?"border-amber-400 ring-1 ring-amber-200":ge?"border-slate-700 ring-2 ring-slate-400":"border-surface-200 hover:border-brand-300";return e.jsxs("div",{className:`bg-white rounded-xl sm:rounded-2xl border ${o} hover:shadow-xl transition-all duration-300 overflow-hidden group ${Re?"animate-pulse-slow":""}`,children:[e.jsxs("div",{className:`relative p-3 sm:p-4 ${ge?"bg-gradient-to-br from-slate-800 to-slate-900":Re?"bg-gradient-to-br from-red-100 to-rose-100":_e?"bg-gradient-to-br from-orange-50 to-amber-50":L?"bg-gradient-to-br from-amber-50 to-yellow-50":v==="receivable"?"bg-gradient-to-br from-emerald-50 to-green-50":"bg-gradient-to-br from-red-50 to-rose-50"}`,children:[!re&&Ie<=7&&e.jsx("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-lg text-[10px] font-bold ${Re?"bg-red-500 text-white animate-pulse":_e?"bg-orange-500 text-white":"bg-amber-500 text-white"}`,children:Pe||Ie<0?`${Math.abs(Ie)} kun o'tdi!`:Ie===0?"Bugun!":`${Ie} kun qoldi`}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center shadow-lg ${ge?"bg-gradient-to-br from-slate-900 to-black":Re?"bg-gradient-to-br from-red-500 to-rose-600":_e?"bg-gradient-to-br from-orange-400 to-amber-500":L?"bg-gradient-to-br from-amber-400 to-yellow-500":v==="receivable"?"bg-gradient-to-br from-emerald-400 to-green-500":"bg-gradient-to-br from-red-400 to-rose-500"}`,children:e.jsx(ls,{className:`w-6 h-6 ${ge?"text-amber-300":"text-white"}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-bold text-surface-900 truncate text-sm sm:text-base",children:Ve(u)}),Me(u)&&e.jsxs("p",{className:"text-xs sm:text-sm text-surface-500 flex items-center gap-1",children:[e.jsx(Ls,{className:"w-3 h-3"}),Me(u)]})]})]}),e.jsxs("div",{className:`px-3 py-1.5 rounded-xl text-[10px] sm:text-xs font-semibold flex items-center gap-1.5 ${ge?"bg-gradient-to-r from-slate-900 to-black text-amber-300 shadow-lg shadow-slate-500":Qe?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg shadow-green-200":"bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow-lg shadow-blue-200"}`,children:[ge?e.jsx(Ts,{className:"w-3 h-3"}):Qe?e.jsx(Js,{className:"w-3 h-3"}):e.jsx(Xs,{className:"w-3 h-3"}),e.jsx("span",{children:ge?"Qora ro'yxat":re?"To'langan":Pe?"Muddati o'tgan":Qe?"Aktiv":"Jarayonda"})]})]}),!re&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-[10px] sm:text-xs text-surface-600 mb-1",children:[e.jsxs("span",{children:["To'langan: ",m,"%"]}),e.jsxs("span",{children:[b(u.paidAmount)," / ",b(u.amount)]})]}),e.jsx("div",{className:`h-2 rounded-full overflow-hidden ${Re?"bg-red-200":_e?"bg-orange-200":L?"bg-amber-200":"bg-white/60"}`,children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${Re?"bg-red-500":_e?"bg-orange-500":L?"bg-amber-500":v==="receivable"?"bg-emerald-500":"bg-red-500"}`,style:{width:`${m}%`}})})]})]}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[e.jsxs("div",{className:"bg-surface-50 rounded-xl p-1.5 sm:p-3 border border-surface-100",children:[e.jsx("p",{className:"text-[9px] sm:text-xs text-surface-500 uppercase tracking-wide font-semibold mb-0.5 sm:mb-1",children:"Jami qarz"}),e.jsx("p",{className:"font-bold text-surface-900 text-xs sm:text-base",children:b(u.amount)}),e.jsx("p",{className:"text-[9px] text-surface-400",children:"so'm"})]}),e.jsxs("div",{className:`rounded-xl p-1.5 sm:p-3 border ${v==="receivable"?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"}`,children:[e.jsx("p",{className:"text-[9px] sm:text-xs text-surface-500 uppercase tracking-wide font-semibold mb-0.5 sm:mb-1",children:"Qoldiq"}),e.jsx("p",{className:`font-bold text-xs sm:text-base ${v==="receivable"?"text-emerald-600":"text-red-600"}`,children:b(Oe)}),e.jsx("p",{className:"text-[9px] text-surface-400",children:"so'm"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3 text-[10px] sm:text-sm",children:[e.jsxs("div",{className:"flex flex-col gap-0.5 sm:gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 text-surface-600",children:[e.jsx(Xs,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),e.jsx("span",{children:new Date(u.dueDate).toLocaleDateString("uz-UZ")})]}),u.extensionDays>0&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-blue-50 rounded-md text-blue-700 text-[9px] sm:text-[10px] font-medium border border-blue-200",children:["ðŸ“… ",u.extensionDays," kun muddat"]})]}),v==="receivable"&&u.collateral&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-amber-50 rounded-lg text-amber-700 text-[9px] sm:text-[10px] font-medium border border-amber-200 max-w-[100px] truncate",children:["ðŸ”’ ",u.collateral]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-1.5 sm:gap-2 pt-2 sm:pt-3 border-t border-surface-100 flex-wrap",children:[n&&e.jsxs("button",{onClick:()=>Q(this,null,function*(){try{yield K.delete(`/debts/${u._id}`),ve(),T()}catch(Y){console.error("Error deleting debt:",Y)}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-red-100 text-red-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-red-200 transition-all whitespace-nowrap",title:"Qarzni o'chirish",children:[e.jsx(zs,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"O'chirish"})]}),n&&!re&&e.jsxs(e.Fragment,{children:[u.extensionCount===void 0||u.extensionCount<3?e.jsxs("button",{onClick:()=>Q(this,null,function*(){var $e,Ce;const Y=prompt("Necha kun muddat berilsin?");if(!Y)return;const Se=parseInt(Y,10);if(!(Number.isNaN(Se)||Se<=0))try{yield K.post(`/debts/${u._id}/extend`,{days:Se}),ve(),T()}catch(N){console.error("Error extending debt:",N),h(((Ce=($e=N.response)==null?void 0:$e.data)==null?void 0:Ce.message)||"Muddat berishda xatolik","Xatolik","danger")}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-amber-100 text-amber-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-amber-200 transition-all whitespace-nowrap",children:[e.jsx(Xs,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{children:"Muddat"})]}):null,e.jsxs("button",{onClick:()=>Q(this,null,function*(){var Se,$e;if(yield r("Bu qarzni to'landi deb belgilaysizmi? Qoldiq summa nol bo'ladi.","Bo'ldi"))try{const Ce=u.amount-u.paidAmount;Ce>0&&(yield K.post(`/debts/${u._id}/payment`,{amount:Ce,method:"cash"})),ve(),T(),h("Qarz to'landi deb belgilandi","Muvaffaqiyat","success")}catch(Ce){console.error("Error marking debt as paid:",Ce),h((($e=(Se=Ce.response)==null?void 0:Se.data)==null?void 0:$e.message)||"Qarz to'landi deb belgilashda xatolik","Xatolik","danger")}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-emerald-100 text-emerald-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-emerald-200 transition-all whitespace-nowrap",children:[e.jsx(Js,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{children:"Bo'ldi"})]})]}),!re&&e.jsxs("button",{onClick:()=>{R(u),E(!0)},className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-emerald-100 text-emerald-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-emerald-200 transition-all whitespace-nowrap",children:[e.jsx(ns,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{children:"To'lov"})]}),n&&ge&&e.jsxs("button",{onClick:()=>Q(this,null,function*(){var Se,$e;if(yield r("Ushbu mijozni qora ro'yxatdan chiqarasizmi?","Qora ro'yxatdan chiqarish"))try{yield K.post(`/debts/${u._id}/remove-blacklist`),ve(),T(),h("Mijoz qora ro'yxatdan chiqarildi","Muvaffaqiyat","success")}catch(Ce){console.error("Error removing from blacklist:",Ce),h((($e=(Se=Ce.response)==null?void 0:Se.data)==null?void 0:$e.message)||"Qora ro'yxatdan chiqarishda xatolik","Xatolik","danger")}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-slate-800 text-amber-300 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-slate-900 transition-all whitespace-nowrap",children:[e.jsx(Ts,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Qora ro'yxatdan chiqarish"}),e.jsx("span",{className:"sm:hidden",children:"Chiqarish"})]})]})]})]},u._id)})})})})]}),k&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:ke}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:I?"Qarzni tahrirlash":"Yangi qarz"}),e.jsx("button",{onClick:ke,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[n&&e.jsxs("div",{className:"flex p-1 bg-surface-100 rounded-xl mb-6",children:[e.jsxs("button",{type:"button",onClick:()=>_("receivable"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg transition-all ${v==="receivable"?"bg-white text-success-600 shadow-sm":"text-surface-500"}`,children:[e.jsx(ua,{className:"w-4 h-4"}),"Menga qarzdor"]}),e.jsxs("button",{type:"button",onClick:()=>_("payable"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg transition-all ${v==="payable"?"bg-white text-danger-600 shadow-sm":"text-surface-500"}`,children:[e.jsx(Gt,{className:"w-4 h-4"}),"Men qarzdorman"]})]}),e.jsxs("form",{onSubmit:ye,className:"space-y-4",children:[e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ts,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-amber-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"Diqqat!"}),e.jsx("p",{children:"Qo'shilgan qarz darhol mijozning umumiy qarziga qo'shiladi. Shuning uchun ma'lumotlarni diqqat bilan kiriting."})]})]})}),v==="receivable"?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Mijoz"}),W?e.jsxs("div",{className:"space-y-3 p-3 bg-surface-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-brand-600",children:"Yangi mijoz"}),e.jsx("button",{type:"button",onClick:()=>te(!1),className:"text-surface-400 hover:text-surface-600",children:e.jsx(Ne,{className:"w-4 h-4"})})]}),e.jsx("input",{type:"text",className:"input",placeholder:"Mijoz ismi",value:D.name,onChange:u=>xe(j(g({},D),{name:u.target.value}))}),e.jsxs("div",{className:"relative",children:[e.jsx(Ls,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-12",placeholder:"+998 (XX) XXX-XX-XX",value:D.phone,onChange:u=>xe(j(g({},D),{phone:pt(u.target.value)}))})]}),e.jsxs("select",{className:"select text-sm",value:D.region,onChange:u=>xe(j(g({},D),{region:u.target.value,district:""})),children:[e.jsx("option",{value:"",children:"Viloyatni tanlang"}),ta.map(u=>e.jsx("option",{value:u,children:u},u))]}),D.region&&e.jsxs("select",{className:"select text-sm",value:D.district,onChange:u=>xe(j(g({},D),{district:u.target.value})),children:[e.jsx("option",{value:"",children:"Tumanni tanlang"}),(es=Bt[D.region])==null?void 0:es.map(u=>e.jsx("option",{value:u,children:u},u))]}),e.jsxs("button",{type:"button",onClick:ae,disabled:!D.name||!D.phone,className:"btn-primary w-full",children:[e.jsx(ra,{className:"w-4 h-4"}),"Mijozni yaratish"]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"select flex-1",value:X.customer,onChange:u=>B(j(g({},X),{customer:u.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Tanlang"}),p.map(u=>e.jsxs("option",{value:u._id,children:[u.name," - ",u.phone]},u._id))]}),e.jsx("button",{type:"button",onClick:()=>te(!0),className:"btn-icon bg-brand-100 text-brand-600 hover:bg-brand-200",title:"Yangi mijoz qo'shish",children:e.jsx(ms,{className:"w-5 h-5"})})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Kimga qarzdorman"}),e.jsx("input",{type:"text",className:"input",placeholder:"Ism yoki kompaniya nomi",value:X.creditorName,onChange:u=>B(j(g({},X),{creditorName:u.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Summa (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:rs(X.amount),onChange:u=>B(j(g({},X),{amount:We(u.target.value)})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Muddat"}),e.jsx("input",{type:"date",className:"input",value:X.dueDate,onChange:u=>B(j(g({},X),{dueDate:u.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Izoh (ixtiyoriy)"}),e.jsx("input",{type:"text",className:"input",placeholder:"Qarz haqida izoh",value:X.description,onChange:u=>B(j(g({},X),{description:u.target.value}))})]}),v==="receivable"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Zalog (ixtiyoriy)"}),e.jsx("input",{type:"text",className:"input",placeholder:"Zalogga nima qoldirdi",value:X.collateral,onChange:u=>B(j(g({},X),{collateral:u.target.value}))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:ke,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Saqlash"})]})]})]})})]})]}),f&&c&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>E(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900",children:"To'lov qilish"}),e.jsx("button",{onClick:()=>E(!1),className:"flex-shrink-0 btn-icon-sm",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${v==="receivable"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Qoldiq summa"}),e.jsxs("p",{className:`text-2xl font-bold ${v==="receivable"?"text-success-600":"text-danger-600"}`,children:[b(c.amount-c.paidAmount)," so'm"]})]}),e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"To'lov summasi"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:rs(he),onChange:u=>pe(We(u.target.value)),required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>E(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-success flex-1",children:"To'lash"})]})]})]})})]})]})]})}function el(){const{showAlert:t,showConfirm:n,AlertComponent:r}=ws(),h=_s(),[l,w]=s.useState([]),[S,p]=s.useState(!0),[q,z]=s.useState(null),[y,k]=s.useState(null);s.useEffect(()=>{M()},[]);const M=()=>Q(this,null,function*(){try{const c=yield K.get("/debts?status=pending_approval");w(c.data)}catch(c){console.error("Error fetching pending debts:",c)}finally{p(!1)}}),f=c=>Q(this,null,function*(){var R,P;z(c);try{yield K.post(`/debts/${c}/approve`),w(l.filter(C=>C._id!==c)),t("Qarz muvaffaqiyatli tasdiqlandi","Muvaffaqiyat","success")}catch(C){z(null),console.error("Error approving debt:",C),t(((P=(R=C.response)==null?void 0:R.data)==null?void 0:P.message)||"Xatolik yuz berdi","Xatolik","danger")}}),E=c=>Q(this,null,function*(){var P,C;if(yield n("Bu qarzni rad etasizmi?","Rad etish")){k(c);try{yield K.post(`/debts/${c}/reject`),w(l.filter(v=>v._id!==c)),t("Qarz rad etildi","Muvaffaqiyat","success")}catch(v){k(null),console.error("Error rejecting debt:",v),t(((C=(P=v.response)==null?void 0:P.data)==null?void 0:C.message)||"Xatolik yuz berdi","Xatolik","danger")}}});return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsx(Ks,{title:"Qarz tasdiqlash",actions:e.jsxs("button",{onClick:()=>h("/admin/debts"),className:"btn-secondary",children:[e.jsx(Na,{className:"w-4 h-4"}),"Orqaga"]})}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-4xl mx-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-6 border border-amber-200",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 rounded-xl flex items-center justify-center",children:e.jsx(Ts,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-amber-900",children:"Tasdiqlashni kutayotgan qarzlar"}),e.jsxs("p",{className:"text-sm text-amber-700",children:[l.length," ta qarz kassachi tomonidan qo'shilgan va sizning tasdiqlashingizni kutmoqda"]})]})]})}),S?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Js,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Barcha qarzlar ko'rib chiqildi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:"Hozirda tasdiqlashni kutayotgan qarzlar yo'q. Yangi qarzlar qo'shilganda bu yerda ko'rinadi."})]}):e.jsx("div",{className:"space-y-4",children:l.map(c=>{var R,P;return e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-amber-200 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center",children:e.jsx(ls,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-lg",children:(R=c.customer)==null?void 0:R.name}),e.jsx("p",{className:"text-surface-500",children:(P=c.customer)==null?void 0:P.phone}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-surface-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Muddat: ",new Date(c.dueDate).toLocaleDateString("uz-UZ")]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ns,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium text-lg",children:[b(c.amount)," so'm"]})]})]})]})]}),e.jsxs("span",{className:"badge badge-amber",children:[e.jsx(Ts,{className:"w-3 h-3"}),"Kutilmoqda"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[c.description&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("h5",{className:"font-medium text-surface-700 mb-2",children:"Izoh"}),e.jsx("p",{className:"text-surface-600 text-sm",children:c.description})]}),c.collateral&&e.jsxs("div",{className:"bg-amber-50 rounded-xl p-4",children:[e.jsx("h5",{className:"font-medium text-amber-700 mb-2",children:"Zalog"}),e.jsx("p",{className:"text-amber-600 text-sm",children:c.collateral})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>E(c._id),disabled:y===c._id||q===c._id,className:"btn-secondary flex-1 text-red-600 hover:bg-red-50 hover:border-red-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:y===c._id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Rad etilmoqda..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-4 h-4"}),"Rad etish"]})}),e.jsx("button",{onClick:()=>f(c._id),disabled:q===c._id||y===c._id,className:"btn-primary flex-1 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:q===c._id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Tasdiqlanamoqda..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Js,{className:"w-4 h-4"}),"Tasdiqlash"]})})]})]},c._id)})})]})]})}function sl(){const[t,n]=s.useState([]),[r,h]=s.useState("all"),[l,w]=s.useState(!0);s.useEffect(()=>{S()},[]);const S=()=>Q(this,null,function*(){try{const k=yield K.get("/orders");n(k.data)}catch(k){console.error("Error fetching orders:",k)}finally{w(!1)}}),p=(k,M)=>Q(this,null,function*(){try{yield K.put(`/orders/${k}/status`,{status:M}),S()}catch(f){console.error("Error updating order:",f)}}),q={new:{color:"brand",label:"Yangi",icon:xt},processing:{color:"warning",label:"Jarayonda",icon:Fe},shipped:{color:"accent",label:"Yo'lda",icon:er},delivered:{color:"success",label:"Yetkazildi",icon:Js},cancelled:{color:"danger",label:"Bekor qilindi",icon:Za}},z=[{value:"all",label:"Barchasi"},...Object.entries(q).map(([k,M])=>({value:k,label:M.label}))],y=t.filter(k=>r==="all"||k.status===r);return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[e.jsx(Ks,{title:"Buyurtmalar",filterOptions:z,filterValue:r,onFilterChange:h}),e.jsx("div",{className:"p-4 lg:p-6",children:e.jsx("div",{className:"card p-0 overflow-hidden",children:l?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Rt,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Buyurtmalar topilmadi"}),e.jsx("p",{className:"text-surface-500",children:"Hozircha buyurtmalar yo'q"})]}):e.jsx("div",{className:"divide-y divide-surface-100",children:y.map(k=>{var f;const M=q[k.status];return e.jsx("div",{className:"p-4 lg:p-6 hover:bg-surface-50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(Fe,{className:"w-6 h-6 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-surface-900",children:["Buyurtma #",k._id.slice(-6)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500 mt-1",children:[e.jsx(ls,{className:"w-4 h-4"}),e.jsx("span",{children:((f=k.customer)==null?void 0:f.name)||"Noma'lum mijoz"})]})]}),e.jsx("select",{value:k.status,onChange:E=>p(k._id,E.target.value),className:`select text-sm py-2 px-3 bg-${M.color}-50 text-${M.color}-700 border-${M.color}-200`,children:Object.entries(q).map(([E,c])=>e.jsx("option",{value:E,children:c.label},E))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-surface-500",children:[e.jsxs("span",{children:[k.items.length," ta mahsulot"]}),e.jsx("span",{children:new Date(k.createdAt).toLocaleDateString("uz-UZ")})]}),e.jsxs("p",{className:"font-bold text-surface-900",children:[k.total.toLocaleString()," so'm"]})]})]})]})},k._id)})})})})]})}function tl(){const{showConfirm:t,showAlert:n,AlertComponent:r}=ws(),[h,l]=s.useState([]),[w,S]=s.useState([]),[p,q]=s.useState(null),[z,y]=s.useState([]),[k,M]=s.useState(!1),[f,E]=s.useState(!1),[c,R]=s.useState(!1),[P,C]=s.useState(null),[v,_]=s.useState(null),[X,B]=s.useState(!0),[he,pe]=s.useState(!1),[F,be]=s.useState(!1),[le,Te]=s.useState(null),[W,te]=s.useState({name:"",phone:"",password:"",role:"helper",bonusPercentage:0}),[D,xe]=s.useState({name:"",login:"",phone:"",password:"",confirmPassword:"",role:"helper",bonusPercentage:0}),[I,fe]=s.useState(!1);s.useEffect(()=>{H(),T(),ve()},[]);const ve=()=>Q(this,null,function*(){try{const u=yield K.get("/auth/admin/kassa-users");if(u.data.success&&u.data.users.length>0){const re=u.data.users[0];q({login:re.login,name:re.name})}}catch(u){console.error("Error fetching kassa user:",u)}}),H=()=>Q(this,null,function*(){try{const u=yield K.get("/auth/admin/helpers");l(u.data.users||u.data)}catch(u){console.error("Error fetching helpers:",u)}finally{B(!1)}}),T=()=>Q(this,null,function*(){try{const u=yield K.get("/receipts/helpers-stats");S(u.data)}catch(u){console.error("Error fetching helpers stats:",u)}}),ye=u=>Q(this,null,function*(){pe(!0);try{const re=yield K.get(`/receipts/helper/${u}/receipts`);y(re.data.receipts)}catch(re){console.error("Error fetching helper receipts:",re)}finally{pe(!1)}}),de=u=>{C(u),R(!0),ye(u._id)},ke=u=>{const re=pt(u.target.value);te(j(g({},W),{phone:re}))},ae=u=>Q(this,null,function*(){var re,Pe;u.preventDefault(),be(!0);try{const Qe=g(g({name:W.name,phone:Qt(W.phone),role:W.role},W.password&&{password:W.password}),W.role==="cashier"&&{bonusPercentage:W.bonusPercentage});if(v)yield K.put(`/auth/admin/helpers/${v._id}`,Qe),S(w.map(ge=>ge._id===v._id?j(g({},ge),{name:W.name,role:W.role,bonusPercentage:W.bonusPercentage}):ge)),l(h.map(ge=>ge._id===v._id?j(g({},ge),{name:W.name,role:W.role,phone:Qt(W.phone)}):ge));else{yield K.post("/users",j(g({},Qe),{password:W.password}));const ge={_id:Math.random().toString(),name:W.name,role:W.role,receiptCount:0,totalAmount:0,bonusPercentage:W.bonusPercentage||0,totalEarnings:0,totalBonus:0};S([...w,ge])}setTimeout(()=>{Ve(),be(!1)},2e3)}catch(Qe){be(!1),alert(((Pe=(re=Qe.response)==null?void 0:re.data)==null?void 0:Pe.message)||"Xatolik yuz berdi")}}),Ke=u=>Q(this,null,function*(){var Pe,Qe;if(yield t(`"${u.name}" yordamchisini o'chirishni tasdiqlaysizmi?`,"Yordamchini o'chirish")){Te(u._id);try{yield K.delete(`/auth/admin/helpers/${u._id}`),S(w.filter(ge=>ge._id!==u._id)),l(h.filter(ge=>ge._id!==u._id)),n("Yordamchi muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),setTimeout(()=>{Te(null)},2e3)}catch(ge){Te(null),console.error("Error deleting helper:",ge),n(`Yordamchini o'chirishda xatolik: ${((Qe=(Pe=ge.response)==null?void 0:Pe.data)==null?void 0:Qe.message)||ge.message}`,"Xatolik","danger")}}}),is=u=>{_(u),te({name:u.name,phone:Ma(u.phone),password:"",role:u.role,bonusPercentage:u.bonusPercentage||0}),M(!0)},Ve=()=>{M(!1),_(null),te({name:"",phone:"",password:"",role:"helper",bonusPercentage:0})},Me=()=>{E(!1),xe({name:"",login:"",phone:"",password:"",confirmPassword:"",role:"helper",bonusPercentage:0})},es=u=>Q(this,null,function*(){var re,Pe;if(u.preventDefault(),D.password!==D.confirmPassword){n("Parollar mos kelmadi","Xatolik","danger");return}if(D.password.length<6){n("Parol kamida 6 ta belgidan iborat bo'lishi kerak","Xatolik","danger");return}fe(!0);try{const Qe={name:D.name,login:D.login,phone:Qt(D.phone),password:D.password};console.log("ðŸ“¤ Xodim yaratish so'rovi:",Qe);const ge=yield K.post("/auth/admin/helpers",Qe);console.log("âœ… Server javobi:",ge.data);const Oe={_id:ge.data.user._id,name:ge.data.user.name,login:ge.data.user.login,phone:ge.data.user.phone,role:ge.data.user.role,receiptCount:0,totalAmount:0,totalEarnings:0,totalBonus:0};S([...w,Oe]),n("Xodim muvaffaqiyatli qo'shildi","Muvaffaqiyat","success"),setTimeout(()=>{Me(),fe(!1)},2e3)}catch(Qe){fe(!1),n(((Pe=(re=Qe.response)==null?void 0:re.data)==null?void 0:Pe.message)||"Xatolik yuz berdi","Xatolik","danger")}});return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[r,e.jsx(Ks,{title:"Yordamchilar",actions:e.jsxs("button",{onClick:()=>E(!0),className:"btn-primary",children:[e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yordamchi qo'shish"})]})}),e.jsx("div",{className:"p-4 lg:p-6",children:X?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):h.length===0?e.jsxs("div",{className:"card flex flex-col items-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(ra,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Yordamchilar yo'q"}),e.jsx("p",{className:"text-surface-500 mb-6",children:"Birinchi yordamchini qo'shing"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-6 shadow-lg border-2 border-purple-400",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(Vs,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white text-lg",children:"Kassa Paneli Kodi"}),e.jsx("p",{className:"text-purple-100 text-sm",children:"Admin tomonidan belgilangan login va parol"})]})]}),e.jsx("div",{className:"bg-white/20 backdrop-blur-sm px-3 py-1 rounded-lg",children:e.jsx("span",{className:"text-white text-xs font-semibold",children:"Maxsus"})})]}),p?e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Ism:"}),e.jsx("span",{className:"text-white font-bold",children:p.name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Login:"}),e.jsx("span",{className:"text-white font-bold",children:p.login})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Parol:"}),e.jsx("span",{className:"text-white font-bold",children:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-white/20",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Rol:"}),e.jsx("span",{className:"bg-white/20 text-white px-3 py-1 rounded-lg text-xs font-semibold",children:"Kassir"})]}),e.jsx("div",{className:"pt-3 border-t border-white/20",children:e.jsxs("a",{href:"/admin/settings",className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white rounded-lg font-semibold transition-all duration-300 hover:shadow-lg",children:[e.jsx(vs,{className:"w-4 h-4"}),"Parolni o'zgartirish"]})})]}):e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-white text-sm",children:"Kassa foydalanuvchisi topilmadi"}),e.jsx("p",{className:"text-purple-100 text-xs mt-2",children:"Admin sozlamalarida kassa yarating"})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-purple-100 text-xs",children:[e.jsx(vs,{className:"w-4 h-4"}),e.jsx("span",{children:"Bu karta o'chirib bo'lmaydi. Faqat Admin Sozlamalari â†’ Kassa Foydalanuvchilari bo'limida o'zgartirish mumkin."})]})]}),e.jsx("h2",{className:"text-lg font-semibold text-surface-900 mb-4",children:"Kassirlar statistikasi"}),w.length===0?e.jsx("p",{className:"text-surface-500 text-center py-8",children:"Hali cheklar chiqarilmagan"}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 max-w-4xl",children:w.map(u=>e.jsxs("div",{className:"group bg-white rounded-xl p-3 shadow-sm border border-surface-200 hover:shadow-lg hover:border-brand-300 transition-all duration-300 hover:-translate-y-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center text-white font-bold text-base flex-shrink-0",children:u.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm text-surface-900 truncate",title:u.name,children:u.name}),e.jsx("span",{className:`inline-block text-[10px] px-1.5 py-0.5 rounded-full font-semibold mt-0.5 ${u.role==="cashier"?"bg-success-100 text-success-700":"bg-brand-100 text-brand-700"}`,children:u.role==="cashier"?"Kassir":"Yordamchi"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 pt-4 border-t border-surface-100 flex-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-bold text-brand-600",children:u.receiptCount}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Cheklar"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-success-600",children:b(u.totalAmount)}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Savdo"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xl font-bold text-orange-600",children:[u.bonusPercentage,"%"]}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Bonus"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6 pt-4 border-t border-surface-100",children:[e.jsx("button",{onClick:re=>{re.stopPropagation();const Pe=h.find(Qe=>Qe.name===u.name);Pe&&is(Pe)},className:"p-2.5 hover:bg-brand-100 hover:text-brand-600 text-surface-400 rounded-lg transition-all hover:shadow-md hover:-translate-y-0.5",title:"Tahrirlash",children:e.jsx(lt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:re=>{re.stopPropagation(),de(u)},className:"p-2.5 hover:bg-blue-100 hover:text-blue-600 text-surface-400 rounded-lg transition-all hover:shadow-md hover:-translate-y-0.5",title:"Cheklar",children:e.jsx(Ds,{className:"w-4 h-4"})}),e.jsx("button",{onClick:re=>{re.stopPropagation(),Ke(u)},disabled:le===u._id,className:"p-2.5 hover:bg-danger-100 hover:text-danger-600 text-surface-400 rounded-lg transition-all hover:shadow-md hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed",title:"O'chirish",children:le===u._id?e.jsx("div",{className:"w-4 h-4 border-2 border-danger-600 border-t-transparent rounded-full animate-spin"}):e.jsx(zs,{className:"w-4 h-4"})})]})]},u._id))})]})}),f&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-3 md:p-4 bg-black/50",children:[e.jsx("div",{className:"overlay",onClick:Me}),e.jsxs("div",{className:"modal w-full max-w-[95%] xs:max-w-sm sm:max-w-md p-3 sm:p-4 md:p-5 relative z-50 max-h-[85vh] overflow-y-auto bg-white rounded-xl sm:rounded-2xl shadow-2xl my-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3 pb-2 sm:pb-3 border-b border-surface-200",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-surface-900",children:"Yordamchi qo'shish"}),e.jsx("button",{onClick:Me,className:"btn-icon-sm",children:e.jsx(Ne,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("form",{onSubmit:es,className:"space-y-2 sm:space-y-3 flex flex-col h-full",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Ism"}),e.jsxs("div",{className:"relative",children:[e.jsx(ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Yordamchi ismi",value:D.name,onChange:u=>xe(j(g({},D),{name:u.target.value})),disabled:I,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Login"}),e.jsxs("div",{className:"relative",children:[e.jsx(ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Login (foydalanuvchi nomi)",value:D.login,onChange:u=>xe(j(g({},D),{login:u.target.value})),disabled:I,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Telefon raqam"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"tel",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"+998 (XX) XXX-XX-XX",value:D.phone,onChange:u=>xe(j(g({},D),{phone:pt(u.target.value)})),disabled:I,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Parol"}),e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"password",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Kamida 6 ta belgi",value:D.password,onChange:u=>xe(j(g({},D),{password:u.target.value})),disabled:I,required:!0,minLength:6})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Parolni tasdiqlash"}),e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"password",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Parolni qayta kiriting",value:D.confirmPassword,onChange:u=>xe(j(g({},D),{confirmPassword:u.target.value})),disabled:I,required:!0,minLength:6})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-2 block",children:"Rol"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>xe(j(g({},D),{role:"cashier"})),disabled:I,className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed ${D.role==="cashier"?"border-success-500 bg-success-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(us,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${D.role==="cashier"?"text-success-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Kassir"})]}),e.jsxs("button",{type:"button",onClick:()=>xe(j(g({},D),{role:"helper"})),disabled:I,className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed ${D.role==="helper"?"border-brand-500 bg-brand-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(Vs,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${D.role==="helper"?"text-brand-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Yordamchi"})]})]})]}),D.role==="cashier"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Bonus foizi (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ns,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"number",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Masalan: 1",value:D.bonusPercentage,min:"0",max:"100",step:"0.1",disabled:I,onChange:u=>xe(j(g({},D),{bonusPercentage:parseFloat(u.target.value)||0}))})]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-surface-500 mt-0.5 sm:mt-1",children:[D.bonusPercentage,"% bonus"]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 mt-auto border-t border-surface-100",children:[e.jsx("button",{type:"button",onClick:Me,disabled:I,className:"btn-secondary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Bekor"}),e.jsx("button",{type:"submit",disabled:I,className:"btn-primary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Qo'shilmoqda..."})]}):"Qo'shish"})]})]})]})]}),k&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-3 md:p-4 bg-black/50",children:[e.jsx("div",{className:"overlay",onClick:Ve}),e.jsxs("div",{className:"modal w-full max-w-[95%] xs:max-w-sm sm:max-w-md p-3 sm:p-4 md:p-5 relative z-50 max-h-[85vh] overflow-y-auto bg-white rounded-xl sm:rounded-2xl shadow-2xl my-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3 pb-2 sm:pb-3 border-b border-surface-200",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-surface-900",children:v?"Tahrirlash":"Yangi yordamchi"}),e.jsx("button",{onClick:Ve,className:"btn-icon-sm",children:e.jsx(Ne,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("form",{onSubmit:ae,className:"space-y-2 sm:space-y-3 flex flex-col h-full",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Ism"}),e.jsxs("div",{className:"relative",children:[e.jsx(ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-9 text-sm",placeholder:"Yordamchi ismi",value:W.name,onChange:u=>te(j(g({},W),{name:u.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Telefon raqam"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"tel",className:"input pl-9 text-sm",placeholder:"+998 (XX) XXX-XX-XX",value:W.phone,onChange:ke,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:v?"Yangi parol (ixtiyoriy)":"Parol"}),e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",g({type:"password",className:"input pl-9 text-sm",placeholder:v?"O'zgartirmaslik uchun bo'sh qoldiring":"Parol",value:W.password,onChange:u=>te(j(g({},W),{password:u.target.value}))},!v&&{required:!0,minLength:6}))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-2 block",children:"Rol"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>te(j(g({},W),{role:"cashier"})),className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm ${W.role==="cashier"?"border-success-500 bg-success-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(us,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${W.role==="cashier"?"text-success-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Kassir"})]}),e.jsxs("button",{type:"button",onClick:()=>te(j(g({},W),{role:"helper"})),className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm ${W.role==="helper"?"border-brand-500 bg-brand-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(Vs,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${W.role==="helper"?"text-brand-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Yordamchi"})]})]})]}),W.role==="cashier"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Bonus foizi (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ns,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"number",className:"input pl-9 text-sm",placeholder:"Masalan: 1",value:W.bonusPercentage,min:"0",max:"100",step:"0.1",onChange:u=>te(j(g({},W),{bonusPercentage:parseFloat(u.target.value)||0}))})]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-surface-500 mt-0.5 sm:mt-1",children:[W.bonusPercentage,"% bonus"]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 mt-auto border-t border-surface-100",children:[e.jsx("button",{type:"button",onClick:Ve,disabled:F,className:"btn-secondary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Bekor"}),e.jsx("button",{type:"submit",disabled:F,className:"btn-primary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:F?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Saqlanmoqda..."})]}):"Saqlash"})]})]})]})]}),c&&P&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-2 sm:p-3 md:p-4 bg-black/50",children:["`n          ",e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>R(!1)}),e.jsxs("div",{className:"modal w-full max-w-[98%] sm:max-w-[95%] md:max-w-4xl max-h-[90vh] overflow-hidden relative z-50 bg-white rounded-2xl shadow-2xl",children:[e.jsxs("div",{className:"p-6 border-b border-surface-100 bg-gradient-to-r from-brand-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center text-white font-bold text-lg",children:P.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-surface-900",children:P.name}),e.jsx("span",{className:`text-sm px-3 py-1 rounded-full font-medium ${P.role==="cashier"?"bg-success-100 text-success-700":"bg-brand-100 text-brand-700"}`,children:P.role==="cashier"?"Kassir":"Yordamchi"})]})]}),e.jsx("button",{onClick:()=>R(!1),className:"btn-icon-sm hover:bg-white/50",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(Os,{className:"w-5 h-5 text-brand-600"})}),e.jsx("p",{className:"text-2xl font-bold text-surface-900",children:P.receiptCount}),e.jsx("p",{className:"text-xs text-surface-500",children:"Cheklar"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(ns,{className:"w-5 h-5 text-success-600"})}),e.jsx("p",{className:"text-lg font-bold text-success-600",children:b(P.totalAmount)}),e.jsx("p",{className:"text-xs text-surface-500",children:"Savdo"})]}),P.bonusPercentage>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx("span",{className:"text-orange-500 font-bold",children:"%"})}),e.jsxs("p",{className:"text-lg font-bold text-orange-600",children:[P.bonusPercentage,"%"]}),e.jsx("p",{className:"text-xs text-surface-500",children:"Bonus foizi"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(ns,{className:"w-5 h-5 text-green-600"})}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:b(P.totalAmount*P.bonusPercentage/100)}),e.jsx("p",{className:"text-xs text-surface-500",children:"Jami bonus"})]})]})]})]}),e.jsx("div",{className:"p-6 overflow-auto max-h-[calc(90vh-120px)]",children:he?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):z.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(Os,{className:"w-12 h-12 mx-auto mb-4 text-surface-400"}),e.jsx("p",{className:"text-surface-500",children:"Cheklar topilmadi"})]}):e.jsx("div",{className:"space-y-3",children:z.map(u=>e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-surface-100 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(Os,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-surface-900",children:["Chek #",u._id.slice(-6)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500",children:[e.jsx(Xs,{className:"w-4 h-4"}),new Date(u.createdAt).toLocaleString("uz-UZ")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-brand-600",children:b(u.total)}),e.jsx("p",{className:"text-sm text-surface-500",children:"so'm"})]})]}),e.jsxs("div",{className:"border-t border-surface-100 pt-4",children:[e.jsx("h5",{className:"text-sm font-medium text-surface-700 mb-3",children:"Mahsulotlar:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:u.items.map((re,Pe)=>e.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-surface-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-surface-700 font-medium",children:re.name}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-sm text-surface-600",children:[re.quantity," Ã— ",b(re.price)]}),e.jsxs("p",{className:"text-sm font-semibold text-surface-900",children:[b(re.price*re.quantity)," so'm"]})]})]},Pe))})]})]},u._id))})})]})]})]})}const Da=t=>{const n=t.date||new Date,r=t.receiptNumber||`CHK-${Date.now()}`,h=t.cashier||"Kassa";let l="";l+=`========================
`,l+=`SARDOR FURNITURA
`,l+=`========================
`,l+=`
`,l+=`CHK: ${r}
`,l+=`${n.toLocaleDateString("uz-UZ")} ${n.toLocaleTimeString("uz-UZ",{hour:"2-digit",minute:"2-digit"})}
`,l+=`KASSIR: ${h}
`,t.customer&&(l+=`MIJOZ: ${t.customer.name}
`,l+=`TEL: ${t.customer.phone}
`),l+=`------------------------
`;let w=0,S=0;if(t.items.forEach((k,M)=>{l+=`${M+1}. ${k.name}
`,l+=`   ${k.code}
`;const f=k.previousPrice,E=k.currentPrice||k.price;if(w+=(f&&f>0?f:E)*k.cartQuantity,S+=E*k.cartQuantity,f&&f>0&&f!==E){const c=Math.round((f-E)/f*100);l+=`   OLDINGI: ${b(f)}
`,l+=`   HOZIRGI: ${b(E)}`,c>0?l+=` (-${c}%)
`:c<0?l+=` (+${Math.abs(c)}%)
`:l+=`
`}else l+=`   NARXI: ${b(k.price)}
`;l+=`   ${k.cartQuantity} x ${b(E)}
`,l+=`   = ${b(E*k.cartQuantity)}
`,l+=`
`}),l+=`------------------------
`,l+=`JAMI: ${b(t.total)}
`,w>S){const k=w-S,M=Math.round(k/w*100);l+=`CHEGIRMA: ${b(k)}
`,l+=`(${M}%)
`}const p=t.items.reduce((k,M)=>{var f;return k+(((f=M.paymentBreakdown)==null?void 0:f.cash)||0)},0),q=t.items.reduce((k,M)=>{var f;return k+(((f=M.paymentBreakdown)==null?void 0:f.click)||0)},0),z=t.items.reduce((k,M)=>{var f;return k+(((f=M.paymentBreakdown)==null?void 0:f.card)||0)},0);p>0&&(l+=`NAQT: ${b(p)}
`),q>0&&(l+=`CLICK: ${b(q)}
`),z>0&&(l+=`KARTA: ${b(z)}
`),l+=`TO'LOV: ${t.paymentMethod==="cash"?"NAQD":t.paymentMethod==="click"?"CLICK":"KARTA"}
`;const y=Math.floor(t.total/1e6);return y>0&&(l+=`------------------------
`,l+=`BALL: +${y} BALL!
`),t.customer&&t.customer.totalBalls&&(l+=`JAMI: ${t.customer.totalBalls} BALL
`),l+=`========================
`,l+=`XARIDINGIZ UCHUN
`,l+=`RAHMAT!
`,l+=`========================
`,l+=`
`,l+=`âš ï¸ VAZVRAT CHEKSIZ âš ï¸
`,l+=`QABUL QILINMAYDI
`,l+=`========================
`,l},al=(t,n)=>Q(Ze,null,function*(){var r;try{const h=Da(t),l=document.createElement("iframe");l.style.position="absolute",l.style.left="-9999px",l.style.top="-9999px",l.style.width="1px",l.style.height="1px",l.style.visibility="hidden",l.style.opacity="0",document.body.appendChild(l);const w=l.contentDocument||((r=l.contentWindow)==null?void 0:r.document);if(!w)throw new Error("Iframe document topilmadi");const S=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>X PRINTER CHEK</title>
          <meta charset="UTF-8">
          <style>
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            
            body {
              font-family: 'Courier New', monospace;
              font-size: 12px;
              font-weight: bold;
              line-height: 1.2;
              color: #000;
              background: white;
              padding: 0;
              margin: 0 auto;
              display: flex;
              justify-content: center;
              align-items: flex-start;
              width: 100%;
            }
            
            .receipt-text {
              white-space: pre-line;
              font-family: 'Courier New', monospace;
              font-size: 12px;
              font-weight: bold;
              word-break: break-word;
              padding: 5px;
              text-align: center;
              width: 58mm;
              margin: 0 auto;
            }
            
            /* X Printer uchun maxsus print sozlamalari */
            @media print {
              @page {
                size: 58mm auto;
                margin: 0;
                padding: 0;
              }
              
              body {
                background: white;
                font-size: 10px;
                font-weight: bold;
                padding: 0;
                margin: 0 auto;
                width: 58mm;
                display: flex;
                justify-content: center;
                align-items: flex-start;
              }
              
              .receipt-text {
                width: 58mm;
                font-weight: bold;
                font-size: 10px;
                padding: 2mm;
                text-align: center;
                margin: 0 auto;
              }
            }
          </style>
        </head>
        <body>
          <div class="receipt-text">${h}</div>
          
          <script>
            // X Printer uchun print tugagandan keyin callback
            window.addEventListener('afterprint', function() {
              console.log('X Printer: Print tugadi');
              if (window.parent && window.parent.xPrinterCompleted) {
                window.parent.xPrinterCompleted();
              }
            });
            
            // X Printer uchun avtomatik print
            window.addEventListener('load', function() {
              setTimeout(function() {
                console.log('X Printer: Print boshlanmoqda...');
                window.print();
              }, 300);
            });
          <\/script>
        </body>
      </html>
    `;return w.open(),w.write(S),w.close(),n&&(window.xPrinterCompleted=()=>{console.log("X Printer: Callback chaqirildi"),n(),setTimeout(()=>{document.body.contains(l)&&document.body.removeChild(l)},1e3),delete window.xPrinterCompleted}),n||setTimeout(()=>{document.body.contains(l)&&document.body.removeChild(l)},3e3),console.log("X Printer: Chek tayyorlandi va yuborildi"),!0}catch(h){console.error("X Printer xatosi:",h);try{return rl(t),!1}catch(l){return console.error("Faylni yuklashda xatolik:",l),!1}}}),Aa=(t,n)=>Q(Ze,null,function*(){return yield al(t,n)}),rl=t=>{const n=Da(t),r=new Blob([n],{type:"text/plain;charset=utf-8"}),h=URL.createObjectURL(r),l=document.createElement("a");l.href=h,l.download=`chek-${t.receiptNumber||Date.now()}.txt`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(h)},ll=()=>Q(Ze,null,function*(){var t;try{if(navigator.printing&&navigator.printing.getPrinters){const n=yield navigator.printing.getPrinters(),r=n.map(l=>l.name||l.id),h=r.some(l=>l.toLowerCase().includes("x printer")||l.toLowerCase().includes("xprinter")||l.toLowerCase().includes("x-printer"));return{available:n.length>0,printers:r,defaultPrinter:(t=n.find(l=>l.isDefault))==null?void 0:t.name,xPrinterFound:h}}return{available:"print"in window,printers:["Browser Default Printer","X Printer (Auto-detect)"],defaultPrinter:"X Printer (Auto-detect)",xPrinterFound:!0}}catch(n){return console.error("Printer holatini tekshirishda xatolik:",n),{available:!1,printers:[],defaultPrinter:void 0,xPrinterFound:!1}}});function ga(){const{showAlert:t,AlertComponent:n}=ws(),[r,h]=s.useState([]),[l,w]=s.useState([]),[S,p]=s.useState(!0),[q,z]=s.useState(""),[y,k]=s.useState(""),[M,f]=s.useState(""),[E,c]=s.useState(""),[R,P]=s.useState(null),[C,v]=s.useState(1),[_,X]=s.useState(1),[B,he]=s.useState(null),[pe,F]=s.useState(null),[be,le]=s.useState(null),[Te,W]=s.useState({totalReceipts:0,totalAmount:0,totalItems:0});s.useEffect(()=>{te(),D()},[]),s.useEffect(()=>{D()},[q,y,M,E,C]);const te=()=>Q(this,null,function*(){try{const T=yield K.get("/receipts/helpers-stats");w(T.data)}catch(T){console.error("Error fetching helpers:",T)}}),D=()=>Q(this,null,function*(){try{p(!0);const T=new URLSearchParams({page:C.toString(),limit:"20"});q&&T.append("helperId",q),y&&T.append("startDate",y),M&&T.append("endDate",M),E&&T.append("search",E);const ye=yield K.get(`/receipts/all-helper-receipts?${T}`);h(ye.data.receipts),X(ye.data.pagination.totalPages),W(ye.data.summary)}catch(T){console.error("Error fetching receipts:",T),t("Cheklar yuklanmadi","Xatolik","danger")}finally{p(!1)}}),xe=T=>{P(R===T?null:T)},I=T=>new Date(T).toLocaleDateString("uz-UZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),fe=()=>{z(""),k(""),f(""),c(""),v(1)},ve=T=>Q(this,null,function*(){var ye;try{he(T._id);const de={items:T.items.map(ae=>({_id:ae._id,name:ae.name,code:ae.code,price:ae.price,cartQuantity:ae.quantity,quantity:ae.quantity,warehouse:"main",category:"",image:ae.image||void 0})),total:T.total,paymentMethod:T.paymentMethod,receiptNumber:T.receiptNumber,cashier:((ye=T.helper)==null?void 0:ye.name)||"Xodim",date:new Date(T.createdAt)};(yield Aa(de,()=>{console.log("Chek chiqarildi:",T.receiptNumber)}))?t("Chek muvaffaqiyatli chiqarildi","Muvaffaqiyat","success"):t("Chek chiqarishda xatolik yuz berdi","Xatolik","warning")}catch(de){console.error("Print error:",de),t("Chek chiqarishda xatolik yuz berdi","Xatolik","danger")}finally{he(null)}}),H=T=>Q(this,null,function*(){var ye,de;try{F(T);const ke=yield K.delete(`/receipts/helper-receipt/${T}`);ke.data.success?(t("Chek muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),D(),te()):t(ke.data.message||"Chekni o'chirishda xatolik","Xatolik","danger")}catch(ke){console.error("Delete error:",ke),t(((de=(ye=ke.response)==null?void 0:ye.data)==null?void 0:de.message)||"Chekni o'chirishda xatolik yuz berdi","Xatolik","danger")}finally{F(null),le(null)}});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-blue-100/30 to-slate-100 pb-20 lg:pb-0",children:[n,e.jsx(Ks,{title:"Xodimlar cheklari"}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Jami cheklar"}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:Te.totalReceipts})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg",children:e.jsx(Os,{className:"w-7 h-7 text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Jami summa"}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:b(Te.totalAmount)}),e.jsx("p",{className:"text-slate-500 text-xs mt-1",children:"UZS"})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center shadow-lg",children:e.jsx(ns,{className:"w-7 h-7 text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Jami mahsulotlar"}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:Te.totalItems})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg",children:e.jsx(Fe,{className:"w-7 h-7 text-white"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(sr,{className:"w-5 h-5 text-slate-600"}),e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Filtrlar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(ls,{className:"w-4 h-4 inline mr-1"}),"Xodim"]}),e.jsxs("select",{value:q,onChange:T=>{z(T.target.value),v(1)},className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",children:[e.jsx("option",{value:"",children:"Barchasi"}),l.map(T=>e.jsxs("option",{value:T._id,children:[T.name," (",T.receiptCount," ta chek)"]},T._id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(Xs,{className:"w-4 h-4 inline mr-1"}),"Boshlanish"]}),e.jsx("input",{type:"date",value:y,onChange:T=>{k(T.target.value),v(1)},className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(Xs,{className:"w-4 h-4 inline mr-1"}),"Tugash"]}),e.jsx("input",{type:"date",value:M,onChange:T=>{f(T.target.value),v(1)},className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(bs,{className:"w-4 h-4 inline mr-1"}),"Qidiruv"]}),e.jsx("input",{type:"text",value:E,onChange:T=>{c(T.target.value),v(1)},placeholder:"Chek raqami yoki mahsulot",className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),(q||y||M||E)&&e.jsx("button",{onClick:fe,className:"mt-4 px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-lg transition-all",children:"Filtrlarni tozalash"})]}),S?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(T=>e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-slate-200 rounded mb-4 w-1/2"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded w-3/4"})]},T))}):r.length===0?e.jsxs("div",{className:"bg-white rounded-2xl p-12 shadow-lg border border-slate-200/60 text-center",children:[e.jsx(Hs,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:"Cheklar topilmadi"}),e.jsx("p",{className:"text-slate-600",children:"Tanlangan filtrlar bo'yicha cheklar mavjud emas"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(T=>{var ye,de;return e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200/60 overflow-hidden hover:shadow-xl transition-all duration-300",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-3 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(Os,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-sm truncate",children:T.receiptNumber}),e.jsxs("span",{className:"px-2 py-0.5 bg-white/20 rounded text-xs font-medium flex-shrink-0",children:[T.itemsCount," ta"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("button",{onClick:()=>ve(T),disabled:B===T._id,className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Chekni chiqarish",children:B===T._id?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Gs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>le(T._id),disabled:pe===T._id,className:"p-1.5 bg-red-500/80 hover:bg-red-600 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Chekni o'chirish",children:pe===T._id?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(zs,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-50 text-xs",children:[e.jsx(ls,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"Mijoz:"}),e.jsx("span",{className:"truncate",children:T.customer?T.customer.name:"Oddiy mijoz"})]}),(T.helper||T.createdBy)&&e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-50 text-xs",children:[e.jsx(ls,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"Hodim:"}),e.jsx("span",{className:"truncate",children:((ye=T.helper)==null?void 0:ye.name)||((de=T.createdBy)==null?void 0:de.name)||"Noma'lum"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-100 text-xs mt-1.5",children:[e.jsx(xt,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:I(T.createdAt)})]})]}),e.jsxs("div",{className:"p-3 space-y-3",children:[T.helper&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-white font-bold text-xs flex-shrink-0",children:T.helper.name.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-slate-900 text-xs truncate",children:T.helper.name}),e.jsx("p",{className:"text-[10px] text-slate-600 capitalize truncate",children:T.helper.role})]}),T.helper.bonusPercentage>0&&e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"text-[10px] text-slate-600",children:"Bonus"}),e.jsxs("p",{className:"font-bold text-emerald-600 text-xs",children:[T.helper.bonusPercentage,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-emerald-50 to-emerald-100 rounded-xl",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-emerald-700 font-medium mb-0.5",children:"Jami summa"}),e.jsx("p",{className:"text-xl font-bold text-emerald-900 truncate",children:b(T.total)}),e.jsx("p",{className:"text-[10px] text-emerald-600",children:"UZS"})]}),T.bonusAmount>0&&e.jsxs("div",{className:"text-right flex-shrink-0 ml-2",children:[e.jsx("p",{className:"text-[10px] text-emerald-700 font-medium mb-0.5",children:"Bonus"}),e.jsx("p",{className:"text-base font-bold text-emerald-900",children:b(T.bonusAmount)})]})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>xe(T._id),className:"w-full flex items-center justify-between p-2 bg-slate-50 hover:bg-slate-100 rounded-xl transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(Fe,{className:"w-3.5 h-3.5 text-slate-600 flex-shrink-0"}),e.jsxs("span",{className:"font-medium text-slate-900 text-xs truncate",children:["Mahsulotlar (",T.totalQuantity," dona)"]})]}),R===T._id?e.jsx(ya,{className:"w-4 h-4 text-slate-600 flex-shrink-0"}):e.jsx(Mt,{className:"w-4 h-4 text-slate-600 flex-shrink-0"})]}),R===T._id&&e.jsx("div",{className:"mt-2 space-y-1.5 max-h-64 overflow-y-auto",children:T.items.map(ke=>e.jsx("div",{className:"flex items-center gap-2 p-2 bg-white border border-slate-200 rounded-xl hover:border-blue-300 transition-all",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-slate-900 text-xs truncate",children:ke.name}),e.jsxs("p",{className:"text-[10px] text-slate-600 truncate",children:["Kod: ",ke.code]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5",children:[e.jsxs("span",{className:"text-xs text-slate-600 truncate",children:[ke.quantity," x ",b(ke.price)]}),e.jsxs("span",{className:"text-xs font-bold text-blue-600 flex-shrink-0",children:["= ",b(ke.total)]})]})]})},ke._id))})]})]})]},T._id)})}),_>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6",children:[e.jsx("button",{onClick:()=>v(T=>Math.max(1,T-1)),disabled:C===1,className:"px-4 py-2 rounded-xl bg-white border border-slate-300 text-slate-700 font-medium hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Oldingi"}),e.jsxs("span",{className:"px-4 py-2 text-slate-700 font-medium",children:[C," / ",_]}),e.jsx("button",{onClick:()=>v(T=>Math.min(_,T+1)),disabled:C===_,className:"px-4 py-2 rounded-xl bg-white border border-slate-300 text-slate-700 font-medium hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Keyingi"})]})]})]}),be&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-scale-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx(zs,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"Chekni o'chirish"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Bu amalni qaytarib bo'lmaydi"})]})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:[e.jsxs("p",{className:"text-sm text-red-800 mb-2",children:[e.jsx("strong",{children:"Diqqat!"})," Chekni o'chirsangiz:"]}),e.jsxs("ul",{className:"text-sm text-red-700 space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ Mahsulot miqdorlari qaytariladi"}),e.jsx("li",{children:"â€¢ Xodim bonusi ayriladi"}),e.jsx("li",{children:"â€¢ Statistika yangilanadi"}),e.jsx("li",{children:"â€¢ Bu amalni bekor qilib bo'lmaydi"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>le(null),disabled:pe===be,className:"flex-1 px-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-all disabled:opacity-50",children:"Bekor qilish"}),e.jsx("button",{onClick:()=>H(be),disabled:pe===be,className:"flex-1 px-4 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-xl transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:pe===be?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"O'chirilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(zs,{className:"w-5 h-5"}),"O'chirish"]})})]})]})})]})}function nl(){const[t,n]=s.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-surface-50",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx($a,{items:$r,basePath:"/cashier",collapsed:t,setCollapsed:n})}),e.jsx("main",{className:`transition-all duration-300 ease-smooth ${t?"lg:ml-[72px]":"lg:ml-64"}`,children:e.jsx(Ot,{})})]})}function il(){const{user:t,logout:n}=Zs();return e.jsxs("div",{className:"min-h-screen bg-surface-50",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-white/80 backdrop-blur-xl border-b border-surface-200/60",children:e.jsxs("div",{className:"px-3 sm:px-4 h-14 sm:h-16 flex items-center justify-between max-w-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-shrink",children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center shadow-sm flex-shrink-0",children:e.jsx(tr,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),e.jsx("span",{className:"font-bold text-base sm:text-lg text-surface-900 hidden sm:inline truncate",children:"Sardorbek.Furnetura"}),e.jsx("span",{className:"font-bold text-sm text-surface-900 sm:hidden truncate",children:"Sardorbek"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-2 px-3 py-2 bg-surface-100 rounded-xl max-w-[150px]",children:[e.jsx(ls,{className:"w-4 h-4 text-surface-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-surface-700 truncate",children:t==null?void 0:t.name})]}),e.jsx("div",{className:"md:hidden flex items-center justify-center w-8 h-8 bg-surface-100 rounded-lg flex-shrink-0",children:e.jsx(ls,{className:"w-4 h-4 text-surface-500"})}),e.jsx("button",{onClick:n,className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg text-surface-500 hover:text-danger-600 hover:bg-danger-50 transition-colors flex-shrink-0",title:"Chiqish",children:e.jsx(Ft,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]})}),e.jsx("main",{className:"p-3 sm:p-4",children:e.jsx(Ot,{})})]})}function ol(){var Qe,ge,Oe,m,je,ze,Ie,Re,_e;const{showAlert:t,AlertComponent:n}=ws(),[r,h]=s.useState(!1),[l,w]=s.useState(""),[S,p]=s.useState([]),[q,z]=s.useState([]),[y,k]=s.useState([]),[M,f]=s.useState(null),[E,c]=s.useState(null),[R,P]=s.useState(!1),[C,v]=s.useState([]),[_,X]=s.useState(null),[B,he]=s.useState(""),[pe,F]=s.useState(!1),[be,le]=s.useState(!1),[Te,W]=s.useState({name:"",phone:""}),[te,D]=s.useState(!1),[xe,I]=s.useState("environment"),fe=s.useRef(null);s.useEffect(()=>(ve(),H(),()=>{fe.current&&fe.current.stop().catch(()=>{})}),[]);const ve=()=>Q(this,null,function*(){try{const L=yield K.get("/products"),o=L.data.data||L.data;z(Array.isArray(o)?o:[])}catch(L){console.error("Error fetching products:",L)}}),H=()=>Q(this,null,function*(){try{const L=yield K.get("/customers");v(L.data.data||L.data||[])}catch(L){console.error("Error fetching customers:",L)}}),T=()=>Q(this,null,function*(){var L,o;if(!Te.name.trim()||!Te.phone.trim()){t("Iltimos, ism va telefon raqamni kiriting!","Ogohlantirish","warning");return}D(!0);try{const Se=(yield K.post("/customers",{name:Te.name.trim(),phone:Te.phone.trim()})).data;v($e=>[Se,...$e]),X(Se),le(!1),F(!1),W({name:"",phone:""}),t(`Mijoz ${Se.name} qo'shildi!`,"Muvaffaqiyat","success")}catch(Y){t(((o=(L=Y==null?void 0:Y.response)==null?void 0:L.data)==null?void 0:o.message)||"Mijoz qo'shishda xatolik","Xatolik","danger")}finally{D(!1)}}),ye=()=>Q(this,null,function*(){f(null),w(""),k([]),h(!0),yield new Promise(L=>setTimeout(L,100));try{if(!document.getElementById("qr-reader"))throw new Error("QR reader element topilmadi. Iltimos, qayta urinib ko'ring.");const o=new yr("qr-reader");fe.current=o,yield o.start({facingMode:xe},{fps:30,qrbox:{width:250,height:250},aspectRatio:1,disableFlip:!1,videoConstraints:{facingMode:xe,width:{ideal:1280},height:{ideal:720}}},Y=>Q(this,null,function*(){var N;console.log("QR kod o'qildi:",Y);let Se=null;try{const J=JSON.parse(Y);J&&typeof J=="object"&&(J.code?Se=String(J.code):(J.id||J._id)&&(Se=String(J.id||J._id)))}catch(J){}let $e=Se||Y;if($e.includes("/product/")){const J=$e.split("/product/");J.length>1&&($e=J[1].split("?")[0].split("#")[0])}console.log("Qidiruv kaliti:",$e);let Ce=q.find(J=>J.code===$e||J._id===$e);if(console.log("Local'da topildi:",!!Ce),!Ce)try{console.log("Serverdan qidirilmoqda:",$e),Ce=(yield K.get(`/products/scan-qr/${encodeURIComponent($e)}`)).data,console.log("Serverdan topildi:",!!Ce)}catch(J){console.error("Server qidiruv xatosi:",(N=J.response)==null?void 0:N.status,J.message)}Ce?(f(Ce),q.find(J=>J._id===Ce._id)||z(J=>[...J,Ce])):t("Tovar topilmadi: "+$e,"Xatolik","warning"),de()}),()=>{})}catch(L){console.error("Scanner error:",L),h(!1);let o="Kamerani ishga tushirishda xatolik";L.name==="NotAllowedError"?o="Kamera ruxsati berilmadi. Brauzer sozlamalarida kamera ruxsatini yoqing.":L.name==="NotFoundError"?o="Kamera topilmadi. Qurilmangizda kamera borligini tekshiring.":L.name==="NotReadableError"?o="Kamera band. Boshqa ilova kamerani ishlatayotgan bo'lishi mumkin.":L.name==="NotSupportedError"?o="HTTPS kerak. Xavfsiz ulanish orqali kirish kerak.":L.message&&(o=L.message),t(o,"Xatolik","danger")}}),de=()=>Q(this,null,function*(){if(fe.current){try{yield fe.current.stop()}catch(L){}fe.current=null}h(!1)}),ke=()=>Q(this,null,function*(){r?(yield de(),I(L=>L==="environment"?"user":"environment"),setTimeout(()=>{ye()},300)):I(L=>L==="environment"?"user":"environment")}),ae=L=>{if(w(L),f(null),L.length>0){const o=q.filter(Y=>Y.name.toLowerCase().includes(L.toLowerCase())||Y.code.toLowerCase().includes(L.toLowerCase()));k(o)}else k([])},Ke=(L,o)=>{let Y=15;o>=100?Y=11:o>=10?Y=13:Y=15;const Se=L*(1+Y/100);return Math.round(Se)},is=L=>L>=100?{name:"100+ dona",markupPercent:11,discount:!0}:L>=10?{name:"10-99 dona",markupPercent:13,discount:!0}:{name:"1-9 dona",markupPercent:15,discount:!1},Ve=L=>{p(o=>{const Y=o.find($e=>$e._id===L._id);if(Y){const $e=Y.cartQuantity+1,Ce=Ke(L.price,$e);return o.map(N=>N._id===L._id?j(g({},N),{cartQuantity:$e,price:Ce}):N)}const Se=Ke(L.price,1);return[...o,j(g({},L),{cartQuantity:1,price:Se})]}),w(""),k([]),f(null)},Me=(L,o)=>{p(Y=>Y.map(Se=>{if(Se._id===L){const $e=Math.max(1,Se.cartQuantity+o),Ce=q.find(N=>N._id===L);if(Ce){const N=Ke(Ce.price,$e);return j(g({},Se),{cartQuantity:$e,price:N})}return j(g({},Se),{cartQuantity:$e})}return Se}))},es=L=>{p(o=>o.filter(Y=>Y._id!==L))},u=()=>Q(this,null,function*(){if(S.length===0){t("Savat bo'sh!","Ogohlantirish","warning");return}if(!_){t("Iltimos, mijozni tanlang!","Ogohlantirish","warning"),F(!0);return}P(!0);try{const L={customer:_._id==="default"?null:_._id,items:S.map(Y=>({product:Y._id,name:Y.name,code:Y.code,price:Y.price,quantity:Y.cartQuantity})),total:Pe,paymentMethod:"cash",paidAmount:Pe,status:_._id==="default"?"completed":"pending"};yield K.post("/receipts",L);const o=_._id==="default"?"Oddiy mijoz":_.name;t(`Chek ${o} uchun saqlandi!`,"Muvaffaqiyat","success"),p([]),X(null)}catch(L){console.error("Error sending receipt:",L),t("Xatolik yuz berdi","Xatolik","danger")}finally{P(!1)}}),re=C.filter(L=>L.name.toLowerCase().includes(B.toLowerCase())||L.phone.includes(B)),Pe=S.reduce((L,o)=>L+o.price*o.cartQuantity,0);return e.jsxs("div",{className:"min-h-[calc(100vh-120px)] bg-gradient-to-b from-surface-50 to-surface-100/80 rounded-3xl p-4 sm:p-6 lg:p-8 shadow-sm overflow-x-hidden",children:[n,e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-semibold text-surface-900 flex items-center gap-2",children:[e.jsx(ht,{className:"w-6 h-6 text-brand-600"}),"Skaner orqali savat to'ldirish"]}),e.jsx("p",{className:"text-sm text-surface-500 mt-1",children:"Tovarlarni QR kod orqali tezda toping, savatga qo'shing va kassaga yuboring."})]}),e.jsxs("button",{onClick:()=>F(!0),className:`flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-xl transition-all shadow-sm text-sm sm:text-base w-full sm:w-auto ${_?"bg-green-50 border-2 border-green-500 text-green-700 hover:bg-green-100":"bg-brand-500 text-white hover:bg-brand-600"}`,children:[e.jsx(ls,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("div",{className:"text-xs font-medium",children:_?"Mijoz tanlandi":"Mijoz tanlash"}),_&&e.jsx("div",{className:"text-sm font-semibold truncate",children:_.name})]})]})]}),pe&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-surface-200 flex items-center justify-between bg-gradient-to-r from-brand-500 to-brand-600",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(Is,{className:"w-5 h-5"}),"Mijoz tanlash"]}),e.jsx("button",{onClick:()=>F(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/20 transition-colors text-white",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:be?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900",children:"Yangi mijoz qo'shish"}),e.jsx("button",{onClick:()=>{le(!1),W({name:"",phone:""})},className:"text-surface-500 hover:text-surface-700",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Ism"}),e.jsx("input",{type:"text",value:Te.name,onChange:L=>W(j(g({},Te),{name:L.target.value})),placeholder:"Alisher Karimov",className:"w-full px-4 py-2.5 border border-surface-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Telefon raqam"}),e.jsx("input",{type:"tel",value:Te.phone,onChange:L=>W(j(g({},Te),{phone:L.target.value})),placeholder:"+998901234567",className:"w-full px-4 py-2.5 border border-surface-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>{le(!1),W({name:"",phone:""})},className:"flex-1 px-4 py-2.5 border border-surface-200 text-surface-700 rounded-xl hover:bg-surface-50 transition-colors font-medium",disabled:te,children:"Bekor qilish"}),e.jsx("button",{onClick:T,disabled:te,className:"flex-1 px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-xl transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:te?"Qo'shilmoqda...":"Qo'shish"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(bs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",value:B,onChange:L=>he(L.target.value),placeholder:"Ism yoki telefon raqam...",className:"w-full pl-10 pr-4 py-2.5 border border-surface-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500",autoFocus:!0})]}),e.jsxs("button",{onClick:()=>le(!0),className:"px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-xl transition-colors flex items-center gap-2 font-medium whitespace-nowrap",children:[e.jsx(ms,{className:"w-4 h-4"}),"Yangi"]})]}),e.jsxs("div",{className:"max-h-96 overflow-y-auto space-y-2",children:[e.jsxs("button",{onClick:()=>{X({_id:"default",name:"Oddiy mijoz",phone:"",debt:0}),F(!1),he("")},className:`w-full p-3 rounded-xl text-left transition-all ${(_==null?void 0:_._id)==="default"?"bg-blue-50 border-2 border-blue-500":"bg-blue-50/50 hover:bg-blue-100 border-2 border-blue-200"}`,children:[e.jsxs("div",{className:"font-medium text-blue-900 flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4"}),"Oddiy mijoz"]}),e.jsx("div",{className:"text-xs text-blue-600",children:"Faqat to'liq to'lov"})]}),re.length===0?e.jsxs("div",{className:"text-center py-8 text-surface-500",children:[e.jsx(Is,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Mijoz topilmadi"})]}):re.map(L=>e.jsxs("button",{onClick:()=>{X(L),F(!1),he("")},className:`w-full p-3 rounded-xl text-left transition-all ${(_==null?void 0:_._id)===L._id?"bg-green-50 border-2 border-green-500":"bg-surface-50 hover:bg-surface-100 border-2 border-transparent"}`,children:[e.jsx("div",{className:"font-medium text-surface-900",children:L.name}),e.jsx("div",{className:"text-sm text-surface-500",children:L.phone})]},L._id))]})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_400px] gap-4 lg:gap-6 items-start w-full",children:[e.jsxs("div",{className:"space-y-4 lg:space-y-5 min-w-0",children:[e.jsx("div",{className:"card p-3 sm:p-4 border border-surface-100 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-3 items-stretch",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(bs,{className:"absolute left-3 sm:left-3.5 top-1/2 -translate-y-1/2 w-4 sm:w-5 h-4 sm:h-5 text-brand-400 z-10 pointer-events-none"}),e.jsx("input",{type:"text",value:l,onChange:L=>ae(L.target.value),placeholder:"Qidirish...",className:"w-full h-12 pl-10 sm:pl-11 pr-10 rounded-xl border-2 border-surface-200 focus:border-brand-400 focus:ring-4 focus:ring-brand-100 transition-all text-sm sm:text-base text-surface-900 placeholder:text-surface-400 bg-white shadow-sm hover:border-brand-300 relative z-0"}),l&&e.jsx("button",{onClick:()=>ae(""),className:"absolute right-3 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full bg-surface-100 hover:bg-surface-200 flex items-center justify-center transition-colors z-10",children:e.jsx(Ne,{className:"w-4 h-4 text-surface-500"})})]}),e.jsxs("button",{onClick:r?de:ye,className:`h-12 flex items-center justify-center gap-2 rounded-xl px-4 font-medium ${r?"btn-secondary":"btn-primary"} shadow-md hover:shadow-lg transition-all`,children:[e.jsx(ht,{className:"w-5 h-5"}),e.jsx("span",{children:r?"Skanerni to'xtatish":"QR skaner"})]})]})}),r&&e.jsx("div",{className:"card border border-brand-100 bg-gradient-to-br from-brand-50/60 to-surface-0 shadow-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 sm:p-5",children:[e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl overflow-hidden ring-4 ring-brand-300/50 ring-offset-4 ring-offset-surface-0 shadow-lg",children:[e.jsx("div",{id:"qr-reader",className:"w-full aspect-square bg-black"}),e.jsx("button",{onClick:ke,className:"absolute bottom-3 right-3 w-9 h-9 bg-white/95 hover:bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-all hover:scale-105 z-10 backdrop-blur-sm border border-white/20",title:xe==="environment"?"Old kameraga o'tish":"Orqa kameraga o'tish",children:e.jsx(As,{className:"w-4 h-4 text-surface-600"})})]}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-surface-800",children:"QR kodni kameraga toâ€˜gâ€˜ri tuting"}),e.jsx("p",{className:"text-xs text-surface-500",children:"Kamera kodni oâ€˜qigach, tovar ma'lumotlari avtomatik chiqadi."})]})]})}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-success-500 to-success-600 p-4 flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(oa,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Tovar topildi!"})]}),e.jsx("button",{onClick:()=>f(null),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/20 transition-colors text-white",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide",children:"Mahsulot nomi"}),e.jsx("p",{className:"text-xl font-bold text-surface-900 mt-1",children:M.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide",children:"Mahsulot kodi"}),e.jsx("p",{className:"text-lg font-semibold text-surface-700 mt-1",children:M.code})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide",children:"Mavjud miqdor"}),e.jsxs("p",{className:"text-lg font-semibold text-brand-600 mt-1",children:[M.quantity," dona"]})]}),e.jsxs("div",{className:"bg-brand-50 border border-brand-200 rounded-xl p-4",children:[e.jsx("label",{className:"text-xs font-medium text-brand-700 uppercase tracking-wide",children:"Optom narxi"}),e.jsxs("p",{className:"text-2xl font-bold text-brand-600 mt-1",children:[b(M.price)," so'm"]})]}),(M.unitPrice||M.boxPrice||((Qe=M.prices)==null?void 0:Qe.perUnit)||((ge=M.prices)==null?void 0:ge.perBox)||((Oe=M.prices)==null?void 0:Oe.perRoll))&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide mb-2 block",children:"Boshqa narxlar"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(m=M.prices)!=null&&m.perUnit||M.unitPrice||M.price?e.jsxs("div",{className:"flex-1 min-w-[140px] px-4 py-3 rounded-xl bg-success-50 border border-success-200",children:[e.jsx("p",{className:"text-xs text-success-600 font-medium",children:"Dona narxi"}),e.jsxs("p",{className:"text-lg font-bold text-success-700 mt-0.5",children:[b(((je=M.prices)==null?void 0:je.perUnit)||M.unitPrice||M.price)," so'm"]})]}):null,(ze=M.prices)!=null&&ze.perBox||M.boxPrice?e.jsxs("div",{className:"flex-1 min-w-[140px] px-4 py-3 rounded-xl bg-brand-50 border border-brand-200",children:[e.jsx("p",{className:"text-xs text-brand-600 font-medium",children:"Karobka narxi"}),e.jsxs("p",{className:"text-lg font-bold text-brand-700 mt-0.5",children:[b(((Ie=M.prices)==null?void 0:Ie.perBox)||M.boxPrice||0)," so'm"]})]}):null,(Re=M.prices)!=null&&Re.perRoll?e.jsxs("div",{className:"flex-1 min-w-[140px] px-4 py-3 rounded-xl bg-sky-50 border border-sky-200",children:[e.jsx("p",{className:"text-xs text-sky-600 font-medium",children:"Rulon narxi"}),e.jsxs("p",{className:"text-lg font-bold text-sky-700 mt-0.5",children:[b(((_e=M.prices)==null?void 0:_e.perRoll)||0)," so'm"]})]}):null]})]}),M.pricingTiers&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide mb-2 block",children:"Miqdorga qarab chegirmalar"}),e.jsxs("div",{className:"space-y-2",children:[M.pricingTiers.tier1&&e.jsxs("div",{className:"px-4 py-3 rounded-xl border border-emerald-200 bg-emerald-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-emerald-700",children:[M.pricingTiers.tier1.minQuantity,"-",M.pricingTiers.tier1.maxQuantity," dona"]}),e.jsxs("span",{className:"text-lg font-bold text-emerald-700",children:[M.pricingTiers.tier1.discountPercent,"% chegirma"]})]}),e.jsxs("p",{className:"text-sm text-emerald-600 mt-1",children:["Narx: ",b(Math.round(M.price*(1-M.pricingTiers.tier1.discountPercent/100)))," so'm"]})]}),M.pricingTiers.tier2&&e.jsxs("div",{className:"px-4 py-3 rounded-xl border border-sky-200 bg-sky-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-sky-700",children:[M.pricingTiers.tier2.minQuantity,"-",M.pricingTiers.tier2.maxQuantity," dona"]}),e.jsxs("span",{className:"text-lg font-bold text-sky-700",children:[M.pricingTiers.tier2.discountPercent,"% chegirma"]})]}),e.jsxs("p",{className:"text-sm text-sky-600 mt-1",children:["Narx: ",b(Math.round(M.price*(1-M.pricingTiers.tier2.discountPercent/100)))," so'm"]})]}),M.pricingTiers.tier3&&e.jsxs("div",{className:"px-4 py-3 rounded-xl border border-violet-200 bg-violet-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-violet-700",children:[M.pricingTiers.tier3.minQuantity,"+ dona"]}),e.jsxs("span",{className:"text-lg font-bold text-violet-700",children:[M.pricingTiers.tier3.discountPercent,"% chegirma"]})]}),e.jsxs("p",{className:"text-sm text-violet-600 mt-1",children:["Narx: ",b(Math.round(M.price*(1-M.pricingTiers.tier3.discountPercent/100)))," so'm"]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>f(null),className:"flex-1 px-4 py-3 border border-surface-200 text-surface-700 rounded-xl hover:bg-surface-50 transition-colors font-medium",children:"Yopish"}),e.jsxs("button",{onClick:()=>{Ve(M),f(null)},className:"flex-1 px-4 py-3 bg-success-500 hover:bg-success-600 text-white rounded-xl transition-colors font-medium flex items-center justify-center gap-2",children:[e.jsx(ms,{className:"w-5 h-5"}),"Savatga qo'shish"]})]})]})]})}),l&&y.length>0&&e.jsxs("div",{className:"card p-0 overflow-hidden border border-surface-100 shadow-sm",children:[e.jsxs("div",{className:"px-4 pt-4 pb-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700",children:"Qidiruv natijalari"}),e.jsxs("span",{className:"text-xs text-surface-400",children:[y.length," ta topildi"]})]}),e.jsx("div",{className:"divide-y divide-surface-100 max-h-72 overflow-auto custom-scrollbar",children:y.map(L=>e.jsxs("button",{onClick:()=>Ve(L),className:"w-full flex items-center justify-between p-4 hover:bg-surface-50/80 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(Fe,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900 line-clamp-1",children:L.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",L.code]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-brand-600",children:[b(L.price)," so'm"]}),e.jsxs("p",{className:"text-[11px] text-surface-400",children:[L.quantity," dona"]})]})]},L._id))})]}),l&&y.length===0&&e.jsx("div",{className:"card text-center py-10 bg-surface-0/60 border-dashed border-surface-200",children:e.jsx("p",{className:"text-sm text-surface-500",children:"Tovar topilmadi. Nomi yoki kodini tekshirib qayta urinib ko'ring."})})]}),e.jsx("div",{className:"lg:sticky lg:top-4 min-w-0 w-full",children:e.jsxs("div",{className:"card border border-surface-100 shadow-md shadow-surface-900/5 p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 rounded-xl bg-brand-50 flex items-center justify-center flex-shrink-0",children:e.jsx(us,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Savat"}),e.jsx("p",{className:"text-xs text-surface-400 truncate",children:"Tanlangan tovarlar"})]})]}),e.jsxs("span",{className:"badge-primary text-xs px-2 sm:px-3 py-1 rounded-full flex-shrink-0",children:[S.length," ta"]})]}),S.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-10",children:[e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 bg-surface-100 rounded-2xl flex items-center justify-center mx-auto mb-3",children:e.jsx(us,{className:"w-7 h-7 sm:w-8 sm:h-8 text-surface-300"})}),e.jsx("p",{className:"text-surface-500 text-xs sm:text-sm px-2",children:"Savat bo'sh. QR skaner yoki qidiruv orqali tovar qo'shing."})]}):e.jsx("div",{className:"space-y-2 sm:space-y-3 max-h-[360px] overflow-auto pr-1 custom-scrollbar",children:S.map(L=>{var $e,Ce,N,J,ue,we,Be,Je,Xe,hs,Ns,Ms,gs,Cs,Rs,ps,ys;const o=is(L.cartQuantity);($e=q.find($s=>$s._id===L._id))!=null&&$e.price||L.price;const Y=q.find($s=>$s._id===L._id),Se=E===L._id;return e.jsxs("div",{className:"bg-surface-50 rounded-xl border border-surface-100",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 sm:p-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate text-sm",children:L.name}),e.jsxs("button",{onClick:()=>c(Se?null:L._id),className:"flex items-center gap-1.5 mt-1 hover:opacity-80 transition-opacity",children:[e.jsxs("span",{className:`text-[9px] sm:text-[10px] font-bold px-1.5 py-0.5 rounded ${o.discount?"bg-success-100 text-success-700":"bg-surface-200 text-surface-600"}`,children:[o.name," â€¢ ",o.markupPercent,"%"]}),Se?e.jsx(ya,{className:"w-3 h-3 text-surface-500"}):e.jsx(Mt,{className:"w-3 h-3 text-surface-500"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-brand-600 font-semibold mt-1",children:[b(L.price*L.cartQuantity)," so'm"]})]}),e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1 bg-white rounded-lg border border-surface-200 px-1 sm:px-1.5 py-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>Me(L._id,-1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded hover:bg-surface-100 transition-colors",children:e.jsx(ft,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("input",{type:"number",min:"1",value:L.cartQuantity,onChange:$s=>{const ne=(parseInt($s.target.value)||1)-L.cartQuantity;Me(L._id,ne)},className:"w-8 sm:w-10 text-center font-semibold text-xs sm:text-sm bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-brand-500 rounded"}),e.jsx("button",{onClick:()=>Me(L._id,1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded hover:bg-surface-100 transition-colors",children:e.jsx(ms,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsx("button",{onClick:()=>es(L._id),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded-lg hover:bg-red-50 text-red-500 transition-colors flex-shrink-0",children:e.jsx(Ne,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]}),Se&&Y&&e.jsxs("div",{className:"px-2 sm:px-3 pb-2 sm:pb-3 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-[10px] font-medium text-green-900",children:[((N=(Ce=Y.pricingTiers)==null?void 0:Ce.tier1)==null?void 0:N.minQuantity)||1,"-",((ue=(J=Y.pricingTiers)==null?void 0:J.tier1)==null?void 0:ue.maxQuantity)||9," dona"]})}),e.jsxs("span",{className:"text-xs font-bold text-green-700",children:[((Be=(we=Y.pricingTiers)==null?void 0:we.tier1)==null?void 0:Be.discountPercent)||15,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-[10px] font-medium text-blue-900",children:[((Xe=(Je=Y.pricingTiers)==null?void 0:Je.tier2)==null?void 0:Xe.minQuantity)||10,"-",((Ns=(hs=Y.pricingTiers)==null?void 0:hs.tier2)==null?void 0:Ns.maxQuantity)||99," dona"]})}),e.jsxs("span",{className:"text-xs font-bold text-blue-700",children:[((gs=(Ms=Y.pricingTiers)==null?void 0:Ms.tier2)==null?void 0:gs.discountPercent)||13,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-[10px] font-medium text-purple-900",children:[((Rs=(Cs=Y.pricingTiers)==null?void 0:Cs.tier3)==null?void 0:Rs.minQuantity)||100,"+ dona"]})}),e.jsxs("span",{className:"text-xs font-bold text-purple-700",children:[((ys=(ps=Y.pricingTiers)==null?void 0:ps.tier3)==null?void 0:ys.discountPercent)||11,"%"]})]})]})]},L._id)})}),S.length>0&&e.jsxs("div",{className:"mt-4 pt-3 sm:pt-4 border-t border-surface-200 space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-surface-500 text-xs sm:text-sm",children:"Jami summa"}),e.jsxs("span",{className:"text-xl sm:text-2xl font-bold text-surface-900",children:[b(Pe)," so'm"]})]}),e.jsx("button",{onClick:u,disabled:R,className:"btn-primary w-full py-3 sm:py-3.5 text-sm sm:text-base rounded-xl flex items-center justify-center gap-2",children:R?e.jsx("div",{className:"spinner"}):e.jsxs(e.Fragment,{children:[e.jsx(ka,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Kassaga yuborish"]})})]})]})})]})]})}function cl(){const t=_s(),n=nt(),[r,h]=s.useState(!1),[l,w]=s.useState(null),[S,p]=s.useState("idle"),{showAlert:q,AlertComponent:z}=ws(),[y,k]=s.useState({arrived:0,left:0}),[M,f]=s.useState(""),E=()=>{const X="/app/sardor-furnitura.apk",B=document.createElement("a");B.href=X,B.download="sardor-furnitura.apk",document.body.appendChild(B),B.click(),document.body.removeChild(B),q("Ilova yuklab olinmoqda...","Ma'lumot","info")};s.useEffect(()=>{window.location.pathname.startsWith("/kassa")||t("/kassa",{replace:!0});const B=()=>{window.history.pushState(null,"",window.location.href)};return window.addEventListener("popstate",B),window.history.pushState(null,"",window.location.href),()=>{window.removeEventListener("popstate",B)}},[t]);const R=(()=>{try{const X=localStorage.getItem("kassaLoggedIn");if(X)return{username:JSON.parse(X).username||"Kassa",isActive:!0}}catch(X){console.error("Error getting user info:",X)}return{username:"Kassa",isActive:!1}})(),P=()=>{const X=new Date,B=X.getFullYear(),he=String(X.getMonth()+1).padStart(2,"0"),pe=String(X.getDate()).padStart(2,"0");return`${B}-${he}-${pe}`};s.useEffect(()=>{const X=()=>{const he=P();f(he);const pe=`attendance:kassa:${R.username}:${he}`,F=localStorage.getItem(pe),be=F?JSON.parse(F):{arrived:0,left:0};k(be),p(be.arrived>0&&be.left===0?"arrived":"idle")};X();const B=setInterval(()=>{P()!==M&&X()},6e4);return()=>clearInterval(B)},[R.username,M]);const C=X=>Q(this,null,function*(){var B,he;if(!l)try{if(w(X),yield K.post("/telegram/attendance/kassa",{type:X,username:R.username}),yield q(X==="arrived"?"Keldingiz xabari yuborildi":"Ketdingiz xabari yuborildi","Muvaffaqiyatli","success"),X==="arrived"){const pe=`attendance:kassa:${R.username}:${M||P()}`,F=y,be=j(g({},F),{arrived:F.arrived+1});localStorage.setItem(pe,JSON.stringify(be)),k(be),be.arrived>0&&be.left===0&&p("arrived")}else{const pe=`attendance:kassa:${R.username}:${M||P()}`,F=y,be=j(g({},F),{left:F.left+1});localStorage.setItem(pe,JSON.stringify(be)),k(be),v(),window.location.replace("/kassa-login")}}catch(pe){yield q(((he=(B=pe==null?void 0:pe.response)==null?void 0:B.data)==null?void 0:he.message)||"Xabar yuborishda xatolik","Xatolik","danger")}finally{w(null)}}),v=s.useCallback(()=>{localStorage.removeItem("kassaLoggedIn"),localStorage.removeItem("kassaToken"),window.location.replace("/kassa-login")},[]),_=()=>{const X=n.pathname;return X==="/kassa"||X==="/kassa/"?"Kassa":X==="/kassa/receipts"?"Cheklar":X==="/kassa/clients"?"Mijozlar":X==="/kassa/products"?"Tovarlar":"Kassa"};return e.jsxs("div",{className:"h-screen flex overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[r&&e.jsx("div",{className:"fixed inset-0 z-40 lg:hidden",style:{background:"rgba(46, 16, 101, 0.6)",backdropFilter:"blur(8px)"},onClick:()=>h(!1)}),e.jsxs("aside",{className:`
        fixed lg:static inset-y-0 left-0 z-50 w-72 flex flex-col
        transform transition-transform duration-300 ease-in-out lg:transform-none
        ${r?"translate-x-0":"-translate-x-full lg:translate-x-0"}
      `,style:{background:"linear-gradient(180deg, #2e1065 0%, #4c1d95 100%)",borderRight:"1px solid rgba(6, 182, 212, 0.2)",boxShadow:"4px 0 24px -4px rgba(46, 16, 101, 0.3)"},children:[e.jsxs("div",{className:"p-5 flex items-center justify-between",style:{borderBottom:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, transparent 100%)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center overflow-hidden",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-lg text-white tracking-wide",style:{fontFamily:"'Playfair Display', serif",letterSpacing:"0.5px"},children:"Sardor"}),e.jsx("p",{className:"text-sm font-semibold tracking-wider",style:{color:"#c4b5fd",fontFamily:"'Montserrat', sans-serif",letterSpacing:"1.5px"},children:"FURNITURA"})]})]}),e.jsx("button",{onClick:()=>h(!1),className:"lg:hidden p-2 rounded-xl transition-colors",style:{background:"rgba(255, 255, 255, 0.1)",color:"#c4b5fd"},children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"flex-1 p-4 overflow-y-auto",children:e.jsx("div",{className:"space-y-1.5",children:[{path:"/kassa",label:"Kassa",icon:Sa},{path:"/kassa/receipts",label:"Cheklar",icon:Hs},{path:"/kassa/clients",label:"Mijozlar",icon:Is},{path:"/kassa/debts",label:"Qarz daftarcha",icon:Hs},{path:"/kassa/products",label:"Tovarlar",icon:Fe}].map(({path:X,label:B,icon:he})=>e.jsxs(ar,{to:X,onClick:()=>h(!1),className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200",style:{background:n.pathname===X?"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)":"transparent",color:n.pathname===X?"#ffffff":"#c4b5fd",boxShadow:n.pathname===X?"0 4px 12px -2px rgba(6, 182, 212, 0.4)":"none"},children:[e.jsx(he,{className:"w-5 h-5"}),B]},X))})}),e.jsxs("div",{className:"p-4",style:{borderTop:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.2) 100%)"},children:[e.jsx("div",{className:"rounded-2xl p-4 mb-3",style:{background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(6, 182, 212, 0.15)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 12px -2px rgba(124, 58, 237, 0.4)"},children:e.jsx("span",{className:"text-base font-bold text-white",children:R.username.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-bold text-white truncate",children:R.username==="alisher"?"Namozov Alisher":R.username==="kassa1"?"Kassa Xodimi":R.username==="admin"?"Administrator":R.username}),e.jsxs("p",{className:"text-xs font-medium flex items-center gap-1",style:{color:"#a5b4fc"},children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-400 rounded-full animate-pulse"}),"Kassir â€¢ Faol"]})]})]})}),e.jsxs("button",{onClick:v,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl transition-all duration-200 text-sm font-semibold",style:{border:"1px solid rgba(239, 68, 68, 0.3)",color:"#fca5a5"},title:"Kassa tizimidan chiqish",children:[e.jsx(Ft,{className:"w-4 h-4"}),"Chiqish"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:ml-0 h-full",children:[e.jsxs("header",{className:"px-4 lg:px-6 h-14 lg:h-16 flex items-center justify-between flex-shrink-0",style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",borderBottom:"1px solid rgba(91, 33, 182, 0.1)",backdropFilter:"blur(20px)",boxShadow:"0 4px 20px -4px rgba(46, 16, 101, 0.08)"},children:[e.jsx("button",{onClick:()=>h(!0),className:"lg:hidden p-2.5 rounded-xl transition-colors",style:{background:"rgba(91, 33, 182, 0.08)",color:"#5b21b6"},children:e.jsx(Pt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg lg:text-xl font-bold",style:{color:"#2e1065"},children:_()}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium",style:{color:"#6b7280"},children:"Faol"})]})]}),e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-3 py-2 rounded-xl transition-all duration-200 text-sm font-semibold",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",color:"#ffffff",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},title:"Ilovani yuklab olish",children:[e.jsx(Kt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yuklab olish"})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Ot,{})})]}),S==="idle"&&e.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0",style:{background:"rgba(250, 245, 255, 0.7)",backdropFilter:"blur(8px)"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:e.jsxs("div",{className:"mx-auto max-w-md flex gap-4",children:[e.jsx("button",{onClick:()=>C("arrived"),disabled:l!==null,className:"pointer-events-auto flex-1 px-6 py-4 rounded-2xl text-white font-bold shadow-lg disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 8px 24px -4px rgba(6, 182, 212, 0.4)"},children:l==="arrived"?"Yuborilmoqda...":"Keldim"}),e.jsx("button",{onClick:()=>C("left"),disabled:l!==null,className:"pointer-events-auto flex-1 px-6 py-4 rounded-2xl text-white font-bold shadow-lg disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",boxShadow:"0 8px 24px -4px rgba(220, 38, 38, 0.4)"},children:l==="left"?"Yuborilmoqda...":"Ketdim"})]})})]}),S==="arrived"&&e.jsxs("div",{className:"fixed bottom-4 right-4 z-40 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>C("arrived"),disabled:l!==null,className:"px-3 py-2 rounded-xl text-white text-sm font-semibold shadow-md disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:l==="arrived"?"...":"Keldim"}),e.jsx("button",{onClick:()=>C("left"),disabled:l!==null,className:"px-3 py-2 rounded-xl text-white text-sm font-semibold shadow-md disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",boxShadow:"0 4px 12px -2px rgba(220, 38, 38, 0.4)"},children:l==="left"?"...":"Ketdim"})]}),z]})}const dl=({isOpen:t,onClose:n,item:r,customer:h,onSave:l})=>{const[w,S]=s.useState([]),[p,q]=s.useState(""),[z,y]=s.useState(""),[k,M]=s.useState(!1),[f,E]=s.useState(""),c=r.price*r.cartQuantity,R=r.paymentBreakdown||{cash:0,click:0,card:0,partner:0},P=R.cash+R.click+R.card+(R.partner||0),C=c-P;s.useEffect(()=>{t&&(v(),y(C.toString()))},[t,C]);const v=()=>Q(Ze,null,function*(){try{const be=yield(yield fetch("/api/partners")).json();be.success?S(be.partners):E("Hamkorlar ro'yxatini yuklashda xatolik")}catch(F){console.error("Hamkorlar yuklash xatosi:",F),E("Tarmoq xatoligi")}}),_=F=>{const be=We(F);(be===""?0:parseFloat(be)||0)>C?y(C.toString()):y(be)},X=()=>Q(Ze,null,function*(){if(!p){E("Hamkorni tanlang");return}const F=parseFloat(z)||0;if(F<=0){E("To'lov summasi noto'g'ri");return}if(F>C){E("To'lov summasi qoldiq summadan ko'p bo'lishi mumkin emas");return}M(!0),E("");try{const le=yield(yield fetch("/api/partners/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({partner:p,amount:F,item:{name:r.name,code:r.code,price:r.price,quantity:r.cartQuantity},customer:h?{name:h.name,phone:h.phone}:null,receiptNumber:`CHK-${Date.now()}`})})).json();if(le.success){l(p,F),n();const Te=w.find(W=>W.id===p);alert(`âœ… ${Te==null?void 0:Te.name} orqali ${b(F)} so'm to'lov muvaffaqiyatli yuborildi!`)}else E(le.message||"To'lov yuborishda xatolik")}catch(be){console.error("Hamkor to'lovi xatosi:",be),E("Tarmoq xatoligi yuz berdi")}finally{M(!1)}}),B=F=>{switch(F){case"uzum":return e.jsx(us,{className:"w-6 h-6"});case"ishonch":return e.jsx(Es,{className:"w-6 h-6"});default:return e.jsx(Ws,{className:"w-6 h-6"})}},he=F=>{switch(F){case"uzum":return"from-purple-500 to-purple-600";case"ishonch":return"from-amber-500 to-amber-600";default:return"from-blue-500 to-blue-600"}},pe=F=>{switch(F){case"uzum":return"Muddatli to'lov";case"ishonch":return"Kredit tizimi";default:return""}};return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm -z-10",onClick:n}),e.jsxs("div",{className:"bg-white w-full sm:w-auto rounded-t-2xl sm:rounded-2xl shadow-2xl max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-gray-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 truncate",children:"Hamkor to'lovi"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 truncate",children:r.name})]}),e.jsx("button",{onClick:n,className:"flex-shrink-0 w-10 h-10 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Umumiy summa:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[b(c)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"To'langan:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[b(P)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Qoldiq:"}),e.jsxs("span",{className:"font-bold text-blue-600",children:[b(C)," so'm"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Hamkorni tanlang"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:w.map(F=>e.jsx("button",{onClick:()=>q(F.id),className:`relative p-4 rounded-xl border-2 transition-all duration-200 ${p===F.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-r ${he(F.id)} flex items-center justify-center text-white`,children:B(F.id)}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:F.name}),e.jsx("p",{className:"text-sm text-gray-500",children:pe(F.id)})]}),p===F.id&&e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})},F.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To'lov summasi"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:z,onChange:F=>_(F.target.value),placeholder:"0",className:"w-full px-4 py-3 text-lg font-semibold border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:"so'm"})]}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("button",{onClick:()=>y((C/2).toString()),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Yarmini"}),e.jsx("button",{onClick:()=>y(C.toString()),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Hammasini"})]})]}),f&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:f})})]})}),e.jsxs("div",{className:"sticky bottom-0 z-10 bg-white/95 backdrop-blur-sm border-t border-gray-100 flex gap-3 p-4 sm:p-6",children:[e.jsx("button",{onClick:n,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:X,disabled:k||!p||!z,className:"flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-xl font-medium transition-colors",children:k?"Yuborilmoqda...":"Yuborish"})]})]})]}):null},ml=({item:t,selectedCustomer:n,isRegularCustomer:r,onSave:h,onCancel:l})=>{var R,P,C;const[w,S]=s.useState(((R=t.paymentBreakdown)==null?void 0:R.cash)||0),[p,q]=s.useState(((P=t.paymentBreakdown)==null?void 0:P.click)||0),[z,y]=s.useState(((C=t.paymentBreakdown)==null?void 0:C.card)||0),k=t.price*t.cartQuantity,M=w+p+z,f=k-M,E=()=>{f<-1||h(w,p,z)},c=(v,_)=>{const X=We(v),B=X===""?0:parseFloat(X)||0,he=_==="cash"?p+z:_==="click"?w+z:w+p,pe=k-he,F=B>pe?pe:B;_==="cash"?S(F):_==="click"?q(F):y(F)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Naqd pul"}),e.jsx("input",{type:"text",value:rs(w.toString()),onChange:v=>c(v.target.value,"cash"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-success-200 rounded-xl focus:outline-none focus:border-success-500 focus:ring-4 focus:ring-success-500/10 bg-success-50",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Click"}),e.jsx("input",{type:"text",value:rs(p.toString()),onChange:v=>c(v.target.value,"click"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-purple-200 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-500/10 bg-purple-50",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Plastik karta"}),e.jsx("input",{type:"text",value:rs(z.toString()),onChange:v=>c(v.target.value,"card"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-brand-200 rounded-xl focus:outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 bg-brand-50",placeholder:"0"})]})]}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Jami to'lov:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[b(M)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Tovar summasi:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[b(M)," so'm"]})]}),e.jsxs("div",{className:`flex justify-between text-sm font-semibold pt-2 border-t border-surface-200 ${f<=1&&f>=-1?"text-success-600":f>1?"text-warning-600":"text-danger-600"}`,children:[e.jsx("span",{children:"Qoldiq:"}),e.jsxs("span",{children:[b(k-M)," so'm"]})]}),f<-1&&e.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-lg p-2 mt-2",children:e.jsxs("p",{className:"text-xs text-warning-700",children:["âš ï¸ Ortiq pul kiritib bo'lmaydi. Maksimal: ",b(k)," so'm"]})}),f>1&&e.jsx("div",{className:`border rounded-lg p-2 mt-2 ${r?"bg-red-50 border-red-200":n?"bg-blue-50 border-blue-200":"bg-warning-50 border-warning-200"}`,children:e.jsx("p",{className:`text-xs ${r?"text-red-700":n?"text-blue-700":"text-warning-700"}`,children:r?e.jsx(e.Fragment,{children:"âŒ Oddiy mijozga qarz berib bo'lmaydi! To'liq to'lov talab qilinadi."}):n?e.jsxs(e.Fragment,{children:["â„¹ï¸ ",b(f)," so'm qoldiq qarz daftariga qo'shiladi va botga yuboriladi"]}):e.jsxs(e.Fragment,{children:["âš ï¸ ",b(f)," so'm qarz bo'ladi (mijoz tanlanmagan)"]})})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:l,className:"flex-1 py-3 text-surface-600 hover:text-surface-900 transition-colors rounded-xl border border-surface-200 hover:bg-surface-50",children:"Bekor qilish"}),e.jsx("button",{onClick:E,disabled:f<-1,className:`flex-1 py-3 rounded-xl font-semibold transition-colors ${f<-1?"bg-surface-300 text-surface-500 cursor-not-allowed":"bg-brand-500 hover:bg-brand-600 text-white"}`,children:"Saqlash"})]})]})};function xl(){const{showAlert:t,AlertComponent:n}=ws(),r=nt(),[h,l]=s.useState([]),[w,S]=s.useState([]),[p,q]=s.useState([]),[z,y]=s.useState(""),[k,M]=s.useState(!1),[f,E]=s.useState(!1),[c,R]=s.useState(""),[P,C]=s.useState([]),[v,_]=s.useState(null),[X,B]=s.useState(!1),[he,pe]=s.useState(!1),[F,be]=s.useState(""),[le,Te]=s.useState([]),[W,te]=s.useState([]),[D,xe]=s.useState(!1),[I,fe]=s.useState(!1),[ve,H]=s.useState({available:!1,printers:[],xPrinterFound:!1}),[T,ye]=s.useState("kod"),[de,ke]=s.useState(""),[ae,Ke]=s.useState(null),[is,Ve]=s.useState(!1),[Me,es]=s.useState(null),[u,re]=s.useState(!1),[Pe,Qe]=s.useState(null),[ge,Oe]=s.useState(!1),[m,je]=s.useState(null),[ze,Ie]=s.useState(15),[Re,_e]=s.useState(!1),[L,o]=s.useState(null),[Y,Se]=s.useState(""),[$e,Ce]=s.useState(!1),[N,J]=s.useState(null),[ue,we]=s.useState(""),[Be,Je]=s.useState(0),[Xe,hs]=s.useState({cash:0,click:0,card:0}),Ns=(a,$)=>{const A=a.price;let O=15;$>=100?O=11:$>=10?O=13:O=15;const ee=A*(1+O/100);return Math.round(ee)},Ms=(a,$)=>$!==void 0?{name:"Maxsus",markupPercent:$,discount:$<15,custom:!0}:a>=100?{name:"100+ dona",markupPercent:11,discount:!0,custom:!1}:a>=10?{name:"10-99 dona",markupPercent:13,discount:!0,custom:!1}:{name:"1-9 dona",markupPercent:15,discount:!1,custom:!1},gs=a=>{je(a);const $=Ms(a.cartQuantity,a.customMarkup);Ie($.markupPercent),Oe(!0)},Cs=()=>{if(!m)return;const a=m.costPrice||m.price/1.15,$=Math.round(a*(1+ze/100));q(A=>A.map(O=>O._id===m._id?j(g({},O),{price:$,customMarkup:ze}):O)),Oe(!1),je(null),t(`Narx yangilandi: ${ze}% qo'shimcha`,"Muvaffaqiyat","success")};s.useEffect(()=>{ps(),d(),V(),ce();const a=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=a,Ys.current&&clearTimeout(Ys.current)}},[]),s.useEffect(()=>{ps(),d()},[r.pathname]);const Rs=()=>Q(this,null,function*(){console.log("Refresh tugmasi bosildi"),fe(!0);try{console.log("Ma'lumotlar yangilanmoqda..."),yield Promise.all([ps(),d()]),console.log("Ma'lumotlar muvaffaqiyatli yangilandi"),t("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(a){console.error("Refresh xatosi:",a),t("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{fe(!1)}}),ps=()=>Q(this,null,function*(){try{const a=yield K.get("/products/kassa");l(a.data),console.log(`Kassa: ${a.data.length} ta tovar yuklandi`)}catch(a){console.error("Error fetching products:",a),t("Tovarlarni yuklashda xatolik","Xatolik","danger")}}),ys=a=>Q(this,null,function*(){if(!a.trim()||a.length===0){te([]),xe(!1);return}const $=h.filter(A=>A.code.toLowerCase().includes(a.toLowerCase())).sort((A,O)=>{const ee=A.code.toLowerCase().startsWith(a.toLowerCase()),ie=O.code.toLowerCase().startsWith(a.toLowerCase());return ee&&!ie?-1:!ee&&ie?1:A.code.localeCompare(O.code)});if(te($.slice(0,8)),xe(!0),$.length<5&&a.length>=1)try{const ee=((yield K.get(`/products/kassa?search=${encodeURIComponent(a)}`)).data||[]).filter(G=>G.code.toLowerCase().includes(a.toLowerCase())).sort((G,se)=>{const me=G.code.toLowerCase().startsWith(a.toLowerCase()),Le=se.code.toLowerCase().startsWith(a.toLowerCase());return me&&!Le?-1:!me&&Le?1:G.code.localeCompare(se.code)}),ie=[...$];ee.forEach(G=>{ie.find(me=>me._id===G._id)||ie.push(G)}),te(ie.slice(0,8)),l(G=>{const se=[...G];return ee.forEach(me=>{se.find(ks=>ks._id===me._id)||se.push(me)}),se})}catch(A){console.error("Error searching products by code:",A)}}),$s=a=>Q(this,null,function*(){if(!a.trim())return null;try{const $=h.find(O=>O.code===a.trim());if($)return $;const A=yield K.get(`/products/kassa?search=${encodeURIComponent(a.trim())}`);if(A.data&&A.data.length>0){const O=A.data.find(ee=>ee.code===a.trim());if(O)return l(ee=>ee.find(G=>G._id===O._id)?ee:[...ee,O]),O}return null}catch($){return console.error("Error searching product:",$),null}}),d=()=>Q(this,null,function*(){try{const a=yield K.get("/customers/kassa");S(a.data)}catch(a){console.error("Error fetching customers:",a)}}),ne=a=>{be(a)},x=w.filter(a=>a.name.toLowerCase().includes(F.toLowerCase())||a.phone.includes(F)),V=()=>{const a=localStorage.getItem("savedReceipts");a&&Te(JSON.parse(a))},ce=()=>Q(this,null,function*(){try{const a=yield ll();H(a),console.log("Printer holati:",a)}catch(a){console.error("Printer holatini tekshirishda xatolik:",a)}}),oe=p.reduce((a,$)=>a+$.price*$.cartQuantity,0),qe=a=>{if(a==="C")T==="kod"?(y(""),xe(!1),te([])):(ke("1"),ae&&p.find(A=>A._id===ae._id)&&q(A=>A.map(O=>O._id===ae._id?j(g({},O),{cartQuantity:1}):O)));else if(a==="âŒ«")if(T==="kod"){const $=z.slice(0,-1);y($),$.length>0?ys($):(xe(!1),te([]))}else{const $=de.slice(0,-1),A=$===""||parseInt($)===0?"1":$;if(ke(A),ae){const O=parseInt(A);O>0&&O<=ae.quantity&&p.find(ie=>ie._id===ae._id)&&q(ie=>ie.map(G=>G._id===ae._id?j(g({},G),{cartQuantity:O}):G))}}else if(a==="+")if(T==="kod")Ee(z);else if(ae&&de.trim()){const $=parseInt(de);if(!isNaN($)&&$>0){if($>ae.quantity){t(`${ae.name} uchun maksimal miqdor: ${ae.quantity} ta`,"Ogohlantirish","warning");return}p.find(O=>O._id===ae._id)?q(O=>O.map(ee=>ee._id===ae._id?j(g({},ee),{cartQuantity:$}):ee)):os(ae,$),Ke(null),ke(""),ye("kod")}}else ae||t("Mahsulot qo'shing","Ogohlantirish","warning");else if(T==="kod"){const $=z+a;y($),ys($)}else if(ae&&(/^[\d]$/.test(a)||a==="00")){const $=de+a,A=parseInt($);if(!isNaN(A)&&A>ae.quantity){t(`${ae.name} uchun maksimal miqdor: ${ae.quantity} ta`,"Ogohlantirish","warning");return}console.log("SON rejimida raqam kiritildi:",a,"Yangi qiymat:",$),ke($),!isNaN(A)&&A>0&&p.find(ee=>ee._id===ae._id)&&q(ee=>ee.map(ie=>ie._id===ae._id?j(g({},ie),{cartQuantity:A}):ie))}else ae||(ye("kod"),t("Mahsulot qo'shing","Ogohlantirish","warning"))},Ee=a=>Q(this,null,function*(){if(!a.trim())return;const $=yield $s(a.trim());if($){if($.quantity===0){t(`"${$.name}" tugagan, savatchaga qo'shib bo'lmaydi`,"Ogohlantirish","warning");return}cs($),y(""),xe(!1),te([])}else t(`Kod "${a}" bo'yicha tovar topilmadi`,"Xatolik","warning")}),Ae=a=>{if(a.quantity===0){t(`"${a.name}" tugagan, savatchaga qo'shib bo'lmaydi`,"Ogohlantirish","warning");return}cs(a),y(""),xe(!1),te([])},De=a=>{Ke(a),ye("son"),ke(a.cartQuantity.toString())},os=(a,$)=>{q(A=>{const O=A.find(ie=>ie._id===a._id);if(O){const ie=O.cartQuantity+$;if(ie>a.quantity)return t(`${a.name} uchun maksimal miqdor: ${a.quantity} ta`,"Ogohlantirish","warning"),A;const G=Ns(a,ie);return A.map(se=>se._id===a._id?j(g({},se),{cartQuantity:ie,price:G}):se)}const ee=Ns(a,$);return[...A,j(g({},a),{cartQuantity:$,price:ee})]}),E(!1),R("")},cs=a=>{q($=>{const A=$.find(ee=>ee._id===a._id);if(A){const ee=A.cartQuantity+1;if(ee>a.quantity)return t(`${a.name} uchun maksimal miqdor: ${a.quantity} ta`,"Ogohlantirish","warning"),$;const ie=Ns(a,ee);return $.map(G=>G._id===a._id?j(g({},G),{cartQuantity:ee,price:ie}):G)}const O=Ns(a,1);return[...$,j(g({},a),{cartQuantity:1,price:O})]}),E(!1),R("")},ts=a=>{q($=>$.filter(A=>A._id!==a))},Ge=a=>{o(a),Se(a.quantity.toString()),_e(!0)},xs=a=>Q(this,null,function*(){J(a),Ce(!0);try{const $=`${Ut}/product/${a._id}`,A=yield Xt($,{width:300,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});we(A)}catch($){console.error("QR generation error:",$),t("QR kod yaratishda xatolik","Xatolik","danger")}}),ds=()=>{if(!N||!ue)return;const a=window.open("","_blank","width=600,height=400");if(!a){t("Popup bloklangan. Iltimos, popup ga ruxsat bering.","Ogohlantirish","warning");return}a.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Label - ${N.name}</title>
        <style>
          @page {
            size: 60mm 40mm;
            margin: 0;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, Helvetica, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .label {
            width: 60mm;
            height: 40mm;
            padding: 2mm;
            background: white;
            display: flex;
            flex-direction: column;
          }
          .top-section {
            display: flex;
            gap: 2mm;
            flex: 1;
          }
          .qr-box {
            width: 22mm;
            height: 22mm;
            flex-shrink: 0;
          }
          .qr-code {
            width: 22mm;
            height: 22mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
          }
          .product-code {
            font-size: 7pt;
            font-weight: 600;
            color: #666;
            margin-bottom: 1mm;
          }
          .product-name {
            font-size: 9pt;
            font-weight: 700;
            color: #000;
            line-height: 1.2;
            text-transform: uppercase;
            word-break: break-word;
          }
          .bottom-section {
            margin-top: 1.5mm;
          }
          .price-box {
            padding: 1.5mm;
            text-align: center;
            background: #f0f0f0;
            border-radius: 1mm;
          }
          .price-value {
            font-size: 14pt;
            font-weight: 900;
            color: #000;
            letter-spacing: -0.5px;
          }
          .price-currency {
            font-size: 10pt;
            font-weight: 700;
            color: #000;
            margin-left: 1mm;
          }
          @media print {
            body { background: white; }
          }
        </style>
      </head>
      <body>
        <div class="label">
          <div class="top-section">
            <div class="qr-box">
              <img src="${ue}" alt="QR" class="qr-code" />
            </div>
            <div class="info-box">
              <div class="product-code">Kod: ${N.code}</div>
              <div class="product-name">${N.name}</div>
            </div>
          </div>
          <div class="bottom-section">
            <div class="price-box">
              <span class="price-value">${b(N.price)}</span>
              <span class="price-currency">so'm</span>
            </div>
          </div>
        </div>
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 200);
          }
        <\/script>
      </body>
      </html>
    `),a.document.close()},Bs=()=>Q(this,null,function*(){var $,A;if(!L)return;const a=parseInt(Y);if(isNaN(a)||a<0){t("Noto'g'ri miqdor kiritildi","Xatolik","danger");return}try{yield K.put(`/products/${L._id}`,{quantity:a}),l(O=>O.map(ee=>ee._id===L._id?j(g({},ee),{quantity:a}):ee)),q(O=>O.map(ee=>ee._id===L._id&&ee.cartQuantity>a?j(g({},ee),{cartQuantity:a}):ee)),t("Mahsulot qadi yangilandi","Muvaffaqiyat","success"),_e(!1),o(null),Se("")}catch(O){console.error("Error updating quantity:",O),t(((A=($=O.response)==null?void 0:$.data)==null?void 0:A.message)||"Qadni yangilashda xatolik","Xatolik","danger")}}),Ys=s.useRef(null),et=a=>{if(R(a),Ys.current&&clearTimeout(Ys.current),a.length>0){const $=a.toLowerCase().trim(),A=$.split(/\s+/).filter(ee=>ee.length>0),O=h.filter(ee=>{const ie=ee.name.toLowerCase(),G=ee.code.toLowerCase();return A.length===1?ie.includes($)||G.includes($):A.every(se=>ie.includes(se)||G.includes(se))});C(O),O.length<10&&a.length>=2&&(Ys.current=setTimeout(()=>Q(this,null,function*(){try{const ie=(yield K.get(`/products/kassa?search=${encodeURIComponent(a)}`)).data||[],G=[...O];ie.forEach(se=>{G.find(Le=>Le._id===se._id)||G.push(se)}),C(G),l(se=>{const me=[...se];return ie.forEach(Le=>{me.find(Ss=>Ss._id===Le._id)||me.push(Le)}),me})}catch(ee){console.error("Error searching products:",ee)}}),300))}else C(h.slice(0,20))},ot=a=>{es(a),Ve(!0)},i=a=>{Qe(a),re(!0)},U=(a,$,A)=>Q(this,null,function*(){if(!Me)return;const O=Me.price*Me.cartQuantity,ee=a+$+A;if(ee>O+1){t(`Ortiq pul kiritib bo'lmaydi. Maksimal: ${b(O)} so'm, Kiritilgan: ${b(ee)} so'm`,"Xatolik","danger");return}const ie=O-ee;if(ie>1&&X){t("Oddiy mijozga qarz berib bo'lmaydi! To'liq to'lov talab qilinadi.","Xatolik","danger");return}if(ie>1&&v)try{console.log(`Tovar uchun qoldiq qarz yaratilmoqda: ${ie} so'm`);const G={customer:v._id,amount:ie,paidAmount:0,description:`${Me.name} uchun qoldiq to'lov - ${new Date().toLocaleDateString("uz-UZ")}`,items:[{product:Me._id,name:Me.name,code:Me.code,price:Me.price,quantity:Me.cartQuantity}]};yield K.post("/debts/kassa",G),console.log("âœ… Tovar uchun qoldiq qarz muvaffaqiyatli qo'shildi va botga yuborildi"),t(`${b(ie)} so'm qarz qo'shildi va botga yuborildi`,"Ma'lumot","info")}catch(G){console.error("âŒ Qarz yaratishda xatolik:",G),t("Qarz yaratishda xatolik yuz berdi","Ogohlantirish","warning")}q(G=>G.map(se=>{var me;return se._id===Me._id?j(g({},se),{paymentBreakdown:{cash:a,click:$,card:A,partner:((me=se.paymentBreakdown)==null?void 0:me.partner)||0}}):se})),Ve(!1),es(null)}),Z=()=>{if(p.length===0){t("Chek bo'sh","Ogohlantirish","warning");return}const a={id:Date.now().toString(),items:[...p],total:oe,savedAt:new Date().toLocaleString()},$=[...le,a];Te($),localStorage.setItem("savedReceipts",JSON.stringify($)),q([]),_(null),B(!1),t("Chek saqlandi!","Muvaffaqiyat","success")};return e.jsxs("div",{className:"h-full flex flex-col lg:flex-row overflow-hidden",children:[n,e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0",children:[e.jsxs("div",{className:"p-2 sm:p-3 lg:p-4 flex flex-col sm:flex-row sm:items-center justify-between gap-2 bg-white border-b border-surface-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-col xs:flex-row xs:items-center gap-2 xs:gap-3",children:[e.jsxs("span",{className:"text-xs sm:text-sm text-surface-600 font-medium",children:["JAMI: ",p.length," ta mahsulot"]}),e.jsxs("button",{onClick:Rs,disabled:I,className:"flex items-center gap-1 px-2 py-1 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50 text-xs w-fit",children:[e.jsx(As,{className:`w-3 h-3 ${I?"animate-spin":""}`}),e.jsx("span",{className:"hidden xs:inline",children:I?"Yangilanmoqda...":"Yangilash"}),e.jsx("span",{className:"xs:hidden",children:I?"...":"â†»"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:v?e.jsxs("div",{className:"flex items-center gap-2 bg-brand-50 border border-brand-200 rounded-lg px-3 py-2",children:[e.jsx("div",{className:"w-6 h-6 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-brand-600",children:v.name.charAt(0)})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-brand-700",children:v.name}),e.jsx("span",{className:"text-xs text-brand-600",children:v.phone})]}),e.jsx("button",{onClick:()=>_(null),className:"ml-2 w-5 h-5 flex items-center justify-center rounded-full text-brand-500 hover:bg-brand-200 transition-colors",children:"Ã—"})]}):X?e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Oddiy mijoz"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Qarz berib bo'lmaydi"})]}),e.jsx("button",{onClick:()=>B(!1),className:"ml-2 w-5 h-5 flex items-center justify-center rounded-full text-gray-500 hover:bg-gray-200 transition-colors",children:"Ã—"})]}):e.jsxs("button",{onClick:()=>pe(!0),className:"flex items-center gap-2 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),e.jsx("span",{children:"Mijoz tanlash"})]})})]}),e.jsxs("div",{className:"flex-1 bg-white overflow-hidden flex flex-col min-h-0",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-2 px-3 sm:px-4 py-3 bg-surface-50 border-b border-surface-200 text-xs font-semibold text-surface-500 uppercase flex-shrink-0",children:[e.jsx("div",{className:"col-span-1",children:"Kod"}),e.jsx("div",{className:"col-span-4",children:"Mahsulot"}),e.jsx("div",{className:"col-span-2 text-center",children:"Soni"}),e.jsx("div",{className:"col-span-2 text-right",children:"Narx"}),e.jsx("div",{className:"col-span-2 text-right",children:"Summa"}),e.jsx("div",{className:"col-span-1 text-center",children:"Amallar"})]}),e.jsx("div",{className:"flex-1 overflow-auto min-h-0",children:p.length===0?D&&W.length>0?e.jsxs("div",{className:"p-2 sm:p-3 lg:p-4 h-full flex flex-col",children:[e.jsx("div",{className:"text-center mb-2 sm:mb-3 flex-shrink-0",children:e.jsxs("p",{className:"text-sm text-surface-500",children:['"',z,`" ni o'z ichiga olgan tovarlar`,W.length>4&&e.jsxs("span",{className:"block text-xs text-surface-400 mt-1",children:["Jami ",W.length," ta tovar"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-1 sm:space-y-2 min-h-0",children:W.map((a,$)=>e.jsxs("button",{onClick:()=>Ae(a),disabled:a.quantity===0,className:`w-full flex items-center gap-2 sm:gap-3 p-2 sm:p-3 rounded-xl transition-colors text-left relative overflow-hidden ${a.quantity===0?"bg-red-50 border-2 border-red-200 cursor-not-allowed opacity-80":$<4?"bg-brand-50 hover:bg-brand-100 border border-brand-200":"bg-surface-50 hover:bg-surface-100 border border-transparent"}`,children:[a.quantity===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none bg-red-50 bg-opacity-90 rounded-xl",children:e.jsx("div",{className:"bg-red-500 text-white text-xs sm:text-sm font-bold px-2 sm:px-4 py-1 sm:py-2 rounded-full shadow-lg border-2 border-white transform rotate-12 animate-pulse",children:"TUGAGAN"})}),a.images&&a.images.length>0?e.jsx("img",{src:`${Ps}${typeof a.images[0]=="string"?a.images[0]:a.images[0].path}`,alt:a.name,className:`w-12 h-12 sm:w-14 sm:h-14 rounded-xl object-cover ${a.quantity===0?"opacity-50 grayscale":""}`,onError:A=>{var O;A.currentTarget.style.display="none",(O=A.currentTarget.nextElementSibling)==null||O.classList.remove("hidden")}}):null,e.jsx("div",{className:`${a.images&&a.images.length>0?"hidden":""} w-8 h-8 sm:w-10 sm:h-10 rounded-xl flex items-center justify-center ${a.quantity===0?"bg-red-100":"bg-brand-100"}`,children:e.jsx(Fe,{className:`w-4 h-4 sm:w-5 sm:h-5 ${a.quantity===0?"text-red-600":"text-brand-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0 relative",children:[e.jsx("p",{className:`font-medium text-sm sm:text-base truncate ${a.quantity===0?"text-red-700 opacity-60":"text-surface-900"}`,children:a.name}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 text-xs sm:text-sm text-surface-500",children:[e.jsx("span",{className:`font-mono px-1.5 sm:px-2 py-0.5 rounded border text-xs ${a.quantity===0?"bg-red-100 border-red-300 text-red-700 opacity-60":"bg-white"}`,children:z&&a.code.toLowerCase().includes(z.toLowerCase())?e.jsx(e.Fragment,{children:a.code.split(new RegExp(`(${z})`,"gi")).map((A,O)=>A.toLowerCase()===z.toLowerCase()?e.jsx("span",{className:"bg-yellow-200 text-yellow-800 font-bold",children:A},O):e.jsx("span",{children:A},O))}):a.code}),a.quantity!==void 0&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${a.quantity>10?"bg-success-100 text-success-700":a.quantity>0?"bg-warning-100 text-warning-700":"bg-danger-100 text-danger-700 font-bold animate-pulse"}`,children:a.quantity>0?`${a.quantity} ta`:"TUGAGAN"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`font-semibold text-sm sm:text-base ${a.quantity===0?"text-red-600 opacity-60":"text-brand-600"}`,children:b(a.price)}),e.jsx("p",{className:`text-xs ${a.quantity===0?"text-red-500":"text-surface-500"}`,children:a.quantity===0?"Mavjud emas":"so'm"})]})]},a._id))})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-surface-400 py-8 sm:py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Fe,{className:"w-8 h-8 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 opacity-50"}),e.jsx("p",{className:"text-sm sm:text-base",children:"Savat bo'sh"}),z.length>0&&e.jsx("p",{className:"text-xs sm:text-sm mt-1 sm:mt-2",children:"Kod kiriting yoki qidiring"})]})}):e.jsx("div",{className:"space-y-3 p-4",children:p.map(a=>{const $=a.cartQuantity>a.quantity;return e.jsxs("div",{className:"bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 border border-surface-100 overflow-hidden",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-3 p-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"px-2 py-1 bg-surface-50 rounded-lg",children:e.jsx("span",{className:"text-xs font-mono font-semibold text-surface-700",children:a.code})})}),e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold text-surface-900",children:a.name}),$&&e.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 text-yellow-700 text-[10px] font-semibold rounded-full whitespace-nowrap",children:"Kam!"})]})}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("input",{type:"text",value:a.cartQuantity,onClick:()=>De(a),onChange:A=>{const O=A.target.value;if(O===""||/^\d+$/.test(O)){const ee=O===""?0:parseInt(O),ie=Ns(a,ee);q(G=>G.map(se=>se._id===a._id?j(g({},se),{cartQuantity:ee,price:ie}):se))}},onBlur:()=>{(a.cartQuantity===0||!a.cartQuantity)&&ts(a._id)},className:`w-20 h-10 text-center font-bold text-lg border-2 rounded-xl focus:outline-none focus:ring-2 cursor-pointer transition-all ${a.cartQuantity>a.quantity?"border-danger-500 bg-danger-50 text-danger-700 focus:border-danger-500 focus:ring-danger-500/20":"border-brand-200 bg-brand-50/50 text-brand-700 focus:border-brand-500 focus:ring-brand-500/20 hover:bg-brand-50"}`})}),e.jsx("div",{className:"col-span-2 text-right",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-base font-bold text-surface-900",children:b(a.price)}),(()=>{const A=Ms(a.cartQuantity,a.customMarkup);return e.jsxs("div",{onClick:()=>gs(a),className:`text-xs px-2.5 py-1 rounded-full inline-block cursor-pointer hover:scale-105 transition-all font-medium shadow-sm ${A.custom?"bg-gradient-to-r from-purple-500 to-purple-600 text-white":A.discount?"bg-gradient-to-r from-success-500 to-success-600 text-white":"bg-gradient-to-r from-surface-100 to-surface-200 text-surface-700"}`,title:"Foizni o'zgartirish uchun bosing",children:[A.name," (",A.markupPercent,"%)"]})})()]})}),e.jsxs("div",{className:"col-span-2 text-right",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 text-white px-3 py-2 rounded-xl inline-block shadow-lg",children:e.jsx("span",{className:"text-base font-black",children:b(a.price*a.cartQuantity)})}),a.paymentBreakdown&&e.jsxs("div",{className:"mt-2 space-y-1",children:[a.paymentBreakdown.cash>0&&e.jsxs("div",{className:"flex items-center justify-end gap-1.5 text-xs",children:[e.jsx("div",{className:"w-5 h-5 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ns,{className:"w-3 h-3 text-green-600"})}),e.jsx("span",{className:"font-medium text-green-700",children:b(a.paymentBreakdown.cash)})]}),a.paymentBreakdown.click>0&&e.jsxs("div",{className:"flex items-center justify-end gap-1.5 text-xs",children:[e.jsx("div",{className:"w-5 h-5 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Ws,{className:"w-3 h-3 text-purple-600"})}),e.jsx("span",{className:"font-medium text-purple-700",children:b(a.paymentBreakdown.click)})]}),a.paymentBreakdown.card>0&&e.jsxs("div",{className:"flex items-center justify-end gap-1.5 text-xs",children:[e.jsx("div",{className:"w-5 h-5 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Es,{className:"w-3 h-3 text-blue-600"})}),e.jsx("span",{className:"font-medium text-blue-700",children:b(a.paymentBreakdown.card)})]}),a.paymentBreakdown.partner&&a.paymentBreakdown.partner>0&&e.jsxs("div",{className:"flex items-center justify-end gap-1.5 text-xs",children:[e.jsx("div",{className:"w-5 h-5 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Ws,{className:"w-3 h-3 text-blue-600"})}),e.jsx("span",{className:"font-medium text-blue-700",children:b(a.paymentBreakdown.partner)})]})]}),!a.paymentBreakdown&&e.jsxs("button",{onClick:()=>ot(a),className:"mt-2 inline-flex items-center gap-1.5 px-3 py-1.5 text-xs bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg transition-all shadow-md hover:shadow-lg font-medium",children:[e.jsx(Es,{className:"w-3 h-3"}),"To'lov"]})]}),e.jsxs("div",{className:"col-span-1 flex justify-center gap-1.5",children:[e.jsx("button",{onClick:()=>i(a),className:"w-9 h-9 flex items-center justify-center rounded-xl text-purple-600 bg-purple-50 hover:bg-purple-100 transition-all shadow-sm hover:shadow-md",title:"Hamkor orqali to'lash",children:e.jsx(Ws,{className:"w-4 h-4"})}),a.paymentBreakdown&&e.jsx("button",{onClick:()=>ot(a),className:"w-7 h-7 flex items-center justify-center rounded-lg text-brand-500 hover:bg-brand-50 transition-colors",title:"To'lov turini o'zgartirish",children:e.jsx(Es,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ts(a._id),className:"w-7 h-7 flex items-center justify-center rounded-lg text-danger-500 hover:bg-danger-50 transition-colors",children:e.jsx(zs,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"md:hidden p-4 bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 border border-gray-100",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-base",children:a.name}),$&&e.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 text-yellow-700 text-[10px] font-semibold rounded-full whitespace-nowrap",children:"Kam!"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500 font-mono bg-gray-100 px-2 py-1 rounded-md",children:["Kod: ",a.code]}),e.jsxs("span",{className:`text-xs px-2 py-1 rounded-md font-medium ${a.quantity>10?"bg-green-100 text-green-700":a.quantity>0?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[a.quantity," ta"]})]})]}),e.jsx("button",{onClick:()=>ts(a._id),className:"ml-3 w-10 h-10 flex items-center justify-center rounded-xl bg-gradient-to-br from-red-50 to-red-100 text-red-600 hover:from-red-100 hover:to-red-200 transition-all shadow-sm hover:shadow-md",children:e.jsx(zs,{className:"w-4.5 h-4.5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-white p-3 rounded-xl shadow-sm",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Soni:"}),e.jsx("input",{type:"text",value:a.cartQuantity,onClick:()=>De(a),onChange:A=>{const O=A.target.value;if(O===""||/^\d+$/.test(O)){const ee=O===""?0:parseInt(O),ie=Ns(a,ee);q(G=>G.map(se=>se._id===a._id?j(g({},se),{cartQuantity:ee,price:ie}):se))}},onBlur:()=>{(a.cartQuantity===0||!a.cartQuantity)&&ts(a._id)},className:`w-20 h-10 text-center font-semibold border-2 rounded-xl focus:outline-none focus:ring-2 cursor-pointer transition-all ${a.cartQuantity>a.quantity?"border-red-400 bg-red-50 text-red-700 focus:border-red-500 focus:ring-red-500/20":"border-blue-300 bg-blue-50 text-blue-700 focus:border-blue-500 focus:ring-blue-500/20 hover:bg-blue-100"}`})]}),e.jsxs("div",{className:"bg-white p-3 rounded-xl shadow-sm space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Narxi:"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[b(a.price)," so'm"]})]}),(()=>{const A=Ms(a.cartQuantity,a.customMarkup);return e.jsxs("div",{onClick:()=>gs(a),className:`text-xs px-3 py-1.5 rounded-lg inline-flex items-center gap-1.5 cursor-pointer transition-all shadow-sm hover:shadow-md font-medium ${A.custom?"bg-gradient-to-r from-purple-500 to-pink-500 text-white":A.discount?"bg-gradient-to-r from-green-500 to-emerald-500 text-white":"bg-gradient-to-r from-gray-400 to-gray-500 text-white"}`,title:"Foizni o'zgartirish uchun bosing",children:[e.jsx("span",{children:A.name}),e.jsxs("span",{className:"font-bold",children:["(",A.markupPercent,"%)"]})]})})(),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 p-3 rounded-xl shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:"Jami:"}),e.jsxs("span",{className:"text-lg font-bold text-white",children:[b(a.price*a.cartQuantity)," so'm"]})]})})]}),a.paymentBreakdown&&e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-purple-50 p-3 rounded-xl shadow-sm space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:"To'lov turlari:"}),a.paymentBreakdown.cash>0&&e.jsxs("div",{className:"flex items-center justify-between bg-white px-3 py-2 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center shadow-md",children:e.jsx(ns,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Naqd"})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[b(a.paymentBreakdown.cash)," so'm"]})]}),a.paymentBreakdown.click>0&&e.jsxs("div",{className:"flex items-center justify-between bg-white px-3 py-2 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-400 to-purple-600 flex items-center justify-center shadow-md",children:e.jsx(Ws,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Click"})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[b(a.paymentBreakdown.click)," so'm"]})]}),a.paymentBreakdown.card>0&&e.jsxs("div",{className:"flex items-center justify-between bg-white px-3 py-2 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center shadow-md",children:e.jsx(Es,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Karta"})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[b(a.paymentBreakdown.card)," so'm"]})]}),a.paymentBreakdown.partner&&a.paymentBreakdown.partner>0&&e.jsxs("div",{className:"flex items-center justify-between bg-white px-3 py-2 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-400 to-indigo-600 flex items-center justify-center shadow-md",children:e.jsx(Ws,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Hamkor"})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[b(a.paymentBreakdown.partner)," so'm"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>i(a),className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-xl transition-all shadow-md hover:shadow-lg font-medium",children:[e.jsx(Ws,{className:"w-4 h-4"}),"Hamkor"]}),!a.paymentBreakdown&&e.jsxs("button",{onClick:()=>ot(a),className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl transition-all shadow-md hover:shadow-lg font-medium",children:[e.jsx(Es,{className:"w-4 h-4"}),"To'lov"]}),a.paymentBreakdown&&e.jsx("button",{onClick:()=>ot(a),className:"px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl transition-all shadow-md hover:shadow-lg",title:"To'lov turini o'zgartirish",children:e.jsx(Es,{className:"w-5 h-5"})})]})]})]})]},a._id)})})})]}),D&&W.length>0&&p.length>0&&e.jsxs("div",{className:"mt-4 bg-white border border-surface-200 rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-surface-100 bg-surface-50",children:e.jsxs("p",{className:"text-sm text-surface-600 text-center",children:['"',z,`" ni o'z ichiga olgan tovarlar (`,W.length," ta)"]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:W.map(a=>e.jsxs("button",{onClick:()=>Ae(a),disabled:a.quantity===0,className:`w-full flex items-center gap-3 p-3 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0 relative ${a.quantity===0?"opacity-60 cursor-not-allowed":""}`,children:[a.quantity===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none bg-red-50 bg-opacity-80 rounded",children:e.jsx("span",{className:"bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg",children:"TUGAGAN"})}),a.images&&a.images.length>0?e.jsx("img",{src:`${Ps}${typeof a.images[0]=="string"?a.images[0]:a.images[0].path}`,alt:a.name,className:`w-12 h-12 rounded-xl object-cover flex-shrink-0 ${a.quantity===0?"opacity-50 grayscale":""}`,onError:$=>{var A;$.currentTarget.style.display="none",(A=$.currentTarget.nextElementSibling)==null||A.classList.remove("hidden")}}):null,e.jsx("div",{className:`${a.images&&a.images.length>0?"hidden":""} w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 ${a.quantity===0?"bg-red-100":"bg-brand-100"}`,children:e.jsx(Fe,{className:`w-5 h-5 ${a.quantity===0?"text-red-600":"text-brand-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium text-base truncate ${a.quantity===0?"text-red-700":"text-surface-900"}`,children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm mt-1",children:[e.jsx("span",{className:`font-mono px-2 py-1 rounded border ${a.quantity===0?"bg-red-100 border-red-300 text-red-700":"bg-white border-surface-200"}`,children:z&&a.code.toLowerCase().includes(z.toLowerCase())?e.jsx(e.Fragment,{children:a.code.split(new RegExp(`(${z})`,"gi")).map(($,A)=>$.toLowerCase()===z.toLowerCase()?e.jsx("span",{className:"bg-yellow-200 text-yellow-800 font-bold",children:$},A):e.jsx("span",{children:$},A))}):a.code}),a.quantity!==void 0&&e.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${a.quantity>10?"bg-success-100 text-success-700":a.quantity>0?"bg-warning-100 text-warning-700":"bg-danger-100 text-danger-700"}`,children:a.quantity>0?`${a.quantity} ta`:"TUGAGAN"}),e.jsx("button",{onClick:$=>{$.stopPropagation(),Ge(a)},className:"px-1.5 py-0.5 rounded text-[10px] font-medium bg-brand-100 text-brand-700 hover:bg-brand-200 transition-colors",title:"Qadni o'zgartirish",children:"âœï¸"})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:`font-semibold text-lg ${a.quantity===0?"text-red-600":"text-brand-600"}`,children:b(a.price)}),e.jsx("p",{className:`text-sm ${a.quantity===0?"text-red-500":"text-surface-500"}`,children:"so'm"})]})]},a._id))})]}),e.jsx("div",{className:"p-2 sm:p-3 lg:p-4 bg-white border-t border-surface-200 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>{E(!0),et("")},className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-white border border-surface-200 rounded-lg text-surface-700 hover:bg-surface-50 transition-colors flex-1 min-w-[100px]",children:[e.jsx(bs,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"Qidirish"})]}),e.jsxs("button",{onClick:Z,className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-white border border-surface-200 rounded-lg text-surface-700 hover:bg-surface-50 transition-colors flex-1 min-w-[100px]",children:[e.jsx(ut,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"Saqlash"})]}),p.length>0&&e.jsxs("button",{onClick:()=>{const a=p.reduce((ie,G)=>{var se;return ie+(((se=G.paymentBreakdown)==null?void 0:se.cash)||0)},0),$=p.reduce((ie,G)=>{var se;return ie+(((se=G.paymentBreakdown)==null?void 0:se.click)||0)},0),A=p.reduce((ie,G)=>{var se;return ie+(((se=G.paymentBreakdown)==null?void 0:se.card)||0)},0),O=p.reduce((ie,G)=>{var se;return ie+(((se=G.paymentBreakdown)==null?void 0:se.partner)||0)},0),ee=a+$+A+O;hs({cash:a,click:$,card:A}),Je(ee),M(!0)},className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-success-500 text-white rounded-lg hover:bg-success-600 transition-colors flex-1 min-w-[100px] font-semibold",children:[e.jsx(va,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"To'lov"})]})]})})]}),e.jsxs("div",{className:"w-full lg:w-72 xl:w-80 bg-white border-t lg:border-t-0 lg:border-l border-surface-200 p-2 sm:p-3 lg:p-4 flex flex-col flex-shrink-0",children:[e.jsx("div",{className:"text-center xl:text-right mb-3 sm:mb-4",children:e.jsxs("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-surface-900",children:[b(oe)," so'm"]})}),e.jsx("div",{className:"text-center mb-2 bg-surface-50 rounded-lg py-3 px-4 min-h-[60px] flex flex-col items-center justify-center",children:T==="kod"?z?e.jsxs("div",{className:"text-lg font-mono text-surface-900",children:["Kod: ",e.jsx("span",{className:"font-bold text-brand-600",children:z})]}):e.jsx("div",{className:"text-sm text-surface-500",children:"Mahsulot kodini kiriting"}):e.jsxs("div",{className:"text-center w-full",children:[ae&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-sm font-medium text-surface-700",children:ae.name}),e.jsxs("div",{className:"text-xs text-surface-500",children:["Mavjud: ",ae.quantity," ta"]})]}),e.jsx("div",{className:"text-xs text-surface-500 mb-1 uppercase tracking-wider",children:"SONI"}),de?e.jsx("div",{className:`text-3xl font-bold rounded-lg py-2 px-4 border-2 inline-block min-w-[80px] ${ae&&parseInt(de)>ae.quantity?"bg-red-50 border-red-500 text-red-700 animate-pulse":"bg-white border-gray-200 text-gray-800"}`,children:de}):e.jsx("div",{className:"text-lg text-surface-400 bg-white rounded-lg py-2 px-4 border-2 border-dashed border-gray-300 inline-block min-w-[80px]",children:ae?"0":"â€”"})]})}),e.jsxs("div",{className:"relative mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex mb-2 sm:mb-3 bg-surface-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>{ye("kod"),ke("")},className:`flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all ${T==="kod"?"bg-blue-500 text-white shadow-sm":"text-surface-600 hover:text-surface-900"}`,children:"KOD"}),e.jsx("button",{onClick:()=>{ye("son"),y(""),xe(!1),te([])},className:`flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all ${T==="son"?"bg-gray-500 text-white shadow-sm":"text-surface-600 hover:text-surface-900"}`,children:"SON"})]}),T==="kod"?e.jsx("input",{type:"text",value:z,onChange:a=>{const $=a.target.value;y($),$.length>0?ys($):(xe(!1),te([]))},onKeyDown:a=>{a.key==="Enter"?(a.preventDefault(),Ee(z)):a.key==="Escape"&&(xe(!1),te([]))},onFocus:()=>{z.length>0&&ys(z)},placeholder:"Kod kiriting...",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-center text-sm sm:text-base font-mono bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"}):e.jsx("input",{type:"text",value:de,onChange:a=>{const $=a.target.value;/^\d*$/.test($)&&ke($)},onKeyDown:a=>{if(a.key==="Enter"&&(a.preventDefault(),ae&&de.trim())){const $=parseInt(de);if(!isNaN($)&&$>0){if($>ae.quantity){t(`${ae.name} uchun maksimal miqdor: ${ae.quantity} ta`,"Ogohlantirish","warning");return}os(ae,$),Ke(null),ke(""),ye("kod"),t(`${ae.name} (${$} ta) savatchaga qo'shildi`,"Muvaffaqiyat","success")}}},placeholder:"1",disabled:!ae,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-center text-lg sm:text-xl font-bold rounded-lg focus:outline-none focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed ${ae&&de&&parseInt(de)>ae.quantity?"bg-red-50 border-2 border-red-500 text-red-700 focus:border-red-500 focus:ring-red-500/20":"bg-surface-50 border border-surface-200 focus:border-gray-500 focus:ring-gray-500/20"}`})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1 sm:gap-2 mb-3",children:["7","8","9","C","4","5","6","âŒ«","1","2","3","+","0","00","."].map(a=>e.jsx("button",{onClick:()=>qe(a),className:`
                flex items-center justify-center rounded-lg text-base sm:text-lg font-semibold transition-all active:scale-95
                ${a==="C"?"bg-red-500 text-white hover:bg-red-600":""}
                ${a==="âŒ«"?"bg-orange-500 text-white hover:bg-orange-600":""}
                ${a==="+"?`${T==="kod"?"bg-green-500 hover:bg-green-600":"bg-blue-500 hover:bg-blue-600"} text-white row-span-2`:""}
                ${["C","âŒ«","+"].includes(a)?"":"bg-surface-100 text-surface-700 hover:bg-surface-200"}
                ${a==="+"?"h-full":"h-10 sm:h-12 lg:h-14"}
              `,children:a==="âŒ«"?e.jsx(rr,{className:"w-4 h-4 sm:w-5 sm:h-5"}):a==="+"?T==="kod"?"+":"âœ“":a},a))})]}),f&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start justify-center pt-4 sm:pt-20 px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>E(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl relative z-10 overflow-hidden max-h-[90vh] sm:max-h-none",children:[e.jsx("div",{className:"p-4 border-b border-surface-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(bs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Nom yoki kod bo'yicha qidiring...",value:c,onChange:a=>et(a.target.value),className:"w-full pl-12 pr-4 py-3 bg-surface-50 border border-surface-200 rounded-xl focus:outline-none focus:border-brand-500",autoFocus:!0})]})}),e.jsxs("div",{className:"max-h-[500px] sm:max-h-[600px] overflow-auto p-4",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-4",children:P.map(a=>e.jsxs("button",{onClick:()=>cs(a),className:"flex flex-col bg-white border border-surface-200 rounded-xl hover:shadow-lg hover:border-brand-300 transition-all p-3 text-left group relative",children:[e.jsx("button",{onClick:$=>{$.stopPropagation(),xs(a)},className:"absolute top-2 right-2 z-10 w-8 h-8 flex items-center justify-center bg-white/90 backdrop-blur-sm hover:bg-brand-500 hover:text-white rounded-lg shadow-md transition-all duration-200 group/qr",title:"QR kod",children:e.jsx(ht,{className:"w-4 h-4"})}),e.jsxs("div",{className:"relative w-full aspect-square mb-3 rounded-lg overflow-hidden bg-surface-50",children:[a.images&&a.images.length>0?e.jsx("img",{src:`${Ps}${typeof a.images[0]=="string"?a.images[0]:a.images[0].path}`,alt:a.name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300",onError:$=>{const A=$.currentTarget;A.style.display="none";const O=A.nextElementSibling;O&&O.classList.remove("hidden")}}):null,e.jsx("div",{className:`${a.images&&a.images.length>0?"hidden":""} absolute inset-0 flex items-center justify-center bg-gradient-to-br from-brand-50 to-brand-100`,children:e.jsx(Fe,{className:"w-12 h-12 text-brand-400"})}),a.quantity!==void 0&&e.jsx("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-lg text-xs font-bold shadow-lg ${a.quantity>10?"bg-success-500 text-white":a.quantity>0?"bg-warning-500 text-white":"bg-danger-500 text-white"}`,children:a.quantity>0?`${a.quantity}`:"Tugagan"})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("p",{className:"font-semibold text-surface-900 text-sm line-clamp-2 mb-2 min-h-[2.5rem]",children:a.name}),e.jsxs("p",{className:"text-xs text-surface-500 mb-2 font-mono",children:["#",a.code]}),e.jsxs("div",{className:"mt-auto",children:[e.jsx("p",{className:"text-lg font-bold text-brand-600",children:b(a.price)}),e.jsx("p",{className:"text-xs text-surface-400",children:"so'm"})]})]})]},a._id))}),c&&P.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Fe,{className:"w-8 h-8 text-surface-400"})}),e.jsx("p",{className:"text-center text-surface-500 font-medium",children:"Tovar topilmadi"}),e.jsx("p",{className:"text-center text-surface-400 text-sm mt-1",children:"Boshqa nom yoki kod bilan qidiring"})]})]})]})]}),he&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start justify-center pt-4 sm:pt-20 px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>pe(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl relative z-10 overflow-hidden max-h-[90vh] sm:max-h-none",children:[e.jsxs("div",{className:"p-4 border-b border-surface-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Mijoz tanlash"}),e.jsx("button",{onClick:()=>pe(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:bg-surface-100 transition-colors",children:"Ã—"})]}),e.jsxs("button",{onClick:()=>{B(!0),_(null),pe(!1),be("")},className:"w-full flex items-center gap-3 p-3 mb-3 bg-gradient-to-r from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 border-2 border-gray-300 rounded-xl transition-all",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Oddiy mijoz"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ko'chadagi oddiy xaridor (qarz berib bo'lmaydi)"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(bs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz ismi yoki telefon raqami...",value:F,onChange:a=>ne(a.target.value),className:"w-full pl-12 pr-4 py-3 bg-surface-50 border border-surface-200 rounded-xl focus:outline-none focus:border-brand-500",autoFocus:!0})]})]}),e.jsx("div",{className:"max-h-80 sm:max-h-96 overflow-auto",children:x.length>0?x.map(a=>e.jsxs("button",{onClick:()=>{_(a),B(!1),pe(!1),be("")},className:"w-full flex items-center gap-3 p-4 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:a.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500",children:[e.jsx("span",{children:a.phone}),a.debt>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 rounded text-xs font-medium",children:[b(a.debt)," so'm qarz"]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"text-sm text-surface-600",children:[b(a.totalPurchases)," so'm"]}),e.jsx("p",{className:"text-xs text-surface-400",children:"jami xarid"})]})]},a._id)):e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-surface-500",children:F?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"})})})]})]}),k&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>M(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"To'lov turlarini tanlang"}),v&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-brand-600",children:v.name.charAt(0)})}),e.jsx("span",{className:"text-sm text-surface-600 truncate",children:v.name})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Jami summa:"}),e.jsxs("p",{className:"text-2xl sm:text-3xl font-bold text-surface-900 mb-3",children:[b(oe)," so'm"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(ns,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Naqd pul:"})]}),e.jsxs("span",{className:"font-semibold",children:[b(Xe.cash)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(Ws,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Click:"})]}),e.jsxs("span",{className:"font-semibold",children:[b(Xe.click)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(Es,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Plastik karta:"})]}),e.jsxs("span",{className:"font-semibold",children:[b(Xe.card)," so'm"]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 flex justify-between",children:[e.jsx("span",{className:"text-surface-600",children:"Jami to'lov:"}),e.jsxs("span",{className:"font-bold text-lg",children:[b(Be)," so'm"]})]}),Be<oe&&e.jsxs("div",{className:"flex justify-between text-warning-600",children:[e.jsx("span",{children:"Qoldiq:"}),e.jsxs("span",{className:"font-bold",children:[b(oe-Be)," so'm"]})]}),Be>oe&&e.jsxs("div",{className:"flex justify-between text-success-600",children:[e.jsx("span",{children:"Qaytim:"}),e.jsxs("span",{className:"font-bold",children:[b(Be-oe)," so'm"]})]})]})]}),Be<oe&&e.jsx("div",{className:`border rounded-lg p-3 mb-4 ${v?"bg-blue-50 border-blue-200":X?"bg-red-50 border-red-200":"bg-warning-50 border-warning-200"}`,children:e.jsx("p",{className:`text-sm ${v?"text-blue-700":X?"text-red-700":"text-warning-700"}`,children:v?e.jsxs(e.Fragment,{children:["â„¹ï¸ ",b(oe-Be)," so'm qarz daftariga qo'shiladi"]}):X?e.jsx(e.Fragment,{children:"âŒ Oddiy mijozga qarz berib bo'lmaydi! To'liq to'lov talab qilinadi."}):e.jsxs(e.Fragment,{children:["âš ï¸ ",b(oe-Be)," so'm qoldiq - mijoz tanlanmagan"]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs",children:[e.jsx(Gs,{className:`w-3 h-3 ${ve.xPrinterFound?"text-green-600":ve.available?"text-yellow-600":"text-red-600"}`}),e.jsx("span",{className:ve.xPrinterFound?"text-green-600":ve.available?"text-yellow-600":"text-red-600",children:ve.xPrinterFound?"X Printer tayyor":ve.available?`Printer mavjud (${ve.printers.length} ta)`:"Printer topilmadi"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>Q(this,null,function*(){var a,$;if(p.length===0){t("Savat bo'sh","Ogohlantirish","warning");return}if(X&&Be<oe){t("Oddiy mijozga qarz berib bo'lmaydi! To'liq to'lov talab qilinadi.","Xatolik","danger");return}try{console.log("Chek chiqarish uchun tovar miqdorlarini kamaytirish boshlandi...");const A=[];for(const G of p)try{console.log(`${G.name} uchun miqdorni kamaytirish: ${G.cartQuantity} ta`),yield K.put(`/products/${G._id}/reduce-quantity`,{quantity:G.cartQuantity}),console.log(`âœ… ${G.name} muvaffaqiyatli yangilandi`),A.push({success:!0,item:G.name})}catch(se){console.error(`âŒ ${G.name} miqdorini kamaytirish xatosi:`,se);const me=(($=(a=se.response)==null?void 0:a.data)==null?void 0:$.message)||"Noma'lum xatolik";A.push({success:!1,item:G.name,error:me})}console.log("Tovar miqdorlarini yangilash tugadi. Natijalar:",A);const O=`HELPER-${Date.now()}`,ee={items:p,total:oe,paymentMethod:"cash",customer:v,receiptNumber:O,cashier:"Kassir",date:new Date};try{console.log("Telegram botga chek ma'lumotlarini yuborish...");const G={items:p.map(me=>({product:me._id,name:me.name,code:me.code,price:me.price,quantity:me.cartQuantity,paymentBreakdown:me.paymentBreakdown||{cash:0,click:0,card:0}})),total:oe,paymentMethod:"cash",customer:(v==null?void 0:v._id)||null,receiptNumber:O,paidAmount:Be,remainingAmount:oe-Be},se=yield K.post("/receipts/kassa",G);console.log("âœ… Chek ma'lumotlari serverga yuborildi:",se.data)}catch(G){console.error("âŒ Telegram xabar yuborishda xatolik:",G)}if(!(yield Aa(ee,()=>{const G=A.filter(Le=>Le.success).length,se=A.filter(Le=>!Le.success).length;let me="Chek muvaffaqiyatli chiqarildi va telegram botga yuborildi";se===0?t(me+", tovar miqdorlari yangilandi!","Muvaffaqiyat","success"):t(`${me}. ${G} ta tovar yangilandi, ${se} ta xatolik`,"Ogohlantirish","warning"),q([]),_(null),B(!1),M(!1),ps()}))){const G=A.filter(Le=>Le.success).length,se=A.filter(Le=>!Le.success).length;let me="Chek faylga yuklandi va telegram botga yuborildi";se===0?t(me+", tovar miqdorlari yangilandi!","Ma'lumot","info"):t(`${me}. ${G} ta tovar yangilandi, ${se} ta xatolik`,"Ogohlantirish","warning"),q([]),_(null),B(!1),M(!1),ps()}}catch(A){console.error("Chek chiqarish xatosi:",A),t("Chek chiqarishda xatolik yuz berdi","Xatolik","danger")}}),className:"w-full flex items-center justify-center gap-2 py-3 sm:py-4 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-semibold transition-colors",children:[e.jsx(Gs,{className:"w-5 h-5"}),"Chek chiqarish (to'lovsiz)"]}),Be<oe&&!v&&e.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-lg p-3",children:e.jsx("p",{className:"text-xs text-warning-700 text-center",children:"ðŸ’¡ Qoldiq summa uchun mijoz tanlashingiz mumkin yoki oddiy mijoz sifatida saqlashingiz mumkin"})}),e.jsx("button",{onClick:()=>M(!1),className:"w-full py-3 text-surface-600 hover:text-surface-900 transition-colors",children:"Bekor qilish"})]})]})]}),is&&Me&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{Ve(!1),es(null)}}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"To'lov turlarini tanlang"}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-1",children:Me.name}),e.jsxs("p",{className:"text-xs text-surface-500 font-mono mb-2",children:["Kod: ",Me.code]}),e.jsxs("p",{className:"text-lg font-bold text-surface-900",children:["Jami: ",b(Me.price*Me.cartQuantity)," so'm"]})]})]}),e.jsx(ml,{item:Me,selectedCustomer:v,isRegularCustomer:X,onSave:U,onCancel:()=>{Ve(!1),es(null)}})]})]}),u&&Pe&&e.jsx(dl,{isOpen:u,onClose:()=>{re(!1),Qe(null)},item:Pe,customer:v,onSave:(a,$)=>{q(A=>A.map(O=>{if(O._id!==Pe._id)return O;const ee=O.paymentBreakdown||{cash:0,click:0,card:0,partner:0};return j(g({},O),{paymentBreakdown:j(g({},ee),{partner:(ee.partner||0)+$})})}))}}),ge&&m&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{Oe(!1),je(null)}}),e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-sm p-4 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-surface-900 mb-2",children:"Foizni o'zgartirish"}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-2.5 mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-surface-700 mb-1",children:m.name}),e.jsxs("p",{className:"text-[10px] text-surface-500 font-mono mb-1.5",children:["Kod: ",m.code]}),e.jsxs("p",{className:"text-xs text-surface-600",children:["Miqdor: ",m.cartQuantity," ta"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Qo'shimcha foiz (%)"}),e.jsx("input",{type:"number",value:ze,onChange:a=>Ie(Number(a.target.value)||0),min:"0",max:"100",step:"0.1",className:"w-full px-3 py-2 border border-surface-200 rounded-lg text-center text-base font-semibold focus:ring-2 focus:ring-brand-500 focus:border-transparent",placeholder:"15"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1.5",children:[5,10,15,20].map(a=>e.jsxs("button",{onClick:()=>Ie(a),className:`py-1.5 px-2 rounded-lg text-xs font-medium transition-colors ${ze===a?"bg-brand-500 text-white":"bg-surface-100 text-surface-700 hover:bg-surface-200"}`,children:[a,"%"]},a))}),m&&e.jsxs("div",{className:"bg-brand-50 rounded-lg p-2.5",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs mb-1",children:[e.jsx("span",{className:"text-surface-600",children:"Yangi narx (1 ta):"}),e.jsxs("span",{className:"font-semibold text-brand-600",children:[b(Math.round((m.costPrice||m.price/1.15)*(1+ze/100)))," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-surface-600",children:"Jami summa:"}),e.jsxs("span",{className:"font-bold text-brand-700",children:[b(Math.round((m.costPrice||m.price/1.15)*(1+ze/100))*m.cartQuantity)," so'm"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{Oe(!1),je(null)},className:"flex-1 py-2 px-3 bg-surface-100 text-surface-700 rounded-lg font-medium hover:bg-surface-200 transition-colors text-sm",children:"Bekor qilish"}),e.jsx("button",{onClick:Cs,className:"flex-1 py-2 px-3 bg-brand-500 text-white rounded-lg font-medium hover:bg-brand-600 transition-colors text-sm",children:"Saqlash"})]})]})]}),$e&&N&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>Ce(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl relative z-10 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-surface-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold text-surface-900",children:"QR Kod"}),e.jsx("button",{onClick:()=>Ce(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:bg-surface-100 transition-colors",children:"Ã—"})]}),e.jsxs("div",{className:"p-6 flex flex-col items-center",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border-2 border-surface-200 mb-4",children:ue?e.jsx("img",{src:ue,alt:"QR Code",className:"w-48 h-48",style:{imageRendering:"pixelated"}}):e.jsx("div",{className:"w-48 h-48 bg-surface-100 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-brand-500 border-t-transparent rounded-full animate-spin"})})}),e.jsxs("div",{className:"text-center mb-4 w-full",children:[e.jsx("p",{className:"font-bold text-surface-900 text-lg mb-1",children:N.name}),e.jsxs("p",{className:"text-sm text-surface-500 mb-2",children:["Kod: ",N.code]}),e.jsxs("p",{className:"text-2xl font-bold text-brand-600",children:[b(N.price)," ",e.jsx("span",{className:"text-sm",children:"so'm"})]})]}),e.jsxs("button",{onClick:ds,disabled:!ue,className:"w-full px-6 py-3 bg-brand-600 text-white rounded-xl font-semibold hover:bg-brand-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(Gs,{className:"w-5 h-5"}),"Chop etish"]})]})]})]}),Re&&L&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{_e(!1),o(null),Se("")}}),e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-sm p-4 shadow-2xl relative z-10",children:[e.jsx("h3",{className:"text-base font-bold text-surface-900 mb-3",children:"Mahsulot qadini o'zgartirish"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-surface-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-surface-600 mb-1",children:"Mahsulot:"}),e.jsx("p",{className:"font-semibold text-sm text-surface-900",children:L.name}),e.jsxs("p",{className:"text-[10px] text-surface-500 mt-1",children:["Kod: ",L.code]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Hozirgi qad:"}),e.jsxs("p",{className:"text-xl font-bold text-blue-700",children:[L.quantity," ta"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Yangi qad:"}),e.jsx("input",{type:"number",value:Y,onChange:a=>Se(a.target.value),className:"w-full px-3 py-2 text-base font-semibold border-2 border-brand-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/10",placeholder:"Yangi qadni kiriting",min:"0",autoFocus:!0})]}),e.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-lg p-2",children:e.jsx("p",{className:"text-[10px] text-warning-700",children:"âš ï¸ Diqqat: Mahsulot qadi o'zgartirilganda, agar savatchada bu mahsulot bo'lsa va yangi qad savatchadagi miqdordan kam bo'lsa, savatchadagi miqdor ham kamaytiriladi."})})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{_e(!1),o(null),Se("")},className:"flex-1 py-2 px-3 bg-surface-100 text-surface-700 rounded-lg font-medium hover:bg-surface-200 transition-colors text-sm",children:"Bekor qilish"}),e.jsx("button",{onClick:Bs,className:"flex-1 py-2 px-3 bg-brand-500 text-white rounded-lg font-medium hover:bg-brand-600 transition-colors text-sm",children:"Saqlash"})]})]})]})]})}function ul(){const[t,n]=s.useState([]),[r,h]=s.useState(!0),[l,w]=s.useState(null),[S,p]=s.useState(!1),{showAlert:q,AlertComponent:z}=ws();s.useEffect(()=>{y()},[]);const y=()=>Q(this,null,function*(){var f,E;try{h(!0),console.log("Fetching receipts from /receipts/kassa...");const c=yield K.get("/receipts/kassa");console.log("Receipts response:",c.data),console.log("Total receipts:",c.data.length),n(c.data)}catch(c){console.error("Cheklar yuklashda xatolik:",c),console.error("Error response:",c.response),q(((E=(f=c.response)==null?void 0:f.data)==null?void 0:E.message)||"Cheklar yuklashda xatolik","Xatolik","danger")}finally{h(!1)}}),k=f=>{const E=window.open("","_blank","width=600,height=800");if(!E){q("Popup bloklangan. Iltimos, popup ga ruxsat bering.","Ogohlantirish","warning");return}const c=f.items.map((R,P)=>`
      <tr>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: center; font-size: 14px;">${P+1}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; font-size: 14px;">${R.product.name}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: center; font-size: 14px;">${R.quantity}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: right; font-size: 14px;">${b(R.price)}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: right; font-weight: bold; font-size: 14px;">${b(R.price*R.quantity)}</td>
      </tr>
    `).join("");E.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Chek #${f.receiptNumber}</title>
        <style>
          @page { size: 80mm auto; margin: 0; }
          @media print {
            body { width: 80mm; margin: 0; }
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body { 
            font-family: 'Courier New', monospace;
            width: 80mm;
            padding: 10mm 5mm;
            background: white;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
          }
          .header { 
            text-align: center; 
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px dashed #000;
          }
          .header h1 { 
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
          }
          .header .subtitle { 
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
          }
          .header .receipt-number { 
            font-size: 14px;
            font-weight: bold;
            margin-top: 8px;
          }
          table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 15px 0;
          }
          th { 
            padding: 8px 4px;
            text-align: left; 
            border-bottom: 2px solid #000;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
          }
          th.center { text-align: center; }
          th.right { text-align: right; }
          .total-section { 
            margin-top: 15px;
            padding-top: 10px;
            border-top: 2px dashed #000;
          }
          .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
          }
          .total-label {
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
          }
          .total-amount {
            font-size: 20px;
            font-weight: bold;
          }
          .footer { 
            margin-top: 20px;
            padding-top: 15px;
            text-align: center;
            border-top: 2px dashed #000;
          }
          .footer p {
            font-size: 11px;
            color: #666;
            margin: 3px 0;
          }
          .thank-you {
            font-size: 13px;
            font-weight: bold;
            margin-top: 10px;
          }
        </style>
      </head>
      <body>
        <div class="header">
          <!-- Logo -->
          <div style="margin-bottom: 8px;">
            <img src="/o5sk1awh.png" alt="Logo" style="width: 40px; height: 40px; display: block; margin: 0 auto; border-radius: 6px;" />
          </div>
          <h1>SARDOR FURNITURA</h1>
          <div class="subtitle">Mebel furniturasi</div>
          <div class="receipt-number">Chek #${f.receiptNumber}</div>
        </div>

        <table>
          <thead>
            <tr>
              <th style="width: 25px;" class="center">â„–</th>
              <th>Mahsulot</th>
              <th style="width: 35px;" class="center">Soni</th>
              <th style="width: 60px;" class="right">Narxi</th>
              <th style="width: 70px;" class="right">Jami</th>
            </tr>
          </thead>
          <tbody>
            ${c}
          </tbody>
        </table>

        <div class="total-section">
          <div class="total-row">
            <span class="total-label">JAMI:</span>
            <span class="total-amount">${b(f.totalAmount)} so'm</span>
          </div>
        </div>

        <div class="footer">
          <p class="thank-you">Xaridingiz uchun rahmat!</p>
          <p>Sardor Furnitura - Sifatli mebel furniturasi</p>
        </div>
      </body>
      </html>
    `),E.document.close(),E.print()},M=f=>{w(f),p(!0)};return r?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-brand-500 border-t-transparent"})}):e.jsxs("div",{className:"min-h-screen bg-surface-50 p-2 sm:p-4 pb-20",children:[z,e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-3 sm:p-4 mb-3 sm:mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(Hs,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-base sm:text-xl font-bold text-surface-900 truncate",children:"Cheklar"}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Hodimlar cheklari"})]})]}),e.jsxs("button",{onClick:y,className:"btn-secondary flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-2 text-sm flex-shrink-0",children:[e.jsx(As,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangilash"})]})]})}),t.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-8 sm:p-12 text-center",children:[e.jsx(Hs,{className:"w-12 h-12 sm:w-16 sm:h-16 text-surface-300 mx-auto mb-3 sm:mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-surface-900 mb-2",children:"Cheklar yo'q"}),e.jsx("p",{className:"text-sm sm:text-base text-surface-500",children:"Hali hech qanday chek yaratilmagan"})]}):e.jsx("div",{className:"max-h-[calc(100vh-180px)] overflow-y-auto",children:e.jsx("div",{className:"grid gap-3 sm:gap-4 pr-1",children:t.map(f=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-3 sm:p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-brand-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Hs,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"font-bold text-sm sm:text-base text-surface-900 truncate",children:["Chek #",f.receiptNumber]}),e.jsx("p",{className:"text-xs text-surface-500",children:new Date(f.createdAt).toLocaleString("uz-UZ",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(ls,{className:"w-3 h-3 sm:w-4 sm:h-4 text-surface-400 flex-shrink-0"}),e.jsx("span",{className:"text-surface-600",children:"Sotuvchi:"}),e.jsx("span",{className:"font-medium text-surface-900 truncate",children:f.createdBy.name})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(Fe,{className:"w-3 h-3 sm:w-4 sm:h-4 text-surface-400 flex-shrink-0"}),e.jsx("span",{className:"text-surface-600",children:"Mahsulotlar:"}),e.jsxs("span",{className:"font-medium text-surface-900",children:[f.items.length," ta"]})]}),f.customer&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(ls,{className:"w-3 h-3 sm:w-4 sm:h-4 text-surface-400 flex-shrink-0"}),e.jsx("span",{className:"text-surface-600",children:"Mijoz:"}),e.jsx("span",{className:"font-medium text-surface-900 truncate",children:f.customer.name})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Tel:"}),e.jsx("span",{className:"font-medium text-surface-900",children:f.customer.phone})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 sm:p-3 bg-brand-50 rounded-lg mb-3",children:[e.jsx(ns,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600 flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm text-surface-600",children:"Jami:"}),e.jsxs("span",{className:"text-base sm:text-lg font-bold text-brand-700",children:[b(f.totalAmount)," so'm"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>M(f),className:"flex-1 flex items-center justify-center gap-1 sm:gap-2 p-2 bg-blue-50 hover:bg-blue-100 text-blue-600 rounded-lg transition-colors text-xs sm:text-sm",children:[e.jsx(Ds,{className:"w-4 h-4"}),e.jsx("span",{children:"Ko'rish"})]}),e.jsxs("button",{onClick:()=>k(f),className:"flex-1 flex items-center justify-center gap-1 sm:gap-2 p-2 bg-green-50 hover:bg-green-100 text-green-600 rounded-lg transition-colors text-xs sm:text-sm",children:[e.jsx(Gs,{className:"w-4 h-4"}),e.jsx("span",{children:"Print"})]})]})]},f._id))})}),S&&l&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-2 sm:p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-white border-b border-surface-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-base sm:text-xl font-bold text-surface-900",children:["Chek #",l.receiptNumber]}),e.jsx("button",{onClick:()=>p(!1),className:"p-2 hover:bg-surface-100 rounded-lg transition-colors",children:"âœ•"})]})}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3 mb-4 sm:mb-6",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-surface-900 mb-2 sm:mb-3",children:"Mahsulotlar:"}),l.items.map((f,E)=>e.jsxs("div",{className:"flex items-start justify-between p-2 sm:p-3 bg-surface-50 rounded-lg gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm sm:text-base text-surface-900 break-words",children:f.product.name}),e.jsxs("p",{className:"text-xs sm:text-sm text-surface-500",children:["Kod: ",f.product.code]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"font-semibold text-xs sm:text-sm text-surface-900 whitespace-nowrap",children:[f.quantity," x ",b(f.price)]}),e.jsxs("p",{className:"text-xs sm:text-sm text-brand-600 font-bold",children:[b(f.quantity*f.price)," so'm"]})]})]},E))]}),e.jsx("div",{className:"border-t border-surface-200 pt-3 sm:pt-4",children:e.jsxs("div",{className:"flex items-center justify-between text-base sm:text-lg font-bold",children:[e.jsx("span",{className:"text-surface-900",children:"JAMI:"}),e.jsxs("span",{className:"text-brand-700",children:[b(l.totalAmount)," so'm"]})]})})]})]})})]})}function hl(){const{showAlert:t,AlertComponent:n}=ws(),r=nt(),[h,l]=s.useState([]),[w,S]=s.useState(""),[p,q]=s.useState([]),[z,y]=s.useState(!1),[k,M]=s.useState(!1),[f,E]=s.useState("");s.useEffect(()=>{R(!0);const P=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=P}},[]),s.useEffect(()=>{R(!0)},[r.pathname]);const c=()=>Q(this,null,function*(){y(!0);try{yield R(!1),t("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(P){console.error("Refresh xatosi:",P),t("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{y(!1)}});s.useEffect(()=>{if(w.trim()==="")q(h);else{const P=h.filter(C=>C.name.toLowerCase().includes(w.toLowerCase())||C.phone.includes(w));q(P)}},[h,w]);const R=(P=!0)=>Q(this,null,function*(){try{P&&M(!0),E("");const v=(yield K.get("/customers/kassa")).data.filter(_=>{const X=_.name&&_.name.trim().length>0,B=_.phone&&_.phone.trim().length>0;return X&&B}).map(_=>j(g({},_),{name:_.name.trim(),phone:_.phone.trim(),totalPurchases:Number(_.totalPurchases)||0,debt:Number(_.debt)||0}));l(v)}catch(C){console.error("Error fetching customers:",C),E("Mijozlarni yuklashda xatolik yuz berdi")}finally{P&&M(!1)}});return e.jsxs("div",{className:"p-6",children:[n,e.jsxs("div",{className:"bg-white rounded-xl border border-surface-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(bs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz qidirish...",value:w,onChange:P=>S(P.target.value),className:"w-full pl-10 pr-4 py-2 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500"})]}),e.jsxs("button",{onClick:c,disabled:z,className:"flex items-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50",children:[e.jsx(As,{className:`w-4 h-4 ${z?"animate-spin":""}`}),z?"Yangilanmoqda...":"Yangilash"]})]})}),e.jsx("div",{className:"divide-y divide-surface-100",children:k?e.jsx("div",{className:"p-8 text-center text-surface-500",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(As,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Mijozlar yuklanmoqda..."})]})}):f?e.jsxs("div",{className:"p-8 text-center text-danger-500",children:[e.jsx("p",{children:f}),e.jsx("button",{onClick:c,className:"mt-2 px-4 py-2 bg-danger-100 text-danger-700 rounded-lg hover:bg-danger-200 transition-colors",children:"Qayta urinish"})]}):p.length===0?e.jsx("div",{className:"p-8 text-center text-surface-500",children:w?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"}):p.map(P=>e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-surface-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600",children:P.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:P.name}),e.jsx("p",{className:"text-sm text-surface-500",children:P.phone}),P.email&&e.jsx("p",{className:"text-xs text-surface-400",children:P.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-surface-500",children:"Jami xaridlar"}),e.jsx("p",{className:"font-semibold text-surface-900",children:b(P.totalPurchases||0)}),P.debt>0&&e.jsxs("p",{className:"text-xs text-danger-600 font-medium",children:["Qarz: ",b(P.debt)]})]})]},P._id))})]})]})}function pl(){var L,o,Y,Se,$e,Ce;const{showAlert:t,AlertComponent:n}=ws(),r=nt(),[h,l]=s.useState([]),[w,S]=s.useState([]),[p,q]=s.useState([]),[z,y]=s.useState(!1),[k,M]=s.useState(""),[f,E]=s.useState(""),[c,R]=s.useState(""),[P,C]=s.useState(null),[v,_]=s.useState([]),[X,B]=s.useState(!1),[he,pe]=s.useState(!1),[F,be]=s.useState({paidAmount:"",dueDate:"",description:""}),[le,Te]=s.useState(!1),[W,te]=s.useState(!1),[D,xe]=s.useState(null),[I,fe]=s.useState(!1),[ve,H]=s.useState({name:"",phone:"",email:"",address:""});s.useEffect(()=>{ke(),ae(),Ke();const N=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=N}},[]),s.useEffect(()=>{ke(),ae(),Ke()},[r.pathname]);const T=()=>Q(this,null,function*(){var N,J;if(!ve.name.trim()||!ve.phone.trim()){t("Mijoz ismi va telefon raqami majburiy","Xatolik","warning");return}try{const ue=yield K.post("/customers/kassa",{name:ve.name.trim(),phone:ve.phone.trim(),email:ve.email.trim(),address:ve.address.trim()});ue.data.success&&(t("Mijoz muvaffaqiyatli qo'shildi","Muvaffaqiyat","success"),ae(),C(ue.data.customer),H({name:"",phone:"",email:"",address:""}),fe(!1))}catch(ue){console.error("Error creating customer:",ue);const we=((J=(N=ue.response)==null?void 0:N.data)==null?void 0:J.message)||"Mijoz qo'shishda xatolik yuz berdi";t(we,"Xatolik","danger")}}),ye=()=>{H({name:"",phone:"",email:"",address:""}),fe(!1)},de=()=>Q(this,null,function*(){pe(!0);try{yield Promise.all([ke(),ae(),Ke()]),t("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(N){console.error("Refresh xatosi:",N),t("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{pe(!1)}}),ke=()=>Q(this,null,function*(){try{const N=yield K.get("/debts/kassa");l(N.data)}catch(N){console.error("Error fetching debts:",N)}}),ae=()=>Q(this,null,function*(){try{const N=yield K.get("/customers/kassa");S(N.data)}catch(N){console.error("Error fetching customers:",N)}}),Ke=()=>Q(this,null,function*(){try{const N=yield K.get("/products/kassa"),J=N.data.data||N.data;q(Array.isArray(J)?J:[])}catch(N){console.error("Error fetching products:",N)}}),is=N=>{C(N);const J=h.find(ue=>{var we;return((we=ue.customer)==null?void 0:we._id)===N._id&&ue.status==="approved"});J&&t(`${N.name} mijozining ${b(J.amount-J.paidAmount)} so'm tasdiqlangan qarzi mavjud. Yangi qarz to'g'ridan-to'g'ri mavjud qarzga qo'shiladi.`,"Ma'lumot","info")},Ve=()=>{y(!1),C(null),_([]),E(""),R(""),B(!1),fe(!1),be({paidAmount:"",dueDate:"",description:""}),H({name:"",phone:"",email:"",address:""})},Me=N=>{const J=v.find(ue=>ue.product._id===N._id);_(J?ue=>ue.map(we=>we.product._id===N._id?j(g({},we),{quantity:we.quantity+1}):we):ue=>[...ue,{product:N,quantity:1,price:N.price}]),R(""),B(!1)},es=(N,J)=>{if(J<=0){_(ue=>ue.filter(we=>we.product._id!==N));return}_(ue=>ue.map(we=>we.product._id===N?j(g({},we),{quantity:J}):we))},u=N=>{_(J=>J.filter(ue=>ue.product._id!==N))},re=N=>{xe(N),Te(!0)},Pe=()=>Q(this,null,function*(){var N,J;if(D)try{yield K.delete(`/debts/kassa/${D._id}`),t("Qarz muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),te(!1),xe(null),ke()}catch(ue){console.error("Error deleting debt:",ue);const we=((J=(N=ue.response)==null?void 0:N.data)==null?void 0:J.message)||"Qarzni o'chirishda xatolik yuz berdi";t(we,"Xatolik","danger")}}),Qe=()=>{Te(!1),xe(null)},ge=()=>{te(!1),xe(null)},Oe=()=>Q(this,null,function*(){if(!P||v.length===0||!F.dueDate){t("Barcha majburiy maydonlarni to'ldiring","Xatolik","warning");return}try{const N=v.reduce((Xe,hs)=>Xe+hs.price*hs.quantity,0),J=parseFloat(We(F.paidAmount))||0;if(J>N){t(`To'langan summa (${b(J)} so'm) jami summadan (${b(N)} so'm) ko'p bo'lishi mumkin emas!`,"Xatolik","danger");return}const ue={customer:P._id,amount:N,paidAmount:J,dueDate:F.dueDate,description:F.description,items:v.map(Xe=>({product:Xe.product._id,quantity:Xe.quantity,price:Xe.price}))},Je=(yield K.post("/debts/kassa",ue)).status===200?"Qarz mavjud qarzga muvaffaqiyatli qo'shildi! Bitta qarz sifatida ko'rinadi.":"Yangi qarz yaratildi va admin tasdiqlashini kutmoqda.";t(Je,"Muvaffaqiyat","success"),Ve(),ke()}catch(N){console.error("Error creating debt:",N),t("Qarz qo'shishda xatolik yuz berdi","Xatolik","danger")}}),m=w.filter(N=>f===""||N.name.toLowerCase().includes(f.toLowerCase())||N.phone.includes(f)),je=p.filter(N=>{if(!c.trim())return!1;const J=c.toLowerCase().trim(),ue=N.name.toLowerCase(),we=N.code.toLowerCase();return!!(we===J||we.startsWith(J)||we.includes(J)||ue.includes(J))}).sort((N,J)=>{const ue=c.toLowerCase().trim(),we=N.code.toLowerCase(),Be=J.code.toLowerCase(),Je=N.name.toLowerCase(),Xe=J.name.toLowerCase();return we===ue&&Be!==ue?-1:Be===ue&&we!==ue?1:we.startsWith(ue)&&!Be.startsWith(ue)?-1:Be.startsWith(ue)&&!we.startsWith(ue)?1:Je.startsWith(ue)&&!Xe.startsWith(ue)?-1:Xe.startsWith(ue)&&!Je.startsWith(ue)?1:N.name.localeCompare(J.name)}),ze=v.reduce((N,J)=>N+J.price*J.quantity,0),Ie=parseFloat(We(F.paidAmount))||0,Re=ze-Ie,_e=h.filter(N=>{var Be,Je,Xe;if(!k.trim())return!0;const J=k.toLowerCase(),ue=((Je=(Be=N.customer)==null?void 0:Be.name)==null?void 0:Je.toLowerCase())||"",we=((Xe=N.customer)==null?void 0:Xe.phone)||"";return ue.includes(J)||we.includes(J)});return e.jsxs("div",{className:"p-3 sm:p-6 h-full flex flex-col overflow-hidden",children:[n,e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-6 flex-shrink-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>y(!0),className:"flex items-center justify-center gap-2 px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors w-full sm:w-auto",children:[e.jsx(ns,{className:"w-4 h-4"}),"Yangi qarz"]}),e.jsxs("button",{onClick:de,disabled:he,className:"flex items-center justify-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50 w-full sm:w-auto",children:[e.jsx(As,{className:`w-4 h-4 ${he?"animate-spin":""}`}),he?"Yangilanmoqda...":"Yangilash"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 mb-6 flex-shrink-0",children:[e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl border border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx(ns,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Jami qarz"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-surface-900 truncate",children:b(h.reduce((N,J)=>N+(J.amount-J.paidAmount),0))})]})]})}),e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl border border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-success-100 rounded-lg flex items-center justify-center",children:e.jsx(ia,{className:"w-4 h-4 sm:w-5 sm:h-5 text-success-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Jami qarzlar soni"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-surface-900",children:h.length})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-surface-200 overflow-hidden flex flex-col h-[calc(100vh-400px)] min-h-[400px]",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-surface-200 flex-shrink-0",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(bs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz qidirish...",value:k,onChange:N=>M(N.target.value),className:"w-full pl-9 sm:pl-10 pr-4 py-2 sm:py-3 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:_e.length===0?e.jsxs("div",{className:"p-8 text-center text-surface-500",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ns,{className:"w-8 h-8 text-surface-400"})}),e.jsx("p",{className:"font-medium text-lg mb-2",children:k?"Qarz topilmadi":"Qarzlar ro'yxati bo'sh"}),e.jsx("p",{className:"text-sm",children:k?`"${k}" bo'yicha hech qanday qarz topilmadi`:"Hozircha hech qanday qarz qo'shilmagan"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block sm:hidden",children:_e.map(N=>{var J,ue,we;return e.jsxs("div",{className:"p-4 border-b border-surface-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:(J=N.customer)==null?void 0:J.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:(ue=N.customer)==null?void 0:ue.name}),e.jsx("p",{className:"text-sm text-surface-500",children:(we=N.customer)==null?void 0:we.phone})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Qarz summasi"}),e.jsx("p",{className:"font-medium text-surface-900",children:b(N.amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Qoldiq"}),e.jsx("p",{className:"font-medium text-danger-600",children:b(N.amount-N.paidAmount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Muddat"}),e.jsx("p",{className:"text-surface-900",children:new Date(N.dueDate).toLocaleDateString()})]}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx("button",{onClick:()=>re(N),className:"p-2 text-brand-600 hover:text-brand-700 hover:bg-brand-50 rounded-lg transition-colors",title:"Qarz ma'lumotlarini ko'rish",children:e.jsx(Ds,{className:"w-4 h-4"})})})]})]},N._id)})}),e.jsx("div",{className:"hidden sm:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surface-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Mijoz"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Qarz"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Qoldiq"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Muddat"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Amallar"})]})}),e.jsx("tbody",{className:"divide-y divide-surface-100",children:_e.map(N=>{var J,ue,we;return e.jsxs("tr",{className:"hover:bg-surface-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:(J=N.customer)==null?void 0:J.name.charAt(0)})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:(ue=N.customer)==null?void 0:ue.name}),e.jsx("p",{className:"text-sm text-surface-500 truncate",children:(we=N.customer)==null?void 0:we.phone})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-surface-900",children:b(N.amount)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-danger-600",children:b(N.amount-N.paidAmount)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-surface-500",children:new Date(N.dueDate).toLocaleDateString()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>re(N),className:"p-2 text-brand-600 hover:text-brand-700 hover:bg-brand-50 rounded-lg transition-colors",title:"Qarz ma'lumotlarini ko'rish",children:e.jsx(Ds,{className:"w-4 h-4"})})})})]},N._id)})})]})})]})})]}),z&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>Ve()}),e.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl w-full max-w-6xl shadow-2xl relative z-10 max-h-[95vh] sm:max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 lg:p-6 border-b border-surface-200 bg-gradient-to-r from-brand-50 to-blue-50 rounded-t-2xl sm:rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-lg flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(ns,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold text-surface-900 truncate",children:P?`${P.name} uchun qarz qo'shish`:"Mijoz tanlash"}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-600 truncate",children:P?"Mahsulotlarni tanlang va to'lov ma'lumotlarini kiriting":"Qarz berish uchun mijozni tanlang"})]})]}),e.jsx("button",{onClick:()=>Ve(),className:"w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors flex-shrink-0",children:e.jsx(Ne,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),P?e.jsxs("div",{className:"flex-1 p-3 sm:p-4 lg:p-6 overflow-y-auto min-h-0",children:[e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"bg-surface-50 p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600 text-sm sm:text-lg",children:P.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:P.name}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-500",children:P.phone})]})]})}),e.jsxs("div",{className:"bg-white border border-surface-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Mahsulotlar"}),e.jsxs("button",{onClick:()=>B(!0),className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 lg:px-4 py-1.5 sm:py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors shadow-sm text-xs sm:text-sm",children:[e.jsx(ms,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Mahsulot qidirish"}),e.jsx("span",{className:"sm:hidden",children:"Qo'shish"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(bs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Tez qidirish: mahsulot nomi yoki kodi...",value:c,onChange:N=>R(N.target.value),onFocus:()=>B(!0),onKeyDown:N=>{N.key==="Enter"&&je.length>0&&Me(je[0]),N.key==="Escape"&&R("")},className:"w-full pl-10 pr-10 py-2 text-xs sm:text-sm bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"}),c&&e.jsx("button",{onClick:()=>R(""),className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 flex items-center justify-center text-surface-400 hover:text-surface-600 rounded-full hover:bg-surface-100",children:e.jsx(Ne,{className:"w-3 h-3"})})]}),c&&je.length>0&&!X&&e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-surface-500",children:[e.jsxs("span",{children:[je.length," ta mahsulot topildi"]}),e.jsx("span",{className:"text-brand-600",children:"Enter - birinchisini tanlash"})]})]}),c&&je.length>0&&!X&&e.jsxs("div",{className:"mb-4 max-h-40 overflow-y-auto border border-surface-200 rounded-lg",children:[je.slice(0,5).map(N=>e.jsxs("button",{onClick:()=>Me(N),className:"w-full flex items-center gap-3 p-2 hover:bg-surface-50 transition-colors text-left border-b border-surface-100 last:border-b-0",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(Fe,{className:"w-4 h-4 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 text-sm truncate",children:N.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-surface-500 bg-surface-100 px-2 py-0.5 rounded",children:N.code}),e.jsxs("span",{className:"text-xs text-surface-500",children:["Omborda: ",N.quantity," ta"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold text-brand-600 text-sm",children:b(N.price)})})]},N._id)),je.length>5&&e.jsxs("button",{onClick:()=>B(!0),className:"w-full p-2 text-center text-sm text-brand-600 hover:bg-brand-50 transition-colors",children:["Yana ",je.length-5," ta ko'rish..."]})]}),e.jsx("div",{className:"space-y-2",children:v.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center text-surface-500 border-2 border-dashed border-surface-200 rounded-lg",children:[e.jsx(Fe,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Mahsulot tanlanmagan"})]}):v.map(N=>e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 bg-surface-50 rounded-lg border border-surface-200",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 text-xs sm:text-sm truncate",children:N.product.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",N.product.code]})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>es(N.product._id,N.quantity-1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded bg-surface-200 hover:bg-surface-300 transition-colors",children:e.jsx(ft,{className:"w-3 h-3"})}),e.jsx("span",{className:"w-8 sm:w-10 text-center font-medium bg-white px-1 sm:px-2 py-1 rounded border text-xs sm:text-sm",children:N.quantity}),e.jsx("button",{onClick:()=>es(N.product._id,N.quantity+1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded bg-surface-200 hover:bg-surface-300 transition-colors",children:e.jsx(ms,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"text-right min-w-0",children:[e.jsxs("p",{className:"font-bold text-surface-900 text-xs sm:text-sm",children:[b(N.price*N.quantity)," so'm"]}),e.jsxs("p",{className:"text-xs text-surface-500",children:[b(N.price)," Ã— ",N.quantity]})]}),e.jsx("button",{onClick:()=>u(N.product._id),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded text-danger-500 hover:bg-danger-50 transition-colors flex-shrink-0",children:e.jsx(Ne,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]},N.product._id))})]}),e.jsxs("div",{className:"bg-surface-50 p-3 sm:p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"Jami summa:"}),e.jsxs("span",{className:"font-semibold text-surface-900 text-xs sm:text-sm",children:[b(ze)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"To'langan:"}),e.jsxs("span",{className:"font-semibold text-success-600 text-xs sm:text-sm",children:[b(Ie)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between border-t border-surface-200 pt-2",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"Qarz qoldi:"}),e.jsxs("span",{className:`font-bold text-sm sm:text-base ${Re<0,"text-danger-600"}`,children:[Re<0?"-":"",b(Math.abs(Re))," so'm"]})]}),Re<0&&e.jsx("div",{className:"bg-danger-50 border border-danger-200 rounded-lg p-2 mt-2",children:e.jsx("p",{className:"text-danger-700 text-xs font-medium",children:"âš ï¸ To'langan summa jami summadan ko'p! Qarz minus bo'ldi."})})]}),e.jsxs("div",{className:"bg-white border border-surface-200 rounded-xl p-4 space-y-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"To'lov ma'lumotlari"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-surface-700 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(ns,{className:"w-3 h-3 sm:w-4 sm:h-4 text-success-600"}),"To'langan summa"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"0",value:F.paidAmount,onChange:N=>{const J=rs(N.target.value);if((parseFloat(We(J))||0)>ze&&ze>0){t(`To'langan summa jami summadan (${b(ze)} so'm) ko'p bo'lishi mumkin emas!`,"Ogohlantirish","warning");return}be(we=>j(g({},we),{paidAmount:J}))},className:`w-full pl-3 sm:pl-4 pr-12 sm:pr-16 py-3 sm:py-4 text-base sm:text-lg font-semibold border-2 rounded-xl focus:outline-none focus:ring-4 transition-all ${Re<0?"border-danger-500 bg-gradient-to-r from-danger-50 to-red-50 focus:border-danger-500 focus:ring-danger-500/10":Ie<ze&&Ie>0?"border-orange-400 bg-gradient-to-r from-yellow-100 to-orange-100 focus:border-orange-400 focus:ring-orange-400/10":"border-surface-200 bg-gradient-to-r from-white to-success-50 focus:border-success-500 focus:ring-success-500/10"}`}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 sm:pr-4 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-surface-500 font-medium text-xs sm:text-sm",children:"so'm"})})]}),F.paidAmount&&e.jsxs("div",{className:`mt-2 text-xs sm:text-sm font-medium ${Re<0?"text-danger-600":"text-success-600"}`,children:[F.paidAmount," so'm",Re<0&&e.jsx("span",{className:"block text-danger-600 font-bold mt-1",children:"âš ï¸ Jami summadan ko'p!"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-surface-700 mb-2",children:[e.jsx(Xs,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"Qaytarish muddati *"]}),e.jsx("input",{type:"date",value:F.dueDate,onChange:N=>be(J=>j(g({},J),{dueDate:N.target.value})),className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"})]})]})]}),X&&e.jsxs("div",{className:"fixed inset-0 z-60 flex items-center justify-center p-2 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>B(!1)}),e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-4xl shadow-2xl relative z-10 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-3 sm:p-4 border-b border-surface-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h5",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Mahsulot tanlash"}),e.jsx("button",{onClick:()=>B(!1),className:"text-surface-400 hover:text-surface-600",children:e.jsx(Ne,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(bs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mahsulot nomi yoki kodi bilan qidiring...",value:c,onChange:N=>R(N.target.value),className:"w-full pl-10 pr-4 py-2 sm:py-3 text-xs sm:text-sm bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",autoFocus:!0})]}),c&&e.jsxs("div",{className:"mt-2 text-xs text-surface-500",children:['"',c,`" bo'yicha `,je.length," ta natija topildi"]})]}),e.jsx("div",{className:"max-h-80 sm:max-h-96 overflow-y-auto p-3 sm:p-4",children:je.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center text-surface-500",children:[e.jsx(Fe,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium mb-1 text-sm",children:c?"Mahsulot topilmadi":"Qidirish uchun mahsulot nomini yoki kodini kiriting"}),c&&e.jsxs("p",{className:"text-xs",children:['"',c,`" bo'yicha hech narsa topilmadi`]})]}):e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[je.slice(0,100).map(N=>e.jsxs("button",{onClick:()=>Me(N),className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 hover:bg-surface-50 transition-colors text-left border border-surface-200 rounded-lg group",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-lg flex items-center justify-center group-hover:bg-brand-200 transition-colors flex-shrink-0",children:e.jsx(Fe,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate text-xs sm:text-sm",children:N.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-surface-500 bg-surface-100 px-2 py-1 rounded",children:["Kod: ",N.code]}),e.jsxs("span",{className:"text-xs text-surface-500",children:["Omborda: ",N.quantity," ta"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-brand-600 text-sm sm:text-base",children:[b(N.price)," so'm"]}),e.jsx("p",{className:"text-xs text-surface-500",children:"Narxi"})]})]},N._id)),je.length>100&&e.jsx("div",{className:"p-3 text-center text-surface-500 text-xs border-t border-surface-200",children:"Faqat birinchi 100 ta natija ko'rsatildi. Aniqroq qidiring."})]})}),e.jsx("div",{className:"p-3 sm:p-4 border-t border-surface-200 bg-surface-50",children:e.jsx("div",{className:"flex items-center gap-2 text-xs text-surface-500",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(bs,{className:"w-3 h-3"}),e.jsx("span",{children:"Maslahat: Mahsulot nomini yoki kodini to'liq kiriting"})]})})})]})]})]}):e.jsxs("div",{className:"flex-1 p-3 sm:p-4 lg:p-6 overflow-y-auto min-h-0",children:[e.jsx("div",{className:"relative mb-3 sm:mb-4 lg:mb-6",children:e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(bs,{className:"w-4 h-4 sm:w-5 sm:h-5 text-surface-400"})}),e.jsx("input",{type:"text",placeholder:"Mijoz ismi yoki telefon raqami bilan qidiring...",value:f,onChange:N=>E(N.target.value),className:"w-full pl-9 sm:pl-10 pr-4 py-2 sm:py-3 text-sm bg-white border-2 border-surface-200 rounded-xl focus:outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 transition-all"}),f&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("button",{onClick:()=>E(""),className:"w-5 h-5 flex items-center justify-center text-surface-400 hover:text-surface-600 rounded-full hover:bg-surface-100",children:e.jsx(Ne,{className:"w-3 h-3"})})})]}),e.jsxs("button",{onClick:()=>fe(!0),className:"flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-3 bg-success-500 text-white rounded-xl hover:bg-success-600 transition-colors flex-shrink-0",title:"Yangi mijoz qo'shish",children:[e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi mijoz"})]})]})}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:m.length===0?e.jsxs("div",{className:"p-6 sm:p-8 lg:p-12 text-center text-surface-500",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-surface-100 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4",children:e.jsx(bs,{className:"w-6 h-6 sm:w-8 sm:h-8 text-surface-400"})}),e.jsx("p",{className:"font-medium text-sm sm:text-base lg:text-lg mb-2",children:f?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"}),e.jsx("p",{className:"text-xs sm:text-sm",children:f?`"${f}" bo'yicha hech kim topilmadi`:"Hozircha mijozlar qo'shilmagan"})]}):m.map(N=>{const J=h.find(ue=>{var we;return((we=ue.customer)==null?void 0:we._id)===N._id&&ue.status==="pending_approval"});return e.jsx("button",{onClick:()=>is(N),className:"w-full p-3 sm:p-4 hover:bg-gradient-to-r hover:from-brand-50 hover:to-blue-50 transition-all duration-200 text-left border-2 border-surface-200 hover:border-brand-300 rounded-xl group",children:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center shadow-lg group-hover:shadow-xl transition-shadow flex-shrink-0",children:e.jsx("span",{className:"text-sm sm:text-base lg:text-lg font-bold text-white",children:N.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-surface-900 text-sm sm:text-base lg:text-lg truncate",children:N.name}),J&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-warning-100 text-warning-700 flex-shrink-0",children:"Qarz mavjud"})]}),e.jsxs("p",{className:"text-surface-600 flex items-center gap-1 text-xs sm:text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{className:"truncate",children:N.phone})]}),J&&e.jsxs("p",{className:"text-xs text-warning-600 font-medium mt-1",children:["Mavjud qarz: ",b(J.amount-J.paidAmount)," so'm"]}),N.email&&e.jsxs("p",{className:"text-xs text-surface-500 flex items-center gap-1 mt-1",children:[e.jsx("svg",{className:"w-3 h-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("span",{className:"truncate",children:N.email})]})]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-brand-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})},N._id)})})]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row items-center justify-between gap-3 p-3 sm:p-4 lg:p-6 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-surface-600 order-2 sm:order-1",children:P&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-success-500 rounded-full"}),e.jsxs("span",{children:["Mijoz tanlandi: ",P.name]})]})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto order-1 sm:order-2",children:[P&&e.jsxs("button",{onClick:()=>C(null),className:"flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors text-xs sm:text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Orqaga"]}),e.jsx("button",{onClick:()=>Ve(),className:"px-3 sm:px-4 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors text-xs sm:text-sm",children:"Bekor qilish"}),P&&e.jsxs("button",{onClick:Oe,disabled:v.length===0||!F.dueDate,className:"flex items-center gap-1 sm:gap-2 px-4 sm:px-6 py-2 bg-gradient-to-r from-brand-500 to-brand-600 text-white rounded-lg hover:from-brand-600 hover:to-brand-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-xs sm:text-sm flex-1 sm:flex-none justify-center",children:[e.jsx(ns,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Qarz qo'shish",ze>0&&e.jsxs("span",{className:"ml-2 px-2 py-1 bg-white/20 rounded text-xs hidden sm:inline",children:[b(Re)," so'm"]})]})]})]})]})]}),le&&D&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:Qe}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl shadow-2xl relative z-10 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-surface-200 bg-gradient-to-r from-brand-50 to-blue-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(Ds,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-surface-900",children:"Qarz ma'lumotlari"}),e.jsxs("p",{className:"text-sm text-surface-600",children:["#",D._id.slice(-6)]})]})]}),e.jsx("button",{onClick:Qe,className:"w-10 h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-3",children:"Mijoz ma'lumotlari"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600 text-lg",children:(L=D.customer)==null?void 0:L.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-surface-900",children:(o=D.customer)==null?void 0:o.name}),e.jsx("p",{className:"text-surface-600",children:(Y=D.customer)==null?void 0:Y.phone}),((Se=D.customer)==null?void 0:Se.email)&&e.jsx("p",{className:"text-sm text-surface-500",children:($e=D.customer)==null?void 0:$e.email})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Qarz summasi"}),e.jsxs("p",{className:"text-2xl font-bold text-surface-900",children:[b(D.amount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"To'langan"}),e.jsxs("p",{className:"text-2xl font-bold text-success-600",children:[b(D.paidAmount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Qoldiq"}),e.jsxs("p",{className:"text-2xl font-bold text-danger-600",children:[b(D.amount-D.paidAmount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Muddat"}),e.jsx("p",{className:"text-lg font-semibold text-surface-900",children:new Date(D.dueDate).toLocaleDateString()})]})]}),D.description&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-2",children:"Izoh"}),e.jsx("p",{className:"text-surface-700",children:D.description})]}),D.items&&D.items.length>0&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-3",children:"Mahsulotlar"}),e.jsx("div",{className:"space-y-2",children:D.items.map((N,J)=>{var ue;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-surface-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(Fe,{className:"w-4 h-4 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:((ue=N.product)==null?void 0:ue.name)||"Mahsulot"}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Miqdor: ",N.quantity]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[b(N.price*N.quantity)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:[b(N.price)," Ã— ",N.quantity]})]})]},J)})})]}),e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Yaratilgan"}),e.jsx("p",{className:"font-semibold text-surface-900",children:new Date(D.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:"flex justify-end gap-3 p-6 border-t border-surface-200 bg-surface-50/50",children:e.jsx("button",{onClick:Qe,className:"px-6 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Yopish"})})]})]}),W&&D&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:ge}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-surface-200 bg-gradient-to-r from-danger-50 to-red-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-danger-500 to-danger-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(zs,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-surface-900",children:"Qarzni o'chirish"}),e.jsx("p",{className:"text-sm text-surface-600",children:"Bu amalni bekor qilib bo'lmaydi"})]})]}),e.jsx("button",{onClick:ge,className:"w-10 h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-danger-50 p-4 rounded-xl border border-danger-200 mb-4",children:[e.jsx("p",{className:"text-danger-800 font-medium mb-2",children:"Diqqat!"}),e.jsxs("p",{className:"text-danger-700 text-sm",children:["Siz ",e.jsx("strong",{children:(Ce=D.customer)==null?void 0:Ce.name})," mijozining ",e.jsxs("strong",{children:[b(D.amount)," so'm"]})," qarzini o'chirmoqchisiz. Bu amal bekor qilinmaydi va barcha ma'lumotlar yo'qoladi."]}),D.status==="approved"&&e.jsxs("p",{className:"text-danger-600 text-xs mt-2",children:[e.jsx("strong",{children:"Eslatma:"})," Bu tasdiqlangan qarz. O'chirilganda mijozning umumiy qarzidan ham ayriladi."]})]}),e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Qarz summasi:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[b(D.amount)," so'm"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-surface-600",children:"Qoldiq:"}),e.jsxs("span",{className:"font-semibold text-danger-600",children:[b(D.amount-D.paidAmount)," so'm"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("button",{onClick:ge,className:"px-6 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:Pe,className:"px-6 py-2 bg-gradient-to-r from-danger-500 to-danger-600 text-white rounded-lg hover:from-danger-600 hover:to-danger-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:"O'chirish"})]})]})]}),I&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:ye}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-200 bg-gradient-to-r from-success-50 to-green-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-success-500 to-success-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(ms,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-surface-900",children:"Yangi mijoz"}),e.jsx("p",{className:"text-xs text-surface-600",children:"Mijoz ma'lumotlari"})]})]}),e.jsx("button",{onClick:ye,className:"w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(Ne,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Ism *"}),e.jsx("input",{type:"text",value:ve.name,onChange:N=>H(J=>j(g({},J),{name:N.target.value})),className:"w-full px-3 py-2 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20",placeholder:"Mijoz ismi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Telefon *"}),e.jsx("input",{type:"tel",value:ve.phone,onChange:N=>H(J=>j(g({},J),{phone:N.target.value})),className:"w-full px-3 py-2 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20",placeholder:"+998 (XX) XXX-XX-XX"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Viloyat"}),e.jsx("textarea",{value:ve.address,onChange:N=>H(J=>j(g({},J),{address:N.target.value})),className:"w-full px-3 py-2 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20 resize-none",rows:2,placeholder:"Viloyatni tanlang"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("button",{onClick:ye,className:"px-4 py-2 text-xs font-medium text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:T,disabled:!ve.name.trim()||!ve.phone.trim(),className:"px-4 py-2 text-xs font-medium bg-gradient-to-r from-success-500 to-success-600 text-white rounded-lg hover:from-success-600 hover:to-success-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:"Saqlash"})]})]})]})]})}function fl(){const{showAlert:t,AlertComponent:n}=ws(),r=nt(),[h,l]=s.useState([]),[w,S]=s.useState(null),[p,q]=s.useState([]),[z,y]=s.useState([]),[k,M]=s.useState(20),[f,E]=s.useState(""),[c,R]=s.useState("all"),[P,C]=s.useState(!1),[v,_]=s.useState(!1),[X,B]=s.useState(!1),[he,pe]=s.useState(!1),[F,be]=s.useState(!1),[le,Te]=s.useState(null),[W,te]=s.useState(null),[D,xe]=s.useState(!1),[I,fe]=s.useState({code:"",name:"",quantity:"",previousPrice:"",currentPrice:"",unit:"dona",conversionEnabled:!1,baseUnit:"dona",conversionRate:"",packageCount:"",pricePerMeter:"",pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),[ve,H]=s.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[T,ye]=s.useState([]),[de,ke]=s.useState(""),[ae,Ke]=s.useState(!1),[is,Ve]=s.useState(null),[Me,es]=s.useState(!1),[u,re]=s.useState(!1),[Pe,Qe]=s.useState("add"),[ge,Oe]=s.useState(""),[m,je]=s.useState({printer:"",copies:1,size:"card",layout:"standard",customWidth:"",customHeight:""}),[ze,Ie]=s.useState([]),[Re,_e]=s.useState(!1),[L,o]=s.useState(null),Y=s.useRef(null),Se=s.useRef(null);s.useEffect(()=>{$e()},[]),s.useEffect(()=>{w&&Ce()},[w]),s.useEffect(()=>{y(p.slice(0,k))},[p,k]),s.useEffect(()=>{const d=Se.current;if(!d)return;const ne=()=>{const{scrollTop:x,scrollHeight:V,clientHeight:ce}=d;V-x<=ce*1.5&&k<p.length&&M(oe=>Math.min(oe+20,p.length))};return d.addEventListener("scroll",ne),()=>d.removeEventListener("scroll",ne)},[k,p.length]),s.useEffect(()=>{w&&Ce()},[r.pathname]),s.useEffect(()=>{const d=ne=>{ne.key==="Escape"&&ae&&Ke(!1)};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[ae]),s.useEffect(()=>{let d=h;f.trim()!==""&&(d=d.filter(ne=>ne.name.toLowerCase().includes(f.toLowerCase())||ne.code.toLowerCase().includes(f.toLowerCase()))),c!=="all"&&(c==="low"?d=d.filter(ne=>ne.quantity<=(ne.minStock||50)&&ne.quantity>0):c==="out"&&(d=d.filter(ne=>ne.quantity===0))),q(d),M(20)},[h,f,c]);const $e=()=>Q(this,null,function*(){try{const ne=(yield K.get("/warehouses")).data.find(x=>x.name==="Asosiy ombor");if(ne)S(ne);else{const x=yield K.post("/warehouses",{name:"Asosiy ombor",address:""});S(x.data)}}catch(d){console.error("Error fetching warehouses:",d),C(!1)}}),Ce=()=>Q(this,null,function*(){try{C(!0);const d=yield K.get("/products?mainOnly=true&limit=10000"),ne=d.data.data||d.data;l(Array.isArray(ne)?ne:[])}catch(d){console.error("Error fetching products:",d),t("Tovarlarni yuklashda xatolik yuz berdi","Xatolik","danger")}finally{C(!1)}}),N=d=>new Promise((ne,x)=>{const V=new FileReader;V.readAsDataURL(d),V.onload=ce=>{var qe;const oe=document.createElement("img");oe.src=(qe=ce.target)==null?void 0:qe.result,oe.onload=()=>{const Ee=document.createElement("canvas");let Ae=oe.width,De=oe.height;if(Ae>1920||De>1920){const cs=Math.min(1920/Ae,1920/De);Ae=Math.round(Ae*cs),De=Math.round(De*cs)}Ee.width=Ae,Ee.height=De;const os=Ee.getContext("2d");if(!os){x(new Error("Canvas context not available"));return}os.drawImage(oe,0,0,Ae,De),Ee.toBlob(cs=>{cs?ne(cs):x(new Error("Canvas to blob failed"))},"image/jpeg",.8)},oe.onerror=()=>x(new Error("Image load failed"))},V.onerror=()=>x(new Error("File read failed"))}),J=(d,ne)=>Q(this,null,function*(){var os,cs;const x=ne.target.files;if(!x||x.length===0)return;const V=h.find(ts=>ts._id===d);if(!V)return;const ce=V.images||[],oe=8-ce.length;if(oe<=0){t("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const qe=["image/jpeg","image/jpg","image/png","image/webp"],Ee=Array.from(x).filter(ts=>qe.includes(ts.type)?!0:(t(`${ts.name} - noto'g'ri format. Faqat JPG, PNG, WebP qabul qilinadi`,"Xatolik","warning"),!1));if(Ee.length===0)return;const Ae=Ee.slice(0,oe),De=new FormData;xe(!0),o(d);try{for(const ds of Ae)try{const Bs=yield N(ds);De.append("images",Bs,ds.name)}catch(Bs){console.warn(`Image compression failed for ${ds.name}, uploading original:`,Bs),De.append("images",ds)}const ts=yield K.post("/products/upload-images",De,{headers:{"Content-Type":"multipart/form-data"}}),Ge=[...ce,...ts.data.images],xs=yield K.put(`/products/${d}/images`,{images:Ge});l(ds=>ds.map(Bs=>Bs._id===d?j(g({},Bs),{images:Ge}):Bs)),t(`${ts.data.images.length} ta rasm muvaffaqiyatli yuklandi!`,"Muvaffaqiyat","success")}catch(ts){console.error("Error uploading images:",ts);const Ge=((cs=(os=ts.response)==null?void 0:os.data)==null?void 0:cs.message)||"Rasmlarni yuklashda xatolik";t(Ge,"Xatolik","danger")}finally{xe(!1),o(null),Y.current&&(Y.current.value="")}}),ue=()=>Q(this,null,function*(){_(!0);try{yield Ce(),t("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(d){console.error("Refresh xatosi:",d),t("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{_(!1)}}),we=d=>Q(this,null,function*(){const ne=d.target.files;if(!ne||ne.length===0)return;const x=8-T.length;if(x<=0){t("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const V=Array.from(ne).slice(0,x),ce=new FormData;V.forEach(oe=>ce.append("images",oe)),xe(!0);try{const oe=yield K.post("/products/upload-images",ce,{headers:{"Content-Type":"multipart/form-data"}});ye([...T,...oe.data.images])}catch(oe){console.error("Error uploading images:",oe),t("Rasmlarni yuklashda xatolik","Xatolik","danger")}finally{xe(!1),Y.current&&(Y.current.value="")}}),Be=d=>Q(this,null,function*(){try{yield K.delete("/products/delete-image",{data:{imagePath:d}}),ye(T.filter(ne=>ne!==d))}catch(ne){console.error("Error deleting image:",ne)}}),Je=d=>Q(this,null,function*(){var ce,oe;if(d.preventDefault(),de){t(de,"Xatolik","danger");return}let ne=Number(I.quantity),x=null;if(Me&&ve.packageCount&&ve.unitsPerPackage){const qe=Number(ve.packageCount)*Number(ve.unitsPerPackage);ne=W?Number(I.quantity)+qe:qe,x={packageCount:Number(ve.packageCount),unitsPerPackage:Number(ve.unitsPerPackage),totalUnits:qe}}let V=ne;I.conversionEnabled&&I.conversionRate&&(V=ne*Number(I.conversionRate));try{const qe={code:I.code,name:I.name,price:Number(I.currentPrice),previousPrice:Number(I.previousPrice)||0,currentPrice:Number(I.currentPrice)||0,quantity:ne,warehouse:w==null?void 0:w._id,images:T,packageInfo:x,unit:I.unit,unitConversion:{enabled:I.conversionEnabled,baseUnit:I.baseUnit,conversionRate:Number(I.conversionRate)||1,packageCount:ne,totalBaseUnits:V},prices:{perUnit:Number(I.currentPrice),perMeter:Number(I.pricePerMeter)||0,perRoll:Number(I.pricePerRoll)||0,perBox:Number(I.pricePerBox)||0,perKg:Number(I.pricePerKg)||0,perGram:Number(I.pricePerGram)||0}};W?yield K.put(`/products/${W._id}`,qe):yield K.post("/products",qe),Ce(),Xe()}catch(qe){t(((oe=(ce=qe.response)==null?void 0:ce.data)==null?void 0:oe.message)||"Xatolik yuz berdi","Xatolik","danger")}}),Xe=()=>{B(!1),te(null),fe({code:"",name:"",quantity:"",previousPrice:"",currentPrice:"",unit:"dona",conversionEnabled:!1,baseUnit:"dona",conversionRate:"",packageCount:"",pricePerMeter:"",pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),H({packageCount:"",unitsPerPackage:"",totalCost:""}),ye([]),ke(""),es(!1)},hs=d=>{Qe(d),Oe(""),re(!0)},Ns=()=>{const d=Number(ge)||0;if(d<=0)return;const ne=Number(I.quantity)||0;let x=Pe==="add"?ne+d:ne-d;x<0&&(x=0),fe(j(g({},I),{quantity:String(x)})),re(!1),Oe("")},Ms=d=>Q(this,null,function*(){if(d)try{const ne=(W==null?void 0:W._id)||"";(yield K.get(`/products/check-code/${d}${ne?`?excludeId=${ne}`:""}`)).data.exists?ke(`Kod "${d}" allaqachon mavjud`):ke("")}catch(ne){console.error("Error checking code:",ne)}}),gs=()=>{if(!le)return;const d=document.getElementById("qr-code-svg");if(!d)return;const ne=new XMLSerializer().serializeToString(d),x=document.createElement("canvas"),V=x.getContext("2d"),ce=document.createElement("img");ce.onload=()=>{x.width=ce.width,x.height=ce.height,V==null||V.drawImage(ce,0,0);const oe=x.toDataURL("image/png"),qe=document.createElement("a");qe.download=`QR-${le.code}-${le.name}.png`,qe.href=oe,qe.click()},ce.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(ne)))},Cs=(d,ne)=>Q(this,null,function*(){try{const x=JSON.stringify({id:d._id,code:d.code,name:d.name,price:d.price});return yield Xt(x,{width:ne*10,margin:1,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"H",type:"image/png"})}catch(x){return console.error("Error generating QR code:",x),""}}),Rs=()=>Q(this,null,function*(){if(le)try{const d=m.customWidth&&m.customHeight,ne=d?`${m.customWidth}mm`:null,x=d?`${m.customHeight}mm`:null,V=m.size==="card"?65:m.size==="thermal"?125:145,ce=yield Cs(le,V),oe=`
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="utf-8">
          <title>Label - ${le.name}</title>
          <style>
            @page {
              size: ${d?`${ne} ${x}`:m.size==="card"?"28mm 18mm":m.size==="A4"?"A4":m.size==="A5"?"A5":"50mm 70mm"};
              margin: 0;
            }
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            html, body {
              width: 100%;
              height: 100%;
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              background: white;
              overflow: hidden;
            }
            .page-container {
              width: 100%;
              height: 100vh;
              display: flex;
              justify-content: center;
              align-items: center;
              page-break-after: avoid;
            }
            .label-container {
              border: 2px solid #333;
              padding: ${m.size==="card"?"1mm":m.size==="thermal"?"6px":"12px"};
              background: white;
              width: ${d?ne:m.size==="card"?"26mm":m.size==="thermal"?"44mm":m.size==="A4"?"80mm":(m.size==="A5","120mm")};
              height: ${d?x:m.size==="card"?"16mm":m.size==="thermal"?"60mm":m.size==="A4"?"100mm":(m.size==="A5","140mm")};
              display: flex;
              flex-direction: column;
              justify-content: space-between;
              gap: 2px;
              overflow: hidden;
              border-radius: 2px;
              page-break-inside: avoid;
            }
            .product-info {
              flex: 1;
              width: 100%;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              text-align: center;
              height: auto;
            }
            .product-name {
              font-size: ${m.size==="card"?"8px":m.size==="thermal"?"16px":"20px"};
              font-weight: 600;
              color: #1a1a1a;
              line-height: 1.1;
              margin-bottom: ${m.size==="card"?"1px":"2px"};
              word-wrap: break-word;
              overflow: hidden;
              text-overflow: ellipsis;
              display: -webkit-box;
              -webkit-line-clamp: ${m.size==="card"?"1":"2"};
              -webkit-box-orient: vertical;
            }
            .product-code {
              font-size: ${m.size==="card"?"7px":m.size==="thermal"?"14px":"18px"};
              color: #666;
              line-height: 1.0;
              margin-bottom: ${m.size==="card"?"1px":"2px"};
              font-weight: 500;
            }
            .product-price {
              font-size: ${m.size==="card"?"12px":m.size==="thermal"?"20px":"24px"};
              font-weight: 800;
              color: #d32f2f;
              line-height: 1.0;
              margin-bottom: ${m.size==="card"?"0px":"1px"};
            }
            .qr-code-section {
              flex-shrink: 0;
              display: flex;
              align-items: center;
              justify-content: center;
              width: 100%;
              height: auto;
              padding: 2px 0;
              overflow: hidden;
              box-sizing: border-box;
            }
            .qr-code-img {
              width: ${m.size==="card"?"60px":m.size==="thermal"?"120px":"140px"};
              height: ${m.size==="card"?"60px":m.size==="thermal"?"120px":"140px"};
              max-width: 95%;
              max-height: 95%;
              border: 1px solid #e0e0e0;
              border-radius: 2px;
              background: white;
              object-fit: contain;
              image-rendering: -webkit-optimize-contrast;
              image-rendering: crisp-edges;
              image-rendering: pixelated;
            }
            .additional-info {
              margin: 0;
              font-size: ${m.size==="card"?"4px":m.size==="thermal"?"10px":"12px"};
              color: #888;
              line-height: 1.0;
              font-weight: 400;
            }
            ${m.layout==="minimal"?".additional-info { display: none; }":""}
            
            @media print {
              html, body {
                background: white !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                margin: 0 !important;
                padding: 0 !important;
              }
              .page-container {
                height: 100vh !important;
                page-break-after: avoid !important;
              }
              .label-container {
                page-break-inside: avoid !important;
                width: ${d?ne:m.size==="card"?"28mm":m.size==="thermal"?"48mm":m.size==="A4"?"85mm":(m.size==="A5","130mm")} !important;
                height: ${d?x:m.size==="card"?"18mm":m.size==="thermal"?"65mm":m.size==="A4"?"105mm":(m.size==="A5","145mm")} !important;
                padding: ${m.size==="card"?"1.5mm":m.size==="thermal"?"8px":"15px"} !important;
                flex-direction: column !important;
                justify-content: space-between !important;
              }
              .qr-code-section {
                width: 100% !important;
                height: auto !important;
                overflow: hidden !important;
                box-sizing: border-box !important;
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
              }
              .qr-code-img {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                width: ${m.size==="card"?"65px":m.size==="thermal"?"125px":"145px"} !important;
                height: ${m.size==="card"?"65px":m.size==="thermal"?"125px":"145px"} !important;
                max-width: 95% !important;
                max-height: 95% !important;
                object-fit: contain !important;
              }
            }
          </style>
        </head>
        <body>
          <div class="page-container">
            <div class="label-container">
              <div class="product-info">
                <div class="product-price">${b(le.currentPrice||le.price)} so'm</div>
                <div class="product-code">Kod: ${le.code}</div>
                <div class="product-name">${le.name}</div>
                
                ${m.layout==="standard"?`
                  <div class="additional-info">
                    Miqdor: ${le.quantity} | ${new Date().toLocaleDateString("uz-UZ")}
                  </div>
                `:""}
              </div>
              
              <div class="qr-code-section">
                <img src="${ce}" alt="QR Code" class="qr-code-img" />
              </div>
            </div>
          </div>
        </body>
        </html>
      `,qe=window.open("","_blank","width=1024,height=768");if(!qe){alert("Popup blocker tomonidan to'sib qo'yildi. Popup'larni yoqing.");return}qe.document.open(),qe.document.write(oe),qe.document.close(),qe.onload=()=>{setTimeout(()=>{qe.focus(),qe.print(),setTimeout(()=>{qe.close()},1e3)},500)},be(!1)}catch(d){console.error("Error generating print content:",d),alert("Chop uchun tayyorlashda xatolik yuz berdi")}}),ps={total:h.length,lowStock:h.filter(d=>d.quantity<=(d.minStock||50)&&d.quantity>0).length,outOfStock:h.filter(d=>d.quantity===0).length,totalValue:h.reduce((d,ne)=>d+ne.price*ne.quantity,0)},ys=d=>{if(d.images&&d.images.length>0){const ne=typeof d.images[0]=="string"?d.images[0]:d.images[0].path;return`${Ps}${ne}`}return null},$s=[{label:"Jami tovarlar",value:ps.total,icon:Fe,color:"brand",filter:"all"},{label:"Kam qolgan",value:ps.lowStock,icon:Ts,color:"warning",filter:"low"},{label:"Tugagan",value:ps.outOfStock,icon:Ne,color:"danger",filter:"out"},{label:"Jami qiymat",value:`${b(ps.totalValue)} so'm`,icon:ns,color:"success",filter:null}];return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[n,e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-brand-600"}),e.jsx("h2",{className:"text-lg font-semibold text-surface-900",children:"Tovarlar (Asosiy ombor)"})]}),e.jsx("div",{className:"flex items-center gap-2 sm:gap-3",children:e.jsxs("button",{onClick:ue,disabled:v,className:"flex items-center justify-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50",title:"Tovarlar ro'yxatini yangilash (F5)",children:[e.jsx(As,{className:`w-4 h-4 ${v?"animate-spin":""}`}),e.jsx("span",{className:"sm:inline",children:v?"Yangilanmoqda...":"Yangilash"})]})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-2 sm:gap-2.5 md:gap-3",children:$s.map((d,ne)=>e.jsx("div",{onClick:()=>d.filter&&R(d.filter),className:`bg-white rounded-lg sm:rounded-xl border-2 transition-all ${d.filter?"cursor-pointer hover:shadow-lg hover:scale-[1.02]":""} ${c===d.filter?"border-brand-500 shadow-md":"border-surface-200"}`,children:e.jsxs("div",{className:"p-2 sm:p-2.5 md:p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-1.5 sm:mb-2",children:[e.jsx("div",{className:`w-7 h-7 sm:w-8 sm:h-8 md:w-9 md:h-9 rounded-lg flex items-center justify-center bg-${d.color}-50`,children:e.jsx(d.icon,{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-4.5 md:h-4.5 text-${d.color}-600`})}),e.jsx("p",{className:"text-[10px] sm:text-xs text-surface-500 font-medium",children:d.label})]}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-surface-900",children:d.value})]})},ne))}),e.jsxs("div",{className:"relative",children:[e.jsx(bs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Tovar nomi yoki kodi bo'yicha qidirish...",value:f,onChange:d=>E(d.target.value),className:"w-full pl-10 pr-4 py-2 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-100"})]}),e.jsx("div",{className:"card p-0 overflow-hidden",children:P?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Fe,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Tovarlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:f?"Qidiruv bo'yicha tovarlar topilmadi":"Tovarlar mavjud emas"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden lg:block",children:[e.jsx("div",{className:"table-header",children:e.jsxs("div",{className:"grid grid-cols-14 gap-2 px-4 py-4",children:[e.jsx("span",{className:"table-header-cell col-span-1",children:"Rasm"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Kod"}),e.jsx("span",{className:"table-header-cell col-span-2",children:"Nomi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Tan narxi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Dona narxi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Karobka"}),e.jsx("span",{className:"table-header-cell col-span-3",children:"Chegirmalar"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Oldingi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Hozirgi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Miqdori"})]})}),e.jsx("div",{className:"max-h-[calc(100vh-400px)] overflow-y-auto divide-y divide-surface-100",children:p.map(d=>{var ne,x,V,ce,oe,qe,Ee,Ae,De,os,cs,ts;return e.jsxs("div",{className:"grid grid-cols-14 gap-2 px-4 py-3 items-center hover:bg-surface-50 transition-colors relative",children:[e.jsx("div",{className:"col-span-1",children:ys(d)?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:ys(d),alt:d.name,className:"w-10 h-10 rounded-lg object-cover cursor-pointer hover:scale-110 transition-transform",onClick:()=>{Ve(ys(d)),Ke(!0)}}),e.jsx("button",{onClick:Ge=>{var xs;Ge.stopPropagation(),o(d._id),(xs=Y.current)==null||xs.click()},disabled:D&&L===d._id,className:"absolute -top-0.5 -right-0.5 flex items-center justify-center w-4 h-4 bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-full shadow-sm hover:shadow-md transition-all duration-200 hover:scale-110 disabled:opacity-50",title:"Rasm yuklash",children:D&&L===d._id?e.jsx("div",{className:"w-2 h-2 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Ct,{className:"w-2 h-2 text-white"})})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-lg flex items-center justify-center",children:e.jsx(lr,{className:"w-5 h-5 text-surface-400"})}),e.jsx("button",{onClick:Ge=>{var xs;Ge.stopPropagation(),o(d._id),(xs=Y.current)==null||xs.click()},disabled:D&&L===d._id,className:"absolute -top-0.5 -right-0.5 flex items-center justify-center w-4 h-4 bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-full shadow-sm hover:shadow-md transition-all duration-200 hover:scale-110 disabled:opacity-50",title:"Rasm yuklash",children:D&&L===d._id?e.jsx("div",{className:"w-2 h-2 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Ct,{className:"w-2 h-2 text-white"})})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"font-mono text-xs bg-surface-100 px-1.5 py-0.5 rounded",children:d.code})}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"font-medium text-surface-900 text-sm truncate",children:d.name})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-surface-700 text-sm",children:b(d.costPrice||0)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-brand-600 text-sm",children:b(d.unitPrice||d.price)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-orange-600 text-sm",children:d.boxPrice>0?b(d.boxPrice):"-"})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[((x=(ne=d.pricingTiers)==null?void 0:ne.tier1)==null?void 0:x.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-emerald-50 text-emerald-700 rounded text-[10px] font-bold",children:[d.pricingTiers.tier1.minQuantity,"-",d.pricingTiers.tier1.maxQuantity,": ",d.pricingTiers.tier1.discountPercent,"%"]}),((ce=(V=d.pricingTiers)==null?void 0:V.tier2)==null?void 0:ce.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded text-[10px] font-bold",children:[d.pricingTiers.tier2.minQuantity,"-",d.pricingTiers.tier2.maxQuantity,": ",d.pricingTiers.tier2.discountPercent,"%"]}),((qe=(oe=d.pricingTiers)==null?void 0:oe.tier3)==null?void 0:qe.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-purple-50 text-purple-700 rounded text-[10px] font-bold",children:[d.pricingTiers.tier3.minQuantity,"+: ",d.pricingTiers.tier3.discountPercent,"%"]}),!((Ae=(Ee=d.pricingTiers)==null?void 0:Ee.tier1)!=null&&Ae.discountPercent)&&!((os=(De=d.pricingTiers)==null?void 0:De.tier2)!=null&&os.discountPercent)&&!((ts=(cs=d.pricingTiers)==null?void 0:cs.tier3)!=null&&ts.discountPercent)&&e.jsx("span",{className:"text-surface-400 text-xs",children:"-"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:`font-semibold text-sm ${(()=>{const Ge=d.previousPrice||0,xs=d.currentPrice||d.price;return Ge>0&&xs>0&&Ge!==xs?"line-through text-red-500":"text-surface-900"})()}`,children:b(d.previousPrice||0)})}),e.jsxs("div",{className:"col-span-1 relative",children:[(()=>{const Ge=d.previousPrice||0,xs=d.currentPrice||d.price;if(Ge>0&&xs>0&&Ge!==xs){const ds=Math.round((Ge-xs)/Ge*100);if(ds>0)return e.jsxs("div",{className:"absolute -top-2 -right-1 px-1 py-0.5 bg-red-500 text-white rounded text-[9px] font-bold",children:["-",ds,"%"]});if(ds<0)return e.jsxs("div",{className:"absolute -top-2 -right-1 px-1 py-0.5 bg-green-500 text-white rounded text-[9px] font-bold",children:["+",Math.abs(ds),"%"]})}return null})(),e.jsx("p",{className:"font-semibold text-surface-900 text-sm",children:b(d.currentPrice||d.price)})]}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`font-semibold text-sm ${d.quantity===0?"text-danger-600":d.quantity<=(d.minStock||100)?"text-warning-600":"text-success-600"}`,children:d.quantity})})]},d._id)})})]}),e.jsxs("div",{className:"lg:hidden",children:[e.jsxs("div",{ref:Se,className:"max-h-[calc(100vh-300px)] overflow-y-auto p-3 sm:p-4",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-2 sm:gap-3",children:z.map(d=>e.jsx("div",{className:"group bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 hover:border-brand-300 hover:shadow-lg transition-all p-2 sm:p-4 relative",children:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"w-full aspect-square bg-gradient-to-br from-brand-100 to-brand-50 rounded-xl border-2 border-brand-200 flex items-center justify-center mb-2 sm:mb-3 group-hover:scale-105 transition-transform overflow-hidden cursor-pointer relative",onClick:()=>{if(d.images&&d.images.length>0){const ne=typeof d.images[0]=="string"?d.images[0]:d.images[0].path;Ve(`${Ps}${ne}`),Ke(!0)}},children:d.images&&d.images.length>0?e.jsx(e.Fragment,{children:e.jsx("img",{src:`${Ps}${typeof d.images[0]=="string"?d.images[0]:d.images[0].path}`,alt:d.name,className:"w-full h-full object-cover",onError:ne=>{ne.currentTarget.style.display="none",ne.currentTarget.parentElement.innerHTML='<svg class="w-6 h-6 sm:w-8 sm:h-8 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>'}})}):e.jsx(Fe,{className:"w-6 h-6 sm:w-8 sm:h-8 text-brand-600"})}),e.jsx("p",{className:"font-semibold text-slate-900 text-[10px] sm:text-sm truncate",children:d.name}),e.jsxs("div",{className:"flex items-center gap-1.5 mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[9px] sm:text-xs text-slate-500",children:d.code}),e.jsx("button",{onClick:ne=>{var x;ne.stopPropagation(),o(d._id),(x=Y.current)==null||x.click()},disabled:D&&L===d._id,className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex items-center justify-center bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-full shadow-sm hover:shadow-md transition-all duration-200 hover:scale-110 disabled:opacity-50",title:"Rasm yuklash",children:D&&L===d._id?e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Ct,{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 text-white"})})]}),e.jsxs("p",{className:"font-bold text-brand-600 text-[10px] sm:text-sm",children:[b(d.price)," so'm"]}),e.jsxs("p",{className:"text-[9px] sm:text-xs text-slate-500 mt-1",children:["Mavjud: ",d.quantity," ta"]})]})},d._id))}),k<p.length&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"w-6 h-6 border-2 border-brand-500 border-t-transparent rounded-full animate-spin"})})]}),e.jsx("input",{ref:Y,type:"file",accept:"image/*",multiple:!0,onChange:d=>{L&&J(L,d)},className:"hidden"})]})]})})]}),X&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start sm:items-center justify-center p-2 pt-4 sm:p-4",children:[e.jsx("div",{className:"overlay",onClick:Xe}),e.jsxs("div",{className:"modal w-full sm:max-w-lg p-4 sm:p-6 relative z-10 max-h-[calc(100vh-120px)] sm:max-h-[85vh] overflow-y-auto rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6 sticky top-0 bg-white pb-3 border-b border-surface-200 -mx-4 sm:-mx-6 px-4 sm:px-6 z-10",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-surface-900",children:W?"Tovarni tahrirlash":"Yangi tovar"}),e.jsx("button",{onClick:Xe,className:"btn-icon-sm",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:Je,className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Rasmlar (max 8)"}),e.jsxs("div",{className:"grid grid-cols-4 gap-1.5 sm:gap-2 mb-2",children:[T.map((d,ne)=>e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:`${Ps}${d}`,alt:"",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>Be(d),className:"absolute -top-1 -right-1 w-4 h-4 sm:w-5 sm:h-5 bg-danger-500 text-white rounded-full flex items-center justify-center",children:e.jsx(Ne,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})})]},ne)),T.length<8&&e.jsx("button",{type:"button",onClick:()=>{var d;return(d=Y.current)==null?void 0:d.click()},disabled:D,className:"aspect-square border-2 border-dashed border-surface-300 rounded-lg flex flex-col items-center justify-center hover:border-brand-500 hover:bg-brand-50 transition-colors",children:D?e.jsx("div",{className:"spinner w-4 h-4 sm:w-5 sm:h-5 text-brand-600"}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"w-4 h-4 sm:w-5 sm:h-5 text-surface-400 mb-0.5 sm:mb-1"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-surface-500",children:"Yuklash"})]})})]}),e.jsx("input",{ref:Y,type:"file",accept:"image/*",multiple:!0,onChange:we,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input text-sm sm:text-base py-2 sm:py-2.5 ${de?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"1",value:I.code,onChange:d=>fe(j(g({},I),{code:d.target.value})),onBlur:d=>Ms(d.target.value),required:!0}),de&&e.jsx("p",{className:"text-xs sm:text-sm text-danger-600 mt-1",children:de})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Miqdori"}),W?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"flex-1 px-2 sm:px-4 py-2 sm:py-3 bg-surface-100 rounded-xl text-center font-semibold text-surface-900 text-sm sm:text-base",children:b(I.quantity||0)}),e.jsx("button",{type:"button",onClick:()=>hs("add"),className:"btn-icon bg-success-100 text-success-600 hover:bg-success-200 w-8 h-8 sm:w-10 sm:h-10",children:e.jsx(ms,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{type:"button",onClick:()=>hs("subtract"),className:"btn-icon bg-danger-100 text-danger-600 hover:bg-danger-200 w-8 h-8 sm:w-10 sm:h-10",children:e.jsx(ft,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}):e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"0",value:rs(I.quantity),onChange:d=>fe(j(g({},I),{quantity:We(d.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"Tovar nomi",value:I.name,onChange:d=>fe(j(g({},I),{name:d.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Oldingi narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"0",value:rs(I.previousPrice),onChange:d=>fe(j(g({},I),{previousPrice:We(d.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Hozirgi narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"0",value:rs(I.currentPrice),onChange:d=>fe(j(g({},I),{currentPrice:We(d.target.value)})),required:!0}),I.previousPrice&&I.currentPrice&&Number(I.previousPrice)>0&&Number(I.currentPrice)>0&&e.jsx("div",{className:"mt-1.5 sm:mt-2",children:(()=>{const d=Number(I.previousPrice),ne=Number(I.currentPrice),x=Math.round((d-ne)/d*100);return x>0?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1.5 sm:py-2 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-green-500 rounded-full"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-green-700",children:[x,"% chegirma"]})]}):x<0?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1.5 sm:py-2 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-red-500 rounded-full"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-red-700",children:[Math.abs(x),"% qimmatroq"]})]}):null})()})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-3 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-brand-600"}),"O'lchov birligi"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Birlik"}),e.jsxs("select",{className:"input",value:I.unit,onChange:d=>fe(j(g({},I),{unit:d.target.value})),children:[e.jsx("option",{value:"dona",children:"Dona"}),e.jsx("option",{value:"metr",children:"Metr"}),e.jsx("option",{value:"rulon",children:"Rulon"}),e.jsx("option",{value:"karobka",children:"Karobka/Quti"}),e.jsx("option",{value:"gram",children:"Gram"}),e.jsx("option",{value:"kg",children:"Kilogram"}),e.jsx("option",{value:"litr",children:"Litr"})]})]}),(I.unit==="rulon"||I.unit==="karobka")&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:["1 ",I.unit==="rulon"?"rulon":"karobka"," = ?"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"input flex-1",placeholder:"30",value:I.conversionRate,onChange:d=>fe(j(g({},I),{conversionRate:We(d.target.value),conversionEnabled:!0}))}),e.jsxs("select",{className:"input w-24",value:I.baseUnit,onChange:d=>fe(j(g({},I),{baseUnit:d.target.value})),children:[e.jsx("option",{value:"metr",children:"metr"}),e.jsx("option",{value:"dona",children:"dona"})]})]})]})]}),I.conversionEnabled&&I.conversionRate&&I.quantity&&e.jsx("div",{className:"mt-3 p-3 bg-purple-50 rounded-xl",children:e.jsxs("p",{className:"text-sm text-purple-700",children:[e.jsx("span",{className:"font-semibold",children:b(I.quantity)})," ",I.unit==="rulon"?"rulon":"karobka"," =",e.jsx("span",{className:"font-semibold ml-1",children:b(Number(I.quantity)*Number(I.conversionRate))})," ",I.baseUnit]})})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-3 flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4 text-green-600"}),"Qo'shimcha narxlar (ixtiyoriy)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Metr narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:rs(I.pricePerMeter),onChange:d=>fe(j(g({},I),{pricePerMeter:We(d.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Rulon narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:rs(I.pricePerRoll),onChange:d=>fe(j(g({},I),{pricePerRoll:We(d.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Karobka narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:rs(I.pricePerBox),onChange:d=>fe(j(g({},I),{pricePerBox:We(d.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Kg narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:rs(I.pricePerKg),onChange:d=>fe(j(g({},I),{pricePerKg:We(d.target.value)}))})]})]})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 pt-3 sm:pt-4 sticky bottom-0 bg-white pb-safe -mx-4 sm:-mx-6 px-4 sm:px-6 border-t border-surface-200 mt-4 z-10",children:[e.jsx("button",{type:"button",onClick:Xe,className:"btn-secondary flex-1 text-sm sm:text-base py-2.5 sm:py-3",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1 text-sm sm:text-base py-2.5 sm:py-3",disabled:!!de,children:"Saqlash"})]})]})]})]}),he&&le&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>pe(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"QR Kod"}),e.jsx("button",{onClick:()=>pe(!1),className:"btn-icon-sm",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border border-surface-200 mb-4",children:e.jsx(At,{id:"qr-code-svg",value:JSON.stringify({id:le._id,code:le.code,name:le.name,price:le.price}),size:200,level:"H",includeMargin:!0})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-semibold text-surface-900",children:le.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",le.code]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Oldingi narxi: ",b(le.previousPrice||0)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Hozirgi narxi: ",b(le.currentPrice||le.price)," so'm"]})]}),e.jsxs("button",{onClick:gs,className:"btn-primary w-full",children:[e.jsx(Kt,{className:"w-4 h-4"}),"Yuklab olish"]})]})]})]}),F&&le&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>be(!1)}),e.jsxs("div",{className:"modal w-full max-w-4xl p-6 relative z-10 max-h-[92vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Print sozlamalari"}),e.jsx("button",{onClick:()=>be(!1),className:"btn-icon-sm",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Printer tanlash"}),e.jsxs("select",{className:"input",value:m.printer,onChange:d=>je(j(g({},m),{printer:d.target.value})),children:[e.jsx("option",{value:"",children:"Printer tanlang"}),ze.map(d=>e.jsx("option",{value:d,children:d},d))]}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Print tugmasini bosganda Windows print dialog ochiladi va barcha mavjud printerlarni ko'rsatadi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Qog'oz o'lchami"}),e.jsxs("select",{className:"input",value:m.size,onChange:d=>je(j(g({},m),{size:d.target.value})),children:[e.jsx("option",{value:"card",children:"Kichik yorliq (50Ã—25mm)"}),e.jsx("option",{value:"A4",children:"A4 (210Ã—297mm)"}),e.jsx("option",{value:"A5",children:"A5 (148Ã—210mm)"}),e.jsx("option",{value:"thermal",children:"Thermal (80Ã—120mm)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Shablon"}),e.jsxs("select",{className:"input",value:m.layout,onChange:d=>je(j(g({},m),{layout:d.target.value})),children:[e.jsx("option",{value:"standard",children:"Standart (barcha ma'lumotlar)"}),e.jsx("option",{value:"minimal",children:"Minimal (faqat asosiy ma'lumotlar)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Nusxalar soni"}),e.jsx("input",{type:"number",min:"1",max:"10",className:"input",value:m.copies,onChange:d=>je(j(g({},m),{copies:parseInt(d.target.value)||1}))})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4",children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Maxsus o'lcham (ixtiyoriy)"}),e.jsx("p",{className:"text-xs text-surface-500 mb-3",children:"Agar maxsus o'lcham belgilasangiz, u qog'oz o'lchamidan ustun bo'ladi"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-600 mb-1 block",children:"Eni (mm)"}),e.jsx("input",{type:"number",min:"1",className:"input",placeholder:"Masalan: 50",value:m.customWidth,onChange:d=>je(j(g({},m),{customWidth:d.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-600 mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"number",min:"1",className:"input",placeholder:"Masalan: 25",value:m.customHeight,onChange:d=>je(j(g({},m),{customHeight:d.target.value}))})]})]})]})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-surface-700 mb-3",children:"Ko'rinish"}),e.jsx("div",{className:"bg-white shadow-md rounded-xl p-6 flex justify-center items-start min-h-[420px]",children:e.jsx("div",{className:"bg-white border border-gray-200 shadow-lg rounded-xl",style:{width:m.customWidth&&m.customHeight?`${m.customWidth}mm`:m.size==="card"?"26mm":m.size==="thermal"?"48mm":m.size==="A4"?"80mm":m.size==="A5"?"140mm":"120mm",height:m.customWidth&&m.customHeight?`${m.customHeight}mm`:m.size==="card"?"17mm":m.size==="thermal"?"65mm":m.size==="A4"?"105mm":m.size==="A5"?"145mm":"140mm",fontSize:m.size==="card"?"5px":m.size==="thermal"?"9px":"11px",transform:m.size==="card"?"scale(4.2)":m.size==="thermal"?"scale(2.1)":"scale(1.8)",transformOrigin:"center center",overflow:"hidden",padding:m.size==="card"?"1.2mm":m.size==="thermal"?"7px":"12px",borderRadius:"8px",background:"#ffffff",marginTop:"80px"},children:e.jsxs("div",{className:"flex flex-col justify-between h-full",style:{gap:m.size==="card"?"2px":"4px"},children:[e.jsxs("div",{className:"flex flex-col justify-center items-center text-center",style:{flex:1},children:[e.jsxs("div",{className:"font-bold",style:{fontSize:m.size==="card"?"10px":m.size==="thermal"?"18px":"22px",lineHeight:"1.0",marginBottom:m.size==="card"?"0px":"1px",fontWeight:"800",color:"#d32f2f"},children:[b(le.currentPrice||le.price)," so'm"]}),e.jsxs("div",{className:"text-gray-600",style:{fontSize:m.size==="card"?"6px":m.size==="thermal"?"12px":"16px",lineHeight:"1.0",marginBottom:m.size==="card"?"0.5px":"1px",fontWeight:"500",color:"#666"},children:["Kod: ",le.code]}),e.jsx("div",{className:"font-bold text-black",style:{fontSize:m.size==="card"?"7px":m.size==="thermal"?"14px":"18px",lineHeight:"1.1",marginBottom:m.size==="card"?"0.5px":"1px",fontWeight:"600",color:"#1a1a1a",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:m.size==="card"?1:2,WebkitBoxOrient:"vertical"},children:le.name}),m.layout==="standard"&&e.jsxs("div",{className:"text-gray-500",style:{fontSize:m.size==="card"?"4px":m.size==="thermal"?"10px":"12px",lineHeight:"1.0",margin:0,color:"#888",fontWeight:"400"},children:["Miqdor: ",le.quantity," | ",new Date().toLocaleDateString("uz-UZ")]})]}),e.jsx("div",{className:"flex justify-center items-center",style:{width:"100%",height:"auto",padding:"2px 0"},children:e.jsx("div",{style:{border:"1px solid #e2e8f0",borderRadius:"4px",background:"#ffffff",padding:"2px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(At,{value:JSON.stringify({id:le._id,code:le.code,name:le.name,price:le.price}),size:m.size==="card"?60:m.size==="thermal"?120:140,level:"H",includeMargin:!1,style:{width:"100%",height:"100%",maxWidth:m.size==="card"?"60px":m.size==="thermal"?"120px":"140px",maxHeight:m.size==="card"?"60px":m.size==="thermal"?"120px":"140px",objectFit:"contain"}})})})]})})}),m.copies>1&&e.jsxs("p",{className:"text-xs text-surface-500 mt-2 text-center",children:[m.copies," nusxa chop etiladi"]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>be(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsxs("button",{type:"button",onClick:Rs,className:"btn-primary flex-1",disabled:!m.printer,children:[e.jsx(Gs,{className:"w-4 h-4"}),"Print"]})]})]})]}),u&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>re(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:Pe==="add"?"Miqdor qo'shish":"Miqdor ayirish"}),e.jsx("button",{onClick:()=>re(!1),className:"btn-icon-sm",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${Pe==="add"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Hozirgi miqdor"}),e.jsxs("p",{className:`text-2xl font-bold ${Pe==="add"?"text-success-600":"text-danger-600"}`,children:[b(I.quantity||0)," dona"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:Pe==="add"?"Qo'shiladigan miqdor":"Ayiriladigan miqdor"}),e.jsx("input",{type:"text",className:"input text-center text-lg font-semibold",placeholder:"0",value:rs(ge),onChange:d=>Oe(We(d.target.value)),autoFocus:!0})]}),ge&&Number(ge)>0&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Yangi miqdor"}),e.jsxs("p",{className:"text-xl font-bold text-surface-900",children:[b(Pe==="add"?(Number(I.quantity)||0)+Number(ge):Math.max(0,(Number(I.quantity)||0)-Number(ge)))," dona"]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>re(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"button",onClick:Ns,className:`flex-1 ${Pe==="add"?"btn-success":"btn-danger"}`,disabled:!ge||Number(ge)<=0,children:Pe==="add"?"Qo'shish":"Ayirish"})]})]})]})]}),ae&&is&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in",onClick:()=>Ke(!1),children:e.jsxs("div",{className:"relative max-w-6xl max-h-[90vh] w-full",children:[e.jsx("button",{onClick:()=>Ke(!1),className:"absolute -top-12 right-0 sm:right-0 w-10 h-10 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white transition-colors z-10",title:"Yopish (Esc)",children:e.jsx(Ne,{className:"w-6 h-6"})}),e.jsx("div",{className:"relative bg-white rounded-2xl overflow-hidden shadow-2xl",onClick:d=>d.stopPropagation(),children:e.jsx("img",{src:is,alt:"Mahsulot rasmi",className:"w-full h-auto max-h-[85vh] object-contain"})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-white/80 text-sm",children:"Yopish uchun rasmdan tashqariga bosing yoki ESC tugmasini bosing"})})]})})]})}function gl(){const{showAlert:t,AlertComponent:n}=ws(),[r,h]=s.useState({botToken:"",chatId:"",isEnabled:!1}),[l,w]=s.useState(null),[S,p]=s.useState(null),[q,z]=s.useState(""),[y,k]=s.useState(""),[M,f]=s.useState(!1),[E,c]=s.useState(!1),[R,P]=s.useState(!1);s.useEffect(()=>{C();const F=window.location.origin.replace("5175","3002");k(`${F}/api/telegram/webhook`)},[]);const C=()=>Q(this,null,function*(){try{const F=yield K.get("/telegram/settings");h(F.data),F.data.botToken&&(v(),_())}catch(F){console.error("Error fetching telegram settings:",F)}}),v=()=>Q(this,null,function*(){try{const F=yield K.get("/telegram/bot-info");w(F.data)}catch(F){console.error("Error fetching bot info:",F)}}),_=()=>Q(this,null,function*(){try{const F=yield K.get("/telegram/webhook-info");p(F.data)}catch(F){console.error("Error fetching webhook info:",F)}}),X=()=>Q(this,null,function*(){if(!y.trim()){t("Webhook URL ni kiriting","Xatolik","warning");return}P(!0);try{yield K.post("/telegram/set-webhook",{webhookUrl:y}),t("Webhook muvaffaqiyatli o'rnatildi","Muvaffaqiyat","success"),_()}catch(F){t("Webhook o'rnatishda xatolik","Xatolik","danger")}finally{P(!1)}}),B=()=>Q(this,null,function*(){f(!0);try{yield K.post("/telegram/settings",r),t("Sozlamalar saqlandi","Muvaffaqiyat","success"),r.botToken&&v()}catch(F){t("Sozlamalarni saqlashda xatolik","Xatolik","danger")}finally{f(!1)}}),he=()=>Q(this,null,function*(){if(!q.trim()){t("Test xabarini kiriting","Xatolik","warning");return}c(!0);try{yield K.post("/telegram/test",{message:q}),t("Test xabari yuborildi","Muvaffaqiyat","success"),z("")}catch(F){t("Xabar yuborishda xatolik","Xatolik","danger")}finally{c(!1)}}),pe=()=>{l!=null&&l.username&&(navigator.clipboard.writeText(`@${l.username}`),t("Bot username nusxalandi","Muvaffaqiyat","success"))};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[n,e.jsx(Ks,{title:"Telegram Sozlamalari"}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-4xl mx-auto",children:[l&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(nr,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Bot Ma'lumotlari"}),e.jsx("p",{className:"text-surface-500",children:"Telegram bot holati"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-surface-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Bot nomi"}),e.jsx("p",{className:"font-medium text-surface-900",children:l.first_name})]}),e.jsx("div",{className:"bg-surface-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Username"}),e.jsxs("p",{className:"font-medium text-surface-900",children:["@",l.username]})]}),e.jsx("button",{onClick:pe,className:"btn-icon-sm hover:bg-surface-200",title:"Nusxalash",children:e.jsx(wa,{className:"w-4 h-4"})})]})})]}),e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Js,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-green-700 font-medium",children:"Bot faol"})]})})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-6",children:"Telegram Sozlamalari"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Bot Token"}),e.jsx("input",{type:"password",className:"input",placeholder:"Bot tokenini kiriting",value:r.botToken,onChange:F=>h(j(g({},r),{botToken:F.target.value}))}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"@BotFather dan olingan bot token"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Chat ID yoki Kanal Username"}),e.jsx("input",{type:"text",className:"input",placeholder:"@channel_name yoki -100xxxxxxxxx",value:r.chatId,onChange:F=>h(j(g({},r),{chatId:F.target.value}))}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Xabarlar yuboriladigan kanal yoki guruh"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"telegram-enabled",className:"w-4 h-4 text-brand-600 border-surface-300 rounded focus:ring-brand-500",checked:r.isEnabled,onChange:F=>h(j(g({},r),{isEnabled:F.target.checked}))}),e.jsx("label",{htmlFor:"telegram-enabled",className:"text-sm font-medium text-surface-700",children:"Telegram xabarlarini yoqish"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:B,disabled:M,className:"btn-primary",children:M?e.jsxs(e.Fragment,{children:[e.jsx(As,{className:"w-4 h-4 animate-spin"}),"Saqlanmoqda..."]}):"Saqlash"})})]})]}),l&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(ha,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Webhook Sozlamalari"}),e.jsx("p",{className:"text-surface-500",children:"Mijozlarga chek yuborish uchun"})]})]}),S&&e.jsxs("div",{className:"mb-4 p-3 bg-surface-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-surface-700",children:"Joriy webhook:"}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${S.url?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:S.url?"Faol":"O'rnatilmagan"})]}),S.url&&e.jsx("p",{className:"text-xs text-surface-500 break-all",children:S.url})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Webhook URL"}),e.jsx("input",{type:"text",className:"input",placeholder:"https://your-domain.com/api/telegram/webhook",value:y,onChange:F=>k(F.target.value)}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Server webhook URL manzili"})]}),e.jsx("button",{onClick:X,disabled:R||!y.trim(),className:"btn-secondary",children:R?e.jsxs(e.Fragment,{children:[e.jsx(As,{className:"w-4 h-4 animate-spin"}),"O'rnatilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ha,{className:"w-4 h-4"}),"Webhook O'rnatish"]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(Is,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Mijozlar uchun yo'riqnoma"}),e.jsx("p",{className:"text-surface-500",children:"Cheklar olish uchun"})]})]}),e.jsxs("div",{className:"space-y-4 text-sm text-surface-600",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Mijozlar qanday qilib chek oladi:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-4 text-blue-800",children:[e.jsxs("li",{children:["Telegram da ",e.jsxs("strong",{children:["@",(l==null?void 0:l.username)||"your_bot"]})," botini topish"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"/start"})," buyrug'ini yuborish"]}),e.jsx("li",{children:"Telefon raqamini yuborish (masalan: +998901234567)"}),e.jsx("li",{children:"Ro'yxatdan o'tgandan keyin barcha cheklar avtomatik keladi"})]})]}),e.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[e.jsx("h4",{className:"font-medium text-amber-900 mb-2",children:"Muhim:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4 text-amber-800",children:[e.jsx("li",{children:"Mijoz avval botga /start berishi kerak"}),e.jsx("li",{children:"Telefon raqam bazada mavjud bo'lishi kerak"}),e.jsx("li",{children:"Webhook to'g'ri sozlangan bo'lishi kerak"})]})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-6",children:"Test Xabar"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Test xabari"}),e.jsx("textarea",{className:"input",rows:3,placeholder:"Test xabarini kiriting...",value:q,onChange:F=>z(F.target.value)})]}),e.jsx("button",{onClick:he,disabled:E||!r.botToken||!r.chatId,className:"btn-secondary",children:E?e.jsxs(e.Fragment,{children:[e.jsx(As,{className:"w-4 h-4 animate-spin"}),"Yuborilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ka,{className:"w-4 h-4"}),"Test Xabar Yuborish"]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-4",children:"Sozlash Yo'riqnomasi"}),e.jsxs("div",{className:"space-y-4 text-sm text-surface-600",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"1. Bot yaratish:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Telegram da @BotFather ga murojaat qiling"}),e.jsx("li",{children:"/newbot buyrug'ini yuboring"}),e.jsx("li",{children:"Bot nomini va username ni kiriting"}),e.jsx("li",{children:"Olingan tokenni yuqoridagi maydonga kiriting"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"2. Kanal/Guruh sozlash:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Telegram da kanal yoki guruh yarating"}),e.jsx("li",{children:"Botni kanalga admin qilib qo'shing"}),e.jsx("li",{children:"Kanal username ini (@channel_name) yoki Chat ID ni kiriting"}),e.jsx("li",{children:"Barcha xodimlar kanalga obuna bo'lsin"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"3. Mijozlarga chek yuborish:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Webhook URL ni to'g'ri o'rnating"}),e.jsx("li",{children:"Mijozlar botga /start berib ro'yxatdan o'tsin"}),e.jsx("li",{children:"Kassa panelida mijoz tanlanganda chek avtomatik yuboriladi"}),e.jsx("li",{children:"Faqat ro'yxatdan o'tgan mijozlarga chek boradi"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"4. Xabar turlari:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Xarid cheklari (mijozlarga shaxsiy)"}),e.jsx("li",{children:"Yangi qarz qo'shilganda (admin kanaliga)"}),e.jsx("li",{children:"Qarz tasdiqlanganda (admin kanaliga)"}),e.jsx("li",{children:"To'lov qilinganida (admin kanaliga)"}),e.jsx("li",{children:"Kam qolgan mahsulotlar haqida (admin kanaliga)"})]})]})]})]})]})]})}function bl(){const{showAlert:t,AlertComponent:n}=ws(),{user:r,updateUser:h}=Zs(),[l,w]=s.useState(!1),[S,p]=s.useState(!1),[q,z]=s.useState(!1),[y,k]=s.useState([]),[M,f]=s.useState(!1),[E,c]=s.useState(!1),[R,P]=s.useState(null),[C,v]=s.useState({name:"",login:"",password:""}),[_,X]=s.useState(!1),[B,he]=s.useState({currentPassword:"",newLogin:(r==null?void 0:r.login)||"",newPassword:"",confirmPassword:""});s.useEffect(()=>{pe()},[]);const pe=()=>Q(this,null,function*(){try{f(!0);const te=yield K.get("/auth/admin/kassa-users");te.data.success&&k(te.data.users)}catch(te){console.error("Load kassa users error:",te)}finally{f(!1)}}),F=te=>Q(this,null,function*(){var D,xe;if(te.preventDefault(),!C.name||!C.login){t("Barcha maydonlarni to'ldiring","Xatolik","danger");return}if(!R&&!C.password){t("Parolni kiriting","Xatolik","danger");return}if(C.password&&C.password.length<4){t("Parol kamida 4 ta belgidan iborat bo'lishi kerak","Xatolik","danger");return}w(!0);try{R?(yield K.put(`/auth/admin/kassa-users/${R._id}`,C)).data.success&&(t("Kassa foydalanuvchisi muvaffaqiyatli o'zgartirildi","Muvaffaqiyat","success"),pe(),Te()):(yield K.post("/auth/admin/kassa-users",C)).data.success&&(t("Kassa foydalanuvchisi muvaffaqiyatli yaratildi","Muvaffaqiyat","success"),pe(),Te())}catch(I){console.error("Kassa user submit error:",I);const fe=((xe=(D=I.response)==null?void 0:D.data)==null?void 0:xe.message)||"Xatolik yuz berdi";t(fe,"Xatolik","danger")}finally{w(!1)}}),be=te=>Q(this,null,function*(){var D,xe;if(confirm("Rostdan ham bu kassa foydalanuvchisini o'chirmoqchimisiz?")){w(!0);try{(yield K.delete(`/auth/admin/kassa-users/${te}`)).data.success&&(t("Kassa foydalanuvchisi muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),pe())}catch(I){console.error("Delete kassa user error:",I);const fe=((xe=(D=I.response)==null?void 0:D.data)==null?void 0:xe.message)||"O'chirishda xatolik";t(fe,"Xatolik","danger")}finally{w(!1)}}}),le=te=>{te?(P(te),v({name:te.name,login:te.login,password:""})):(P(null),v({name:"",login:"",password:""})),c(!0)},Te=()=>{c(!1),P(null),v({name:"",login:"",password:""}),X(!1)},W=te=>Q(this,null,function*(){var D,xe,I;if(te.preventDefault(),!B.currentPassword){t("Joriy parolni kiriting","Xatolik","danger");return}if(!B.newLogin){t("Yangi loginni kiriting","Xatolik","danger");return}if(B.newPassword&&B.newPassword!==B.confirmPassword){t("Yangi parollar mos kelmadi","Xatolik","danger");return}if(B.newPassword&&B.newPassword.length<6){t("Parol kamida 6 ta belgidan iborat bo'lishi kerak","Xatolik","danger");return}w(!0),console.log("ðŸ” Admin credentials update - Frontend"),console.log("   Current Password:",B.currentPassword?"***":"empty"),console.log("   New Login:",B.newLogin),console.log("   New Password:",B.newPassword?"***":"empty");try{console.log("ðŸ“¤ Sending request to /auth/admin/credentials");const fe=yield K.put("/auth/admin/credentials",{currentPassword:B.currentPassword,newLogin:B.newLogin,newPassword:B.newPassword||void 0});console.log("ðŸ“¥ Response received:",fe.data),fe.data.success&&(console.log("âœ… Success response"),fe.data.token&&(console.log("ðŸ’¾ Saving new token to localStorage"),localStorage.setItem("token",fe.data.token),console.log("âœ… Token saved")),fe.data.user&&(console.log("ðŸ‘¤ Updating user context:",fe.data.user),h(fe.data.user),console.log("âœ… User context updated")),t("Login va parol muvaffaqiyatli o'zgartirildi","Muvaffaqiyat","success"),he({currentPassword:"",newLogin:fe.data.user.login,newPassword:"",confirmPassword:""}),console.log("âœ… Form cleared"))}catch(fe){console.error("âŒ Admin credentials update error:",fe),console.error("   Error response:",(D=fe.response)==null?void 0:D.data);const ve=((I=(xe=fe.response)==null?void 0:xe.data)==null?void 0:I.message)||"Login va parolni o'zgartirishda xatolik";t(ve,"Xatolik","danger")}finally{w(!1)}});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-blue-100/30 to-slate-100",children:[e.jsx(Ks,{title:"Admin Sozlamalari"}),n,e.jsx("div",{className:"p-3 sm:p-4 md:p-6 max-w-6xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 md:gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-5 md:p-6 mb-3 sm:mb-4 md:mb-6 border border-slate-200",children:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-xl sm:rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(Vs,{className:"w-6 h-6 sm:w-7 sm:h-7 md:w-8 md:h-8 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-slate-900 truncate",children:"Admin Sozlamalari"}),e.jsx("p",{className:"text-xs sm:text-sm md:text-base text-slate-600 mt-0.5 sm:mt-1 truncate",children:"Login va parolni o'zgartirish"})]})]})}),e.jsx("form",{onSubmit:W,className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-5 md:p-6 border border-slate-200",children:e.jsxs("div",{className:"space-y-4 sm:space-y-5 md:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2",children:e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx(vs,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),"Joriy Parol *"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:S?"text":"password",value:B.currentPassword,onChange:te=>he(j(g({},B),{currentPassword:te.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 pr-10 sm:pr-12 border border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Joriy parolni kiriting",required:!0}),e.jsx("button",{type:"button",onClick:()=>p(!S),className:"absolute right-2.5 sm:right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 p-1",children:S?e.jsx(rt,{className:"w-4 h-4 sm:w-5 sm:h-5"}):e.jsx(Ds,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),e.jsx("div",{className:"border-t border-slate-200 pt-4 sm:pt-5 md:pt-6",children:e.jsxs("h4",{className:"text-xs sm:text-sm font-bold text-slate-700 mb-3 sm:mb-4 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(ir,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),"Yangi Ma'lumotlar"]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2",children:"Yangi Login *"}),e.jsx("input",{type:"text",value:B.newLogin,onChange:te=>he(j(g({},B),{newLogin:te.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Yangi loginni kiriting",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2",children:"Yangi Parol (ixtiyoriy)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:q?"text":"password",value:B.newPassword,onChange:te=>he(j(g({},B),{newPassword:te.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 pr-10 sm:pr-12 border border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Yangi parolni kiriting (ixtiyoriy)",minLength:6}),e.jsx("button",{type:"button",onClick:()=>z(!q),className:"absolute right-2.5 sm:right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 p-1",children:q?e.jsx(rt,{className:"w-4 h-4 sm:w-5 sm:h-5"}):e.jsx(Ds,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Kamida 6 ta belgi. Bo'sh qoldiring agar parolni o'zgartirmoqchi bo'lmasangiz."})]}),B.newPassword&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2",children:"Yangi Parolni Tasdiqlash *"}),e.jsx("input",{type:q?"text":"password",value:B.confirmPassword,onChange:te=>he(j(g({},B),{confirmPassword:te.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Yangi parolni qayta kiriting",required:!0})]}),e.jsx("button",{type:"submit",disabled:l,className:"w-full py-3 sm:py-3.5 md:py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg sm:rounded-xl text-sm sm:text-base font-bold hover:from-blue-600 hover:to-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Saqlanmoqda..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ut,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"O'zgarishlarni Saqlash"})]})})]})}),e.jsxs("div",{className:"mt-3 sm:mt-4 md:mt-6 bg-yellow-50 border border-yellow-200 rounded-xl sm:rounded-2xl p-4 sm:p-5 md:p-6",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-bold text-yellow-900 mb-2 sm:mb-3 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(Vs,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),"Xavfsizlik Maslahatlari"]}),e.jsxs("ul",{className:"space-y-1.5 sm:space-y-2 text-xs sm:text-sm text-yellow-800",children:[e.jsxs("li",{className:"flex items-start gap-1.5 sm:gap-2",children:[e.jsx("span",{className:"text-yellow-600 mt-0.5 flex-shrink-0",children:"â€¢"}),e.jsx("span",{children:"Parolni hech kimga bermang"})]}),e.jsxs("li",{className:"flex items-start gap-1.5 sm:gap-2",children:[e.jsx("span",{className:"text-yellow-600 mt-0.5 flex-shrink-0",children:"â€¢"}),e.jsx("span",{children:"Kuchli parol ishlating (harflar, raqamlar, belgilar)"})]}),e.jsxs("li",{className:"flex items-start gap-1.5 sm:gap-2",children:[e.jsx("span",{className:"text-yellow-600 mt-0.5 flex-shrink-0",children:"â€¢"}),e.jsx("span",{children:"Parolni muntazam o'zgartiring"})]}),e.jsxs("li",{className:"flex items-start gap-1.5 sm:gap-2",children:[e.jsx("span",{className:"text-yellow-600 mt-0.5 flex-shrink-0",children:"â€¢"}),e.jsx("span",{children:"Login va parolni xavfsiz joyda saqlang"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-5 md:p-6 mb-3 sm:mb-4 md:mb-6 border border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 md:gap-4 min-w-0 flex-1",children:[e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-xl sm:rounded-2xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(Is,{className:"w-6 h-6 sm:w-7 sm:h-7 md:w-8 md:h-8 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-base sm:text-lg md:text-2xl font-bold text-slate-900 truncate",children:"Kassa Foydalanuvchilari"}),e.jsx("p",{className:"text-xs sm:text-sm md:text-base text-slate-600 mt-0.5 sm:mt-1 truncate",children:"Kassa login va parollarini boshqarish"})]})]}),e.jsxs("button",{onClick:()=>le(),className:"px-2.5 sm:px-3 md:px-4 py-1.5 sm:py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg sm:rounded-xl text-xs sm:text-sm md:text-base font-bold hover:from-green-600 hover:to-green-700 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-1 sm:gap-1.5 md:gap-2 flex-shrink-0",children:[e.jsx(ms,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-5 md:h-5"}),e.jsx("span",{className:"hidden xs:inline",children:"Yangi"})]})]})}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:M?e.jsx("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-6 sm:p-8 border border-slate-200 flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 border-4 border-green-500 border-t-transparent rounded-full animate-spin"})}):y.length===0?e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-6 sm:p-8 border border-slate-200 text-center",children:[e.jsx(Is,{className:"w-12 h-12 sm:w-16 sm:h-16 text-slate-300 mx-auto mb-3 sm:mb-4"}),e.jsx("p",{className:"text-sm sm:text-base text-slate-600 font-medium",children:"Hozircha kassa foydalanuvchilari yo'q"}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500 mt-1.5 sm:mt-2",children:`Yangi kassa foydalanuvchisi qo'shish uchun "Yangi" tugmasini bosing`})]}):y.map(te=>e.jsx("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-5 md:p-6 border border-slate-200 hover:shadow-xl transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2 sm:mb-3",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-lg sm:rounded-xl bg-gradient-to-br from-green-400 to-green-500 flex items-center justify-center shadow-md flex-shrink-0",children:e.jsx(ls,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-slate-900 truncate",children:te.name}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500",children:new Date(te.createdAt).toLocaleDateString("uz-UZ")})]})]}),e.jsx("div",{className:"bg-slate-50 rounded-lg sm:rounded-xl p-2.5 sm:p-3 border border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs sm:text-sm text-slate-600 font-medium",children:"Login:"}),e.jsx("span",{className:"text-xs sm:text-sm text-slate-900 font-bold truncate",children:te.login})]})})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 sm:gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>le(te),className:"p-1.5 sm:p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors",title:"O'zgartirish",children:e.jsx(or,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:()=>be(te._id),className:"p-1.5 sm:p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors",title:"O'chirish",children:e.jsx(zs,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]})},te._id))})]})]})}),E&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-3 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-green-500 to-green-600 p-4 sm:p-5 md:p-6 rounded-t-xl sm:rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h3",{className:"text-base sm:text-lg md:text-xl font-bold text-white truncate",children:R?"Kassa Foydalanuvchisini O'zgartirish":"Yangi Kassa Foydalanuvchisi"}),e.jsx("button",{onClick:Te,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-lg p-1.5 sm:p-2 transition-colors flex-shrink-0",children:e.jsx(Ne,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]})}),e.jsxs("form",{onSubmit:F,className:"p-4 sm:p-5 md:p-6 space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2",children:"Ism *"}),e.jsx("input",{type:"text",value:C.name,onChange:te=>v(j(g({},C),{name:te.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ism kiriting",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2",children:"Login *"}),e.jsx("input",{type:"text",value:C.login,onChange:te=>v(j(g({},C),{login:te.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Login kiriting",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 mb-1.5 sm:mb-2 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(vs,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-green-600"}),e.jsxs("span",{className:"truncate",children:["Parol ",R?"(ixtiyoriy - o'zgartirish uchun)":"*"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:_?"text":"password",value:C.password,onChange:te=>v(j(g({},C),{password:te.target.value})),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 pr-10 sm:pr-12 border-2 border-slate-300 rounded-lg sm:rounded-xl text-sm sm:text-base focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:R?"Yangi parol kiriting (o'zgartirish uchun)":"Parol kiriting",required:!R,minLength:4}),e.jsx("button",{type:"button",onClick:()=>X(!_),className:"absolute right-2.5 sm:right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 p-1",children:_?e.jsx(rt,{className:"w-4 h-4 sm:w-5 sm:h-5"}):e.jsx(Ds,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),R?e.jsx("div",{className:"mt-2 p-2.5 sm:p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700 font-medium flex items-start gap-1.5 sm:gap-2",children:[e.jsx(Vs,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Parolni o'zgartirish uchun yangi parol kiriting. Bo'sh qoldiring agar parolni o'zgartirmoqchi bo'lmasangiz."})]})}):e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Kamida 4 ta belgi. Kassa panelga kirish uchun ishlatiladi."})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 pt-2 sm:pt-4",children:[e.jsx("button",{type:"button",onClick:Te,className:"flex-1 py-2.5 sm:py-3 bg-slate-200 text-slate-700 rounded-lg sm:rounded-xl text-sm sm:text-base font-bold hover:bg-slate-300 transition-colors",children:"Bekor qilish"}),e.jsx("button",{type:"submit",disabled:l,className:"flex-1 py-2.5 sm:py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg sm:rounded-xl text-sm sm:text-base font-bold hover:from-green-600 hover:to-green-700 transition-all duration-300 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1.5 sm:gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Saqlanmoqda..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ut,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{children:"Saqlash"})]})})]})]})]})})]})}function jl(){const[t,n]=s.useState(""),[r,h]=s.useState(""),[l,w]=s.useState(!1),[S,p]=s.useState(""),[q,z]=s.useState(!1),y=_s(),k=M=>Q(this,null,function*(){M.preventDefault(),p(""),z(!0);try{const f=yield K.post("/kassa-auth/login",{username:t.trim(),password:r});if(f.data.success){f.data.token&&localStorage.setItem("token",f.data.token);const E={loggedIn:!0,timestamp:Date.now(),user:"kassa",username:f.data.data.username,sessionToken:f.data.data.sessionToken,expiresAt:f.data.data.expiresAt,locked:!0};localStorage.setItem("kassaLoggedIn",JSON.stringify(E)),window.history.replaceState(null,"","/kassa"),y("/kassa",{replace:!0})}else p(f.data.message||"Login yoki parol noto'g'ri")}catch(f){console.error("Login error:",f),p("Login yoki parol noto'g'ri")}finally{z(!1)}});return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(109, 40, 217, 0.15) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute top-1/4 right-1/4 w-64 h-64 rounded-full blur-2xl",style:{background:"radial-gradient(circle, rgba(6, 182, 212, 0.1) 0%, transparent 70%)"}})]}),e.jsxs("div",{className:"w-full max-w-sm relative z-10",children:[e.jsxs("div",{className:"text-center mb-6 animate-fade-up",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-4",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 8px 32px -8px rgba(6, 182, 212, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:e.jsx(Sa,{className:"w-10 h-10 text-white"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-7 h-7 rounded-full flex items-center justify-center",style:{background:"linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",boxShadow:"0 2px 8px -2px rgba(34, 197, 94, 0.5)"},children:e.jsx(Vs,{className:"w-3.5 h-3.5 text-white"})})]}),e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{background:"linear-gradient(135deg, #2e1065 0%, #5b21b6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Kassa Tizimi"}),e.jsx("p",{className:"font-medium",style:{color:"#71717a"},children:"Sardor Furnitura - Kassa Paneli"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full animate-pulse",style:{background:"#22c55e"}}),e.jsx("span",{className:"text-sm",style:{color:"#a1a1aa"},children:"Xavfsiz tizim"})]})]}),e.jsxs("div",{className:"rounded-2xl p-6 animate-fade-up",style:{background:"linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 20px 40px -12px rgba(109, 40, 217, 0.2)",backdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-1",style:{color:"#2e1065"},children:"Kassa tizimiga kirish"}),e.jsx("p",{style:{color:"#71717a"},children:"Hisobingiz bilan tizimga kiring"})]}),S&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)",border:"1px solid #fca5a5"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#ef4444"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#991b1b"},children:"Xatolik"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#b91c1c"},children:S})]})]})}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(Ls,{className:"w-3.5 h-3.5"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ls,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:"text",placeholder:"Login",value:t,onChange:M=>n(M.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(vs,{className:"w-3.5 h-3.5"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(vs,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:l?"text":"password",placeholder:"Parol",value:r,onChange:M=>h(M.target.value),className:"w-full pl-10 pr-10 py-3 rounded-xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0}),e.jsx("button",{type:"button",onClick:()=>w(!l),className:"absolute inset-y-0 right-0 pr-3 flex items-center transition-colors",style:{color:"#a1a1aa"},children:l?e.jsx(rt,{className:"w-4 h-4"}):e.jsx(Ds,{className:"w-4 h-4"})})]})]}),e.jsx("button",{type:"submit",disabled:q,className:"w-full text-white font-semibold py-3.5 px-4 rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 14px -2px rgba(6, 182, 212, 0.4)"},children:q?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Kirish..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Kirish"}),e.jsx(aa,{className:"w-4 h-4 transition-transform group-hover:translate-x-1"})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"pt-4",style:{borderTop:"1px solid #ede9fe"},children:e.jsxs("div",{className:"rounded-xl p-4 mb-4",style:{background:"linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%)"},children:[e.jsx("p",{className:"font-medium text-sm mb-3",style:{color:"#5b21b6"},children:"Admin uchun:"}),e.jsx("a",{href:"/login",className:"inline-flex items-center justify-center gap-2 font-semibold transition-colors text-base underline decoration-2 underline-offset-4",style:{color:"#7c3aed"},children:e.jsx("span",{children:"Admin panel â†’"})})]})})})})]}),e.jsxs("div",{className:"text-center mt-6 animate-fade-up",children:[e.jsx("p",{className:"text-sm",style:{color:"#71717a"},children:"Â© 2025 Sardor Furnitura. Barcha huquqlar himoyalangan."}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-2 text-xs",style:{color:"#a1a1aa"},children:[e.jsx("span",{children:"Xavfsiz"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Professional"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Ishonchli"})]})]})]})]})}const vl="http://localhost:8000/api",wl=(t,n)=>{const r={dona:{single:"dona",plural:"dona"},metr:{single:"metr",plural:"metr"},rulon:{single:"rulon",plural:"rulon"},karobka:{single:"quti",plural:"quti"},gram:{single:"gram",plural:"gram"},kg:{single:"kg",plural:"kg"},litr:{single:"litr",plural:"litr"}};return(r[t||"dona"]||r.dona).single};function Nl(){var E,c,R;const{id:t}=cr(),n=_s(),[r,h]=s.useState(null),[l,w]=s.useState(!0),[S,p]=s.useState(""),[q,z]=s.useState(!1);s.useEffect(()=>{t&&y()},[t]),s.useEffect(()=>(q?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[q]);const y=()=>Q(this,null,function*(){var P,C;try{const v=yield Ca.get(`${vl}/products/public/${t}`);h(v.data)}catch(v){console.error("Error fetching product:",v),p(((C=(P=v.response)==null?void 0:P.data)==null?void 0:C.message)||"Mahsulot topilmadi")}finally{w(!1)}}),k=[{icon:la,label:"Bosh sahifa",path:"/"},{icon:st,label:"Mahsulotlar",path:"/admin/products"},{icon:us,label:"Kassa",path:"/admin/kassa"},{icon:Is,label:"Mijozlar",path:"/admin/customers"},{icon:Hs,label:"Qarzlar",path:"/admin/debts"},{icon:ea,label:"Omborlar",path:"/admin/warehouses"},{icon:na,label:"Hodimlar",path:"/admin/helpers"},{icon:Dt,label:"Statistika",path:"/admin/dashboard"},{icon:ht,label:"QR Scanner",path:"/helper/scanner"},{icon:zt,label:"Sozlamalar",path:"/admin/settings"}];if(l)return e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-brand-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-surface-600",children:"Yuklanmoqda..."})]})});if(S||!r)return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-surface-100 to-surface-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-red-100 to-red-200 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx(Fe,{className:"w-12 h-12 text-red-500"})}),e.jsx("h1",{className:"text-2xl font-bold text-surface-900 mb-3",children:"Mahsulot topilmadi"}),e.jsx("p",{className:"text-surface-500 mb-8",children:S||"Bu mahsulot mavjud emas yoki o'chirilgan"}),e.jsx("button",{onClick:()=>n("/"),className:"px-8 py-3.5 bg-gradient-to-r from-brand-500 to-brand-600 text-white rounded-2xl font-semibold hover:from-brand-600 hover:to-brand-700 transition-all shadow-lg shadow-brand-500/30",children:"Bosh sahifaga qaytish"})]})});const M=r.tierPrices&&(r.tierPrices.tier1||r.tierPrices.tier2||r.tierPrices.tier3),f=wl(r.unit);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-surface-100 to-white",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-lg border-b border-surface-200/50 sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-3 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>n(-1),className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center hover:bg-surface-200 transition-colors active:scale-95",children:e.jsx(Na,{className:"w-5 h-5 text-surface-700"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-base font-semibold text-surface-900 truncate",children:r.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",r.code]})]}),e.jsx("button",{onClick:()=>z(!0),className:"w-10 h-10 bg-brand-500 rounded-xl flex items-center justify-center hover:bg-brand-600 transition-colors active:scale-95 shadow-lg shadow-brand-500/30",children:e.jsx(Pt,{className:"w-5 h-5 text-white"})})]})}),q&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] transition-opacity",onClick:()=>z(!1)}),e.jsxs("div",{className:"fixed top-0 right-0 bottom-0 w-80 max-w-[85vw] bg-white z-[100] shadow-2xl transform transition-transform",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-black text-white",children:"SF"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-brand-100 text-xs",children:"Mebel furniturasi"})]})]}),e.jsx("button",{onClick:()=>z(!1),className:"w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center hover:bg-white/30 transition-colors",children:e.jsx(Ne,{className:"w-5 h-5 text-white"})})]})}),e.jsxs("div",{className:"overflow-y-auto h-[calc(100vh-140px)] p-4",children:[e.jsx("div",{className:"space-y-1",children:k.map((P,C)=>{const v=P.icon;return e.jsxs("button",{onClick:()=>{n(P.path),z(!1)},className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-surface-50 transition-colors group",children:[e.jsx("div",{className:"w-11 h-11 bg-surface-100 rounded-xl flex items-center justify-center group-hover:bg-brand-50 group-hover:scale-110 transition-all",children:e.jsx(v,{className:"w-5 h-5 text-surface-600 group-hover:text-brand-600"})}),e.jsx("span",{className:"font-medium text-surface-900 group-hover:text-brand-600 transition-colors",children:P.label}),e.jsx(Vt,{className:"w-4 h-4 text-surface-300 ml-auto group-hover:text-brand-600 group-hover:translate-x-1 transition-all"})]},C)})}),e.jsxs("div",{className:"mt-6 p-4 bg-surface-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-surface-500 text-center mb-2",children:"QR kod orqali ko'rilmoqda"}),e.jsx("p",{className:"text-xs text-surface-400 text-center",children:new Date().toLocaleDateString("uz-UZ",{year:"numeric",month:"long",day:"numeric"})})]})]})]})]}),e.jsxs("div",{className:"max-w-lg mx-auto pb-8",children:[e.jsxs("div",{className:"relative",children:[r.images&&r.images.length>0?e.jsx("div",{className:"aspect-square bg-white",children:e.jsx("img",{src:`${Ps}${typeof r.images[0]=="string"?r.images[0]:r.images[0].path}`,alt:r.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-square bg-gradient-to-br from-brand-50 via-brand-100 to-indigo-100 flex items-center justify-center",children:e.jsx("div",{className:"w-24 h-24 bg-white/60 backdrop-blur rounded-3xl flex items-center justify-center shadow-xl",children:e.jsx(Fe,{className:"w-12 h-12 text-brand-500"})})}),e.jsx("div",{className:`absolute top-4 right-4 px-4 py-2 rounded-full text-sm font-bold shadow-lg ${r.quantity>10?"bg-gradient-to-r from-emerald-400 to-green-500 text-white":r.quantity>0?"bg-gradient-to-r from-amber-400 to-orange-400 text-white":"bg-gradient-to-r from-red-500 to-rose-500 text-white"}`,children:r.quantity>0?`âœ“ ${r.quantity} ${f} mavjud`:"âœ• Tugagan"})]}),e.jsxs("div",{className:"px-4 -mt-6 relative z-10 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-xl shadow-surface-200/50",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-surface-900 mb-1",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"px-2.5 py-1 bg-surface-100 rounded-lg text-xs font-mono text-surface-600",children:["#",r.code]}),e.jsx("span",{className:"px-2.5 py-1 bg-brand-50 text-brand-600 rounded-lg text-xs font-medium",children:f}),r.dimensions&&(r.dimensions.width||r.dimensions.height||r.dimensions.length)&&e.jsxs("span",{className:"px-2.5 py-1 bg-purple-50 text-purple-600 rounded-lg text-xs font-medium",children:["ðŸ“ ",[r.dimensions.width,r.dimensions.height,r.dimensions.length].filter(Boolean).join(" Ã— ")]})]}),r.description&&e.jsx("p",{className:"mt-3 text-sm text-surface-600 leading-relaxed",children:r.description})]}),e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 rounded-2xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-brand-100 text-sm mb-1",children:"Narxi"}),e.jsx("p",{className:"text-3xl font-black text-white",children:b(r.price)})]}),e.jsxs("span",{className:"text-brand-100 text-lg font-medium",children:["so'm/",f]})]})}),M&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center",children:e.jsx(dr,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"font-bold text-surface-900",children:"Chegirmali narxlar"})]}),e.jsxs("div",{className:"space-y-2",children:[((E=r.tierPrices)==null?void 0:E.tier1)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-emerald-50 to-green-50 rounded-xl border border-emerald-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center",children:e.jsx(Rt,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[r.tierPrices.tier1.minQuantity,"â€“",r.tierPrices.tier1.maxQuantity," ",f]}),e.jsxs("p",{className:"text-xs text-emerald-600 font-medium",children:[r.tierPrices.tier1.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-emerald-600",children:b(r.tierPrices.tier1.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",f]})]})]}),((c=r.tierPrices)==null?void 0:c.tier2)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(Rt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[r.tierPrices.tier2.minQuantity,"â€“",r.tierPrices.tier2.maxQuantity," ",f]}),e.jsxs("p",{className:"text-xs text-blue-600 font-medium",children:[r.tierPrices.tier2.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-blue-600",children:b(r.tierPrices.tier2.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",f]})]})]}),((R=r.tierPrices)==null?void 0:R.tier3)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-violet-50 rounded-xl border border-purple-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(Rt,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[r.tierPrices.tier3.minQuantity,"+ ",f]}),e.jsxs("p",{className:"text-xs text-purple-600 font-medium",children:[r.tierPrices.tier3.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-purple-600",children:b(r.tierPrices.tier3.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",f]})]})]})]}),e.jsx("p",{className:"mt-3 text-xs text-surface-400 text-center",children:"ðŸ’¡ Ko'proq olsangiz, arzonroq!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-surface-50 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-400 mb-1",children:[e.jsx(mr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"O'lchov"})]}),e.jsx("p",{className:"font-bold text-surface-900",children:f})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-400 mb-1",children:[e.jsx(xr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Kod"})]}),e.jsx("p",{className:"font-bold text-surface-900 font-mono",children:r.code})]})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-lg shadow-surface-200/30",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand-500 to-brand-600 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-500/30",children:e.jsx("span",{className:"text-2xl font-black text-white",children:"SF"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-surface-900 text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-sm text-surface-500",children:"Mebel furniturasi do'koni"})]}),e.jsx(Vt,{className:"w-5 h-5 text-surface-300"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-surface-100 space-y-3",children:[e.jsxs("a",{href:"tel:+998901234567",className:"flex items-center gap-3 text-surface-600 hover:text-brand-600 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(Ls,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"+998 90 123 45 67"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-surface-600",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(Lt,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"Toshkent shahri"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-surface-600",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(xt,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"09:00 - 18:00"})]})]})]}),e.jsxs("p",{className:"text-center text-xs text-surface-400 pt-4",children:["QR kod orqali ko'rilmoqda â€¢ ",new Date().toLocaleDateString("uz-UZ")]})]})]})]})}const yl=(t={})=>{const n=_s(),{threshold:r=80,edgeThreshold:h=30,disableOnInput:l=!0,fullScreenSwipe:w=!0}=t;s.useEffect(()=>{if(!(window.innerWidth<=768||"ontouchstart"in window))return;let p=0,q=0,z=0,y=0,k=!1,M=0;const f=R=>{const P=R.touches[0];if(p=P.clientX,q=P.clientY,z=p,y=q,M=Date.now(),k=!1,l){const C=R.target,v=C.closest('input, textarea, select, input[type="range"]'),_=C.closest('.modal, .overlay, [role="dialog"], .swal2-container, .dialog'),X=C.closest(".no-swipe"),B=C.closest(".overflow-auto, .overflow-scroll, .overflow-y-auto, .overflow-x-auto");if(v||_||X||B&&w&&!(p<=h))return}if(w)k=!0;else{const C=p<=h,v=p>=window.innerWidth-h;k=C||v}},E=R=>{if(!k)return;const P=R.touches[0];z=P.clientX,y=P.clientY;const C=z-p,v=y-q;if(Math.abs(v)>Math.abs(C)*1.5){k=!1;return}C>20&&Math.abs(v)<Math.abs(C)&&R.preventDefault()},c=R=>{if(!k)return;const P=R.changedTouches[0],C=P.clientX,v=P.clientY,_=C-p,X=v-q,B=Date.now()-M;if(Math.abs(X)>Math.abs(_)*1.5||Math.abs(_)<r)return;const pe=Math.abs(_)/B>.3;_>r||pe&&_>r*.6?requestAnimationFrame(()=>{n(-1)}):!w&&p>=window.innerWidth-h&&(_<-r||pe&&_<-r*.6)&&requestAnimationFrame(()=>{n(1)})};return window.addEventListener("touchstart",f,{passive:!0}),window.addEventListener("touchmove",E,{passive:!1}),window.addEventListener("touchend",c,{passive:!0}),()=>{window.removeEventListener("touchstart",f),window.removeEventListener("touchmove",E),window.removeEventListener("touchend",c)}},[n,r,h,l,w])},kl=()=>(yl({threshold:80,edgeThreshold:30,disableOnInput:!0,fullScreenSwipe:!0}),null),Jt=({children:t,roles:n})=>{const{user:r,loading:h}=Zs();return h?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Yuklanmoqda..."})]})}):r?n&&!n.includes(r.role)?e.jsx(tt,{to:"/"}):e.jsx(e.Fragment,{children:t}):e.jsx(tt,{to:"/login"})},Sl=({children:t})=>{const n=_s(),[r,h]=dt.useState(null);return dt.useEffect(()=>{document.body.classList.add("kassa-locked","kassa-protected"),(()=>{try{const y=localStorage.getItem("kassaLoggedIn");if(y){const k=JSON.parse(y);if(k.loggedIn&&k.user==="kassa"){const M=j(g({},k),{timestamp:Date.now()});localStorage.setItem("kassaLoggedIn",JSON.stringify(M)),h(!0),window.history.pushState(null,"",window.location.href);return}}h(!1),n("/kassa-login",{replace:!0})}catch(y){console.error("Kassa login check error:",y),h(!1),n("/kassa-login",{replace:!0})}})();const w=()=>{window.location.pathname.startsWith("/kassa")&&window.history.pushState(null,"",window.location.href)},S=y=>{if(window.location.pathname.startsWith("/kassa")&&!(y.key==="F5"||y.ctrlKey&&(y.key==="r"||y.key==="R"))&&y.key!=="F12"&&(y.altKey&&y.key==="F4"||y.ctrlKey&&y.key==="w"||y.ctrlKey&&y.key==="W"||y.ctrlKey&&y.key==="t"||y.ctrlKey&&y.key==="T"||y.ctrlKey&&y.shiftKey&&y.key==="I"||y.ctrlKey&&y.shiftKey&&y.key==="J"||y.ctrlKey&&y.key==="u"||y.ctrlKey&&y.key==="U"||y.ctrlKey&&y.key==="s"||y.ctrlKey&&y.key==="S"||y.ctrlKey&&y.key==="p"||y.ctrlKey&&y.key==="P"))return y.preventDefault(),y.stopPropagation(),alert("âš ï¸ Bu amal kassa tizimida taqiqlanadi!"),!1},p=y=>{if(window.location.pathname.startsWith("/kassa"))return y.preventDefault(),alert("âš ï¸ O'ng tugma kassa tizimida taqiqlanadi!"),!1},q=()=>{window.location.pathname.startsWith("/kassa")},z=()=>{document.hidden&&setTimeout(()=>{window.focus()},100)};return window.addEventListener("popstate",w),window.addEventListener("keydown",S,!0),window.addEventListener("contextmenu",p),window.addEventListener("beforeunload",q),document.addEventListener("visibilitychange",z),window.focus(),()=>{document.body.classList.remove("kassa-locked","kassa-protected"),window.removeEventListener("popstate",w),window.removeEventListener("keydown",S,!0),window.removeEventListener("contextmenu",p),window.removeEventListener("beforeunload",q),document.removeEventListener("visibilitychange",z)}},[n]),r===null?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Tekshirilmoqda..."})]})}):r?e.jsx(e.Fragment,{children:t}):null},Cl=()=>{const{user:t,loading:n}=Zs(),[r,h]=dt.useState(!0),[l,w]=dt.useState(!1);return dt.useEffect(()=>{Q(Ze,null,function*(){var p;try{const q=new AbortController,z=setTimeout(()=>q.abort(),5e3),y=yield fetch("http://localhost:8000/api/auth/check-admin",{signal:q.signal,headers:{"Content-Type":"application/json"}});if(clearTimeout(z),!y.ok)throw new Error(`HTTP error! status: ${y.status}`);const k=yield y.json();w(k.hasAdmin)}catch(q){console.error("Admin check error:",q),q.name==="AbortError"?console.warn("Admin check timeout - server javob bermadi"):(p=q.message)!=null&&p.includes("Failed to fetch")&&console.warn("Server bilan aloqa yo'q - localhost:8000 ishlamayapti"),w(!0)}finally{h(!1)}})},[]),n||r?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Yuklanmoqda..."})]})}):!l&&!t?e.jsx(tt,{to:"/register"}):t?t.role==="admin"?e.jsx(tt,{to:"/admin"}):t.role==="cashier"?e.jsx(tt,{to:"/kassa"}):e.jsx(tt,{to:"/helper"}):e.jsx(tt,{to:"/login"})};function ql(){return e.jsx(qr,{children:e.jsx(Sr,{children:e.jsxs(ur,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:[e.jsx(kl,{}),e.jsxs(hr,{children:[e.jsx(Ye,{path:"/login",element:e.jsx(Pr,{})}),e.jsx(Ye,{path:"/register",element:e.jsx(zr,{})}),e.jsx(Ye,{path:"/kassa-login",element:e.jsx(jl,{})}),e.jsx(Ye,{path:"/product/:id",element:e.jsx(Nl,{})}),e.jsx(Ye,{path:"/",element:e.jsx(Cl,{})}),e.jsxs(Ye,{path:"/kassa",element:e.jsx(Sl,{children:e.jsx(cl,{})}),children:[e.jsx(Ye,{index:!0,element:e.jsx(xl,{})}),e.jsx(Ye,{path:"receipts",element:e.jsx(ul,{})}),e.jsx(Ye,{path:"clients",element:e.jsx(hl,{})}),e.jsx(Ye,{path:"debts",element:e.jsx(pl,{})}),e.jsx(Ye,{path:"products",element:e.jsx(fl,{})})]}),e.jsxs(Ye,{path:"/admin",element:e.jsx(Jt,{roles:["admin"],children:e.jsx(Rr,{})}),children:[e.jsx(Ye,{index:!0,element:e.jsx(Er,{})}),e.jsx(Ye,{path:"kassa",element:e.jsx(Wt,{})}),e.jsx(Ye,{path:"kassa-pro",element:e.jsx(Wt,{})}),e.jsx(Ye,{path:"products",element:e.jsx(Vr,{})}),e.jsx(Ye,{path:"warehouses",element:e.jsx(Gr,{})}),e.jsx(Ye,{path:"customers",element:e.jsx(Zr,{})}),e.jsx(Ye,{path:"debts",element:e.jsx(fa,{})}),e.jsx(Ye,{path:"debt-approvals",element:e.jsx(el,{})}),e.jsx(Ye,{path:"orders",element:e.jsx(sl,{})}),e.jsx(Ye,{path:"helpers",element:e.jsx(tl,{})}),e.jsx(Ye,{path:"staff-receipts",element:e.jsx(ga,{})}),e.jsx(Ye,{path:"settings",element:e.jsx(bl,{})}),e.jsx(Ye,{path:"telegram-settings",element:e.jsx(gl,{})})]}),e.jsxs(Ye,{path:"/cashier",element:e.jsx(Jt,{roles:["cashier"],children:e.jsx(nl,{})}),children:[e.jsx(Ye,{index:!0,element:e.jsx(Wt,{})}),e.jsx(Ye,{path:"debts",element:e.jsx(fa,{})}),e.jsx(Ye,{path:"staff-receipts",element:e.jsx(ga,{})})]}),e.jsx(Ye,{path:"/helper",element:e.jsx(Jt,{roles:["helper"],children:e.jsx(il,{})}),children:e.jsx(Ye,{index:!0,element:e.jsx(ol,{})})})]})]})})})}pr.createRoot(document.getElementById("root")).render(e.jsx(dt.StrictMode,{children:e.jsx(ql,{})}))});export default Pl();
