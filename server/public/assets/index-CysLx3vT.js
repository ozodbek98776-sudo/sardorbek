const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/qrcode-vendor-DgV9WI2I.js","assets/vendor-CYQBVhcl.js"])))=>i.map(i=>d[i]);
var Ka=Object.defineProperty,Ua=Object.defineProperties;var Xa=Object.getOwnPropertyDescriptors;var pa=Object.getOwnPropertySymbols;var Ha=Object.prototype.hasOwnProperty,Ya=Object.prototype.propertyIsEnumerable;var Yt=(a,o,n)=>o in a?Ka(a,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[o]=n,b=(a,o)=>{for(var n in o||(o={}))Ha.call(o,n)&&Yt(a,n,o[n]);if(pa)for(var n of pa(o))Ya.call(o,n)&&Yt(a,n,o[n]);return a},N=(a,o)=>Ua(a,Xa(o));var Wa=(a,o)=>()=>(o||a((o={exports:{}}).exports,o),o.exports);var Rt=(a,o,n)=>Yt(a,typeof o!="symbol"?o+"":o,n);var Q=(a,o,n)=>new Promise((x,i)=>{var g=q=>{try{h(n.next(q))}catch(P){i(P)}},v=q=>{try{h(n.throw(q))}catch(P){i(P)}},h=q=>q.done?x(q.value):Promise.resolve(q.value).then(g,v);h((n=n.apply(a,o)).next())});import{r as s,j as e,u as Ks,b as lt,U as ms,L as Qs,E as Lt,c as Gs,d as aa,B as Ja,S as qt,P as Fs,M as Tt,X as ge,N as Va,e as rt,f as Pt,g as ya,h as hs,i as Ke,k as Ys,C as Vs,l as ra,m as Xs,O as Ut,n as ka,o as pt,p as fs,H as na,q as et,F as Zs,s as la,t as Vt,D as ds,T as ia,v as Ga,w as Os,x as Gt,y as Za,z as _t,G as xt,I as Rs,J as oa,K as er,Q as Zt,V as ca,W as sr,Y as It,Z as _s,_ as Sa,$ as tr,a0 as Xt,a1 as ys,a2 as nt,a3 as yt,a4 as ar,a5 as Ca,a6 as zt,a7 as St,a8 as fa,a9 as Bt,aa as da,ab as Hs,ac as ea,ad as $t,ae as ut,af as rr,ag as ba,ah as qa,ai as nr,aj as lr,ak as Et,al as ir,am as ma,an as or,ao as Pa,ap as za,aq as cr,ar as st,as as dr,at as mr,au as xr,av as ga,aw as ur,ax as hr,ay as pr,az as fr,aA as br,aB as gr,aC as We,R as dt,aD as tt,aE as jr}from"./react-vendor-C9OrqklL.js";import{a as $a}from"./http-vendor-DnTtldoj.js";import{R as vr,A as Nr,C as wr,X as yr,Y as kr,T as Sr,a as Cr}from"./chart-vendor-Bhh4sXK-.js";import{t as xa,H as qr}from"./qrcode-vendor-DgV9WI2I.js";import{an as Pr}from"./vendor-CYQBVhcl.js";var Qn=Wa(es=>{(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))x(i);new MutationObserver(i=>{for(const g of i)if(g.type==="childList")for(const v of g.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&x(v)}).observe(document,{childList:!0,subtree:!0});function n(i){const g={};return i.integrity&&(g.integrity=i.integrity),i.referrerPolicy&&(g.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?g.credentials="include":i.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function x(i){if(i.ep)return;i.ep=!0;const g=n(i);fetch(i.href,g)}})();const at=class at{constructor(){Rt(this,"isOnline",navigator.onLine);Rt(this,"listeners",new Set);this.setupEventListeners()}static getInstance(){return at.instance||(at.instance=new at),at.instance}setupEventListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.notifyListeners()}),window.addEventListener("offline",()=>{this.isOnline=!1,this.notifyListeners()})}notifyListeners(){this.listeners.forEach(o=>o(this.isOnline))}getOnlineStatus(){return this.isOnline}addListener(o){return this.listeners.add(o),()=>this.listeners.delete(o)}static isServerOfflineError(o){if(!(o!=null&&o.response))return!1;const{status:n,data:x}=o.response;return n===503&&(x==null?void 0:x.offline)===!0}static getOfflineMessage(o){return this.isServerOfflineError(o)?o.response.data.message||"Server is currently offline. Please try again later.":"Network error occurred. Please check your connection."}};Rt(at,"instance");let Ot=at;Ot.getInstance();const ua="/api",zr="https://sardorbek.biznesjon.uz",Ma=ua,Ls=ua.replace("/api",""),ha=zr;console.log("API Base URL:",Ma);console.log("Uploads URL:",Ls);console.log("Environment:","Production");console.log("envApiUrl:",ua);const U=$a.create({baseURL:Ma,headers:{"Content-Type":"application/json"},timeout:6e4});U.interceptors.request.use(a=>{var n;const o=localStorage.getItem("token");return o&&(a.headers.Authorization=`Bearer ${o}`),(n=a.url)!=null&&n.includes("/products")&&(a.timeout=12e4),a.headers["Cache-Control"]="no-cache, no-store, must-revalidate",a.headers.Pragma="no-cache",a.headers.Expires="0",a});U.interceptors.response.use(a=>a,a=>{var o,n,x;return((o=a.response)==null?void 0:o.status)===304?(console.warn("304 Not Modified - cache muammosi, qayta urinish kerak"),Promise.reject(new Error("Cache error - please refresh"))):a.code==="ERR_NETWORK"||a.message==="Network Error"?(console.error("ðŸ”´ Server bilan aloqa yo'q - localhost:8000 ishlamayapti"),Promise.reject(new Error("Server bilan aloqa yo'q. Iltimos, serverni ishga tushiring."))):a.code==="ECONNREFUSED"?(console.error("ðŸ”´ Connection refused - server port 8000 da ishlamayapti"),Promise.reject(new Error("Server ishlamayapti. Iltimos, serverni ishga tushiring."))):Ot.isServerOfflineError(a)?(console.warn("Server is offline:",a.response.data.message),Promise.reject(a)):(((n=a.response)==null?void 0:n.status)===401&&(console.warn("401 Unauthorized - token yaroqsiz"),localStorage.removeItem("token"),window.location.pathname.includes("/login")||(window.location.href="/login")),a.code==="ECONNABORTED"&&console.error("â±ï¸ Request timeout:",(x=a.config)==null?void 0:x.url),Promise.reject(a))});const Ta=s.createContext(void 0),$r=({children:a})=>{const[o,n]=s.useState(null),[x,i]=s.useState(!0);s.useEffect(()=>{localStorage.getItem("token")?((S=3,L=1e3)=>Q(es,null,function*(){var $,C;for(let m=0;m<S;m++)try{const y=yield U.get("/auth/me",{timeout:5e3});n(y.data),i(!1);return}catch(y){if(console.warn(`User fetch attempt ${m+1}/${S} failed:`,y.message),m===S-1||(($=y.response)==null?void 0:$.status)===401||((C=y.response)==null?void 0:C.status)===403){console.error("Failed to fetch user after retries, clearing token"),localStorage.removeItem("token"),i(!1);return}yield new Promise(k=>setTimeout(k,L*(m+1)))}}))():i(!1)},[]);const g=(P,w)=>Q(es,null,function*(){const S=yield U.post("/auth/login",{phone:P,password:w});localStorage.setItem("token",S.data.token),n(S.data.user)}),v=(P,w)=>Q(es,null,function*(){const S=yield U.post("/auth/login",{login:P,password:w});localStorage.setItem("token",S.data.token),n(S.data.user)}),h=()=>{localStorage.removeItem("token"),n(null)},q=P=>{n(P)};return e.jsx(Ta.Provider,{value:{user:o,loading:x,login:g,loginWithCredentials:v,logout:h,updateUser:q},children:a})},it=()=>{const a=s.useContext(Ta);if(!a)throw new Error("useAuth must be used within AuthProvider");return a},Ra=s.createContext(void 0),Mr={uz:{"login.title":"Sardorbek.Furnetura","login.subtitle":"Professional Biznes Boshqaruv Tizimi","login.secure":"Xavfsiz va Ishonchli","login.welcome":"Xush kelibsiz","login.description":"Davom etish uchun hisobingizga kiring","login.phone":"Telefon raqam","login.password":"Parol","login.passwordPlaceholder":"Parolingizni kiriting","login.signing":"Kirilmoqda...","login.signin":"Kirish","login.error":"Kirish xatosi","sidebar.statistics":"Statistika","sidebar.products":"Tovarlar","sidebar.warehouses":"Omborlar","sidebar.customers":"Mijozlar","sidebar.debts":"Qarz daftarcha","sidebar.orders":"Buyurtmalar","sidebar.helpers":"Yordamchilar","sidebar.settings":"Sozlamalar","sidebar.pos":"Kassa (POS)","sidebar.receipts":"Xodimlar cheklari","sidebar.aiAssistant":"AI Yordamchi","sidebar.signout":"Chiqish","sidebar.editProfile":"Profilni tahrirlash","sidebar.fullName":"To'liq ism","sidebar.namePlaceholder":"Ismingizni kiriting","sidebar.phoneNumber":"Telefon raqam","sidebar.newPassword":"Yangi parol (Ixtiyoriy)","sidebar.passwordHint":"Joriy parolni saqlash uchun bo'sh qoldiring","sidebar.cancel":"Bekor qilish","sidebar.saveChanges":"O'zgarishlarni saqlash","dashboard.title":"Statistika paneli","dashboard.overview":"Biznes ko'rsatkichlari","dashboard.description":"Biznesingizning ishlashi va asosiy ko'rsatkichlarini kuzating","dashboard.totalRevenue":"Umumiy daromad","dashboard.todaySales":"Bugungi savdo","dashboard.weeklySales":"Haftalik savdo","dashboard.totalOrders":"Jami buyurtmalar","dashboard.peakHour":"Eng yuqori soat","dashboard.today":"Bugun","dashboard.thisWeek":"Bu hafta","dashboard.refresh":"Ma'lumotlarni yangilash","dashboard.totalProducts":"Jami mahsulotlar","dashboard.lowStock":"Kam qolgan","dashboard.outOfStock":"Tugagan","dashboard.inventoryStatus":"Ombor holati","dashboard.currentStock":"Joriy zaxira ko'rinishi","dashboard.liveData":"Jonli ma'lumotlar","header.search":"Qidirish...","header.live":"Jonli","common.loading":"Yuklanmoqda...","common.error":"Xatolik yuz berdi","common.success":"Muvaffaqiyatli","common.save":"Saqlash","common.cancel":"Bekor qilish","common.delete":"O'chirish","common.edit":"Tahrirlash","common.add":"Qo'shish","common.close":"Yopish"}},Tr=({children:a})=>{const[o,n]=s.useState("uz");s.useEffect(()=>{document.documentElement.lang="uz"},[]);const x=i=>Mr.uz[i]||i;return e.jsx(Ra.Provider,{value:{language:o,setLanguage:n,t:x},children:a})},Ht=()=>{const a=s.useContext(Ra);if(a===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return a};function Rr(){var m;const[a,o]=s.useState(""),[n,x]=s.useState(""),[i,g]=s.useState(!1),[v,h]=s.useState(""),[q,P]=s.useState(!1),{loginWithCredentials:w}=it(),S=Ks(),$=(m=lt().state)==null?void 0:m.message,C=y=>Q(this,null,function*(){var k,j;y.preventDefault(),h(""),P(!0);try{yield w(a,n);const R=(yield U.get("/auth/me")).data;R.role==="admin"?S("/admin",{replace:!0}):R.role==="cashier"?S("/kassa",{replace:!0}):R.role==="helper"?S("/helper",{replace:!0}):S("/",{replace:!0})}catch(f){h(((j=(k=f.response)==null?void 0:k.data)==null?void 0:j.message)||"Login yoki parol noto'g'ri"),P(!1)}});return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(109, 40, 217, 0.15) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute top-1/4 right-1/4 w-64 h-64 rounded-full blur-2xl",style:{background:"radial-gradient(circle, rgba(6, 182, 212, 0.1) 0%, transparent 70%)"}})]}),e.jsxs("div",{className:"w-full max-w-sm relative z-10",children:[e.jsxs("div",{className:"text-center mb-6 animate-fade-up",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{background:"linear-gradient(135deg, #2e1065 0%, #5b21b6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Sardor Furnitura"}),e.jsx("p",{className:"font-medium",style:{color:"#71717a"},children:"Admin boshqaruv tizimi"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full animate-pulse",style:{background:"#22c55e"}}),e.jsx("span",{className:"text-sm",style:{color:"#a1a1aa"},children:"Xavfsiz kirish"})]})]}),e.jsxs("div",{className:"rounded-2xl p-6 animate-fade-up",style:{background:"linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 20px 40px -12px rgba(109, 40, 217, 0.2)",backdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-1",style:{color:"#2e1065"},children:"Xush kelibsiz!"}),e.jsx("p",{style:{color:"#71717a"},children:"Login va parolingizni kiriting"})]}),$&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)",border:"1px solid #86efac"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#22c55e"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"âœ“"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#166534"},children:"Muvaffaqiyat"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#15803d"},children:$})]})]})}),v&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)",border:"1px solid #fca5a5"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#ef4444"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#991b1b"},children:"Xatolik"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#b91c1c"},children:v})]})]})}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ms,{className:"w-3.5 h-3.5"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ms,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:"text",placeholder:"Loginingizni kiriting",value:a,onChange:y=>o(y.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl transition-all duration-200 focus:outline-none text-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(Qs,{className:"w-3.5 h-3.5"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Qs,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:i?"text":"password",placeholder:"Parolingizni kiriting",value:n,onChange:y=>x(y.target.value),className:"w-full pl-10 pr-10 py-3 rounded-xl transition-all duration-200 focus:outline-none text-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0}),e.jsx("button",{type:"button",onClick:()=>g(!i),className:"absolute inset-y-0 right-0 pr-3 flex items-center transition-colors",style:{color:"#a1a1aa"},children:i?e.jsx(Lt,{className:"w-4 h-4"}):e.jsx(Gs,{className:"w-4 h-4"})})]})]}),e.jsx("button",{type:"submit",disabled:q,className:"w-full text-white font-semibold py-3.5 px-4 rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 14px -2px rgba(124, 58, 237, 0.4)"},children:q?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Kirish..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Kirish"}),e.jsx(aa,{className:"w-4 h-4 transition-transform group-hover:translate-x-1"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("div",{className:"p-3 rounded-xl",style:{background:"linear-gradient(135deg, #cffafe 0%, #a5f3fc 100%)",border:"1px solid rgba(6, 182, 212, 0.3)"},children:[e.jsx("p",{className:"text-xs font-medium mb-1",style:{color:"#155e75"},children:"Kassa paneli:"}),e.jsx("button",{onClick:()=>S("/kassa-login"),className:"text-sm font-semibold underline transition-colors",style:{color:"#0891b2"},children:"Kassa tizimiga kirish â†’"})]})})]}),e.jsxs("div",{className:"text-center mt-6 animate-fade-up",children:[e.jsx("p",{className:"text-sm",style:{color:"#71717a"},children:"Â© 2025 Sardor Furnitura. Barcha huquqlar himoyalangan."}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-2 text-xs",style:{color:"#a1a1aa"},children:[e.jsx("span",{children:"Xavfsiz"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Professional"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Ishonchli"})]})]})]})]})}const p=a=>{const o=typeof a=="string"?parseFloat(a):a;return isNaN(o)?"0":o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},Ge=a=>a.replace(/\./g,""),us=a=>{const o=a.replace(/\./g,"");if(o===""||o==="-")return o;const n=parseFloat(o);return isNaN(n)?"":p(n)},ht=a=>{let n=a.replace(/\D/g,"");return!n.startsWith("998")&&n.length>0&&(n="998"+n),n=n.slice(0,12),n.length===0?"":n.length<=3?"+"+n:n.length<=5?"+998 ("+n.slice(3):n.length<=8?"+998 ("+n.slice(3,5)+") "+n.slice(5):n.length<=10?"+998 ("+n.slice(3,5)+") "+n.slice(5,8)+"-"+n.slice(8):"+998 ("+n.slice(3,5)+") "+n.slice(5,8)+"-"+n.slice(8,10)+"-"+n.slice(10)},Dt=a=>a.replace(/\D/g,""),Qa=a=>{if(!a)return"";const o=a.replace(/\D/g,"");return o.length!==12?a:"+998 ("+o.slice(3,5)+") "+o.slice(5,8)+"-"+o.slice(8,10)+"-"+o.slice(10)};function Qr(){const[a,o]=s.useState({name:"",login:"",phone:"",password:"",confirmPassword:""}),[n,x]=s.useState(!1),[i,g]=s.useState(!1),[v,h]=s.useState(""),[q,P]=s.useState(!1),{t:w}=Ht(),S=Ks(),L=C=>{const m=ht(C.target.value);o(y=>N(b({},y),{phone:m}))},$=C=>Q(this,null,function*(){var m,y;if(C.preventDefault(),h(""),P(!0),a.password!==a.confirmPassword){h("Parollar mos kelmaydi"),P(!1);return}if(a.password.length<6){h("Parol kamida 6 ta belgidan iborat bo'lishi kerak"),P(!1);return}try{const k=Dt(a.phone);yield U.post("/auth/register",{name:a.name,login:a.login,phone:k,password:a.password}),S("/login",{state:{message:"Admin muvaffaqiyatli yaratildi! Endi tizimga kirishingiz mumkin."}})}catch(k){h(((y=(m=k.response)==null?void 0:m.data)==null?void 0:y.message)||"Xatolik yuz berdi")}finally{P(!1)}});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 bg-gradient-to-br from-blue-400/20 to-indigo-600/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-indigo-400/20 to-purple-600/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-gradient-to-r from-blue-300/10 to-indigo-400/10 rounded-full blur-2xl"})]}),e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23e2e8f0%22%20fill-opacity%3D%220.3%22%3E%3Ccircle%20cx%3D%2230%22%20cy%3D%2230%22%20r%3D%221.5%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-40"}),e.jsxs("div",{className:"w-full max-w-md relative z-10",children:[e.jsxs("div",{className:"text-center mb-8 animate-fade-up",children:[e.jsxs("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-3xl shadow-2xl shadow-blue-500/25 mb-6 relative",children:[e.jsx(Ja,{className:"w-10 h-10 text-white"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center",children:e.jsx(qt,{className:"w-3 h-3 text-white"})})]}),e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-slate-900 via-blue-900 to-indigo-900 bg-clip-text text-transparent mb-3",children:w("login.title")}),e.jsx("p",{className:"text-slate-600 text-lg font-medium",children:w("login.subtitle")}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-slate-500",children:w("login.secure")})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/20 animate-fade-up",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Ro'yxatdan o'tish"}),e.jsx("p",{className:"text-slate-600",children:"Admin hisobini yaratish uchun ma'lumotlarni kiriting"})]}),v&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-4 mb-6 animate-fade-in",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-red-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium text-sm",children:"Xatolik"}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:v})]})]})}),e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ms,{className:"w-4 h-4"}),"To'liq ism"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(ms,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"text",placeholder:"Ismingizni kiriting",value:a.name,onChange:C=>o(m=>N(b({},m),{name:C.target.value})),className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ms,{className:"w-4 h-4"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(ms,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"text",placeholder:"Login kiriting (masalan: admin123)",value:a.login,onChange:C=>o(m=>N(b({},m),{login:C.target.value})),className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(Fs,{className:"w-4 h-4"}),"Telefon raqam"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(Fs,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:"tel",placeholder:"+998 (XX) XXX-XX-XX",value:a.phone,onChange:L,className:"w-full pl-12 pr-4 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(Qs,{className:"w-4 h-4"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(Qs,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:n?"text":"password",placeholder:"Parolingizni kiriting",value:a.password,onChange:C=>o(m=>N(b({},m),{password:C.target.value})),className:"w-full pl-12 pr-12 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0}),e.jsx("button",{type:"button",onClick:()=>x(!n),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 transition-colors",children:n?e.jsx(Lt,{className:"w-5 h-5"}):e.jsx(Gs,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(Qs,{className:"w-4 h-4"}),"Parolni tasdiqlash"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(Qs,{className:"w-5 h-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"})}),e.jsx("input",{type:i?"text":"password",placeholder:"Parolni qayta kiriting",value:a.confirmPassword,onChange:C=>o(m=>N(b({},m),{confirmPassword:C.target.value})),className:"w-full pl-12 pr-12 py-4 text-slate-900 bg-slate-50 border border-slate-200 rounded-2xl placeholder:text-slate-400 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:bg-white",required:!0}),e.jsx("button",{type:"button",onClick:()=>g(!i),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 transition-colors",children:i?e.jsx(Lt,{className:"w-5 h-5"}):e.jsx(Gs,{className:"w-5 h-5"})})]})]}),e.jsx("button",{type:"submit",disabled:q,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold py-4 px-6 rounded-2xl shadow-lg shadow-blue-500/25 transition-all duration-200 hover:from-blue-700 hover:to-indigo-700 hover:shadow-xl hover:shadow-blue-500/30 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",children:q?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Ro'yxatdan o'tilmoqda..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{children:"Ro'yxatdan o'tish"}),e.jsx(aa,{className:"w-5 h-5 transition-transform group-hover:translate-x-1"})]})})]})]})]})]})}function Ea({items:a,basePath:o,collapsed:n=!1,setCollapsed:x}){var C;const{user:i,logout:g,updateUser:v}=it(),{t:h}=Ht(),[q,P]=s.useState(!1),[w,S]=s.useState({name:"",phone:"",password:""}),L=()=>{S({name:(i==null?void 0:i.name)||"",phone:(i==null?void 0:i.phone)||"",password:""}),P(!0)},$=m=>Q(this,null,function*(){var y,k;m.preventDefault();try{const j={name:w.name,phone:w.phone};w.password&&(j.password=w.password);const f=yield U.put("/auth/profile",j);v(f.data),P(!1)}catch(j){alert(((k=(y=j.response)==null?void 0:y.data)==null?void 0:k.message)||"Xatolik yuz berdi")}});return e.jsxs("aside",{className:`fixed left-0 top-0 h-full transition-all duration-300 ease-in-out z-50 ${n?"w-16":"w-64"}`,style:{background:"linear-gradient(180deg, #2e1065 0%, #4c1d95 100%)",borderRight:"1px solid rgba(6, 182, 212, 0.2)",boxShadow:"4px 0 24px -4px rgba(46, 16, 101, 0.3)"},children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-4",style:{borderBottom:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, transparent 100%)"},children:[!n&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center overflow-hidden",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-lg text-white tracking-wide",style:{fontFamily:"'Playfair Display', serif",letterSpacing:"0.5px"},children:"Sardor"}),e.jsx("p",{className:"text-sm font-semibold tracking-wider",style:{color:"#c4b5fd",fontFamily:"'Montserrat', sans-serif",letterSpacing:"1.5px"},children:"FURNITURA"})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:()=>x==null?void 0:x(!n),className:"p-2 rounded-xl transition-all duration-200",style:{background:"rgba(255, 255, 255, 0.1)",color:"#c4b5fd"},children:n?e.jsx(Tt,{className:"w-4 h-4"}):e.jsx(ge,{className:"w-4 h-4"})})})]}),e.jsx("nav",{className:"p-3 space-y-1.5 overflow-y-auto h-[calc(100vh-180px)]",children:a.map((m,y)=>e.jsxs(Va,{to:`${o}${m.path}`,end:m.path==="",className:({isActive:k})=>`
              flex items-center gap-3 px-3 py-3 rounded-xl font-medium transition-all duration-200 group
              ${n?"justify-center px-2":""}
            `,style:({isActive:k})=>({background:k?"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)":"transparent",color:k?"#ffffff":"#c4b5fd",boxShadow:k?"0 4px 12px -2px rgba(6, 182, 212, 0.4)":"none"}),title:n?m.label:void 0,children:[e.jsx("span",{className:"flex-shrink-0 transition-transform group-hover:scale-110",children:m.icon}),!n&&e.jsx("span",{className:"truncate text-sm",children:h(m.label)})]},y))}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3",style:{borderTop:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.2) 100%)"},children:[!n&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5 mb-2 rounded-xl",style:{background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(6, 182, 212, 0.15)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{background:"linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%)"},children:e.jsx("span",{className:"text-sm font-bold text-white",children:(C=i==null?void 0:i.name)==null?void 0:C.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-white truncate",children:i==null?void 0:i.name}),e.jsx("p",{className:"text-xs capitalize font-medium",style:{color:"#a78bfa"},children:i==null?void 0:i.role})]}),(i==null?void 0:i.role)==="admin"&&e.jsx("button",{onClick:L,className:"p-1.5 rounded-lg transition-all duration-200",style:{background:"rgba(6, 182, 212, 0.2)",color:"#67e8f9"},title:"Profilni tahrirlash",children:e.jsx(rt,{className:"w-3.5 h-3.5"})})]}),e.jsxs("button",{onClick:g,className:`flex items-center gap-2 w-full px-3 py-2.5 rounded-xl transition-all duration-200 font-medium text-sm ${n?"justify-center px-2":""}`,style:{color:"#fca5a5"},title:n?"Sign Out":void 0,children:[e.jsx(Pt,{className:"w-4 h-4"}),!n&&e.jsx("span",{children:h("sidebar.signout")})]})]}),q&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60]",onClick:()=>P(!1)}),e.jsx("div",{className:"fixed inset-0 z-[200] flex items-end sm:items-center justify-center p-0 sm:p-4 pointer-events-none",children:e.jsxs("div",{className:"w-full sm:w-auto max-w-md p-4 sm:p-8 rounded-t-3xl sm:rounded-3xl flex flex-col max-h-[90vh] overflow-hidden pointer-events-auto",style:{background:"linear-gradient(145deg, #ffffff 0%, #faf5ff 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 25px 50px -12px rgba(46, 16, 101, 0.35)"},children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between mb-4 sm:mb-8 pb-4 sm:pb-0 border-b border-surface-100 sm:border-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold truncate",style:{color:"#2e1065"},children:h("sidebar.editProfile")}),e.jsx("button",{onClick:()=>P(!1),className:"flex-shrink-0 p-2 rounded-xl transition-all",style:{background:"#f5f3ff",color:"#7c3aed"},children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:$,className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(ms,{className:"w-4 h-4"}),h("sidebar.fullName")]}),e.jsxs("div",{className:"relative",children:[e.jsx(ms,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"text",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:h("sidebar.namePlaceholder"),value:w.name,onChange:m=>S(N(b({},w),{name:m.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(Fs,{className:"w-4 h-4"}),h("sidebar.phoneNumber")]}),e.jsxs("div",{className:"relative",children:[e.jsx(Fs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"tel",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:"+998 (XX) XXX-XX-XX",value:w.phone,onChange:m=>S(N(b({},w),{phone:ht(m.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 block flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(Qs,{className:"w-4 h-4"}),h("sidebar.newPassword")]}),e.jsxs("div",{className:"relative",children:[e.jsx(Qs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#a1a1aa"}}),e.jsx("input",{type:"password",className:"w-full pl-12 pr-4 py-4 rounded-2xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},placeholder:h("sidebar.passwordHint"),value:w.password,onChange:m=>S(N(b({},w),{password:m.target.value}))})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>P(!1),className:"flex-1 px-6 py-3.5 font-semibold rounded-2xl transition-all duration-200",style:{background:"#f5f3ff",color:"#7c3aed"},children:h("sidebar.cancel")}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3.5 text-white font-semibold rounded-2xl transition-all duration-200",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 14px -2px rgba(124, 58, 237, 0.4)"},children:h("sidebar.saveChanges")})]})]})})]})})]})]})}const Er=[{icon:e.jsx(ya,{className:"w-5 h-5"}),label:"sidebar.statistics",path:""},{icon:e.jsx(hs,{className:"w-5 h-5"}),label:"sidebar.pos",path:"/kassa"},{icon:e.jsx(Ke,{className:"w-5 h-5"}),label:"sidebar.products",path:"/products"},{icon:e.jsx(Ys,{className:"w-5 h-5"}),label:"sidebar.customers",path:"/customers"},{icon:e.jsx(Vs,{className:"w-5 h-5"}),label:"sidebar.debts",path:"/debts"},{icon:e.jsx(ra,{className:"w-5 h-5"}),label:"sidebar.helpers",path:"/helpers"}],Dr=[{icon:e.jsx(hs,{className:"w-5 h-5"}),label:"sidebar.pos",path:""},{icon:e.jsx(Vs,{className:"w-5 h-5"}),label:"sidebar.debts",path:"/debts"}];function Ar(){const a=lt(),o=Ks(),n=[{path:"/admin",icon:ya,label:"Bosh sahifa",exact:!0},{path:"/admin/kassa",icon:hs,label:"Kassa"},{path:"/admin/products",icon:Ke,label:"Tovarlar"},{path:"/admin/debts",icon:Xs,label:"Qarzlar"}],x=(i,g)=>g?a.pathname===i:a.pathname.startsWith(i);return e.jsxs("nav",{className:"lg:hidden fixed bottom-0 left-0 right-0 bg-slate-100/80 backdrop-blur-2xl border-t border-slate-200/60 z-50 shadow-[0_-4px_20px_-4px_rgba(0,0,0,0.1)]",children:[e.jsx("div",{className:"grid grid-cols-4 h-[72px] max-w-lg mx-auto",children:n.map(i=>{const g=i.icon,v=x(i.path,i.exact);return e.jsxs("button",{onClick:()=>o(i.path),className:`relative flex flex-col items-center justify-center gap-0.5 transition-all duration-300 ${v?"text-blue-600":"text-slate-400 active:text-slate-600"}`,children:[v&&e.jsx("div",{className:"absolute -top-0.5 left-1/2 -translate-x-1/2 w-8 h-1 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full"}),e.jsx("div",{className:`p-2 rounded-2xl transition-all duration-300 ${v?"bg-gradient-to-br from-blue-50 to-indigo-50 shadow-sm":"hover:bg-slate-50"}`,children:e.jsx(g,{className:`w-5 h-5 transition-all duration-300 ${v?"scale-110 text-blue-600":""}`})}),e.jsx("span",{className:`text-[10px] font-semibold transition-all duration-300 ${v?"text-blue-600":"text-slate-500"}`,children:i.label})]},i.path)})}),e.jsx("div",{className:"h-safe-area-inset-bottom bg-slate-100/80"})]})}function Lr(){const[a,o]=s.useState(!1);return e.jsxs("div",{className:"min-h-screen",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(Ea,{items:Er,basePath:"/admin",collapsed:a,setCollapsed:o})}),e.jsx("main",{className:`
        transition-all duration-300 ease-smooth
        lg:ml-64
        ${a?"lg:ml-[72px]":"lg:ml-64"}
        
        /* Mobile bottom navigation space */
        2xs:pb-[88px] xs:pb-[88px] sm:pb-[88px] md:pb-0
        
        /* Responsive min-height */
        min-h-screen
      `,children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(Ut,{})})}),e.jsx(Ar,{})]})}function _r(){const a=Ks(),[o,n]=s.useState(0);s.useEffect(()=>{x();const g=setInterval(x,3e4);return()=>clearInterval(g)},[]);const x=()=>Q(this,null,function*(){try{const g=yield U.get("/debts?status=pending_approval");n(g.data.length)}catch(g){console.error("Error fetching pending debts count:",g)}}),i=()=>{a("/admin/debt-approvals")};return o===0?null:e.jsx("div",{className:"relative",children:e.jsxs("button",{onClick:i,className:"relative p-2 rounded-xl bg-amber-100 text-amber-600 hover:bg-amber-200 transition-colors",title:`${o} ta qarz tasdiqlashni kutmoqda`,children:[e.jsx(ka,{className:"w-5 h-5"}),o>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold",children:o>9?"9+":o})]})})}function Ws({title:a,showSearch:o,onSearch:n,actions:x,filterOptions:i,filterValue:g,onFilterChange:v,showLogout:h}){var ue;const[q,P]=s.useState(""),[w,S]=s.useState(!1),[L,$]=s.useState(!1),C=s.useRef(null),{t:m}=Ht(),{user:y,logout:k}=it(),j=Ks(),f=(y==null?void 0:y.role)==="admin",R=()=>{window.confirm("Tizimdan chiqmoqchimisiz?")&&(k(),j("/login"))};s.useEffect(()=>(w?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[w]),s.useEffect(()=>{L&&C.current&&C.current.focus()},[L]);const W=de=>{P(de),n==null||n(de)},J=[{icon:na,label:"Bosh sahifa",path:"/"},{icon:et,label:"Mahsulotlar",path:"/admin/products"},{icon:hs,label:"Kassa",path:"/admin/kassa"},{icon:Ys,label:"Mijozlar",path:"/admin/customers"},{icon:Zs,label:"Qarzlar",path:"/admin/debts"},{icon:la,label:"Hodimlar",path:"/admin/helpers"}];return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"sticky top-0 z-50 bg-slate-100 border-b border-slate-200/60 shadow-sm",children:e.jsxs("div",{className:"px-1.5 sm:px-3 md:px-4 lg:px-6 h-10 sm:h-12 md:h-14 flex items-center justify-between gap-1 sm:gap-2 md:gap-3 lg:gap-4",children:[e.jsx("button",{onClick:()=>S(!0),className:"lg:hidden p-0.5 rounded bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-colors active:scale-95 flex-shrink-0 flex items-center justify-center",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Menyuni ochish",children:e.jsx(Tt,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1.5 md:gap-2 lg:gap-3 flex-shrink-0",children:[i&&i.length>0&&e.jsxs("div",{className:"relative hidden sm:block",children:[e.jsx("select",{value:g,onChange:de=>v==null?void 0:v(de.target.value),className:"appearance-none pl-2 sm:pl-3 pr-6 sm:pr-8 py-1.5 sm:py-2 bg-slate-50 border border-slate-200 rounded-lg text-xs sm:text-sm font-medium text-slate-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 cursor-pointer transition-all duration-200",children:i.map(de=>e.jsx("option",{value:de.value,children:de.label},de.value))}),e.jsx(pt,{className:"absolute right-1.5 sm:right-2 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-400 pointer-events-none"})]}),o&&e.jsx("button",{onClick:()=>$(!L),className:"flex items-center justify-center p-0.5 rounded bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Qidirish",children:e.jsx(fs,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),f?e.jsx(_r,{}):e.jsxs("button",{className:"relative p-0.5 sm:p-1.5 md:p-2 rounded-md sm:rounded-lg bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-all duration-200 flex-shrink-0 flex items-center justify-center",children:[e.jsx(ka,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-1.5 sm:w-2 h-1.5 sm:h-2 bg-red-500 rounded-full"})]}),h&&e.jsxs("button",{onClick:R,className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white transition-all duration-200 hover:shadow-lg hover:scale-105 active:scale-95 flex-shrink-0 text-xs sm:text-sm font-semibold",title:"Chiqish",children:[e.jsx(Pt,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),e.jsx("span",{className:"hidden xs:inline",children:"Chiqish"})]}),x]})]})}),o&&L&&e.jsx("div",{className:"fixed top-10 sm:top-12 md:top-14 right-1.5 sm:right-3 md:right-4 lg:right-6 z-50 animate-fade-in",children:e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-3 sm:left-3.5 top-1/2 -translate-y-1/2 w-4 sm:w-5 h-4 sm:h-5 text-brand-400"}),e.jsx("input",{ref:C,type:"text",placeholder:"Qidirish...",value:q,onChange:de=>W(de.target.value),className:"w-64 sm:w-80 md:w-96 h-10 sm:h-11 pl-10 sm:pl-11 pr-10 sm:pr-11 rounded-xl border-2 border-slate-200 focus:border-brand-400 focus:ring-4 focus:ring-brand-100 focus:bg-white transition-all duration-200 text-sm sm:text-base text-slate-900 placeholder:text-slate-400 bg-white shadow-lg hover:border-brand-300"}),e.jsx("button",{onClick:()=>{$(!1),P(""),n==null||n("")},className:"absolute right-3 sm:right-3.5 top-1/2 -translate-y-1/2 w-7 h-7 flex items-center justify-center rounded-full bg-slate-100 hover:bg-slate-200 transition-colors",children:e.jsx(ge,{className:"w-4 h-4 text-slate-500"})})]})}),w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50"}),e.jsxs("div",{className:"fixed top-0 left-0 bottom-0 w-80 max-w-[85vw] bg-white z-[80] shadow-2xl animate-slide-in-left",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-8 h-8 rounded-lg border-2 border-white/30"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-brand-100 text-xs",children:"Mebel furniturasi"})]})]}),e.jsx("button",{onClick:()=>S(!1),className:"w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center hover:bg-white/30 transition-colors",children:e.jsx(ge,{className:"w-5 h-5 text-white"})})]})}),e.jsxs("div",{className:"overflow-y-auto h-[calc(100vh-140px)] p-3",children:[e.jsx("div",{className:"space-y-0.5",children:J.map((de,K)=>{const Se=de.icon;return e.jsxs("button",{onClick:()=>{j(de.path),S(!1)},className:"w-full flex items-center gap-3 p-3 rounded-xl hover:bg-surface-50 transition-colors group",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center group-hover:bg-brand-50 group-hover:scale-110 transition-all",children:e.jsx(Se,{className:"w-5 h-5 text-surface-600 group-hover:text-brand-600"})}),e.jsx("span",{className:"font-medium text-surface-900 group-hover:text-brand-600 transition-colors",children:de.label}),e.jsx(Vt,{className:"w-4 h-4 text-surface-300 ml-auto group-hover:text-brand-600 group-hover:translate-x-1 transition-all"})]},K)})}),e.jsxs("div",{className:"mt-4 p-3 bg-gradient-to-br from-red-50 to-red-100/50 rounded-xl border border-red-200",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:((ue=y==null?void 0:y.name)==null?void 0:ue.charAt(0).toUpperCase())||"A"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-surface-900",children:(y==null?void 0:y.name)||"Foydalanuvchi"}),e.jsx("p",{className:"text-xs text-surface-500",children:(y==null?void 0:y.role)==="admin"?"Administrator":"Foydalanuvchi"})]})]}),e.jsxs("button",{onClick:R,className:"w-full flex items-center justify-center gap-2 p-3 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 font-semibold",children:[e.jsx(Pt,{className:"w-5 h-5"}),e.jsx("span",{children:"Tizimdan chiqish"})]})]})]})]})]})]})}function Ir(){const[a,o]=s.useState("today"),{t:n}=Ht(),[x,i]=s.useState({totalRevenue:0,todaySales:0,weekSales:0,monthSales:0,totalReceipts:0,totalProducts:0,lowStock:0,outOfStock:0,peakHour:""}),[g,v]=s.useState([]),[h,q]=s.useState([]),[P,w]=s.useState(!0);s.useEffect(()=>{S(),L()},[]),s.useEffect(()=>{$()},[a]);const S=()=>Q(this,null,function*(){try{const m=yield U.get("/stats");i(m.data)}catch(m){console.error("Error fetching stats:",m)}finally{w(!1)}}),L=()=>Q(this,null,function*(){try{const y=(yield U.get("/stats/top-products")).data.slice(0,3);q(y)}catch(m){console.error("Error fetching top products:",m)}}),$=()=>Q(this,null,function*(){try{const m=yield U.get(`/stats/chart?period=${a}`);v(m.data)}catch(m){console.error("Error fetching chart data:",m)}}),C=[{icon:ds,label:"Umumiy daromad",value:p(x.totalRevenue||0),suffix:"UZS",color:"from-emerald-500 to-emerald-600",accentColor:"bg-emerald-500",iconBg:"bg-emerald-100",iconColor:"text-emerald-600",textColor:"text-emerald-600",trend:"+12.5%",trendUp:!0},{icon:ia,label:a==="today"?"Bugungi savdo":"Haftalik savdo",value:p(a==="today"?x.todaySales||0:x.weekSales||0),suffix:"UZS",color:"from-blue-500 to-blue-600",accentColor:"bg-blue-500",iconBg:"bg-blue-100",iconColor:"text-blue-600",textColor:"text-blue-600",trend:"+8.2%",trendUp:!0},{icon:hs,label:"Jami buyurtmalar",value:(x.totalReceipts||0).toString(),color:"from-purple-500 to-purple-600",accentColor:"bg-purple-500",iconBg:"bg-purple-100",iconColor:"text-purple-600",textColor:"text-purple-600",trend:"+15.3%",trendUp:!0},{icon:Ga,label:"Eng yuqori soat",value:x.peakHour||"-",color:"from-orange-500 to-orange-600",accentColor:"bg-orange-500",iconBg:"bg-orange-100",iconColor:"text-orange-600",textColor:"text-orange-600",trend:"",trendUp:!0}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100",children:[e.jsx(Ws,{title:n("dashboard.title")}),e.jsxs("div",{className:"py-4 sm:py-5 md:py-6 space-y-4 sm:space-y-5 md:space-y-6 pb-24 lg:pb-8",children:[e.jsxs("div",{className:"px-4 sm:px-6 md:px-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 animate-fade-in",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-extrabold bg-gradient-to-r from-purple-900 via-purple-700 to-purple-600 bg-clip-text text-transparent leading-tight",children:n("dashboard.overview")}),e.jsx("p",{className:"text-slate-600 text-xs sm:text-sm font-medium",children:n("dashboard.description")})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex p-1 bg-white/90 backdrop-blur-xl rounded-xl shadow-lg border border-white/20",children:[e.jsx("button",{onClick:()=>o("today"),className:`px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all duration-300 ${a==="today"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/30":"text-slate-600 hover:text-slate-900 hover:bg-slate-50/50"}`,children:n("dashboard.today")}),e.jsx("button",{onClick:()=>o("week"),className:`px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all duration-300 ${a==="week"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/30":"text-slate-600 hover:text-slate-900 hover:bg-slate-50/50"}`,children:n("dashboard.thisWeek")})]}),e.jsx("button",{onClick:S,className:"p-2.5 sm:p-3 rounded-xl bg-white/90 backdrop-blur-xl border border-white/20 text-slate-600 hover:text-slate-900 hover:bg-white transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 active:scale-95",title:n("dashboard.refresh"),children:e.jsx(Os,{className:`w-4 h-4 sm:w-5 sm:h-5 ${P?"animate-spin":""}`})})]})]}),P?e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:[1,2,3,4].map(m=>e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-xl sm:rounded-2xl p-3 sm:p-4 md:p-5 shadow-xl border border-slate-200/50 overflow-hidden min-h-[140px] sm:min-h-[160px] md:min-h-[180px]",children:[e.jsxs("div",{className:"animate-pulse space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 bg-gradient-to-br from-slate-200 to-slate-300 rounded-lg sm:rounded-xl"}),e.jsx("div",{className:"w-10 sm:w-12 h-4 sm:h-5 bg-gradient-to-br from-slate-200 to-slate-300 rounded-lg"})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx("div",{className:"h-6 sm:h-8 bg-gradient-to-br from-slate-200 to-slate-300 rounded-lg w-3/4"}),e.jsx("div",{className:"h-3 sm:h-4 bg-gradient-to-br from-slate-200 to-slate-300 rounded w-1/2"})]})]}),e.jsx("div",{className:"absolute inset-0 -translate-x-full animate-[shimmer_2s_infinite] bg-gradient-to-r from-transparent via-white/20 to-transparent"})]},m))})}):e.jsx("div",{children:e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:C.map((m,y)=>e.jsx("div",{className:"group relative animate-slide-up",style:{animationDelay:`${y*100}ms`},children:e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-xl sm:rounded-2xl p-3 sm:p-4 md:p-5 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] overflow-hidden min-h-[140px] sm:min-h-[160px] md:min-h-[180px] flex flex-col border border-slate-200/50",children:[e.jsx("div",{className:`absolute top-0 left-0 right-0 h-0.5 sm:h-1 ${m.accentColor}`}),e.jsxs("div",{className:"flex items-start justify-between mb-auto",children:[e.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 rounded-lg sm:rounded-xl md:rounded-2xl ${m.iconBg} flex items-center justify-center flex-shrink-0`,children:e.jsx(m.icon,{className:`w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7 ${m.iconColor}`})}),m.trend&&e.jsxs("div",{className:`flex items-center gap-0.5 px-1.5 sm:px-2 py-0.5 rounded-md sm:rounded-lg text-[9px] sm:text-[10px] md:text-xs font-bold ${m.trendUp?"bg-emerald-50 text-emerald-700":"bg-red-50 text-red-700"}`,children:[m.trendUp?e.jsx(Gt,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"}):e.jsx(Za,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"}),e.jsx("span",{children:m.trend})]})]}),e.jsxs("div",{className:"mt-auto space-y-0.5 sm:space-y-1",children:[e.jsxs("div",{className:"flex items-baseline gap-0.5 sm:gap-1 flex-wrap",children:[e.jsx("h3",{className:`text-base sm:text-xl md:text-2xl lg:text-3xl font-bold ${m.textColor} leading-none tracking-tight`,children:m.value}),m.suffix&&e.jsx("span",{className:"text-[7px] sm:text-[8px] md:text-[9px] font-semibold text-slate-400 uppercase",children:m.suffix})]}),e.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs font-medium text-slate-600 leading-tight line-clamp-2",children:m.label})]})]})},y))})})}),e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 sm:gap-5 md:gap-6",children:[e.jsx("div",{className:"xl:col-span-2 relative group animate-slide-up",style:{animationDelay:"400ms"},children:e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 shadow-xl border border-slate-200/50 hover:shadow-2xl transition-all duration-500 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/40 via-transparent to-slate-50/40 opacity-60"}),e.jsxs("div",{className:"relative z-10 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-500 rounded-2xl blur-lg opacity-30"}),e.jsx("div",{className:"relative w-14 h-14 sm:w-16 sm:h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg",children:e.jsx(_t,{className:"w-7 h-7 sm:w-8 sm:h-8 text-white"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-slate-900 mb-1",children:a==="today"?"Bugungi daromad":"Haftalik daromad"}),e.jsx("p",{className:"text-sm sm:text-base text-slate-500 font-medium",children:a==="today"?"Soatlik taqsimot":"Kunlik ko'rsatkichlar"})]})]}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-50 rounded-xl border border-blue-100",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-bold text-blue-700",children:"Savdo"})]})]}),e.jsx("div",{className:"relative z-10 h-64 sm:h-72 md:h-80 rounded-2xl overflow-hidden bg-gradient-to-br from-slate-50/50 to-white/50 p-4",children:g.length>0?e.jsx(vr,{width:"100%",height:"100%",children:e.jsxs(Nr,{data:g,margin:{top:10,right:10,left:-20,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorSales",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.4}),e.jsx("stop",{offset:"50%",stopColor:"#3b82f6",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.05})]})}),e.jsx(wr,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1,strokeOpacity:.5}),e.jsx(yr,{dataKey:"date",stroke:"#94a3b8",fontSize:12,tickLine:!1,axisLine:{stroke:"#cbd5e1",strokeWidth:2},tick:{fill:"#64748b",fontWeight:600},dy:8}),e.jsx(kr,{stroke:"#94a3b8",fontSize:12,tickLine:!1,axisLine:{stroke:"#cbd5e1",strokeWidth:2},tick:{fill:"#64748b",fontWeight:600},dx:-5,tickFormatter:m=>`${(m/1e3).toFixed(0)}k`}),e.jsx(Sr,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.98)",border:"none",borderRadius:"16px",boxShadow:"0 20px 40px -12px rgba(0, 0, 0, 0.2)",padding:"12px 16px",backdropFilter:"blur(10px)"},labelStyle:{color:"#0f172a",fontWeight:700,marginBottom:"6px",fontSize:"13px"},itemStyle:{color:"#3b82f6",fontWeight:600,fontSize:"14px"},formatter:m=>[`${p(m)} so'm`,"Daromad"],cursor:{stroke:"#3b82f6",strokeWidth:2,strokeDasharray:"5 5",strokeOpacity:.5}}),e.jsx(Cr,{type:"monotone",dataKey:"sales",stroke:"#3b82f6",strokeWidth:3,fill:"url(#colorSales)",dot:{fill:"#3b82f6",strokeWidth:2,stroke:"#fff",r:4},activeDot:{r:6,fill:"#3b82f6",stroke:"#fff",strokeWidth:3,filter:"drop-shadow(0 4px 6px rgba(59, 130, 246, 0.4))"},animationDuration:1200,animationEasing:"ease-in-out"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-200 rounded-3xl blur-2xl opacity-40"}),e.jsx("div",{className:"relative w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-slate-100 to-slate-200 rounded-3xl flex items-center justify-center shadow-lg",children:e.jsx(_t,{className:"w-10 h-10 sm:w-12 sm:h-12 text-slate-400"})})]}),e.jsx("p",{className:"font-bold text-slate-700 text-lg mb-2",children:"Ma'lumot mavjud emas"}),e.jsx("p",{className:"text-slate-500 text-sm text-center max-w-xs",children:"Analitikani ko'rish uchun savdo qilishni boshlang"})]})})]})}),e.jsx("div",{className:"relative group animate-slide-up",style:{animationDelay:"500ms"},children:e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 shadow-xl border border-slate-200/50 hover:shadow-2xl transition-all duration-500 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-50/40 via-transparent to-pink-50/40 opacity-60"}),e.jsx("div",{className:"relative z-10 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-purple-500 rounded-2xl blur-lg opacity-30"}),e.jsx("div",{className:"relative w-14 h-14 sm:w-16 sm:h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg",children:e.jsx(Ke,{className:"w-7 h-7 sm:w-8 sm:h-8 text-white"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-slate-900 mb-1",children:"Top mahsulotlar"}),e.jsx("p",{className:"text-sm sm:text-base text-slate-500 font-medium",children:"Eng ko'p sotilganlar"})]})]})}),e.jsx("div",{className:"relative z-10",children:h.length>0?e.jsx("div",{className:"space-y-3 sm:space-y-4",children:h.map((m,y)=>e.jsxs("div",{className:"group/item flex items-center gap-3 sm:gap-4 p-4 sm:p-5 bg-gradient-to-r from-slate-50 to-white rounded-xl sm:rounded-2xl border border-slate-200 hover:border-purple-200 hover:shadow-lg transition-all duration-300 cursor-pointer",children:[e.jsx("div",{className:`flex-shrink-0 w-11 h-11 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center font-bold text-base sm:text-lg shadow-lg transition-transform group-hover/item:scale-110 ${y===0?"bg-gradient-to-br from-yellow-400 to-yellow-500 text-white":y===1?"bg-gradient-to-br from-slate-300 to-slate-400 text-white":"bg-gradient-to-br from-orange-300 to-orange-400 text-white"}`,children:y+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-slate-900 text-sm sm:text-base truncate mb-1",children:m._id}),e.jsxs("p",{className:"text-xs sm:text-sm text-slate-500 font-medium",children:[m.totalSold," ta sotildi"]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"font-bold text-purple-600 text-base sm:text-lg",children:p(m.revenue)}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-400 font-semibold",children:"so'm"})]})]},m._id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-56 sm:h-64",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-200 rounded-3xl blur-2xl opacity-40"}),e.jsx("div",{className:"relative w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-slate-100 to-slate-200 rounded-3xl flex items-center justify-center shadow-lg",children:e.jsx(xt,{className:"w-10 h-10 sm:w-12 sm:h-12 text-slate-400"})})]}),e.jsx("p",{className:"font-bold text-slate-700 text-lg mb-2",children:"Ma'lumot yo'q"}),e.jsx("p",{className:"text-slate-500 text-sm text-center max-w-xs",children:"Hali sotuvlar amalga oshirilmagan"})]})})]})})]})})]})]})}const Br="modulepreload",Or=function(a){return"/"+a},ja={},Fr=function(o,n,x){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const v=document.querySelector("meta[property=csp-nonce]"),h=(v==null?void 0:v.nonce)||(v==null?void 0:v.getAttribute("nonce"));i=Promise.allSettled(n.map(q=>{if(q=Or(q),q in ja)return;ja[q]=!0;const P=q.endsWith(".css"),w=P?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${q}"]${w}`))return;const S=document.createElement("link");if(S.rel=P?"stylesheet":Br,P||(S.as="script"),S.crossOrigin="",S.href=q,h&&S.setAttribute("nonce",h),document.head.appendChild(S),P)return new Promise((L,$)=>{S.addEventListener("load",L),S.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${q}`)))})}))}function g(v){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=v,window.dispatchEvent(h),!h.defaultPrevented)throw v}return i.then(v=>{for(const h of v||[])h.status==="rejected"&&g(h.reason);return o().catch(g)})};function Kr({isOpen:a,onClose:o,onConfirm:n,title:x,message:i,type:g="info",confirmText:v="OK",cancelText:h="Bekor qilish",showCancel:q=!1,autoClose:P=!1,autoCloseDelay:w=2e3}){const S=s.useRef(null);if(s.useEffect(()=>{if(a&&P&&(g==="success"||g==="info")){const m=setTimeout(()=>{n?n():o()},w);return()=>clearTimeout(m)}},[a,P,w,g,n,o]),s.useEffect(()=>{var m;if(a){(m=S.current)==null||m.focus();const y=k=>{k.key==="Enter"&&(k.preventDefault(),n?n():o()),k.key==="Escape"&&o()};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)}},[a,n,o]),!a)return null;const L={info:e.jsx(er,{className:"w-10 h-10 text-blue-600"}),success:e.jsx(oa,{className:"w-10 h-10 text-emerald-600"}),warning:e.jsx(Rs,{className:"w-10 h-10 text-amber-600"}),danger:e.jsx(Rs,{className:"w-10 h-10 text-red-600"})},$={info:"bg-gradient-to-br from-blue-50 via-blue-50 to-indigo-50 border-blue-200",success:"bg-gradient-to-br from-emerald-50 via-green-50 to-teal-50 border-emerald-300",warning:"bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 border-amber-200",danger:"bg-gradient-to-br from-red-50 via-rose-50 to-pink-50 border-red-200"},C={info:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/30 hover:shadow-xl hover:shadow-blue-500/40",success:"bg-gradient-to-r from-emerald-500 via-green-500 to-teal-500 hover:from-emerald-600 hover:via-green-600 hover:to-teal-600 text-white shadow-lg shadow-emerald-500/30 hover:shadow-xl hover:shadow-emerald-500/40",warning:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white shadow-lg shadow-amber-500/30 hover:shadow-xl hover:shadow-amber-500/40",danger:"bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-white shadow-lg shadow-red-500/30 hover:shadow-xl hover:shadow-red-500/40"};return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-4 sm:p-6",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm -z-10 transition-opacity duration-100",onClick:o,style:{animation:"fadeIn 0.1s ease-out"}}),e.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-3xl w-full sm:w-auto sm:min-w-[480px] sm:max-w-xl md:max-w-2xl p-6 sm:p-8 md:p-10 shadow-2xl relative z-10 border border-slate-200/50",style:{animation:"modalSlideUp 0.1s ease-out",willChange:"transform, opacity"},children:[e.jsx("button",{onClick:o,className:"absolute top-4 right-4 sm:top-5 sm:right-5 p-2 sm:p-2.5 rounded-xl text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition-all",children:e.jsx(ge,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsxs("div",{className:"flex flex-col items-center text-center mb-6 sm:mb-8",children:[e.jsx("div",{className:`w-16 h-16 sm:w-20 sm:h-20 ${$[g]} rounded-2xl flex items-center justify-center mb-4 sm:mb-6 border shadow-sm`,children:L[g]}),e.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-bold text-slate-900 mb-2 sm:mb-3 px-2",children:x}),e.jsx("p",{className:"text-sm sm:text-base md:text-lg text-slate-600 leading-relaxed max-w-md px-2",children:i})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3 sm:gap-4",children:[q&&e.jsx("button",{onClick:o,className:"flex-1 px-4 sm:px-5 md:px-6 py-3 sm:py-3.5 md:py-4 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all duration-200 text-sm sm:text-base",children:h}),e.jsx("button",{ref:S,onClick:n||o,className:`flex-1 px-4 sm:px-5 md:px-6 py-3 sm:py-3.5 md:py-4 font-semibold rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 text-sm sm:text-base ${C[g]}`,children:v})]})]})]})}function Ps(){const[a,o]=s.useState({isOpen:!1,title:"",message:"",type:"info",showCancel:!1,confirmText:"OK",autoClose:!1,onClose:void 0}),n=s.useCallback((v,h="Xabar",q="info")=>new Promise(P=>{if(q==="success"||q==="info"){P();return}o({isOpen:!0,title:h,message:v,type:q,showCancel:!1,confirmText:"OK",autoClose:!1,onConfirm:()=>{o(w=>N(b({},w),{isOpen:!1})),P()}})}),[]),x=s.useCallback((v,h="Tasdiqlash",q="warning")=>new Promise(P=>{o({isOpen:!0,title:h,message:v,type:q,showCancel:!0,confirmText:"Ha",autoClose:!1,onConfirm:()=>{o(L=>N(b({},L),{isOpen:!1})),P(!0)},onClose:()=>{o(L=>N(b({},L),{isOpen:!1})),P(!1)}})}),[]),i=s.useCallback(()=>{a.onClose?a.onClose():o(v=>N(b({},v),{isOpen:!1}))},[a.onClose]),g=e.jsx(Kr,{isOpen:a.isOpen,onClose:a.onClose||i,onConfirm:a.onConfirm,title:a.title,message:a.message,type:a.type,showCancel:a.showCancel,confirmText:a.confirmText,autoClose:a.autoClose});return{showAlert:n,showConfirm:x,AlertComponent:g}}const Ur="pos_offline_db",Xr=2,ws={SALES:"offline_sales",PRODUCTS:"cached_products",STAFF_RECEIPTS:"staff_receipts"};let Qt=null;const ot=()=>new Promise((a,o)=>{if(Qt){a(Qt);return}const n=indexedDB.open(Ur,Xr);n.onerror=()=>{console.error("IndexedDB: Failed to open database"),o(n.error)},n.onsuccess=()=>{Qt=n.result,console.log("IndexedDB: Database opened successfully"),a(Qt)},n.onupgradeneeded=x=>{const i=x.target.result;if(!i.objectStoreNames.contains(ws.SALES)){const g=i.createObjectStore(ws.SALES,{keyPath:"id"});g.createIndex("synced","synced",{unique:!1}),g.createIndex("createdAt","createdAt",{unique:!1}),console.log("IndexedDB: Created offline_sales store")}if(i.objectStoreNames.contains(ws.PRODUCTS)||(i.createObjectStore(ws.PRODUCTS,{keyPath:"_id"}).createIndex("code","code",{unique:!0}),console.log("IndexedDB: Created cached_products store")),!i.objectStoreNames.contains(ws.STAFF_RECEIPTS)){const g=i.createObjectStore(ws.STAFF_RECEIPTS,{keyPath:"id"});g.createIndex("syncStatus","syncStatus",{unique:!1}),g.createIndex("createdAt","createdAt",{unique:!1}),g.createIndex("updatedAt","updatedAt",{unique:!1}),g.createIndex("userId","userId",{unique:!1}),console.log("IndexedDB: Created staff_receipts store")}}}),Hr=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>{const o=Math.random()*16|0;return(a==="x"?o:o&3|8).toString(16)}),Yr=a=>Q(es,null,function*(){const o=yield ot(),n=N(b({},a),{id:Hr(),createdAt:new Date().toISOString(),synced:!1});return new Promise((x,i)=>{const h=o.transaction([ws.SALES],"readwrite").objectStore(ws.SALES).add(n);h.onsuccess=()=>{console.log("IndexedDB: Sale saved offline",n.id),x(n)},h.onerror=()=>{console.error("IndexedDB: Failed to save sale"),i(h.error)}})}),Da=()=>Q(es,null,function*(){const a=yield ot();return new Promise((o,n)=>{const i=a.transaction([ws.SALES],"readonly").objectStore(ws.SALES),g=[],v=i.openCursor();v.onsuccess=h=>{const q=h.target.result;if(q){const P=q.value;(P.synced===!1||P.synced===void 0)&&g.push(P),q.continue()}else o(g)},v.onerror=()=>{console.error("IndexedDB: Failed to get unsynced sales"),n(v.error)}})}),Aa=a=>Q(es,null,function*(){const o=yield ot();return new Promise((n,x)=>{const i=o.transaction([ws.SALES],"readwrite"),g=i.objectStore(ws.SALES);i.onerror=()=>x(i.error);let v=0;const h=a.length;if(h===0){n();return}a.forEach(q=>{const P=g.get(q);P.onsuccess=()=>{const w=P.result;w&&(w.synced=!0,g.put(w)),v++,v===h&&(console.log(`IndexedDB: Marked ${h} sales as synced`),n())},P.onerror=()=>{v++,v===h&&n()}})})}),La=a=>Q(es,null,function*(){const o=yield ot();return new Promise((n,x)=>{const i=o.transaction([ws.SALES],"readwrite"),g=i.objectStore(ws.SALES);i.onerror=()=>x(i.error);let v=0;const h=a.length;if(h===0){n();return}a.forEach(q=>{const P=g.delete(q);P.onsuccess=()=>{v++,v===h&&(console.log(`IndexedDB: Deleted ${h} synced sales`),n())},P.onerror=()=>{v++,v===h&&n()}})})}),ct=()=>Q(es,null,function*(){return(yield Da()).length}),_a=a=>Q(es,null,function*(){const o=yield ot();return new Promise((n,x)=>{const g=o.transaction([ws.PRODUCTS],"readwrite").objectStore(ws.PRODUCTS),v=g.clear();v.onsuccess=()=>{let h=0;const q=a.length;if(q===0){n();return}a.forEach(P=>{const w=g.add(P);w.onsuccess=()=>{h++,h===q&&(console.log(`IndexedDB: Cached ${q} products`),n())},w.onerror=()=>{h++,h===q&&n()}})},v.onerror=()=>{x(v.error)}})}),Ft=()=>Q(es,null,function*(){const a=yield ot();return new Promise((o,n)=>{const g=a.transaction([ws.PRODUCTS],"readonly").objectStore(ws.PRODUCTS).getAll();g.onsuccess=()=>{var v;console.log(`IndexedDB: Retrieved ${((v=g.result)==null?void 0:v.length)||0} cached products`),o(g.result||[])},g.onerror=()=>{console.error("IndexedDB: Failed to get cached products"),n(g.error)}})});let At=[],kt=!1;const Wr=a=>(At.push(a),()=>{At=At.filter(o=>o!==a)}),Ct=a=>Q(es,null,function*(){const o=yield ct();At.forEach(n=>n(a,o))}),mt=()=>navigator.onLine,sa=()=>Q(es,null,function*(){if(kt)return console.log("Sync: Already syncing, skipping..."),{success:!1,synced:0,error:"Sync already in progress"};if(!mt())return console.log("Sync: Device is offline, skipping..."),{success:!1,synced:0,error:"Device is offline"};kt=!0,yield Ct("syncing");try{const a=yield Da();if(a.length===0)return console.log("Sync: No unsynced sales to sync"),kt=!1,yield Ct("idle"),{success:!0,synced:0};console.log(`Sync: Found ${a.length} unsynced sales`);const o=a.map(x=>({offlineId:x.id,items:x.items,total:x.total,paymentMethod:x.paymentMethod,customer:x.customer,isReturn:x.isReturn,createdAt:x.createdAt})),n=yield U.post("/receipts/bulk",{sales:o});if(n.data.success){const x=a.map(i=>i.id);return yield Aa(x),yield La(x),console.log(`Sync: Successfully synced ${x.length} sales`),kt=!1,yield Ct("success"),{success:!0,synced:x.length}}else throw new Error(n.data.message||"Server returned error")}catch(a){return console.error("Sync: Failed to sync sales",a),kt=!1,yield Ct("error"),{success:!1,synced:0,error:a.message||"Sync failed"}}}),Jr=()=>{window.addEventListener("online",()=>Q(es,null,function*(){console.log("Sync: Internet connection restored"),setTimeout(()=>Q(es,null,function*(){const a=yield sa();a.success&&a.synced>0&&console.log(`Sync: Auto-synced ${a.synced} sales after reconnection`)}),2e3)})),window.addEventListener("offline",()=>{console.log("Sync: Internet connection lost - sales will be saved locally"),Ct("idle")}),mt()&&setTimeout(()=>{sa()},3e3),console.log("Sync: Event listeners initialized")},Vr=()=>Q(es,null,function*(){return mt()?sa():{success:!1,synced:0,error:"Internet aloqasi yo'q"}}),Gr=()=>{const[a,o]=s.useState(mt()),[n,x]=s.useState(0),[i,g]=s.useState(!1),[v,h]=s.useState("idle"),[q,P]=s.useState(!1);s.useEffect(()=>{Q(es,null,function*(){yield ot(),q||(Jr(),P(!0));const k=yield ct();x(k)});const C=Wr((k,j)=>{h(k),x(j),g(k==="syncing")}),m=()=>o(!0),y=()=>o(!1);return window.addEventListener("online",m),window.addEventListener("offline",y),()=>{C(),window.removeEventListener("online",m),window.removeEventListener("offline",y)}},[q]);const w=s.useCallback($=>Q(es,null,function*(){if(mt())try{const m=(yield U.get(`/products${$?`?${$}`:""}`)).data;return yield _a(m),m}catch(C){return console.log("Failed to fetch from server, using cache"),Ft()}else return console.log("Offline - using cached products"),Ft()}),[]),S=s.useCallback($=>Q(es,null,function*(){try{const C=yield Yr($);if(console.log("Sale saved locally:",C.id),mt())try{yield U.post("/receipts",{items:$.items,total:$.total,paymentMethod:$.paymentMethod,customer:$.customer,isReturn:$.isReturn}),yield Aa([C.id]),yield La([C.id]);const m=yield ct();return x(m),{success:!0,offline:!1}}catch(m){console.log("Server sync failed, sale saved offline");const y=yield ct();return x(y),{success:!0,offline:!0}}else{const m=yield ct();return x(m),{success:!0,offline:!0}}}catch(C){return console.error("Failed to save sale:",C),{success:!1,offline:!1}}}),[]),L=s.useCallback(()=>Q(es,null,function*(){const $=yield Vr(),C=yield ct();return x(C),$}),[]);return{isOnline:a,pendingCount:n,isSyncing:i,syncStatus:v,fetchProductsWithCache:w,createSaleOfflineFirst:S,manualSync:L}};function Zr({onScan:a,onClose:o}){const[n,x]=s.useState(!1),[i,g]=s.useState(""),[v,h]=s.useState(!1),[q,P]=s.useState(""),[w,S]=s.useState(""),L=s.useRef(null);s.useEffect(()=>{L.current&&L.current.focus()},[]);const $=y=>Q(this,null,function*(){var k,j;if(!y||y.trim()===""){P("Kod kiriting");return}try{h(!0),P(""),S(""),console.log("ðŸ” QR Scanner: Mahsulot qidirilmoqda...",y);const f=yield U.get(`/products/scan-qr/${y.trim()}`);if(f.data.success&&f.data.product){console.log("âœ… QR Scanner: Mahsulot topildi",f.data.product);const R=f.data.product;S(`${R.name} topildi! Mavjud: ${R.quantity} ta`),setTimeout(()=>{a(R),g(""),S(""),L.current&&L.current.focus()},500)}else P("Mahsulot topilmadi")}catch(f){console.error("âŒ QR Scanner xatosi:",f),P(((j=(k=f.response)==null?void 0:k.data)==null?void 0:j.message)||"Mahsulot topilmadi")}finally{h(!1)}}),C=y=>{y.key==="Enter"&&$(i)},m=()=>{$(i)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-scale-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(Zt,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"QR Scanner"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Mahsulot kodini kiriting"})]})]}),e.jsx("button",{onClick:o,className:"w-10 h-10 rounded-full hover:bg-slate-100 flex items-center justify-center transition-colors",children:e.jsx(ge,{className:"w-5 h-5 text-slate-600"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mahsulot Kodi"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:L,type:"text",value:i,onChange:y=>g(y.target.value),onKeyPress:C,placeholder:"Kodni kiriting yoki skanerlang...",className:"flex-1 px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",disabled:v,autoFocus:!0}),e.jsx("button",{onClick:m,disabled:v||!i,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Qidirilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Zt,{className:"w-5 h-5"}),"Qidirish"]})})]})]}),q&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-xl text-red-700",children:[e.jsx(ca,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium",children:q})]}),w&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-xl text-green-700",children:[e.jsx(oa,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium",children:w})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Qanday ishlatish?"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Mahsulot kodini kiriting"}),e.jsx("li",{children:"â€¢ Yoki QR kod skanerdan foydalaning"}),e.jsx("li",{children:"â€¢ Enter tugmasini bosing"}),e.jsx("li",{children:"â€¢ Mahsulot avtomatik kassaga qo'shiladi"})]})]}),n&&e.jsxs("div",{className:"bg-slate-100 rounded-xl p-8 text-center",children:[e.jsx(sr,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Kamera skaneri tez orada..."})]})]}),e.jsx("div",{className:"mt-6 flex gap-3",children:e.jsx("button",{onClick:o,className:"flex-1 px-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-all",children:"Yopish"})})]})})}const Mt=["Mebel furnitura","Yumshoq mebel","Linoleum uy","Linoleum avto","Paralon","Fant (avtomobil)","Avto mato","Klyonka","Boshqa"];function en(a,o){const[n,x]=s.useState(a);return s.useEffect(()=>{const i=setTimeout(()=>{x(a)},o);return()=>{clearTimeout(i)}},[a,o]),n}function va(a,o){const n=a.toLowerCase(),x=o.toLowerCase();if(x===n)return 100;if(x.startsWith(n))return 90;if(x.includes(n))return 70;let i=0,g=0;for(let v=0;v<x.length&&g<n.length;v++)x[v]===n[g]&&(i+=10,g++);return g===n.length?i:0}function Wt(){const a=Ks(),{showAlert:o,AlertComponent:n}=Ps();Gr();const[x,i]=s.useState("products"),[g,v]=s.useState(!1),[h,q]=s.useState([]),[P,w]=s.useState([]),[S,L]=s.useState(20),[$,C]=s.useState([]),[m,y]=s.useState(""),[k,j]=s.useState(!1),[f,R]=s.useState(!1),[W,J]=s.useState(""),[ue,de]=s.useState([]),[K,Se]=s.useState([]),[je,Me]=s.useState(!1),[V,Ne]=s.useState([]),[E,ce]=s.useState(null),[be,Le]=s.useState(!1),[O,_]=s.useState(""),[D,we]=s.useState(0),[Z,oe]=s.useState(0),[Ce,Qe]=s.useState(0),[_e,Oe]=s.useState(null),[ts,He]=s.useState(!1),[u,ee]=s.useState(!1),[Ie,qe]=s.useState(""),[ne,Ze]=s.useState(""),[X,ve]=s.useState(null),[M,Te]=s.useState(!1),[Re,Ue]=s.useState(!1),[Ye,Ss]=s.useState([]),[I,he]=s.useState(!1),[me,ze]=s.useState(!1),[t,A]=s.useState(null),[G,se]=s.useState(0),[ss,as]=s.useState(!1),[is,Je]=s.useState(!0),[os,bs]=s.useState(""),Is=s.useRef(null),Cs=s.useRef(null),zs=en(W,300),Es=s.useCallback(c=>{if(!c||c.length<1){de([]),as(!1);return}as(!0);const F=h.map(ie=>{const ye=va(c,ie.name),xs=va(c,ie.code),l=Math.max(ye,xs);return{product:ie,score:l}}).filter(ie=>ie.score>0).sort((ie,ye)=>ye.score-ie.score).slice(0,20).map(ie=>ie.product);de(F),as(!1)},[h]);s.useEffect(()=>{Es(zs)},[zs,Es]),s.useEffect(()=>{const c=F=>{(F.ctrlKey||F.metaKey)&&F.key==="k"&&(F.preventDefault(),R(!0),setTimeout(()=>{var ie;return(ie=Cs.current)==null?void 0:ie.focus()},100)),F.key==="Escape"&&f&&(R(!1),J(""))};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[f]),s.useEffect(()=>{Ts(),Ns(),js(),te();const c=localStorage.getItem("pendingReceipt");if(c)try{const F=JSON.parse(c);if(F.customer&&ce(F.customer),F.items&&F.items.length>0){const ie=F.items.map(ye=>({_id:ye.product||ye._id,name:ye.name,code:ye.code||"",price:ye.price,cartQuantity:ye.quantity,quantity:999}));C(ie)}localStorage.removeItem("pendingReceipt"),setTimeout(()=>{j(!0)},500),o("Chek yuklandi! To'lov qilishingiz mumkin.","Muvaffaqiyat","success")}catch(F){console.error("Error loading pending receipt:",F),localStorage.removeItem("pendingReceipt")}},[]),s.useEffect(()=>{let c=h;os&&(c=c.filter(F=>F.category===os)),w(c.slice(0,S))},[h,S,os]),s.useEffect(()=>{const c=Is.current;if(!c)return;const F=()=>{const{scrollTop:ie,scrollHeight:ye,clientHeight:xs}=c;ye-ie<=xs*1.5&&S<h.length&&L(l=>Math.min(l+20,h.length))};return c.addEventListener("scroll",F),()=>c.removeEventListener("scroll",F)},[S,h.length]);const Ts=()=>Q(this,null,function*(){Je(!0);try{if(navigator.onLine){const c=yield U.get("/products?mainOnly=true&limit=1000"),F=c.data.data||c.data,ie=Array.isArray(F)?F:[];q(ie),yield _a(ie)}else{const c=yield Ft();q(c)}}catch(c){console.error("Error fetching products:",c);const F=yield Ft();F.length>0&&q(F)}finally{Je(!1)}}),gs=c=>{if(c.images&&c.images.length>0){let F=typeof c.images[0]=="string"?c.images[0]:c.images[0].path;if(F&&(F.startsWith("http://")||F.startsWith("https://")))try{F=new URL(F).pathname}catch(ie){console.warn("Invalid image URL:",F)}return F&&!F.startsWith("/")&&(F="/"+F),F?`${Ls}${F}`:null}return null},Ns=()=>Q(this,null,function*(){try{const c=yield U.get("/customers/kassa");Ne(c.data)}catch(c){console.error("Error fetching customers:",c)}}),js=()=>Q(this,null,function*(){he(!0);try{const c=yield U.get("/receipts/kassa");Ss(c.data||[])}catch(c){console.error("Error fetching helper receipts:",c),o("Cheklar yuklanmadi","Xatolik","danger")}finally{he(!1)}}),d=c=>{const F=c.items.map(ie=>{var ye,xs,l;return{_id:((ye=ie.product)==null?void 0:ye._id)||ie.product,name:((xs=ie.product)==null?void 0:xs.name)||ie.name,code:((l=ie.product)==null?void 0:l.code)||ie.code||"",price:ie.price,cartQuantity:ie.quantity,quantity:999}});C(F),i("products"),o("Chek savatga yuklandi!","Muvaffaqiyat","success")},te=()=>{const c=localStorage.getItem("savedReceipts");c&&Se(JSON.parse(c))},r=()=>Q(this,null,function*(){var c,F,ie,ye,xs,l;if(!Ie.trim()||!ne.trim()){o("Ism va telefon raqamini kiriting!","Ogohlantirish","warning");return}try{console.log("ðŸ“¤ Yangi mijoz yaratish so'rovi:",{name:Ie.trim(),phone:ne.trim()});const z=yield U.post("/customers/kassa",{name:Ie.trim(),phone:ne.trim()});if(console.log("âœ… Mijoz yaratish javobi:",z.data),z.data.success){const B=z.data.customer;Ne(le=>[...le,B]),ce(B),ee(!1),qe(""),Ze(""),o("Yangi mijoz qo'shildi!","Muvaffaqiyat","success"),console.log("âœ… Mijoz muvaffaqiyatli qo'shildi:",B)}}catch(z){if(console.error("âŒ Mijoz yaratishda xatolik:",z),console.error("Xato tafsilotlari:",(c=z.response)==null?void 0:c.data),((F=z.response)==null?void 0:F.status)===400&&((ye=(ie=z.response)==null?void 0:ie.data)!=null&&ye.existingCustomer)){const B=z.response.data.existingCustomer;ce(B),ee(!1),qe(""),Ze(""),o("Bu mijoz allaqachon mavjud. Tanlandi.","Ma'lumot","info"),console.log("â„¹ï¸ Mavjud mijoz tanlandi:",B)}else o(((l=(xs=z.response)==null?void 0:xs.data)==null?void 0:l.message)||"Mijoz qo'shishda xatolik","Xatolik","danger")}}),T=$.reduce((c,F)=>{const ie=F.discountedPrice||F.price;return c+ie*F.cartQuantity},0),H=$.reduce((c,F)=>c+F.cartQuantity,0),Y=c=>{if(c.quantity<=0){o(`${c.name} tugagan! Mavjud emas.`,"Ogohlantirish","warning");return}const F=$.find(ye=>ye._id===c._id);if((F?F.cartQuantity:0)>=c.quantity){o(`${c.name} - maksimal miqdor: ${c.quantity}`,"Ogohlantirish","warning");return}C(ye=>ye.find(l=>l._id===c._id)?ye.map(l=>l._id===c._id?N(b({},l),{cartQuantity:l.cartQuantity+1}):l):[...ye,N(b({},c),{cartQuantity:1})]),R(!1),J("")},ae=c=>{Y(c),o(`${c.name} savatga qo'shildi`,"Muvaffaqiyat","success"),Ue(!1)},fe=c=>{C(F=>F.filter(ie=>ie._id!==c))},re=(c,F)=>{C(ie=>ie.map(ye=>ye._id===c?N(b({},ye),{cartQuantity:Math.max(0,F)}):ye))},pe=(c,F)=>{C(ie=>ie.map(ye=>{if(ye._id!==c)return ye;if(!F||!ye.pricingTiers||!ye.pricingTiers[F])return N(b({},ye),{selectedTier:null,discountedPrice:void 0});const l=ye.pricingTiers[F].discountPercent,z=ye.price*(1-l/100);return N(b({},ye),{selectedTier:F,discountedPrice:z})}))},De=()=>Q(this,null,function*(){var xs,l,z;if($.length===0)return;const c=Z+Ce,F=T-c;if(F>0&&!E){o("Qarzga sotish uchun mijozni tanlang yoki yangi mijoz qo'shing!","Ogohlantirish","warning");return}let ie;Z>0&&Ce>0?ie="mixed":Z>0?ie="cash":ie="card";const ye={items:$.map(B=>({product:B._id,name:B.name,code:B.code,price:B.price,quantity:B.cartQuantity})),total:T,paidAmount:c,cashAmount:Z,cardAmount:Ce,paymentMethod:ie,isReturn:je,customer:E==null?void 0:E._id};try{if(navigator.onLine){console.log("ðŸ“¤ Chek yuborish boshlandi:",ye);const B=yield U.post("/receipts",ye);console.log("âœ… Server javobi:",B.data),F>0&&E?o(`To'lov qabul qilindi! Qarz: ${p(F)} so'm`,"Muvaffaqiyat","success"):o(je?"Qaytarish muvaffaqiyatli!":"Chek saqlandi!","Muvaffaqiyat","success"),Ve(B.data,ie,c,F,Z,Ce),C([]),j(!1),He(!1),Oe(null),Me(!1),oe(0),Qe(0),we(0),ce(null),Ts()}else o("Internet aloqasi yo'q. Iltimos, internetni yoqing.","Xatolik","danger")}catch(B){console.error("âŒ Xatolik:",B),console.error("Xato tafsilotlari:",(xs=B.response)==null?void 0:xs.data);const le=((z=(l=B.response)==null?void 0:l.data)==null?void 0:z.message)||B.message||"Xatolik yuz berdi";o(le,"Xatolik","danger")}}),Ve=(c,F,ie,ye,xs,l)=>{const z=window.open("","","height=600,width=400");if(!z)return;const B=ie||c.total,le=ye||0,ke=xs||0,Pe=l||0;let $e="";F==="mixed"?$e=`Naqd: ${p(ke)} so'm, Karta: ${p(Pe)} so'm`:F==="cash"?$e="Naqd pul":$e="Karta";let Fe=0,Ae=0;const Be=$.map(xe=>{var ns,As;const cs=xe.discountedPrice||xe.price,qs=xe.price,Ds=(qs-cs)*xe.cartQuantity;return Fe+=Ds,Ae+=qs*xe.cartQuantity,N(b({},xe),{currentPrice:cs,originalPrice:qs,hasDiscount:!!xe.discountedPrice,discountPercent:xe.selectedTier&&((As=(ns=xe.pricingTiers)==null?void 0:ns[xe.selectedTier])==null?void 0:As.discountPercent)||0})}),Ee=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Chek</title>
        <style>
          body { font-family: monospace; margin: 0; padding: 10px; font-size: 12px; }
          .header { text-align: center; margin-bottom: 10px; border-bottom: 1px dashed #000; padding-bottom: 10px; }
          .title { font-weight: bold; font-size: 14px; }
          .items { margin: 10px 0; border-bottom: 1px dashed #000; padding-bottom: 10px; }
          .item { margin: 8px 0; }
          .item-header { display: flex; justify-content: space-between; font-weight: bold; }
          .item-details { font-size: 10px; color: #666; margin-top: 2px; }
          .discount-badge { color: #d00; font-weight: bold; }
          .original-price { text-decoration: line-through; color: #999; }
          .total { font-weight: bold; font-size: 14px; text-align: right; margin: 10px 0; }
          .discount-summary { background: #f0f0f0; padding: 8px; margin: 10px 0; border-radius: 4px; }
          .payment-info { margin: 10px 0; border-top: 1px dashed #000; padding-top: 10px; }
          .footer { text-align: center; margin-top: 10px; font-size: 10px; }
          .debt-warning { color: #d00; font-weight: bold; text-align: center; margin: 10px 0; }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="title">CHEK</div>
          <div>${new Date().toLocaleString("uz-UZ")}</div>
        </div>
        
        <div class="items">
          ${Be.map(xe=>`
            <div class="item">
              <div class="item-header">
                <span>${xe.name}</span>
                <span>${p(xe.currentPrice*xe.cartQuantity)} so'm</span>
              </div>
              <div class="item-details">
                ${xe.quantity} x ${p(xe.currentPrice)} so'm
                ${xe.hasDiscount?`
                  <br>
                  <span class="discount-badge">-${xe.discountPercent}% skidka</span>
                  <span class="original-price">(${p(xe.originalPrice)} so'm)</span>
                `:""}
              </div>
            </div>
          `).join("")}
        </div>
        
        ${Fe>0?`
          <div class="discount-summary">
            <div style="display: flex; justify-content: space-between; margin: 3px 0;">
              <span>Asl narx:</span>
              <span>${p(Ae)} so'm</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin: 3px 0; color: #d00; font-weight: bold;">
              <span>Skidka:</span>
              <span>-${p(Fe)} so'm</span>
            </div>
          </div>
        `:""}
        
        <div class="total">
          Jami: ${p(c.total)} so'm
        </div>
        
        <div class="payment-info">
          ${F==="mixed"?`
            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
              <span>Naqd:</span>
              <span>${p(ke)} so'm</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
              <span>Karta:</span>
              <span>${p(Pe)} so'm</span>
            </div>
          `:""}
          <div style="display: flex; justify-content: space-between; margin: 5px 0; font-weight: bold;">
            <span>To'landi:</span>
            <span>${p(B)} so'm</span>
          </div>
          ${le>0?`
            <div class="debt-warning">
              Qarz: ${p(le)} so'm
            </div>
          `:""}
        </div>
        
        <div class="footer">
          To'lov: ${$e}
          ${Fe>0?`<br>Siz ${p(Fe)} so'm tejadingiz!`:""}
          <br>
          Raxmat!
        </div>
      </body>
      </html>
    `;z.document.write(Ee),z.document.close(),setTimeout(()=>{z.print()},250)},vs=c=>Q(this,null,function*(){const F=window.open("","_blank","width=600,height=400");if(!F){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}const ie=c.map(l=>Q(this,null,function*(){try{const z=yield Fr(()=>import("./qrcode-vendor-DgV9WI2I.js").then(Pe=>Pe.b),__vite__mapDeps([0,1])),B=z.default||z,le=`${window.location.origin}/product/${l._id}`,ke=yield B.toDataURL(le,{width:300,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});return{product:l,qrDataUrl:ke}}catch(z){return console.error("QR generation error:",z),{product:l,qrDataUrl:""}}})),ye=yield Promise.all(ie);let xs="";ye.forEach(({product:l,qrDataUrl:z})=>{xs+=`
        <div class="label">
          <div class="top-section">
            <div class="qr-box">
              <img src="${z}" alt="QR" class="qr-code" />
            </div>
            <div class="info-box">
              <div class="product-code">Kod: ${l.code}</div>
              <div class="product-name">${l.name}</div>
            </div>
          </div>
          <div class="bottom-section">
            <div class="price-box">
              <span class="price-value">${p(l.price)}</span>
              <span class="price-currency">so'm</span>
            </div>
          </div>
        </div>
      `}),F.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Label</title>
        <style>
          @page {
            size: 60mm 40mm;
            margin: 0;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, Helvetica, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .label {
            width: 60mm;
            height: 40mm;
            padding: 2mm;
            background: white;
            display: flex;
            flex-direction: column;
            page-break-after: always;
          }
          .label:last-child {
            page-break-after: auto;
          }
          .top-section {
            display: flex;
            gap: 2mm;
            flex: 1;
          }
          .qr-box {
            width: 22mm;
            height: 22mm;
            flex-shrink: 0;
          }
          .qr-code {
            width: 22mm;
            height: 22mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
          }
          .product-code {
            font-size: 7pt;
            font-weight: 600;
            color: #666;
            margin-bottom: 1mm;
          }
          .product-name {
            font-size: 9pt;
            font-weight: 700;
            color: #000;
            line-height: 1.2;
            text-transform: uppercase;
            word-break: break-word;
          }
          .bottom-section {
            margin-top: 1.5mm;
          }
          .price-box {
            padding: 1.5mm;
            text-align: center;
            background: #f0f0f0;
            border-radius: 1mm;
          }
          .price-value {
            font-size: 14pt;
            font-weight: 900;
            color: #000;
            letter-spacing: -0.5px;
          }
          .price-currency {
            font-size: 10pt;
            font-weight: 700;
            color: #000;
            margin-left: 1mm;
          }
          @media print {
            body { background: white; }
          }
          @media screen {
            body { background: #e5e7eb; padding: 10mm; }
            .label { 
              margin-bottom: 5mm;
              box-shadow: 0 2px 8px rgba(0,0,0,0.1);
              border: 1px solid #ddd;
            }
          }
        </style>
      </head>
      <body>
        ${xs}
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 200);
          }
        <\/script>
      </body>
      </html>
    `),F.document.close()}),ps=()=>{if($.length===0){o("Chek bo'sh","Ogohlantirish","warning");return}const c={id:Date.now().toString(),items:[...$],total:T,savedAt:new Date().toLocaleString()},F=[...K,c];Se(F),localStorage.setItem("savedReceipts",JSON.stringify(F)),C([]),o("Chek saqlandi!","Muvaffaqiyat","success")},ks=c=>{C(c.items);const F=K.filter(ie=>ie.id!==c.id);Se(F),localStorage.setItem("savedReceipts",JSON.stringify(F)),Te(!1)},$s=c=>{const F=K.filter(ie=>ie.id!==c);Se(F),localStorage.setItem("savedReceipts",JSON.stringify(F))};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100 pb-20 lg:pb-0",children:[n,e.jsx("header",{className:"bg-white border-b border-slate-200 sticky top-0 z-40 shadow-sm",children:e.jsxs("div",{className:"max-w-[1800px] mx-auto px-3 sm:px-4 lg:px-6 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>v(!0),className:"p-2 rounded-lg bg-slate-50 hover:bg-slate-100 text-slate-600 hover:text-slate-900 transition-colors active:scale-95 flex-shrink-0 flex sm:hidden",title:"Menyuni ochish",children:e.jsx(Tt,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-gradient-to-br from-purple-500 via-purple-600 to-blue-600 flex items-center justify-center shadow-xl",children:e.jsx(hs,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white drop-shadow-lg"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-extrabold bg-gradient-to-r from-purple-600 via-blue-600 to-purple-600 bg-clip-text text-transparent leading-tight",children:"Kassa (POS)"}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500 font-medium mt-0.5",children:"Professional Sotish Tizimi"})]})]}),e.jsxs("button",{onClick:()=>Te(!0),className:"flex items-center gap-2 px-3 sm:px-4 py-2 bg-gradient-to-r from-purple-100 to-blue-100 hover:from-purple-200 hover:to-blue-200 rounded-xl text-sm font-bold text-purple-700 transition-all shadow-md hover:shadow-lg",children:[e.jsx(It,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Saqlangan"}),K.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-red-500 text-white text-xs rounded-full font-bold shadow-md",children:K.length})]})]})}),e.jsx("div",{className:"max-w-[1800px] mx-auto p-2 sm:p-4 lg:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3 sm:gap-4 lg:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-2 sm:space-y-3 lg:space-y-4 order-2 lg:order-1",children:[e.jsxs("div",{className:"flex gap-2 bg-white p-2 rounded-xl border-2 border-slate-200 shadow-sm",children:[e.jsxs("button",{onClick:()=>i("products"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-semibold text-sm transition-all ${x==="products"?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-md":"bg-slate-50 text-slate-600 hover:bg-slate-100"}`,children:[e.jsx(et,{className:"w-4 h-4"}),"Mahsulotlar"]}),e.jsxs("button",{onClick:()=>i("receipts"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-semibold text-sm transition-all ${x==="receipts"?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-md":"bg-slate-50 text-slate-600 hover:bg-slate-100"}`,children:[e.jsx(Xs,{className:"w-4 h-4"}),"Cheklar",Ye.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-red-500 text-white text-xs rounded-full font-bold",children:Ye.length})]})]}),x==="products"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative group",children:[e.jsx(fs,{className:"absolute left-3 sm:left-4 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-slate-400 group-focus-within:text-brand-500 transition-colors"}),e.jsx("input",{ref:Cs,type:"text",placeholder:"Mahsulot qidirish... (Ctrl+K)",value:W,onChange:c=>J(c.target.value),onFocus:()=>R(!0),className:"w-full pl-9 sm:pl-12 pr-10 sm:pr-12 py-2 sm:py-3 bg-white border-2 border-slate-200 rounded-lg sm:rounded-xl focus:outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/20 text-xs sm:text-sm transition-all"}),W&&e.jsx("button",{onClick:()=>{J(""),R(!1)},className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(ge,{className:"w-4 h-4 text-slate-400"})}),ss&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-brand-500 border-t-transparent rounded-full animate-spin"})})]}),e.jsx("div",{className:"bg-white rounded-lg sm:rounded-xl p-2 sm:p-3 border-2 border-slate-200",children:e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide",children:[e.jsx("button",{onClick:()=>bs(""),className:`flex-shrink-0 px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg font-medium text-xs sm:text-sm transition-all ${os===""?"bg-brand-500 text-white shadow-md":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:"Barchasi"}),Mt.map(c=>e.jsx("button",{onClick:()=>bs(c),className:`flex-shrink-0 px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg font-medium text-xs sm:text-sm transition-all whitespace-nowrap ${os===c?"bg-brand-500 text-white shadow-md":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:c},c))]})}),f&&W?e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 overflow-hidden shadow-lg",children:[e.jsxs("div",{className:"px-3 py-2 bg-slate-50 border-b border-slate-200 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-semibold text-slate-600",children:[ue.length," ta natija"]}),e.jsx("button",{onClick:()=>{R(!1),J("")},className:"text-xs text-slate-500 hover:text-slate-700",children:"Yopish (Esc)"})]}),e.jsx("div",{className:"max-h-64 sm:max-h-96 overflow-y-auto",children:ue.length>0?e.jsx("div",{className:"divide-y divide-slate-100",children:ue.map(c=>e.jsxs("button",{onClick:()=>{A(c),se(0),ze(!0),R(!1),J("")},disabled:c.quantity<=0,className:`w-full flex items-center gap-2 sm:gap-4 p-2 sm:p-4 hover:bg-slate-50 transition-colors text-left ${c.quantity<=0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-brand-100 to-brand-50 rounded-xl border-2 border-brand-200 flex items-center justify-center flex-shrink-0 overflow-hidden relative",children:[c.quantity<=0&&e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center z-10",children:e.jsx("span",{className:"text-white text-[8px] font-bold",children:"TUGAGAN"})}),c.images&&c.images.length>0?e.jsx("img",{src:`${Ls}${c.images[0]}`,alt:c.name,className:"w-full h-full object-cover",onError:F=>{F.currentTarget.style.display="none";const ie=F.currentTarget.parentElement;ie&&(ie.innerHTML='<svg class="w-5 h-5 sm:w-6 sm:h-6 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>')}}):e.jsx(et,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-slate-900 truncate text-xs sm:text-sm",children:c.name}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-slate-500",children:["Kod: ",c.code]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"font-bold text-brand-600 text-xs sm:text-sm",children:[p(c.price)," so'm"]}),e.jsxs("p",{className:`text-[10px] sm:text-xs font-semibold ${c.quantity<=0?"text-red-600":c.quantity<=10?"text-orange-600":"text-green-600"}`,children:[c.quantity," ta"]})]})]},c._id))}):e.jsxs("div",{className:"p-6 sm:p-8 text-center text-slate-500",children:[e.jsx(et,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 opacity-30"}),e.jsx("p",{className:"text-xs sm:text-sm",children:"Mahsulot topilmadi"})]})})]}):e.jsx("div",{ref:Is,className:"max-h-[calc(100vh-250px)] overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-2 sm:gap-3",children:P.map(c=>e.jsxs("div",{className:"group bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 hover:border-brand-300 hover:shadow-lg transition-all p-2 sm:p-4 relative",children:[e.jsxs("button",{onClick:F=>{F.stopPropagation(),vs([c])},className:"absolute top-2 right-2 w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 z-10 group/qr",title:"QR code chiqarish",children:[e.jsx(Zt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white drop-shadow-lg"}),e.jsx("span",{className:"absolute -bottom-8 right-0 bg-slate-900 text-white text-[10px] px-2 py-1 rounded-lg opacity-0 group-hover/qr:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:"QR Print"})]}),e.jsxs("button",{onClick:()=>{A(c),se(0),ze(!0)},disabled:c.quantity<=0,className:`w-full text-left ${c.quantity<=0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"w-full aspect-square bg-gradient-to-br from-brand-100 to-brand-50 rounded-xl border-2 border-brand-200 flex items-center justify-center mb-2 sm:mb-3 group-hover:scale-105 transition-transform overflow-hidden relative",children:[c.quantity<=0&&e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center z-10",children:e.jsx("div",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold",children:"TUGAGAN"})}),c.images&&c.images.length>0?e.jsx("img",{src:`${Ls}${c.images[0]}`,alt:c.name,className:"w-full h-full object-cover",onError:F=>{F.currentTarget.style.display="none";const ie=F.currentTarget.parentElement;ie&&(ie.innerHTML='<svg class="w-6 h-6 sm:w-8 sm:h-8 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>')}}):e.jsx(et,{className:"w-6 h-6 sm:w-8 sm:h-8 text-brand-600"})]}),e.jsx("p",{className:"font-semibold text-slate-900 text-[10px] sm:text-sm truncate",children:c.name}),e.jsx("p",{className:"text-[9px] sm:text-xs text-slate-500 mb-1 sm:mb-2",children:c.code}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"font-bold text-brand-600 text-[10px] sm:text-sm",children:[p(c.price)," so'm"]}),c.quantity<=0?e.jsx("span",{className:"text-[9px] sm:text-xs text-red-600 font-semibold",children:"0 ta"}):c.quantity<=10?e.jsxs("span",{className:"text-[9px] sm:text-xs text-orange-600 font-semibold",children:[c.quantity," ta"]}):e.jsxs("span",{className:"text-[9px] sm:text-xs text-green-600 font-semibold",children:[c.quantity," ta"]})]})]})]},c._id))})})]}),x==="receipts"&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-slate-200 shadow-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Hodimlardan kelgan cheklar"}),e.jsx("button",{onClick:js,disabled:I,className:"p-2 rounded-lg bg-brand-50 hover:bg-brand-100 text-brand-600 transition-colors disabled:opacity-50",children:e.jsx(Os,{className:`w-5 h-5 ${I?"animate-spin":""}`})})]}),I?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-brand-500 border-t-transparent rounded-full animate-spin"})}):Ye.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(Xs,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"Cheklar yo'q"})]}):e.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:Ye.map(c=>e.jsxs("div",{className:"border-2 border-slate-200 rounded-xl p-4 hover:border-brand-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-slate-900",children:["Chek #",c.receiptNumber||c._id.slice(-6)]}),e.jsx("p",{className:"text-xs text-slate-500",children:new Date(c.createdAt).toLocaleString("uz-UZ")}),c.createdBy&&e.jsxs("p",{className:"text-xs text-brand-600 font-medium mt-1",children:["ðŸ‘¤ Hodim: ",c.createdBy.name]}),c.customer&&e.jsxs("p",{className:"text-xs text-green-600 font-medium mt-1",children:["ðŸ›’ Mijoz: ",c.customer.name||"Oddiy mijoz"]})]}),e.jsxs("button",{onClick:()=>d(c),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white rounded-lg font-semibold text-sm shadow-md hover:shadow-lg transition-all",children:[e.jsx(hs,{className:"w-4 h-4"}),"Yuklash"]})]}),e.jsx("div",{className:"space-y-2 mb-3",children:c.items.map((F,ie)=>e.jsxs("div",{className:"flex justify-between text-sm bg-slate-50 p-2 rounded-lg",children:[e.jsxs("span",{className:"text-slate-700",children:[F.name," Ã— ",F.quantity]}),e.jsxs("span",{className:"font-semibold text-slate-900",children:[p(F.price*F.quantity)," so'm"]})]},ie))}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-slate-200",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Jami:"}),e.jsxs("span",{className:"text-xl font-bold text-brand-600",children:[p(c.totalAmount||c.total)," so'm"]})]})]},c._id))})]})]}),e.jsx("div",{className:"lg:col-span-1 order-1 lg:order-2",children:e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-2xl border-2 border-slate-200 shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-3 sm:px-6 py-3 sm:py-4 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-1 sm:mb-2",children:[e.jsx(hs,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("h2",{className:"text-base sm:text-lg font-bold",children:"Savat"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-brand-100",children:[H," ta mahsulot"]})]}),e.jsx("div",{className:"max-h-48 sm:max-h-64 overflow-y-auto divide-y divide-slate-100",children:$.length===0?e.jsxs("div",{className:"p-4 sm:p-8 text-center text-slate-400",children:[e.jsx(hs,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 opacity-30"}),e.jsx("p",{className:"text-xs sm:text-sm",children:"Savat bo'sh"})]}):$.map(c=>{var l,z,B;const F=h.find(le=>le._id===c._id),ie=F&&c.cartQuantity>F.quantity,ye=c.discountedPrice||c.price,xs=c.pricingTiers&&(c.pricingTiers.tier1||c.pricingTiers.tier2||c.pricingTiers.tier3);return e.jsxs("div",{className:"p-2 sm:p-3 hover:bg-slate-50 transition-colors border-b border-slate-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"font-semibold text-slate-900 text-xs truncate",children:c.name}),ie&&e.jsx("span",{className:"px-1.5 py-0.5 bg-yellow-100 text-yellow-700 text-[9px] font-semibold rounded whitespace-nowrap",children:"Kam!"})]}),e.jsx("p",{className:"text-[10px] text-slate-500",children:c.code})]}),e.jsx("button",{onClick:()=>fe(c._id),className:"text-slate-400 hover:text-red-500 transition-colors flex-shrink-0 ml-2",children:e.jsx(ge,{className:"w-3 h-3"})})]}),xs&&e.jsxs("div",{className:"grid grid-cols-3 gap-1 mb-2",children:[((l=c.pricingTiers)==null?void 0:l.tier1)&&e.jsxs("button",{onClick:()=>pe(c._id,c.selectedTier==="tier1"?null:"tier1"),className:`px-1.5 py-1 rounded text-[9px] font-semibold transition-all ${c.selectedTier==="tier1"?"bg-green-500 text-white shadow-md":"bg-green-50 text-green-700 hover:bg-green-100"}`,children:["-",c.pricingTiers.tier1.discountPercent,"%"]}),((z=c.pricingTiers)==null?void 0:z.tier2)&&e.jsxs("button",{onClick:()=>pe(c._id,c.selectedTier==="tier2"?null:"tier2"),className:`px-1.5 py-1 rounded text-[9px] font-semibold transition-all ${c.selectedTier==="tier2"?"bg-blue-500 text-white shadow-md":"bg-blue-50 text-blue-700 hover:bg-blue-100"}`,children:["-",c.pricingTiers.tier2.discountPercent,"%"]}),((B=c.pricingTiers)==null?void 0:B.tier3)&&e.jsxs("button",{onClick:()=>pe(c._id,c.selectedTier==="tier3"?null:"tier3"),className:`px-1.5 py-1 rounded text-[9px] font-semibold transition-all ${c.selectedTier==="tier3"?"bg-purple-500 text-white shadow-md":"bg-purple-50 text-purple-700 hover:bg-purple-100"}`,children:["-",c.pricingTiers.tier3.discountPercent,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:c.cartQuantity===0?"":c.cartQuantity,onChange:le=>{const ke=le.target.value;if(ke===""){re(c._id,0);return}const Pe=parseInt(ke);!isNaN(Pe)&&Pe>=0&&re(c._id,Pe)},onBlur:le=>{(c.cartQuantity===0||le.target.value==="")&&re(c._id,1)},onClick:le=>le.currentTarget.select(),placeholder:"1",className:"w-14 text-center text-xs font-bold bg-slate-100 border-2 border-slate-200 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20 rounded-lg py-1.5 cursor-pointer hover:bg-slate-50 transition-colors"})}),e.jsxs("div",{className:"text-right",children:[c.discountedPrice&&e.jsxs("p",{className:"text-[9px] text-slate-400 line-through",children:[p(c.price*c.cartQuantity)," so'm"]}),e.jsxs("p",{className:"font-bold text-brand-600 text-xs",children:[p(ye*c.cartQuantity)," so'm"]})]})]})]},c._id)})}),$.length>0&&e.jsxs("div",{className:"border-t border-slate-200 p-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-600 mb-2 block",children:"Mijoz"}),e.jsxs("button",{onClick:()=>Le(!be),className:"w-full flex items-center gap-2 px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-medium text-slate-700 transition-colors",children:[e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{className:"flex-1 text-left truncate",children:E?E.name:"Oddiy mijoz"}),e.jsx(pt,{className:"w-4 h-4"})]}),be&&e.jsxs("div",{className:"absolute right-0 left-0 mx-4 mt-2 bg-white rounded-lg shadow-xl border border-slate-200 z-50 max-h-48 overflow-y-auto",children:[e.jsx("button",{onClick:()=>{ce(null),Le(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 border-b border-slate-100",children:"Oddiy mijoz"}),V.map(c=>e.jsxs("button",{onClick:()=>{ce(c),Le(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 border-b border-slate-100 last:border-b-0",children:[e.jsx("p",{className:"font-medium text-slate-900",children:c.name}),e.jsx("p",{className:"text-xs text-slate-500",children:c.phone})]},c._id))]})]}),$.length>0&&e.jsxs("div",{className:"border-t border-slate-200 p-3 sm:p-6 space-y-2 sm:space-y-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-50 to-blue-50 rounded-xl p-3 sm:p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm sm:text-base font-semibold text-slate-700",children:"Jami:"}),e.jsxs("span",{className:"text-xl sm:text-2xl font-bold text-brand-600",children:[p(T)," so'm"]})]})}),e.jsxs("button",{onClick:()=>j(!0),className:"w-full bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white font-bold py-2 sm:py-3 rounded-lg sm:rounded-xl transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2 text-xs sm:text-sm",children:[e.jsx(Vs,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"To'lash"]}),e.jsxs("button",{onClick:ps,className:"w-full bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold py-1.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors flex items-center justify-center gap-2 text-xs sm:text-sm",children:[e.jsx(It,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Saqlash"]}),e.jsxs("button",{onClick:()=>C([]),className:"w-full bg-red-50 hover:bg-red-100 text-red-600 font-semibold py-1.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors flex items-center justify-center gap-2 text-xs sm:text-sm",children:[e.jsx(_s,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Tozalash"]})]})]})})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full my-8 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-6 py-4 text-white",children:e.jsx("h3",{className:"text-xl font-bold",children:"To'lov"})}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[calc(100vh-200px)] overflow-y-auto",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Jami summa"}),e.jsxs("p",{className:"text-3xl font-bold text-brand-600",children:[p(T)," so'm"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700 block",children:"Mijoz"}),u?e.jsxs("div",{className:"space-y-3 p-4 bg-blue-50 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1 block",children:"Ism"}),e.jsx("input",{type:"text",value:Ie,onChange:c=>qe(c.target.value),placeholder:"Mijoz ismi...",className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1 block",children:"Telefon"}),e.jsx("input",{type:"tel",value:ne,onChange:c=>Ze(c.target.value),placeholder:"+998 90 123 45 67",className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:r,className:"flex-1 bg-brand-500 hover:bg-brand-600 text-white font-semibold py-2 rounded-lg transition-colors text-sm",children:"Saqlash"}),e.jsx("button",{onClick:()=>{ee(!1),qe(""),Ze("")},className:"px-4 bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold rounded-lg transition-colors text-sm",children:"Bekor"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:(E==null?void 0:E._id)||"",onChange:c=>{const F=V.find(ie=>ie._id===c.target.value);ce(F||null)},className:"w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",children:[e.jsx("option",{value:"",children:"Oddiy mijoz"}),V.map(c=>e.jsxs("option",{value:c._id,children:[c.name," - ",c.phone]},c._id))]}),e.jsx("button",{onClick:()=>ee(!0),className:"w-full px-4 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 font-semibold rounded-lg transition-colors text-sm",children:"+ Yangi mijoz qo'shish"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2",children:[e.jsx(Sa,{className:"w-4 h-4 text-emerald-600"}),"Naqd pul"]}),e.jsx("input",{type:"number",value:Z||"",onChange:c=>oe(Number(c.target.value)),placeholder:"0",className:"w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 text-lg font-semibold"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2",children:[e.jsx(Vs,{className:"w-4 h-4 text-blue-600"}),"Karta"]}),e.jsx("input",{type:"number",value:Ce||"",onChange:c=>Qe(Number(c.target.value)),placeholder:"0",className:"w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 text-lg font-semibold"})]})]}),(Z>0||Ce>0)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Jami to'lanadi:"}),e.jsxs("span",{className:"font-bold text-slate-900",children:[p(Z+Ce)," so'm"]})]}),Z+Ce<T&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-amber-600",children:"Qarz:"}),e.jsxs("span",{className:"font-bold text-amber-600",children:[p(T-(Z+Ce))," so'm"]})]}),Z+Ce>T&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-600",children:"Qaytim:"}),e.jsxs("span",{className:"font-bold text-green-600",children:[p(Z+Ce-T)," so'm"]})]})]}),Z+Ce<T&&!E&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-3 flex items-start gap-2",children:[e.jsx(Rs,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-900 text-sm",children:"Oddiy mijozga qarzga sotib bo'lmaydi!"}),e.jsx("p",{className:"text-xs text-red-700 mt-1",children:"To'liq to'lov qiling yoki mijozni tanlang"})]})]}),Z+Ce<T&&E&&e.jsxs("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-3 flex items-start gap-2",children:[e.jsx(Rs,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-amber-900 text-sm",children:"Qisman to'lov"}),e.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:[p(T-(Z+Ce))," so'm ",e.jsx("span",{className:"font-bold",children:E.name})," nomiga qarzga yoziladi"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:De,disabled:Z+Ce<=0||Z+Ce<T&&!E,className:"flex-1 bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white font-bold py-3 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:"Tasdiqlash"}),e.jsx("button",{onClick:()=>{j(!1),oe(0),Qe(0),ee(!1),qe(""),Ze("")},className:"px-6 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold rounded-xl transition-colors",children:"Bekor"})]})]})]})}),Re&&e.jsx(Zr,{onScan:ae,onClose:()=>Ue(!1)}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-96 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-6 py-4 text-white flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Saqlangan Cheklar"}),e.jsx("button",{onClick:()=>Te(!1),className:"hover:bg-brand-600 p-2 rounded-lg transition-colors",children:e.jsx(ge,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto divide-y divide-slate-200",children:K.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx(Xs,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"Saqlangan cheklar yo'q"})]}):K.map(c=>e.jsxs("div",{className:"p-4 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-slate-900",children:[c.items.length," ta mahsulot"]}),e.jsx("p",{className:"text-xs text-slate-500",children:c.savedAt})]}),e.jsxs("p",{className:"font-bold text-brand-600",children:[p(c.total)," so'm"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ks(c),className:"flex-1 bg-brand-100 hover:bg-brand-200 text-brand-700 font-semibold py-2 rounded-lg transition-colors text-sm",children:"Yuklash"}),e.jsx("button",{onClick:()=>$s(c.id),className:"flex-1 bg-red-100 hover:bg-red-200 text-red-700 font-semibold py-2 rounded-lg transition-colors text-sm",children:"O'chirish"})]})]},c.id))})]})}),me&&t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-3 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-2xl max-w-sm w-full max-h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-4 py-3 text-white flex items-center justify-between flex-shrink-0",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold",children:"Mahsulot"}),e.jsx("button",{onClick:()=>{ze(!1),A(null),se(0)},className:"hover:bg-brand-600 p-1.5 rounded-lg transition-colors",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-3 overflow-y-auto flex-1",children:[e.jsx("div",{className:"w-full aspect-square bg-gradient-to-br from-brand-100 to-brand-50 rounded-lg border-2 border-brand-200 flex items-center justify-center overflow-hidden",children:t.images&&t.images.length>0?e.jsx("img",{src:gs(t)||"",alt:t.name,className:"w-full h-full object-cover",onError:c=>{c.currentTarget.style.display="none";const F=c.currentTarget.parentElement;F&&(F.innerHTML='<svg class="w-12 h-12 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>')}}):e.jsx(et,{className:"w-12 h-12 text-brand-600"})}),e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Nomi"}),e.jsx("p",{className:"text-base font-bold text-slate-900",children:t.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2.5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Kod"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:t.code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Sotish narxi"}),e.jsxs("p",{className:"text-sm font-bold text-brand-600",children:[p(t.price)," so'm"]})]})]}),(t.costPrice||t.boxPrice)&&e.jsxs("div",{className:"grid grid-cols-2 gap-2.5 bg-slate-50 p-2 rounded-lg",children:[t.costPrice&&t.costPrice>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Tan narxi"}),e.jsxs("p",{className:"text-sm font-semibold text-slate-700",children:[p(t.costPrice)," so'm"]})]}),t.boxPrice&&t.boxPrice>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Karobka narxi"}),e.jsxs("p",{className:"text-sm font-semibold text-slate-700",children:[p(t.boxPrice)," so'm"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Mavjud"}),e.jsxs("p",{className:`font-bold text-base ${t.quantity<=0?"text-red-600":t.quantity<=10?"text-orange-600":"text-green-600"}`,children:[t.quantity," ta"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1.5",children:"Sotish miqdori"}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:G===0?"":G,onChange:c=>{const F=c.target.value;if(F===""){se(0);return}const ie=parseInt(F);!isNaN(ie)&&ie>=0&&se(Math.min(ie,t.quantity))},onBlur:c=>{(G===0||c.target.value==="")&&se(1)},onClick:c=>c.currentTarget.select(),placeholder:"1",className:"w-full px-3 py-2.5 text-center text-lg font-bold bg-slate-100 border-2 border-slate-200 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20 rounded-lg cursor-pointer hover:bg-slate-50 transition-colors"}),G>t.quantity*.5&&t.quantity<=10&&G>0&&e.jsxs("div",{className:"mt-2 bg-yellow-50 border border-yellow-200 rounded-lg p-2 flex items-start gap-2",children:[e.jsx(Rs,{className:"w-4 h-4 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-yellow-900 text-xs",children:"Mahsulot soni kam!"}),e.jsxs("p",{className:"text-[10px] text-yellow-700 mt-0.5",children:["Omborda ",t.quantity," ta qoldi"]})]})]}),e.jsx("div",{className:"mt-2 bg-gradient-to-r from-brand-50 to-blue-50 rounded-lg p-2.5",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"Jami:"}),e.jsxs("span",{className:"text-base font-bold text-brand-600",children:[p(t.price*G)," so'm"]})]})})]}),t.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Ta'rif"}),e.jsx("p",{className:"text-xs text-slate-700 leading-relaxed",children:t.description})]})]})]}),e.jsxs("div",{className:"flex gap-2 p-4 border-t border-slate-200 flex-shrink-0 bg-white",children:[e.jsx("button",{onClick:()=>{ze(!1),A(null),se(0)},className:"flex-1 px-4 py-2.5 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold rounded-lg transition-colors text-sm",children:"Bekor"}),e.jsx("button",{onClick:()=>{if(t){const c=$.find(F=>F._id===t._id);if(c){const F=c.cartQuantity+G;if(F>t.quantity){o(`Maksimal: ${t.quantity} ta`,"Ogohlantirish","warning");return}C(ie=>ie.map(ye=>ye._id===t._id?N(b({},ye),{cartQuantity:F}):ye))}else C(F=>[...F,N(b({},t),{cartQuantity:G})]);o(`${t.name} (${G} ta) qo'shildi`,"Muvaffaqiyat","success"),ze(!1),A(null),se(0)}},disabled:t.quantity<=0||G<=0||G>t.quantity,className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white font-bold rounded-lg transition-all shadow-md disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"Qo'shish"})]})]})}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] sm:hidden",onClick:()=>v(!1)}),e.jsxs("div",{className:"fixed top-0 left-0 bottom-0 w-80 max-w-[85vw] bg-white z-[100] shadow-2xl animate-slide-in-left sm:hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center",children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-8 h-8 rounded-lg border-2 border-white/30"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-brand-100 text-xs",children:"Mebel furniturasi"})]})]}),e.jsx("button",{onClick:()=>v(!1),className:"p-2 rounded-lg bg-white/20 hover:bg-white/30 text-white transition-colors",children:e.jsx(ge,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("button",{onClick:()=>{a("/"),v(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(na,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Bosh sahifa"})]}),e.jsxs("button",{onClick:()=>{a("/admin/products"),v(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(et,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Mahsulotlar"})]}),e.jsxs("button",{onClick:()=>{v(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-brand-50 text-brand-700 transition-colors text-left",children:[e.jsx(hs,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Kassa (POS)"})]}),e.jsxs("button",{onClick:()=>{a("/admin/customers"),v(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(Ys,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Mijozlar"})]}),e.jsxs("button",{onClick:()=>{a("/admin/debts"),v(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(Zs,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Qarzlar"})]}),e.jsxs("button",{onClick:()=>{a("/admin/staff-receipts"),v(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(Xs,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Cheklar"})]}),e.jsxs("button",{onClick:()=>{a("/admin/helpers"),v(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx(la,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Hodimlar"})]})]})]})]})]})}const sn=({productId:a,code:o,name:n,price:x,unit:i="dona",dimensions:g="",labelWidth:v=60,labelHeight:h=40,copies:q=1,onPrint:P})=>{const[w,S]=s.useState(""),[L,$]=s.useState(q),C=`${ha}/product/${a}`,m=j=>new Intl.NumberFormat("uz-UZ").format(j);s.useEffect(()=>{y()},[a,o]);const y=()=>Q(es,null,function*(){try{const j=yield xa(C,{width:300,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});S(j)}catch(j){console.error("QR generation error:",j)}}),k=()=>{const j=window.open("","_blank","width=600,height=400");if(!j){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}let f="";for(let R=0;R<L;R++)f+=`
        <div class="label">
          <div class="top-section">
            <div class="qr-box">
              <img src="${w}" alt="QR" class="qr-code" />
            </div>
            <div class="info-box">
              <div class="product-code">Kod: ${o}</div>
              <div class="product-name">${n}</div>
              ${g?`<div class="product-dimensions">${g}</div>`:""}
            </div>
          </div>
          <div class="bottom-section">
            <div class="price-box">
              <span class="price-value">${m(x)}</span>
              <span class="price-currency">so'm</span>
            </div>
          </div>
        </div>
      `;j.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Label - ${n}</title>
        <style>
          @page {
            size: ${v}mm ${h}mm;
            margin: 0;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, Helvetica, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .label {
            width: ${v}mm;
            height: ${h}mm;
            padding: 2mm;
            background: white;
            display: flex;
            flex-direction: column;
            page-break-after: always;
          }
          .label:last-child {
            page-break-after: auto;
          }
          .top-section {
            display: flex;
            gap: 2mm;
            flex: 1;
          }
          .qr-box {
            width: 22mm;
            height: 22mm;
            flex-shrink: 0;
          }
          .qr-code {
            width: 22mm;
            height: 22mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
          }
          .product-code {
            font-size: 7pt;
            font-weight: 600;
            color: #666;
            margin-bottom: 1mm;
          }
          .product-name {
            font-size: 9pt;
            font-weight: 700;
            color: #000;
            line-height: 1.2;
            text-transform: uppercase;
            word-break: break-word;
          }
          .product-dimensions {
            font-size: 7pt;
            color: #666;
            margin-top: 1mm;
          }
          .bottom-section {
            margin-top: 1.5mm;
          }
          .price-box {
            padding: 1.5mm;
            text-align: center;
            background: #f0f0f0;
            border-radius: 1mm;
          }
          .price-value {
            font-size: 14pt;
            font-weight: 900;
            color: #000;
            letter-spacing: -0.5px;
          }
          .price-currency {
            font-size: 10pt;
            font-weight: 700;
            color: #000;
            margin-left: 1mm;
          }
          @media print {
            body { background: white; }
          }
          @media screen {
            body { background: #e5e7eb; padding: 10mm; }
            .label { 
              margin-bottom: 5mm;
              box-shadow: 0 2px 8px rgba(0,0,0,0.1);
              border: 1px solid #ddd;
            }
          }
        </style>
      </head>
      <body>
        ${f}
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 200);
          }
        <\/script>
      </body>
      </html>
    `),j.document.close(),P==null||P()};return e.jsxs("div",{className:"qr-print-label w-full",children:[e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden mx-auto shadow-md border border-gray-200",style:{width:"280px",padding:"12px"},children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:w?e.jsx("img",{src:w,alt:"QR Code",className:"w-24 h-24",style:{imageRendering:"pixelated"}}):e.jsx("div",{className:"w-24 h-24 bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-gray-400",children:"QR"})})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-500 mb-1",children:["Kod: ",o]}),e.jsx("div",{className:"text-base font-bold text-gray-900 uppercase leading-tight",children:n}),g&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:g})]})]}),e.jsxs("div",{className:"mt-3 bg-gray-100 rounded-lg p-2 text-center",children:[e.jsx("span",{className:"text-2xl font-black text-gray-900",children:m(x)}),e.jsx("span",{className:"text-lg font-bold text-gray-900 ml-1",children:"so'm"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-3",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Nusxa soni:"}),e.jsx("input",{type:"number",min:1,max:100,value:L,onChange:j=>$(parseInt(j.target.value)||1),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center"})]}),e.jsxs("button",{onClick:k,className:"mt-4 w-full px-4 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"ðŸ–¨ï¸ Chop etish ",L>1?`(${L} ta)`:""]})]})},tn=({products:a,onClose:o})=>{const[n,x]=s.useState([]),[i,g]=s.useState(!0),[v,h]=s.useState({width:40,height:30,qrSize:18,columns:2,showPrice:!0,showCode:!0}),[q,P]=s.useState(!1),w=j=>new Intl.NumberFormat("uz-UZ").format(j);s.useEffect(()=>{S()},[a]);const S=()=>Q(es,null,function*(){g(!0);const j=[];for(const f of a){const R=`${ha}/product/${f._id}`;try{const W=yield xa(R,{width:200,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}});j.push({product:f,copies:1,qrDataUrl:W})}catch(W){console.error("QR error for",f.code,W)}}x(j),g(!1)}),L=(j,f)=>{x(R=>R.map((W,J)=>{if(J===j){const ue=Math.max(1,Math.min(100,W.copies+f));return N(b({},W),{copies:ue})}return W}))},$=(j,f)=>{x(R=>R.map((W,J)=>J===j?N(b({},W),{copies:Math.max(1,Math.min(100,f))}):W))},C=j=>{x(f=>f.filter((R,W)=>W!==j))},m=j=>{x(f=>f.map(R=>N(b({},R),{copies:j})))},y=()=>n.reduce((j,f)=>j+f.copies,0),k=()=>{const j=window.open("","_blank","width=800,height=600");if(!j){alert("Popup bloklangan. Iltimos, popup ga ruxsat bering.");return}let f="";n.forEach(R=>{for(let W=0;W<R.copies;W++)f+=`
          <div class="label">
            <div class="qr-section">
              <img src="${R.qrDataUrl}" alt="QR" class="qr-code" />
            </div>
            <div class="info-section">
              <div class="product-name">${R.product.name.length>18?R.product.name.substring(0,18)+"...":R.product.name}</div>
              ${v.showCode?`<div class="product-code">Kod: ${R.product.code}</div>`:""}
              ${v.showPrice?`<div class="product-price">${w(R.product.price)} so'm</div>`:""}
            </div>
          </div>
        `}),j.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QR Labels - Batch Print</title>
        <style>
          @page {
            size: ${v.width*v.columns+2}mm auto;
            margin: 1mm;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: Arial, sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          .labels-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1mm;
          }
          .label {
            width: ${v.width}mm;
            height: ${v.height}mm;
            padding: 1.5mm;
            display: flex;
            align-items: center;
            gap: 1.5mm;
            background: white;
            border: 0.2mm solid #ddd;
            page-break-inside: avoid;
          }
          .qr-section {
            flex-shrink: 0;
          }
          .qr-code {
            width: ${v.qrSize}mm;
            height: ${v.qrSize}mm;
            display: block;
            image-rendering: pixelated;
          }
          .info-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
          }
          .product-name {
            font-size: 6pt;
            font-weight: 700;
            color: #000;
            line-height: 1.1;
            margin-bottom: 0.3mm;
            text-transform: uppercase;
            word-break: break-word;
          }
          .product-code {
            font-size: 5pt;
            color: #333;
            margin-bottom: 0.3mm;
          }
          .product-price {
            font-size: 7pt;
            font-weight: 900;
            color: #000;
          }
          @media print {
            body { background: white; }
            .label { border: none; }
          }
        </style>
      </head>
      <body>
        <div class="labels-container">
          ${f}
        </div>
        <script>
          window.onload = function() {
            setTimeout(function() {
              window.print();
              window.onafterprint = function() { window.close(); }
            }, 300);
          }
        <\/script>
      </body>
      </html>
    `),j.document.close()};return i?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100]",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-brand-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-surface-600",children:"QR kodlar yaratilmoqda..."})]})}):e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-surface-900",children:"QR Label Chop Etish"}),e.jsxs("p",{className:"text-sm text-surface-500",children:[n.length," ta mahsulot, jami ",y()," ta label"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>P(!q),className:`p-2 rounded-lg transition-colors ${q?"bg-brand-100 text-brand-600":"hover:bg-surface-100"}`,children:e.jsx(tr,{className:"w-5 h-5"})}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-surface-100 rounded-lg",children:e.jsx(ge,{className:"w-5 h-5"})})]})]}),q&&e.jsx("div",{className:"p-4 bg-surface-50 border-b border-surface-200",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Eni (mm)"}),e.jsx("input",{type:"number",value:v.width,onChange:j=>h(f=>N(b({},f),{width:Number(j.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"number",value:v.height,onChange:j=>h(f=>N(b({},f),{height:Number(j.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"QR (mm)"}),e.jsx("input",{type:"number",value:v.qrSize,onChange:j=>h(f=>N(b({},f),{qrSize:Number(j.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-500 mb-1 block",children:"Ustunlar"}),e.jsx("input",{type:"number",value:v.columns,onChange:j=>h(f=>N(b({},f),{columns:Number(j.target.value)})),className:"w-full px-2 py-1.5 border rounded-lg text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showPrice",checked:v.showPrice,onChange:j=>h(f=>N(b({},f),{showPrice:j.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"showPrice",className:"text-sm",children:"Narx"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showCode",checked:v.showCode,onChange:j=>h(f=>N(b({},f),{showCode:j.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"showCode",className:"text-sm",children:"Kod"})]})]})}),e.jsxs("div",{className:"p-3 border-b border-surface-200 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-surface-500",children:"Barchasi uchun:"}),[1,2,5,10].map(j=>e.jsxs("button",{onClick:()=>m(j),className:"px-3 py-1 text-sm bg-surface-100 hover:bg-surface-200 rounded-lg transition-colors",children:[j," ta"]},j))]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:n.length===0?e.jsx("div",{className:"text-center py-12 text-surface-500",children:"Mahsulotlar yo'q"}):e.jsx("div",{className:"space-y-2",children:n.map((j,f)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-surface-50 rounded-xl",children:[e.jsx("img",{src:j.qrDataUrl,alt:"QR",className:"w-12 h-12 rounded border border-surface-200"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-surface-900 truncate",children:j.product.name}),e.jsxs("div",{className:"text-sm text-surface-500",children:["Kod: ",j.product.code," â€¢ ",w(j.product.price)," so'm"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>L(f,-1),className:"w-8 h-8 flex items-center justify-center bg-surface-200 hover:bg-surface-300 rounded-lg transition-colors",children:e.jsx(Xt,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:j.copies,onChange:R=>$(f,Number(R.target.value)),className:"w-14 text-center px-2 py-1 border border-surface-200 rounded-lg",min:1,max:100}),e.jsx("button",{onClick:()=>L(f,1),className:"w-8 h-8 flex items-center justify-center bg-surface-200 hover:bg-surface-300 rounded-lg transition-colors",children:e.jsx(ys,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>C(f),className:"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(ge,{className:"w-4 h-4"})})]},j.product._id))})}),e.jsxs("div",{className:"p-4 border-t border-surface-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-surface-500",children:["Jami: ",e.jsx("span",{className:"font-bold text-surface-900",children:y()})," ta label"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 text-surface-600 hover:bg-surface-100 rounded-xl transition-colors",children:"Bekor qilish"}),e.jsxs("button",{onClick:k,disabled:n.length===0,className:"px-6 py-2 bg-brand-600 text-white rounded-xl font-medium hover:bg-brand-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4"}),"Chop etish"]})]})]})]})})},ls={log:(...a)=>{},error:(...a)=>{console.error(...a)},warn:(...a)=>{},info:(...a)=>{},debug:(...a)=>{}};function Ia(){const a=s.useRef(null);return s.useEffect(()=>{const n="/api".replace("/api","");console.log("ðŸ”Œ Socket.IO connecting to:",n);const x=Pr(n,{transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:5});return x.on("connect",()=>{console.log("âœ… Socket.IO connected:",x.id)}),x.on("disconnect",()=>{console.log("âŒ Socket.IO disconnected")}),x.on("connect_error",i=>{console.error("Socket.IO connection error:",i)}),a.current=x,()=>{x.disconnect()}},[]),a.current}function an(){const{showAlert:a,showConfirm:o,AlertComponent:n}=Ps(),x=Ia(),[i,g]=s.useState([]),[v,h]=s.useState(1),[q,P]=s.useState(1),[w,S]=s.useState(0),[L,$]=s.useState(!1),[C,m]=s.useState(null),[y,k]=s.useState(!1),[j,f]=s.useState(1),[R,W]=s.useState(!1),[J,ue]=s.useState(!1),[de,K]=s.useState(!1),[Se,je]=s.useState(new Set),[Me,V]=s.useState(!1),[Ne,E]=s.useState(!1),[ce,be]=s.useState(null),[Le,O]=s.useState(!1),[_,D]=s.useState("7"),[we,Z]=s.useState({total:0,lowStock:0,outOfStock:0,totalValue:0}),[oe,Ce]=s.useState(null),[Qe,_e]=s.useState(null),[Oe,ts]=s.useState(""),[He,u]=s.useState(""),[ee,Ie]=s.useState("all"),[qe,ne]=s.useState(""),[Ze,X]=s.useState(!0),[ve,M]=s.useState(!1),[Te,Re]=s.useState(12500),Ue=s.useRef(null),[Ye,Ss]=s.useState(!1),[I,he]=s.useState(!1),[me,ze]=s.useState("");s.useEffect(()=>{const l=setTimeout(()=>{u(Oe)},150);return()=>clearTimeout(l)},[Oe]),s.useEffect(()=>(y||R||J||Ne||de?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[y,R,J,Ne,de]),s.useEffect(()=>{const l=()=>{const z=window.pageYOffset||document.documentElement.scrollTop;Ss(z>200)};return window.addEventListener("scroll",l),()=>window.removeEventListener("scroll",l)},[]);const[t,A]=s.useState({code:"",name:"",description:"",quantity:"",previousPrice:"",currentPrice:"",costPrice:"",costPriceInDollar:"",unitPrice:"",boxPrice:"",category:"Boshqa",pricingTiers:{tier1:{minQuantity:"1",maxQuantity:"5",discountPercent:"15"},tier2:{minQuantity:"6",maxQuantity:"20",discountPercent:"13"},tier3:{minQuantity:"21",maxQuantity:"100",discountPercent:"11"}},unit:"dona",dimensions:{width:"",height:"",length:""},metersPerRoll:"",unitsPerBox:"",meterPriceRanges:[{from:"",to:"",price:""}],pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),[G,se]=s.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[ss,as]=s.useState([]),[is,Je]=s.useState([]),[os,bs]=s.useState(""),[Is,Cs]=s.useState(!1),zs=s.useRef(null),Es=()=>{if(!oe)return;const l=document.getElementById("qr-code-svg");if(!l)return;const z=new XMLSerializer().serializeToString(l),B=document.createElement("canvas"),le=B.getContext("2d"),ke=document.createElement("img");ke.onload=()=>{B.width=ke.width,B.height=ke.height,le==null||le.drawImage(ke,0,0);const Pe=B.toDataURL("image/png"),$e=document.createElement("a");$e.download=`QR-${oe.code}-${oe.name}.png`,$e.href=Pe,$e.click()},ke.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(z)))},Ts=l=>Q(this,null,function*(){if(l)try{const z=(Qe==null?void 0:Qe._id)||"";(yield U.get(`/products/check-code/${l}${z?`?excludeId=${z}`:""}`)).data.exists?bs(`Kod "${l}" allaqachon mavjud`):bs("")}catch(z){ls.error("Error checking code:",z),a("Kod tekshirishda xatolik","Xatolik","danger")}}),gs=s.useMemo(()=>{if(!He&&ee==="all"&&!qe)return i;const l=He.toLowerCase().trim(),z=l.split(/\s+/).filter(B=>B.length>0);return i.filter(B=>{if(!He)return!0;const le=B.name.toLowerCase(),ke=B.code.toLowerCase();if(z.length===1)return le.includes(l)||ke.includes(l);if(!z.every(Ae=>le.includes(Ae)||ke.includes(Ae)))return!1;const $e=ee==="all"||ee==="low"&&B.quantity<=(B.minStock||50)&&B.quantity>0||ee==="out"&&B.quantity===0,Fe=!qe||B.category===qe;return $e&&Fe})},[i,He,ee,qe]),Ns=s.useCallback((l=1)=>Q(this,null,function*(){var le,ke,Pe,$e,Fe;const z=performance.now();/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&console.log("ðŸŽ Safari browser aniqlandi - maxsus optimizatsiyalar faol");try{l===1?X(!0):$(!0);const Ae=Date.now(),Be=yield U.get(`/products?page=${l}&limit=20&t=${Ae}`),Ee=Be.data.data||[],xe=Be.data.pagination||{};console.log(`ðŸ“¦ Sahifa ${l}: ${Ee.length} ta mahsulot keldi`);const cs=Ee.filter(ns=>!ns||!ns._id?(console.warn("âš ï¸ Mahsulot ID yo'q:",ns),!1):!ns.name||ns.name.trim()===""?(console.warn("âš ï¸ Mahsulot nomi yo'q:",ns._id),!1):!0),qs=Ee.length-cs.length;qs>0&&console.warn(`âš ï¸ Sahifa ${l}: ${qs} ta invalid mahsulot o'tkazib yuborildi`);const Ds=performance.now()-z;if(console.log(`âš¡ Sahifa ${l}: ${cs.length}/${Ee.length} ta maxsulot ${Math.round(Ds)}ms da yuklandi`),console.log(`ðŸ“Š Pagination: Sahifa ${xe.page}/${xe.pages}, Jami: ${xe.total}`),g(l===1?cs:ns=>[...ns,...cs]),h(xe.page||1),P(xe.pages||1),S(xe.total||0),l===1){const ns=()=>{const As={total:xe.total||0,lowStock:cs.filter(Ms=>Ms.quantity<=(Ms.minStock||50)&&Ms.quantity>0).length,outOfStock:cs.filter(Ms=>Ms.quantity===0).length,totalValue:cs.reduce((Ms,rs)=>{let Bs=0;return rs.currentPrice&&rs.currentPrice>0?Bs=rs.currentPrice:rs.unitPrice&&rs.unitPrice>0?Bs=rs.unitPrice:rs.price&&rs.price>0?Bs=rs.price:rs.boxPrice&&rs.boxPrice>0&&rs.unitsPerBox&&rs.unitsPerBox>0?Bs=rs.boxPrice/rs.unitsPerBox:rs.previousPrice&&rs.previousPrice>0&&(Bs=rs.previousPrice),Ms+Bs*(rs.quantity||0)},0)};console.log("ðŸ’° Client-side jami qiymat:",As.totalValue),Z(As)};typeof requestIdleCallback!="undefined"?requestIdleCallback(ns,{timeout:2e3}):setTimeout(ns,100)}}catch(Ae){console.error("âŒ Mahsulotlarni yuklashda xatolik:",Ae),console.error("Error details:",{message:Ae.message,response:(le=Ae.response)==null?void 0:le.data,status:(ke=Ae.response)==null?void 0:ke.status,stack:Ae.stack});const Be=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let Ee=(($e=(Pe=Ae.response)==null?void 0:Pe.data)==null?void 0:$e.message)||Ae.message||"Maxsulotlarni yuklashda xatolik";Be&&((Fe=Ae.message)!=null&&Fe.includes("Network"))&&(Ee="Internet aloqasini tekshiring. Safari'da ba'zan aloqa muammolari bo'lishi mumkin."),a(Ee,"Xatolik","danger"),l===1&&(g([]),Z({total:0,lowStock:0,outOfStock:0,totalValue:0}))}finally{X(!1),$(!1)}}),[a]);s.useEffect(()=>{te(),Ns(1);const l=setTimeout(()=>{js()},1e3);return()=>clearTimeout(l)},[Ns]),s.useEffect(()=>{if(x)return x.on("product:created",l=>{console.log("ðŸ“¡ Socket: Yangi mahsulot qo'shildi",l),g(z=>[l,...z]),S(z=>z+1),js()}),x.on("product:updated",l=>{console.log("ðŸ“¡ Socket: Mahsulot yangilandi",l),g(z=>z.map(B=>B._id===l._id?l:B)),js()}),x.on("product:deleted",l=>{console.log("ðŸ“¡ Socket: Mahsulot o'chirildi",l._id),g(z=>z.filter(B=>B._id!==l._id)),S(z=>z-1),js()}),()=>{x.off("product:created"),x.off("product:updated"),x.off("product:deleted")}},[x]);const js=()=>Q(this,null,function*(){if(!Le){O(!0);try{console.log("ðŸ“Š Statistika yuklanmoqda...");const l=yield U.get("/products/overall-stats");console.log("ðŸ“Š Server statistikasi:",l.data),console.log("ðŸ’° Jami qiymat:",l.data.totalValue),Z(l.data)}catch(l){console.error("Statistikani yuklashda xatolik:",l),l.code==="ECONNABORTED"&&console.warn("âš ï¸ Statistika yuklash juda uzoq davom etdi, keyinroq qayta uriniladi")}finally{O(!1)}}});s.useEffect(()=>{if(v===1&&q>1&&!L){console.log(`ðŸ”„ Background: Qolgan ${q-1} ta sahifa yuklanmoqda...`);const l=setTimeout(()=>Q(this,null,function*(){$(!0);for(let z=2;z<=q;z++){console.log(`ðŸ“¥ Sahifa ${z}/${q} yuklanmoqda...`);try{const ke=((yield U.get(`/products?page=${z}&limit=20&t=${Date.now()}`)).data.data||[]).filter(Pe=>!(!Pe||!Pe._id||!Pe.name||Pe.name.trim()===""));g(Pe=>{const $e=new Set(Pe.map(Ae=>Ae._id)),Fe=ke.filter(Ae=>!$e.has(Ae._id));return[...Pe,...Fe]}),h(z),yield new Promise(Pe=>setTimeout(Pe,200))}catch(B){console.error(`âŒ Sahifa ${z} yuklashda xatolik:`,B)}}$(!1),console.log(`âœ… Barcha ${q} ta sahifa yuklandi!`)}),500);return()=>clearTimeout(l)}},[v,q,L]);const d=s.useCallback(()=>{},[]);s.useEffect(()=>{(He||ee!=="all")&&(g([]),h(1),Ns(1))},[He,ee,Ns]),s.useEffect(()=>{const l=Ue.current;if(l)return l.addEventListener("scroll",d),()=>l.removeEventListener("scroll",d)},[d]),s.useEffect(()=>{ls.log("Products state updated:",{count:i.length,firstProduct:i.length>0?{_id:i[0]._id,name:i[0].name,code:i[0].code}:null})},[i]);const te=()=>Q(this,null,function*(){try{const l=Date.now(),z=yield U.get(`/warehouses?t=${l}`),le=(Array.isArray(z.data)?z.data:[]).find(ke=>ke.name==="Asosiy ombor");if(le)m(le);else{const ke=yield U.post("/warehouses",{name:"Asosiy ombor",address:""});m(ke.data)}}catch(l){ls.error("Error fetching warehouses:",l),a("Omborlarni yuklashda xatolik","Xatolik","danger"),X(!1)}}),r=l=>new Promise((z,B)=>{const le=new FileReader;le.readAsDataURL(l),le.onload=ke=>{var $e;const Pe=new Image;Pe.src=($e=ke.target)==null?void 0:$e.result,Pe.onload=()=>{const Fe=document.createElement("canvas");let Ae=Pe.width,Be=Pe.height;if(Ae>1920||Be>1920){const xe=Math.min(1920/Ae,1920/Be);Ae=Math.round(Ae*xe),Be=Math.round(Be*xe)}Fe.width=Ae,Fe.height=Be;const Ee=Fe.getContext("2d");if(!Ee){B(new Error("Canvas context not available"));return}Ee.drawImage(Pe,0,0,Ae,Be),Fe.toBlob(xe=>{xe?z(xe):B(new Error("Canvas to blob failed"))},"image/jpeg",.8)},Pe.onerror=()=>B(new Error("Image load failed"))},le.onerror=()=>B(new Error("File read failed"))}),T=l=>Q(this,null,function*(){const z=l.target.files;if(!z||z.length===0)return;const B=8-ss.length;if(B<=0){a("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const le=["image/jpeg","image/jpg","image/png","image/webp"],ke=Array.from(z).filter(Fe=>le.includes(Fe.type)?!0:(a(`${Fe.name} - noto'g'ri format. Faqat JPG, PNG, WebP qabul qilinadi`,"Xatolik","warning"),!1));if(ke.length===0)return;const Pe=ke.slice(0,B),$e=new FormData;M(!0);try{for(const Be of Pe)try{const Ee=yield r(Be);$e.append("images",Ee,Be.name)}catch(Ee){ls.warn(`Image compression failed for ${Be.name}, uploading original:`,Ee),$e.append("images",Be)}const Fe=yield U.post("/products/upload-images",$e,{headers:{"Content-Type":"multipart/form-data"}}),Ae=(Fe.data.images||[]).map(Be=>typeof Be=="string"?Be:Be.path);Je([...is,...Ae]),as([...ss.map(Be=>typeof Be=="string"?Be:Be.path),...Ae]),a(`${Fe.data.images.length} ta rasm muvaffaqiyatli yuklandi`,"Muvaffaqiyat","success")}catch(Fe){ls.error("Error uploading images:",Fe),a("Rasmlarni yuklashda xatolik","Xatolik","danger")}finally{M(!1),zs.current&&(zs.current.value="")}}),H=l=>Q(this,null,function*(){var z,B,le;try{console.log("ðŸ—‘ï¸ Removing image:",{imagePath:l,isNewlyUploaded:is.includes(l)});const ke=ss.map($e=>typeof $e=="string"?$e:$e.path).filter($e=>$e!==l);if(as(ke),is.includes(l)){Je(is.filter($e=>$e!==l)),a("Rasm o'chirildi (hali saqlanmagan)","Ma'lumot","info");try{yield U.delete("/products/delete-image",{data:{imagePath:l,productId:void 0}}),console.log("âœ… Yangi yuklangan rasm serverdan ham o'chirildi")}catch($e){console.warn("Yangi yuklangan rasmni serverdan o'chirishda xatolik:",$e)}return}const Pe=Qe==null?void 0:Qe._id;if(Pe)try{yield U.delete("/products/delete-image",{data:{imagePath:l,productId:Pe}}),a("Rasm o'chirildi","Muvaffaqiyat","success")}catch($e){console.warn("Server xatosi:",$e),((z=$e.response)==null?void 0:z.status)===404?a("Rasm local state dan o'chirildi","Ma'lumot","info"):a("Rasm local state dan o'chirildi, lekin serverda xatolik","Ogohlantirish","warning")}else a("Rasm o'chirildi","Muvaffaqiyat","success")}catch(ke){ls.error("Error deleting image:",ke);const Pe=((le=(B=ke.response)==null?void 0:B.data)==null?void 0:le.message)||ke.message||"Rasmni o'chirishda xatolik";a(Pe,"Xatolik","danger")}}),Y=l=>{if(l.images&&l.images.length>0){let z=typeof l.images[0]=="string"?l.images[0]:l.images[0].path;if(z.startsWith("http://")||z.startsWith("https://"))try{z=new URL(z).pathname}catch(B){console.warn("Invalid image URL:",z)}return z.startsWith("/")||(z="/"+z),`${Ls}${z}`}return null},ae=l=>Q(this,null,function*(){var Pe,$e,Fe,Ae,Be;if(l.preventDefault(),ls.log("Form submit boshlandi. Ma'lumotlar:",{code:t.code,name:t.name,unitPrice:t.unitPrice,currentPrice:t.currentPrice,codeError:os}),os){ls.error("Kod xatosi:",os),a(os,"Xatolik","danger");return}if(!t.name||!t.name.trim()){ls.error("Tovar nomi bo'sh"),a("Tovar nomi majburiy","Xatolik","danger");return}if(!t.unitPrice&&!t.currentPrice){ls.error("Narx bo'sh"),a("Tovar narxi majburiy","Xatolik","danger");return}let z=Number(t.quantity),B=null;if(Is&&G.packageCount&&G.unitsPerPackage){const Ee=Number(G.packageCount)*Number(G.unitsPerPackage);z=Qe?Number(t.quantity)+Ee:Ee,B={packageCount:Number(G.packageCount),unitsPerPackage:Number(G.unitsPerPackage),totalUnits:Ee}}let le=0,ke=0;t.unit==="rulon"&&t.metersPerRoll&&(le=z*Number(t.metersPerRoll)),t.unit==="karobka"&&t.unitsPerBox&&(ke=z*Number(t.unitsPerBox));try{const Ee={code:t.code,name:t.name,description:t.description||"",price:Number(t.unitPrice)||Number(t.currentPrice),costPrice:Number(t.costPrice)||0,unitPrice:Number(t.unitPrice)||Number(t.currentPrice)||0,boxPrice:Number(t.boxPrice)||0,previousPrice:Number(t.previousPrice)||0,currentPrice:Number(t.currentPrice)||0,category:t.category||"Boshqa",pricingTiers:{tier1:{minQuantity:Number(t.pricingTiers.tier1.minQuantity)||1,maxQuantity:Number(t.pricingTiers.tier1.maxQuantity)||5,discountPercent:Number(t.pricingTiers.tier1.discountPercent)||15},tier2:{minQuantity:Number(t.pricingTiers.tier2.minQuantity)||6,maxQuantity:Number(t.pricingTiers.tier2.maxQuantity)||20,discountPercent:Number(t.pricingTiers.tier2.discountPercent)||13},tier3:{minQuantity:Number(t.pricingTiers.tier3.minQuantity)||21,maxQuantity:Number(t.pricingTiers.tier3.maxQuantity)||100,discountPercent:Number(t.pricingTiers.tier3.discountPercent)||11}},quantity:z,warehouse:C==null?void 0:C._id,images:ss,packageInfo:B,unit:t.unit,costPriceInDollar:Number(t.costPriceInDollar)||0,dollarRate:Te,dimensions:{width:t.dimensions.width||"",height:t.dimensions.height||"",length:t.dimensions.length||""},metersPerRoll:Number(t.metersPerRoll)||0,unitsPerBox:Number(t.unitsPerBox)||0,totalMeters:le,totalUnits:ke,meterPriceRanges:t.meterPriceRanges.filter(xe=>xe.from&&xe.to&&xe.price).map(xe=>({from:Number(xe.from),to:Number(xe.to),price:Number(xe.price)})),prices:{perUnit:Number(t.unitPrice)||Number(t.currentPrice),perRoll:Number(t.pricePerRoll)||0,perBox:Number(t.boxPrice)||Number(t.pricePerBox)||0,perKg:Number(t.pricePerKg)||0,perGram:Number(t.pricePerGram)||0}};if(ls.log("Tovar serverga yuborilmoqda:",{code:Ee.code,name:Ee.name,warehouse:Ee.warehouse,quantity:Ee.quantity,price:Ee.price}),Qe){const xe=yield U.put(`/products/${Qe._id}`,Ee);if(ls.log("Tovar yangilandi:",Qe._id),xe.data&&xe.data._id){const cs=N(b({},xe.data),{warehouse:xe.data.warehouse||C,images:xe.data.images||ss||[]});g(qs=>{const Ds=qs.map(ns=>ns._id===Qe._id?cs:ns);return Ds.sort((ns,As)=>{const Ms=new Date(ns.createdAt||0).getTime();return new Date(As.createdAt||0).getTime()-Ms}),Ds}),ls.log("Tovar darhol UI da yangilandi:",xe.data.name),xe.data.category&&ne(xe.data.category)}}else{const xe=yield U.post("/products",Ee);if(ls.log("Tovar serverdan qaytdi:",xe.data),ls.log("Tovar rasmlar:",xe.data.images),xe.data&&xe.data._id){const cs=N(b({},xe.data),{warehouse:xe.data.warehouse||C,images:xe.data.images||ss||[]});ls.log("UI ga qo'shilayotgan tovar:",{_id:cs._id,name:cs.name,images:cs.images,imagesCount:((Pe=cs.images)==null?void 0:Pe.length)||0}),g(qs=>[cs,...qs]),ls.log("Yangi tovar darhol UI ga qo'shildi:",xe.data.name),xe.data.category&&ne(xe.data.category)}}c(),F(),a(Qe?"Tovar yangilandi":"Tovar qo'shildi","Muvaffaqiyat","success"),js()}catch(Ee){ls.error("Error adding/updating product:",Ee);const xe=((Fe=($e=Ee.response)==null?void 0:$e.data)==null?void 0:Fe.message)||Ee.message||"Xatolik yuz berdi";ls.error("Error details:",{status:(Ae=Ee.response)==null?void 0:Ae.status,message:xe,data:(Be=Ee.response)==null?void 0:Be.data}),a(xe,"Xatolik","danger")}}),fe=l=>Q(this,null,function*(){if(yield o("Tovarni o'chirishni tasdiqlaysizmi?","O'chirish"))try{yield U.delete(`/products/${l}`),g(B=>B.filter(le=>le._id!==l)),ls.log("Tovar UI dan o'chirildi:",l),a("Tovar o'chirildi","Muvaffaqiyat","success"),js()}catch(B){ls.error("Error deleting product:",B),a("Tovarni o'chirishda xatolik","Xatolik","danger")}}),re=l=>{var B,le,ke,Pe,$e,Fe,Ae,Be,Ee,xe,cs,qs,Ds,ns,As,Ms,rs,Bs,ft,bt,gt,jt,vt,Nt,wt,Xe;_e(l);const z=l;Re(z.dollarRate||12500),A({code:l.code,name:l.name,description:z.description||"",previousPrice:String(z.previousPrice||0),currentPrice:String(z.currentPrice||l.price),costPrice:String(z.costPrice||0),costPriceInDollar:String(z.costPriceInDollar||0),unitPrice:String(z.unitPrice||z.currentPrice||l.price),boxPrice:String(z.boxPrice||0),category:z.category||"Boshqa",pricingTiers:{tier1:{minQuantity:String(((le=(B=z.pricingTiers)==null?void 0:B.tier1)==null?void 0:le.minQuantity)||1),maxQuantity:String(((Pe=(ke=z.pricingTiers)==null?void 0:ke.tier1)==null?void 0:Pe.maxQuantity)||5),discountPercent:String(((Fe=($e=z.pricingTiers)==null?void 0:$e.tier1)==null?void 0:Fe.discountPercent)||15)},tier2:{minQuantity:String(((Be=(Ae=z.pricingTiers)==null?void 0:Ae.tier2)==null?void 0:Be.minQuantity)||6),maxQuantity:String(((xe=(Ee=z.pricingTiers)==null?void 0:Ee.tier2)==null?void 0:xe.maxQuantity)||20),discountPercent:String(((qs=(cs=z.pricingTiers)==null?void 0:cs.tier2)==null?void 0:qs.discountPercent)||13)},tier3:{minQuantity:String(((ns=(Ds=z.pricingTiers)==null?void 0:Ds.tier3)==null?void 0:ns.minQuantity)||21),maxQuantity:String(((Ms=(As=z.pricingTiers)==null?void 0:As.tier3)==null?void 0:Ms.maxQuantity)||100),discountPercent:String(((Bs=(rs=z.pricingTiers)==null?void 0:rs.tier3)==null?void 0:Bs.discountPercent)||11)}},quantity:String(l.quantity),unit:l.unit||"dona",dimensions:{width:((ft=z.dimensions)==null?void 0:ft.width)||"",height:((bt=z.dimensions)==null?void 0:bt.height)||"",length:((gt=z.dimensions)==null?void 0:gt.length)||""},metersPerRoll:String(z.metersPerRoll||""),unitsPerBox:String(z.unitsPerBox||""),meterPriceRanges:((jt=z.meterPriceRanges)==null?void 0:jt.length)>0?z.meterPriceRanges.map(Js=>({from:String(Js.from||""),to:String(Js.to||""),price:String(Js.price||"")})):[{from:"",to:"",price:""}],pricePerRoll:String(((vt=l.prices)==null?void 0:vt.perRoll)||""),pricePerBox:String(((Nt=l.prices)==null?void 0:Nt.perBox)||""),pricePerKg:String(((wt=l.prices)==null?void 0:wt.perKg)||""),pricePerGram:String(((Xe=l.prices)==null?void 0:Xe.perGram)||"")}),as((z.images||[]).map(Js=>typeof Js=="string"?Js:Js.path)),se({packageCount:"",unitsPerPackage:"",totalCost:""}),bs(""),Cs(!1),k(!0)},pe=l=>{Ce(l),W(!0)},De=l=>{je(z=>{const B=new Set(z);return B.has(l)?B.delete(l):B.add(l),B})},Ve=()=>{Se.size===gs.length?je(new Set):je(new Set(gs.map(l=>l._id)))},vs=()=>{if(Se.size===0){a("Kamida bitta mahsulot tanlang","Ogohlantirish","warning");return}ue(!0)},ps=()=>{V(!1),je(new Set)},ks=l=>Q(this,null,function*(){var z,B,le,ke,Pe,$e,Fe,Ae,Be,Ee,xe,cs,qs,Ds,ns,As,Ms,rs,Bs,ft,bt,gt,jt,vt,Nt,wt;try{k(!0),_e(null);const Xe=l;Re(Xe.dollarRate||12500);const Js=U.get("/products/next-code");A({code:"",name:l.name,description:Xe.description||"",previousPrice:String(Xe.previousPrice||0),currentPrice:String(Xe.currentPrice||l.price),costPrice:String(Xe.costPrice||0),costPriceInDollar:String(Xe.costPriceInDollar||0),unitPrice:String(Xe.unitPrice||Xe.currentPrice||l.price),boxPrice:String(Xe.boxPrice||0),pricingTiers:{tier1:{minQuantity:String(((B=(z=Xe.pricingTiers)==null?void 0:z.tier1)==null?void 0:B.minQuantity)||1),maxQuantity:String(((ke=(le=Xe.pricingTiers)==null?void 0:le.tier1)==null?void 0:ke.maxQuantity)||5),discountPercent:String((($e=(Pe=Xe.pricingTiers)==null?void 0:Pe.tier1)==null?void 0:$e.discountPercent)||15)},tier2:{minQuantity:String(((Ae=(Fe=Xe.pricingTiers)==null?void 0:Fe.tier2)==null?void 0:Ae.minQuantity)||6),maxQuantity:String(((Ee=(Be=Xe.pricingTiers)==null?void 0:Be.tier2)==null?void 0:Ee.maxQuantity)||20),discountPercent:String(((cs=(xe=Xe.pricingTiers)==null?void 0:xe.tier2)==null?void 0:cs.discountPercent)||13)},tier3:{minQuantity:String(((Ds=(qs=Xe.pricingTiers)==null?void 0:qs.tier3)==null?void 0:Ds.minQuantity)||21),maxQuantity:String(((As=(ns=Xe.pricingTiers)==null?void 0:ns.tier3)==null?void 0:As.maxQuantity)||100),discountPercent:String(((rs=(Ms=Xe.pricingTiers)==null?void 0:Ms.tier3)==null?void 0:rs.discountPercent)||11)}},quantity:"0",unit:l.unit||"dona",category:Xe.category||"Boshqa",dimensions:{width:((Bs=Xe.dimensions)==null?void 0:Bs.width)||"",height:((ft=Xe.dimensions)==null?void 0:ft.height)||"",length:((bt=Xe.dimensions)==null?void 0:bt.length)||""},metersPerRoll:String(Xe.metersPerRoll||""),unitsPerBox:String(Xe.unitsPerBox||""),meterPriceRanges:((gt=Xe.meterPriceRanges)==null?void 0:gt.length)>0?Xe.meterPriceRanges.map(Us=>({from:String(Us.from||""),to:String(Us.to||""),price:String(Us.price||"")})):[{from:"",to:"",price:""}],pricePerRoll:String(((jt=l.prices)==null?void 0:jt.perRoll)||""),pricePerBox:String(((vt=l.prices)==null?void 0:vt.perBox)||""),pricePerKg:String(((Nt=l.prices)==null?void 0:Nt.perKg)||""),pricePerGram:String(((wt=l.prices)==null?void 0:wt.perGram)||"")}),as((Xe.images||[]).map(Us=>typeof Us=="string"?Us:Us.path)),se({packageCount:"",unitsPerPackage:"",totalCost:""}),bs(""),Cs(!1);try{const Us=yield Js;A(Fa=>N(b({},Fa),{code:Us.data.code}))}catch(Us){ls.error("Error getting next code:",Us),a("Keyingi kodni olishda xatolik","Xatolik","danger")}a("Mahsulot nusxalandi. Kerakli o'zgarishlarni kiriting va saqlang.","Muvaffaqiyat","success")}catch(Xe){ls.error("Error copying product:",Xe),a("Mahsulotni nusxalashda xatolik","Xatolik","danger")}}),$s=l=>Q(this,null,function*(){if(oe){D(l),O(!0);try{const z=yield U.get(`/products/stats/${oe._id}?period=${l}`);be(z.data)}catch(z){ls.error("Error fetching product stats:",z),a("Statistikani yuklashda xatolik","Xatolik","danger")}finally{O(!1)}}}),c=()=>{k(!1),f(1)},F=()=>{_e(null),Re(12500),as([]),bs(""),Cs(!1),A({code:"",name:"",description:"",quantity:"",previousPrice:"",currentPrice:"",costPrice:"",costPriceInDollar:"",unitPrice:"",boxPrice:"",category:"Boshqa",pricingTiers:{tier1:{minQuantity:"1",maxQuantity:"5",discountPercent:"15"},tier2:{minQuantity:"6",maxQuantity:"20",discountPercent:"13"},tier3:{minQuantity:"21",maxQuantity:"100",discountPercent:"11"}},unit:"dona",dimensions:{width:"",height:"",length:""},metersPerRoll:"",unitsPerBox:"",meterPriceRanges:[{from:"",to:"",price:""}],pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),se({packageCount:"",unitsPerPackage:"",totalCost:""}),as([]),Je([]),bs(""),Cs(!1)},ie=()=>Q(this,null,function*(){F(),k(!0),as([]),bs(""),Cs(!1);try{const l=yield U.get("/products/next-code");A(z=>N(b({},z),{code:l.data.code}))}catch(l){ls.error("Error getting next code:",l),a("Keyingi kodni olishda xatolik","Xatolik","danger")}}),ye=s.useMemo(()=>({total:we.total||i.length||0,lowStock:we.lowStock||0,outOfStock:we.outOfStock||0,totalValue:we.totalValue||0}),[we,i.length]),xs=[{label:"Jami tovarlar",value:ye.total,icon:Ke,color:"brand",filter:"all"},{label:"Kam qolgan",value:ye.lowStock,icon:Rs,color:"warning",filter:"low"},{label:"Tugagan",value:ye.outOfStock,icon:ge,color:"danger",filter:"out"},{label:"Jami qiymat",value:`${p(ye.totalValue)} so'm`,icon:ds,color:"success",filter:null}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100 pb-20 lg:pb-0",children:[n,e.jsx(Ws,{title:"Tovarlar",showSearch:!0,onSearch:ts,actions:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>Ns(),className:"flex items-center justify-center p-0.5 rounded bg-purple-50 hover:bg-purple-100 text-purple-600 hover:text-purple-700 transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Tovarlarni qayta yuklash",children:e.jsx(yt,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),Me?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Ve,className:"flex items-center justify-center px-2 py-0.5 rounded text-xs bg-purple-50 hover:bg-purple-100 text-purple-600 hover:text-purple-700 transition-all duration-200 flex-shrink-0 font-medium",style:{height:"24px",minHeight:"24px"},children:Se.size===gs.length?"Bekor":"Barchasi"}),e.jsxs("button",{onClick:vs,className:"flex items-center justify-center gap-1 px-2 py-0.5 rounded text-xs bg-brand-500 hover:bg-brand-600 text-white transition-all duration-200 flex-shrink-0 font-medium disabled:opacity-50 disabled:cursor-not-allowed",style:{height:"24px",minHeight:"24px"},disabled:Se.size===0,children:[e.jsx(nt,{className:"w-3 h-3",style:{width:"12px",height:"12px"}}),e.jsx("span",{children:Se.size})]}),e.jsx("button",{onClick:ps,className:"flex items-center justify-center p-0.5 rounded bg-surface-200 hover:bg-surface-300 transition-all duration-200 flex-shrink-0",style:{width:"24px",height:"24px",minWidth:"24px",minHeight:"24px"},children:e.jsx(ge,{className:"w-3 h-3",style:{width:"12px",height:"12px"}})})]}):e.jsx("button",{onClick:()=>V(!0),className:"flex items-center justify-center p-0.5 rounded bg-blue-50 hover:bg-blue-100 text-blue-600 hover:text-blue-700 transition-all duration-200 flex-shrink-0",style:{width:"28px",height:"28px",minWidth:"28px",minHeight:"28px"},title:"Bir nechta QR chiqarish",children:e.jsx(ar,{className:"w-3.5 h-3.5",style:{width:"14px",height:"14px"}})}),e.jsxs("button",{onClick:ie,className:"flex items-center gap-1 px-2 py-1 rounded bg-brand-500 hover:bg-brand-600 text-white transition-all duration-200 flex-shrink-0",style:{minHeight:"28px"},children:[e.jsx(ys,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),e.jsx("span",{className:"text-[10px] sm:text-xs font-medium",children:"Qo'shish"})]})]})}),e.jsxs("div",{className:"p-2 sm:p-3 md:p-4 lg:p-6 space-y-3 sm:space-y-4 md:space-y-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 md:gap-5",children:xs.map((l,z)=>e.jsx("div",{onClick:()=>l.filter&&Ie(l.filter),className:`bg-white rounded-xl sm:rounded-2xl border-2 transition-all ${l.filter?"cursor-pointer hover:shadow-lg hover:scale-[1.02]":""} ${ee===l.filter?"border-brand-500 shadow-md":"border-surface-200"}`,children:e.jsxs("div",{className:"p-3 sm:p-4 md:p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-2.5 mb-2 sm:mb-3",children:[e.jsx("div",{className:`w-10 h-10 sm:w-11 sm:h-11 md:w-12 md:h-12 rounded-xl flex items-center justify-center bg-${l.color}-50`,children:e.jsx(l.icon,{className:`w-5 h-5 sm:w-5.5 sm:h-5.5 md:w-6 md:h-6 text-${l.color}-600`})}),e.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-surface-500 font-medium",children:l.label})]}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-surface-900 truncate",children:l.value})]})},z))}),e.jsx("div",{className:"bg-white rounded-xl p-3 sm:p-4 border-2 border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto scrollbar-hide",children:[e.jsx("button",{onClick:()=>ne(""),className:`flex-shrink-0 px-4 py-2 rounded-lg font-medium text-sm transition-all ${qe===""?"bg-brand-500 text-white shadow-md":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:"Barchasi"}),Mt.map(l=>e.jsx("button",{onClick:()=>ne(l),className:`flex-shrink-0 px-4 py-2 rounded-lg font-medium text-sm transition-all whitespace-nowrap ${qe===l?"bg-brand-500 text-white shadow-md":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:l},l))]})}),Ze?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):gs.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Ke,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Tovarlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md mb-6",children:Oe?"Qidiruv bo'yicha tovarlar topilmadi":"Birinchi tovarni qo'shing"}),e.jsx("button",{onClick:ie,className:"btn-primary",children:"Tovar qo'shish"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:Ue,className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:gs.map(l=>{const z=Se.has(l._id),B=Y(l);return e.jsxs("div",{className:`group relative bg-white rounded-lg sm:rounded-xl transition-all duration-200 hover:shadow-lg min-h-[140px] ${z?"shadow-md ring-2 ring-brand-500":"shadow-sm hover:shadow-md"}`,children:[e.jsxs("div",{className:"absolute top-1 right-1 flex items-center gap-0.5 z-10",children:[e.jsx("button",{onClick:le=>{le.stopPropagation(),ks(l)},className:"w-6 h-6 sm:w-7 sm:h-7 bg-blue-50 hover:bg-blue-100 rounded-lg transition-none text-blue-600 flex items-center justify-center hover:scale-110 shadow-sm",title:"Mahsulotni nusxalash",children:e.jsx(Ca,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"})}),e.jsx("button",{onClick:le=>{le.stopPropagation(),pe(l)},className:"w-6 h-6 sm:w-7 sm:h-7 bg-purple-50 hover:bg-purple-100 rounded-lg transition-none text-purple-600 flex items-center justify-center hover:scale-110 shadow-sm",title:"QR kod",children:e.jsx(zt,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"})}),e.jsx("button",{onClick:le=>{le.stopPropagation(),re(l)},className:"w-6 h-6 sm:w-7 sm:h-7 bg-amber-50 hover:bg-amber-100 rounded-lg transition-none text-amber-600 flex items-center justify-center hover:scale-110 shadow-sm",title:"Tahrirlash",children:e.jsx(rt,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"})}),e.jsx("button",{onClick:le=>{le.stopPropagation(),fe(l._id)},className:"w-6 h-6 sm:w-7 sm:h-7 bg-red-50 hover:bg-red-100 rounded-lg transition-none text-red-600 flex items-center justify-center hover:scale-110 shadow-sm",title:"O'chirish",children:e.jsx(_s,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"})})]}),Me&&e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx("input",{type:"checkbox",checked:z,onChange:()=>De(l._id),className:"w-4 h-4 sm:w-5 sm:h-5 rounded border-2 cursor-pointer"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-2 md:gap-3 p-2 sm:p-2.5 md:p-3",children:[e.jsx("div",{className:"relative w-full sm:w-20 md:w-24 h-24 sm:h-20 md:h-24 rounded-lg overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100 cursor-pointer flex-shrink-0 shadow-sm",onClick:()=>{B&&(Ce(l),K(!0))},children:B?e.jsx("img",{src:B,alt:l.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Ke,{className:"w-6 h-6 sm:w-8 sm:h-8 text-slate-300"})})}),e.jsxs("div",{className:"flex-1 min-w-0 px-2 pb-2 sm:p-0",children:[e.jsxs("div",{className:"text-xs font-mono text-slate-500 mb-0.5 sm:mb-1",children:["#",l.code]}),e.jsxs("h3",{className:"font-semibold text-sm sm:text-base md:text-lg text-slate-900 mb-1 sm:mb-1.5 line-clamp-2",children:[l.name,l.description&&l.description.trim()&&e.jsx("span",{className:"text-sm sm:text-base md:text-lg font-semibold text-slate-900 ml-1.5",children:l.description})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-lg sm:text-xl md:text-2xl font-bold text-brand-600",children:p(l.unitPrice||l.price)}),e.jsx("span",{className:"text-xs sm:text-sm text-slate-500",children:"so'm"})]})]})]})]},l._id)})}),v>=q&&!L&&gs.length>0&&e.jsx("div",{className:"flex justify-center items-center py-6 mt-4",children:e.jsxs("div",{className:"text-slate-400 text-sm",children:["âœ… Barcha maxsulotlar yuklandi (",w," ta)"]})})]})]}),y&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-3 sm:p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/70 via-purple-900/30 to-black/70 backdrop-blur-sm transition-opacity duration-100",onClick:c,style:{animation:"fadeIn 0.1s ease-out"}}),e.jsxs("form",{onSubmit:ae,className:"relative z-10 bg-white rounded-3xl w-full max-w-xs sm:max-w-sm md:max-w-2xl max-h-[90vh] overflow-hidden shadow-[0_20px_60px_-15px_rgba(0,0,0,0.4)] border border-white/20 transform",style:{animation:"modalSlideUp 0.1s ease-out",willChange:"transform, opacity"},children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 px-4 sm:px-6 py-4 sm:py-5 border-b border-white/20 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white flex items-center gap-2 mb-1",children:Qe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(rt,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),"Tovarni tahrirlash"]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(ys,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),"Yangi tovar qo'shish"]})}),e.jsx("p",{className:"text-xs sm:text-sm text-white/90 font-medium",children:Qe?"Tovar ma'lumotlarini yangilang":"Yangi tovar ma'lumotlarini kiriting"})]}),e.jsx("button",{type:"button",onClick:c,className:"p-2 sm:p-2.5 hover:bg-white/20 rounded-xl transition-all duration-300 hover:rotate-90 hover:scale-110 active:scale-95 group ml-3",children:e.jsx(ge,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white group-hover:text-white/90"})})]}),e.jsx("div",{className:"flex items-center justify-between",children:[1,2,3].map(l=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("button",{type:"button",onClick:()=>f(l),className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm transition-all ${j===l?"bg-white text-blue-600 shadow-lg scale-110":j>l?"bg-green-500 text-white":"bg-white/20 text-white/60"}`,children:j>l?"âœ“":l}),e.jsx("span",{className:`text-xs mt-1 font-medium ${j===l?"text-white":"text-white/60"}`,children:l===1?"Asosiy":l===2?"O'lcham":"Narx"})]}),l<3&&e.jsx("div",{className:`h-0.5 flex-1 mx-2 ${j>l?"bg-green-500":"bg-white/20"}`})]},l))})]}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-240px)] p-4 sm:p-6 space-y-4 sm:space-y-6",children:[j===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Rasmlar (max 8 ta - JPG, PNG, WebP)"}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-1 sm:gap-2 mb-1 sm:mb-2",children:[ss.map((l,z)=>{let B=typeof l=="string"?l:l.path;if(B.startsWith("http://")||B.startsWith("https://"))try{B=new URL(B).pathname}catch(le){console.warn("Invalid image URL:",B)}return B.startsWith("/")||(B="/"+B),e.jsxs("div",{className:"relative aspect-square group bg-surface-100 rounded-lg overflow-hidden",children:[e.jsx("img",{src:`${Ls}${B}`,alt:`Rasm ${z+1}`,loading:"lazy",decoding:"async",className:"w-full h-full object-cover",style:{contentVisibility:"auto"}}),e.jsx("button",{type:"button",onClick:()=>H(B),className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2 w-7 h-7 sm:w-8 sm:h-8 bg-red-500 hover:bg-red-600 text-white rounded-lg sm:rounded-xl flex items-center justify-center shadow-lg hover:shadow-xl transition-all hover:scale-110 z-10 opacity-90 hover:opacity-100",title:"Rasmni o'chirish",children:e.jsx(ge,{className:"w-4 h-4 sm:w-5 sm:h-5",strokeWidth:2.5})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors pointer-events-none"})]},z)}),ss.length<8&&e.jsx("button",{type:"button",onClick:()=>{var l;return(l=zs.current)==null?void 0:l.click()},disabled:ve,className:"aspect-square border-2 border-dashed border-surface-300 rounded-lg flex flex-col items-center justify-center hover:border-brand-500 hover:bg-brand-50 transition-colors cursor-pointer group disabled:opacity-50 disabled:cursor-not-allowed",children:ve?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"spinner w-4 h-4 sm:w-5 sm:h-5 text-brand-600"}),e.jsx("span",{className:"text-[8px] sm:text-[9px] text-brand-600 font-semibold",children:"Yuklash..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-4 h-4 sm:w-5 sm:h-5 text-surface-400 mb-0.5 sm:mb-1 group-hover:text-brand-500 transition-colors"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-surface-500 text-center px-0.5 group-hover:text-brand-600 transition-colors",children:"Rasm"})]})})]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-surface-500 mb-2 sm:mb-3",children:"ðŸ’¡ Telefondan rasm olib qo'ysangiz, avtomatik sifati yaxshi bo'lib qo'yiladi. Bir vaqtning o'zida bir nechta rasmni yuklash mumkin."}),e.jsx("input",{ref:zs,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",multiple:!0,capture:"environment",onChange:T,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input text-sm ${os?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"1",value:t.code,onChange:l=>A(N(b({},t),{code:l.target.value})),onBlur:l=>Ts(l.target.value),required:!0}),os&&e.jsx("p",{className:"text-xs text-danger-600 mt-0.5 sm:mt-1",children:os})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"Tovar nomi",value:t.name,onChange:l=>A(N(b({},t),{name:l.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Qisqacha izoh (ixtiyoriy)"}),e.jsx("textarea",{className:"input min-h-[60px] sm:min-h-[80px] resize-none text-sm",placeholder:"Mahsulot haqida qisqacha ma'lumot...",value:t.description||"",onChange:l=>A(N(b({},t),{description:l.target.value})),maxLength:500}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-surface-400 mt-0.5 sm:mt-1",children:[(t.description||"").length,"/500"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"ðŸ“‚ Kategoriya"}),e.jsx("select",{className:"input text-sm cursor-pointer",value:t.category,onChange:l=>A(N(b({},t),{category:l.target.value})),children:Mt.map(l=>e.jsx("option",{value:l,children:l},l))})]})]}),j===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-t border-surface-200 pt-2 sm:pt-3 md:pt-4 mt-2 sm:mt-3 md:mt-4",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-semibold text-surface-900 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(fa,{className:"w-3 h-3 sm:w-4 sm:h-4 text-brand-600"}),"O'lchamlar (ixtiyoriy)"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Eni (sm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"50",value:t.dimensions.width,onChange:l=>A(N(b({},t),{dimensions:N(b({},t.dimensions),{width:l.target.value})}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:t.dimensions.height,onChange:l=>A(N(b({},t),{dimensions:N(b({},t.dimensions),{height:l.target.value})}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Uzunligi (sm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"100",value:t.dimensions.length,onChange:l=>A(N(b({},t),{dimensions:N(b({},t.dimensions),{length:l.target.value})}))})]})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 sm:pt-3 md:pt-4 mt-2 sm:mt-3 md:mt-4",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-semibold text-surface-900 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(fa,{className:"w-3 h-3 sm:w-4 sm:h-4 text-brand-600"}),"O'lchov birligi va Miqdor"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 mb-2 sm:mb-4",children:[e.jsxs("div",{className:"w-full sm:w-1/3",children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"Birlik"}),e.jsxs("select",{className:"input text-sm",value:t.unit,onChange:l=>A(N(b({},t),{unit:l.target.value})),children:[e.jsx("option",{value:"dona",children:"Dona"}),e.jsx("option",{value:"metr",children:"Metr"}),e.jsx("option",{value:"rulon",children:"Rulon"}),e.jsx("option",{value:"karobka",children:"Karobka"}),e.jsx("option",{value:"kg",children:"Kilogram"}),e.jsx("option",{value:"gram",children:"Gram"}),e.jsx("option",{value:"litr",children:"Litr"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:["Miqdor (",t.unit==="dona"?"dona":t.unit==="metr"?"metr":t.unit==="rulon"?"rulon":t.unit==="karobka"?"karobka":t.unit==="kg"?"kg":t.unit==="gram"?"gram":"litr",")"]}),e.jsx("input",{type:"text",className:"input text-sm font-semibold text-center cursor-pointer hover:bg-surface-50 transition-colors",placeholder:"0",value:us(t.quantity),onChange:l=>A(N(b({},t),{quantity:Ge(l.target.value)})),onClick:l=>l.currentTarget.select(),required:!0})]})]}),t.unit==="metr"&&e.jsxs("div",{className:"bg-purple-50 rounded-xl p-3 mb-3 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"ðŸŽžï¸ 1 rulonda necha metr?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:t.metersPerRoll,onChange:l=>A(N(b({},t),{metersPerRoll:Ge(l.target.value)}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"Rulon narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:us(t.pricePerRoll),onChange:l=>A(N(b({},t),{pricePerRoll:Ge(l.target.value)}))})]})]}),t.metersPerRoll&&t.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(yt,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"text-sm font-semibold text-purple-700",children:[t.quantity," metr = ",(Number(t.quantity)/Number(t.metersPerRoll)).toFixed(1)," rulon"]})]})]}),t.unit==="dona"&&e.jsxs("div",{className:"bg-orange-50 rounded-xl p-3 mb-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"ðŸ“¦ 1 karobkada necha dona?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"12",value:t.unitsPerBox,onChange:l=>A(N(b({},t),{unitsPerBox:Ge(l.target.value)}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"Karobka narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:us(t.pricePerBox),onChange:l=>A(N(b({},t),{pricePerBox:Ge(l.target.value)}))})]})]}),t.unitsPerBox&&t.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(yt,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-sm font-semibold text-orange-700",children:[t.quantity," dona = ",(Number(t.quantity)/Number(t.unitsPerBox)).toFixed(1)," karobka"]})]})]}),t.unit==="rulon"&&e.jsxs("div",{className:"bg-purple-50 rounded-xl p-3 mb-3 border border-purple-200",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-purple-700 mb-1 block",children:"1 rulonda necha metr?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"30",value:t.metersPerRoll,onChange:l=>A(N(b({},t),{metersPerRoll:Ge(l.target.value)}))})]})}),t.metersPerRoll&&t.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(yt,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"text-sm font-semibold text-purple-700",children:[t.quantity," rulon = ",p(Number(t.quantity)*Number(t.metersPerRoll))," metr"]})]})]}),t.unit==="karobka"&&e.jsxs("div",{className:"bg-orange-50 rounded-xl p-3 mb-3 border border-orange-200",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-orange-700 mb-1 block",children:"1 karobkada necha dona?"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"12",value:t.unitsPerBox,onChange:l=>A(N(b({},t),{unitsPerBox:Ge(l.target.value)}))})]})}),t.unitsPerBox&&t.quantity&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg",children:[e.jsx(yt,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-sm font-semibold text-orange-700",children:[t.quantity," karobka = ",p(Number(t.quantity)*Number(t.unitsPerBox))," dona"]})]})]})]})]}),j===3&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-t border-surface-200 pt-2 sm:pt-3 md:pt-4 mt-2 sm:mt-3 md:mt-4",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-semibold text-surface-900 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(ds,{className:"w-3 h-3 sm:w-4 sm:h-4 text-green-600"}),"Narxlar (5 ta)"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 mb-2 sm:mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"ðŸ’µ Tan narxi (Dollar)"}),e.jsxs("div",{className:"flex gap-1 sm:gap-2",children:[e.jsx("input",{type:"text",className:"input flex-1 text-sm",placeholder:"0.00",value:t.costPriceInDollar,onChange:l=>{const z=l.target.value.replace(/[^0-9.]/g,""),B=z.split("."),le=B.length>2?B[0]+"."+B.slice(1).join(""):z,ke=parseFloat(le)||0;A(N(b({},t),{costPriceInDollar:le,costPrice:(ke*Te).toString()}))}}),e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-surface-600 flex items-center px-1.5 sm:px-2 bg-surface-100 rounded",children:"$"})]}),e.jsxs("p",{className:"text-[9px] sm:text-[10px] text-surface-500 mt-0.5 sm:mt-1",children:["= ",p((parseFloat(t.costPriceInDollar)||0)*Te)," so'm"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs font-medium text-surface-600 mb-0.5 sm:mb-1 block",children:"ðŸ·ï¸ Dona narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:us(t.unitPrice),onChange:l=>A(N(b({},t),{unitPrice:Ge(l.target.value)})),required:!0})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 mb-3 border border-blue-200",children:[e.jsx("label",{className:"text-xs font-medium text-blue-700 mb-1 block",children:"ðŸ’± Dollar kursi (1 $ = ? so'm)"}),e.jsx("input",{type:"number",className:"input",placeholder:"12500",step:"1",min:"0",value:Te,onChange:l=>Re(parseFloat(l.target.value)||12500)}),e.jsxs("p",{className:"text-[10px] text-blue-600 mt-1",children:["Hozirgi kurs: 1 $ = ",p(Te)," so'm"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-green-50 rounded-xl p-2.5 border border-emerald-200 shadow-sm",children:[e.jsx("h5",{className:"text-[11px] font-semibold text-emerald-800 mb-2 flex items-center gap-1",children:"ðŸŽ¯ Chegirmalar"}),e.jsxs("div",{className:"bg-white rounded-2xl p-2 mb-1.5 border border-emerald-100 flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[9px] font-bold text-emerald-700 bg-emerald-100 px-2 py-0.5 rounded-full",children:"1"}),e.jsx("span",{className:"text-[9px] text-emerald-500 font-medium",children:"Birinci daraja"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] justify-center",children:[e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"1",value:t.pricingTiers.tier1.minQuantity,onChange:l=>A(N(b({},t),{pricingTiers:N(b({},t.pricingTiers),{tier1:N(b({},t.pricingTiers.tier1),{minQuantity:l.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"-"}),e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"5",value:t.pricingTiers.tier1.maxQuantity,onChange:l=>A(N(b({},t),{pricingTiers:N(b({},t.pricingTiers),{tier1:N(b({},t.pricingTiers.tier1),{maxQuantity:l.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"="}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center font-bold rounded-2xl border-indigo-300 bg-indigo-50/60 text-indigo-700 focus:border-indigo-500 focus:ring-indigo-200",placeholder:"15",value:t.pricingTiers.tier1.discountPercent,onChange:l=>A(N(b({},t),{pricingTiers:N(b({},t.pricingTiers),{tier1:N(b({},t.pricingTiers.tier1),{discountPercent:l.target.value})})}))}),e.jsx("span",{className:"text-[11px] font-bold text-indigo-600",children:"%"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-2 mb-1.5 border border-blue-100 flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[9px] font-bold text-blue-700 bg-blue-100 px-2 py-0.5 rounded-full",children:"2"}),e.jsx("span",{className:"text-[9px] text-blue-500 font-medium",children:"Ikkinchi daraja"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] justify-center",children:[e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"6",value:t.pricingTiers.tier2.minQuantity,onChange:l=>A(N(b({},t),{pricingTiers:N(b({},t.pricingTiers),{tier2:N(b({},t.pricingTiers.tier2),{minQuantity:l.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"-"}),e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"20",value:t.pricingTiers.tier2.maxQuantity,onChange:l=>A(N(b({},t),{pricingTiers:N(b({},t.pricingTiers),{tier2:N(b({},t.pricingTiers.tier2),{maxQuantity:l.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"="}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center font-bold rounded-2xl border-indigo-300 bg-indigo-50/60 text-indigo-700 focus:border-indigo-500 focus:ring-indigo-200",placeholder:"13",value:t.pricingTiers.tier2.discountPercent,onChange:l=>A(N(b({},t),{pricingTiers:N(b({},t.pricingTiers),{tier2:N(b({},t.pricingTiers.tier2),{discountPercent:l.target.value})})}))}),e.jsx("span",{className:"text-[11px] font-bold text-indigo-600",children:"%"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-2 border border-purple-100 flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[9px] font-bold text-purple-700 bg-purple-100 px-2 py-0.5 rounded-full",children:"3"}),e.jsx("span",{className:"text-[9px] text-purple-500 font-medium",children:"Uchinchi daraja"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] justify-center",children:[e.jsx("input",{type:"text",className:"input text-xs w-14 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"21",value:t.pricingTiers.tier3.minQuantity,onChange:l=>A(N(b({},t),{pricingTiers:N(b({},t.pricingTiers),{tier3:N(b({},t.pricingTiers.tier3),{minQuantity:l.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"-"}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center rounded-2xl border-violet-200 bg-violet-50/40 focus:border-violet-400 focus:ring-violet-200",placeholder:"100",value:t.pricingTiers.tier3.maxQuantity,onChange:l=>A(N(b({},t),{pricingTiers:N(b({},t.pricingTiers),{tier3:N(b({},t.pricingTiers.tier3),{maxQuantity:l.target.value})})}))}),e.jsx("span",{className:"text-[11px] text-violet-500 font-semibold",children:"="}),e.jsx("input",{type:"text",className:"input text-xs w-16 h-9 text-center font-bold rounded-2xl border-indigo-300 bg-indigo-50/60 text-indigo-700 focus:border-indigo-500 focus:ring-indigo-200",placeholder:"11",value:t.pricingTiers.tier3.discountPercent,onChange:l=>A(N(b({},t),{pricingTiers:N(b({},t.pricingTiers),{tier3:N(b({},t.pricingTiers.tier3),{discountPercent:l.target.value})})}))}),e.jsx("span",{className:"text-[11px] font-bold text-indigo-600",children:"%"})]})]}),e.jsx("p",{className:"text-[10px] text-emerald-600 mt-2 italic",children:"* Masalan: 1-5 dona = 15% chegirma, 6-20 dona = 13% chegirma, 21-100 dona = 11% chegirma"})]}),e.jsxs("div",{className:"mt-4 mb-4 hidden",children:[e.jsxs("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:[t.unit==="metr"?"ðŸ“ Metr narxi":t.unit==="rulon"?"ðŸŽžï¸ Rulon narxi":t.unit==="karobka"?"ðŸ“¦ Karobka narxi":t.unit==="kg"?"âš–ï¸ Kg narxi":t.unit==="gram"?"âš–ï¸ Gram narxi":t.unit==="litr"?"ðŸ’§ Litr narxi":"ðŸ’° Dona narxi"," (so'm)"]}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:us(t.currentPrice),onChange:l=>A(N(b({},t),{currentPrice:Ge(l.target.value)}))})]}),(t.unit==="metr"||t.unit==="rulon")&&e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 mb-3 border border-blue-200",children:[e.jsx("label",{className:"text-xs font-medium text-blue-700 mb-2 block",children:"ðŸ“ Metr narxlari (diapazon bo'yicha)"}),t.meterPriceRanges.map((l,z)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",className:"input text-sm w-16",placeholder:"1",value:l.from,onChange:B=>{const le=[...t.meterPriceRanges];le[z].from=B.target.value,A(N(b({},t),{meterPriceRanges:le}))}}),e.jsx("input",{type:"text",className:"input text-sm w-16",placeholder:"10",value:l.to,onChange:B=>{const le=[...t.meterPriceRanges];le[z].to=B.target.value,A(N(b({},t),{meterPriceRanges:le}))}}),e.jsx("input",{type:"text",className:"input text-sm flex-1",placeholder:"Narx",value:us(l.price),onChange:B=>{const le=[...t.meterPriceRanges];le[z].price=Ge(B.target.value),A(N(b({},t),{meterPriceRanges:le}))}}),e.jsx("span",{className:"text-xs text-blue-600",children:"so'm"}),t.meterPriceRanges.length>1&&e.jsx("button",{type:"button",onClick:()=>{const B=t.meterPriceRanges.filter((le,ke)=>ke!==z);A(N(b({},t),{meterPriceRanges:B}))},className:"w-6 h-6 bg-red-100 text-red-600 rounded flex items-center justify-center hover:bg-red-200",children:e.jsx(ge,{className:"w-3 h-3"})})]},z)),e.jsxs("button",{type:"button",onClick:()=>A(N(b({},t),{meterPriceRanges:[...t.meterPriceRanges,{from:"",to:"",price:""}]})),className:"text-xs text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1",children:[e.jsx(ys,{className:"w-3 h-3"})," Diapazon qo'shish"]})]}),t.unit==="kg"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"âš–ï¸ Kg narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm",placeholder:"0",value:us(t.pricePerKg),onChange:l=>A(N(b({},t),{pricePerKg:Ge(l.target.value)}))})]})]})})]}),e.jsx("div",{className:"sticky bottom-0 bg-gradient-to-r from-slate-50 via-blue-50 to-purple-50 px-4 sm:px-6 py-4 sm:py-5 border-t border-slate-200/50 shadow-[0_-10px_30px_-10px_rgba(0,0,0,0.1)] backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[j>1&&e.jsx("button",{type:"button",onClick:()=>f(j-1),className:"px-5 sm:px-7 py-2.5 sm:py-3 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-semibold hover:bg-slate-50 hover:border-slate-400 hover:shadow-md transition-all duration-300 hover:scale-105 active:scale-95 flex items-center gap-2",children:e.jsx("span",{children:"â† Orqaga"})}),e.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[e.jsxs("button",{type:"button",onClick:c,className:"px-5 sm:px-7 py-2.5 sm:py-3 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-semibold hover:bg-slate-50 hover:border-slate-400 hover:shadow-md transition-all duration-300 hover:scale-105 active:scale-95 flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Bekor qilish"}),e.jsx("span",{className:"sm:hidden",children:"Bekor"})]}),j<3?e.jsx("button",{type:"button",onClick:()=>f(j+1),className:"px-6 sm:px-10 py-2.5 sm:py-3 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 text-white rounded-xl font-bold hover:from-blue-700 hover:via-purple-700 hover:to-blue-700 transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg hover:shadow-2xl flex items-center gap-2",children:e.jsx("span",{children:"Keyingisi â†’"})}):e.jsxs("button",{type:"submit",disabled:!!os||ve,className:"px-6 sm:px-10 py-2.5 sm:py-3 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 text-white rounded-xl font-bold hover:from-blue-700 hover:via-purple-700 hover:to-blue-700 transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg hover:shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center gap-2 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"}),e.jsx(It,{className:"w-4 h-4 sm:w-5 sm:h-5 relative z-10"}),e.jsx("span",{className:"relative z-10",children:Qe?"Yangilash":"Saqlash"})]})]})]})})]})]}),R&&oe&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>W(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 max-h-[90vh] overflow-y-auto rounded-t-2xl sm:rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 sticky top-0 bg-white pb-2 -mt-2 pt-2 border-b border-surface-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"QR Label - Xprinter"}),e.jsx("button",{onClick:()=>W(!1),className:"btn-icon-sm",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(sn,{productId:oe._id,code:oe.code,name:oe.name,price:oe.price,unit:oe.unit,dimensions:oe.dimensions?[oe.dimensions.width,oe.dimensions.height,oe.dimensions.length].filter(Boolean).join(" Ã— "):"",labelWidth:60,labelHeight:40,copies:1,onPrint:()=>W(!1)}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-surface-200 w-full",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-3 text-center",children:"Katta QR (yuklab olish uchun)"}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-white p-3 rounded-xl border border-surface-200",children:e.jsx(Bt,{id:"qr-code-svg",value:`${ha}/product/${oe._id}`,size:150,level:"H",includeMargin:!0})})}),e.jsxs("button",{onClick:Es,className:"btn-secondary w-full",children:[e.jsx(da,{className:"w-4 h-4"}),"PNG yuklab olish"]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg text-xs text-blue-700 w-full",children:[e.jsx("p",{className:"font-medium mb-1",children:"ðŸ“‹ Xprinter sozlamalari:"}),e.jsxs("ul",{className:"space-y-0.5",children:[e.jsx("li",{children:"â€¢ Label o'lchami: 40mm x 30mm"}),e.jsx("li",{children:"â€¢ QR o'lchami: 20mm x 20mm"}),e.jsx("li",{children:"â€¢ Margins: None"})]})]})]})]})]}),Ne&&oe&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-3 sm:p-4 bg-black/50 backdrop-blur-sm",children:[e.jsx("div",{className:"overlay",onClick:()=>E(!1)}),e.jsxs("div",{className:"modal w-full max-w-3xl p-4 sm:p-5 relative z-50 max-h-[90vh] overflow-y-auto bg-white rounded-xl shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-surface-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[Y(oe)?e.jsx("img",{src:Y(oe),alt:oe.name,className:"w-20 h-20 sm:w-24 sm:h-24 rounded-xl object-cover border-2 border-brand-200 shadow-lg"}):e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-brand-500 to-indigo-600 rounded-xl flex items-center justify-center",children:e.jsx(Ke,{className:"w-10 h-10 sm:w-12 sm:h-12 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-surface-900",children:oe.name}),e.jsx("p",{className:"text-sm sm:text-base text-surface-500",children:"Sotuv statistikasi"})]})]}),e.jsx("button",{onClick:()=>E(!1),className:"btn-icon-sm",children:e.jsx(ge,{className:"w-4 h-4"})})]}),Le?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-3"}),e.jsx("p",{className:"text-sm text-surface-500",children:"Yuklanmoqda..."})]}):ce?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-3 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-md flex items-center justify-center",children:e.jsx(hs,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 uppercase tracking-wide",children:"Sotilgan"})]}),e.jsx("p",{className:"text-xl font-bold text-blue-700 mb-0.5",children:p(ce.stats.totalSold)}),e.jsxs("p",{className:"text-[10px] text-blue-500",children:[ce.stats.totalReceipts," ta chek"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-3 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-md flex items-center justify-center",children:e.jsx(ia,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-green-600 uppercase tracking-wide",children:"Daromad"})]}),e.jsx("p",{className:"text-xl font-bold text-green-700 mb-0.5",children:p(ce.stats.totalRevenue)}),e.jsx("p",{className:"text-[10px] text-green-500",children:"so'm"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-3 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-purple-500 rounded-md flex items-center justify-center",children:e.jsx(Hs,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 uppercase tracking-wide",children:"Top kun"})]}),ce.stats.bestDay?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-base font-bold text-purple-700 mb-0.5",children:ce.stats.bestDay.date}),e.jsxs("p",{className:"text-[10px] text-purple-500",children:[ce.stats.bestDay.count," dona"]})]}):e.jsx("p",{className:"text-xs text-purple-500",children:"Ma'lumot yo'q"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-orange-500 rounded-md flex items-center justify-center",children:e.jsx(xt,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("span",{className:"text-[10px] font-semibold text-orange-600 uppercase tracking-wide",children:"Top soat"})]}),ce.stats.bestHour?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-base font-bold text-orange-700 mb-0.5",children:ce.stats.bestHour.label}),e.jsxs("p",{className:"text-[10px] text-orange-500",children:[ce.stats.bestHour.count," dona"]})]}):e.jsx("p",{className:"text-xs text-orange-500",children:"Ma'lumot yo'q"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-surface-200 p-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-surface-900 mb-3 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(xt,{className:"w-3 h-3 text-brand-600"})}),"Soatlik statistika"]}),e.jsx("div",{className:"flex items-end gap-0.5 h-24",children:ce.hourlyStats.map((l,z)=>{var Pe;const B=Math.max(...ce.hourlyStats.map($e=>$e.count),1),le=l.count/B*100,ke=((Pe=ce.stats.bestHour)==null?void 0:Pe.hour)===l.hour;return e.jsxs("div",{className:"flex-1 flex flex-col items-center group relative",children:[e.jsx("div",{className:`w-full rounded-t transition-all ${ke?"bg-gradient-to-t from-orange-500 to-amber-400":"bg-gradient-to-t from-brand-500 to-brand-400"} hover:opacity-80`,style:{height:`${Math.max(le,3)}%`}}),e.jsx("span",{className:"text-[7px] text-surface-400 mt-0.5",children:l.hour}),e.jsxs("div",{className:"absolute bottom-full mb-1 hidden group-hover:block bg-surface-900 text-white text-[10px] px-1.5 py-0.5 rounded whitespace-nowrap z-10",children:[l.label,": ",l.count]})]},z)})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-surface-200 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-surface-900 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(Hs,{className:"w-3 h-3 text-brand-600"})}),"Sotuv tarixi"]}),e.jsx("div",{className:"flex gap-1",children:[{value:"7",label:"7"},{value:"30",label:"30"},{value:"90",label:"90"},{value:"365",label:"1y"},{value:"all",label:"All"}].map(l=>e.jsx("button",{onClick:()=>$s(l.value),className:`px-2 py-1 text-[10px] font-semibold rounded transition-all ${_===l.value?"bg-brand-600 text-white shadow-sm":"bg-surface-100 text-surface-600 hover:bg-surface-200"}`,children:l.label},l.value))})]}),(_==="365"||_==="all")&&ce.monthlyStats&&ce.monthlyStats.length>0?e.jsx("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:ce.monthlyStats.map((l,z)=>{const B=Math.max(...ce.monthlyStats.map(ke=>ke.count),1),le=l.count/B*100;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-surface-600 w-16 flex-shrink-0 font-medium",children:l.label}),e.jsx("div",{className:"flex-1 bg-surface-100 rounded-full h-5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-brand-500 to-indigo-500 rounded-full flex items-center justify-end pr-1.5 transition-all",style:{width:`${Math.max(le,4)}%`},children:l.count>0&&e.jsx("span",{className:"text-[9px] font-bold text-white",children:l.count})})}),e.jsx("span",{className:"text-[10px] text-surface-500 w-20 text-right",children:p(l.revenue)})]},z)})}):e.jsx("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:ce.periodStats&&ce.periodStats.slice(-30).map((l,z)=>{const B=Math.max(...ce.periodStats.map(ke=>ke.count),1),le=l.count/B*100;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-surface-600 w-14 flex-shrink-0 font-medium",children:new Date(l.date).toLocaleDateString("uz-UZ",{day:"numeric",month:"short"})}),e.jsx("div",{className:"flex-1 bg-surface-100 rounded-full h-5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-brand-500 to-indigo-500 rounded-full flex items-center justify-end pr-1.5 transition-all",style:{width:`${Math.max(le,4)}%`},children:l.count>0&&e.jsx("span",{className:"text-[9px] font-bold text-white",children:l.count})})}),e.jsx("span",{className:"text-[10px] text-surface-500 w-20 text-right",children:p(l.revenue)})]},z)})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-surface-200 p-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-surface-900 mb-3 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(hs,{className:"w-3 h-3 text-brand-600"})}),"Oxirgi sotuvlar"]}),ce.recentSales.length>0?e.jsx("div",{className:"overflow-x-auto max-h-48 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"sticky top-0 bg-white",children:e.jsxs("tr",{className:"border-b border-surface-200",children:[e.jsx("th",{className:"text-left py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Sana"}),e.jsx("th",{className:"text-center py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Miqdor"}),e.jsx("th",{className:"text-right py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Narx"}),e.jsx("th",{className:"text-right py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Jami"}),e.jsx("th",{className:"text-left py-1.5 px-2 text-surface-600 font-semibold text-[10px]",children:"Mijoz"})]})}),e.jsx("tbody",{children:ce.recentSales.map((l,z)=>{var B;return e.jsxs("tr",{className:"border-b border-surface-100 hover:bg-surface-50",children:[e.jsx("td",{className:"py-1.5 px-2 text-surface-700 text-[10px]",children:new Date(l.date).toLocaleString("uz-UZ",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"py-1.5 px-2 text-center",children:e.jsx("span",{className:"px-1.5 py-0.5 bg-brand-100 text-brand-700 rounded-full text-[10px] font-semibold",children:l.quantity})}),e.jsx("td",{className:"py-1.5 px-2 text-right text-surface-600 text-[10px]",children:p(l.price)}),e.jsx("td",{className:"py-1.5 px-2 text-right font-semibold text-surface-900 text-[10px]",children:p(l.total)}),e.jsx("td",{className:"py-1.5 px-2 text-surface-600 text-[10px]",children:((B=l.customer)==null?void 0:B.name)||"Noma'lum"})]},z)})})]})}):e.jsxs("div",{className:"text-center py-6 text-surface-500",children:[e.jsx(hs,{className:"w-8 h-8 mx-auto mb-1.5 text-surface-300"}),e.jsx("p",{className:"text-xs",children:"Hali sotuvlar yo'q"})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-surface-500",children:[e.jsx(_t,{className:"w-12 h-12 mx-auto mb-2 text-surface-300"}),e.jsx("p",{className:"text-sm",children:"Statistika topilmadi"})]})]})]}),de&&oe&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 animate-fade-in",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm transition-all duration-300",onClick:()=>K(!1)}),e.jsxs("div",{className:"relative z-10 max-w-4xl w-full max-h-[90vh] animate-scale-in",children:[e.jsx("button",{onClick:()=>K(!1),className:"absolute -top-12 right-0 w-10 h-10 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center transition-all hover:rotate-90 group",children:e.jsx(ge,{className:"w-6 h-6 text-white group-hover:scale-110 transition-transform"})}),e.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-brand-600 to-purple-600",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:oe.name}),e.jsxs("p",{className:"text-sm text-white/80",children:["#",oe.code]})]}),e.jsx("div",{className:"p-4 max-h-[70vh] overflow-y-auto",children:oe.images&&oe.images.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:oe.images.map((l,z)=>{const B=typeof l=="string"?l:l.path;return e.jsx("img",{src:`${Ls}${B}`,alt:`${oe.name} - ${z+1}`,className:"w-full h-auto rounded-lg shadow-lg"},z)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-surface-400",children:[e.jsx(Ke,{className:"w-16 h-16 mb-4"}),e.jsx("p",{children:"Rasm mavjud emas"})]})})]})]})]}),J&&e.jsx(tn,{products:i.filter(l=>Se.has(l._id)),onClose:()=>{ue(!1),V(!1),je(new Set)}}),Ye&&!I&&e.jsx("button",{onClick:()=>he(!0),className:"fixed bottom-24 right-6 lg:bottom-8 lg:right-8 w-14 h-14 bg-gradient-to-br from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white rounded-full shadow-2xl hover:shadow-purple-500/50 flex items-center justify-center transition-all duration-300 hover:scale-110 active:scale-95 z-40",title:"Qidirish",children:e.jsx(fs,{className:"w-6 h-6"})}),I&&e.jsxs("div",{className:"fixed bottom-24 right-6 lg:bottom-8 lg:right-8 z-40 flex items-center gap-2 animate-slide-in-right",children:[e.jsxs("div",{className:"relative flex-1 min-w-[300px] sm:min-w-[400px]",children:[e.jsx(fs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-purple-600"}),e.jsx("input",{type:"text",value:me,onChange:l=>{ze(l.target.value),ts(l.target.value)},placeholder:"Tovar qidirish...",className:"w-full pl-12 pr-12 py-4 bg-white border-2 border-purple-200 rounded-2xl shadow-2xl text-base focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-100 transition-all",autoFocus:!0}),me&&e.jsx("button",{onClick:()=>{ze(""),ts("")},className:"absolute right-12 top-1/2 -translate-y-1/2 p-1.5 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(ge,{className:"w-4 h-4 text-slate-400"})})]}),e.jsx("button",{onClick:()=>{he(!1),ze("")},className:"w-14 h-14 bg-white hover:bg-slate-50 border-2 border-slate-200 rounded-full shadow-xl flex items-center justify-center transition-all hover:scale-105",title:"Yopish",children:e.jsx(ge,{className:"w-6 h-6 text-slate-600"})})]})]})}function rn(){const{showAlert:a,showConfirm:o,AlertComponent:n}=Ps(),[x,i]=s.useState([]),[g,v]=s.useState(!1),[h,q]=s.useState(!1),[P,w]=s.useState(!1),[S,L]=s.useState(null),[$,C]=s.useState([]),[m,y]=s.useState(null),[k,j]=s.useState(null),[f,R]=s.useState(!0),[W,J]=s.useState(!1),[ue,de]=s.useState(""),[K,Se]=s.useState(!1),[je,Me]=s.useState(null),[V,Ne]=s.useState({name:"",address:""}),[E,ce]=s.useState({code:"",name:"",costPrice:"",wholesalePrice:"",quantity:""}),[be,Le]=s.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[O,_]=s.useState("");s.useEffect(()=>{D()},[]);const D=()=>Q(this,null,function*(){try{const ve=(yield U.get("/warehouses")).data.filter(M=>M.name!=="Asosiy ombor");i(ve)}catch(X){console.error("Error fetching warehouses:",X)}finally{R(!1)}}),we=X=>Q(this,null,function*(){J(!0);try{const ve=yield U.get(`/products?warehouse=${X}`);C(ve.data)}catch(ve){console.error("Error fetching products:",ve)}finally{J(!1)}}),Z=X=>Q(this,null,function*(){X.preventDefault();try{m?yield U.put(`/warehouses/${m._id}`,V):yield U.post("/warehouses",V),D(),He()}catch(ve){console.error("Error saving warehouse:",ve)}}),oe=X=>Q(this,null,function*(){var Te,Re;if(X.preventDefault(),!S)return;if(O){a(O,"Xatolik","danger");return}let ve=0,M=Number(E.costPrice)||0;if(be.packageCount&&be.unitsPerPackage){const Ue=Number(be.packageCount)*Number(be.unitsPerPackage);ve=k?k.quantity+Ue:Ue}else k&&(ve=k.quantity);try{const Ue={code:E.code,name:E.name,costPrice:M,price:Number(E.wholesalePrice),quantity:ve,warehouse:S._id};k?yield U.put(`/products/${k._id}`,Ue):yield U.post("/products",Ue),we(S._id),ee()}catch(Ue){a(((Re=(Te=Ue.response)==null?void 0:Te.data)==null?void 0:Re.message)||"Xatolik yuz berdi","Xatolik","danger")}}),Ce=X=>Q(this,null,function*(){if((yield o("Tovarni o'chirishni tasdiqlaysizmi?","O'chirish"))&&S)try{yield U.delete(`/products/${X}`),we(S._id)}catch(M){console.error("Error deleting product:",M)}}),Qe=X=>Q(this,null,function*(){if(yield o("Omborni o'chirishni tasdiqlaysizmi?","O'chirish"))try{yield U.delete(`/warehouses/${X}`),D()}catch(M){console.error("Error deleting warehouse:",M)}}),_e=X=>{L(X),we(X._id),q(!0)},Oe=X=>{y(X),Ne({name:X.name,address:X.address||""}),v(!0)},ts=X=>{j(X),ce({code:X.code,name:X.name,costPrice:String(X.costPrice||0),wholesalePrice:String(X.price),quantity:String(X.quantity)}),_(""),w(!0)},He=()=>{v(!1),y(null),Ne({name:"",address:""})},u=()=>{q(!1),L(null),C([]),de("")},ee=()=>{w(!1),j(null),ce({code:"",name:"",costPrice:"",wholesalePrice:"",quantity:""}),Le({packageCount:"",unitsPerPackage:"",totalCost:""}),_("")},Ie=()=>Q(this,null,function*(){try{const X=yield U.get("/products/next-code");ce(N(b({},E),{code:X.data.code,name:"",costPrice:"",wholesalePrice:"",quantity:""}))}catch(X){console.error("Error getting next code:",X)}Le({packageCount:"",unitsPerPackage:"",totalCost:""}),_(""),w(!0)}),qe=X=>Q(this,null,function*(){if(X)try{const ve=(k==null?void 0:k._id)||"";(yield U.get(`/products/check-code/${X}${ve?`?excludeId=${ve}`:""}`)).data.exists?_(`Kod "${X}" allaqachon mavjud`):_("")}catch(ve){console.error("Error checking code:",ve)}}),ne=X=>{Me(X),Se(!0)},Ze=()=>{if(!je)return;const X=document.getElementById("qr-code-svg-warehouse");if(!X)return;const ve=new XMLSerializer().serializeToString(X),M=document.createElement("canvas"),Te=M.getContext("2d"),Re=new Image;Re.onload=()=>{M.width=Re.width,M.height=Re.height,Te==null||Te.drawImage(Re,0,0);const Ue=M.toDataURL("image/png"),Ye=document.createElement("a");Ye.download=`QR-${je.code}-${je.name}.png`,Ye.href=Ue,Ye.click()},Re.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(ve)))};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[n,e.jsx(Ws,{title:"Omborlar",actions:e.jsxs("button",{onClick:()=>v(!0),className:"btn-primary",children:[e.jsx(ys,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi ombor"})]})}),e.jsx("div",{className:"p-4 lg:p-6",children:f?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):x.length===0?e.jsxs("div",{className:"card flex flex-col items-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(ea,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Omborlar yo'q"}),e.jsx("p",{className:"text-surface-500 mb-6",children:"Birinchi omborni qo'shing"}),e.jsx("button",{onClick:()=>v(!0),className:"btn-primary",children:"Ombor qo'shish"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(X=>e.jsxs("div",{className:"card-hover cursor-pointer",onClick:()=>_e(X),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(ea,{className:"w-6 h-6 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-surface-900",children:X.name}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-surface-500",children:[e.jsx($t,{className:"w-3 h-3"}),e.jsx("span",{children:X.address||"Manzil ko'rsatilmagan"})]})]})]}),e.jsxs("div",{className:"flex gap-1",onClick:ve=>ve.stopPropagation(),children:[e.jsx("button",{onClick:()=>Oe(X),className:"btn-icon-sm hover:bg-brand-100 hover:text-brand-600",children:e.jsx(rt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Qe(X._id),className:"btn-icon-sm hover:bg-danger-100 hover:text-danger-600",children:e.jsx(_s,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500 pt-3 border-t border-surface-100",children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsxs("span",{children:[X.productCount||0," ta tovar"]})]})]},X._id))})}),g&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:He}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:m?"Omborni tahrirlash":"Yangi ombor"}),e.jsx("button",{onClick:He,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:Z,className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Ombor nomi"}),e.jsx("input",{type:"text",className:"input",placeholder:"Ombor nomi",value:V.name,onChange:X=>Ne(N(b({},V),{name:X.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Manzil"}),e.jsxs("div",{className:"relative",children:[e.jsx($t,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-12",placeholder:"Manzilni kiriting",value:V.address,onChange:X=>Ne(N(b({},V),{address:X.target.value}))})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:He,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Saqlash"})]})]})})]})]}),h&&S&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-2 lg:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:u}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-[98vw] lg:max-w-[95vw] relative z-10 flex flex-col max-h-[96vh] lg:max-h-[94vh]",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 lg:p-6 gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:S.name}),e.jsx("p",{className:"text-sm text-surface-500 truncate",children:"Ombordagi tovarlar"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Qidirish...",value:ue,onChange:X=>de(X.target.value),className:"w-48 lg:w-64 pl-9 pr-4 py-2 bg-surface-50 border border-surface-200 rounded-xl text-sm focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"})]}),e.jsxs("button",{onClick:Ie,className:"btn-primary",children:[e.jsx(ys,{className:"w-4 h-4"}),"Tovar qo'shish"]}),e.jsx("button",{onClick:u,className:"btn-icon-sm",children:e.jsx(ge,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:W?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):$.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Ke,{className:"w-12 h-12 text-surface-300 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Bu omborga tovarlar yo'q"}),e.jsx("button",{onClick:Ie,className:"btn-primary mt-4",children:"Tovar qo'shish"})]}):e.jsx("div",{className:"divide-y divide-surface-100",children:$.filter(X=>ue===""||X.name.toLowerCase().includes(ue.toLowerCase())||X.code.toLowerCase().includes(ue.toLowerCase())).map(X=>e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(Ke,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:X.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",X.code]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-surface-500",children:["Tan narxi: ",p(X.costPrice||0)," so'm"]}),e.jsxs("p",{className:"font-semibold text-surface-900",children:["Optom: ",p(X.price)," so'm"]}),e.jsxs("p",{className:`text-sm ${X.quantity===0?"text-danger-600":"text-surface-500"}`,children:[X.quantity," dona"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>ne(X),className:"btn-icon-sm hover:bg-surface-200",title:"QR kod",children:e.jsx(zt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ts(X),className:"btn-icon-sm hover:bg-brand-100 hover:text-brand-600",children:e.jsx(rt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ce(X._id),className:"btn-icon-sm hover:bg-danger-100 hover:text-danger-600",children:e.jsx(_s,{className:"w-4 h-4"})})]})]})]},X._id))})})]})]}),P&&S&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:ee}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-lg relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:k?"Tovarni tahrirlash":"Yangi tovar"}),e.jsxs("p",{className:"text-sm text-surface-500 truncate",children:[S.name," uchun"]})]}),e.jsx("button",{onClick:ee,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:oe,className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input ${O?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"000001",value:E.code,onChange:X=>ce(N(b({},E),{code:X.target.value})),onBlur:X=>qe(X.target.value),required:!0}),O&&e.jsx("p",{className:"text-sm text-danger-600 mt-1",children:O})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input",placeholder:"Tovar nomi",value:E.name,onChange:X=>ce(N(b({},E),{name:X.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Tan narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:us(E.costPrice),onChange:X=>ce(N(b({},E),{costPrice:Ge(X.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Optom narxi (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:us(E.wholesalePrice),onChange:X=>ce(N(b({},E),{wholesalePrice:Ge(X.target.value)})),required:!0})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4",children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-3 block",children:"Qop ma'lumotlari"}),e.jsx("div",{className:"space-y-3 bg-surface-50 p-4 rounded-xl",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Qoplar soni"}),e.jsx("input",{type:"number",className:"input text-sm",placeholder:"5",value:be.packageCount,onChange:X=>Le(N(b({},be),{packageCount:X.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Har qopda"}),e.jsx("input",{type:"number",className:"input text-sm",placeholder:"20",value:be.unitsPerPackage,onChange:X=>Le(N(b({},be),{unitsPerPackage:X.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Jami mahsulot"}),e.jsx("input",{type:"text",className:"input text-sm bg-surface-100",placeholder:"0",value:be.packageCount&&be.unitsPerPackage?p(Number(be.packageCount)*Number(be.unitsPerPackage)):"",readOnly:!0})]})]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:ee,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:!!O,children:"Saqlash"})]})]})})]})]}),K&&je&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>Se(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-sm relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900",children:"QR Kod"}),e.jsx("button",{onClick:()=>Se(!1),className:"flex-shrink-0 btn-icon-sm",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 flex flex-col items-center",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border border-surface-200 mb-4",children:e.jsx(Bt,{id:"qr-code-svg-warehouse",value:JSON.stringify({id:je._id,code:je.code,name:je.name,price:je.price}),size:200,level:"H",includeMargin:!0})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-semibold text-surface-900",children:je.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",je.code]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Tan narxi: ",p(je.costPrice||0)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Optom: ",p(je.price)," so'm"]})]}),e.jsxs("button",{onClick:Ze,className:"btn-primary w-full",children:[e.jsx(da,{className:"w-4 h-4"}),"Yuklab olish"]})]})})]})]})]})}const Kt={"Toshkent shahri":["Bektemir","Chilonzor","Mirobod","Mirzo Ulug'bek","Olmazor","Sergeli","Shayxontohur","Uchtepa","Yakkasaroy","Yunusobod","Yashnobod"],"Toshkent viloyati":["Angren","Bekobod","Bo'ka","Bo'stonliq","Chinoz","Chirchiq","Nurafshon","Ohangaron","Olmaliq","Oqqo'rg'on","Parkent","Piskent","Qibray","Quyi Chirchiq","Toshkent","Yangiyo'l","Yuqori Chirchiq","Zangiota"],"Andijon viloyati":["Andijon","Asaka","Baliqchi","Bo'z","Buloqboshi","Izboskan","Jalaquduq","Xo'jaobod","Qo'rg'ontepa","Marhamat","Oltinko'l","Paxtaobod","Shahrixon","Ulug'nor","Xonobod"],"Buxoro viloyati":["Buxoro","G'ijduvon","Jondor","Kogon","Olot","Peshku","Qorako'l","Qorovulbozor","Romitan","Shofirkon","Vobkent"],"Farg'ona viloyati":["Farg'ona","Bag'dod","Beshariq","Buvayda","Dang'ara","Furqat","Qo'qon","Quva","Marg'ilon","Oltiariq","Qo'shtepa","Rishton","So'x","Toshloq","Uchko'prik","Yozyovon"],"Jizzax viloyati":["Jizzax","Arnasoy","Baxmal","Do'stlik","Forish","G'allaorol","Mirzacho'l","Paxtakor","Yangiobod","Zafarobod","Zarband","Zomin"],"Xorazm viloyati":["Urganch","Bog'ot","Gurlan","Xonqa","Hazorasp","Xiva","Qo'shko'pir","Shovot","Tuproqqal'a","Yangiariq","Yangibozor"],"Namangan viloyati":["Namangan","Chortoq","Chust","Kosonsoy","Mingbuloq","Norin","Pop","To'raqo'rg'on","Uchqo'rg'on","Uychi","Yangiqo'rg'on"],"Navoiy viloyati":["Navoiy","Karmana","Konimex","Navbahor","Nurota","Qiziltepa","Tomdi","Uchquduq","Xatirchi","Zarafshon"],"Qashqadaryo viloyati":["Qarshi","Chiroqchi","Dehqonobod","G'uzor","Kasbi","Kitob","Koson","Mirishkor","Muborak","Nishon","Qamashi","Shahrisabz","Yakkabog'"],"Qoraqalpog'iston":["Nukus","Amudaryo","Beruniy","Chimboy","Ellikqal'a","Kegeyli","Mo'ynoq","Nukus tumani","Qanliko'l","Qo'ng'irot","Shumanay","Taxtako'pir","To'rtko'l","Xo'jayli"],"Samarqand viloyati":["Samarqand","Bulung'ur","Ishtixon","Jomboy","Kattaqo'rg'on","Narpay","Nurobod","Oqdaryo","Past darg'om","Payariq","Paxtachi","Qo'shrabot","Toyloq","Urgut"],"Sirdaryo viloyati":["Guliston","Boyovut","Mirzaobod","Oqoltin","Sardoba","Sayxunobod","Sirdaryo","Xovos","Yangiyer"],"Surxondaryo viloyati":["Termiz","Angor","Bandixon","Boysun","Denov","Jarqo'rg'on","Muzrabot","Oltinsoy","Qiziriq","Qumqo'rg'on","Sariosiyo","Sherobod","Sho'rchi","Uzun"]},ta=Object.keys(Kt);function nn(){var Le,O;const{showConfirm:a,showAlert:o,AlertComponent:n}=Ps(),[x,i]=s.useState([]),[g,v]=s.useState(!0),[h,q]=s.useState(!1),[P,w]=s.useState(null),[S,L]=s.useState(""),[$,C]=s.useState(null),[m,y]=s.useState({name:"",phone:"",region:"",district:""}),[k,j]=s.useState(""),[f,R]=s.useState(""),[W,J]=s.useState(!1),[ue,de]=s.useState("name");s.useEffect(()=>{K()},[]);const K=()=>Q(this,null,function*(){try{const _=yield U.get("/customers");i(_.data)}catch(_){console.error(_),o("Mijozlarni yuklashda xatolik","Xatolik","danger")}finally{v(!1)}}),Se=_=>Q(this,null,function*(){_.preventDefault();try{const D={name:m.name,phone:m.phone,address:m.region&&m.district?`${m.region}, ${m.district}`:""};P?(yield U.put(`/customers/${P._id}`,D),o("Mijoz yangilandi","Muvaffaqiyat","success")):(yield U.post("/customers",D),o("Mijoz qo'shildi","Muvaffaqiyat","success")),K(),V()}catch(D){console.error(D),o("Xatolik yuz berdi","Xatolik","danger")}}),je=_=>Q(this,null,function*(){if(yield a("Mijozni o'chirishni tasdiqlaysizmi?","O'chirish")){C(_);try{yield U.delete(`/customers/${_}`),i(x.filter(we=>we._id!==_)),o("Mijoz o'chirildi","Muvaffaqiyat","success"),setTimeout(()=>{C(null)},2e3)}catch(we){C(null),console.error(we),o("Xatolik yuz berdi","Xatolik","danger")}}}),Me=_=>{w(_);const D=(_.address||"").split(", ");y({name:_.name,phone:_.phone,region:D[0]||"",district:D[1]||""}),q(!0)},V=()=>{q(!1),w(null),y({name:"",phone:"",region:"",district:""})},Ne=x.filter(_=>{const D=S.trim()===""||_.name.toLowerCase().includes(S.toLowerCase())||_.phone.includes(S);let we=!0;if(k){const Z=(_.address||"").split(", "),oe=Z[0]||"",Ce=Z[1]||"";we=oe===k,we&&f&&(we=Ce===f)}return D&&we}).sort((_,D)=>ue==="debt"?(D.debt||0)-(_.debt||0):ue==="purchases"?(D.totalPurchases||0)-(_.totalPurchases||0):_.name.localeCompare(D.name)),E={total:x.length,withDebt:x.filter(_=>_.debt>0).length,totalDebt:x.reduce((_,D)=>_+(D.debt||0),0),totalPurchases:x.reduce((_,D)=>_+(D.totalPurchases||0),0)},ce=()=>k?f?`${k}, ${f}`:k:"Barcha hududlar",be=()=>{j(""),R("")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-purple-100/30 to-slate-100 pb-20 lg:pb-0",children:[n,e.jsx(Ws,{title:"Mijozlar",showSearch:!0,onSearch:L,actions:e.jsxs("button",{onClick:()=>q(!0),className:"btn-primary",children:[e.jsx(ys,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi mijoz"})]})}),e.jsxs("div",{className:"max-w-[1800px] mx-auto p-4 lg:p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-3 lg:gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Jami"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Ys,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-blue-600"})})]}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-slate-900",children:E.total}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"mijozlar"})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Qarzli"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(ca,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-red-600"})})]}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-slate-900",children:E.withDebt}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"ta"})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Qarz"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(ds,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-red-600"})})]}),e.jsx("p",{className:"text-base sm:text-xl lg:text-2xl font-bold text-red-600",children:p(E.totalDebt)}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"so'm"})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 lg:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold text-slate-600 uppercase",children:"Xarid"}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 lg:w-10 lg:h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(hs,{className:"w-4 h-4 sm:w-4.5 sm:h-4.5 lg:w-5 lg:h-5 text-green-600"})})]}),e.jsx("p",{className:"text-base sm:text-xl lg:text-2xl font-bold text-green-600",children:p(E.totalPurchases)}),e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:"so'm"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 p-3 sm:p-4 flex flex-col sm:flex-row gap-2 sm:gap-3 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs("button",{onClick:()=>J(!W),className:`flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors whitespace-nowrap ${k?"bg-brand-100 text-brand-700":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:[e.jsx($t,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),e.jsx("span",{className:"max-w-[120px] sm:max-w-none truncate",children:ce()}),e.jsx(pt,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})]}),W&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>J(!1)}),e.jsxs("div",{className:"absolute left-0 sm:left-auto sm:right-0 top-full mt-2 w-[calc(100vw-2rem)] sm:w-72 bg-white rounded-xl shadow-xl border border-slate-200 z-50 p-3 sm:p-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-slate-700",children:"Hudud filtri"}),k&&e.jsx("button",{onClick:be,className:"text-xs text-brand-600 hover:text-brand-700 font-medium",children:"Tozalash"})]}),e.jsxs("select",{className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 text-xs sm:text-sm mb-2",value:k,onChange:_=>{j(_.target.value),R("")},children:[e.jsx("option",{value:"",children:"Barcha viloyatlar"}),ta.map(_=>e.jsx("option",{value:_,children:_},_))]}),k&&e.jsxs("select",{className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 text-xs sm:text-sm",value:f,onChange:_=>R(_.target.value),children:[e.jsx("option",{value:"",children:"Barcha tumanlar"}),(Le=Kt[k])==null?void 0:Le.map(_=>e.jsx("option",{value:_,children:_},_))]})]})]})]}),e.jsxs("select",{value:ue,onChange:_=>de(_.target.value),className:"px-3 sm:px-4 py-2 border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 text-xs sm:text-sm font-medium bg-white flex-shrink-0",children:[e.jsx("option",{value:"name",children:"Ism"}),e.jsx("option",{value:"debt",children:"Qarz"}),e.jsx("option",{value:"purchases",children:"Xarid"})]})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-slate-500 whitespace-nowrap",children:[Ne.length," ta"]})]}),g?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):Ne.length===0?e.jsxs("div",{className:"bg-white rounded-xl border-2 border-slate-200 flex flex-col items-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Ys,{className:"w-8 h-8 text-slate-400"})}),k?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Bu hududda mijozlar yo'q"}),e.jsxs("p",{className:"text-slate-500 mb-6 text-center",children:[e.jsx("span",{className:"font-medium text-brand-600",children:f?`${k}, ${f}`:k})," da hech qanday mijoz topilmadi"]}),e.jsxs("button",{onClick:be,className:"px-6 py-2 bg-brand-500 hover:bg-brand-600 text-white font-semibold rounded-lg transition-colors",children:[e.jsx(ge,{className:"w-4 h-4 inline mr-2"}),"Filterni tozalash"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Mijozlar yo'q"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Birinchi mijozni qo'shing"}),e.jsx("button",{onClick:()=>q(!0),className:"px-6 py-2 bg-brand-500 hover:bg-brand-600 text-white font-semibold rounded-lg transition-colors",children:"Mijoz qo'shish"})]})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4",children:Ne.map(_=>e.jsxs("div",{className:"group bg-white rounded-xl border border-slate-200 hover:border-brand-400 hover:shadow-xl transition-all duration-300 p-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand-50/0 to-purple-50/0 group-hover:from-brand-50/50 group-hover:to-purple-50/30 transition-all duration-300 pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-lg flex items-center justify-center flex-shrink-0 shadow-md",children:e.jsx("span",{className:"font-bold text-base text-white",children:_.name.charAt(0)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-bold text-slate-900 text-sm truncate",children:_.name}),e.jsx("p",{className:"text-xs text-slate-500 truncate",children:Qa(_.phone)})]})]}),e.jsxs("div",{className:"flex gap-1 flex-shrink-0 ml-2",children:[e.jsx("button",{onClick:()=>Me(_),className:"p-1.5 hover:bg-blue-50 text-blue-600 rounded-lg transition-colors",title:"Tahrirlash",children:e.jsx(rt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>je(_._id),disabled:$===_._id,className:"p-1.5 hover:bg-red-50 text-red-600 rounded-lg transition-colors disabled:opacity-50",title:"O'chirish",children:$===_._id?e.jsx("div",{className:"w-3.5 h-3.5 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):e.jsx(_s,{className:"w-3.5 h-3.5"})})]})]}),_.address&&e.jsx("div",{className:"mb-3 pb-2 border-b border-slate-100",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-600",children:[e.jsx($t,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:_.address})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-green-50 rounded-lg p-2 border border-emerald-200/50",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(hs,{className:"w-3 h-3 text-emerald-600"}),e.jsx("p",{className:"text-[10px] text-emerald-600 font-semibold",children:"Xaridlar"})]}),e.jsx("p",{className:"text-sm font-bold text-emerald-700 truncate",children:p(_.totalPurchases||0)}),e.jsxs("p",{className:"text-[9px] text-emerald-600 mt-0.5",children:[_.purchaseCount||0," ta"]})]}),e.jsxs("div",{className:`rounded-lg p-2 border ${_.debt>0?"bg-gradient-to-br from-red-50 to-rose-50 border-red-200/50":"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(ds,{className:`w-3 h-3 ${_.debt>0?"text-red-600":"text-blue-600"}`}),e.jsx("p",{className:`text-[10px] font-semibold ${_.debt>0?"text-red-600":"text-blue-600"}`,children:"Qarz"})]}),e.jsx("p",{className:`text-sm font-bold truncate ${_.debt>0?"text-red-700":"text-blue-700"}`,children:p(_.debt)}),e.jsx("p",{className:`text-[9px] mt-0.5 ${_.debt>0?"text-red-600":"text-blue-600"}`,children:_.debt>0?"To'lash kerak":"0 ta"})]})]})]})]},_._id))})]}),h&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 px-4 py-3 text-white flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-bold",children:P?"Mijozni tahrirlash":"Yangi mijoz"}),e.jsx("button",{onClick:V,className:"hover:bg-brand-600 p-1 rounded-lg transition-colors",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:Se,className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Ism"}),e.jsx("input",{className:"w-full px-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",placeholder:"Mijoz ismi",value:m.name,onChange:_=>y(N(b({},m),{name:_.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Telefon"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{className:"w-full pl-10 pr-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",placeholder:"+998 (XX) XXX-XX-XX",value:m.phone,onChange:_=>y(N(b({},m),{phone:ht(_.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Viloyat"}),e.jsxs("select",{className:"w-full px-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",value:m.region,onChange:_=>y(N(b({},m),{region:_.target.value,district:""})),children:[e.jsx("option",{value:"",children:"Viloyatni tanlang"}),ta.map(_=>e.jsx("option",{value:_,children:_},_))]})]}),m.region&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 mb-1.5 block",children:"Tuman"}),e.jsxs("select",{className:"w-full px-3 py-2 text-sm border-2 border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",value:m.district,onChange:_=>y(N(b({},m),{district:_.target.value})),children:[e.jsx("option",{value:"",children:"Tumanni tanlang"}),(O=Kt[m.region])==null?void 0:O.map(_=>e.jsx("option",{value:_,children:_},_))]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:V,className:"flex-1 px-3 py-2 text-xs font-semibold bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"flex-1 px-3 py-2 text-xs font-semibold bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white rounded-lg transition-all shadow-lg",children:"Saqlash"})]})]})]})})]})}function Na(){var He;const{user:a}=it(),o=(a==null?void 0:a.role)==="admin",{showConfirm:n,showAlert:x,AlertComponent:i}=Ps(),[g,v]=s.useState([]),[h,q]=s.useState([]),[P,w]=s.useState({total:0,approved:0,today:0,overdue:0,paid:0,blacklist:0,totalAmount:0,pendingApproval:0}),[S,L]=s.useState(!1),[$,C]=s.useState(!1),[m,y]=s.useState(null),[k,j]=s.useState(!0),[f,R]=s.useState("receivable"),[W,J]=s.useState({customer:"",creditorName:"",amount:"",dueDate:"",description:"",collateral:""}),[ue,de]=s.useState(""),[K,Se]=s.useState(""),[je,Me]=s.useState("all"),[V,Ne]=s.useState(!1),[E,ce]=s.useState({name:"",phone:"",region:"",district:""}),[be,Le]=s.useState(null);s.useEffect(()=>{O(),_(),D()},[f]);const O=()=>Q(this,null,function*(){try{const u=yield U.get(`/debts?type=${f}`);v(u.data)}catch(u){console.error("Error fetching debts:",u)}finally{j(!1)}}),_=()=>Q(this,null,function*(){try{const u=yield U.get("/customers");q(u.data)}catch(u){console.error("Error fetching customers:",u)}}),D=()=>Q(this,null,function*(){try{const u=yield U.get(`/debts/stats?type=${f}`);w(u.data)}catch(u){console.error("Error fetching stats:",u)}}),we=u=>Q(this,null,function*(){u.preventDefault();try{const ee={type:f,customer:f==="receivable"?W.customer:void 0,creditorName:f==="payable"?W.creditorName:void 0,amount:Number(W.amount),dueDate:W.dueDate,description:W.description,collateral:W.collateral};be?yield U.put(`/debts/${be._id}`,ee):(yield U.post("/debts",ee),x("Qarz muvaffaqiyatli qo'shildi","Muvaffaqiyat","success")),O(),D(),oe()}catch(ee){console.error("Error saving debt:",ee),x("Qarz qo'shishda xatolik yuz berdi","Xatolik","danger")}}),Z=u=>Q(this,null,function*(){if(u.preventDefault(),!!m)try{yield U.post(`/debts/${m._id}/payment`,{amount:Number(ue),method:"cash"}),O(),D(),C(!1),y(null),de("")}catch(ee){console.error("Error making payment:",ee)}}),oe=()=>{L(!1),Le(null),J({customer:"",creditorName:"",amount:"",dueDate:"",description:"",collateral:""}),Ne(!1),ce({name:"",phone:"",region:"",district:""})},Ce=()=>Q(this,null,function*(){if(!(!E.name||!E.phone))try{const u={name:E.name,phone:E.phone,address:E.region&&E.district?`${E.region}, ${E.district}`:""},ee=yield U.post("/customers",u);yield _(),J(N(b({},W),{customer:ee.data._id})),Ne(!1),ce({name:"",phone:"",region:"",district:""})}catch(u){console.error("Error creating customer:",u)}}),Qe=g.filter(u=>{var Ze,X;const ee=((Ze=u.customer)==null?void 0:Ze.name)||u.creditorName||"",Ie=((X=u.customer)==null?void 0:X.phone)||"",qe=ee.toLowerCase().includes(K.toLowerCase())||Ie.includes(K);let ne=!0;if(je==="today"){const ve=new Date;ve.setHours(0,0,0,0);const M=new Date(ve.getTime()+864e5),Te=new Date(u.dueDate);ne=Te>=ve&&Te<M&&u.status!=="paid"}else je!=="all"&&(ne=u.status===je);return qe&&ne}),_e=[{label:"AKTIV",value:P.approved,icon:ut,color:"success",filter:"approved"},{label:"QORA RO'YXAT",value:P.blacklist,icon:Rs,color:"danger",filter:"blacklist"},{label:"MUDDATI O'TGAN",value:P.overdue,icon:ca,color:"danger",filter:"overdue"},{label:"JAMI QARZ",value:`${p(P.totalAmount)} so'm`,icon:rr,color:"accent",filter:null}],Oe=u=>{var ee;return(ee=u.customer)!=null&&ee.name?u.customer.name:u.creditorName||"Noma'lum"},ts=u=>{var ee;return((ee=u.customer)==null?void 0:ee.phone)||""};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[i,e.jsx(Ws,{title:"Qarz daftarcha",showSearch:!0,onSearch:Se,actions:e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("button",{onClick:()=>L(!0),className:"flex items-center gap-1 px-2 py-1 sm:px-3 sm:py-2 rounded-full bg-brand-500 hover:bg-brand-600 text-white shadow-sm hover:shadow-md transition-all active:scale-95",title:"Yangi qarz qo'shish",children:[e.jsx(ys,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"text-[10px] sm:text-xs font-medium",children:"Qo'shish"})]})})}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[o&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"inline-flex p-1 bg-surface-100 rounded-xl",children:[e.jsxs("button",{onClick:()=>{R("receivable"),Me("all")},className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all ${f==="receivable"?"bg-white text-success-600 shadow-sm":"text-surface-500 hover:text-surface-700"}`,children:[e.jsx(ba,{className:"w-4 h-4"}),"Menga qarzdor"]}),e.jsxs("button",{onClick:()=>{R("payable"),Me("all")},className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all ${f==="payable"?"bg-white text-danger-600 shadow-sm":"text-surface-500 hover:text-surface-700"}`,children:[e.jsx(Gt,{className:"w-4 h-4"}),"Men qarzdorman"]})]})}),e.jsx("div",{className:"grid grid-cols-4 gap-2 sm:gap-3",children:_e.map((u,ee)=>e.jsx("div",{onClick:()=>u.filter&&Me(u.filter),className:`group relative ${u.filter?"cursor-pointer":""}`,children:e.jsxs("div",{className:`relative bg-white rounded-xl p-2 sm:p-3 shadow-md hover:shadow-lg transition-all duration-300 hover:scale-[1.02] overflow-hidden h-[80px] sm:h-[90px] flex flex-col ${je===u.filter?"ring-2 ring-brand-500":"border border-surface-200"}`,children:[e.jsx("div",{className:`absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r ${u.color==="success"?"from-emerald-500 to-emerald-600":u.color==="danger"?"from-red-500 to-red-600":(u.color==="accent","from-purple-500 to-purple-600")}`}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full justify-between",children:[e.jsx("div",{className:`w-6 h-6 sm:w-7 sm:h-7 rounded-lg flex items-center justify-center ${u.color==="success"?"bg-emerald-50":u.color==="danger"?"bg-red-50":(u.color==="accent","bg-purple-50")}`,children:e.jsx(u.icon,{className:`w-3 h-3 sm:w-4 sm:h-4 ${u.color==="success"?"text-emerald-600":u.color==="danger"?"text-red-600":(u.color==="accent","text-purple-600")}`})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-base sm:text-lg font-bold mb-0.5 ${u.color==="success"?"text-emerald-600":u.color==="danger"?"text-red-600":(u.color==="accent","text-purple-600")}`,children:u.value}),e.jsx("p",{className:"text-[10px] sm:text-[11px] font-semibold text-slate-600 uppercase tracking-wide leading-tight truncate",children:u.label})]})]})]})},ee))}),e.jsx("div",{className:"card p-0 overflow-hidden",children:k?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):Qe.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Rs,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Qarzlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:K||je!=="all"?"Filtr bo'yicha qarzlar topilmadi":"Hozircha qarzlar yo'q"})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-3 sm:gap-4 md:gap-5 p-3 sm:p-4 md:p-5",children:Qe.map(u=>{const ee=u.status==="paid",Ie=u.status==="overdue",qe=u.status==="approved",ne=u.status==="blacklist",Ze=u.amount-u.paidAmount,X=Math.round(u.paidAmount/u.amount*100),ve=new Date(u.dueDate),M=new Date;M.setHours(0,0,0,0);const Te=Math.ceil((ve.getTime()-M.getTime())/(1e3*60*60*24)),Re=!ee&&(Ie||Te<=0),Ue=!ee&&!Re&&Te<=3,Ye=!ee&&!Re&&!Ue&&Te<=7,Ss=Re?"border-red-400 ring-2 ring-red-200":Ue?"border-orange-400 ring-2 ring-orange-200":Ye?"border-amber-400 ring-1 ring-amber-200":ne?"border-slate-700 ring-2 ring-slate-400":"border-surface-200 hover:border-brand-300";return e.jsxs("div",{className:`bg-white rounded-xl sm:rounded-2xl border ${Ss} hover:shadow-xl transition-all duration-300 overflow-hidden group ${Re?"animate-pulse-slow":""}`,children:[e.jsxs("div",{className:`relative p-3 sm:p-4 ${ne?"bg-gradient-to-br from-slate-800 to-slate-900":Re?"bg-gradient-to-br from-red-100 to-rose-100":Ue?"bg-gradient-to-br from-orange-50 to-amber-50":Ye?"bg-gradient-to-br from-amber-50 to-yellow-50":f==="receivable"?"bg-gradient-to-br from-emerald-50 to-green-50":"bg-gradient-to-br from-red-50 to-rose-50"}`,children:[!ee&&Te<=7&&e.jsx("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-lg text-[10px] font-bold ${Re?"bg-red-500 text-white animate-pulse":Ue?"bg-orange-500 text-white":"bg-amber-500 text-white"}`,children:Ie||Te<0?`${Math.abs(Te)} kun o'tdi!`:Te===0?"Bugun!":`${Te} kun qoldi`}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center shadow-lg ${ne?"bg-gradient-to-br from-slate-900 to-black":Re?"bg-gradient-to-br from-red-500 to-rose-600":Ue?"bg-gradient-to-br from-orange-400 to-amber-500":Ye?"bg-gradient-to-br from-amber-400 to-yellow-500":f==="receivable"?"bg-gradient-to-br from-emerald-400 to-green-500":"bg-gradient-to-br from-red-400 to-rose-500"}`,children:e.jsx(ms,{className:`w-6 h-6 ${ne?"text-amber-300":"text-white"}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-bold text-surface-900 truncate text-sm sm:text-base",children:Oe(u)}),ts(u)&&e.jsxs("p",{className:"text-xs sm:text-sm text-surface-500 flex items-center gap-1",children:[e.jsx(Fs,{className:"w-3 h-3"}),ts(u)]})]})]}),e.jsxs("div",{className:`px-3 py-1.5 rounded-xl text-[10px] sm:text-xs font-semibold flex items-center gap-1.5 ${ne?"bg-gradient-to-r from-slate-900 to-black text-amber-300 shadow-lg shadow-slate-500":qe?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg shadow-green-200":"bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow-lg shadow-blue-200"}`,children:[ne?e.jsx(Rs,{className:"w-3 h-3"}):qe?e.jsx(ut,{className:"w-3 h-3"}):e.jsx(Hs,{className:"w-3 h-3"}),e.jsx("span",{children:ne?"Qora ro'yxat":ee?"To'langan":Ie?"Muddati o'tgan":qe?"Aktiv":"Jarayonda"})]})]}),!ee&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-[10px] sm:text-xs text-surface-600 mb-1",children:[e.jsxs("span",{children:["To'langan: ",X,"%"]}),e.jsxs("span",{children:[p(u.paidAmount)," / ",p(u.amount)]})]}),e.jsx("div",{className:`h-2 rounded-full overflow-hidden ${Re?"bg-red-200":Ue?"bg-orange-200":Ye?"bg-amber-200":"bg-white/60"}`,children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${Re?"bg-red-500":Ue?"bg-orange-500":Ye?"bg-amber-500":f==="receivable"?"bg-emerald-500":"bg-red-500"}`,style:{width:`${X}%`}})})]})]}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[e.jsxs("div",{className:"bg-surface-50 rounded-xl p-1.5 sm:p-3 border border-surface-100",children:[e.jsx("p",{className:"text-[9px] sm:text-xs text-surface-500 uppercase tracking-wide font-semibold mb-0.5 sm:mb-1",children:"Jami qarz"}),e.jsx("p",{className:"font-bold text-surface-900 text-xs sm:text-base",children:p(u.amount)}),e.jsx("p",{className:"text-[9px] text-surface-400",children:"so'm"})]}),e.jsxs("div",{className:`rounded-xl p-1.5 sm:p-3 border ${f==="receivable"?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"}`,children:[e.jsx("p",{className:"text-[9px] sm:text-xs text-surface-500 uppercase tracking-wide font-semibold mb-0.5 sm:mb-1",children:"Qoldiq"}),e.jsx("p",{className:`font-bold text-xs sm:text-base ${f==="receivable"?"text-emerald-600":"text-red-600"}`,children:p(Ze)}),e.jsx("p",{className:"text-[9px] text-surface-400",children:"so'm"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3 text-[10px] sm:text-sm",children:[e.jsxs("div",{className:"flex flex-col gap-0.5 sm:gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 text-surface-600",children:[e.jsx(Hs,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),e.jsx("span",{children:new Date(u.dueDate).toLocaleDateString("uz-UZ")})]}),u.extensionDays>0&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-blue-50 rounded-md text-blue-700 text-[9px] sm:text-[10px] font-medium border border-blue-200",children:["ðŸ“… ",u.extensionDays," kun muddat"]})]}),f==="receivable"&&u.collateral&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-amber-50 rounded-lg text-amber-700 text-[9px] sm:text-[10px] font-medium border border-amber-200 max-w-[100px] truncate",children:["ðŸ”’ ",u.collateral]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-1.5 sm:gap-2 pt-2 sm:pt-3 border-t border-surface-100 flex-wrap",children:[o&&e.jsxs("button",{onClick:()=>Q(this,null,function*(){try{yield U.delete(`/debts/${u._id}`),O(),D()}catch(I){console.error("Error deleting debt:",I)}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-red-100 text-red-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-red-200 transition-all whitespace-nowrap",title:"Qarzni o'chirish",children:[e.jsx(_s,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"O'chirish"})]}),o&&!ee&&e.jsx(e.Fragment,{children:u.extensionCount===void 0||u.extensionCount<3?e.jsxs("button",{onClick:()=>Q(this,null,function*(){var me,ze;const I=prompt("Necha kun muddat berilsin?");if(!I)return;const he=parseInt(I,10);if(!(Number.isNaN(he)||he<=0))try{yield U.post(`/debts/${u._id}/extend`,{days:he}),O(),D()}catch(t){console.error("Error extending debt:",t),x(((ze=(me=t.response)==null?void 0:me.data)==null?void 0:ze.message)||"Muddat berishda xatolik","Xatolik","danger")}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-amber-100 text-amber-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-amber-200 transition-all whitespace-nowrap",children:[e.jsx(Hs,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{children:"Muddat"})]}):null}),!ee&&e.jsxs("button",{onClick:()=>{y(u),C(!0)},className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-emerald-100 text-emerald-700 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-emerald-200 transition-all whitespace-nowrap",children:[e.jsx(ds,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{children:"To'lov"})]}),o&&ne&&e.jsxs("button",{onClick:()=>Q(this,null,function*(){var he,me;if(yield n("Ushbu mijozni qora ro'yxatdan chiqarasizmi?","Qora ro'yxatdan chiqarish"))try{yield U.post(`/debts/${u._id}/remove-blacklist`),O(),D(),x("Mijoz qora ro'yxatdan chiqarildi","Muvaffaqiyat","success")}catch(ze){console.error("Error removing from blacklist:",ze),x(((me=(he=ze.response)==null?void 0:he.data)==null?void 0:me.message)||"Qora ro'yxatdan chiqarishda xatolik","Xatolik","danger")}}),className:"flex items-center justify-center gap-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-slate-800 text-amber-300 rounded-lg text-[10px] sm:text-xs md:text-sm font-semibold hover:bg-slate-900 transition-all whitespace-nowrap",children:[e.jsx(Rs,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Qora ro'yxatdan chiqarish"}),e.jsx("span",{className:"sm:hidden",children:"Chiqarish"})]})]})]})]},u._id)})})})})]}),S&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:oe}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 truncate",children:be?"Qarzni tahrirlash":"Yangi qarz"}),e.jsx("button",{onClick:oe,className:"flex-shrink-0 btn-icon-sm",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[o&&e.jsxs("div",{className:"flex p-1 bg-surface-100 rounded-xl mb-6",children:[e.jsxs("button",{type:"button",onClick:()=>R("receivable"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg transition-all ${f==="receivable"?"bg-white text-success-600 shadow-sm":"text-surface-500"}`,children:[e.jsx(ba,{className:"w-4 h-4"}),"Menga qarzdor"]}),e.jsxs("button",{type:"button",onClick:()=>R("payable"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg transition-all ${f==="payable"?"bg-white text-danger-600 shadow-sm":"text-surface-500"}`,children:[e.jsx(Gt,{className:"w-4 h-4"}),"Men qarzdorman"]})]}),e.jsxs("form",{onSubmit:we,className:"space-y-4",children:[e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Rs,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-amber-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"Diqqat!"}),e.jsx("p",{children:"Qo'shilgan qarz darhol mijozning umumiy qarziga qo'shiladi. Shuning uchun ma'lumotlarni diqqat bilan kiriting."})]})]})}),f==="receivable"?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Mijoz"}),V?e.jsxs("div",{className:"space-y-3 p-3 bg-surface-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-brand-600",children:"Yangi mijoz"}),e.jsx("button",{type:"button",onClick:()=>Ne(!1),className:"text-surface-400 hover:text-surface-600",children:e.jsx(ge,{className:"w-4 h-4"})})]}),e.jsx("input",{type:"text",className:"input",placeholder:"Mijoz ismi",value:E.name,onChange:u=>ce(N(b({},E),{name:u.target.value}))}),e.jsxs("div",{className:"relative",children:[e.jsx(Fs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-12",placeholder:"+998 (XX) XXX-XX-XX",value:E.phone,onChange:u=>ce(N(b({},E),{phone:ht(u.target.value)}))})]}),e.jsxs("select",{className:"select text-sm",value:E.region,onChange:u=>ce(N(b({},E),{region:u.target.value,district:""})),children:[e.jsx("option",{value:"",children:"Viloyatni tanlang"}),ta.map(u=>e.jsx("option",{value:u,children:u},u))]}),E.region&&e.jsxs("select",{className:"select text-sm",value:E.district,onChange:u=>ce(N(b({},E),{district:u.target.value})),children:[e.jsx("option",{value:"",children:"Tumanni tanlang"}),(He=Kt[E.region])==null?void 0:He.map(u=>e.jsx("option",{value:u,children:u},u))]}),e.jsxs("button",{type:"button",onClick:Ce,disabled:!E.name||!E.phone,className:"btn-primary w-full",children:[e.jsx(ra,{className:"w-4 h-4"}),"Mijozni yaratish"]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"select flex-1",value:W.customer,onChange:u=>J(N(b({},W),{customer:u.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Tanlang"}),h.map(u=>e.jsxs("option",{value:u._id,children:[u.name," - ",u.phone]},u._id))]}),e.jsx("button",{type:"button",onClick:()=>Ne(!0),className:"btn-icon bg-brand-100 text-brand-600 hover:bg-brand-200",title:"Yangi mijoz qo'shish",children:e.jsx(ys,{className:"w-5 h-5"})})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Kimga qarzdorman"}),e.jsx("input",{type:"text",className:"input",placeholder:"Ism yoki kompaniya nomi",value:W.creditorName,onChange:u=>J(N(b({},W),{creditorName:u.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Summa (so'm)"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:us(W.amount),onChange:u=>J(N(b({},W),{amount:Ge(u.target.value)})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Muddat"}),e.jsx("input",{type:"date",className:"input",value:W.dueDate,onChange:u=>J(N(b({},W),{dueDate:u.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Izoh (ixtiyoriy)"}),e.jsx("input",{type:"text",className:"input",placeholder:"Qarz haqida izoh",value:W.description,onChange:u=>J(N(b({},W),{description:u.target.value}))})]}),f==="receivable"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Zalog (ixtiyoriy)"}),e.jsx("input",{type:"text",className:"input",placeholder:"Zalogga nima qoldirdi",value:W.collateral,onChange:u=>J(N(b({},W),{collateral:u.target.value}))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:oe,className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Saqlash"})]})]})]})})]})]}),$&&m&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"overlay -z-10",onClick:()=>C(!1)}),e.jsxs("div",{className:"modal w-full sm:w-auto max-w-md relative z-10 flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-surface-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900",children:"To'lov qilish"}),e.jsx("button",{onClick:()=>C(!1),className:"flex-shrink-0 btn-icon-sm",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${f==="receivable"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Qoldiq summa"}),e.jsxs("p",{className:`text-2xl font-bold ${f==="receivable"?"text-success-600":"text-danger-600"}`,children:[p(m.amount-m.paidAmount)," so'm"]})]}),e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"To'lov summasi"}),e.jsx("input",{type:"text",className:"input",placeholder:"0",value:us(ue),onChange:u=>de(Ge(u.target.value)),required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>C(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-success flex-1",children:"To'lash"})]})]})]})})]})]})]})}function ln(){const{showAlert:a,showConfirm:o,AlertComponent:n}=Ps(),x=Ks(),[i,g]=s.useState([]),[v,h]=s.useState(!0),[q,P]=s.useState(null),[w,S]=s.useState(null);s.useEffect(()=>{L()},[]);const L=()=>Q(this,null,function*(){try{const m=yield U.get("/debts?status=pending_approval");g(m.data)}catch(m){console.error("Error fetching pending debts:",m)}finally{h(!1)}}),$=m=>Q(this,null,function*(){var y,k;P(m);try{yield U.post(`/debts/${m}/approve`),g(i.filter(j=>j._id!==m)),a("Qarz muvaffaqiyatli tasdiqlandi","Muvaffaqiyat","success")}catch(j){P(null),console.error("Error approving debt:",j),a(((k=(y=j.response)==null?void 0:y.data)==null?void 0:k.message)||"Xatolik yuz berdi","Xatolik","danger")}}),C=m=>Q(this,null,function*(){var k,j;if(yield o("Bu qarzni rad etasizmi?","Rad etish")){S(m);try{yield U.post(`/debts/${m}/reject`),g(i.filter(f=>f._id!==m)),a("Qarz rad etildi","Muvaffaqiyat","success")}catch(f){S(null),console.error("Error rejecting debt:",f),a(((j=(k=f.response)==null?void 0:k.data)==null?void 0:j.message)||"Xatolik yuz berdi","Xatolik","danger")}}});return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[n,e.jsx(Ws,{title:"Qarz tasdiqlash",actions:e.jsxs("button",{onClick:()=>x("/admin/debts"),className:"btn-secondary",children:[e.jsx(qa,{className:"w-4 h-4"}),"Orqaga"]})}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-4xl mx-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-6 border border-amber-200",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 rounded-xl flex items-center justify-center",children:e.jsx(Rs,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-amber-900",children:"Tasdiqlashni kutayotgan qarzlar"}),e.jsxs("p",{className:"text-sm text-amber-700",children:[i.length," ta qarz kassachi tomonidan qo'shilgan va sizning tasdiqlashingizni kutmoqda"]})]})]})}),v?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(ut,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Barcha qarzlar ko'rib chiqildi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:"Hozirda tasdiqlashni kutayotgan qarzlar yo'q. Yangi qarzlar qo'shilganda bu yerda ko'rinadi."})]}):e.jsx("div",{className:"space-y-4",children:i.map(m=>{var y,k;return e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-amber-200 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center",children:e.jsx(ms,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-lg",children:(y=m.customer)==null?void 0:y.name}),e.jsx("p",{className:"text-surface-500",children:(k=m.customer)==null?void 0:k.phone}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-surface-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Hs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Muddat: ",new Date(m.dueDate).toLocaleDateString("uz-UZ")]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ds,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium text-lg",children:[p(m.amount)," so'm"]})]})]})]})]}),e.jsxs("span",{className:"badge badge-amber",children:[e.jsx(Rs,{className:"w-3 h-3"}),"Kutilmoqda"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[m.description&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("h5",{className:"font-medium text-surface-700 mb-2",children:"Izoh"}),e.jsx("p",{className:"text-surface-600 text-sm",children:m.description})]}),m.collateral&&e.jsxs("div",{className:"bg-amber-50 rounded-xl p-4",children:[e.jsx("h5",{className:"font-medium text-amber-700 mb-2",children:"Zalog"}),e.jsx("p",{className:"text-amber-600 text-sm",children:m.collateral})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>C(m._id),disabled:w===m._id||q===m._id,className:"btn-secondary flex-1 text-red-600 hover:bg-red-50 hover:border-red-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:w===m._id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Rad etilmoqda..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4"}),"Rad etish"]})}),e.jsx("button",{onClick:()=>$(m._id),disabled:q===m._id||w===m._id,className:"btn-primary flex-1 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:q===m._id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Tasdiqlanamoqda..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ut,{className:"w-4 h-4"}),"Tasdiqlash"]})})]})]},m._id)})})]})]})}function on(){const[a,o]=s.useState([]),[n,x]=s.useState("all"),[i,g]=s.useState(!0);s.useEffect(()=>{v()},[]);const v=()=>Q(this,null,function*(){try{const S=yield U.get("/orders");o(S.data)}catch(S){console.error("Error fetching orders:",S)}finally{g(!1)}}),h=(S,L)=>Q(this,null,function*(){try{yield U.put(`/orders/${S}/status`,{status:L}),v()}catch($){console.error("Error updating order:",$)}}),q={new:{color:"brand",label:"Yangi",icon:xt},processing:{color:"warning",label:"Jarayonda",icon:Ke},shipped:{color:"accent",label:"Yo'lda",icon:lr},delivered:{color:"success",label:"Yetkazildi",icon:ut},cancelled:{color:"danger",label:"Bekor qilindi",icon:nr}},P=[{value:"all",label:"Barchasi"},...Object.entries(q).map(([S,L])=>({value:S,label:L.label}))],w=a.filter(S=>n==="all"||S.status===n);return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[e.jsx(Ws,{title:"Buyurtmalar",filterOptions:P,filterValue:n,onFilterChange:x}),e.jsx("div",{className:"p-4 lg:p-6",children:e.jsx("div",{className:"card p-0 overflow-hidden",children:i?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):w.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Et,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Buyurtmalar topilmadi"}),e.jsx("p",{className:"text-surface-500",children:"Hozircha buyurtmalar yo'q"})]}):e.jsx("div",{className:"divide-y divide-surface-100",children:w.map(S=>{var $;const L=q[S.status];return e.jsx("div",{className:"p-4 lg:p-6 hover:bg-surface-50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(Ke,{className:"w-6 h-6 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-surface-900",children:["Buyurtma #",S._id.slice(-6)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500 mt-1",children:[e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{children:(($=S.customer)==null?void 0:$.name)||"Noma'lum mijoz"})]})]}),e.jsx("select",{value:S.status,onChange:C=>h(S._id,C.target.value),className:`select text-sm py-2 px-3 bg-${L.color}-50 text-${L.color}-700 border-${L.color}-200`,children:Object.entries(q).map(([C,m])=>e.jsx("option",{value:C,children:m.label},C))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-surface-500",children:[e.jsxs("span",{children:[S.items.length," ta mahsulot"]}),e.jsx("span",{children:new Date(S.createdAt).toLocaleDateString("uz-UZ")})]}),e.jsxs("p",{className:"font-bold text-surface-900",children:[S.total.toLocaleString()," so'm"]})]})]})]})},S._id)})})})})]})}function cn(){const{showConfirm:a,showAlert:o,AlertComponent:n}=Ps(),[x,i]=s.useState([]),[g,v]=s.useState([]),[h,q]=s.useState(null),[P,w]=s.useState([]),[S,L]=s.useState(!1),[$,C]=s.useState(!1),[m,y]=s.useState(!1),[k,j]=s.useState(null),[f,R]=s.useState(null),[W,J]=s.useState(!0),[ue,de]=s.useState(!1),[K,Se]=s.useState(!1),[je,Me]=s.useState(null),[V,Ne]=s.useState({name:"",phone:"",password:"",role:"helper",bonusPercentage:0}),[E,ce]=s.useState({name:"",login:"",phone:"",password:"",confirmPassword:"",role:"helper",bonusPercentage:0}),[be,Le]=s.useState(!1);s.useEffect(()=>{_(),D(),O()},[]);const O=()=>Q(this,null,function*(){try{const u=yield U.get("/auth/admin/kassa-users");if(u.data.success&&u.data.users.length>0){const ee=u.data.users[0];q({login:ee.login,name:ee.name})}}catch(u){console.error("Error fetching kassa user:",u)}}),_=()=>Q(this,null,function*(){try{const u=yield U.get("/auth/admin/helpers");i(u.data.users||u.data)}catch(u){console.error("Error fetching helpers:",u)}finally{J(!1)}}),D=()=>Q(this,null,function*(){try{const u=yield U.get("/receipts/helpers-stats");v(u.data)}catch(u){console.error("Error fetching helpers stats:",u)}}),we=u=>Q(this,null,function*(){de(!0);try{const ee=yield U.get(`/receipts/helper/${u}/receipts`);w(ee.data.receipts)}catch(ee){console.error("Error fetching helper receipts:",ee)}finally{de(!1)}}),Z=u=>{j(u),y(!0),we(u._id)},oe=u=>{const ee=ht(u.target.value);Ne(N(b({},V),{phone:ee}))},Ce=u=>Q(this,null,function*(){var ee,Ie;u.preventDefault(),Se(!0);try{const qe=b(b({name:V.name,phone:Dt(V.phone),role:V.role},V.password&&{password:V.password}),V.role==="cashier"&&{bonusPercentage:V.bonusPercentage});if(f)yield U.put(`/auth/admin/helpers/${f._id}`,qe),v(g.map(ne=>ne._id===f._id?N(b({},ne),{name:V.name,role:V.role,bonusPercentage:V.bonusPercentage}):ne)),i(x.map(ne=>ne._id===f._id?N(b({},ne),{name:V.name,role:V.role,phone:Dt(V.phone)}):ne));else{yield U.post("/users",N(b({},qe),{password:V.password}));const ne={_id:Math.random().toString(),name:V.name,role:V.role,receiptCount:0,totalAmount:0,bonusPercentage:V.bonusPercentage||0,totalEarnings:0,totalBonus:0};v([...g,ne])}setTimeout(()=>{Oe(),Se(!1)},2e3)}catch(qe){Se(!1),alert(((Ie=(ee=qe.response)==null?void 0:ee.data)==null?void 0:Ie.message)||"Xatolik yuz berdi")}}),Qe=u=>Q(this,null,function*(){var Ie,qe;if(yield a(`"${u.name}" yordamchisini o'chirishni tasdiqlaysizmi?`,"Yordamchini o'chirish")){Me(u._id);try{yield U.delete(`/auth/admin/helpers/${u._id}`),v(g.filter(ne=>ne._id!==u._id)),i(x.filter(ne=>ne._id!==u._id)),o("Yordamchi muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),setTimeout(()=>{Me(null)},2e3)}catch(ne){Me(null),console.error("Error deleting helper:",ne),o(`Yordamchini o'chirishda xatolik: ${((qe=(Ie=ne.response)==null?void 0:Ie.data)==null?void 0:qe.message)||ne.message}`,"Xatolik","danger")}}}),_e=u=>{R(u),Ne({name:u.name,phone:Qa(u.phone),password:"",role:u.role,bonusPercentage:u.bonusPercentage||0}),L(!0)},Oe=()=>{L(!1),R(null),Ne({name:"",phone:"",password:"",role:"helper",bonusPercentage:0})},ts=()=>{C(!1),ce({name:"",login:"",phone:"",password:"",confirmPassword:"",role:"helper",bonusPercentage:0})},He=u=>Q(this,null,function*(){var ee,Ie;if(u.preventDefault(),E.password!==E.confirmPassword){o("Parollar mos kelmadi","Xatolik","danger");return}if(E.password.length<6){o("Parol kamida 6 ta belgidan iborat bo'lishi kerak","Xatolik","danger");return}Le(!0);try{const qe={name:E.name,login:E.login,phone:Dt(E.phone),password:E.password};console.log("ðŸ“¤ Xodim yaratish so'rovi:",qe);const ne=yield U.post("/auth/admin/helpers",qe);console.log("âœ… Server javobi:",ne.data);const Ze={_id:ne.data.user._id,name:ne.data.user.name,login:ne.data.user.login,phone:ne.data.user.phone,role:ne.data.user.role,receiptCount:0,totalAmount:0,totalEarnings:0,totalBonus:0};v([...g,Ze]),o("Xodim muvaffaqiyatli qo'shildi","Muvaffaqiyat","success"),setTimeout(()=>{ts(),Le(!1)},2e3)}catch(qe){Le(!1),o(((Ie=(ee=qe.response)==null?void 0:ee.data)==null?void 0:Ie.message)||"Xatolik yuz berdi","Xatolik","danger")}});return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[n,e.jsx(Ws,{title:"Yordamchilar",actions:e.jsxs("button",{onClick:()=>C(!0),className:"btn-primary",children:[e.jsx(ys,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yordamchi qo'shish"})]})}),e.jsx("div",{className:"p-4 lg:p-6",children:W?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):x.length===0?e.jsxs("div",{className:"card flex flex-col items-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(ra,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Yordamchilar yo'q"}),e.jsx("p",{className:"text-surface-500 mb-6",children:"Birinchi yordamchini qo'shing"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-6 shadow-lg border-2 border-purple-400",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(qt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white text-lg",children:"Kassa Paneli Kodi"}),e.jsx("p",{className:"text-purple-100 text-sm",children:"Admin tomonidan belgilangan login va parol"})]})]}),e.jsx("div",{className:"bg-white/20 backdrop-blur-sm px-3 py-1 rounded-lg",children:e.jsx("span",{className:"text-white text-xs font-semibold",children:"Maxsus"})})]}),h?e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Ism:"}),e.jsx("span",{className:"text-white font-bold",children:h.name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Login:"}),e.jsx("span",{className:"text-white font-bold",children:h.login})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Parol:"}),e.jsx("span",{className:"text-white font-bold",children:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-white/20",children:[e.jsx("span",{className:"text-purple-100 text-sm font-medium",children:"Rol:"}),e.jsx("span",{className:"bg-white/20 text-white px-3 py-1 rounded-lg text-xs font-semibold",children:"Kassir"})]})]}):e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-white text-sm",children:"Kassa foydalanuvchisi topilmadi"}),e.jsx("p",{className:"text-purple-100 text-xs mt-2",children:"Admin sozlamalarida kassa yarating"})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-purple-100 text-xs",children:[e.jsx(Qs,{className:"w-4 h-4"}),e.jsx("span",{children:"Bu karta o'chirib bo'lmaydi. Faqat Admin Sozlamalari â†’ Kassa Foydalanuvchilari bo'limida o'zgartirish mumkin."})]})]}),e.jsx("h2",{className:"text-lg font-semibold text-surface-900 mb-4",children:"Kassirlar statistikasi"}),g.length===0?e.jsx("p",{className:"text-surface-500 text-center py-8",children:"Hali cheklar chiqarilmagan"}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 max-w-4xl",children:g.map(u=>e.jsxs("div",{className:"group bg-white rounded-xl p-3 shadow-sm border border-surface-200 hover:shadow-lg hover:border-brand-300 transition-all duration-300 hover:-translate-y-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center text-white font-bold text-base flex-shrink-0",children:u.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm text-surface-900 truncate",title:u.name,children:u.name}),e.jsx("span",{className:`inline-block text-[10px] px-1.5 py-0.5 rounded-full font-semibold mt-0.5 ${u.role==="cashier"?"bg-success-100 text-success-700":"bg-brand-100 text-brand-700"}`,children:u.role==="cashier"?"Kassir":"Yordamchi"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 pt-4 border-t border-surface-100 flex-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-bold text-brand-600",children:u.receiptCount}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Cheklar"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-success-600",children:p(u.totalAmount)}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Savdo"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xl font-bold text-orange-600",children:[u.bonusPercentage,"%"]}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Bonus"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6 pt-4 border-t border-surface-100",children:[e.jsx("button",{onClick:ee=>{ee.stopPropagation();const Ie=x.find(qe=>qe.name===u.name);Ie&&_e(Ie)},className:"p-2.5 hover:bg-brand-100 hover:text-brand-600 text-surface-400 rounded-lg transition-all hover:shadow-md hover:-translate-y-0.5",title:"Tahrirlash",children:e.jsx(rt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:ee=>{ee.stopPropagation(),Z(u)},className:"p-2.5 hover:bg-blue-100 hover:text-blue-600 text-surface-400 rounded-lg transition-all hover:shadow-md hover:-translate-y-0.5",title:"Cheklar",children:e.jsx(Gs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:ee=>{ee.stopPropagation(),Qe(u)},disabled:je===u._id,className:"p-2.5 hover:bg-danger-100 hover:text-danger-600 text-surface-400 rounded-lg transition-all hover:shadow-md hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed",title:"O'chirish",children:je===u._id?e.jsx("div",{className:"w-4 h-4 border-2 border-danger-600 border-t-transparent rounded-full animate-spin"}):e.jsx(_s,{className:"w-4 h-4"})})]})]},u._id))})]})}),$&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-3 md:p-4 bg-black/50",children:[e.jsx("div",{className:"overlay",onClick:ts}),e.jsxs("div",{className:"modal w-full max-w-[95%] xs:max-w-sm sm:max-w-md p-3 sm:p-4 md:p-5 relative z-50 max-h-[85vh] overflow-y-auto bg-white rounded-xl sm:rounded-2xl shadow-2xl my-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3 pb-2 sm:pb-3 border-b border-surface-200",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-surface-900",children:"Yordamchi qo'shish"}),e.jsx("button",{onClick:ts,className:"btn-icon-sm",children:e.jsx(ge,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("form",{onSubmit:He,className:"space-y-2 sm:space-y-3 flex flex-col h-full",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Ism"}),e.jsxs("div",{className:"relative",children:[e.jsx(ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Yordamchi ismi",value:E.name,onChange:u=>ce(N(b({},E),{name:u.target.value})),disabled:be,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Login"}),e.jsxs("div",{className:"relative",children:[e.jsx(ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Login (foydalanuvchi nomi)",value:E.login,onChange:u=>ce(N(b({},E),{login:u.target.value})),disabled:be,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Telefon raqam"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"tel",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"+998 (XX) XXX-XX-XX",value:E.phone,onChange:u=>ce(N(b({},E),{phone:ht(u.target.value)})),disabled:be,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Parol"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"password",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Kamida 6 ta belgi",value:E.password,onChange:u=>ce(N(b({},E),{password:u.target.value})),disabled:be,required:!0,minLength:6})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Parolni tasdiqlash"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"password",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Parolni qayta kiriting",value:E.confirmPassword,onChange:u=>ce(N(b({},E),{confirmPassword:u.target.value})),disabled:be,required:!0,minLength:6})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-2 block",children:"Rol"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>ce(N(b({},E),{role:"cashier"})),disabled:be,className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed ${E.role==="cashier"?"border-success-500 bg-success-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(hs,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${E.role==="cashier"?"text-success-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Kassir"})]}),e.jsxs("button",{type:"button",onClick:()=>ce(N(b({},E),{role:"helper"})),disabled:be,className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed ${E.role==="helper"?"border-brand-500 bg-brand-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(qt,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${E.role==="helper"?"text-brand-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Yordamchi"})]})]})]}),E.role==="cashier"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Bonus foizi (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ds,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"number",className:"input pl-9 text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Masalan: 1",value:E.bonusPercentage,min:"0",max:"100",step:"0.1",disabled:be,onChange:u=>ce(N(b({},E),{bonusPercentage:parseFloat(u.target.value)||0}))})]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-surface-500 mt-0.5 sm:mt-1",children:[E.bonusPercentage,"% bonus"]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 mt-auto border-t border-surface-100",children:[e.jsx("button",{type:"button",onClick:ts,disabled:be,className:"btn-secondary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Bekor"}),e.jsx("button",{type:"submit",disabled:be,className:"btn-primary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:be?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Qo'shilmoqda..."})]}):"Qo'shish"})]})]})]})]}),S&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-3 md:p-4 bg-black/50",children:[e.jsx("div",{className:"overlay",onClick:Oe}),e.jsxs("div",{className:"modal w-full max-w-[95%] xs:max-w-sm sm:max-w-md p-3 sm:p-4 md:p-5 relative z-50 max-h-[85vh] overflow-y-auto bg-white rounded-xl sm:rounded-2xl shadow-2xl my-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3 pb-2 sm:pb-3 border-b border-surface-200",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-surface-900",children:f?"Tahrirlash":"Yangi yordamchi"}),e.jsx("button",{onClick:Oe,className:"btn-icon-sm",children:e.jsx(ge,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("form",{onSubmit:Ce,className:"space-y-2 sm:space-y-3 flex flex-col h-full",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Ism"}),e.jsxs("div",{className:"relative",children:[e.jsx(ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"text",className:"input pl-9 text-sm",placeholder:"Yordamchi ismi",value:V.name,onChange:u=>Ne(N(b({},V),{name:u.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Telefon raqam"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"tel",className:"input pl-9 text-sm",placeholder:"+998 (XX) XXX-XX-XX",value:V.phone,onChange:oe,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:f?"Yangi parol (ixtiyoriy)":"Parol"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",b({type:"password",className:"input pl-9 text-sm",placeholder:f?"O'zgartirmaslik uchun bo'sh qoldiring":"Parol",value:V.password,onChange:u=>Ne(N(b({},V),{password:u.target.value}))},!f&&{required:!0,minLength:6}))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-2 block",children:"Rol"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>Ne(N(b({},V),{role:"cashier"})),className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm ${V.role==="cashier"?"border-success-500 bg-success-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(hs,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${V.role==="cashier"?"text-success-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Kassir"})]}),e.jsxs("button",{type:"button",onClick:()=>Ne(N(b({},V),{role:"helper"})),className:`p-2 sm:p-3 rounded-lg border-2 transition-all text-xs sm:text-sm ${V.role==="helper"?"border-brand-500 bg-brand-50":"border-surface-200 hover:border-surface-300"}`,children:[e.jsx(qt,{className:`w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 ${V.role==="helper"?"text-brand-600":"text-surface-400"}`}),e.jsx("p",{className:"font-medium text-surface-900",children:"Yordamchi"})]})]})]}),V.role==="cashier"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1 sm:mb-2 block",children:"Bonus foizi (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ds,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-surface-400"}),e.jsx("input",{type:"number",className:"input pl-9 text-sm",placeholder:"Masalan: 1",value:V.bonusPercentage,min:"0",max:"100",step:"0.1",onChange:u=>Ne(N(b({},V),{bonusPercentage:parseFloat(u.target.value)||0}))})]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-surface-500 mt-0.5 sm:mt-1",children:[V.bonusPercentage,"% bonus"]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 mt-auto border-t border-surface-100",children:[e.jsx("button",{type:"button",onClick:Oe,disabled:K,className:"btn-secondary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Bekor"}),e.jsx("button",{type:"submit",disabled:K,className:"btn-primary flex-1 text-xs sm:text-sm py-1.5 sm:py-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:K?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Saqlanmoqda..."})]}):"Saqlash"})]})]})]})]}),m&&k&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-2 sm:p-3 md:p-4 bg-black/50",children:["`n          ",e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>y(!1)}),e.jsxs("div",{className:"modal w-full max-w-[98%] sm:max-w-[95%] md:max-w-4xl max-h-[90vh] overflow-hidden relative z-50 bg-white rounded-2xl shadow-2xl",children:[e.jsxs("div",{className:"p-6 border-b border-surface-100 bg-gradient-to-r from-brand-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center text-white font-bold text-lg",children:k.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-surface-900",children:k.name}),e.jsx("span",{className:`text-sm px-3 py-1 rounded-full font-medium ${k.role==="cashier"?"bg-success-100 text-success-700":"bg-brand-100 text-brand-700"}`,children:k.role==="cashier"?"Kassir":"Yordamchi"})]})]}),e.jsx("button",{onClick:()=>y(!1),className:"btn-icon-sm hover:bg-white/50",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(Xs,{className:"w-5 h-5 text-brand-600"})}),e.jsx("p",{className:"text-2xl font-bold text-surface-900",children:k.receiptCount}),e.jsx("p",{className:"text-xs text-surface-500",children:"Cheklar"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(ds,{className:"w-5 h-5 text-success-600"})}),e.jsx("p",{className:"text-lg font-bold text-success-600",children:p(k.totalAmount)}),e.jsx("p",{className:"text-xs text-surface-500",children:"Savdo"})]}),k.bonusPercentage>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx("span",{className:"text-orange-500 font-bold",children:"%"})}),e.jsxs("p",{className:"text-lg font-bold text-orange-600",children:[k.bonusPercentage,"%"]}),e.jsx("p",{className:"text-xs text-surface-500",children:"Bonus foizi"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(ds,{className:"w-5 h-5 text-green-600"})}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:p(k.totalAmount*k.bonusPercentage/100)}),e.jsx("p",{className:"text-xs text-surface-500",children:"Jami bonus"})]})]})]})]}),e.jsx("div",{className:"p-6 overflow-auto max-h-[calc(90vh-120px)]",children:ue?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"spinner text-brand-600 w-8 h-8"})}):P.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(Xs,{className:"w-12 h-12 mx-auto mb-4 text-surface-400"}),e.jsx("p",{className:"text-surface-500",children:"Cheklar topilmadi"})]}):e.jsx("div",{className:"space-y-3",children:P.map(u=>e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-surface-100 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(Xs,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-surface-900",children:["Chek #",u._id.slice(-6)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500",children:[e.jsx(Hs,{className:"w-4 h-4"}),new Date(u.createdAt).toLocaleString("uz-UZ")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-brand-600",children:p(u.total)}),e.jsx("p",{className:"text-sm text-surface-500",children:"so'm"})]})]}),e.jsxs("div",{className:"border-t border-surface-100 pt-4",children:[e.jsx("h5",{className:"text-sm font-medium text-surface-700 mb-3",children:"Mahsulotlar:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:u.items.map((ee,Ie)=>e.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-surface-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-surface-700 font-medium",children:ee.name}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-sm text-surface-600",children:[ee.quantity," Ã— ",p(ee.price)]}),e.jsxs("p",{className:"text-sm font-semibold text-surface-900",children:[p(ee.price*ee.quantity)," so'm"]})]})]},Ie))})]})]},u._id))})})]})]})]})}const Ba=a=>{const o=a.date||new Date,n=a.receiptNumber||`CHK-${Date.now()}`,x=a.cashier||"Kassa";let i="";i+=`================================
`,i+=`
`,i+=`      SARDOR FURNITURA
`,i+=`================================
`,i+=`
`,i+=`CHK: ${n}
`,i+=`     ${o.toLocaleDateString("uz-UZ")} ${o.toLocaleTimeString("uz-UZ",{hour:"2-digit",minute:"2-digit"})}
`,i+=`     KASSIR: ${x}
`,a.customer&&(i+=`MIJOZ: ${a.customer.name}
`,i+=`TEL: ${a.customer.phone}
`),i+=`------------------------
`,i+=`
`;let g=0,v=0;a.items.forEach((S,L)=>{i+=`${L+1}. ${S.code} ${S.name}
`;const $=S.previousPrice,C=S.currentPrice||S.price;g+=($&&$>0?$:C)*S.cartQuantity,v+=C*S.cartQuantity,i+=`                ${S.cartQuantity}
`,i+=`        NARXI: ${p(S.price)}
`,i+=`        ${S.cartQuantity} x ${p(S.price)}
`,i+=`        = ${p(S.price*S.cartQuantity)}
`,i+=`
`}),i+=`------------------------
`,i+=`JAMI: ${p(a.total)}
`;const h=a.items.reduce((S,L)=>{var $;return S+((($=L.paymentBreakdown)==null?void 0:$.cash)||0)},0),q=a.items.reduce((S,L)=>{var $;return S+((($=L.paymentBreakdown)==null?void 0:$.click)||0)},0),P=a.items.reduce((S,L)=>{var $;return S+((($=L.paymentBreakdown)==null?void 0:$.card)||0)},0);h>0&&(i+=`NAQT: ${p(h)}
`),q>0&&(i+=`CLICK: ${p(q)}
`),P>0&&(i+=`KARTA: ${p(P)}
`);const w=a.paymentMethod==="cash"?"NAQD":a.paymentMethod==="click"?"CLICK":"KARTA";return i+=`TO'LOV: ${w}
`,i+=`================================
`,i+=`
`,i+=`     XARIDINGIZ UCHUN
`,i+=`        RAHMAT!
`,i+=`
`,i+=`================================
`,i+=`
`,i+=`âš ï¸  VAZVRAT CHEKSIZ  âš ï¸
`,i+=`   QABUL QILINMAYDI
`,i+=`================================
`,i},dn=(a,o)=>Q(es,null,function*(){var n;try{const x=Ba(a),i=document.createElement("iframe");i.style.position="absolute",i.style.left="-9999px",i.style.top="-9999px",i.style.width="1px",i.style.height="1px",i.style.visibility="hidden",i.style.opacity="0",document.body.appendChild(i);const g=i.contentDocument||((n=i.contentWindow)==null?void 0:n.document);if(!g)throw new Error("Iframe document topilmadi");const v=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>SARDOR FURNITURA - CHEK</title>
          <meta charset="UTF-8">
          <style>
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            
            body {
              font-family: 'Courier New', 'Consolas', monospace;
              font-size: 14px;
              font-weight: 600;
              line-height: 1.5;
              color: #000;
              background: white;
              padding: 10px;
              margin: 0 auto;
              display: flex;
              justify-content: center;
              align-items: flex-start;
              width: 100%;
            }
            
            .receipt-text {
              white-space: pre-wrap;
              font-family: 'Courier New', 'Consolas', monospace;
              font-size: 14px;
              font-weight: 600;
              word-wrap: break-word;
              padding: 10px;
              text-align: center;
              width: 80mm;
              max-width: 80mm;
              margin: 0 auto;
              letter-spacing: 0.5px;
              line-height: 1.5;
            }
            
            /* X Printer uchun maxsus print sozlamalari */
            @media print {
              @page {
                size: 80mm auto;
                margin: 0;
                padding: 0;
              }
              
              body {
                background: white;
                font-size: 13px;
                font-weight: 600;
                padding: 5mm;
                margin: 0 auto;
                width: 80mm;
                display: flex;
                justify-content: center;
                align-items: flex-start;
              }
              
              .receipt-text {
                width: 75mm;
                max-width: 75mm;
                font-weight: 600;
                font-size: 13px;
                padding: 0;
                text-align: center;
                margin: 0 auto;
                letter-spacing: 0.5px;
                line-height: 1.5;
                white-space: pre-wrap;
                word-wrap: break-word;
              }
            }
          </style>
        </head>
        <body>
          <div class="receipt-text">${x}</div>
          
          <script>
            // X Printer uchun print tugagandan keyin callback
            window.addEventListener('afterprint', function() {
              console.log('X Printer: Print tugadi');
              if (window.parent && window.parent.xPrinterCompleted) {
                window.parent.xPrinterCompleted();
              }
            });
            
            // X Printer uchun avtomatik print
            window.addEventListener('load', function() {
              setTimeout(function() {
                console.log('X Printer: Print boshlanmoqda...');
                window.print();
              }, 300);
            });
          <\/script>
        </body>
      </html>
    `;return g.open(),g.write(v),g.close(),o&&(window.xPrinterCompleted=()=>{console.log("X Printer: Callback chaqirildi"),o(),setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i)},1e3),delete window.xPrinterCompleted}),o||setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i)},3e3),console.log("X Printer: Chek tayyorlandi va yuborildi"),!0}catch(x){console.error("X Printer xatosi:",x);try{return mn(a),!1}catch(i){return console.error("Faylni yuklashda xatolik:",i),!1}}}),Oa=(a,o)=>Q(es,null,function*(){return yield dn(a,o)}),mn=a=>{const o=Ba(a),n=new Blob([o],{type:"text/plain;charset=utf-8"}),x=URL.createObjectURL(n),i=document.createElement("a");i.href=x,i.download=`chek-${a.receiptNumber||Date.now()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(x)},xn=()=>Q(es,null,function*(){var a;try{if(navigator.printing&&navigator.printing.getPrinters){const o=yield navigator.printing.getPrinters(),n=o.map(i=>i.name||i.id),x=n.some(i=>i.toLowerCase().includes("x printer")||i.toLowerCase().includes("xprinter")||i.toLowerCase().includes("x-printer"));return{available:o.length>0,printers:n,defaultPrinter:(a=o.find(i=>i.isDefault))==null?void 0:a.name,xPrinterFound:x}}return{available:"print"in window,printers:["Browser Default Printer","X Printer (Auto-detect)"],defaultPrinter:"X Printer (Auto-detect)",xPrinterFound:!0}}catch(o){return console.error("Printer holatini tekshirishda xatolik:",o),{available:!1,printers:[],defaultPrinter:void 0,xPrinterFound:!1}}});function wa(){const{showAlert:a,AlertComponent:o}=Ps(),[n,x]=s.useState([]),[i,g]=s.useState([]),[v,h]=s.useState(!0),[q,P]=s.useState(""),[w,S]=s.useState(""),[L,$]=s.useState(""),[C,m]=s.useState(""),[y,k]=s.useState(null),[j,f]=s.useState(1),[R,W]=s.useState(1),[J,ue]=s.useState(null),[de,K]=s.useState(null),[Se,je]=s.useState(null),[Me,V]=s.useState({totalReceipts:0,totalAmount:0,totalItems:0});s.useEffect(()=>{Ne(),E()},[]),s.useEffect(()=>{E()},[q,w,L,C,j]);const Ne=()=>Q(this,null,function*(){try{const D=yield U.get("/receipts/helpers-stats");g(D.data)}catch(D){console.error("Error fetching helpers:",D)}}),E=()=>Q(this,null,function*(){try{h(!0);const D=new URLSearchParams({page:j.toString(),limit:"20"});q&&D.append("helperId",q),w&&D.append("startDate",w),L&&D.append("endDate",L),C&&D.append("search",C);const we=yield U.get(`/receipts/all-helper-receipts?${D}`);x(we.data.receipts),W(we.data.pagination.totalPages),V(we.data.summary)}catch(D){console.error("Error fetching receipts:",D),a("Cheklar yuklanmadi","Xatolik","danger")}finally{h(!1)}}),ce=D=>{k(y===D?null:D)},be=D=>new Date(D).toLocaleDateString("uz-UZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Le=()=>{P(""),S(""),$(""),m(""),f(1)},O=D=>Q(this,null,function*(){var we;try{ue(D._id);const Z={items:D.items.map(Ce=>({_id:Ce._id,name:Ce.name,code:Ce.code,price:Ce.price,cartQuantity:Ce.quantity,quantity:Ce.quantity,warehouse:"main",category:"",image:Ce.image||void 0})),total:D.total,paymentMethod:D.paymentMethod,receiptNumber:D.receiptNumber,cashier:((we=D.helper)==null?void 0:we.name)||"Xodim",date:new Date(D.createdAt)};(yield Oa(Z,()=>{console.log("Chek chiqarildi:",D.receiptNumber)}))?a("Chek muvaffaqiyatli chiqarildi","Muvaffaqiyat","success"):a("Chek chiqarishda xatolik yuz berdi","Xatolik","warning")}catch(Z){console.error("Print error:",Z),a("Chek chiqarishda xatolik yuz berdi","Xatolik","danger")}finally{ue(null)}}),_=D=>Q(this,null,function*(){var we,Z;try{K(D);const oe=yield U.delete(`/receipts/helper-receipt/${D}`);oe.data.success?(a("Chek muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),E(),Ne()):a(oe.data.message||"Chekni o'chirishda xatolik","Xatolik","danger")}catch(oe){console.error("Delete error:",oe),a(((Z=(we=oe.response)==null?void 0:we.data)==null?void 0:Z.message)||"Chekni o'chirishda xatolik yuz berdi","Xatolik","danger")}finally{K(null),je(null)}});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-blue-100/30 to-slate-100 pb-20 lg:pb-0",children:[o,e.jsx(Ws,{title:"Xodimlar cheklari"}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Jami cheklar"}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:Me.totalReceipts})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg",children:e.jsx(Xs,{className:"w-7 h-7 text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Jami summa"}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:p(Me.totalAmount)}),e.jsx("p",{className:"text-slate-500 text-xs mt-1",children:"UZS"})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center shadow-lg",children:e.jsx(ds,{className:"w-7 h-7 text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Jami mahsulotlar"}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:Me.totalItems})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg",children:e.jsx(Ke,{className:"w-7 h-7 text-white"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ir,{className:"w-5 h-5 text-slate-600"}),e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Filtrlar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(ms,{className:"w-4 h-4 inline mr-1"}),"Xodim"]}),e.jsxs("select",{value:q,onChange:D=>{P(D.target.value),f(1)},className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",children:[e.jsx("option",{value:"",children:"Barchasi"}),i.map(D=>e.jsxs("option",{value:D._id,children:[D.name," (",D.receiptCount," ta chek)"]},D._id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(Hs,{className:"w-4 h-4 inline mr-1"}),"Boshlanish"]}),e.jsx("input",{type:"date",value:w,onChange:D=>{S(D.target.value),f(1)},className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(Hs,{className:"w-4 h-4 inline mr-1"}),"Tugash"]}),e.jsx("input",{type:"date",value:L,onChange:D=>{$(D.target.value),f(1)},className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[e.jsx(fs,{className:"w-4 h-4 inline mr-1"}),"Qidiruv"]}),e.jsx("input",{type:"text",value:C,onChange:D=>{m(D.target.value),f(1)},placeholder:"Chek raqami yoki mahsulot",className:"w-full px-4 py-2.5 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),(q||w||L||C)&&e.jsx("button",{onClick:Le,className:"mt-4 px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-lg transition-all",children:"Filtrlarni tozalash"})]}),v?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(D=>e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200/60 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-slate-200 rounded mb-4 w-1/2"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded w-3/4"})]},D))}):n.length===0?e.jsxs("div",{className:"bg-white rounded-2xl p-12 shadow-lg border border-slate-200/60 text-center",children:[e.jsx(Zs,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:"Cheklar topilmadi"}),e.jsx("p",{className:"text-slate-600",children:"Tanlangan filtrlar bo'yicha cheklar mavjud emas"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(D=>{var we,Z;return e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200/60 overflow-hidden hover:shadow-xl transition-all duration-300",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-3 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(Xs,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-sm truncate",children:D.receiptNumber}),e.jsxs("span",{className:"px-2 py-0.5 bg-white/20 rounded text-xs font-medium flex-shrink-0",children:[D.itemsCount," ta"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("button",{onClick:()=>O(D),disabled:J===D._id,className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Chekni chiqarish",children:J===D._id?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(nt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>je(D._id),disabled:de===D._id,className:"p-1.5 bg-red-500/80 hover:bg-red-600 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Chekni o'chirish",children:de===D._id?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(_s,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-50 text-xs",children:[e.jsx(ms,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"Mijoz:"}),e.jsx("span",{className:"truncate",children:D.customer?D.customer.name:"Oddiy mijoz"})]}),(D.helper||D.createdBy)&&e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-50 text-xs",children:[e.jsx(ms,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"Hodim:"}),e.jsx("span",{className:"truncate",children:((we=D.helper)==null?void 0:we.name)||((Z=D.createdBy)==null?void 0:Z.name)||"Noma'lum"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-100 text-xs mt-1.5",children:[e.jsx(xt,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:be(D.createdAt)})]})]}),e.jsxs("div",{className:"p-3 space-y-3",children:[D.helper&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-white font-bold text-xs flex-shrink-0",children:D.helper.name.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-slate-900 text-xs truncate",children:D.helper.name}),e.jsx("p",{className:"text-[10px] text-slate-600 capitalize truncate",children:D.helper.role})]}),D.helper.bonusPercentage>0&&e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"text-[10px] text-slate-600",children:"Bonus"}),e.jsxs("p",{className:"font-bold text-emerald-600 text-xs",children:[D.helper.bonusPercentage,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-emerald-50 to-emerald-100 rounded-xl",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-emerald-700 font-medium mb-0.5",children:"Jami summa"}),e.jsx("p",{className:"text-xl font-bold text-emerald-900 truncate",children:p(D.total)}),e.jsx("p",{className:"text-[10px] text-emerald-600",children:"UZS"})]}),D.bonusAmount>0&&e.jsxs("div",{className:"text-right flex-shrink-0 ml-2",children:[e.jsx("p",{className:"text-[10px] text-emerald-700 font-medium mb-0.5",children:"Bonus"}),e.jsx("p",{className:"text-base font-bold text-emerald-900",children:p(D.bonusAmount)})]})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>ce(D._id),className:"w-full flex items-center justify-between p-2 bg-slate-50 hover:bg-slate-100 rounded-xl transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(Ke,{className:"w-3.5 h-3.5 text-slate-600 flex-shrink-0"}),e.jsxs("span",{className:"font-medium text-slate-900 text-xs truncate",children:["Mahsulotlar (",D.totalQuantity," dona)"]})]}),y===D._id?e.jsx(ma,{className:"w-4 h-4 text-slate-600 flex-shrink-0"}):e.jsx(pt,{className:"w-4 h-4 text-slate-600 flex-shrink-0"})]}),y===D._id&&e.jsx("div",{className:"mt-2 space-y-1.5 max-h-64 overflow-y-auto",children:D.items.map(oe=>e.jsx("div",{className:"flex items-center gap-2 p-2 bg-white border border-slate-200 rounded-xl hover:border-blue-300 transition-all",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-slate-900 text-xs truncate",children:oe.name}),e.jsxs("p",{className:"text-[10px] text-slate-600 truncate",children:["Kod: ",oe.code]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5",children:[e.jsxs("span",{className:"text-xs text-slate-600 truncate",children:[oe.quantity," x ",p(oe.price)]}),e.jsxs("span",{className:"text-xs font-bold text-blue-600 flex-shrink-0",children:["= ",p(oe.total)]})]})]})},oe._id))})]})]})]},D._id)})}),R>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6",children:[e.jsx("button",{onClick:()=>f(D=>Math.max(1,D-1)),disabled:j===1,className:"px-4 py-2 rounded-xl bg-white border border-slate-300 text-slate-700 font-medium hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Oldingi"}),e.jsxs("span",{className:"px-4 py-2 text-slate-700 font-medium",children:[j," / ",R]}),e.jsx("button",{onClick:()=>f(D=>Math.min(R,D+1)),disabled:j===R,className:"px-4 py-2 rounded-xl bg-white border border-slate-300 text-slate-700 font-medium hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Keyingi"})]})]})]}),Se&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-scale-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx(_s,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"Chekni o'chirish"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Bu amalni qaytarib bo'lmaydi"})]})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:[e.jsxs("p",{className:"text-sm text-red-800 mb-2",children:[e.jsx("strong",{children:"Diqqat!"})," Chekni o'chirsangiz:"]}),e.jsxs("ul",{className:"text-sm text-red-700 space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ Mahsulot miqdorlari qaytariladi"}),e.jsx("li",{children:"â€¢ Xodim bonusi ayriladi"}),e.jsx("li",{children:"â€¢ Statistika yangilanadi"}),e.jsx("li",{children:"â€¢ Bu amalni bekor qilib bo'lmaydi"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>je(null),disabled:de===Se,className:"flex-1 px-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-all disabled:opacity-50",children:"Bekor qilish"}),e.jsx("button",{onClick:()=>_(Se),disabled:de===Se,className:"flex-1 px-4 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-xl transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:de===Se?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"O'chirilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"w-5 h-5"}),"O'chirish"]})})]})]})})]})}function un(){const[a,o]=s.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-surface-50",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(Ea,{items:Dr,basePath:"/cashier",collapsed:a,setCollapsed:o})}),e.jsx("main",{className:`transition-all duration-300 ease-smooth ${a?"lg:ml-[72px]":"lg:ml-64"}`,children:e.jsx(Ut,{})})]})}function hn(){const{user:a,logout:o}=it();return e.jsxs("div",{className:"min-h-screen bg-surface-50",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-white/80 backdrop-blur-xl border-b border-surface-200/60",children:e.jsxs("div",{className:"px-3 sm:px-4 h-14 sm:h-16 flex items-center justify-between max-w-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-shrink",children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center shadow-sm flex-shrink-0",children:e.jsx(or,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),e.jsx("span",{className:"font-bold text-base sm:text-lg text-surface-900 hidden sm:inline truncate",children:"Sardorbek.Furnetura"}),e.jsx("span",{className:"font-bold text-sm text-surface-900 sm:hidden truncate",children:"Sardorbek"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-2 px-3 py-2 bg-surface-100 rounded-xl max-w-[150px]",children:[e.jsx(ms,{className:"w-4 h-4 text-surface-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-surface-700 truncate",children:a==null?void 0:a.name})]}),e.jsx("div",{className:"md:hidden flex items-center justify-center w-8 h-8 bg-surface-100 rounded-lg flex-shrink-0",children:e.jsx(ms,{className:"w-4 h-4 text-surface-500"})}),e.jsx("button",{onClick:o,className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg text-surface-500 hover:text-danger-600 hover:bg-danger-50 transition-colors flex-shrink-0",title:"Chiqish",children:e.jsx(Pt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]})}),e.jsx("main",{className:"p-3 sm:p-4",children:e.jsx(Ut,{})})]})}function pn(){var Ze,X,ve,M,Te,Re,Ue,Ye,Ss;const{showAlert:a,AlertComponent:o}=Ps(),[n,x]=s.useState(!1),[i,g]=s.useState(""),[v,h]=s.useState(""),[q,P]=s.useState([]),[w,S]=s.useState([]),[L,$]=s.useState([]),[C,m]=s.useState(null),[y,k]=s.useState(null),[j,f]=s.useState(!1),[R,W]=s.useState([]),[J,ue]=s.useState(null),[de,K]=s.useState(""),[Se,je]=s.useState(!1),[Me,V]=s.useState(!1),[Ne,E]=s.useState({name:"",phone:""}),[ce,be]=s.useState(!1),[Le,O]=s.useState("environment"),_=s.useRef(null);s.useEffect(()=>(D(),we(),()=>{_.current&&_.current.stop().catch(()=>{})}),[]),s.useEffect(()=>{_e(i)},[v]);const D=()=>Q(this,null,function*(){try{const I=yield U.get("/products"),he=I.data.data||I.data;S(Array.isArray(he)?he:[])}catch(I){console.error("Error fetching products:",I)}}),we=()=>Q(this,null,function*(){try{const I=yield U.get("/customers");W(I.data.data||I.data||[])}catch(I){console.error("Error fetching customers:",I)}}),Z=()=>Q(this,null,function*(){var I,he;if(!Ne.name.trim()||!Ne.phone.trim()){a("Iltimos, ism va telefon raqamni kiriting!","Ogohlantirish","warning");return}be(!0);try{const ze=(yield U.post("/customers",{name:Ne.name.trim(),phone:Ne.phone.trim()})).data;W(t=>[ze,...t]),ue(ze),V(!1),je(!1),E({name:"",phone:""}),a(`Mijoz ${ze.name} qo'shildi!`,"Muvaffaqiyat","success")}catch(me){a(((he=(I=me==null?void 0:me.response)==null?void 0:I.data)==null?void 0:he.message)||"Mijoz qo'shishda xatolik","Xatolik","danger")}finally{be(!1)}}),oe=()=>Q(this,null,function*(){m(null),g(""),$([]),x(!0),yield new Promise(I=>setTimeout(I,100));try{if(!document.getElementById("qr-reader"))throw new Error("QR reader element topilmadi. Iltimos, qayta urinib ko'ring.");const he=new qr("qr-reader");_.current=he,yield he.start({facingMode:Le},{fps:30,qrbox:{width:250,height:250},aspectRatio:1,disableFlip:!1,videoConstraints:{facingMode:Le,width:{ideal:1280},height:{ideal:720}}},me=>Q(this,null,function*(){var G;console.log("QR kod o'qildi:",me);let ze=null;try{const se=JSON.parse(me);se&&typeof se=="object"&&(se.code?ze=String(se.code):(se.id||se._id)&&(ze=String(se.id||se._id)))}catch(se){}let t=ze||me;if(t.includes("/product/")){const se=t.split("/product/");se.length>1&&(t=se[1].split("?")[0].split("#")[0])}console.log("Qidiruv kaliti:",t);let A=w.find(se=>se.code===t||se._id===t);if(console.log("Local'da topildi:",!!A),!A)try{console.log("Serverdan qidirilmoqda:",t),A=(yield U.get(`/products/scan-qr/${encodeURIComponent(t)}`)).data,console.log("Serverdan topildi:",!!A)}catch(se){console.error("Server qidiruv xatosi:",(G=se.response)==null?void 0:G.status,se.message)}A?(m(A),w.find(se=>se._id===A._id)||S(se=>[...se,A])):a("Tovar topilmadi: "+t,"Xatolik","warning"),Ce()}),()=>{})}catch(I){console.error("Scanner error:",I),x(!1);let he="Kamerani ishga tushirishda xatolik";I.name==="NotAllowedError"?he="Kamera ruxsati berilmadi. Brauzer sozlamalarida kamera ruxsatini yoqing.":I.name==="NotFoundError"?he="Kamera topilmadi. Qurilmangizda kamera borligini tekshiring.":I.name==="NotReadableError"?he="Kamera band. Boshqa ilova kamerani ishlatayotgan bo'lishi mumkin.":I.name==="NotSupportedError"?he="HTTPS kerak. Xavfsiz ulanish orqali kirish kerak.":I.message&&(he=I.message),a(he,"Xatolik","danger")}}),Ce=()=>Q(this,null,function*(){if(_.current){try{yield _.current.stop()}catch(I){}_.current=null}x(!1)}),Qe=()=>Q(this,null,function*(){n?(yield Ce(),O(I=>I==="environment"?"user":"environment"),setTimeout(()=>{oe()},300)):O(I=>I==="environment"?"user":"environment")}),_e=I=>{if(g(I),m(null),I.length>0){let he=w.filter(me=>me.name.toLowerCase().includes(I.toLowerCase())||me.code.toLowerCase().includes(I.toLowerCase()));v&&(he=he.filter(me=>me.category===v)),$(he)}else if(v){const he=w.filter(me=>me.category===v);$(he)}else $([])},Oe=(I,he)=>{let me=15;he>=100?me=11:he>=10?me=13:me=15;const ze=I*(1+me/100);return Math.round(ze)},ts=I=>I>=100?{name:"100+ dona",markupPercent:11,discount:!0}:I>=10?{name:"10-99 dona",markupPercent:13,discount:!0}:{name:"1-9 dona",markupPercent:15,discount:!1},He=I=>{P(he=>{const me=he.find(t=>t._id===I._id);if(me){const t=me.cartQuantity+1,A=Oe(I.price,t);return he.map(G=>G._id===I._id?N(b({},G),{cartQuantity:t,price:A}):G)}const ze=Oe(I.price,1);return[...he,N(b({},I),{cartQuantity:1,price:ze})]}),g(""),$([]),m(null)},u=(I,he)=>{P(me=>me.map(ze=>{if(ze._id===I){const t=Math.max(1,ze.cartQuantity+he),A=w.find(G=>G._id===I);if(A){const G=Oe(A.price,t);return N(b({},ze),{cartQuantity:t,price:G})}return N(b({},ze),{cartQuantity:t})}return ze}))},ee=I=>{P(he=>he.filter(me=>me._id!==I))},Ie=()=>Q(this,null,function*(){if(q.length===0){a("Savat bo'sh!","Ogohlantirish","warning");return}if(!J){a("Iltimos, mijozni tanlang!","Ogohlantirish","warning"),je(!0);return}f(!0);try{const I={customer:J._id==="default"?null:J._id,items:q.map(me=>({product:me._id,name:me.name,code:me.code,price:me.price,quantity:me.cartQuantity})),total:ne,paymentMethod:"cash",paidAmount:ne,status:J._id==="default"?"completed":"pending"};yield U.post("/receipts",I);const he=J._id==="default"?"Oddiy mijoz":J.name;a(`Chek ${he} uchun saqlandi!`,"Muvaffaqiyat","success"),P([]),ue(null)}catch(I){console.error("Error sending receipt:",I),a("Xatolik yuz berdi","Xatolik","danger")}finally{f(!1)}}),qe=R.filter(I=>I.name.toLowerCase().includes(de.toLowerCase())||I.phone.includes(de)),ne=q.reduce((I,he)=>I+he.price*he.cartQuantity,0);return e.jsxs("div",{className:"min-h-[calc(100vh-120px)] bg-gradient-to-b from-surface-50 to-surface-100/80 rounded-3xl p-4 sm:p-6 lg:p-8 shadow-sm overflow-x-hidden",children:[o,e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-semibold text-surface-900 flex items-center gap-2",children:[e.jsx(zt,{className:"w-6 h-6 text-brand-600"}),"Skaner orqali savat to'ldirish"]}),e.jsx("p",{className:"text-sm text-surface-500 mt-1",children:"Tovarlarni QR kod orqali tezda toping, savatga qo'shing va kassaga yuboring."})]}),e.jsxs("button",{onClick:()=>je(!0),className:`flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-xl transition-all shadow-sm text-sm sm:text-base w-full sm:w-auto ${J?"bg-green-50 border-2 border-green-500 text-green-700 hover:bg-green-100":"bg-brand-500 text-white hover:bg-brand-600"}`,children:[e.jsx(ms,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("div",{className:"text-xs font-medium",children:J?"Mijoz tanlandi":"Mijoz tanlash"}),J&&e.jsx("div",{className:"text-sm font-semibold truncate",children:J.name})]})]})]}),Se&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-surface-200 flex items-center justify-between bg-gradient-to-r from-brand-500 to-brand-600",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(Ys,{className:"w-5 h-5"}),"Mijoz tanlash"]}),e.jsx("button",{onClick:()=>je(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/20 transition-colors text-white",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:Me?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900",children:"Yangi mijoz qo'shish"}),e.jsx("button",{onClick:()=>{V(!1),E({name:"",phone:""})},className:"text-surface-500 hover:text-surface-700",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Ism"}),e.jsx("input",{type:"text",value:Ne.name,onChange:I=>E(N(b({},Ne),{name:I.target.value})),placeholder:"Alisher Karimov",className:"w-full px-4 py-2.5 border border-surface-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Telefon raqam"}),e.jsx("input",{type:"tel",value:Ne.phone,onChange:I=>E(N(b({},Ne),{phone:I.target.value})),placeholder:"+998901234567",className:"w-full px-4 py-2.5 border border-surface-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>{V(!1),E({name:"",phone:""})},className:"flex-1 px-4 py-2.5 border border-surface-200 text-surface-700 rounded-xl hover:bg-surface-50 transition-colors font-medium",disabled:ce,children:"Bekor qilish"}),e.jsx("button",{onClick:Z,disabled:ce,className:"flex-1 px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-xl transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:ce?"Qo'shilmoqda...":"Qo'shish"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",value:de,onChange:I=>K(I.target.value),placeholder:"Ism yoki telefon raqam...",className:"w-full pl-10 pr-4 py-2.5 border border-surface-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500",autoFocus:!0})]}),e.jsxs("button",{onClick:()=>V(!0),className:"px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-xl transition-colors flex items-center gap-2 font-medium whitespace-nowrap",children:[e.jsx(ys,{className:"w-4 h-4"}),"Yangi"]})]}),e.jsxs("div",{className:"max-h-96 overflow-y-auto space-y-2",children:[e.jsxs("button",{onClick:()=>{ue({_id:"default",name:"Oddiy mijoz",phone:"",debt:0}),je(!1),K("")},className:`w-full p-3 rounded-xl text-left transition-all ${(J==null?void 0:J._id)==="default"?"bg-blue-50 border-2 border-blue-500":"bg-blue-50/50 hover:bg-blue-100 border-2 border-blue-200"}`,children:[e.jsxs("div",{className:"font-medium text-blue-900 flex items-center gap-2",children:[e.jsx(ms,{className:"w-4 h-4"}),"Oddiy mijoz"]}),e.jsx("div",{className:"text-xs text-blue-600",children:"Faqat to'liq to'lov"})]}),qe.length===0?e.jsxs("div",{className:"text-center py-8 text-surface-500",children:[e.jsx(Ys,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Mijoz topilmadi"})]}):qe.map(I=>e.jsxs("button",{onClick:()=>{ue(I),je(!1),K("")},className:`w-full p-3 rounded-xl text-left transition-all ${(J==null?void 0:J._id)===I._id?"bg-green-50 border-2 border-green-500":"bg-surface-50 hover:bg-surface-100 border-2 border-transparent"}`,children:[e.jsx("div",{className:"font-medium text-surface-900",children:I.name}),e.jsx("div",{className:"text-sm text-surface-500",children:I.phone})]},I._id))]})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_400px] gap-4 lg:gap-6 items-start w-full",children:[e.jsxs("div",{className:"space-y-4 lg:space-y-5 min-w-0",children:[e.jsx("div",{className:"card p-3 sm:p-4 border border-surface-100 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-3 items-stretch",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(fs,{className:"absolute left-3 sm:left-3.5 top-1/2 -translate-y-1/2 w-4 sm:w-5 h-4 sm:h-5 text-brand-400 z-10 pointer-events-none"}),e.jsx("input",{type:"text",value:i,onChange:I=>_e(I.target.value),placeholder:"Qidirish...",className:"w-full h-12 pl-10 sm:pl-11 pr-10 rounded-xl border-2 border-surface-200 focus:border-brand-400 focus:ring-4 focus:ring-brand-100 transition-all text-sm sm:text-base text-surface-900 placeholder:text-surface-400 bg-white shadow-sm hover:border-brand-300 relative z-0"}),i&&e.jsx("button",{onClick:()=>_e(""),className:"absolute right-3 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full bg-surface-100 hover:bg-surface-200 flex items-center justify-center transition-colors z-10",children:e.jsx(ge,{className:"w-4 h-4 text-surface-500"})})]}),e.jsx("div",{className:"bg-white rounded-xl p-2 border-2 border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide",children:[e.jsx("button",{onClick:()=>h(""),className:`flex-shrink-0 px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg font-medium text-xs sm:text-sm transition-all ${v===""?"bg-brand-500 text-white shadow-md":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:"Barchasi"}),Mt.map(I=>e.jsx("button",{onClick:()=>h(I),className:`flex-shrink-0 px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg font-medium text-xs sm:text-sm transition-all whitespace-nowrap ${v===I?"bg-brand-500 text-white shadow-md":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:I},I))]})}),e.jsxs("button",{onClick:n?Ce:oe,className:`h-12 flex items-center justify-center gap-2 rounded-xl px-4 font-medium ${n?"btn-secondary":"btn-primary"} shadow-md hover:shadow-lg transition-all`,children:[e.jsx(zt,{className:"w-5 h-5"}),e.jsx("span",{children:n?"Skanerni to'xtatish":"QR skaner"})]})]})}),n&&e.jsx("div",{className:"card border border-brand-100 bg-gradient-to-br from-brand-50/60 to-surface-0 shadow-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 sm:p-5",children:[e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl overflow-hidden ring-4 ring-brand-300/50 ring-offset-4 ring-offset-surface-0 shadow-lg",children:[e.jsx("div",{id:"qr-reader",className:"w-full aspect-square bg-black"}),e.jsx("button",{onClick:Qe,className:"absolute bottom-3 right-3 w-9 h-9 bg-white/95 hover:bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-all hover:scale-105 z-10 backdrop-blur-sm border border-white/20",title:Le==="environment"?"Old kameraga o'tish":"Orqa kameraga o'tish",children:e.jsx(Os,{className:"w-4 h-4 text-surface-600"})})]}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-surface-800",children:"QR kodni kameraga toâ€˜gâ€˜ri tuting"}),e.jsx("p",{className:"text-xs text-surface-500",children:"Kamera kodni oâ€˜qigach, tovar ma'lumotlari avtomatik chiqadi."})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-success-500 to-success-600 p-4 flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(oa,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Tovar topildi!"})]}),e.jsx("button",{onClick:()=>m(null),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/20 transition-colors text-white",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide",children:"Mahsulot nomi"}),e.jsx("p",{className:"text-xl font-bold text-surface-900 mt-1",children:C.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide",children:"Mahsulot kodi"}),e.jsx("p",{className:"text-lg font-semibold text-surface-700 mt-1",children:C.code})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide",children:"Mavjud miqdor"}),e.jsxs("p",{className:"text-lg font-semibold text-brand-600 mt-1",children:[C.quantity," dona"]})]}),e.jsxs("div",{className:"bg-brand-50 border border-brand-200 rounded-xl p-4",children:[e.jsx("label",{className:"text-xs font-medium text-brand-700 uppercase tracking-wide",children:"Optom narxi"}),e.jsxs("p",{className:"text-2xl font-bold text-brand-600 mt-1",children:[p(C.price)," so'm"]})]}),(C.unitPrice||C.boxPrice||((Ze=C.prices)==null?void 0:Ze.perUnit)||((X=C.prices)==null?void 0:X.perBox)||((ve=C.prices)==null?void 0:ve.perRoll))&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide mb-2 block",children:"Boshqa narxlar"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(M=C.prices)!=null&&M.perUnit||C.unitPrice||C.price?e.jsxs("div",{className:"flex-1 min-w-[140px] px-4 py-3 rounded-xl bg-success-50 border border-success-200",children:[e.jsx("p",{className:"text-xs text-success-600 font-medium",children:"Dona narxi"}),e.jsxs("p",{className:"text-lg font-bold text-success-700 mt-0.5",children:[p(((Te=C.prices)==null?void 0:Te.perUnit)||C.unitPrice||C.price)," so'm"]})]}):null,(Re=C.prices)!=null&&Re.perBox||C.boxPrice?e.jsxs("div",{className:"flex-1 min-w-[140px] px-4 py-3 rounded-xl bg-brand-50 border border-brand-200",children:[e.jsx("p",{className:"text-xs text-brand-600 font-medium",children:"Karobka narxi"}),e.jsxs("p",{className:"text-lg font-bold text-brand-700 mt-0.5",children:[p(((Ue=C.prices)==null?void 0:Ue.perBox)||C.boxPrice||0)," so'm"]})]}):null,(Ye=C.prices)!=null&&Ye.perRoll?e.jsxs("div",{className:"flex-1 min-w-[140px] px-4 py-3 rounded-xl bg-sky-50 border border-sky-200",children:[e.jsx("p",{className:"text-xs text-sky-600 font-medium",children:"Rulon narxi"}),e.jsxs("p",{className:"text-lg font-bold text-sky-700 mt-0.5",children:[p(((Ss=C.prices)==null?void 0:Ss.perRoll)||0)," so'm"]})]}):null]})]}),C.pricingTiers&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-500 uppercase tracking-wide mb-2 block",children:"Miqdorga qarab chegirmalar"}),e.jsxs("div",{className:"space-y-2",children:[C.pricingTiers.tier1&&e.jsxs("div",{className:"px-4 py-3 rounded-xl border border-emerald-200 bg-emerald-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-emerald-700",children:[C.pricingTiers.tier1.minQuantity,"-",C.pricingTiers.tier1.maxQuantity," dona"]}),e.jsxs("span",{className:"text-lg font-bold text-emerald-700",children:[C.pricingTiers.tier1.discountPercent,"% chegirma"]})]}),e.jsxs("p",{className:"text-sm text-emerald-600 mt-1",children:["Narx: ",p(Math.round(C.price*(1-C.pricingTiers.tier1.discountPercent/100)))," so'm"]})]}),C.pricingTiers.tier2&&e.jsxs("div",{className:"px-4 py-3 rounded-xl border border-sky-200 bg-sky-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-sky-700",children:[C.pricingTiers.tier2.minQuantity,"-",C.pricingTiers.tier2.maxQuantity," dona"]}),e.jsxs("span",{className:"text-lg font-bold text-sky-700",children:[C.pricingTiers.tier2.discountPercent,"% chegirma"]})]}),e.jsxs("p",{className:"text-sm text-sky-600 mt-1",children:["Narx: ",p(Math.round(C.price*(1-C.pricingTiers.tier2.discountPercent/100)))," so'm"]})]}),C.pricingTiers.tier3&&e.jsxs("div",{className:"px-4 py-3 rounded-xl border border-violet-200 bg-violet-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-violet-700",children:[C.pricingTiers.tier3.minQuantity,"+ dona"]}),e.jsxs("span",{className:"text-lg font-bold text-violet-700",children:[C.pricingTiers.tier3.discountPercent,"% chegirma"]})]}),e.jsxs("p",{className:"text-sm text-violet-600 mt-1",children:["Narx: ",p(Math.round(C.price*(1-C.pricingTiers.tier3.discountPercent/100)))," so'm"]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>m(null),className:"flex-1 px-4 py-3 border border-surface-200 text-surface-700 rounded-xl hover:bg-surface-50 transition-colors font-medium",children:"Yopish"}),e.jsxs("button",{onClick:()=>{He(C),m(null)},className:"flex-1 px-4 py-3 bg-success-500 hover:bg-success-600 text-white rounded-xl transition-colors font-medium flex items-center justify-center gap-2",children:[e.jsx(ys,{className:"w-5 h-5"}),"Savatga qo'shish"]})]})]})]})}),i&&L.length>0&&e.jsxs("div",{className:"card p-0 overflow-hidden border border-surface-100 shadow-sm",children:[e.jsxs("div",{className:"px-4 pt-4 pb-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700",children:"Qidiruv natijalari"}),e.jsxs("span",{className:"text-xs text-surface-400",children:[L.length," ta topildi"]})]}),e.jsx("div",{className:"divide-y divide-surface-100 max-h-72 overflow-auto custom-scrollbar",children:L.map(I=>e.jsxs("button",{onClick:()=>He(I),className:"w-full flex items-center justify-between p-4 hover:bg-surface-50/80 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center",children:e.jsx(Ke,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900 line-clamp-1",children:I.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",I.code]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-brand-600",children:[p(I.price)," so'm"]}),e.jsxs("p",{className:"text-[11px] text-surface-400",children:[I.quantity," dona"]})]})]},I._id))})]}),i&&L.length===0&&e.jsx("div",{className:"card text-center py-10 bg-surface-0/60 border-dashed border-surface-200",children:e.jsx("p",{className:"text-sm text-surface-500",children:"Tovar topilmadi. Nomi yoki kodini tekshirib qayta urinib ko'ring."})})]}),e.jsx("div",{className:"lg:sticky lg:top-4 min-w-0 w-full",children:e.jsxs("div",{className:"card border border-surface-100 shadow-md shadow-surface-900/5 p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 rounded-xl bg-brand-50 flex items-center justify-center flex-shrink-0",children:e.jsx(hs,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Savat"}),e.jsx("p",{className:"text-xs text-surface-400 truncate",children:"Tanlangan tovarlar"})]})]}),e.jsxs("span",{className:"badge-primary text-xs px-2 sm:px-3 py-1 rounded-full flex-shrink-0",children:[q.length," ta"]})]}),q.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-10",children:[e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 bg-surface-100 rounded-2xl flex items-center justify-center mx-auto mb-3",children:e.jsx(hs,{className:"w-7 h-7 sm:w-8 sm:h-8 text-surface-300"})}),e.jsx("p",{className:"text-surface-500 text-xs sm:text-sm px-2",children:"Savat bo'sh. QR skaner yoki qidiruv orqali tovar qo'shing."})]}):e.jsx("div",{className:"space-y-2 sm:space-y-3 max-h-[360px] overflow-auto pr-1 custom-scrollbar",children:q.map(I=>{var t,A,G,se,ss,as,is,Je,os,bs,Is,Cs,zs,Es,Ts,gs,Ns;const he=ts(I.cartQuantity);(t=w.find(js=>js._id===I._id))!=null&&t.price||I.price;const me=w.find(js=>js._id===I._id),ze=y===I._id;return e.jsxs("div",{className:"bg-surface-50 rounded-xl border border-surface-100",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 sm:p-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate text-sm",children:I.name}),e.jsxs("button",{onClick:()=>k(ze?null:I._id),className:"flex items-center gap-1.5 mt-1 hover:opacity-80 transition-opacity",children:[e.jsxs("span",{className:`text-[9px] sm:text-[10px] font-bold px-1.5 py-0.5 rounded ${he.discount?"bg-success-100 text-success-700":"bg-surface-200 text-surface-600"}`,children:[he.name," â€¢ ",he.markupPercent,"%"]}),ze?e.jsx(ma,{className:"w-3 h-3 text-surface-500"}):e.jsx(pt,{className:"w-3 h-3 text-surface-500"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-brand-600 font-semibold mt-1",children:[p(I.price*I.cartQuantity)," so'm"]})]}),e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1 bg-white rounded-lg border border-surface-200 px-1 sm:px-1.5 py-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>u(I._id,-1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded hover:bg-surface-100 transition-colors",children:e.jsx(Xt,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("input",{type:"number",min:"1",value:I.cartQuantity,onChange:js=>{const te=(parseInt(js.target.value)||1)-I.cartQuantity;u(I._id,te)},className:"w-8 sm:w-10 text-center font-semibold text-xs sm:text-sm bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-brand-500 rounded"}),e.jsx("button",{onClick:()=>u(I._id,1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded hover:bg-surface-100 transition-colors",children:e.jsx(ys,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsx("button",{onClick:()=>ee(I._id),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded-lg hover:bg-red-50 text-red-500 transition-colors flex-shrink-0",children:e.jsx(ge,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]}),ze&&me&&e.jsxs("div",{className:"px-2 sm:px-3 pb-2 sm:pb-3 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-[10px] font-medium text-green-900",children:[((G=(A=me.pricingTiers)==null?void 0:A.tier1)==null?void 0:G.minQuantity)||1,"-",((ss=(se=me.pricingTiers)==null?void 0:se.tier1)==null?void 0:ss.maxQuantity)||9," dona"]})}),e.jsxs("span",{className:"text-xs font-bold text-green-700",children:[((is=(as=me.pricingTiers)==null?void 0:as.tier1)==null?void 0:is.discountPercent)||15,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-[10px] font-medium text-blue-900",children:[((os=(Je=me.pricingTiers)==null?void 0:Je.tier2)==null?void 0:os.minQuantity)||10,"-",((Is=(bs=me.pricingTiers)==null?void 0:bs.tier2)==null?void 0:Is.maxQuantity)||99," dona"]})}),e.jsxs("span",{className:"text-xs font-bold text-blue-700",children:[((zs=(Cs=me.pricingTiers)==null?void 0:Cs.tier2)==null?void 0:zs.discountPercent)||13,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-[10px] font-medium text-purple-900",children:[((Ts=(Es=me.pricingTiers)==null?void 0:Es.tier3)==null?void 0:Ts.minQuantity)||100,"+ dona"]})}),e.jsxs("span",{className:"text-xs font-bold text-purple-700",children:[((Ns=(gs=me.pricingTiers)==null?void 0:gs.tier3)==null?void 0:Ns.discountPercent)||11,"%"]})]})]})]},I._id)})}),q.length>0&&e.jsxs("div",{className:"mt-4 pt-3 sm:pt-4 border-t border-surface-200 space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-surface-500 text-xs sm:text-sm",children:"Jami summa"}),e.jsxs("span",{className:"text-xl sm:text-2xl font-bold text-surface-900",children:[p(ne)," so'm"]})]}),e.jsx("button",{onClick:Ie,disabled:j,className:"btn-primary w-full py-3 sm:py-3.5 text-sm sm:text-base rounded-xl flex items-center justify-center gap-2",children:j?e.jsx("div",{className:"spinner"}):e.jsxs(e.Fragment,{children:[e.jsx(Pa,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Kassaga yuborish"]})})]})]})})]})]})}function fn(){const a=Ks(),o=lt(),[n,x]=s.useState(!1),[i,g]=s.useState(null),[v,h]=s.useState("idle"),{showAlert:q,AlertComponent:P}=Ps(),[w,S]=s.useState({arrived:0,left:0}),[L,$]=s.useState("");s.useEffect(()=>{window.location.pathname.startsWith("/kassa")||a("/kassa",{replace:!0});const W=()=>{window.history.pushState(null,"",window.location.href)};return window.addEventListener("popstate",W),window.history.pushState(null,"",window.location.href),()=>{window.removeEventListener("popstate",W)}},[a]);const m=(()=>{try{const R=localStorage.getItem("kassaLoggedIn");if(R)return{username:JSON.parse(R).username||"Kassa",isActive:!0}}catch(R){console.error("Error getting user info:",R)}return{username:"Kassa",isActive:!1}})(),y=()=>{const R=new Date,W=R.getFullYear(),J=String(R.getMonth()+1).padStart(2,"0"),ue=String(R.getDate()).padStart(2,"0");return`${W}-${J}-${ue}`};s.useEffect(()=>{const R=()=>{const J=y();$(J);const ue=`attendance:kassa:${m.username}:${J}`,de=localStorage.getItem(ue),K=de?JSON.parse(de):{arrived:0,left:0};S(K),h(K.arrived>0&&K.left===0?"arrived":"idle")};R();const W=setInterval(()=>{y()!==L&&R()},6e4);return()=>clearInterval(W)},[m.username,L]);const k=R=>Q(this,null,function*(){var W,J;if(!i)try{if(g(R),yield U.post("/telegram/attendance/kassa",{type:R,username:m.username}),yield q(R==="arrived"?"Keldingiz xabari yuborildi":"Ketdingiz xabari yuborildi","Muvaffaqiyatli","success"),R==="arrived"){const ue=`attendance:kassa:${m.username}:${L||y()}`,de=w,K=N(b({},de),{arrived:de.arrived+1});localStorage.setItem(ue,JSON.stringify(K)),S(K),K.arrived>0&&K.left===0&&h("arrived")}else{const ue=`attendance:kassa:${m.username}:${L||y()}`,de=w,K=N(b({},de),{left:de.left+1});localStorage.setItem(ue,JSON.stringify(K)),S(K),j(),window.location.replace("/kassa-login")}}catch(ue){yield q(((J=(W=ue==null?void 0:ue.response)==null?void 0:W.data)==null?void 0:J.message)||"Xabar yuborishda xatolik","Xatolik","danger")}finally{g(null)}}),j=s.useCallback(()=>{localStorage.removeItem("kassaLoggedIn"),localStorage.removeItem("kassaToken"),window.location.replace("/kassa-login")},[]),f=()=>{const R=o.pathname;return R==="/kassa"||R==="/kassa/"?"Kassa":R==="/kassa/receipts"?"Cheklar":R==="/kassa/clients"?"Mijozlar":R==="/kassa/products"?"Tovarlar":"Kassa"};return e.jsxs("div",{className:"h-screen flex overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[n&&e.jsx("div",{className:"fixed inset-0 z-40 lg:hidden",style:{background:"rgba(46, 16, 101, 0.6)",backdropFilter:"blur(8px)"},onClick:()=>x(!1)}),e.jsxs("aside",{className:`
        fixed lg:static inset-y-0 left-0 z-50 w-72 flex flex-col
        transform transition-transform duration-300 ease-in-out lg:transform-none
        ${n?"translate-x-0":"-translate-x-full lg:translate-x-0"}
      `,style:{background:"linear-gradient(180deg, #2e1065 0%, #4c1d95 100%)",borderRight:"1px solid rgba(6, 182, 212, 0.2)",boxShadow:"4px 0 24px -4px rgba(46, 16, 101, 0.3)"},children:[e.jsxs("div",{className:"p-5 flex items-center justify-between",style:{borderBottom:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, transparent 100%)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center overflow-hidden",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:e.jsx("img",{src:"/o5sk1awh.png",alt:"Logo",className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-lg text-white tracking-wide",style:{fontFamily:"'Playfair Display', serif",letterSpacing:"0.5px"},children:"Sardor"}),e.jsx("p",{className:"text-sm font-semibold tracking-wider",style:{color:"#c4b5fd",fontFamily:"'Montserrat', sans-serif",letterSpacing:"1.5px"},children:"FURNITURA"})]})]}),e.jsx("button",{onClick:()=>x(!1),className:"lg:hidden p-2 rounded-xl transition-colors",style:{background:"rgba(255, 255, 255, 0.1)",color:"#c4b5fd"},children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"flex-1 p-4 overflow-y-auto",children:e.jsx("div",{className:"space-y-1.5",children:[{path:"/kassa",label:"Kassa",icon:za},{path:"/kassa/receipts",label:"Cheklar",icon:Zs},{path:"/kassa/clients",label:"Mijozlar",icon:Ys},{path:"/kassa/debts",label:"Qarz daftarcha",icon:Zs},{path:"/kassa/products",label:"Tovarlar",icon:Ke}].map(({path:R,label:W,icon:J})=>e.jsxs(cr,{to:R,onClick:()=>x(!1),className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200",style:{background:o.pathname===R?"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)":"transparent",color:o.pathname===R?"#ffffff":"#c4b5fd",boxShadow:o.pathname===R?"0 4px 12px -2px rgba(6, 182, 212, 0.4)":"none"},children:[e.jsx(J,{className:"w-5 h-5"}),W]},R))})}),e.jsxs("div",{className:"p-4",style:{borderTop:"1px solid rgba(6, 182, 212, 0.15)",background:"linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.2) 100%)"},children:[e.jsx("div",{className:"rounded-2xl p-4 mb-3",style:{background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(6, 182, 212, 0.15)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center",style:{background:"linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)",boxShadow:"0 4px 12px -2px rgba(124, 58, 237, 0.4)"},children:e.jsx("span",{className:"text-base font-bold text-white",children:m.username.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-bold text-white truncate",children:m.username==="alisher"?"Namozov Alisher":m.username==="kassa1"?"Kassa Xodimi":m.username==="admin"?"Administrator":m.username}),e.jsxs("p",{className:"text-xs font-medium flex items-center gap-1",style:{color:"#a5b4fc"},children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-400 rounded-full animate-pulse"}),"Kassir â€¢ Faol"]})]})]})}),e.jsxs("button",{onClick:j,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl transition-all duration-200 text-sm font-semibold",style:{border:"1px solid rgba(239, 68, 68, 0.3)",color:"#fca5a5"},title:"Kassa tizimidan chiqish",children:[e.jsx(Pt,{className:"w-4 h-4"}),"Chiqish"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:ml-0 h-full",children:[e.jsxs("header",{className:"px-4 lg:px-6 h-14 lg:h-16 flex items-center justify-between flex-shrink-0",style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",borderBottom:"1px solid rgba(91, 33, 182, 0.1)",backdropFilter:"blur(20px)",boxShadow:"0 4px 20px -4px rgba(46, 16, 101, 0.08)"},children:[e.jsx("button",{onClick:()=>x(!0),className:"lg:hidden p-2.5 rounded-xl transition-colors",style:{background:"rgba(91, 33, 182, 0.08)",color:"#5b21b6"},children:e.jsx(Tt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg lg:text-xl font-bold",style:{color:"#2e1065"},children:f()}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium",style:{color:"#6b7280"},children:"Faol"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Ut,{})})]}),v==="idle"&&e.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0",style:{background:"rgba(250, 245, 255, 0.7)",backdropFilter:"blur(8px)"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:e.jsxs("div",{className:"mx-auto max-w-md flex gap-4",children:[e.jsx("button",{onClick:()=>k("arrived"),disabled:i!==null,className:"pointer-events-auto flex-1 px-6 py-4 rounded-2xl text-white font-bold shadow-lg disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 8px 24px -4px rgba(6, 182, 212, 0.4)"},children:i==="arrived"?"Yuborilmoqda...":"Keldim"}),e.jsx("button",{onClick:()=>k("left"),disabled:i!==null,className:"pointer-events-auto flex-1 px-6 py-4 rounded-2xl text-white font-bold shadow-lg disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",boxShadow:"0 8px 24px -4px rgba(220, 38, 38, 0.4)"},children:i==="left"?"Yuborilmoqda...":"Ketdim"})]})})]}),v==="arrived"&&e.jsxs("div",{className:"fixed bottom-4 right-4 z-40 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>k("arrived"),disabled:i!==null,className:"px-3 py-2 rounded-xl text-white text-sm font-semibold shadow-md disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 12px -2px rgba(6, 182, 212, 0.4)"},children:i==="arrived"?"...":"Keldim"}),e.jsx("button",{onClick:()=>k("left"),disabled:i!==null,className:"px-3 py-2 rounded-xl text-white text-sm font-semibold shadow-md disabled:opacity-60 transition-all",style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",boxShadow:"0 4px 12px -2px rgba(220, 38, 38, 0.4)"},children:i==="left"?"...":"Ketdim"})]}),P]})}const bn=({isOpen:a,onClose:o,item:n,customer:x,onSave:i})=>{const[g,v]=s.useState([]),[h,q]=s.useState(""),[P,w]=s.useState(""),[S,L]=s.useState(!1),[$,C]=s.useState(""),m=n.price*n.cartQuantity,y=n.paymentBreakdown||{cash:0,click:0,card:0,partner:0},k=y.cash+y.click+y.card+(y.partner||0),j=m-k;s.useEffect(()=>{a&&(f(),w(j.toString()))},[a,j]);const f=()=>Q(es,null,function*(){try{const Se=yield(yield fetch("/api/partners")).json();Se.success?v(Se.partners):C("Hamkorlar ro'yxatini yuklashda xatolik")}catch(K){console.error("Hamkorlar yuklash xatosi:",K),C("Tarmoq xatoligi")}}),R=K=>{const Se=Ge(K);(Se===""?0:parseFloat(Se)||0)>j?w(j.toString()):w(Se)},W=()=>Q(es,null,function*(){if(!h){C("Hamkorni tanlang");return}const K=parseFloat(P)||0;if(K<=0){C("To'lov summasi noto'g'ri");return}if(K>j){C("To'lov summasi qoldiq summadan ko'p bo'lishi mumkin emas");return}L(!0),C("");try{const je=yield(yield fetch("/api/partners/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({partner:h,amount:K,item:{name:n.name,code:n.code,price:n.price,quantity:n.cartQuantity},customer:x?{name:x.name,phone:x.phone}:null,receiptNumber:`CHK-${Date.now()}`})})).json();if(je.success){i(h,K),o();const Me=g.find(V=>V.id===h);alert(`âœ… ${Me==null?void 0:Me.name} orqali ${p(K)} so'm to'lov muvaffaqiyatli yuborildi!`)}else C(je.message||"To'lov yuborishda xatolik")}catch(Se){console.error("Hamkor to'lovi xatosi:",Se),C("Tarmoq xatoligi yuz berdi")}finally{L(!1)}}),J=K=>{switch(K){case"uzum":return e.jsx(hs,{className:"w-6 h-6"});case"ishonch":return e.jsx(Vs,{className:"w-6 h-6"});default:return e.jsx(st,{className:"w-6 h-6"})}},ue=K=>{switch(K){case"uzum":return"from-purple-500 to-purple-600";case"ishonch":return"from-amber-500 to-amber-600";default:return"from-blue-500 to-blue-600"}},de=K=>{switch(K){case"uzum":return"Muddatli to'lov";case"ishonch":return"Kredit tizimi";default:return""}};return a?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm -z-10",onClick:o}),e.jsxs("div",{className:"bg-white w-full sm:w-auto rounded-t-2xl sm:rounded-2xl shadow-2xl max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-gray-100 flex items-center justify-between p-4 sm:p-6 gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 truncate",children:"Hamkor to'lovi"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 truncate",children:n.name})]}),e.jsx("button",{onClick:o,className:"flex-shrink-0 w-10 h-10 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Umumiy summa:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[p(m)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"To'langan:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[p(k)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Qoldiq:"}),e.jsxs("span",{className:"font-bold text-blue-600",children:[p(j)," so'm"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Hamkorni tanlang"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:g.map(K=>e.jsx("button",{onClick:()=>q(K.id),className:`relative p-4 rounded-xl border-2 transition-all duration-200 ${h===K.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-r ${ue(K.id)} flex items-center justify-center text-white`,children:J(K.id)}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:K.name}),e.jsx("p",{className:"text-sm text-gray-500",children:de(K.id)})]}),h===K.id&&e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})},K.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To'lov summasi"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:P,onChange:K=>R(K.target.value),placeholder:"0",className:"w-full px-4 py-3 text-lg font-semibold border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:"so'm"})]}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("button",{onClick:()=>w((j/2).toString()),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Yarmini"}),e.jsx("button",{onClick:()=>w(j.toString()),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Hammasini"})]})]}),$&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:$})})]})}),e.jsxs("div",{className:"sticky bottom-0 z-10 bg-white/95 backdrop-blur-sm border-t border-gray-100 flex gap-3 p-4 sm:p-6",children:[e.jsx("button",{onClick:o,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:W,disabled:S||!h||!P,className:"flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-xl font-medium transition-colors",children:S?"Yuborilmoqda...":"Yuborish"})]})]})]}):null},gn=({item:a,selectedCustomer:o,onSave:n,onCancel:x})=>{var m,y,k;const[i,g]=s.useState(((m=a.paymentBreakdown)==null?void 0:m.cash)||0),[v,h]=s.useState(((y=a.paymentBreakdown)==null?void 0:y.click)||0),[q,P]=s.useState(((k=a.paymentBreakdown)==null?void 0:k.card)||0),w=a.price*a.cartQuantity,S=i+v+q,L=w-S,$=()=>{L<-1||n(i,v,q)},C=(j,f)=>{const R=Ge(j),W=R===""?0:parseFloat(R)||0,J=f==="cash"?v+q:f==="click"?i+q:i+v,ue=w-J,de=W>ue?ue:W;f==="cash"?g(de):f==="click"?h(de):P(de)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Naqd pul"}),e.jsx("input",{type:"text",value:us(i.toString()),onChange:j=>C(j.target.value,"cash"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-success-200 rounded-xl focus:outline-none focus:border-success-500 focus:ring-4 focus:ring-success-500/10 bg-success-50",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Click"}),e.jsx("input",{type:"text",value:us(v.toString()),onChange:j=>C(j.target.value,"click"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-purple-200 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-500/10 bg-purple-50",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Plastik karta"}),e.jsx("input",{type:"text",value:us(q.toString()),onChange:j=>C(j.target.value,"card"),className:"w-full px-4 py-3 text-lg font-semibold border-2 border-brand-200 rounded-xl focus:outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 bg-brand-50",placeholder:"0"})]})]}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Jami to'lov:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[p(S)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Tovar summasi:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[p(S)," so'm"]})]}),e.jsxs("div",{className:`flex justify-between text-sm font-semibold pt-2 border-t border-surface-200 ${L<=1&&L>=-1?"text-success-600":L>1?"text-warning-600":"text-danger-600"}`,children:[e.jsx("span",{children:"Qoldiq:"}),e.jsxs("span",{children:[p(w-S)," so'm"]})]}),L<-1&&e.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-lg p-2 mt-2",children:e.jsxs("p",{className:"text-xs text-warning-700",children:["âš ï¸ Ortiq pul kiritib bo'lmaydi. Maksimal: ",p(w)," so'm"]})}),L>1&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2 mt-2",children:e.jsxs("p",{className:"text-xs text-blue-700",children:["â„¹ï¸ ",p(L)," so'm qoldiq ",o?"qarz daftariga qo'shiladi va botga yuboriladi":"qarz bo'ladi (mijoz tanlanmagan)"]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:x,className:"flex-1 py-3 text-surface-600 hover:text-surface-900 transition-colors rounded-xl border border-surface-200 hover:bg-surface-50",children:"Bekor qilish"}),e.jsx("button",{onClick:$,disabled:L<-1,className:`flex-1 py-3 rounded-xl font-semibold transition-colors ${L<-1?"bg-surface-300 text-surface-500 cursor-not-allowed":"bg-brand-500 hover:bg-brand-600 text-white"}`,children:"Saqlash"})]})]})};function jn(){const{showAlert:a,AlertComponent:o}=Ps(),n=lt(),[x,i]=s.useState([]),[g,v]=s.useState([]),[h,q]=s.useState([]),[P,w]=s.useState(""),[S,L]=s.useState(!1),[$,C]=s.useState(!1),[m,y]=s.useState(""),[k,j]=s.useState([]),[f,R]=s.useState(null),[W,J]=s.useState(!1),[ue,de]=s.useState(""),[K,Se]=s.useState([]),[je,Me]=s.useState([]),[V,Ne]=s.useState(!1),[E,ce]=s.useState(!1),[be,Le]=s.useState({available:!1,printers:[],xPrinterFound:!1}),[O,_]=s.useState("kod"),[D,we]=s.useState(""),[Z,oe]=s.useState(null),[Ce,Qe]=s.useState(!1),[_e,Oe]=s.useState(null),[ts,He]=s.useState(!1),[u,ee]=s.useState(null),[Ie,qe]=s.useState(!1),[ne,Ze]=s.useState(null),[X,ve]=s.useState(15),[M,Te]=s.useState(0),[Re,Ue]=s.useState({cash:0,click:0,card:0}),Ye=(r,T)=>{const H=r.price;let Y=15;T>=100?Y=11:T>=10?Y=13:Y=15;const ae=H*(1+Y/100);return Math.round(ae)},Ss=(r,T)=>T!==void 0?{name:"Maxsus",markupPercent:T,discount:T<15,custom:!0}:r>=100?{name:"100+ dona",markupPercent:11,discount:!0,custom:!1}:r>=10?{name:"10-99 dona",markupPercent:13,discount:!0,custom:!1}:{name:"1-9 dona",markupPercent:15,discount:!1,custom:!1},I=r=>{Ze(r);const T=Ss(r.cartQuantity,r.customMarkup);ve(T.markupPercent),qe(!0)},he=()=>{if(!ne)return;const r=ne.costPrice||ne.price/1.15,T=Math.round(r*(1+X/100));q(H=>H.map(Y=>Y._id===ne._id?N(b({},Y),{price:T,customMarkup:X}):Y)),qe(!1),Ze(null),a(`Narx yangilandi: ${X}% qo'shimcha`,"Muvaffaqiyat","success")};s.useEffect(()=>{ze(),G(),as(),is();const r=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=r}},[]),s.useEffect(()=>{ze(),G()},[n.pathname]);const me=()=>Q(this,null,function*(){console.log("Refresh tugmasi bosildi"),ce(!0);try{console.log("Ma'lumotlar yangilanmoqda..."),yield Promise.all([ze(),G()]),console.log("Ma'lumotlar muvaffaqiyatli yangilandi"),a("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(r){console.error("Refresh xatosi:",r),a("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{ce(!1)}}),ze=()=>Q(this,null,function*(){try{const r=yield U.get("/products/kassa");i(r.data),console.log(`Kassa: ${r.data.length} ta tovar yuklandi`)}catch(r){console.error("Error fetching products:",r),a("Tovarlarni yuklashda xatolik","Xatolik","danger")}}),t=r=>Q(this,null,function*(){if(!r.trim()||r.length===0){Me([]),Ne(!1);return}const T=x.filter(H=>H.code.toLowerCase().includes(r.toLowerCase())).sort((H,Y)=>{const ae=H.code.toLowerCase().startsWith(r.toLowerCase()),fe=Y.code.toLowerCase().startsWith(r.toLowerCase());return ae&&!fe?-1:!ae&&fe?1:H.code.localeCompare(Y.code)});if(Me(T.slice(0,8)),Ne(!0),T.length<5&&r.length>=1)try{const ae=((yield U.get(`/products/kassa?search=${encodeURIComponent(r)}`)).data||[]).filter(re=>re.code.toLowerCase().includes(r.toLowerCase())).sort((re,pe)=>{const De=re.code.toLowerCase().startsWith(r.toLowerCase()),Ve=pe.code.toLowerCase().startsWith(r.toLowerCase());return De&&!Ve?-1:!De&&Ve?1:re.code.localeCompare(pe.code)}),fe=[...T];ae.forEach(re=>{fe.find(De=>De._id===re._id)||fe.push(re)}),Me(fe.slice(0,8)),i(re=>{const pe=[...re];return ae.forEach(De=>{pe.find(vs=>vs._id===De._id)||pe.push(De)}),pe})}catch(H){console.error("Error searching products by code:",H)}}),A=r=>Q(this,null,function*(){if(!r.trim())return null;try{const T=x.find(Y=>Y.code===r.trim());if(T)return T;const H=yield U.get(`/products/kassa?search=${encodeURIComponent(r.trim())}`);if(H.data&&H.data.length>0){const Y=H.data.find(ae=>ae.code===r.trim());if(Y)return i(ae=>ae.find(re=>re._id===Y._id)?ae:[...ae,Y]),Y}return null}catch(T){return console.error("Error searching product:",T),null}}),G=()=>Q(this,null,function*(){try{const r=yield U.get("/customers/kassa");v(r.data)}catch(r){console.error("Error fetching customers:",r)}}),se=r=>{de(r)},ss=g.filter(r=>r.name.toLowerCase().includes(ue.toLowerCase())||r.phone.includes(ue)),as=()=>{const r=localStorage.getItem("savedReceipts");r&&Se(JSON.parse(r))},is=()=>Q(this,null,function*(){try{const r=yield xn();Le(r),console.log("Printer holati:",r)}catch(r){console.error("Printer holatini tekshirishda xatolik:",r)}}),Je=h.reduce((r,T)=>r+T.price*T.cartQuantity,0),os=r=>{if(r==="C")O==="kod"?(w(""),Ne(!1),Me([])):(we("1"),Z&&h.find(H=>H._id===Z._id)&&q(H=>H.map(Y=>Y._id===Z._id?N(b({},Y),{cartQuantity:1}):Y)));else if(r==="âŒ«")if(O==="kod"){const T=P.slice(0,-1);w(T),T.length>0?t(T):(Ne(!1),Me([]))}else{const T=D.slice(0,-1),H=T===""||parseInt(T)===0?"1":T;if(we(H),Z){const Y=parseInt(H);Y>0&&Y<=Z.quantity&&h.find(fe=>fe._id===Z._id)&&q(fe=>fe.map(re=>re._id===Z._id?N(b({},re),{cartQuantity:Y}):re))}}else if(r==="+")if(O==="kod")bs(P);else if(Z&&D.trim()){const T=parseInt(D);if(!isNaN(T)&&T>0){if(T>Z.quantity){a(`${Z.name} uchun maksimal miqdor: ${Z.quantity} ta`,"Ogohlantirish","warning");return}h.find(Y=>Y._id===Z._id)?q(Y=>Y.map(ae=>ae._id===Z._id?N(b({},ae),{cartQuantity:T}):ae)):zs(Z,T),oe(null),we(""),_("kod")}}else Z||a("Mahsulot qo'shing","Ogohlantirish","warning");else if(O==="kod"){const T=P+r;w(T),t(T)}else if(Z&&(/^[\d]$/.test(r)||r==="00")){const T=D+r,H=parseInt(T);if(!isNaN(H)&&H>Z.quantity){a(`${Z.name} uchun maksimal miqdor: ${Z.quantity} ta`,"Ogohlantirish","warning");return}console.log("SON rejimida raqam kiritildi:",r,"Yangi qiymat:",T),we(T),!isNaN(H)&&H>0&&h.find(ae=>ae._id===Z._id)&&q(ae=>ae.map(fe=>fe._id===Z._id?N(b({},fe),{cartQuantity:H}):fe))}else Z||(_("kod"),a("Mahsulot qo'shing","Ogohlantirish","warning"))},bs=r=>Q(this,null,function*(){if(!r.trim())return;const T=yield A(r.trim());if(T){if(T.quantity===0){a(`"${T.name}" tugagan, savatchaga qo'shib bo'lmaydi`,"Ogohlantirish","warning");return}Es(T),w(""),Ne(!1),Me([])}else a(`Kod "${r}" bo'yicha tovar topilmadi`,"Xatolik","warning")}),Is=r=>{if(r.quantity===0){a(`"${r.name}" tugagan, savatchaga qo'shib bo'lmaydi`,"Ogohlantirish","warning");return}Es(r),w(""),Ne(!1),Me([])},Cs=r=>{oe(r),_("son"),we(r.cartQuantity.toString())},zs=(r,T)=>{q(H=>{const Y=H.find(fe=>fe._id===r._id);if(Y){const fe=Y.cartQuantity+T;if(fe>r.quantity)return a(`${r.name} uchun maksimal miqdor: ${r.quantity} ta`,"Ogohlantirish","warning"),H;const re=Ye(r,fe);return H.map(pe=>pe._id===r._id?N(b({},pe),{cartQuantity:fe,price:re}):pe)}const ae=Ye(r,T);return[...H,N(b({},r),{cartQuantity:T,price:ae})]}),C(!1),y("")},Es=r=>{q(T=>{const H=T.find(ae=>ae._id===r._id);if(H){const ae=H.cartQuantity+1;if(ae>r.quantity)return a(`${r.name} uchun maksimal miqdor: ${r.quantity} ta`,"Ogohlantirish","warning"),T;const fe=Ye(r,ae);return T.map(re=>re._id===r._id?N(b({},re),{cartQuantity:ae,price:fe}):re)}const Y=Ye(r,1);return[...T,N(b({},r),{cartQuantity:1,price:Y})]}),C(!1),y("")},Ts=r=>{q(T=>T.filter(H=>H._id!==r))},gs=r=>Q(this,null,function*(){if(y(r),r.length>0){const T=x.filter(H=>H.name.toLowerCase().includes(r.toLowerCase())||H.code.toLowerCase().includes(r.toLowerCase()));if(T.length<5&&r.length>2)try{const Y=(yield U.get(`/products/kassa?search=${encodeURIComponent(r)}`)).data||[],ae=[...T];Y.forEach(fe=>{ae.find(pe=>pe._id===fe._id)||ae.push(fe)}),j(ae),i(fe=>{const re=[...fe];return Y.forEach(pe=>{re.find(Ve=>Ve._id===pe._id)||re.push(pe)}),re})}catch(H){console.error("Error searching products:",H),j(T)}else j(T)}else j(x.slice(0,20))}),Ns=r=>{Oe(r),Qe(!0)},js=r=>{ee(r),He(!0)},d=(r,T,H)=>Q(this,null,function*(){if(!_e)return;const Y=_e.price*_e.cartQuantity,ae=r+T+H;if(ae>Y+1){a(`Ortiq pul kiritib bo'lmaydi. Maksimal: ${p(Y)} so'm, Kiritilgan: ${p(ae)} so'm`,"Xatolik","danger");return}const fe=Y-ae;if(fe>1&&f)try{console.log(`Tovar uchun qoldiq qarz yaratilmoqda: ${fe} so'm`);const re={customer:f._id,amount:fe,paidAmount:0,description:`${_e.name} uchun qoldiq to'lov - ${new Date().toLocaleDateString("uz-UZ")}`,items:[{product:_e._id,name:_e.name,code:_e.code,price:_e.price,quantity:_e.cartQuantity}]};yield U.post("/debts/kassa",re),console.log("âœ… Tovar uchun qoldiq qarz muvaffaqiyatli qo'shildi va botga yuborildi"),a(`${p(fe)} so'm qarz qo'shildi va botga yuborildi`,"Ma'lumot","info")}catch(re){console.error("âŒ Qarz yaratishda xatolik:",re),a("Qarz yaratishda xatolik yuz berdi","Ogohlantirish","warning")}q(re=>re.map(pe=>{var De;return pe._id===_e._id?N(b({},pe),{paymentBreakdown:{cash:r,click:T,card:H,partner:((De=pe.paymentBreakdown)==null?void 0:De.partner)||0}}):pe})),Qe(!1),Oe(null)}),te=()=>{if(h.length===0){a("Chek bo'sh","Ogohlantirish","warning");return}const r={id:Date.now().toString(),items:[...h],total:Je,savedAt:new Date().toLocaleString()},T=[...K,r];Se(T),localStorage.setItem("savedReceipts",JSON.stringify(T)),q([]),a("Chek saqlandi!","Muvaffaqiyat","success")};return e.jsxs("div",{className:"h-full flex flex-col lg:flex-row overflow-hidden",children:[o,e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0 order-2 lg:order-1",children:[e.jsxs("div",{className:"p-2 sm:p-3 lg:p-4 flex flex-col sm:flex-row sm:items-center justify-between gap-2 bg-white border-b border-surface-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-col xs:flex-row xs:items-center gap-2 xs:gap-3",children:[e.jsxs("span",{className:"text-xs sm:text-sm text-surface-600 font-medium",children:["JAMI: ",h.length," ta mahsulot"]}),e.jsxs("button",{onClick:me,disabled:E,className:"flex items-center gap-1 px-2 py-1 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50 text-xs w-fit",children:[e.jsx(Os,{className:`w-3 h-3 ${E?"animate-spin":""}`}),e.jsx("span",{className:"hidden xs:inline",children:E?"Yangilanmoqda...":"Yangilash"}),e.jsx("span",{className:"xs:hidden",children:E?"...":"â†»"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:f?e.jsxs("div",{className:"flex items-center gap-2 bg-brand-50 border border-brand-200 rounded-lg px-3 py-2",children:[e.jsx("div",{className:"w-6 h-6 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-brand-600",children:f.name.charAt(0)})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-brand-700",children:f.name}),e.jsx("span",{className:"text-xs text-brand-600",children:f.phone})]}),e.jsx("button",{onClick:()=>R(null),className:"ml-2 w-5 h-5 flex items-center justify-center rounded-full text-brand-500 hover:bg-brand-200 transition-colors",children:"Ã—"})]}):e.jsxs("button",{onClick:()=>J(!0),className:"flex items-center gap-2 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),e.jsx("span",{children:"Mijoz tanlash"})]})})]}),e.jsxs("div",{className:"flex-1 bg-white overflow-hidden flex flex-col min-h-0",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-2 px-3 sm:px-4 py-3 bg-surface-50 border-b border-surface-200 text-xs font-semibold text-surface-500 uppercase flex-shrink-0",children:[e.jsx("div",{className:"col-span-1",children:"Kod"}),e.jsx("div",{className:"col-span-4",children:"Mahsulot"}),e.jsx("div",{className:"col-span-2 text-center",children:"Soni"}),e.jsx("div",{className:"col-span-2 text-right",children:"Narx"}),e.jsx("div",{className:"col-span-2 text-right",children:"Summa"}),e.jsx("div",{className:"col-span-1 text-center",children:"Amallar"})]}),e.jsx("div",{className:"flex-1 overflow-auto min-h-0",children:h.length===0?V&&je.length>0?e.jsxs("div",{className:"p-2 sm:p-3 lg:p-4 h-full flex flex-col",children:[e.jsx("div",{className:"text-center mb-2 sm:mb-3 flex-shrink-0",children:e.jsxs("p",{className:"text-sm text-surface-500",children:['"',P,`" ni o'z ichiga olgan tovarlar`,je.length>4&&e.jsxs("span",{className:"block text-xs text-surface-400 mt-1",children:["Jami ",je.length," ta tovar"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-1 sm:space-y-2 min-h-0",children:je.map((r,T)=>e.jsxs("button",{onClick:()=>Is(r),disabled:r.quantity===0,className:`w-full flex items-center gap-2 sm:gap-3 p-2 sm:p-3 rounded-xl transition-colors text-left relative overflow-hidden ${r.quantity===0?"bg-red-50 border-2 border-red-200 cursor-not-allowed opacity-80":T<4?"bg-brand-50 hover:bg-brand-100 border border-brand-200":"bg-surface-50 hover:bg-surface-100 border border-transparent"}`,children:[r.quantity===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none bg-red-50 bg-opacity-90 rounded-xl",children:e.jsx("div",{className:"bg-red-500 text-white text-xs sm:text-sm font-bold px-2 sm:px-4 py-1 sm:py-2 rounded-full shadow-lg border-2 border-white transform rotate-12 animate-pulse",children:"TUGAGAN"})}),e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-xl flex items-center justify-center ${r.quantity===0?"bg-red-100":"bg-brand-100"}`,children:e.jsx(Ke,{className:`w-4 h-4 sm:w-5 sm:h-5 ${r.quantity===0?"text-red-600":"text-brand-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0 relative",children:[e.jsx("p",{className:`font-medium text-sm sm:text-base truncate ${r.quantity===0?"text-red-700 opacity-60":"text-surface-900"}`,children:r.name}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 text-xs sm:text-sm text-surface-500",children:[e.jsx("span",{className:`font-mono px-1.5 sm:px-2 py-0.5 rounded border text-xs ${r.quantity===0?"bg-red-100 border-red-300 text-red-700 opacity-60":"bg-white"}`,children:P&&r.code.toLowerCase().includes(P.toLowerCase())?e.jsx(e.Fragment,{children:r.code.split(new RegExp(`(${P})`,"gi")).map((H,Y)=>H.toLowerCase()===P.toLowerCase()?e.jsx("span",{className:"bg-yellow-200 text-yellow-800 font-bold",children:H},Y):e.jsx("span",{children:H},Y))}):r.code}),r.quantity!==void 0&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${r.quantity>10?"bg-success-100 text-success-700":r.quantity>0?"bg-warning-100 text-warning-700":"bg-danger-100 text-danger-700 font-bold animate-pulse"}`,children:r.quantity>0?`${r.quantity} ta`:"TUGAGAN"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`font-semibold text-sm sm:text-base ${r.quantity===0?"text-red-600 opacity-60":"text-brand-600"}`,children:p(r.price)}),e.jsx("p",{className:`text-xs ${r.quantity===0?"text-red-500":"text-surface-500"}`,children:r.quantity===0?"Mavjud emas":"so'm"})]})]},r._id))})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-surface-400 py-8 sm:py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ke,{className:"w-8 h-8 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 opacity-50"}),e.jsx("p",{className:"text-sm sm:text-base",children:"Savat bo'sh"}),P.length>0&&e.jsx("p",{className:"text-xs sm:text-sm mt-1 sm:mt-2",children:"Kod kiriting yoki qidiring"})]})}):e.jsx("div",{className:"divide-y divide-surface-100",children:h.map(r=>e.jsxs("div",{children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-2 px-4 py-3 items-center hover:bg-surface-50 transition-colors",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-mono text-surface-600",children:r.code})}),e.jsx("div",{className:"col-span-4",children:e.jsx("span",{className:"text-sm font-medium text-surface-900",children:r.name})}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("input",{type:"text",value:r.cartQuantity,onClick:()=>Cs(r),onChange:T=>{const H=T.target.value;if(H===""||/^\d+$/.test(H)){const Y=H===""?0:parseInt(H);if(Y>r.quantity){a(`${r.name} uchun maksimal miqdor: ${r.quantity} ta`,"Ogohlantirish","warning");return}const ae=Ye(r,Y);q(fe=>fe.map(re=>re._id===r._id?N(b({},re),{cartQuantity:Y,price:ae}):re))}},onBlur:()=>{(r.cartQuantity===0||!r.cartQuantity)&&Ts(r._id)},className:`w-16 h-9 text-center font-medium border rounded-xl focus:outline-none focus:ring-2 cursor-pointer ${r.cartQuantity>r.quantity?"border-danger-500 bg-danger-50 text-danger-700 focus:border-danger-500 focus:ring-danger-500/20":"border-surface-200 focus:border-brand-500 focus:ring-brand-500/20 hover:bg-surface-50"}`})}),e.jsx("div",{className:"col-span-2 text-right",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm text-surface-900",children:p(r.price)}),(()=>{const T=Ss(r.cartQuantity,r.customMarkup);return e.jsxs("div",{onClick:()=>I(r),className:`text-xs px-2 py-0.5 rounded-full inline-block cursor-pointer hover:opacity-80 transition-opacity ${T.custom?"bg-purple-100 text-purple-700":T.discount?"bg-success-100 text-success-700":"bg-surface-100 text-surface-600"}`,title:"Foizni o'zgartirish uchun bosing",children:[T.name," (",T.markupPercent,"%)"]})})()]})}),e.jsxs("div",{className:"col-span-2 text-right",children:[e.jsx("span",{className:"text-sm font-semibold text-surface-900",children:p(r.price*r.cartQuantity)}),r.paymentBreakdown&&e.jsxs("div",{className:"mt-1 text-xs text-surface-600 space-y-0.5",children:[r.paymentBreakdown.cash>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ds,{className:"w-3 h-3 text-green-600"}),p(r.paymentBreakdown.cash)]}),r.paymentBreakdown.click>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(st,{className:"w-3 h-3 text-purple-600"}),p(r.paymentBreakdown.click)]}),r.paymentBreakdown.card>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Vs,{className:"w-3 h-3 text-blue-600"}),p(r.paymentBreakdown.card)]}),r.paymentBreakdown.partner&&r.paymentBreakdown.partner>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(st,{className:"w-3 h-3 text-blue-600"}),p(r.paymentBreakdown.partner)]})]}),!r.paymentBreakdown&&e.jsx("button",{onClick:()=>Ns(r),className:"mt-1 inline-flex items-center px-2 py-1 text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-md transition-colors",children:"To'lov"})]}),e.jsxs("div",{className:"col-span-1 flex justify-center gap-1",children:[e.jsx("button",{onClick:()=>js(r),className:"w-7 h-7 flex items-center justify-center rounded-lg text-purple-500 hover:bg-purple-50 transition-colors",title:"Hamkor orqali to'lash",children:e.jsx(st,{className:"w-4 h-4"})}),r.paymentBreakdown&&e.jsx("button",{onClick:()=>Ns(r),className:"w-7 h-7 flex items-center justify-center rounded-lg text-brand-500 hover:bg-brand-50 transition-colors",title:"To'lov turini o'zgartirish",children:e.jsx(Vs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ts(r._id),className:"w-7 h-7 flex items-center justify-center rounded-lg text-danger-500 hover:bg-danger-50 transition-colors",children:e.jsx(_s,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"md:hidden p-4 hover:bg-surface-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-surface-900 mb-1",children:r.name}),e.jsxs("p",{className:"text-sm text-surface-500 font-mono",children:["Kod: ",r.code]})]}),e.jsx("button",{onClick:()=>Ts(r._id),className:"ml-3 w-8 h-8 flex items-center justify-center rounded-lg text-danger-500 hover:bg-danger-50 transition-colors",children:e.jsx(_s,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-surface-600",children:"Soni:"}),e.jsx("input",{type:"text",value:r.cartQuantity,onClick:()=>Cs(r),onChange:T=>{const H=T.target.value;if(H===""||/^\d+$/.test(H)){const Y=H===""?0:parseInt(H);if(Y>r.quantity){a(`${r.name} uchun maksimal miqdor: ${r.quantity} ta`,"Ogohlantirish","warning");return}const ae=Ye(r,Y);q(fe=>fe.map(re=>re._id===r._id?N(b({},re),{cartQuantity:Y,price:ae}):re))}},onBlur:()=>{(r.cartQuantity===0||!r.cartQuantity)&&Ts(r._id)},className:`w-16 h-8 text-center font-medium border rounded-lg focus:outline-none focus:ring-2 cursor-pointer ${r.cartQuantity>r.quantity?"border-danger-500 bg-danger-50 text-danger-700 focus:border-danger-500 focus:ring-danger-500/20":"border-surface-200 focus:border-brand-500 focus:ring-brand-500/20 hover:bg-surface-50"}`})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-surface-600",children:[p(r.price)," so'm"]}),(()=>{const T=Ss(r.cartQuantity,r.customMarkup);return e.jsxs("div",{onClick:()=>I(r),className:`text-xs px-2 py-0.5 rounded-full inline-block cursor-pointer hover:opacity-80 transition-opacity ${T.custom?"bg-purple-100 text-purple-700":T.discount?"bg-success-100 text-success-700":"bg-surface-100 text-surface-600"}`,title:"Foizni o'zgartirish uchun bosing",children:[T.name," (",T.markupPercent,"%)"]})})(),e.jsxs("p",{className:"font-semibold text-surface-900",children:[p(r.price*r.cartQuantity)," so'm"]})]}),r.paymentBreakdown&&e.jsxs("div",{className:"mt-1 text-xs text-surface-600 space-y-0.5",children:[r.paymentBreakdown.cash>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ds,{className:"w-3 h-3 text-green-600"}),p(r.paymentBreakdown.cash)]}),r.paymentBreakdown.click>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(st,{className:"w-3 h-3 text-purple-600"}),p(r.paymentBreakdown.click)]}),r.paymentBreakdown.card>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Vs,{className:"w-3 h-3 text-blue-600"}),p(r.paymentBreakdown.card)]}),r.paymentBreakdown.partner&&r.paymentBreakdown.partner>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(st,{className:"w-3 h-3 text-blue-600"}),p(r.paymentBreakdown.partner)]})]}),!r.paymentBreakdown&&e.jsx("button",{onClick:()=>Ns(r),className:"mt-1 inline-flex items-center px-2 py-1 text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-md transition-colors",children:"To'lov"})]})]})]})]},r._id))})})]}),V&&je.length>0&&h.length>0&&e.jsxs("div",{className:"mt-4 bg-white border border-surface-200 rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-surface-100 bg-surface-50",children:e.jsxs("p",{className:"text-sm text-surface-600 text-center",children:['"',P,`" ni o'z ichiga olgan tovarlar (`,je.length," ta)"]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:je.map(r=>e.jsxs("button",{onClick:()=>Is(r),disabled:r.quantity===0,className:`w-full flex items-center gap-3 p-3 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0 relative ${r.quantity===0?"opacity-60 cursor-not-allowed":""}`,children:[r.quantity===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none bg-red-50 bg-opacity-80 rounded",children:e.jsx("span",{className:"bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg",children:"TUGAGAN"})}),e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 ${r.quantity===0?"bg-red-100":"bg-brand-100"}`,children:e.jsx(Ke,{className:`w-5 h-5 ${r.quantity===0?"text-red-600":"text-brand-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium text-base truncate ${r.quantity===0?"text-red-700":"text-surface-900"}`,children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm mt-1",children:[e.jsx("span",{className:`font-mono px-2 py-1 rounded border ${r.quantity===0?"bg-red-100 border-red-300 text-red-700":"bg-white border-surface-200"}`,children:P&&r.code.toLowerCase().includes(P.toLowerCase())?e.jsx(e.Fragment,{children:r.code.split(new RegExp(`(${P})`,"gi")).map((T,H)=>T.toLowerCase()===P.toLowerCase()?e.jsx("span",{className:"bg-yellow-200 text-yellow-800 font-bold",children:T},H):e.jsx("span",{children:T},H))}):r.code}),r.quantity!==void 0&&e.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${r.quantity>10?"bg-success-100 text-success-700":r.quantity>0?"bg-warning-100 text-warning-700":"bg-danger-100 text-danger-700"}`,children:r.quantity>0?`${r.quantity} ta`:"TUGAGAN"})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:`font-semibold text-lg ${r.quantity===0?"text-red-600":"text-brand-600"}`,children:p(r.price)}),e.jsx("p",{className:`text-sm ${r.quantity===0?"text-red-500":"text-surface-500"}`,children:"so'm"})]})]},r._id))})]}),e.jsx("div",{className:"p-2 sm:p-3 lg:p-4 bg-white border-t border-surface-200 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>{C(!0),gs("")},className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-white border border-surface-200 rounded-lg text-surface-700 hover:bg-surface-50 transition-colors flex-1 min-w-[100px]",children:[e.jsx(fs,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"Qidirish"})]}),e.jsxs("button",{onClick:te,className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-white border border-surface-200 rounded-lg text-surface-700 hover:bg-surface-50 transition-colors flex-1 min-w-[100px]",children:[e.jsx(It,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"Saqlash"})]}),h.length>0&&e.jsxs("button",{onClick:()=>{const r=h.reduce((fe,re)=>{var pe;return fe+(((pe=re.paymentBreakdown)==null?void 0:pe.cash)||0)},0),T=h.reduce((fe,re)=>{var pe;return fe+(((pe=re.paymentBreakdown)==null?void 0:pe.click)||0)},0),H=h.reduce((fe,re)=>{var pe;return fe+(((pe=re.paymentBreakdown)==null?void 0:pe.card)||0)},0),Y=h.reduce((fe,re)=>{var pe;return fe+(((pe=re.paymentBreakdown)==null?void 0:pe.partner)||0)},0),ae=r+T+H+Y;Ue({cash:r,click:T,card:H}),Te(ae),L(!0)},className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-success-500 text-white rounded-lg hover:bg-success-600 transition-colors flex-1 min-w-[100px] font-semibold",children:[e.jsx(Sa,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline sm:inline",children:"To'lov"})]})]})})]}),e.jsxs("div",{className:"w-full lg:w-72 xl:w-80 bg-white border-t lg:border-t-0 lg:border-l border-surface-200 p-2 sm:p-3 lg:p-4 flex flex-col flex-shrink-0",children:[e.jsx("div",{className:"text-center xl:text-right mb-3 sm:mb-4",children:e.jsxs("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-surface-900",children:[p(Je)," so'm"]})}),e.jsx("div",{className:"text-center mb-2 bg-surface-50 rounded-lg py-3 px-4 min-h-[60px] flex flex-col items-center justify-center",children:O==="kod"?P?e.jsxs("div",{className:"text-lg font-mono text-surface-900",children:["Kod: ",e.jsx("span",{className:"font-bold text-brand-600",children:P})]}):e.jsx("div",{className:"text-sm text-surface-500",children:"Mahsulot kodini kiriting"}):e.jsxs("div",{className:"text-center w-full",children:[Z&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-sm font-medium text-surface-700",children:Z.name}),e.jsxs("div",{className:"text-xs text-surface-500",children:["Mavjud: ",Z.quantity," ta"]})]}),e.jsx("div",{className:"text-xs text-surface-500 mb-1 uppercase tracking-wider",children:"SONI"}),D?e.jsx("div",{className:`text-3xl font-bold rounded-lg py-2 px-4 border-2 inline-block min-w-[80px] ${Z&&parseInt(D)>Z.quantity?"bg-red-50 border-red-500 text-red-700 animate-pulse":"bg-white border-gray-200 text-gray-800"}`,children:D}):e.jsx("div",{className:"text-lg text-surface-400 bg-white rounded-lg py-2 px-4 border-2 border-dashed border-gray-300 inline-block min-w-[80px]",children:Z?"0":"â€”"})]})}),e.jsxs("div",{className:"relative mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex mb-2 sm:mb-3 bg-surface-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>{_("kod"),we("")},className:`flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all ${O==="kod"?"bg-blue-500 text-white shadow-sm":"text-surface-600 hover:text-surface-900"}`,children:"KOD"}),e.jsx("button",{onClick:()=>{_("son"),w(""),Ne(!1),Me([])},className:`flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all ${O==="son"?"bg-gray-500 text-white shadow-sm":"text-surface-600 hover:text-surface-900"}`,children:"SON"})]}),O==="kod"?e.jsx("input",{type:"text",value:P,onChange:r=>{const T=r.target.value;w(T),T.length>0?t(T):(Ne(!1),Me([]))},onKeyDown:r=>{r.key==="Enter"?(r.preventDefault(),bs(P)):r.key==="Escape"&&(Ne(!1),Me([]))},onFocus:()=>{P.length>0&&t(P)},placeholder:"Kod kiriting...",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-center text-sm sm:text-base font-mono bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"}):e.jsx("input",{type:"text",value:D,onChange:r=>{const T=r.target.value;/^\d*$/.test(T)&&we(T)},onKeyDown:r=>{if(r.key==="Enter"&&(r.preventDefault(),Z&&D.trim())){const T=parseInt(D);if(!isNaN(T)&&T>0){if(T>Z.quantity){a(`${Z.name} uchun maksimal miqdor: ${Z.quantity} ta`,"Ogohlantirish","warning");return}zs(Z,T),oe(null),we(""),_("kod"),a(`${Z.name} (${T} ta) savatchaga qo'shildi`,"Muvaffaqiyat","success")}}},placeholder:"1",disabled:!Z,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-center text-lg sm:text-xl font-bold rounded-lg focus:outline-none focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed ${Z&&D&&parseInt(D)>Z.quantity?"bg-red-50 border-2 border-red-500 text-red-700 focus:border-red-500 focus:ring-red-500/20":"bg-surface-50 border border-surface-200 focus:border-gray-500 focus:ring-gray-500/20"}`})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1 sm:gap-2 mb-3",children:["7","8","9","C","4","5","6","âŒ«","1","2","3","+","0","00","."].map(r=>e.jsx("button",{onClick:()=>os(r),className:`
                flex items-center justify-center rounded-lg text-base sm:text-lg font-semibold transition-all active:scale-95
                ${r==="C"?"bg-red-500 text-white hover:bg-red-600":""}
                ${r==="âŒ«"?"bg-orange-500 text-white hover:bg-orange-600":""}
                ${r==="+"?`${O==="kod"?"bg-green-500 hover:bg-green-600":"bg-blue-500 hover:bg-blue-600"} text-white row-span-2`:""}
                ${["C","âŒ«","+"].includes(r)?"":"bg-surface-100 text-surface-700 hover:bg-surface-200"}
                ${r==="+"?"h-full":"h-10 sm:h-12 lg:h-14"}
              `,children:r==="âŒ«"?e.jsx(dr,{className:"w-4 h-4 sm:w-5 sm:h-5"}):r==="+"?O==="kod"?"+":"âœ“":r},r))})]}),$&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-4 sm:pt-20 px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>C(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl relative z-10 overflow-hidden max-h-[90vh] sm:max-h-none",children:[e.jsxs("div",{className:"p-4 border-b border-surface-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Mahsulot qidirish"}),e.jsx("button",{onClick:()=>C(!1),className:"w-7 h-7 flex items-center justify-center rounded-lg text-surface-400 hover:bg-surface-100 transition-colors",title:"Yopish"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Nom yoki kod bo'yicha qidiring...",value:m,onChange:r=>gs(r.target.value),className:"w-full pl-12 pr-4 py-3 bg-surface-50 border border-surface-200 rounded-xl focus:outline-none focus:border-brand-500",autoFocus:!0})]})]}),e.jsxs("div",{className:"max-h-80 sm:max-h-96 overflow-auto",children:[k.map(r=>e.jsxs("button",{onClick:()=>Es(r),className:"w-full flex items-center gap-3 p-4 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(Ke,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500",children:[e.jsxs("span",{children:["Kod: ",r.code]}),r.quantity!==void 0&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${r.quantity>10?"bg-success-100 text-success-700":r.quantity>0?"bg-warning-100 text-warning-700":"bg-danger-100 text-danger-700"}`,children:r.quantity>0?`${r.quantity} ta`:"Tugagan"})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsx("p",{className:"font-semibold text-brand-600",children:p(r.price)})})]},r._id)),m&&k.length===0&&e.jsx("p",{className:"text-center text-surface-500 py-8",children:"Tovar topilmadi"})]})]})]}),W&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-4 sm:pt-20 px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>J(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl relative z-10 overflow-hidden max-h-[90vh] sm:max-h-none",children:[e.jsxs("div",{className:"p-4 border-b border-surface-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Mijoz tanlash"}),e.jsx("button",{onClick:()=>J(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:bg-surface-100 transition-colors",children:"Ã—"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz ismi yoki telefon raqami...",value:ue,onChange:r=>se(r.target.value),className:"w-full pl-12 pr-4 py-3 bg-surface-50 border border-surface-200 rounded-xl focus:outline-none focus:border-brand-500",autoFocus:!0})]})]}),e.jsx("div",{className:"max-h-80 sm:max-h-96 overflow-auto",children:ss.length>0?ss.map(r=>e.jsxs("button",{onClick:()=>{R(r),J(!1),de("")},className:"w-full flex items-center gap-3 p-4 hover:bg-surface-50 transition-colors text-left border-b border-surface-50 last:border-0",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:r.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-surface-500",children:[e.jsx("span",{children:r.phone}),r.debt>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 rounded text-xs font-medium",children:[p(r.debt)," so'm qarz"]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"text-sm text-surface-600",children:[p(r.totalPurchases)," so'm"]}),e.jsx("p",{className:"text-xs text-surface-400",children:"jami xarid"})]})]},r._id)):e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-surface-500",children:ue?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"})})})]})]}),S&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>L(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"To'lov turlarini tanlang"}),f&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-brand-600",children:f.name.charAt(0)})}),e.jsx("span",{className:"text-sm text-surface-600 truncate",children:f.name})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Jami summa:"}),e.jsxs("p",{className:"text-2xl sm:text-3xl font-bold text-surface-900 mb-3",children:[p(Je)," so'm"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(ds,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Naqd pul:"})]}),e.jsxs("span",{className:"font-semibold",children:[p(Re.cash)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(st,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Click:"})]}),e.jsxs("span",{className:"font-semibold",children:[p(Re.click)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-600",children:[e.jsx(Vs,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Plastik karta:"})]}),e.jsxs("span",{className:"font-semibold",children:[p(Re.card)," so'm"]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-2 flex justify-between",children:[e.jsx("span",{className:"text-surface-600",children:"Jami to'lov:"}),e.jsxs("span",{className:"font-bold text-lg",children:[p(M)," so'm"]})]}),M<Je&&e.jsxs("div",{className:"flex justify-between text-warning-600",children:[e.jsx("span",{children:"Qoldiq:"}),e.jsxs("span",{className:"font-bold",children:[p(Je-M)," so'm"]})]}),M>Je&&e.jsxs("div",{className:"flex justify-between text-success-600",children:[e.jsx("span",{children:"Qaytim:"}),e.jsxs("span",{className:"font-bold",children:[p(M-Je)," so'm"]})]})]})]}),M<Je&&e.jsx("div",{className:`border rounded-lg p-3 mb-4 ${f?"bg-blue-50 border-blue-200":"bg-warning-50 border-warning-200"}`,children:e.jsx("p",{className:`text-sm ${f?"text-blue-700":"text-warning-700"}`,children:f?e.jsxs(e.Fragment,{children:["â„¹ï¸ ",p(Je-M)," so'm qarz daftariga qo'shiladi"]}):e.jsxs(e.Fragment,{children:["âš ï¸ ",p(Je-M)," so'm qoldiq - mijoz tanlanmagan"]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs",children:[e.jsx(nt,{className:`w-3 h-3 ${be.xPrinterFound?"text-green-600":be.available?"text-yellow-600":"text-red-600"}`}),e.jsx("span",{className:be.xPrinterFound?"text-green-600":be.available?"text-yellow-600":"text-red-600",children:be.xPrinterFound?"X Printer tayyor":be.available?`Printer mavjud (${be.printers.length} ta)`:"Printer topilmadi"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>Q(this,null,function*(){var r,T;if(h.length===0){a("Savat bo'sh","Ogohlantirish","warning");return}try{console.log("Chek chiqarish uchun tovar miqdorlarini kamaytirish boshlandi...");const H=[];for(const re of h)try{console.log(`${re.name} uchun miqdorni kamaytirish: ${re.cartQuantity} ta`),yield U.put(`/products/${re._id}/reduce-quantity`,{quantity:re.cartQuantity}),console.log(`âœ… ${re.name} muvaffaqiyatli yangilandi`),H.push({success:!0,item:re.name})}catch(pe){console.error(`âŒ ${re.name} miqdorini kamaytirish xatosi:`,pe);const De=((T=(r=pe.response)==null?void 0:r.data)==null?void 0:T.message)||"Noma'lum xatolik";H.push({success:!1,item:re.name,error:De})}console.log("Tovar miqdorlarini yangilash tugadi. Natijalar:",H);const Y=`HELPER-${Date.now()}`,ae={items:h,total:Je,paymentMethod:"cash",customer:f,receiptNumber:Y,cashier:"Kassir",date:new Date};try{console.log("Telegram botga chek ma'lumotlarini yuborish...");const re={items:h.map(De=>({product:De._id,name:De.name,code:De.code,price:De.price,quantity:De.cartQuantity,paymentBreakdown:De.paymentBreakdown||{cash:0,click:0,card:0}})),total:Je,paymentMethod:"cash",customer:(f==null?void 0:f._id)||null,receiptNumber:Y,paidAmount:M,remainingAmount:Je-M},pe=yield U.post("/receipts/kassa",re);console.log("âœ… Chek ma'lumotlari serverga yuborildi:",pe.data)}catch(re){console.error("âŒ Telegram xabar yuborishda xatolik:",re)}if(!(yield Oa(ae,()=>{const re=H.filter(Ve=>Ve.success).length,pe=H.filter(Ve=>!Ve.success).length;let De="Chek muvaffaqiyatli chiqarildi va telegram botga yuborildi";pe===0?a(De+", tovar miqdorlari yangilandi!","Muvaffaqiyat","success"):a(`${De}. ${re} ta tovar yangilandi, ${pe} ta xatolik`,"Ogohlantirish","warning"),q([]),R(null),L(!1),ze()}))){const re=H.filter(Ve=>Ve.success).length,pe=H.filter(Ve=>!Ve.success).length;let De="Chek faylga yuklandi va telegram botga yuborildi";pe===0?a(De+", tovar miqdorlari yangilandi!","Ma'lumot","info"):a(`${De}. ${re} ta tovar yangilandi, ${pe} ta xatolik`,"Ogohlantirish","warning"),q([]),R(null),L(!1),ze()}}catch(H){console.error("Chek chiqarish xatosi:",H),a("Chek chiqarishda xatolik yuz berdi","Xatolik","danger")}}),className:"w-full flex items-center justify-center gap-2 py-3 sm:py-4 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-semibold transition-colors",children:[e.jsx(nt,{className:"w-5 h-5"}),"Chek chiqarish (to'lovsiz)"]}),M<Je&&!f&&e.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-lg p-3",children:e.jsx("p",{className:"text-xs text-warning-700 text-center",children:"ðŸ’¡ Qoldiq summa uchun mijoz tanlashingiz mumkin yoki oddiy mijoz sifatida saqlashingiz mumkin"})}),e.jsx("button",{onClick:()=>L(!1),className:"w-full py-3 text-surface-600 hover:text-surface-900 transition-colors",children:"Bekor qilish"})]})]})]}),Ce&&_e&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{Qe(!1),Oe(null)}}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"To'lov turlarini tanlang"}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-1",children:_e.name}),e.jsxs("p",{className:"text-xs text-surface-500 font-mono mb-2",children:["Kod: ",_e.code]}),e.jsxs("p",{className:"text-lg font-bold text-surface-900",children:["Jami: ",p(_e.price*_e.cartQuantity)," so'm"]})]})]}),e.jsx(gn,{item:_e,selectedCustomer:f,onSave:d,onCancel:()=>{Qe(!1),Oe(null)}})]})]}),ts&&u&&e.jsx(bn,{isOpen:ts,onClose:()=>{He(!1),ee(null)},item:u,customer:f,onSave:(r,T)=>{q(H=>H.map(Y=>{if(Y._id!==u._id)return Y;const ae=Y.paymentBreakdown||{cash:0,click:0,card:0,partner:0};return N(b({},Y),{paymentBreakdown:N(b({},ae),{partner:(ae.partner||0)+T})})}))}}),Ie&&ne&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{qe(!1),Ze(null)}}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-4 sm:p-6 shadow-2xl relative z-10",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-surface-900 mb-2",children:"Foizni o'zgartirish"}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-surface-700 mb-1",children:ne.name}),e.jsxs("p",{className:"text-xs text-surface-500 font-mono mb-2",children:["Kod: ",ne.code]}),e.jsxs("p",{className:"text-sm text-surface-600",children:["Miqdor: ",ne.cartQuantity," ta"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Qo'shimcha foiz (%)"}),e.jsx("input",{type:"number",value:X,onChange:r=>ve(Number(r.target.value)||0),min:"0",max:"100",step:"0.1",className:"w-full px-3 py-2 border border-surface-200 rounded-lg text-center text-lg font-semibold focus:ring-2 focus:ring-brand-500 focus:border-transparent",placeholder:"15"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[5,10,15,20].map(r=>e.jsxs("button",{onClick:()=>ve(r),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${X===r?"bg-brand-500 text-white":"bg-surface-100 text-surface-700 hover:bg-surface-200"}`,children:[r,"%"]},r))}),ne&&e.jsxs("div",{className:"bg-brand-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[e.jsx("span",{className:"text-surface-600",children:"Yangi narx (1 ta):"}),e.jsxs("span",{className:"font-semibold text-brand-600",children:[p(Math.round((ne.costPrice||ne.price/1.15)*(1+X/100)))," so'm"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Jami summa:"}),e.jsxs("span",{className:"font-bold text-brand-700",children:[p(Math.round((ne.costPrice||ne.price/1.15)*(1+X/100))*ne.cartQuantity)," so'm"]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{qe(!1),Ze(null)},className:"flex-1 py-3 px-4 bg-surface-100 text-surface-700 rounded-xl font-medium hover:bg-surface-200 transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:he,className:"flex-1 py-3 px-4 bg-brand-500 text-white rounded-xl font-medium hover:bg-brand-600 transition-colors",children:"Saqlash"})]})]})]})]})}function vn(){const a=Ia(),[o,n]=s.useState([]),[x,i]=s.useState(!0),[g,v]=s.useState(null),[h,q]=s.useState(!1),[P,w]=s.useState({}),{showAlert:S,AlertComponent:L}=Ps();s.useEffect(()=>{$()},[]),s.useEffect(()=>{if(a)return a.on("receipt:created",y=>Q(this,null,function*(){console.log("ðŸ“¡ Kassa Receipts Socket: Yangi chek keldi",y);try{const j=(yield U.get(`/receipts/${y._id}`)).data;n(f=>[j,...f]),S("Yangi chek keldi!","Yangilik","success")}catch(k){console.error("Chek ma'lumotlarini olishda xatolik:",k),$()}})),()=>{a.off("receipt:created")}},[a]);const $=()=>Q(this,null,function*(){var y,k;try{i(!0),console.log("Fetching receipts from /receipts/kassa...");const j=yield U.get("/receipts/kassa");console.log("Receipts response:",j.data),console.log("Total receipts:",j.data.length),n(j.data)}catch(j){console.error("Cheklar yuklashda xatolik:",j),console.error("Error response:",j.response),S(((k=(y=j.response)==null?void 0:y.data)==null?void 0:k.message)||"Cheklar yuklashda xatolik","Xatolik","danger")}finally{i(!1)}}),C=y=>{const k=window.open("","_blank","width=600,height=800");if(!k){S("Popup bloklangan. Iltimos, popup ga ruxsat bering.","Ogohlantirish","warning");return}const j=y.items.map((f,R)=>`
      <tr>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: center; font-size: 14px;">${R+1}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; font-size: 14px;">${f.product.name}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: center; font-size: 14px;">${f.quantity}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: right; font-size: 14px;">${p(f.price)}</td>
        <td style="padding: 8px 4px; border-bottom: 1px dashed #ddd; text-align: right; font-weight: bold; font-size: 14px;">${p(f.price*f.quantity)}</td>
      </tr>
    `).join("");k.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Chek #${y.receiptNumber}</title>
        <style>
          @page { size: 80mm auto; margin: 0; }
          @media print {
            body { width: 80mm; margin: 0; }
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body { 
            font-family: 'Courier New', monospace;
            width: 80mm;
            padding: 10mm 5mm;
            background: white;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
          }
          .header { 
            text-align: center; 
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px dashed #000;
          }
          .header h1 { 
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
          }
          .header .subtitle { 
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
          }
          .header .receipt-number { 
            font-size: 14px;
            font-weight: bold;
            margin-top: 8px;
          }
          table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 15px 0;
          }
          th { 
            padding: 8px 4px;
            text-align: left; 
            border-bottom: 2px solid #000;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
          }
          th.center { text-align: center; }
          th.right { text-align: right; }
          .total-section { 
            margin-top: 15px;
            padding-top: 10px;
            border-top: 2px dashed #000;
          }
          .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
          }
          .total-label {
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
          }
          .total-amount {
            font-size: 20px;
            font-weight: bold;
          }
          .footer { 
            margin-top: 20px;
            padding-top: 15px;
            text-align: center;
            border-top: 2px dashed #000;
          }
          .footer p {
            font-size: 11px;
            color: #666;
            margin: 3px 0;
          }
          .thank-you {
            font-size: 13px;
            font-weight: bold;
            margin-top: 10px;
          }
        </style>
      </head>
      <body>
        <div class="header">
          <!-- Logo -->
          <div style="margin-bottom: 8px;">
            <img src="/o5sk1awh.png" alt="Logo" style="width: 40px; height: 40px; display: block; margin: 0 auto; border-radius: 6px;" />
          </div>
          <h1>SARDOR FURNITURA</h1>
          <div class="subtitle">Mebel furniturasi</div>
          <div class="receipt-number">Chek #${y.receiptNumber}</div>
        </div>

        <table>
          <thead>
            <tr>
              <th style="width: 25px;" class="center">â„–</th>
              <th>Mahsulot</th>
              <th style="width: 35px;" class="center">Soni</th>
              <th style="width: 60px;" class="right">Narxi</th>
              <th style="width: 70px;" class="right">Jami</th>
            </tr>
          </thead>
          <tbody>
            ${j}
          </tbody>
        </table>

        <div class="total-section">
          <div class="total-row">
            <span class="total-label">JAMI:</span>
            <span class="total-amount">${p(y.totalAmount)} so'm</span>
          </div>
        </div>

        <div class="footer">
          <p class="thank-you">Xaridingiz uchun rahmat!</p>
          <p>Sardor Furnitura - Sifatli mebel furniturasi</p>
        </div>
      </body>
      </html>
    `),k.document.close(),k.print()},m=y=>{v(y),q(!0)};return x?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-brand-500 border-t-transparent"})}):e.jsxs("div",{className:"min-h-screen bg-surface-50 p-2 sm:p-4 pb-20",children:[L,e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-3 sm:p-4 mb-3 sm:mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(Zs,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-base sm:text-xl font-bold text-surface-900 truncate",children:"Cheklar"}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Hodimlar cheklari"})]})]}),e.jsxs("button",{onClick:$,className:"btn-secondary flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-2 text-sm flex-shrink-0",children:[e.jsx(Os,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangilash"})]})]})}),o.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-8 sm:p-12 text-center",children:[e.jsx(Zs,{className:"w-12 h-12 sm:w-16 sm:h-16 text-surface-300 mx-auto mb-3 sm:mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-surface-900 mb-2",children:"Cheklar yo'q"}),e.jsx("p",{className:"text-sm sm:text-base text-surface-500",children:"Hali hech qanday chek yaratilmagan"})]}):e.jsx("div",{className:"max-h-[calc(100vh-180px)] overflow-y-auto",children:e.jsx("div",{className:"grid gap-3 sm:gap-4 pr-1",children:o.map(y=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-3 sm:p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-brand-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Zs,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"font-bold text-sm sm:text-base text-surface-900 truncate",children:["Chek #",y.receiptNumber]}),e.jsx("p",{className:"text-xs text-surface-500",children:new Date(y.createdAt).toLocaleString("uz-UZ",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(ms,{className:"w-3 h-3 sm:w-4 sm:h-4 text-surface-400 flex-shrink-0"}),e.jsx("span",{className:"text-surface-600",children:"Sotuvchi:"}),e.jsx("span",{className:"font-medium text-surface-900 truncate",children:y.createdBy.name})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(Ke,{className:"w-3 h-3 sm:w-4 sm:h-4 text-surface-400 flex-shrink-0"}),e.jsx("span",{className:"text-surface-600",children:"Mahsulotlar:"}),e.jsxs("span",{className:"font-medium text-surface-900",children:[y.items.length," ta"]})]}),y.customer&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(ms,{className:"w-3 h-3 sm:w-4 sm:h-4 text-surface-400 flex-shrink-0"}),e.jsx("span",{className:"text-surface-600",children:"Mijoz:"}),e.jsx("span",{className:"font-medium text-surface-900 truncate",children:y.customer.name})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Tel:"}),e.jsx("span",{className:"font-medium text-surface-900",children:y.customer.phone})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 sm:p-3 bg-brand-50 rounded-lg mb-3",children:[e.jsx(ds,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600 flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm text-surface-600",children:"Jami:"}),e.jsxs("span",{className:"text-base sm:text-lg font-bold text-brand-700",children:[p(y.totalAmount)," so'm"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>m(y),className:"flex-1 flex items-center justify-center gap-1 sm:gap-2 p-2 bg-blue-50 hover:bg-blue-100 text-blue-600 rounded-lg transition-colors text-xs sm:text-sm",children:[e.jsx(Gs,{className:"w-4 h-4"}),e.jsx("span",{children:"Ko'rish"})]}),e.jsxs("button",{onClick:()=>C(y),className:"flex-1 flex items-center justify-center gap-1 sm:gap-2 p-2 bg-green-50 hover:bg-green-100 text-green-600 rounded-lg transition-colors text-xs sm:text-sm",children:[e.jsx(nt,{className:"w-4 h-4"}),e.jsx("span",{children:"Print"})]})]})]},y._id))})}),h&&g&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-2 sm:p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-white border-b border-surface-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-base sm:text-xl font-bold text-surface-900",children:["Chek #",g.receiptNumber]}),e.jsx("button",{onClick:()=>q(!1),className:"p-2 hover:bg-surface-100 rounded-lg transition-colors",children:"âœ•"})]})}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3 mb-4 sm:mb-6",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-surface-900 mb-2 sm:mb-3",children:"Mahsulotlar:"}),g.items.map((y,k)=>{var W;const j=y.product.images&&y.product.images.length>0,f=P[k]||!1,R=f?y.product.images:(W=y.product.images)==null?void 0:W.slice(0,1);return e.jsx("div",{className:"p-2 sm:p-3 bg-surface-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[j&&e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"space-y-1",children:[R==null?void 0:R.map((J,ue)=>e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-lg overflow-hidden bg-surface-100 border border-surface-200",children:e.jsx("img",{src:`${Ls}${J.path}`,alt:y.product.name,className:"w-full h-full object-cover",onError:de=>{de.currentTarget.src="/o5sk1awh.png"}})},ue)),y.product.images&&y.product.images.length>1&&e.jsx("button",{onClick:()=>w(J=>N(b({},J),{[k]:!f})),className:"w-full flex items-center justify-center gap-1 py-1 text-xs text-brand-600 hover:text-brand-700 font-medium",children:f?e.jsxs(e.Fragment,{children:[e.jsx(ma,{className:"w-3 h-3"}),e.jsx("span",{children:"Yashirish"})]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-3 h-3"}),e.jsxs("span",{children:["+",y.product.images.length-1," rasm"]})]})})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm sm:text-base text-surface-900 break-words",children:y.product.name}),e.jsxs("p",{className:"text-xs sm:text-sm text-surface-500",children:["Kod: ",y.product.code]}),e.jsxs("div",{className:"mt-2 text-right",children:[e.jsxs("p",{className:"font-semibold text-xs sm:text-sm text-surface-900",children:[y.quantity," x ",p(y.price)]}),e.jsxs("p",{className:"text-xs sm:text-sm text-brand-600 font-bold",children:[p(y.quantity*y.price)," so'm"]})]})]})]})},k)})]}),e.jsx("div",{className:"border-t border-surface-200 pt-3 sm:pt-4",children:e.jsxs("div",{className:"flex items-center justify-between text-base sm:text-lg font-bold",children:[e.jsx("span",{className:"text-surface-900",children:"JAMI:"}),e.jsxs("span",{className:"text-brand-700",children:[p(g.totalAmount)," so'm"]})]})})]})]})})]})}function Nn(){const{showAlert:a,AlertComponent:o}=Ps(),n=lt(),[x,i]=s.useState([]),[g,v]=s.useState(""),[h,q]=s.useState([]),[P,w]=s.useState(!1),[S,L]=s.useState(!1),[$,C]=s.useState("");s.useEffect(()=>{y(!0);const k=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=k}},[]),s.useEffect(()=>{y(!0)},[n.pathname]);const m=()=>Q(this,null,function*(){w(!0);try{yield y(!1),a("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(k){console.error("Refresh xatosi:",k),a("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{w(!1)}});s.useEffect(()=>{if(g.trim()==="")q(x);else{const k=x.filter(j=>j.name.toLowerCase().includes(g.toLowerCase())||j.phone.includes(g));q(k)}},[x,g]);const y=(k=!0)=>Q(this,null,function*(){try{k&&L(!0),C("");const f=(yield U.get("/customers/kassa")).data.filter(R=>{const W=R.name&&R.name.trim().length>0,J=R.phone&&R.phone.trim().length>0;return W&&J}).map(R=>N(b({},R),{name:R.name.trim(),phone:R.phone.trim(),totalPurchases:Number(R.totalPurchases)||0,debt:Number(R.debt)||0}));i(f)}catch(j){console.error("Error fetching customers:",j),C("Mijozlarni yuklashda xatolik yuz berdi")}finally{k&&L(!1)}});return e.jsxs("div",{className:"p-6",children:[o,e.jsxs("div",{className:"bg-white rounded-xl border border-surface-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz qidirish...",value:g,onChange:k=>v(k.target.value),className:"w-full pl-10 pr-4 py-2 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500"})]}),e.jsxs("button",{onClick:m,disabled:P,className:"flex items-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50",children:[e.jsx(Os,{className:`w-4 h-4 ${P?"animate-spin":""}`}),P?"Yangilanmoqda...":"Yangilash"]})]})}),e.jsx("div",{className:"divide-y divide-surface-100",children:S?e.jsx("div",{className:"p-8 text-center text-surface-500",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Os,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Mijozlar yuklanmoqda..."})]})}):$?e.jsxs("div",{className:"p-8 text-center text-danger-500",children:[e.jsx("p",{children:$}),e.jsx("button",{onClick:m,className:"mt-2 px-4 py-2 bg-danger-100 text-danger-700 rounded-lg hover:bg-danger-200 transition-colors",children:"Qayta urinish"})]}):h.length===0?e.jsx("div",{className:"p-8 text-center text-surface-500",children:g?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"}):h.map(k=>e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-surface-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600",children:k.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:k.name}),e.jsx("p",{className:"text-sm text-surface-500",children:k.phone}),k.email&&e.jsx("p",{className:"text-xs text-surface-400",children:k.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-surface-500",children:"Jami xaridlar"}),e.jsx("p",{className:"font-semibold text-surface-900",children:p(k.totalPurchases||0)}),k.debt>0&&e.jsxs("p",{className:"text-xs text-danger-600 font-medium",children:["Qarz: ",p(k.debt)]})]})]},k._id))})]})]})}function wn(){var Ye,Ss,I,he,me,ze;const{showAlert:a,AlertComponent:o}=Ps(),n=lt(),[x,i]=s.useState([]),[g,v]=s.useState([]),[h,q]=s.useState([]),[P,w]=s.useState(!1),[S,L]=s.useState(""),[$,C]=s.useState(""),[m,y]=s.useState(""),[k,j]=s.useState(null),[f,R]=s.useState([]),[W,J]=s.useState(!1),[ue,de]=s.useState(!1),[K,Se]=s.useState({paidAmount:"",dueDate:"",description:""}),[je,Me]=s.useState(!1),[V,Ne]=s.useState(!1),[E,ce]=s.useState(null),[be,Le]=s.useState(!1),[O,_]=s.useState({name:"",phone:"",email:"",address:""});s.useEffect(()=>{oe(),Ce(),Qe();const t=window.onbeforeunload;return window.onbeforeunload=null,()=>{window.onbeforeunload=t}},[]),s.useEffect(()=>{oe(),Ce(),Qe()},[n.pathname]);const D=()=>Q(this,null,function*(){var t,A;if(!O.name.trim()||!O.phone.trim()){a("Mijoz ismi va telefon raqami majburiy","Xatolik","warning");return}try{const G=yield U.post("/customers/kassa",{name:O.name.trim(),phone:O.phone.trim(),email:O.email.trim(),address:O.address.trim()});G.data.success&&(a("Mijoz muvaffaqiyatli qo'shildi","Muvaffaqiyat","success"),Ce(),j(G.data.customer),_({name:"",phone:"",email:"",address:""}),Le(!1))}catch(G){console.error("Error creating customer:",G);const se=((A=(t=G.response)==null?void 0:t.data)==null?void 0:A.message)||"Mijoz qo'shishda xatolik yuz berdi";a(se,"Xatolik","danger")}}),we=()=>{_({name:"",phone:"",email:"",address:""}),Le(!1)},Z=()=>Q(this,null,function*(){de(!0);try{yield Promise.all([oe(),Ce(),Qe()]),a("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(t){console.error("Refresh xatosi:",t),a("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{de(!1)}}),oe=()=>Q(this,null,function*(){try{const t=yield U.get("/debts/kassa");i(t.data)}catch(t){console.error("Error fetching debts:",t)}}),Ce=()=>Q(this,null,function*(){try{const t=yield U.get("/customers/kassa");v(t.data)}catch(t){console.error("Error fetching customers:",t)}}),Qe=()=>Q(this,null,function*(){try{const t=yield U.get("/products/kassa"),A=t.data.data||t.data;q(Array.isArray(A)?A:[])}catch(t){console.error("Error fetching products:",t)}}),_e=t=>{j(t);const A=x.find(G=>{var se;return((se=G.customer)==null?void 0:se._id)===t._id&&G.status==="approved"});A&&a(`${t.name} mijozining ${p(A.amount-A.paidAmount)} so'm tasdiqlangan qarzi mavjud. Yangi qarz to'g'ridan-to'g'ri mavjud qarzga qo'shiladi.`,"Ma'lumot","info")},Oe=()=>{w(!1),j(null),R([]),C(""),y(""),J(!1),Le(!1),Se({paidAmount:"",dueDate:"",description:""}),_({name:"",phone:"",email:"",address:""})},ts=t=>{const A=f.find(G=>G.product._id===t._id);R(A?G=>G.map(se=>se.product._id===t._id?N(b({},se),{quantity:se.quantity+1}):se):G=>[...G,{product:t,quantity:1,price:t.price}]),y(""),J(!1)},He=(t,A)=>{if(A<=0){R(G=>G.filter(se=>se.product._id!==t));return}R(G=>G.map(se=>se.product._id===t?N(b({},se),{quantity:A}):se))},u=t=>{R(A=>A.filter(G=>G.product._id!==t))},ee=t=>{ce(t),Me(!0)},Ie=()=>Q(this,null,function*(){var t,A;if(E)try{yield U.delete(`/debts/kassa/${E._id}`),a("Qarz muvaffaqiyatli o'chirildi","Muvaffaqiyat","success"),Ne(!1),ce(null),oe()}catch(G){console.error("Error deleting debt:",G);const se=((A=(t=G.response)==null?void 0:t.data)==null?void 0:A.message)||"Qarzni o'chirishda xatolik yuz berdi";a(se,"Xatolik","danger")}}),qe=()=>{Me(!1),ce(null)},ne=()=>{Ne(!1),ce(null)},Ze=()=>Q(this,null,function*(){if(!k||f.length===0||!K.dueDate){a("Barcha majburiy maydonlarni to'ldiring","Xatolik","warning");return}try{const t=f.reduce((is,Je)=>is+Je.price*Je.quantity,0),A=parseFloat(Ge(K.paidAmount))||0;if(A>t){a(`To'langan summa (${p(A)} so'm) jami summadan (${p(t)} so'm) ko'p bo'lishi mumkin emas!`,"Xatolik","danger");return}const G={customer:k._id,amount:t,paidAmount:A,dueDate:K.dueDate,description:K.description,items:f.map(is=>({product:is.product._id,quantity:is.quantity,price:is.price}))},as=(yield U.post("/debts/kassa",G)).status===200?"Qarz mavjud qarzga muvaffaqiyatli qo'shildi! Bitta qarz sifatida ko'rinadi.":"Yangi qarz yaratildi va admin tasdiqlashini kutmoqda.";a(as,"Muvaffaqiyat","success"),Oe(),oe()}catch(t){console.error("Error creating debt:",t),a("Qarz qo'shishda xatolik yuz berdi","Xatolik","danger")}}),X=g.filter(t=>$===""||t.name.toLowerCase().includes($.toLowerCase())||t.phone.includes($)),ve=h.filter(t=>{if(!m.trim())return!1;const A=m.toLowerCase().trim(),G=t.name.toLowerCase(),se=t.code.toLowerCase();return!!(se===A||se.startsWith(A)||se.includes(A)||G.includes(A))}).sort((t,A)=>{const G=m.toLowerCase().trim(),se=t.code.toLowerCase(),ss=A.code.toLowerCase(),as=t.name.toLowerCase(),is=A.name.toLowerCase();return se===G&&ss!==G?-1:ss===G&&se!==G?1:se.startsWith(G)&&!ss.startsWith(G)?-1:ss.startsWith(G)&&!se.startsWith(G)?1:as.startsWith(G)&&!is.startsWith(G)?-1:is.startsWith(G)&&!as.startsWith(G)?1:t.name.localeCompare(A.name)}),M=f.reduce((t,A)=>t+A.price*A.quantity,0),Te=parseFloat(Ge(K.paidAmount))||0,Re=M-Te,Ue=x.filter(t=>{var ss,as,is;if(!S.trim())return!0;const A=S.toLowerCase(),G=((as=(ss=t.customer)==null?void 0:ss.name)==null?void 0:as.toLowerCase())||"",se=((is=t.customer)==null?void 0:is.phone)||"";return G.includes(A)||se.includes(A)});return e.jsxs("div",{className:"p-3 sm:p-6 h-full flex flex-col overflow-hidden",children:[o,e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-6 flex-shrink-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center justify-center gap-2 px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors w-full sm:w-auto",children:[e.jsx(ds,{className:"w-4 h-4"}),"Yangi qarz"]}),e.jsxs("button",{onClick:Z,disabled:ue,className:"flex items-center justify-center gap-2 px-4 py-2 bg-surface-100 text-surface-700 rounded-lg hover:bg-surface-200 transition-colors disabled:opacity-50 w-full sm:w-auto",children:[e.jsx(Os,{className:`w-4 h-4 ${ue?"animate-spin":""}`}),ue?"Yangilanmoqda...":"Yangilash"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 mb-6 flex-shrink-0",children:[e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl border border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx(ds,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Jami qarz"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-surface-900 truncate",children:p(x.reduce((t,A)=>t+(A.amount-A.paidAmount),0))})]})]})}),e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl border border-surface-200",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-success-100 rounded-lg flex items-center justify-center",children:e.jsx(ia,{className:"w-4 h-4 sm:w-5 sm:h-5 text-success-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm text-surface-500 truncate",children:"Jami qarzlar soni"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-surface-900",children:x.length})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-surface-200 overflow-hidden flex flex-col h-[calc(100vh-400px)] min-h-[400px]",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-surface-200 flex-shrink-0",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mijoz qidirish...",value:S,onChange:t=>L(t.target.value),className:"w-full pl-9 sm:pl-10 pr-4 py-2 sm:py-3 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:Ue.length===0?e.jsxs("div",{className:"p-8 text-center text-surface-500",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ds,{className:"w-8 h-8 text-surface-400"})}),e.jsx("p",{className:"font-medium text-lg mb-2",children:S?"Qarz topilmadi":"Qarzlar ro'yxati bo'sh"}),e.jsx("p",{className:"text-sm",children:S?`"${S}" bo'yicha hech qanday qarz topilmadi`:"Hozircha hech qanday qarz qo'shilmagan"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block sm:hidden",children:Ue.map(t=>{var A,G,se;return e.jsxs("div",{className:"p-4 border-b border-surface-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:(A=t.customer)==null?void 0:A.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:(G=t.customer)==null?void 0:G.name}),e.jsx("p",{className:"text-sm text-surface-500",children:(se=t.customer)==null?void 0:se.phone})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Qarz summasi"}),e.jsx("p",{className:"font-medium text-surface-900",children:p(t.amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Qoldiq"}),e.jsx("p",{className:"font-medium text-danger-600",children:p(t.amount-t.paidAmount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-500 mb-1",children:"Muddat"}),e.jsx("p",{className:"text-surface-900",children:new Date(t.dueDate).toLocaleDateString()})]}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx("button",{onClick:()=>ee(t),className:"p-2 text-brand-600 hover:text-brand-700 hover:bg-brand-50 rounded-lg transition-colors",title:"Qarz ma'lumotlarini ko'rish",children:e.jsx(Gs,{className:"w-4 h-4"})})})]})]},t._id)})}),e.jsx("div",{className:"hidden sm:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surface-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Mijoz"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Qarz"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Qoldiq"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Muddat"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-surface-500 uppercase",children:"Amallar"})]})}),e.jsx("tbody",{className:"divide-y divide-surface-100",children:Ue.map(t=>{var A,G,se;return e.jsxs("tr",{className:"hover:bg-surface-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-brand-600",children:(A=t.customer)==null?void 0:A.name.charAt(0)})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate",children:(G=t.customer)==null?void 0:G.name}),e.jsx("p",{className:"text-sm text-surface-500 truncate",children:(se=t.customer)==null?void 0:se.phone})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-surface-900",children:p(t.amount)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-danger-600",children:p(t.amount-t.paidAmount)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-surface-500",children:new Date(t.dueDate).toLocaleDateString()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>ee(t),className:"p-2 text-brand-600 hover:text-brand-700 hover:bg-brand-50 rounded-lg transition-colors",title:"Qarz ma'lumotlarini ko'rish",children:e.jsx(Gs,{className:"w-4 h-4"})})})})]},t._id)})})]})})]})})]}),P&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>Oe()}),e.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl w-full max-w-6xl shadow-2xl relative z-10 max-h-[95vh] sm:max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 lg:p-6 border-b border-surface-200 bg-gradient-to-r from-brand-50 to-blue-50 rounded-t-2xl sm:rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-lg flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(ds,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold text-surface-900 truncate",children:k?`${k.name} uchun qarz qo'shish`:"Mijoz tanlash"}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-600 truncate",children:k?"Mahsulotlarni tanlang va to'lov ma'lumotlarini kiriting":"Qarz berish uchun mijozni tanlang"})]})]}),e.jsx("button",{onClick:()=>Oe(),className:"w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors flex-shrink-0",children:e.jsx(ge,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),k?e.jsxs("div",{className:"flex-1 p-3 sm:p-4 lg:p-6 overflow-y-auto min-h-0",children:[e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"bg-surface-50 p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600 text-sm sm:text-lg",children:k.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:k.name}),e.jsx("p",{className:"text-xs sm:text-sm text-surface-500",children:k.phone})]})]})}),e.jsxs("div",{className:"bg-white border border-surface-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Mahsulotlar"}),e.jsxs("button",{onClick:()=>J(!0),className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 lg:px-4 py-1.5 sm:py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors shadow-sm text-xs sm:text-sm",children:[e.jsx(ys,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Mahsulot qidirish"}),e.jsx("span",{className:"sm:hidden",children:"Qo'shish"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Tez qidirish: mahsulot nomi yoki kodi...",value:m,onChange:t=>y(t.target.value),onFocus:()=>J(!0),onKeyDown:t=>{t.key==="Enter"&&ve.length>0&&ts(ve[0]),t.key==="Escape"&&y("")},className:"w-full pl-10 pr-10 py-2 text-xs sm:text-sm bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"}),m&&e.jsx("button",{onClick:()=>y(""),className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 flex items-center justify-center text-surface-400 hover:text-surface-600 rounded-full hover:bg-surface-100",children:e.jsx(ge,{className:"w-3 h-3"})})]}),m&&ve.length>0&&!W&&e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-surface-500",children:[e.jsxs("span",{children:[ve.length," ta mahsulot topildi"]}),e.jsx("span",{className:"text-brand-600",children:"Enter - birinchisini tanlash"})]})]}),m&&ve.length>0&&!W&&e.jsxs("div",{className:"mb-4 max-h-40 overflow-y-auto border border-surface-200 rounded-lg",children:[ve.slice(0,5).map(t=>e.jsxs("button",{onClick:()=>ts(t),className:"w-full flex items-center gap-3 p-2 hover:bg-surface-50 transition-colors text-left border-b border-surface-100 last:border-b-0",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(Ke,{className:"w-4 h-4 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 text-sm truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-surface-500 bg-surface-100 px-2 py-0.5 rounded",children:t.code}),e.jsxs("span",{className:"text-xs text-surface-500",children:["Omborda: ",t.quantity," ta"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold text-brand-600 text-sm",children:p(t.price)})})]},t._id)),ve.length>5&&e.jsxs("button",{onClick:()=>J(!0),className:"w-full p-2 text-center text-sm text-brand-600 hover:bg-brand-50 transition-colors",children:["Yana ",ve.length-5," ta ko'rish..."]})]}),e.jsx("div",{className:"space-y-2",children:f.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center text-surface-500 border-2 border-dashed border-surface-200 rounded-lg",children:[e.jsx(Ke,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Mahsulot tanlanmagan"})]}):f.map(t=>e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 bg-surface-50 rounded-lg border border-surface-200",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 text-xs sm:text-sm truncate",children:t.product.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",t.product.code]})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>He(t.product._id,t.quantity-1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded bg-surface-200 hover:bg-surface-300 transition-colors",children:e.jsx(Xt,{className:"w-3 h-3"})}),e.jsx("span",{className:"w-8 sm:w-10 text-center font-medium bg-white px-1 sm:px-2 py-1 rounded border text-xs sm:text-sm",children:t.quantity}),e.jsx("button",{onClick:()=>He(t.product._id,t.quantity+1),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded bg-surface-200 hover:bg-surface-300 transition-colors",children:e.jsx(ys,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"text-right min-w-0",children:[e.jsxs("p",{className:"font-bold text-surface-900 text-xs sm:text-sm",children:[p(t.price*t.quantity)," so'm"]}),e.jsxs("p",{className:"text-xs text-surface-500",children:[p(t.price)," Ã— ",t.quantity]})]}),e.jsx("button",{onClick:()=>u(t.product._id),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded text-danger-500 hover:bg-danger-50 transition-colors flex-shrink-0",children:e.jsx(ge,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]},t.product._id))})]}),e.jsxs("div",{className:"bg-surface-50 p-3 sm:p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"Jami summa:"}),e.jsxs("span",{className:"font-semibold text-surface-900 text-xs sm:text-sm",children:[p(M)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"To'langan:"}),e.jsxs("span",{className:"font-semibold text-success-600 text-xs sm:text-sm",children:[p(Te)," so'm"]})]}),e.jsxs("div",{className:"flex justify-between border-t border-surface-200 pt-2",children:[e.jsx("span",{className:"text-surface-600 text-xs sm:text-sm",children:"Qarz qoldi:"}),e.jsxs("span",{className:`font-bold text-sm sm:text-base ${Re<0,"text-danger-600"}`,children:[Re<0?"-":"",p(Math.abs(Re))," so'm"]})]}),Re<0&&e.jsx("div",{className:"bg-danger-50 border border-danger-200 rounded-lg p-2 mt-2",children:e.jsx("p",{className:"text-danger-700 text-xs font-medium",children:"âš ï¸ To'langan summa jami summadan ko'p! Qarz minus bo'ldi."})})]}),e.jsxs("div",{className:"bg-white border border-surface-200 rounded-xl p-4 space-y-4",children:[e.jsx("h4",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"To'lov ma'lumotlari"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-surface-700 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(ds,{className:"w-3 h-3 sm:w-4 sm:h-4 text-success-600"}),"To'langan summa"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"0",value:K.paidAmount,onChange:t=>{const A=us(t.target.value);if((parseFloat(Ge(A))||0)>M&&M>0){a(`To'langan summa jami summadan (${p(M)} so'm) ko'p bo'lishi mumkin emas!`,"Ogohlantirish","warning");return}Se(se=>N(b({},se),{paidAmount:A}))},className:`w-full pl-3 sm:pl-4 pr-12 sm:pr-16 py-3 sm:py-4 text-base sm:text-lg font-semibold border-2 rounded-xl focus:outline-none focus:ring-4 transition-all ${Re<0?"border-danger-500 bg-gradient-to-r from-danger-50 to-red-50 focus:border-danger-500 focus:ring-danger-500/10":Te<M&&Te>0?"border-orange-400 bg-gradient-to-r from-yellow-100 to-orange-100 focus:border-orange-400 focus:ring-orange-400/10":"border-surface-200 bg-gradient-to-r from-white to-success-50 focus:border-success-500 focus:ring-success-500/10"}`}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 sm:pr-4 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-surface-500 font-medium text-xs sm:text-sm",children:"so'm"})})]}),K.paidAmount&&e.jsxs("div",{className:`mt-2 text-xs sm:text-sm font-medium ${Re<0?"text-danger-600":"text-success-600"}`,children:[K.paidAmount," so'm",Re<0&&e.jsx("span",{className:"block text-danger-600 font-bold mt-1",children:"âš ï¸ Jami summadan ko'p!"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-surface-700 mb-2",children:[e.jsx(Hs,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"Qaytarish muddati *"]}),e.jsx("input",{type:"date",value:K.dueDate,onChange:t=>Se(A=>N(b({},A),{dueDate:t.target.value})),className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"})]})]})]}),W&&e.jsxs("div",{className:"fixed inset-0 z-60 flex items-center justify-center p-2 sm:p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>J(!1)}),e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-4xl shadow-2xl relative z-10 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-3 sm:p-4 border-b border-surface-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h5",{className:"font-semibold text-surface-900 text-sm sm:text-base",children:"Mahsulot tanlash"}),e.jsx("button",{onClick:()=>J(!1),className:"text-surface-400 hover:text-surface-600",children:e.jsx(ge,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Mahsulot nomi yoki kodi bilan qidiring...",value:m,onChange:t=>y(t.target.value),className:"w-full pl-10 pr-4 py-2 sm:py-3 text-xs sm:text-sm bg-surface-50 border border-surface-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20",autoFocus:!0})]}),m&&e.jsxs("div",{className:"mt-2 text-xs text-surface-500",children:['"',m,`" bo'yicha `,ve.length," ta natija topildi"]})]}),e.jsx("div",{className:"max-h-80 sm:max-h-96 overflow-y-auto p-3 sm:p-4",children:ve.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center text-surface-500",children:[e.jsx(Ke,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium mb-1 text-sm",children:m?"Mahsulot topilmadi":"Qidirish uchun mahsulot nomini yoki kodini kiriting"}),m&&e.jsxs("p",{className:"text-xs",children:['"',m,`" bo'yicha hech narsa topilmadi`]})]}):e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[ve.slice(0,100).map(t=>e.jsxs("button",{onClick:()=>ts(t),className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 hover:bg-surface-50 transition-colors text-left border border-surface-200 rounded-lg group",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-brand-100 rounded-lg flex items-center justify-center group-hover:bg-brand-200 transition-colors flex-shrink-0",children:e.jsx(Ke,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-surface-900 truncate text-xs sm:text-sm",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-surface-500 bg-surface-100 px-2 py-1 rounded",children:["Kod: ",t.code]}),e.jsxs("span",{className:"text-xs text-surface-500",children:["Omborda: ",t.quantity," ta"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-brand-600 text-sm sm:text-base",children:[p(t.price)," so'm"]}),e.jsx("p",{className:"text-xs text-surface-500",children:"Narxi"})]})]},t._id)),ve.length>100&&e.jsx("div",{className:"p-3 text-center text-surface-500 text-xs border-t border-surface-200",children:"Faqat birinchi 100 ta natija ko'rsatildi. Aniqroq qidiring."})]})}),e.jsx("div",{className:"p-3 sm:p-4 border-t border-surface-200 bg-surface-50",children:e.jsx("div",{className:"flex items-center gap-2 text-xs text-surface-500",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fs,{className:"w-3 h-3"}),e.jsx("span",{children:"Maslahat: Mahsulot nomini yoki kodini to'liq kiriting"})]})})})]})]})]}):e.jsxs("div",{className:"flex-1 p-3 sm:p-4 lg:p-6 overflow-y-auto min-h-0",children:[e.jsx("div",{className:"relative mb-3 sm:mb-4 lg:mb-6",children:e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(fs,{className:"w-4 h-4 sm:w-5 sm:h-5 text-surface-400"})}),e.jsx("input",{type:"text",placeholder:"Mijoz ismi yoki telefon raqami bilan qidiring...",value:$,onChange:t=>C(t.target.value),className:"w-full pl-9 sm:pl-10 pr-4 py-2 sm:py-3 text-sm bg-white border-2 border-surface-200 rounded-xl focus:outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 transition-all"}),$&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("button",{onClick:()=>C(""),className:"w-5 h-5 flex items-center justify-center text-surface-400 hover:text-surface-600 rounded-full hover:bg-surface-100",children:e.jsx(ge,{className:"w-3 h-3"})})})]}),e.jsxs("button",{onClick:()=>Le(!0),className:"flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-3 bg-success-500 text-white rounded-xl hover:bg-success-600 transition-colors flex-shrink-0",title:"Yangi mijoz qo'shish",children:[e.jsx(ys,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yangi mijoz"})]})]})}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:X.length===0?e.jsxs("div",{className:"p-6 sm:p-8 lg:p-12 text-center text-surface-500",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-surface-100 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4",children:e.jsx(fs,{className:"w-6 h-6 sm:w-8 sm:h-8 text-surface-400"})}),e.jsx("p",{className:"font-medium text-sm sm:text-base lg:text-lg mb-2",children:$?"Mijoz topilmadi":"Mijozlar ro'yxati bo'sh"}),e.jsx("p",{className:"text-xs sm:text-sm",children:$?`"${$}" bo'yicha hech kim topilmadi`:"Hozircha mijozlar qo'shilmagan"})]}):X.map(t=>{const A=x.find(G=>{var se;return((se=G.customer)==null?void 0:se._id)===t._id&&G.status==="pending_approval"});return e.jsx("button",{onClick:()=>_e(t),className:"w-full p-3 sm:p-4 hover:bg-gradient-to-r hover:from-brand-50 hover:to-blue-50 transition-all duration-200 text-left border-2 border-surface-200 hover:border-brand-300 rounded-xl group",children:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center shadow-lg group-hover:shadow-xl transition-shadow flex-shrink-0",children:e.jsx("span",{className:"text-sm sm:text-base lg:text-lg font-bold text-white",children:t.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-surface-900 text-sm sm:text-base lg:text-lg truncate",children:t.name}),A&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-warning-100 text-warning-700 flex-shrink-0",children:"Qarz mavjud"})]}),e.jsxs("p",{className:"text-surface-600 flex items-center gap-1 text-xs sm:text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{className:"truncate",children:t.phone})]}),A&&e.jsxs("p",{className:"text-xs text-warning-600 font-medium mt-1",children:["Mavjud qarz: ",p(A.amount-A.paidAmount)," so'm"]}),t.email&&e.jsxs("p",{className:"text-xs text-surface-500 flex items-center gap-1 mt-1",children:[e.jsx("svg",{className:"w-3 h-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("span",{className:"truncate",children:t.email})]})]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-brand-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})},t._id)})})]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row items-center justify-between gap-3 p-3 sm:p-4 lg:p-6 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-surface-600 order-2 sm:order-1",children:k&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-success-500 rounded-full"}),e.jsxs("span",{children:["Mijoz tanlandi: ",k.name]})]})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto order-1 sm:order-2",children:[k&&e.jsxs("button",{onClick:()=>j(null),className:"flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors text-xs sm:text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Orqaga"]}),e.jsx("button",{onClick:()=>Oe(),className:"px-3 sm:px-4 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors text-xs sm:text-sm",children:"Bekor qilish"}),k&&e.jsxs("button",{onClick:Ze,disabled:f.length===0||!K.dueDate,className:"flex items-center gap-1 sm:gap-2 px-4 sm:px-6 py-2 bg-gradient-to-r from-brand-500 to-brand-600 text-white rounded-lg hover:from-brand-600 hover:to-brand-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-xs sm:text-sm flex-1 sm:flex-none justify-center",children:[e.jsx(ds,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Qarz qo'shish",M>0&&e.jsxs("span",{className:"ml-2 px-2 py-1 bg-white/20 rounded text-xs hidden sm:inline",children:[p(Re)," so'm"]})]})]})]})]})]}),je&&E&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:qe}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl shadow-2xl relative z-10 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-surface-200 bg-gradient-to-r from-brand-50 to-blue-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(Gs,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-surface-900",children:"Qarz ma'lumotlari"}),e.jsxs("p",{className:"text-sm text-surface-600",children:["#",E._id.slice(-6)]})]})]}),e.jsx("button",{onClick:qe,className:"w-10 h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-3",children:"Mijoz ma'lumotlari"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-brand-600 text-lg",children:(Ye=E.customer)==null?void 0:Ye.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-surface-900",children:(Ss=E.customer)==null?void 0:Ss.name}),e.jsx("p",{className:"text-surface-600",children:(I=E.customer)==null?void 0:I.phone}),((he=E.customer)==null?void 0:he.email)&&e.jsx("p",{className:"text-sm text-surface-500",children:(me=E.customer)==null?void 0:me.email})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Qarz summasi"}),e.jsxs("p",{className:"text-2xl font-bold text-surface-900",children:[p(E.amount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"To'langan"}),e.jsxs("p",{className:"text-2xl font-bold text-success-600",children:[p(E.paidAmount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Qoldiq"}),e.jsxs("p",{className:"text-2xl font-bold text-danger-600",children:[p(E.amount-E.paidAmount)," so'm"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Muddat"}),e.jsx("p",{className:"text-lg font-semibold text-surface-900",children:new Date(E.dueDate).toLocaleDateString()})]})]}),E.description&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-2",children:"Izoh"}),e.jsx("p",{className:"text-surface-700",children:E.description})]}),E.items&&E.items.length>0&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-surface-200",children:[e.jsx("h4",{className:"font-semibold text-surface-900 mb-3",children:"Mahsulotlar"}),e.jsx("div",{className:"space-y-2",children:E.items.map((t,A)=>{var G;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-surface-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-100 rounded flex items-center justify-center",children:e.jsx(Ke,{className:"w-4 h-4 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-surface-900",children:((G=t.product)==null?void 0:G.name)||"Mahsulot"}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Miqdor: ",t.quantity]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[p(t.price*t.quantity)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:[p(t.price)," Ã— ",t.quantity]})]})]},A)})})]}),e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Yaratilgan"}),e.jsx("p",{className:"font-semibold text-surface-900",children:new Date(E.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:"flex justify-end gap-3 p-6 border-t border-surface-200 bg-surface-50/50",children:e.jsx("button",{onClick:qe,className:"px-6 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Yopish"})})]})]}),V&&E&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:ne}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-surface-200 bg-gradient-to-r from-danger-50 to-red-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-danger-500 to-danger-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(_s,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-surface-900",children:"Qarzni o'chirish"}),e.jsx("p",{className:"text-sm text-surface-600",children:"Bu amalni bekor qilib bo'lmaydi"})]})]}),e.jsx("button",{onClick:ne,className:"w-10 h-10 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-danger-50 p-4 rounded-xl border border-danger-200 mb-4",children:[e.jsx("p",{className:"text-danger-800 font-medium mb-2",children:"Diqqat!"}),e.jsxs("p",{className:"text-danger-700 text-sm",children:["Siz ",e.jsx("strong",{children:(ze=E.customer)==null?void 0:ze.name})," mijozining ",e.jsxs("strong",{children:[p(E.amount)," so'm"]})," qarzini o'chirmoqchisiz. Bu amal bekor qilinmaydi va barcha ma'lumotlar yo'qoladi."]}),E.status==="approved"&&e.jsxs("p",{className:"text-danger-600 text-xs mt-2",children:[e.jsx("strong",{children:"Eslatma:"})," Bu tasdiqlangan qarz. O'chirilganda mijozning umumiy qarzidan ham ayriladi."]})]}),e.jsxs("div",{className:"bg-surface-50 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-surface-600",children:"Qarz summasi:"}),e.jsxs("span",{className:"font-semibold text-surface-900",children:[p(E.amount)," so'm"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-surface-600",children:"Qoldiq:"}),e.jsxs("span",{className:"font-semibold text-danger-600",children:[p(E.amount-E.paidAmount)," so'm"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("button",{onClick:ne,className:"px-6 py-2 text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:Ie,className:"px-6 py-2 bg-gradient-to-r from-danger-500 to-danger-600 text-white rounded-lg hover:from-danger-600 hover:to-danger-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:"O'chirish"})]})]})]}),be&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:we}),e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-200 bg-gradient-to-r from-success-50 to-green-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-success-500 to-success-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(ys,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-surface-900",children:"Yangi mijoz"}),e.jsx("p",{className:"text-xs text-surface-600",children:"Mijoz ma'lumotlari"})]})]}),e.jsx("button",{onClick:we,className:"w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-600 hover:bg-white/50 transition-colors",children:e.jsx(ge,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Ism *"}),e.jsx("input",{type:"text",value:O.name,onChange:t=>_(A=>N(b({},A),{name:t.target.value})),className:"w-full px-3 py-2 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20",placeholder:"Mijoz ismi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Telefon *"}),e.jsx("input",{type:"tel",value:O.phone,onChange:t=>_(A=>N(b({},A),{phone:t.target.value})),className:"w-full px-3 py-2 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20",placeholder:"+998 (XX) XXX-XX-XX"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-surface-700 mb-1.5",children:"Viloyat"}),e.jsx("textarea",{value:O.address,onChange:t=>_(A=>N(b({},A),{address:t.target.value})),className:"w-full px-3 py-2 text-sm border border-surface-200 rounded-lg focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500/20 resize-none",rows:2,placeholder:"Viloyatni tanlang"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 border-t border-surface-200 bg-surface-50/50",children:[e.jsx("button",{onClick:we,className:"px-4 py-2 text-xs font-medium text-surface-600 hover:text-surface-900 hover:bg-surface-100 rounded-lg transition-colors",children:"Bekor qilish"}),e.jsx("button",{onClick:D,disabled:!O.name.trim()||!O.phone.trim(),className:"px-4 py-2 text-xs font-medium bg-gradient-to-r from-success-500 to-success-600 text-white rounded-lg hover:from-success-600 hover:to-success-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:"Saqlash"})]})]})]})]})}function yn(){const{showAlert:a,AlertComponent:o}=Ps(),n=lt(),[x,i]=s.useState([]),[g,v]=s.useState(null),[h,q]=s.useState([]),[P,w]=s.useState([]),[S,L]=s.useState(20),[$,C]=s.useState(""),[m,y]=s.useState("all"),[k,j]=s.useState(""),[f,R]=s.useState(!1),[W,J]=s.useState(!1),[ue,de]=s.useState(!1),[K,Se]=s.useState(!1),[je,Me]=s.useState(!1),[V,Ne]=s.useState(null),[E,ce]=s.useState(null),[be,Le]=s.useState(!1),[O,_]=s.useState({code:"",name:"",quantity:"",previousPrice:"",currentPrice:"",unit:"dona",conversionEnabled:!1,baseUnit:"dona",conversionRate:"",packageCount:"",pricePerMeter:"",pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),[D,we]=s.useState({packageCount:"",unitsPerPackage:"",totalCost:""}),[Z,oe]=s.useState([]),[Ce,Qe]=s.useState(""),[_e,Oe]=s.useState(!1),[ts,He]=s.useState(null),[u,ee]=s.useState(!1),[Ie,qe]=s.useState(!1),[ne,Ze]=s.useState("add"),[X,ve]=s.useState(""),[M,Te]=s.useState({printer:"",copies:1,size:"card",layout:"standard",customWidth:"",customHeight:""}),[Re,Ue]=s.useState([]),[Ye,Ss]=s.useState(!1),[I,he]=s.useState(null),me=s.useRef(null),ze=s.useRef(null);s.useEffect(()=>{t()},[]),s.useEffect(()=>{g&&A()},[g]),s.useEffect(()=>{w(h.slice(0,S))},[h,S]),s.useEffect(()=>{const d=ze.current;if(!d)return;const te=()=>{const{scrollTop:r,scrollHeight:T,clientHeight:H}=d;T-r<=H*1.5&&S<h.length&&L(Y=>Math.min(Y+20,h.length))};return d.addEventListener("scroll",te),()=>d.removeEventListener("scroll",te)},[S,h.length]),s.useEffect(()=>{g&&A()},[n.pathname]),s.useEffect(()=>{const d=te=>{te.key==="Escape"&&_e&&Oe(!1)};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[_e]),s.useEffect(()=>{let d=x;$.trim()!==""&&(d=d.filter(te=>te.name.toLowerCase().includes($.toLowerCase())||te.code.toLowerCase().includes($.toLowerCase()))),m!=="all"&&(m==="low"?d=d.filter(te=>te.quantity<=(te.minStock||50)&&te.quantity>0):m==="out"&&(d=d.filter(te=>te.quantity===0))),k&&(d=d.filter(te=>te.category===k)),q(d),L(20)},[x,$,m,k]);const t=()=>Q(this,null,function*(){try{const te=(yield U.get("/warehouses")).data.find(r=>r.name==="Asosiy ombor");if(te)v(te);else{const r=yield U.post("/warehouses",{name:"Asosiy ombor",address:""});v(r.data)}}catch(d){console.error("Error fetching warehouses:",d),R(!1)}}),A=()=>Q(this,null,function*(){try{R(!0);const d=yield U.get("/products?mainOnly=true&limit=10000"),te=d.data.data||d.data;i(Array.isArray(te)?te:[])}catch(d){console.error("Error fetching products:",d),a("Tovarlarni yuklashda xatolik yuz berdi","Xatolik","danger")}finally{R(!1)}}),G=d=>new Promise((te,r)=>{const T=new FileReader;T.readAsDataURL(d),T.onload=H=>{var ae;const Y=document.createElement("img");Y.src=(ae=H.target)==null?void 0:ae.result,Y.onload=()=>{const fe=document.createElement("canvas");let re=Y.width,pe=Y.height;if(re>1920||pe>1920){const Ve=Math.min(1920/re,1920/pe);re=Math.round(re*Ve),pe=Math.round(pe*Ve)}fe.width=re,fe.height=pe;const De=fe.getContext("2d");if(!De){r(new Error("Canvas context not available"));return}De.drawImage(Y,0,0,re,pe),fe.toBlob(Ve=>{Ve?te(Ve):r(new Error("Canvas to blob failed"))},"image/jpeg",.8)},Y.onerror=()=>r(new Error("Image load failed"))},T.onerror=()=>r(new Error("File read failed"))}),se=(d,te)=>Q(this,null,function*(){var De,Ve;const r=te.target.files;if(!r||r.length===0)return;const T=x.find(vs=>vs._id===d);if(!T)return;const H=T.images||[],Y=8-H.length;if(Y<=0){a("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const ae=["image/jpeg","image/jpg","image/png","image/webp"],fe=Array.from(r).filter(vs=>ae.includes(vs.type)?!0:(a(`${vs.name} - noto'g'ri format. Faqat JPG, PNG, WebP qabul qilinadi`,"Xatolik","warning"),!1));if(fe.length===0)return;const re=fe.slice(0,Y),pe=new FormData;Le(!0),he(d);try{for(const $s of re)try{const c=yield G($s);pe.append("images",c,$s.name)}catch(c){console.warn(`Image compression failed for ${$s.name}, uploading original:`,c),pe.append("images",$s)}const vs=yield U.post("/products/upload-images",pe,{headers:{"Content-Type":"multipart/form-data"}}),ps=[...H,...vs.data.images],ks=yield U.put(`/products/${d}/images`,{images:ps});i($s=>$s.map(c=>c._id===d?N(b({},c),{images:ps}):c)),a(`${vs.data.images.length} ta rasm muvaffaqiyatli yuklandi!`,"Muvaffaqiyat","success")}catch(vs){console.error("Error uploading images:",vs);const ps=((Ve=(De=vs.response)==null?void 0:De.data)==null?void 0:Ve.message)||"Rasmlarni yuklashda xatolik";a(ps,"Xatolik","danger")}finally{Le(!1),he(null),me.current&&(me.current.value="")}}),ss=()=>Q(this,null,function*(){J(!0);try{yield A(),a("Ma'lumotlar yangilandi","Muvaffaqiyat","success")}catch(d){console.error("Refresh xatosi:",d),a("Ma'lumotlarni yangilashda xatolik","Xatolik","danger")}finally{J(!1)}}),as=d=>Q(this,null,function*(){const te=d.target.files;if(!te||te.length===0)return;const r=8-Z.length;if(r<=0){a("Maksimum 8 ta rasm yuklash mumkin","Ogohlantirish","warning");return}const T=Array.from(te).slice(0,r),H=new FormData;T.forEach(Y=>H.append("images",Y)),Le(!0);try{const Y=yield U.post("/products/upload-images",H,{headers:{"Content-Type":"multipart/form-data"}});oe([...Z,...Y.data.images])}catch(Y){console.error("Error uploading images:",Y),a("Rasmlarni yuklashda xatolik","Xatolik","danger")}finally{Le(!1),me.current&&(me.current.value="")}}),is=d=>Q(this,null,function*(){try{yield U.delete("/products/delete-image",{data:{imagePath:d}}),oe(Z.filter(te=>te!==d))}catch(te){console.error("Error deleting image:",te)}}),Je=d=>Q(this,null,function*(){var H,Y;if(d.preventDefault(),Ce){a(Ce,"Xatolik","danger");return}let te=Number(O.quantity),r=null;if(u&&D.packageCount&&D.unitsPerPackage){const ae=Number(D.packageCount)*Number(D.unitsPerPackage);te=E?Number(O.quantity)+ae:ae,r={packageCount:Number(D.packageCount),unitsPerPackage:Number(D.unitsPerPackage),totalUnits:ae}}let T=te;O.conversionEnabled&&O.conversionRate&&(T=te*Number(O.conversionRate));try{const ae={code:O.code,name:O.name,price:Number(O.currentPrice),previousPrice:Number(O.previousPrice)||0,currentPrice:Number(O.currentPrice)||0,quantity:te,warehouse:g==null?void 0:g._id,images:Z,packageInfo:r,unit:O.unit,unitConversion:{enabled:O.conversionEnabled,baseUnit:O.baseUnit,conversionRate:Number(O.conversionRate)||1,packageCount:te,totalBaseUnits:T},prices:{perUnit:Number(O.currentPrice),perMeter:Number(O.pricePerMeter)||0,perRoll:Number(O.pricePerRoll)||0,perBox:Number(O.pricePerBox)||0,perKg:Number(O.pricePerKg)||0,perGram:Number(O.pricePerGram)||0}};E?yield U.put(`/products/${E._id}`,ae):yield U.post("/products",ae),A(),os()}catch(ae){a(((Y=(H=ae.response)==null?void 0:H.data)==null?void 0:Y.message)||"Xatolik yuz berdi","Xatolik","danger")}}),os=()=>{de(!1),ce(null),_({code:"",name:"",quantity:"",previousPrice:"",currentPrice:"",unit:"dona",conversionEnabled:!1,baseUnit:"dona",conversionRate:"",packageCount:"",pricePerMeter:"",pricePerRoll:"",pricePerBox:"",pricePerKg:"",pricePerGram:""}),we({packageCount:"",unitsPerPackage:"",totalCost:""}),oe([]),Qe(""),ee(!1)},bs=d=>{Ze(d),ve(""),qe(!0)},Is=()=>{const d=Number(X)||0;if(d<=0)return;const te=Number(O.quantity)||0;let r=ne==="add"?te+d:te-d;r<0&&(r=0),_(N(b({},O),{quantity:String(r)})),qe(!1),ve("")},Cs=d=>Q(this,null,function*(){if(d)try{const te=(E==null?void 0:E._id)||"";(yield U.get(`/products/check-code/${d}${te?`?excludeId=${te}`:""}`)).data.exists?Qe(`Kod "${d}" allaqachon mavjud`):Qe("")}catch(te){console.error("Error checking code:",te)}}),zs=()=>{if(!V)return;const d=document.getElementById("qr-code-svg");if(!d)return;const te=new XMLSerializer().serializeToString(d),r=document.createElement("canvas"),T=r.getContext("2d"),H=document.createElement("img");H.onload=()=>{r.width=H.width,r.height=H.height,T==null||T.drawImage(H,0,0);const Y=r.toDataURL("image/png"),ae=document.createElement("a");ae.download=`QR-${V.code}-${V.name}.png`,ae.href=Y,ae.click()},H.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(te)))},Es=(d,te)=>Q(this,null,function*(){try{const r=`${window.location.origin}/product/${d._id}`;return yield xa(r,{width:te*10,margin:1,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"H",type:"image/png"})}catch(r){return console.error("Error generating QR code:",r),""}}),Ts=()=>Q(this,null,function*(){if(V)try{const d=M.customWidth&&M.customHeight,te=d?`${M.customWidth}mm`:null,r=d?`${M.customHeight}mm`:null,T=M.size==="card"?65:M.size==="thermal"?125:145,H=yield Es(V,T),Y=`
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="utf-8">
          <title>Label - ${V.name}</title>
          <style>
            @page {
              size: ${d?`${te} ${r}`:M.size==="card"?"28mm 18mm":M.size==="A4"?"A4":M.size==="A5"?"A5":"50mm 70mm"};
              margin: 0;
            }
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            html, body {
              width: 100%;
              height: 100%;
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              background: white;
              overflow: hidden;
            }
            .page-container {
              width: 100%;
              height: 100vh;
              display: flex;
              justify-content: center;
              align-items: center;
              page-break-after: avoid;
            }
            .label-container {
              border: 2px solid #333;
              padding: ${M.size==="card"?"1mm":M.size==="thermal"?"6px":"12px"};
              background: white;
              width: ${d?te:M.size==="card"?"26mm":M.size==="thermal"?"44mm":M.size==="A4"?"80mm":(M.size==="A5","120mm")};
              height: ${d?r:M.size==="card"?"16mm":M.size==="thermal"?"60mm":M.size==="A4"?"100mm":(M.size==="A5","140mm")};
              display: flex;
              flex-direction: column;
              justify-content: space-between;
              gap: 2px;
              overflow: hidden;
              border-radius: 2px;
              page-break-inside: avoid;
            }
            .product-info {
              flex: 1;
              width: 100%;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              text-align: center;
              height: auto;
            }
            .product-name {
              font-size: ${M.size==="card"?"8px":M.size==="thermal"?"16px":"20px"};
              font-weight: 600;
              color: #1a1a1a;
              line-height: 1.1;
              margin-bottom: ${M.size==="card"?"1px":"2px"};
              word-wrap: break-word;
              overflow: hidden;
              text-overflow: ellipsis;
              display: -webkit-box;
              -webkit-line-clamp: ${M.size==="card"?"1":"2"};
              -webkit-box-orient: vertical;
            }
            .product-code {
              font-size: ${M.size==="card"?"7px":M.size==="thermal"?"14px":"18px"};
              color: #666;
              line-height: 1.0;
              margin-bottom: ${M.size==="card"?"1px":"2px"};
              font-weight: 500;
            }
            .product-price {
              font-size: ${M.size==="card"?"12px":M.size==="thermal"?"20px":"24px"};
              font-weight: 800;
              color: #d32f2f;
              line-height: 1.0;
              margin-bottom: ${M.size==="card"?"0px":"1px"};
            }
            .qr-code-section {
              flex-shrink: 0;
              display: flex;
              align-items: center;
              justify-content: center;
              width: 100%;
              height: auto;
              padding: 2px 0;
              overflow: hidden;
              box-sizing: border-box;
            }
            .qr-code-img {
              width: ${M.size==="card"?"60px":M.size==="thermal"?"120px":"140px"};
              height: ${M.size==="card"?"60px":M.size==="thermal"?"120px":"140px"};
              max-width: 95%;
              max-height: 95%;
              border: 1px solid #e0e0e0;
              border-radius: 2px;
              background: white;
              object-fit: contain;
              image-rendering: -webkit-optimize-contrast;
              image-rendering: crisp-edges;
              image-rendering: pixelated;
            }
            .additional-info {
              margin: 0;
              font-size: ${M.size==="card"?"4px":M.size==="thermal"?"10px":"12px"};
              color: #888;
              line-height: 1.0;
              font-weight: 400;
            }
            ${M.layout==="minimal"?".additional-info { display: none; }":""}
            
            @media print {
              html, body {
                background: white !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                margin: 0 !important;
                padding: 0 !important;
              }
              .page-container {
                height: 100vh !important;
                page-break-after: avoid !important;
              }
              .label-container {
                page-break-inside: avoid !important;
                width: ${d?te:M.size==="card"?"28mm":M.size==="thermal"?"48mm":M.size==="A4"?"85mm":(M.size==="A5","130mm")} !important;
                height: ${d?r:M.size==="card"?"18mm":M.size==="thermal"?"65mm":M.size==="A4"?"105mm":(M.size==="A5","145mm")} !important;
                padding: ${M.size==="card"?"1.5mm":M.size==="thermal"?"8px":"15px"} !important;
                flex-direction: column !important;
                justify-content: space-between !important;
              }
              .qr-code-section {
                width: 100% !important;
                height: auto !important;
                overflow: hidden !important;
                box-sizing: border-box !important;
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
              }
              .qr-code-img {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                width: ${M.size==="card"?"65px":M.size==="thermal"?"125px":"145px"} !important;
                height: ${M.size==="card"?"65px":M.size==="thermal"?"125px":"145px"} !important;
                max-width: 95% !important;
                max-height: 95% !important;
                object-fit: contain !important;
              }
            }
          </style>
        </head>
        <body>
          <div class="page-container">
            <div class="label-container">
              <div class="product-info">
                <div class="product-price">${p(V.currentPrice||V.price)} so'm</div>
                <div class="product-code">Kod: ${V.code}</div>
                <div class="product-name">${V.name}</div>
                
                ${M.layout==="standard"?`
                  <div class="additional-info">
                    Miqdor: ${V.quantity} | ${new Date().toLocaleDateString("uz-UZ")}
                  </div>
                `:""}
              </div>
              
              <div class="qr-code-section">
                <img src="${H}" alt="QR Code" class="qr-code-img" />
              </div>
            </div>
          </div>
        </body>
        </html>
      `,ae=window.open("","_blank","width=1024,height=768");if(!ae){alert("Popup blocker tomonidan to'sib qo'yildi. Popup'larni yoqing.");return}ae.document.open(),ae.document.write(Y),ae.document.close(),ae.onload=()=>{setTimeout(()=>{ae.focus(),ae.print(),setTimeout(()=>{ae.close()},1e3)},500)},Me(!1)}catch(d){console.error("Error generating print content:",d),alert("Chop uchun tayyorlashda xatolik yuz berdi")}}),gs={total:x.length,lowStock:x.filter(d=>d.quantity<=(d.minStock||50)&&d.quantity>0).length,outOfStock:x.filter(d=>d.quantity===0).length,totalValue:x.reduce((d,te)=>d+te.price*te.quantity,0)},Ns=d=>{if(d.images&&d.images.length>0){const te=typeof d.images[0]=="string"?d.images[0]:d.images[0].path;return`${Ls}${te}`}return null},js=[{label:"Jami tovarlar",value:gs.total,icon:Ke,color:"brand",filter:"all"},{label:"Kam qolgan",value:gs.lowStock,icon:Rs,color:"warning",filter:"low"},{label:"Tugagan",value:gs.outOfStock,icon:ge,color:"danger",filter:"out"},{label:"Jami qiymat",value:`${p(gs.totalValue)} so'm`,icon:ds,color:"success",filter:null}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-slate-100 to-slate-50 pb-20 lg:pb-0",children:[o,e.jsxs("div",{className:"p-3 lg:p-5 space-y-3 max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-9 h-9 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx(Ke,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-bold text-slate-900",children:"Tovarlar"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Asosiy ombor"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:ss,disabled:W,className:"flex items-center justify-center gap-1.5 px-3 py-2 bg-white text-slate-700 rounded-lg hover:bg-slate-50 transition-all disabled:opacity-50 border border-slate-200 shadow-sm text-sm font-medium",title:"Tovarlar ro'yxatini yangilash (F5)",children:[e.jsx(Os,{className:`w-3.5 h-3.5 ${W?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:W?"Yangilanmoqda...":"Yangilash"})]})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-2",children:js.map((d,te)=>e.jsx("div",{onClick:()=>d.filter&&y(d.filter),className:`bg-white rounded-xl border-2 transition-all ${d.filter?"cursor-pointer hover:shadow-lg hover:scale-[1.02]":""} ${m===d.filter?"border-brand-500 shadow-md":"border-slate-200"}`,children:e.jsxs("div",{className:"p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("div",{className:`w-7 h-7 rounded-lg flex items-center justify-center bg-${d.color}-50`,children:e.jsx(d.icon,{className:`w-3.5 h-3.5 text-${d.color}-600`})}),e.jsx("p",{className:"text-[10px] text-slate-500 font-semibold uppercase tracking-wide",children:d.label})]}),e.jsx("p",{className:"text-lg font-black text-slate-900",children:d.value})]})},te))}),e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Tovar nomi yoki kodi bo'yicha qidirish...",value:$,onChange:d=>C(d.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-slate-200 rounded-xl focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-100 bg-white shadow-sm text-sm"})]}),e.jsx("div",{className:"bg-gradient-to-r from-white to-slate-50 rounded-xl p-2 border border-slate-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-1.5 overflow-x-auto scrollbar-hide pb-1",children:[e.jsx("button",{onClick:()=>j(""),className:`flex-shrink-0 px-3 py-1.5 rounded-lg font-semibold text-xs transition-all ${k===""?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-md scale-105":"bg-white text-slate-600 hover:bg-slate-100 border border-slate-200"}`,children:"Barchasi"}),Mt.map(d=>e.jsx("button",{onClick:()=>j(d),className:`flex-shrink-0 px-3 py-1.5 rounded-lg font-semibold text-xs transition-all whitespace-nowrap ${k===d?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-md scale-105":"bg-white text-slate-600 hover:bg-slate-100 border border-slate-200"}`,children:d},d))]})}),e.jsx("div",{className:"card p-0 overflow-hidden",children:f?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"spinner text-brand-600 w-8 h-8 mb-4"}),e.jsx("p",{className:"text-surface-500",children:"Yuklanmoqda..."})]}):h.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(Ke,{className:"w-8 h-8 text-surface-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-2",children:"Tovarlar topilmadi"}),e.jsx("p",{className:"text-surface-500 text-center max-w-md",children:$?"Qidiruv bo'yicha tovarlar topilmadi":"Tovarlar mavjud emas"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden lg:block",children:[e.jsx("div",{className:"table-header",children:e.jsxs("div",{className:"grid grid-cols-14 gap-2 px-4 py-4",children:[e.jsx("span",{className:"table-header-cell col-span-1",children:"Rasm"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Kod"}),e.jsx("span",{className:"table-header-cell col-span-2",children:"Nomi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Tan narxi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Dona narxi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Karobka"}),e.jsx("span",{className:"table-header-cell col-span-3",children:"Chegirmalar"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Oldingi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Hozirgi"}),e.jsx("span",{className:"table-header-cell col-span-1",children:"Miqdori"})]})}),e.jsx("div",{className:"max-h-[calc(100vh-400px)] overflow-y-auto divide-y divide-surface-100",children:h.map(d=>{var te,r,T,H,Y,ae,fe,re,pe,De,Ve,vs;return e.jsxs("div",{className:"grid grid-cols-14 gap-2 px-4 py-3 items-center hover:bg-surface-50 transition-colors relative",children:[e.jsx("div",{className:"col-span-1",children:Ns(d)?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:Ns(d),alt:d.name,className:"w-10 h-10 rounded-lg object-cover cursor-pointer hover:scale-110 transition-transform",onClick:()=>{He(Ns(d)),Oe(!0)}}),e.jsx("button",{onClick:ps=>{var ks;ps.stopPropagation(),he(d._id),(ks=me.current)==null||ks.click()},disabled:be&&I===d._id,className:"absolute -top-0.5 -right-0.5 flex items-center justify-center w-4 h-4 bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-full shadow-sm hover:shadow-md transition-all duration-200 hover:scale-110 disabled:opacity-50",title:"Rasm yuklash",children:be&&I===d._id?e.jsx("div",{className:"w-2 h-2 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(St,{className:"w-2 h-2 text-white"})})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-lg flex items-center justify-center",children:e.jsx(mr,{className:"w-5 h-5 text-surface-400"})}),e.jsx("button",{onClick:ps=>{var ks;ps.stopPropagation(),he(d._id),(ks=me.current)==null||ks.click()},disabled:be&&I===d._id,className:"absolute -top-0.5 -right-0.5 flex items-center justify-center w-4 h-4 bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-full shadow-sm hover:shadow-md transition-all duration-200 hover:scale-110 disabled:opacity-50",title:"Rasm yuklash",children:be&&I===d._id?e.jsx("div",{className:"w-2 h-2 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(St,{className:"w-2 h-2 text-white"})})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"font-mono text-xs bg-surface-100 px-1.5 py-0.5 rounded",children:d.code})}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"font-medium text-surface-900 text-sm truncate",children:d.name})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-surface-700 text-sm",children:p(d.costPrice||0)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-brand-600 text-sm",children:p(d.unitPrice||d.price)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"font-semibold text-orange-600 text-sm",children:d.boxPrice>0?p(d.boxPrice):"-"})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[((r=(te=d.pricingTiers)==null?void 0:te.tier1)==null?void 0:r.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-emerald-50 text-emerald-700 rounded text-[10px] font-bold",children:[d.pricingTiers.tier1.minQuantity,"-",d.pricingTiers.tier1.maxQuantity,": ",d.pricingTiers.tier1.discountPercent,"%"]}),((H=(T=d.pricingTiers)==null?void 0:T.tier2)==null?void 0:H.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded text-[10px] font-bold",children:[d.pricingTiers.tier2.minQuantity,"-",d.pricingTiers.tier2.maxQuantity,": ",d.pricingTiers.tier2.discountPercent,"%"]}),((ae=(Y=d.pricingTiers)==null?void 0:Y.tier3)==null?void 0:ae.discountPercent)>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-purple-50 text-purple-700 rounded text-[10px] font-bold",children:[d.pricingTiers.tier3.minQuantity,"+: ",d.pricingTiers.tier3.discountPercent,"%"]}),!((re=(fe=d.pricingTiers)==null?void 0:fe.tier1)!=null&&re.discountPercent)&&!((De=(pe=d.pricingTiers)==null?void 0:pe.tier2)!=null&&De.discountPercent)&&!((vs=(Ve=d.pricingTiers)==null?void 0:Ve.tier3)!=null&&vs.discountPercent)&&e.jsx("span",{className:"text-surface-400 text-xs",children:"-"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:`font-semibold text-sm ${(()=>{const ps=d.previousPrice||0,ks=d.currentPrice||d.price;return ps>0&&ks>0&&ps!==ks?"line-through text-red-500":"text-surface-900"})()}`,children:p(d.previousPrice||0)})}),e.jsxs("div",{className:"col-span-1 relative",children:[(()=>{const ps=d.previousPrice||0,ks=d.currentPrice||d.price;if(ps>0&&ks>0&&ps!==ks){const $s=Math.round((ps-ks)/ps*100);if($s>0)return e.jsxs("div",{className:"absolute -top-2 -right-1 px-1 py-0.5 bg-red-500 text-white rounded text-[9px] font-bold",children:["-",$s,"%"]});if($s<0)return e.jsxs("div",{className:"absolute -top-2 -right-1 px-1 py-0.5 bg-green-500 text-white rounded text-[9px] font-bold",children:["+",Math.abs($s),"%"]})}return null})(),e.jsx("p",{className:"font-semibold text-surface-900 text-sm",children:p(d.currentPrice||d.price)})]}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`font-semibold text-sm ${d.quantity===0?"text-danger-600":d.quantity<=(d.minStock||100)?"text-warning-600":"text-success-600"}`,children:d.quantity})})]},d._id)})})]}),e.jsxs("div",{className:"lg:hidden",children:[e.jsxs("div",{ref:ze,className:"max-h-[calc(100vh-300px)] overflow-y-auto p-3 sm:p-4",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-2 sm:gap-3",children:P.map(d=>e.jsx("div",{className:"group bg-white rounded-lg sm:rounded-xl border-2 border-slate-200 hover:border-brand-300 hover:shadow-lg transition-all p-2 sm:p-4 relative",children:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"w-full aspect-square bg-gradient-to-br from-brand-100 to-brand-50 rounded-xl border-2 border-brand-200 flex items-center justify-center mb-2 sm:mb-3 group-hover:scale-105 transition-transform overflow-hidden cursor-pointer relative",onClick:()=>{if(d.images&&d.images.length>0){const te=typeof d.images[0]=="string"?d.images[0]:d.images[0].path;He(`${Ls}${te}`),Oe(!0)}},children:d.images&&d.images.length>0?e.jsx(e.Fragment,{children:e.jsx("img",{src:`${Ls}${typeof d.images[0]=="string"?d.images[0]:d.images[0].path}`,alt:d.name,className:"w-full h-full object-cover",onError:te=>{te.currentTarget.style.display="none",te.currentTarget.parentElement.innerHTML='<svg class="w-6 h-6 sm:w-8 sm:h-8 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>'}})}):e.jsx(Ke,{className:"w-6 h-6 sm:w-8 sm:h-8 text-brand-600"})}),e.jsx("p",{className:"font-semibold text-slate-900 text-[10px] sm:text-sm truncate",children:d.name}),e.jsxs("div",{className:"flex items-center gap-1.5 mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[9px] sm:text-xs text-slate-500",children:d.code}),e.jsx("button",{onClick:te=>{var r;te.stopPropagation(),he(d._id),(r=me.current)==null||r.click()},disabled:be&&I===d._id,className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex items-center justify-center bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-full shadow-sm hover:shadow-md transition-all duration-200 hover:scale-110 disabled:opacity-50",title:"Rasm yuklash",children:be&&I===d._id?e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(St,{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 text-white"})})]}),e.jsxs("p",{className:"font-bold text-brand-600 text-[10px] sm:text-sm",children:[p(d.price)," so'm"]}),e.jsxs("p",{className:"text-[9px] sm:text-xs text-slate-500 mt-1",children:["Mavjud: ",d.quantity," ta"]})]})},d._id))}),S<h.length&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"w-6 h-6 border-2 border-brand-500 border-t-transparent rounded-full animate-spin"})})]}),e.jsx("input",{ref:me,type:"file",accept:"image/*",multiple:!0,onChange:d=>{I&&se(I,d)},className:"hidden"})]})]})})]}),ue&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start sm:items-center justify-center p-2 pt-4 sm:p-4",children:[e.jsx("div",{className:"overlay",onClick:os}),e.jsxs("div",{className:"modal w-full sm:max-w-lg p-4 sm:p-6 relative z-10 max-h-[calc(100vh-120px)] sm:max-h-[85vh] overflow-y-auto rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6 sticky top-0 bg-white pb-3 border-b border-surface-200 -mx-4 sm:-mx-6 px-4 sm:px-6 z-10",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-surface-900",children:E?"Tovarni tahrirlash":"Yangi tovar"}),e.jsx("button",{onClick:os,className:"btn-icon-sm",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:Je,className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Rasmlar (max 8)"}),e.jsxs("div",{className:"grid grid-cols-4 gap-1.5 sm:gap-2 mb-2",children:[Z.map((d,te)=>e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:`${Ls}${d}`,alt:"",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>is(d),className:"absolute -top-1 -right-1 w-4 h-4 sm:w-5 sm:h-5 bg-danger-500 text-white rounded-full flex items-center justify-center",children:e.jsx(ge,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})})]},te)),Z.length<8&&e.jsx("button",{type:"button",onClick:()=>{var d;return(d=me.current)==null?void 0:d.click()},disabled:be,className:"aspect-square border-2 border-dashed border-surface-300 rounded-lg flex flex-col items-center justify-center hover:border-brand-500 hover:bg-brand-50 transition-colors",children:be?e.jsx("div",{className:"spinner w-4 h-4 sm:w-5 sm:h-5 text-brand-600"}):e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-4 h-4 sm:w-5 sm:h-5 text-surface-400 mb-0.5 sm:mb-1"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-surface-500",children:"Yuklash"})]})})]}),e.jsx("input",{ref:me,type:"file",accept:"image/*",multiple:!0,onChange:as,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Kod"}),e.jsx("input",{type:"text",className:`input text-sm sm:text-base py-2 sm:py-2.5 ${Ce?"border-danger-500 focus:border-danger-500 focus:ring-danger-500/20":""}`,placeholder:"1",value:O.code,onChange:d=>_(N(b({},O),{code:d.target.value})),onBlur:d=>Cs(d.target.value),required:!0}),Ce&&e.jsx("p",{className:"text-xs sm:text-sm text-danger-600 mt-1",children:Ce})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Miqdori"}),E?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"flex-1 px-2 sm:px-4 py-2 sm:py-3 bg-surface-100 rounded-xl text-center font-semibold text-surface-900 text-sm sm:text-base",children:p(O.quantity||0)}),e.jsx("button",{type:"button",onClick:()=>bs("add"),className:"btn-icon bg-success-100 text-success-600 hover:bg-success-200 w-8 h-8 sm:w-10 sm:h-10",children:e.jsx(ys,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{type:"button",onClick:()=>bs("subtract"),className:"btn-icon bg-danger-100 text-danger-600 hover:bg-danger-200 w-8 h-8 sm:w-10 sm:h-10",children:e.jsx(Xt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}):e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"0",value:us(O.quantity),onChange:d=>_(N(b({},O),{quantity:Ge(d.target.value)})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Nomi"}),e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"Tovar nomi",value:O.name,onChange:d=>_(N(b({},O),{name:d.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Oldingi narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"0",value:us(O.previousPrice),onChange:d=>_(N(b({},O),{previousPrice:Ge(d.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-surface-700 mb-1.5 sm:mb-2 block",children:"Hozirgi narxi (so'm)"}),e.jsx("input",{type:"text",className:"input text-sm sm:text-base py-2 sm:py-2.5",placeholder:"0",value:us(O.currentPrice),onChange:d=>_(N(b({},O),{currentPrice:Ge(d.target.value)})),required:!0}),O.previousPrice&&O.currentPrice&&Number(O.previousPrice)>0&&Number(O.currentPrice)>0&&e.jsx("div",{className:"mt-1.5 sm:mt-2",children:(()=>{const d=Number(O.previousPrice),te=Number(O.currentPrice),r=Math.round((d-te)/d*100);return r>0?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1.5 sm:py-2 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-green-500 rounded-full"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-green-700",children:[r,"% chegirma"]})]}):r<0?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1.5 sm:py-2 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-red-500 rounded-full"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-red-700",children:[Math.abs(r),"% qimmatroq"]})]}):null})()})]})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-3 flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-brand-600"}),"O'lchov birligi"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Birlik"}),e.jsxs("select",{className:"input",value:O.unit,onChange:d=>_(N(b({},O),{unit:d.target.value})),children:[e.jsx("option",{value:"dona",children:"Dona"}),e.jsx("option",{value:"metr",children:"Metr"}),e.jsx("option",{value:"rulon",children:"Rulon"}),e.jsx("option",{value:"karobka",children:"Karobka/Quti"}),e.jsx("option",{value:"gram",children:"Gram"}),e.jsx("option",{value:"kg",children:"Kilogram"}),e.jsx("option",{value:"litr",children:"Litr"})]})]}),(O.unit==="rulon"||O.unit==="karobka")&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:["1 ",O.unit==="rulon"?"rulon":"karobka"," = ?"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"input flex-1",placeholder:"30",value:O.conversionRate,onChange:d=>_(N(b({},O),{conversionRate:Ge(d.target.value),conversionEnabled:!0}))}),e.jsxs("select",{className:"input w-24",value:O.baseUnit,onChange:d=>_(N(b({},O),{baseUnit:d.target.value})),children:[e.jsx("option",{value:"metr",children:"metr"}),e.jsx("option",{value:"dona",children:"dona"})]})]})]})]}),O.conversionEnabled&&O.conversionRate&&O.quantity&&e.jsx("div",{className:"mt-3 p-3 bg-purple-50 rounded-xl",children:e.jsxs("p",{className:"text-sm text-purple-700",children:[e.jsx("span",{className:"font-semibold",children:p(O.quantity)})," ",O.unit==="rulon"?"rulon":"karobka"," =",e.jsx("span",{className:"font-semibold ml-1",children:p(Number(O.quantity)*Number(O.conversionRate))})," ",O.baseUnit]})})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-surface-900 mb-3 flex items-center gap-2",children:[e.jsx(ds,{className:"w-4 h-4 text-green-600"}),"Qo'shimcha narxlar (ixtiyoriy)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Metr narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:us(O.pricePerMeter),onChange:d=>_(N(b({},O),{pricePerMeter:Ge(d.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Rulon narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:us(O.pricePerRoll),onChange:d=>_(N(b({},O),{pricePerRoll:Ge(d.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Karobka narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:us(O.pricePerBox),onChange:d=>_(N(b({},O),{pricePerBox:Ge(d.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-surface-600 mb-1 block",children:"Kg narxi"}),e.jsx("input",{type:"text",className:"input text-sm py-2",placeholder:"0",value:us(O.pricePerKg),onChange:d=>_(N(b({},O),{pricePerKg:Ge(d.target.value)}))})]})]})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 pt-3 sm:pt-4 sticky bottom-0 bg-white pb-safe -mx-4 sm:-mx-6 px-4 sm:px-6 border-t border-surface-200 mt-4 z-10",children:[e.jsx("button",{type:"button",onClick:os,className:"btn-secondary flex-1 text-sm sm:text-base py-2.5 sm:py-3",children:"Bekor qilish"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1 text-sm sm:text-base py-2.5 sm:py-3",disabled:!!Ce,children:"Saqlash"})]})]})]})]}),K&&V&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>Se(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"QR Kod"}),e.jsx("button",{onClick:()=>Se(!1),className:"btn-icon-sm",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border border-surface-200 mb-4",children:e.jsx(Bt,{id:"qr-code-svg",value:`${window.location.origin}/product/${V._id}`,size:200,level:"H",includeMargin:!0})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-semibold text-surface-900",children:V.name}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Kod: ",V.code]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Oldingi narxi: ",p(V.previousPrice||0)," so'm"]}),e.jsxs("p",{className:"text-sm text-surface-500",children:["Hozirgi narxi: ",p(V.currentPrice||V.price)," so'm"]})]}),e.jsxs("button",{onClick:zs,className:"btn-primary w-full",children:[e.jsx(da,{className:"w-4 h-4"}),"Yuklab olish"]})]})]})]}),je&&V&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>Me(!1)}),e.jsxs("div",{className:"modal w-full max-w-4xl p-6 relative z-10 max-h-[92vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Print sozlamalari"}),e.jsx("button",{onClick:()=>Me(!1),className:"btn-icon-sm",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Printer tanlash"}),e.jsxs("select",{className:"input",value:M.printer,onChange:d=>Te(N(b({},M),{printer:d.target.value})),children:[e.jsx("option",{value:"",children:"Printer tanlang"}),Re.map(d=>e.jsx("option",{value:d,children:d},d))]}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Print tugmasini bosganda Windows print dialog ochiladi va barcha mavjud printerlarni ko'rsatadi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Qog'oz o'lchami"}),e.jsxs("select",{className:"input",value:M.size,onChange:d=>Te(N(b({},M),{size:d.target.value})),children:[e.jsx("option",{value:"card",children:"Kichik yorliq (50Ã—25mm)"}),e.jsx("option",{value:"A4",children:"A4 (210Ã—297mm)"}),e.jsx("option",{value:"A5",children:"A5 (148Ã—210mm)"}),e.jsx("option",{value:"thermal",children:"Thermal (80Ã—120mm)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Shablon"}),e.jsxs("select",{className:"input",value:M.layout,onChange:d=>Te(N(b({},M),{layout:d.target.value})),children:[e.jsx("option",{value:"standard",children:"Standart (barcha ma'lumotlar)"}),e.jsx("option",{value:"minimal",children:"Minimal (faqat asosiy ma'lumotlar)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Nusxalar soni"}),e.jsx("input",{type:"number",min:"1",max:"10",className:"input",value:M.copies,onChange:d=>Te(N(b({},M),{copies:parseInt(d.target.value)||1}))})]}),e.jsxs("div",{className:"border-t border-surface-200 pt-4",children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:"Maxsus o'lcham (ixtiyoriy)"}),e.jsx("p",{className:"text-xs text-surface-500 mb-3",children:"Agar maxsus o'lcham belgilasangiz, u qog'oz o'lchamidan ustun bo'ladi"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-600 mb-1 block",children:"Eni (mm)"}),e.jsx("input",{type:"number",min:"1",className:"input",placeholder:"Masalan: 50",value:M.customWidth,onChange:d=>Te(N(b({},M),{customWidth:d.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-surface-600 mb-1 block",children:"Bo'yi (mm)"}),e.jsx("input",{type:"number",min:"1",className:"input",placeholder:"Masalan: 25",value:M.customHeight,onChange:d=>Te(N(b({},M),{customHeight:d.target.value}))})]})]})]})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-surface-700 mb-3",children:"Ko'rinish"}),e.jsx("div",{className:"bg-white shadow-md rounded-xl p-6 flex justify-center items-start min-h-[420px]",children:e.jsx("div",{className:"bg-white border border-gray-200 shadow-lg rounded-xl",style:{width:M.customWidth&&M.customHeight?`${M.customWidth}mm`:M.size==="card"?"26mm":M.size==="thermal"?"48mm":M.size==="A4"?"80mm":M.size==="A5"?"140mm":"120mm",height:M.customWidth&&M.customHeight?`${M.customHeight}mm`:M.size==="card"?"17mm":M.size==="thermal"?"65mm":M.size==="A4"?"105mm":M.size==="A5"?"145mm":"140mm",fontSize:M.size==="card"?"5px":M.size==="thermal"?"9px":"11px",transform:M.size==="card"?"scale(4.2)":M.size==="thermal"?"scale(2.1)":"scale(1.8)",transformOrigin:"center center",overflow:"hidden",padding:M.size==="card"?"1.2mm":M.size==="thermal"?"7px":"12px",borderRadius:"8px",background:"#ffffff",marginTop:"80px"},children:e.jsxs("div",{className:"flex flex-col justify-between h-full",style:{gap:M.size==="card"?"2px":"4px"},children:[e.jsxs("div",{className:"flex flex-col justify-center items-center text-center",style:{flex:1},children:[e.jsxs("div",{className:"font-bold",style:{fontSize:M.size==="card"?"10px":M.size==="thermal"?"18px":"22px",lineHeight:"1.0",marginBottom:M.size==="card"?"0px":"1px",fontWeight:"800",color:"#d32f2f"},children:[p(V.currentPrice||V.price)," so'm"]}),e.jsxs("div",{className:"text-gray-600",style:{fontSize:M.size==="card"?"6px":M.size==="thermal"?"12px":"16px",lineHeight:"1.0",marginBottom:M.size==="card"?"0.5px":"1px",fontWeight:"500",color:"#666"},children:["Kod: ",V.code]}),e.jsx("div",{className:"font-bold text-black",style:{fontSize:M.size==="card"?"7px":M.size==="thermal"?"14px":"18px",lineHeight:"1.1",marginBottom:M.size==="card"?"0.5px":"1px",fontWeight:"600",color:"#1a1a1a",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:M.size==="card"?1:2,WebkitBoxOrient:"vertical"},children:V.name}),M.layout==="standard"&&e.jsxs("div",{className:"text-gray-500",style:{fontSize:M.size==="card"?"4px":M.size==="thermal"?"10px":"12px",lineHeight:"1.0",margin:0,color:"#888",fontWeight:"400"},children:["Miqdor: ",V.quantity," | ",new Date().toLocaleDateString("uz-UZ")]})]}),e.jsx("div",{className:"flex justify-center items-center",style:{width:"100%",height:"auto",padding:"2px 0"},children:e.jsx("div",{style:{border:"1px solid #e2e8f0",borderRadius:"4px",background:"#ffffff",padding:"2px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Bt,{value:`${window.location.origin}/product/${V._id}`,size:M.size==="card"?60:M.size==="thermal"?120:140,level:"H",includeMargin:!1,style:{width:"100%",height:"100%",maxWidth:M.size==="card"?"60px":M.size==="thermal"?"120px":"140px",maxHeight:M.size==="card"?"60px":M.size==="thermal"?"120px":"140px",objectFit:"contain"}})})})]})})}),M.copies>1&&e.jsxs("p",{className:"text-xs text-surface-500 mt-2 text-center",children:[M.copies," nusxa chop etiladi"]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>Me(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsxs("button",{type:"button",onClick:Ts,className:"btn-primary flex-1",disabled:!M.printer,children:[e.jsx(nt,{className:"w-4 h-4"}),"Print"]})]})]})]}),Ie&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[e.jsx("div",{className:"overlay",onClick:()=>qe(!1)}),e.jsxs("div",{className:"modal w-full max-w-sm p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:ne==="add"?"Miqdor qo'shish":"Miqdor ayirish"}),e.jsx("button",{onClick:()=>qe(!1),className:"btn-icon-sm",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:`rounded-xl p-4 mb-6 ${ne==="add"?"bg-success-50":"bg-danger-50"}`,children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Hozirgi miqdor"}),e.jsxs("p",{className:`text-2xl font-bold ${ne==="add"?"text-success-600":"text-danger-600"}`,children:[p(O.quantity||0)," dona"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-surface-700 mb-2 block",children:ne==="add"?"Qo'shiladigan miqdor":"Ayiriladigan miqdor"}),e.jsx("input",{type:"text",className:"input text-center text-lg font-semibold",placeholder:"0",value:us(X),onChange:d=>ve(Ge(d.target.value)),autoFocus:!0})]}),X&&Number(X)>0&&e.jsxs("div",{className:"bg-surface-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-surface-600 mb-1",children:"Yangi miqdor"}),e.jsxs("p",{className:"text-xl font-bold text-surface-900",children:[p(ne==="add"?(Number(O.quantity)||0)+Number(X):Math.max(0,(Number(O.quantity)||0)-Number(X)))," dona"]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>qe(!1),className:"btn-secondary flex-1",children:"Bekor qilish"}),e.jsx("button",{type:"button",onClick:Is,className:`flex-1 ${ne==="add"?"btn-success":"btn-danger"}`,disabled:!X||Number(X)<=0,children:ne==="add"?"Qo'shish":"Ayirish"})]})]})]})]}),_e&&ts&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in",onClick:()=>Oe(!1),children:e.jsxs("div",{className:"relative max-w-6xl max-h-[90vh] w-full",children:[e.jsx("button",{onClick:()=>Oe(!1),className:"absolute -top-12 right-0 sm:right-0 w-10 h-10 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white transition-colors z-10",title:"Yopish (Esc)",children:e.jsx(ge,{className:"w-6 h-6"})}),e.jsx("div",{className:"relative bg-white rounded-2xl overflow-hidden shadow-2xl",onClick:d=>d.stopPropagation(),children:e.jsx("img",{src:ts,alt:"Mahsulot rasmi",className:"w-full h-auto max-h-[85vh] object-contain"})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-white/80 text-sm",children:"Yopish uchun rasmdan tashqariga bosing yoki ESC tugmasini bosing"})})]})})]})}function kn(){const{showAlert:a,AlertComponent:o}=Ps(),[n,x]=s.useState({botToken:"",chatId:"",isEnabled:!1}),[i,g]=s.useState(null),[v,h]=s.useState(null),[q,P]=s.useState(""),[w,S]=s.useState(""),[L,$]=s.useState(!1),[C,m]=s.useState(!1),[y,k]=s.useState(!1);s.useEffect(()=>{j();const K=window.location.origin.replace("5175","3002");S(`${K}/api/telegram/webhook`)},[]);const j=()=>Q(this,null,function*(){try{const K=yield U.get("/telegram/settings");x(K.data),K.data.botToken&&(f(),R())}catch(K){console.error("Error fetching telegram settings:",K)}}),f=()=>Q(this,null,function*(){try{const K=yield U.get("/telegram/bot-info");g(K.data)}catch(K){console.error("Error fetching bot info:",K)}}),R=()=>Q(this,null,function*(){try{const K=yield U.get("/telegram/webhook-info");h(K.data)}catch(K){console.error("Error fetching webhook info:",K)}}),W=()=>Q(this,null,function*(){if(!w.trim()){a("Webhook URL ni kiriting","Xatolik","warning");return}k(!0);try{yield U.post("/telegram/set-webhook",{webhookUrl:w}),a("Webhook muvaffaqiyatli o'rnatildi","Muvaffaqiyat","success"),R()}catch(K){a("Webhook o'rnatishda xatolik","Xatolik","danger")}finally{k(!1)}}),J=()=>Q(this,null,function*(){$(!0);try{yield U.post("/telegram/settings",n),a("Sozlamalar saqlandi","Muvaffaqiyat","success"),n.botToken&&f()}catch(K){a("Sozlamalarni saqlashda xatolik","Xatolik","danger")}finally{$(!1)}}),ue=()=>Q(this,null,function*(){if(!q.trim()){a("Test xabarini kiriting","Xatolik","warning");return}m(!0);try{yield U.post("/telegram/test",{message:q}),a("Test xabari yuborildi","Muvaffaqiyat","success"),P("")}catch(K){a("Xabar yuborishda xatolik","Xatolik","danger")}finally{m(!1)}}),de=()=>{i!=null&&i.username&&(navigator.clipboard.writeText(`@${i.username}`),a("Bot username nusxalandi","Muvaffaqiyat","success"))};return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20 lg:pb-0",children:[o,e.jsx(Ws,{title:"Telegram Sozlamalari"}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-4xl mx-auto",children:[i&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(xr,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Bot Ma'lumotlari"}),e.jsx("p",{className:"text-surface-500",children:"Telegram bot holati"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-surface-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Bot nomi"}),e.jsx("p",{className:"font-medium text-surface-900",children:i.first_name})]}),e.jsx("div",{className:"bg-surface-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-500 mb-1",children:"Username"}),e.jsxs("p",{className:"font-medium text-surface-900",children:["@",i.username]})]}),e.jsx("button",{onClick:de,className:"btn-icon-sm hover:bg-surface-200",title:"Nusxalash",children:e.jsx(Ca,{className:"w-4 h-4"})})]})})]}),e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ut,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-green-700 font-medium",children:"Bot faol"})]})})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-6",children:"Telegram Sozlamalari"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Bot Token"}),e.jsx("input",{type:"password",className:"input",placeholder:"Bot tokenini kiriting",value:n.botToken,onChange:K=>x(N(b({},n),{botToken:K.target.value}))}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"@BotFather dan olingan bot token"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Chat ID yoki Kanal Username"}),e.jsx("input",{type:"text",className:"input",placeholder:"@channel_name yoki -100xxxxxxxxx",value:n.chatId,onChange:K=>x(N(b({},n),{chatId:K.target.value}))}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Xabarlar yuboriladigan kanal yoki guruh"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"telegram-enabled",className:"w-4 h-4 text-brand-600 border-surface-300 rounded focus:ring-brand-500",checked:n.isEnabled,onChange:K=>x(N(b({},n),{isEnabled:K.target.checked}))}),e.jsx("label",{htmlFor:"telegram-enabled",className:"text-sm font-medium text-surface-700",children:"Telegram xabarlarini yoqish"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:J,disabled:L,className:"btn-primary",children:L?e.jsxs(e.Fragment,{children:[e.jsx(Os,{className:"w-4 h-4 animate-spin"}),"Saqlanmoqda..."]}):"Saqlash"})})]})]}),i&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(ga,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Webhook Sozlamalari"}),e.jsx("p",{className:"text-surface-500",children:"Mijozlarga chek yuborish uchun"})]})]}),v&&e.jsxs("div",{className:"mb-4 p-3 bg-surface-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-surface-700",children:"Joriy webhook:"}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${v.url?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:v.url?"Faol":"O'rnatilmagan"})]}),v.url&&e.jsx("p",{className:"text-xs text-surface-500 break-all",children:v.url})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Webhook URL"}),e.jsx("input",{type:"text",className:"input",placeholder:"https://your-domain.com/api/telegram/webhook",value:w,onChange:K=>S(K.target.value)}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"Server webhook URL manzili"})]}),e.jsx("button",{onClick:W,disabled:y||!w.trim(),className:"btn-secondary",children:y?e.jsxs(e.Fragment,{children:[e.jsx(Os,{className:"w-4 h-4 animate-spin"}),"O'rnatilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ga,{className:"w-4 h-4"}),"Webhook O'rnatish"]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(Ys,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900",children:"Mijozlar uchun yo'riqnoma"}),e.jsx("p",{className:"text-surface-500",children:"Cheklar olish uchun"})]})]}),e.jsxs("div",{className:"space-y-4 text-sm text-surface-600",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Mijozlar qanday qilib chek oladi:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-4 text-blue-800",children:[e.jsxs("li",{children:["Telegram da ",e.jsxs("strong",{children:["@",(i==null?void 0:i.username)||"your_bot"]})," botini topish"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"/start"})," buyrug'ini yuborish"]}),e.jsx("li",{children:"Telefon raqamini yuborish (masalan: +998901234567)"}),e.jsx("li",{children:"Ro'yxatdan o'tgandan keyin barcha cheklar avtomatik keladi"})]})]}),e.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[e.jsx("h4",{className:"font-medium text-amber-900 mb-2",children:"Muhim:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4 text-amber-800",children:[e.jsx("li",{children:"Mijoz avval botga /start berishi kerak"}),e.jsx("li",{children:"Telefon raqam bazada mavjud bo'lishi kerak"}),e.jsx("li",{children:"Webhook to'g'ri sozlangan bo'lishi kerak"})]})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-6",children:"Test Xabar"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-700 mb-2",children:"Test xabari"}),e.jsx("textarea",{className:"input",rows:3,placeholder:"Test xabarini kiriting...",value:q,onChange:K=>P(K.target.value)})]}),e.jsx("button",{onClick:ue,disabled:C||!n.botToken||!n.chatId,className:"btn-secondary",children:C?e.jsxs(e.Fragment,{children:[e.jsx(Os,{className:"w-4 h-4 animate-spin"}),"Yuborilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pa,{className:"w-4 h-4"}),"Test Xabar Yuborish"]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-900 mb-4",children:"Sozlash Yo'riqnomasi"}),e.jsxs("div",{className:"space-y-4 text-sm text-surface-600",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"1. Bot yaratish:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Telegram da @BotFather ga murojaat qiling"}),e.jsx("li",{children:"/newbot buyrug'ini yuboring"}),e.jsx("li",{children:"Bot nomini va username ni kiriting"}),e.jsx("li",{children:"Olingan tokenni yuqoridagi maydonga kiriting"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"2. Kanal/Guruh sozlash:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Telegram da kanal yoki guruh yarating"}),e.jsx("li",{children:"Botni kanalga admin qilib qo'shing"}),e.jsx("li",{children:"Kanal username ini (@channel_name) yoki Chat ID ni kiriting"}),e.jsx("li",{children:"Barcha xodimlar kanalga obuna bo'lsin"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"3. Mijozlarga chek yuborish:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Webhook URL ni to'g'ri o'rnating"}),e.jsx("li",{children:"Mijozlar botga /start berib ro'yxatdan o'tsin"}),e.jsx("li",{children:"Kassa panelida mijoz tanlanganda chek avtomatik yuboriladi"}),e.jsx("li",{children:"Faqat ro'yxatdan o'tgan mijozlarga chek boradi"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-surface-900 mb-2",children:"4. Xabar turlari:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Xarid cheklari (mijozlarga shaxsiy)"}),e.jsx("li",{children:"Yangi qarz qo'shilganda (admin kanaliga)"}),e.jsx("li",{children:"Qarz tasdiqlanganda (admin kanaliga)"}),e.jsx("li",{children:"To'lov qilinganida (admin kanaliga)"}),e.jsx("li",{children:"Kam qolgan mahsulotlar haqida (admin kanaliga)"})]})]})]})]})]})]})}function Sn(){const[a,o]=s.useState(""),[n,x]=s.useState(""),[i,g]=s.useState(!1),[v,h]=s.useState(""),[q,P]=s.useState(!1),w=Ks(),S=L=>Q(this,null,function*(){L.preventDefault(),h(""),P(!0);try{const $=yield U.post("/kassa-auth/login",{username:a.trim(),password:n});if($.data.success){$.data.token&&localStorage.setItem("token",$.data.token);const C={loggedIn:!0,timestamp:Date.now(),user:"kassa",username:$.data.data.username,sessionToken:$.data.data.sessionToken,expiresAt:$.data.data.expiresAt,locked:!0};localStorage.setItem("kassaLoggedIn",JSON.stringify(C)),window.history.replaceState(null,"","/kassa"),w("/kassa",{replace:!0})}else h($.data.message||"Login yoki parol noto'g'ri")}catch($){console.error("Login error:",$),h("Login yoki parol noto'g'ri")}finally{P(!1)}});return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden",style:{background:"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%)"},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 rounded-full blur-3xl",style:{background:"radial-gradient(circle, rgba(109, 40, 217, 0.15) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute top-1/4 right-1/4 w-64 h-64 rounded-full blur-2xl",style:{background:"radial-gradient(circle, rgba(6, 182, 212, 0.1) 0%, transparent 70%)"}})]}),e.jsxs("div",{className:"w-full max-w-sm relative z-10",children:[e.jsxs("div",{className:"text-center mb-6 animate-fade-up",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-4",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 8px 32px -8px rgba(6, 182, 212, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:e.jsx(za,{className:"w-10 h-10 text-white"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-7 h-7 rounded-full flex items-center justify-center",style:{background:"linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",boxShadow:"0 2px 8px -2px rgba(34, 197, 94, 0.5)"},children:e.jsx(qt,{className:"w-3.5 h-3.5 text-white"})})]}),e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{background:"linear-gradient(135deg, #2e1065 0%, #5b21b6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Kassa Tizimi"}),e.jsx("p",{className:"font-medium",style:{color:"#71717a"},children:"Sardor Furnitura - Kassa Paneli"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full animate-pulse",style:{background:"#22c55e"}}),e.jsx("span",{className:"text-sm",style:{color:"#a1a1aa"},children:"Xavfsiz tizim"})]})]}),e.jsxs("div",{className:"rounded-2xl p-6 animate-fade-up",style:{background:"linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 245, 255, 0.95) 100%)",border:"1px solid rgba(139, 92, 246, 0.15)",boxShadow:"0 20px 40px -12px rgba(109, 40, 217, 0.2)",backdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-1",style:{color:"#2e1065"},children:"Kassa tizimiga kirish"}),e.jsx("p",{style:{color:"#71717a"},children:"Hisobingiz bilan tizimga kiring"})]}),v&&e.jsx("div",{className:"rounded-xl p-4 mb-6 animate-fade-in",style:{background:"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)",border:"1px solid #fca5a5"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"#ef4444"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"#991b1b"},children:"Xatolik"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#b91c1c"},children:v})]})]})}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(Fs,{className:"w-3.5 h-3.5"}),"Login"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Fs,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:"text",placeholder:"Login",value:a,onChange:L=>o(L.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:"#5b21b6"},children:[e.jsx(Qs,{className:"w-3.5 h-3.5"}),"Parol"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Qs,{className:"w-4 h-4 transition-colors",style:{color:"#a1a1aa"}})}),e.jsx("input",{type:i?"text":"password",placeholder:"Parol",value:n,onChange:L=>x(L.target.value),className:"w-full pl-10 pr-10 py-3 rounded-xl transition-all duration-200 focus:outline-none",style:{background:"linear-gradient(135deg, #ffffff 0%, #faf5ff 100%)",border:"1.5px solid #ddd6fe",color:"#2e1065"},required:!0}),e.jsx("button",{type:"button",onClick:()=>g(!i),className:"absolute inset-y-0 right-0 pr-3 flex items-center transition-colors",style:{color:"#a1a1aa"},children:i?e.jsx(Lt,{className:"w-4 h-4"}):e.jsx(Gs,{className:"w-4 h-4"})})]})]}),e.jsx("button",{type:"submit",disabled:q,className:"w-full text-white font-semibold py-3.5 px-4 rounded-xl transition-all duration-200 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group",style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 4px 14px -2px rgba(6, 182, 212, 0.4)"},children:q?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Kirish..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Kirish"}),e.jsx(aa,{className:"w-4 h-4 transition-transform group-hover:translate-x-1"})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"pt-4",style:{borderTop:"1px solid #ede9fe"},children:e.jsxs("div",{className:"rounded-xl p-4 mb-4",style:{background:"linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%)"},children:[e.jsx("p",{className:"font-medium text-sm mb-3",style:{color:"#5b21b6"},children:"Admin uchun:"}),e.jsx("a",{href:"/login",className:"inline-flex items-center justify-center gap-2 font-semibold transition-colors text-base underline decoration-2 underline-offset-4",style:{color:"#7c3aed"},children:e.jsx("span",{children:"Admin panel â†’"})})]})})})})]}),e.jsxs("div",{className:"text-center mt-6 animate-fade-up",children:[e.jsx("p",{className:"text-sm",style:{color:"#71717a"},children:"Â© 2025 Sardor Furnitura. Barcha huquqlar himoyalangan."}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-2 text-xs",style:{color:"#a1a1aa"},children:[e.jsx("span",{children:"Xavfsiz"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Professional"}),e.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:"#ddd6fe"}}),e.jsx("span",{children:"Ishonchli"})]})]})]})]})}const Cn="/api",qn=(a,o)=>{const n={dona:{single:"dona",plural:"dona"},metr:{single:"metr",plural:"metr"},rulon:{single:"rulon",plural:"rulon"},karobka:{single:"quti",plural:"quti"},gram:{single:"gram",plural:"gram"},kg:{single:"kg",plural:"kg"},litr:{single:"litr",plural:"litr"}};return(n[a||"dona"]||n.dona).single};function Pn(){var C,m,y;const{id:a}=ur(),o=Ks(),[n,x]=s.useState(null),[i,g]=s.useState(!0),[v,h]=s.useState(""),[q,P]=s.useState(!1);s.useEffect(()=>{a&&w()},[a]),s.useEffect(()=>(q?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[q]);const w=()=>Q(this,null,function*(){var k,j;try{const f=yield $a.get(`${Cn}/products/public/${a}`);x(f.data)}catch(f){console.error("Error fetching product:",f),h(((j=(k=f.response)==null?void 0:k.data)==null?void 0:j.message)||"Mahsulot topilmadi")}finally{g(!1)}}),S=[{icon:na,label:"Bosh sahifa",path:"/"},{icon:et,label:"Mahsulotlar",path:"/admin/products"},{icon:hs,label:"Kassa",path:"/admin/kassa"},{icon:Ys,label:"Mijozlar",path:"/admin/customers"},{icon:Zs,label:"Qarzlar",path:"/admin/debts"},{icon:ea,label:"Omborlar",path:"/admin/warehouses"},{icon:la,label:"Hodimlar",path:"/admin/helpers"},{icon:_t,label:"Statistika",path:"/admin/dashboard"},{icon:zt,label:"QR Scanner",path:"/helper/scanner"}];if(i)return e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-brand-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-surface-600",children:"Yuklanmoqda..."})]})});if(v||!n)return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-surface-100 to-surface-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-red-100 to-red-200 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx(Ke,{className:"w-12 h-12 text-red-500"})}),e.jsx("h1",{className:"text-2xl font-bold text-surface-900 mb-3",children:"Mahsulot topilmadi"}),e.jsx("p",{className:"text-surface-500 mb-8",children:v||"Bu mahsulot mavjud emas yoki o'chirilgan"}),e.jsx("button",{onClick:()=>o("/"),className:"px-8 py-3.5 bg-gradient-to-r from-brand-500 to-brand-600 text-white rounded-2xl font-semibold hover:from-brand-600 hover:to-brand-700 transition-all shadow-lg shadow-brand-500/30",children:"Bosh sahifaga qaytish"})]})});const L=n.tierPrices&&(n.tierPrices.tier1||n.tierPrices.tier2||n.tierPrices.tier3),$=qn(n.unit);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-surface-100 to-white",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-lg border-b border-surface-200/50 sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-3 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>o(-1),className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center hover:bg-surface-200 transition-colors active:scale-95",children:e.jsx(qa,{className:"w-5 h-5 text-surface-700"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-base font-semibold text-surface-900 truncate",children:n.name}),e.jsxs("p",{className:"text-xs text-surface-500",children:["Kod: ",n.code]})]}),e.jsx("button",{onClick:()=>P(!0),className:"w-10 h-10 bg-brand-500 rounded-xl flex items-center justify-center hover:bg-brand-600 transition-colors active:scale-95 shadow-lg shadow-brand-500/30",children:e.jsx(Tt,{className:"w-5 h-5 text-white"})})]})}),q&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] transition-opacity",onClick:()=>P(!1)}),e.jsxs("div",{className:"fixed top-0 right-0 bottom-0 w-80 max-w-[85vw] bg-white z-[100] shadow-2xl transform transition-transform",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-black text-white",children:"SF"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-brand-100 text-xs",children:"Mebel furniturasi"})]})]}),e.jsx("button",{onClick:()=>P(!1),className:"w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center hover:bg-white/30 transition-colors",children:e.jsx(ge,{className:"w-5 h-5 text-white"})})]})}),e.jsxs("div",{className:"overflow-y-auto h-[calc(100vh-140px)] p-4",children:[e.jsx("div",{className:"space-y-1",children:S.map((k,j)=>{const f=k.icon;return e.jsxs("button",{onClick:()=>{o(k.path),P(!1)},className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-surface-50 transition-colors group",children:[e.jsx("div",{className:"w-11 h-11 bg-surface-100 rounded-xl flex items-center justify-center group-hover:bg-brand-50 group-hover:scale-110 transition-all",children:e.jsx(f,{className:"w-5 h-5 text-surface-600 group-hover:text-brand-600"})}),e.jsx("span",{className:"font-medium text-surface-900 group-hover:text-brand-600 transition-colors",children:k.label}),e.jsx(Vt,{className:"w-4 h-4 text-surface-300 ml-auto group-hover:text-brand-600 group-hover:translate-x-1 transition-all"})]},j)})}),e.jsxs("div",{className:"mt-6 p-4 bg-surface-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-surface-500 text-center mb-2",children:"QR kod orqali ko'rilmoqda"}),e.jsx("p",{className:"text-xs text-surface-400 text-center",children:new Date().toLocaleDateString("uz-UZ",{year:"numeric",month:"long",day:"numeric"})})]})]})]})]}),e.jsxs("div",{className:"max-w-lg mx-auto pb-8",children:[e.jsxs("div",{className:"relative",children:[n.images&&n.images.length>0?e.jsx("div",{className:"aspect-square bg-white",children:e.jsx("img",{src:`${Ls}${typeof n.images[0]=="string"?n.images[0]:n.images[0].path}`,alt:n.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-square bg-gradient-to-br from-brand-50 via-brand-100 to-indigo-100 flex items-center justify-center",children:e.jsx("div",{className:"w-24 h-24 bg-white/60 backdrop-blur rounded-3xl flex items-center justify-center shadow-xl",children:e.jsx(Ke,{className:"w-12 h-12 text-brand-500"})})}),e.jsx("div",{className:`absolute top-4 right-4 px-4 py-2 rounded-full text-sm font-bold shadow-lg ${n.quantity>10?"bg-gradient-to-r from-emerald-400 to-green-500 text-white":n.quantity>0?"bg-gradient-to-r from-amber-400 to-orange-400 text-white":"bg-gradient-to-r from-red-500 to-rose-500 text-white"}`,children:n.quantity>0?`âœ“ ${n.quantity} ${$} mavjud`:"âœ• Tugagan"})]}),e.jsxs("div",{className:"px-4 -mt-6 relative z-10 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-xl shadow-surface-200/50",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-surface-900 mb-1",children:n.name}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"px-2.5 py-1 bg-surface-100 rounded-lg text-xs font-mono text-surface-600",children:["#",n.code]}),e.jsx("span",{className:"px-2.5 py-1 bg-brand-50 text-brand-600 rounded-lg text-xs font-medium",children:$}),n.dimensions&&(n.dimensions.width||n.dimensions.height||n.dimensions.length)&&e.jsxs("span",{className:"px-2.5 py-1 bg-purple-50 text-purple-600 rounded-lg text-xs font-medium",children:["ðŸ“ ",[n.dimensions.width,n.dimensions.height,n.dimensions.length].filter(Boolean).join(" Ã— ")]})]}),n.description&&e.jsx("p",{className:"mt-3 text-sm text-surface-600 leading-relaxed",children:n.description})]}),e.jsx("div",{className:"bg-gradient-to-r from-brand-500 to-brand-600 rounded-2xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-brand-100 text-sm mb-1",children:"Narxi"}),e.jsx("p",{className:"text-3xl font-black text-white",children:p(n.price)})]}),e.jsxs("span",{className:"text-brand-100 text-lg font-medium",children:["so'm/",$]})]})}),L&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center",children:e.jsx(hr,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"font-bold text-surface-900",children:"Chegirmali narxlar"})]}),e.jsxs("div",{className:"space-y-2",children:[((C=n.tierPrices)==null?void 0:C.tier1)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-emerald-50 to-green-50 rounded-xl border border-emerald-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center",children:e.jsx(Et,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[n.tierPrices.tier1.minQuantity,"â€“",n.tierPrices.tier1.maxQuantity," ",$]}),e.jsxs("p",{className:"text-xs text-emerald-600 font-medium",children:[n.tierPrices.tier1.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-emerald-600",children:p(n.tierPrices.tier1.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",$]})]})]}),((m=n.tierPrices)==null?void 0:m.tier2)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(Et,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[n.tierPrices.tier2.minQuantity,"â€“",n.tierPrices.tier2.maxQuantity," ",$]}),e.jsxs("p",{className:"text-xs text-blue-600 font-medium",children:[n.tierPrices.tier2.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-blue-600",children:p(n.tierPrices.tier2.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",$]})]})]}),((y=n.tierPrices)==null?void 0:y.tier3)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-violet-50 rounded-xl border border-purple-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(Et,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-surface-900",children:[n.tierPrices.tier3.minQuantity,"+ ",$]}),e.jsxs("p",{className:"text-xs text-purple-600 font-medium",children:[n.tierPrices.tier3.discountPercent,"% chegirma"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-black text-purple-600",children:p(n.tierPrices.tier3.price)}),e.jsxs("p",{className:"text-xs text-surface-500",children:["so'm/",$]})]})]})]}),e.jsx("p",{className:"mt-3 text-xs text-surface-400 text-center",children:"ðŸ’¡ Ko'proq olsangiz, arzonroq!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-surface-50 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-400 mb-1",children:[e.jsx(pr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"O'lchov"})]}),e.jsx("p",{className:"font-bold text-surface-900",children:$})]}),e.jsxs("div",{className:"bg-surface-50 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-surface-400 mb-1",children:[e.jsx(fr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Kod"})]}),e.jsx("p",{className:"font-bold text-surface-900 font-mono",children:n.code})]})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-lg shadow-surface-200/30",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand-500 to-brand-600 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-500/30",children:e.jsx("span",{className:"text-2xl font-black text-white",children:"SF"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-surface-900 text-lg",children:"Sardor Furnitura"}),e.jsx("p",{className:"text-sm text-surface-500",children:"Mebel furniturasi do'koni"})]}),e.jsx(Vt,{className:"w-5 h-5 text-surface-300"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-surface-100 space-y-3",children:[e.jsxs("a",{href:"tel:+998901234567",className:"flex items-center gap-3 text-surface-600 hover:text-brand-600 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(Fs,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"+998 90 123 45 67"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-surface-600",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx($t,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"Toshkent shahri"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-surface-600",children:[e.jsx("div",{className:"w-10 h-10 bg-surface-100 rounded-xl flex items-center justify-center",children:e.jsx(xt,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium",children:"09:00 - 18:00"})]})]})]}),e.jsxs("p",{className:"text-center text-xs text-surface-400 pt-4",children:["QR kod orqali ko'rilmoqda â€¢ ",new Date().toLocaleDateString("uz-UZ")]})]})]})]})}const zn=(a={})=>{const o=Ks(),{threshold:n=80,edgeThreshold:x=30,disableOnInput:i=!0,fullScreenSwipe:g=!0}=a;s.useEffect(()=>{if(!(window.innerWidth<=768||"ontouchstart"in window))return;let h=0,q=0,P=0,w=0,S=!1,L=0;const $=y=>{const k=y.touches[0];if(h=k.clientX,q=k.clientY,P=h,w=q,L=Date.now(),S=!1,i){const j=y.target,f=j.closest('input, textarea, select, input[type="range"]'),R=j.closest('.modal, .overlay, [role="dialog"], .swal2-container, .dialog'),W=j.closest(".no-swipe"),J=j.closest(".overflow-auto, .overflow-scroll, .overflow-y-auto, .overflow-x-auto");if(f||R||W||J&&g&&!(h<=x))return}if(g)S=!0;else{const j=h<=x,f=h>=window.innerWidth-x;S=j||f}},C=y=>{if(!S)return;const k=y.touches[0];P=k.clientX,w=k.clientY;const j=P-h,f=w-q;if(Math.abs(f)>Math.abs(j)*1.5){S=!1;return}j>20&&Math.abs(f)<Math.abs(j)&&y.preventDefault()},m=y=>{if(!S)return;const k=y.changedTouches[0],j=k.clientX,f=k.clientY,R=j-h,W=f-q,J=Date.now()-L;if(Math.abs(W)>Math.abs(R)*1.5||Math.abs(R)<n)return;const de=Math.abs(R)/J>.3;R>n||de&&R>n*.6?requestAnimationFrame(()=>{o(-1)}):!g&&h>=window.innerWidth-x&&(R<-n||de&&R<-n*.6)&&requestAnimationFrame(()=>{o(1)})};return window.addEventListener("touchstart",$,{passive:!0}),window.addEventListener("touchmove",C,{passive:!1}),window.addEventListener("touchend",m,{passive:!0}),()=>{window.removeEventListener("touchstart",$),window.removeEventListener("touchmove",C),window.removeEventListener("touchend",m)}},[o,n,x,i,g])},$n=()=>(zn({threshold:80,edgeThreshold:30,disableOnInput:!0,fullScreenSwipe:!0}),null),Jt=({children:a,roles:o})=>{const{user:n,loading:x}=it();return x?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Yuklanmoqda..."})]})}):n?o&&!o.includes(n.role)?e.jsx(tt,{to:"/"}):e.jsx(e.Fragment,{children:a}):e.jsx(tt,{to:"/login"})},Mn=({children:a})=>{const o=Ks(),[n,x]=dt.useState(null);return dt.useEffect(()=>{document.body.classList.add("kassa-locked","kassa-protected"),(()=>{try{const w=localStorage.getItem("kassaLoggedIn");if(w){const S=JSON.parse(w);if(S.loggedIn&&S.user==="kassa"){const L=N(b({},S),{timestamp:Date.now()});localStorage.setItem("kassaLoggedIn",JSON.stringify(L)),x(!0),window.history.pushState(null,"",window.location.href);return}}x(!1),o("/kassa-login",{replace:!0})}catch(w){console.error("Kassa login check error:",w),x(!1),o("/kassa-login",{replace:!0})}})();const g=()=>{window.location.pathname.startsWith("/kassa")&&window.history.pushState(null,"",window.location.href)},v=w=>{if(window.location.pathname.startsWith("/kassa")&&!(w.key==="F5"||w.ctrlKey&&(w.key==="r"||w.key==="R"))&&w.key!=="F12"&&(w.altKey&&w.key==="F4"||w.ctrlKey&&w.key==="w"||w.ctrlKey&&w.key==="W"||w.ctrlKey&&w.key==="t"||w.ctrlKey&&w.key==="T"||w.ctrlKey&&w.shiftKey&&w.key==="I"||w.ctrlKey&&w.shiftKey&&w.key==="J"||w.ctrlKey&&w.key==="u"||w.ctrlKey&&w.key==="U"||w.ctrlKey&&w.key==="s"||w.ctrlKey&&w.key==="S"||w.ctrlKey&&w.key==="p"||w.ctrlKey&&w.key==="P"))return w.preventDefault(),w.stopPropagation(),alert("âš ï¸ Bu amal kassa tizimida taqiqlanadi!"),!1},h=w=>{if(window.location.pathname.startsWith("/kassa"))return w.preventDefault(),alert("âš ï¸ O'ng tugma kassa tizimida taqiqlanadi!"),!1},q=()=>{window.location.pathname.startsWith("/kassa")},P=()=>{document.hidden&&setTimeout(()=>{window.focus()},100)};return window.addEventListener("popstate",g),window.addEventListener("keydown",v,!0),window.addEventListener("contextmenu",h),window.addEventListener("beforeunload",q),document.addEventListener("visibilitychange",P),window.focus(),()=>{document.body.classList.remove("kassa-locked","kassa-protected"),window.removeEventListener("popstate",g),window.removeEventListener("keydown",v,!0),window.removeEventListener("contextmenu",h),window.removeEventListener("beforeunload",q),document.removeEventListener("visibilitychange",P)}},[o]),n===null?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Tekshirilmoqda..."})]})}):n?e.jsx(e.Fragment,{children:a}):null},Tn=()=>{const{user:a,loading:o}=it(),[n,x]=dt.useState(!0),[i,g]=dt.useState(!1);return dt.useEffect(()=>{Q(es,null,function*(){var h;try{const q=new AbortController,P=setTimeout(()=>q.abort(),5e3),w=yield fetch("http://localhost:8000/api/auth/check-admin",{signal:q.signal,headers:{"Content-Type":"application/json"}});if(clearTimeout(P),!w.ok)throw new Error(`HTTP error! status: ${w.status}`);const S=yield w.json();g(S.hasAdmin)}catch(q){console.error("Admin check error:",q),q.name==="AbortError"?console.warn("Admin check timeout - server javob bermadi"):(h=q.message)!=null&&h.includes("Failed to fetch")&&console.warn("Server bilan aloqa yo'q - localhost:8000 ishlamayapti"),g(!0)}finally{x(!1)}})},[]),o||n?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-2xl bg-brand-100 flex items-center justify-center",children:e.jsx("div",{className:"spinner text-brand-600"})}),e.jsx("p",{className:"text-surface-500 text-sm",children:"Yuklanmoqda..."})]})}):!i&&!a?e.jsx(tt,{to:"/register"}):a?a.role==="admin"?e.jsx(tt,{to:"/admin"}):a.role==="cashier"?e.jsx(tt,{to:"/kassa"}):e.jsx(tt,{to:"/helper"}):e.jsx(tt,{to:"/login"})};function Rn(){return e.jsx(Tr,{children:e.jsx($r,{children:e.jsxs(br,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:[e.jsx($n,{}),e.jsxs(gr,{children:[e.jsx(We,{path:"/login",element:e.jsx(Rr,{})}),e.jsx(We,{path:"/register",element:e.jsx(Qr,{})}),e.jsx(We,{path:"/kassa-login",element:e.jsx(Sn,{})}),e.jsx(We,{path:"/product/:id",element:e.jsx(Pn,{})}),e.jsx(We,{path:"/",element:e.jsx(Tn,{})}),e.jsxs(We,{path:"/kassa",element:e.jsx(Mn,{children:e.jsx(fn,{})}),children:[e.jsx(We,{index:!0,element:e.jsx(jn,{})}),e.jsx(We,{path:"receipts",element:e.jsx(vn,{})}),e.jsx(We,{path:"clients",element:e.jsx(Nn,{})}),e.jsx(We,{path:"debts",element:e.jsx(wn,{})}),e.jsx(We,{path:"products",element:e.jsx(yn,{})})]}),e.jsxs(We,{path:"/admin",element:e.jsx(Jt,{roles:["admin"],children:e.jsx(Lr,{})}),children:[e.jsx(We,{index:!0,element:e.jsx(Ir,{})}),e.jsx(We,{path:"kassa",element:e.jsx(Wt,{})}),e.jsx(We,{path:"kassa-pro",element:e.jsx(Wt,{})}),e.jsx(We,{path:"products",element:e.jsx(an,{})}),e.jsx(We,{path:"warehouses",element:e.jsx(rn,{})}),e.jsx(We,{path:"customers",element:e.jsx(nn,{})}),e.jsx(We,{path:"debts",element:e.jsx(Na,{})}),e.jsx(We,{path:"debt-approvals",element:e.jsx(ln,{})}),e.jsx(We,{path:"orders",element:e.jsx(on,{})}),e.jsx(We,{path:"helpers",element:e.jsx(cn,{})}),e.jsx(We,{path:"staff-receipts",element:e.jsx(wa,{})}),e.jsx(We,{path:"telegram-settings",element:e.jsx(kn,{})})]}),e.jsxs(We,{path:"/cashier",element:e.jsx(Jt,{roles:["cashier"],children:e.jsx(un,{})}),children:[e.jsx(We,{index:!0,element:e.jsx(Wt,{})}),e.jsx(We,{path:"debts",element:e.jsx(Na,{})}),e.jsx(We,{path:"staff-receipts",element:e.jsx(wa,{})})]}),e.jsx(We,{path:"/helper",element:e.jsx(Jt,{roles:["helper"],children:e.jsx(hn,{})}),children:e.jsx(We,{index:!0,element:e.jsx(pn,{})})})]})]})})})}jr.createRoot(document.getElementById("root")).render(e.jsx(dt.StrictMode,{children:e.jsx(Rn,{})}))});export default Qn();
